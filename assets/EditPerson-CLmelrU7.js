/* empty css             *//* empty css                  */import{x as I,r as _,a1 as P,an as A,o as B,d as f,e as h,g as t,f as F,as as M,q as u,at as i,m as g,z as c,E as T,A as N,B as $,_ as z}from"./index-CKFJJd3L.js";import{r as w}from"./request-BYlNfosp.js";import"./axios-B4uVmeYG.js";const d=p=>(N("data-v-1ed10e3d"),p=p(),$(),p),L={class:"container"},R={class:"flex items-center"},j=d(()=>t("span",{class:"edit-avatar-hint"},"点击头像以编辑",-1)),G={class:"form-container"},H={class:"form-group"},J=d(()=>t("label",{for:"account"},"账号",-1)),K={class:"form-group"},O=d(()=>t("label",{for:"password"},"密码",-1)),Q={class:"form-group"},W=d(()=>t("label",{for:"email"},"邮箱",-1)),X=["readonly"],Y={class:"form-group"},Z=d(()=>t("label",{for:"phone"},"手机号",-1)),ee=["readonly"],ae={class:"form-group"},te=d(()=>t("label",{for:"token"},"百度秘钥token",-1)),oe=["readonly"],se={class:"form-group"},ne=d(()=>t("label",{for:"nickname"},"昵称",-1)),le=["readonly"],re={key:2,type:"submit"},ce=I({__name:"EditPerson",setup(p){const n={account:"默认账号",password:"默认密码",email:"example@example.com",phone:"1234567890",token:"默认Token",pet_name:"默认展示昵称",avatar:"https://cube.elemecdn.com/0/88/03b0d39583f48206768a7534e55bcpng.png"},a=_({account:n.account,password:n.password,email:n.email,phone:n.phone,token:n.token,nickname:n.pet_name}),m=_(n.avatar),l=_(!1),b=P(),x=A(),k=_(null),y=async()=>{try{console.log("访问个人信息展示界面，更新数据");const o=await w.post("/personal_page",{user:b.token.access_token});if(o.data.success==="true"&&o.data.data.length>0){const e=o.data.data[0];console.log("后端响应数据：",e),a.value.account=e.account??n.account,a.value.password=e.password??n.password,a.value.email=e.email??n.email,a.value.phone=e.phone??n.phone,a.value.token=e.token??n.token,a.value.nickname=e.pet_name??n.pet_name,m.value=e.url,console.log("avatarUrl:",m.value)}else c.error(`获取数据失败: ${o.data.message}`)}catch(o){const e=o;c.error("发生错误: "+e.message)}},U=async()=>{try{console.log("更新用户信息");const o={account:a.value.account,email:a.value.email,phone:a.value.phone,token:a.value.token,pet_name:a.value.nickname},e=await w.post("/person_page_show",o);e.data.success==="true"?(c.success("用户信息更新成功"),l.value=!1,await y()):c.error(`更新数据失败: ${e.data.message}`)}catch(o){const e=o;c.error("发生错误: "+e.message)}},V=async()=>{var v,s;const o=(s=(v=k.value)==null?void 0:v.files)==null?void 0:s[0],e=new FormData;o&&o instanceof File&&e.append("avatar",o),e.append("user",b.token.access_token);try{const r=await w.post("/upload_avatar",e,{headers:{"Content-Type":"multipart/form-data"}});r.data.success==="true"?(c.success("头像上传成功"),m.value=r.data.avatar_url,x.setAvatarUrl(r.data.avatar_url),console.log("头像 URL 更新为：",r.data.avatar_url)):(console.error("头像上传失败:",r.data),c.error(`头像上传失败: ${r.data.message}`))}catch(r){const S=r;c.error("发生错误: "+S.message)}},E=()=>{var o;(o=k.value)==null||o.click()},q=()=>{l.value=!0},C=()=>{l.value=!1,y()},D=()=>{U()};return B(()=>{y()}),(o,e)=>{const v=T;return f(),h("div",L,[t("div",R,[F(v,{class:"mr-3",size:250,src:m.value,onClick:E},null,8,["src"]),j,t("input",{type:"file",ref_key:"fileInput",ref:k,onChange:V,style:{display:"none"}},null,544),t("div",G,[t("form",{onSubmit:M(D,["prevent"])},[t("div",H,[J,u(t("input",{id:"account","onUpdate:modelValue":e[0]||(e[0]=s=>a.value.account=s),type:"text",readonly:"",required:""},null,512),[[i,a.value.account]])]),t("div",K,[O,u(t("input",{id:"password","onUpdate:modelValue":e[1]||(e[1]=s=>a.value.password=s),type:"password",readonly:"",required:""},null,512),[[i,a.value.password]])]),t("div",Q,[W,u(t("input",{id:"email","onUpdate:modelValue":e[2]||(e[2]=s=>a.value.email=s),type:"email",readonly:!l.value,required:""},null,8,X),[[i,a.value.email]])]),t("div",Y,[Z,u(t("input",{id:"phone","onUpdate:modelValue":e[3]||(e[3]=s=>a.value.phone=s),type:"tel",readonly:!l.value,required:""},null,8,ee),[[i,a.value.phone]])]),t("div",ae,[te,u(t("input",{id:"token","onUpdate:modelValue":e[4]||(e[4]=s=>a.value.token=s),type:"text",readonly:!l.value,required:""},null,8,oe),[[i,a.value.token]])]),t("div",se,[ne,u(t("input",{id:"nickname","onUpdate:modelValue":e[5]||(e[5]=s=>a.value.nickname=s),type:"text",readonly:!l.value,required:""},null,8,le),[[i,a.value.nickname]])]),l.value?g("",!0):(f(),h("button",{key:0,type:"button",onClick:q},"编辑")),l.value?(f(),h("button",{key:1,type:"button",onClick:C},"取消修改")):g("",!0),l.value?(f(),h("button",re,"保存修改")):g("",!0)],32)])])])}}}),ve=z(ce,[["__scopeId","data-v-1ed10e3d"]]);export{ve as default};
