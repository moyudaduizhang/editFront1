/* empty css             *//* empty css                  *//* empty css                 */import{x as q,r as d,o as F,d as n,e as r,g as t,F as v,s as g,n as I,t as m,f,h as N,E as T,m as z,S as U,w as H,i as K,U as L,z as O,y as R,J,A as P,B as j,_ as G}from"./index-CKFJJd3L.js";import{r as C}from"./requestdb-C2Ny6NpS.js";import{r as Q}from"./requestai-m6LUYzBO.js";import{r as A}from"./request-BYlNfosp.js";import"./axios-B4uVmeYG.js";const b=u=>(P("data-v-c5294b84"),u=u(),j(),u),W={class:"chat-app"},X={class:"sidebar"},Y=b(()=>t("h3",null,"知识库列表",-1)),Z=["onClick"],ee={class:"history"},se=b(()=>t("h3",null,"聊天历史记录",-1)),ae=["onClick"],te={class:"chat-area"},oe={class:"messages"},ne={class:"message-header"},re={class:"sender-name"},le={class:"message-content"},ce={key:0,class:"loading"},de={class:"input-area"},ie="https://path.to/ai-avatar.png",ue=q({__name:"Chat_rag",setup(u){const w=d([{id:1,name:"暂无可用知识库"}]),c=d([]),p=d([]),l=d(""),y=d([]),_=d(!1),x=async()=>{try{console.log("Fetching user avatar...");const e=await A.post("/personal_page",{user:"admin"});return e.data.success==="true"?e.data.url:(console.log(`获取用户头像失败: ${e.data.message}`),"")}catch(e){return console.log(`发生错误: ${e.message}`),""}},S=e=>{const a=c.value.indexOf(e);a===-1?c.value.push(e):c.value.splice(a,1)},V=async e=>{const a=await C.post("/show_his",{username:"admin",session_id:e.toString()});p.value=a.data.data},k=async()=>{if(l.value.trim()==="")return;const e=await x();p.value.push({id:Date.now(),text:l.value,sender:"user",avatar:e}),_.value=!0;const a=new FormData;a.append("username","admin"),a.append("number","1"),a.append("cont",l.value),a.append("question",l.value);for(const o of c.value)a.append("id",o.toString());try{let o;const i=L({id:Date.now(),text:"",sender:"AI",avatar:ie});if(p.value.push(i),c.value.length>0){const s=await fetch("https://23893a6d.r23.cpolar.top/multimodels/index_milvus",{method:"POST",body:a});if(s.body){const h=s.body.getReader(),$=new TextDecoder("utf-8");for(;;){const{done:B,value:M}=await h.read();if(B)break;i.text+=$.decode(M)}console.log("数据库响应:",s)}}else o=await Q.post("/getAI",a),console.log("无知识库ai响应:",o.data),i.text=o.data.answer}catch(o){O.error("请求错误: "+o),console.log("请求错误："+o)}finally{l.value="",_.value=!1}},D=async()=>{try{const e=await C.post("/show_filesss",{user:"admin"});e.data.success==="true"&&e.data.data.length>0?w.value=e.data.data:console.log(`获取数据失败: ${e.data.message}`)}catch(e){console.log("发生错误: "+e.message)}},E=async()=>{try{const e=await A.post("/multimodels/show_session",{username:"admin"});e.data.success==="true"?(y.value=e.data.data,console.log(e.data.data)):console.log(`获取聊天历史记录失败: ${e.data.message}`)}catch(e){console.log("发生错误: "+e.message)}};return F(()=>{D(),x(),E()}),(e,a)=>{const o=R,i=J;return n(),r("div",W,[t("div",X,[Y,t("ul",null,[(n(!0),r(v,null,g(w.value,s=>(n(),r("li",{key:s.id,class:I({selected:c.value.includes(s.id)}),onClick:h=>S(s.id)},m(s.name),11,Z))),128))])]),t("div",ee,[se,t("ul",null,[(n(!0),r(v,null,g(y.value,s=>(n(),r("li",{key:s.id,onClick:h=>V(s)}," 聊天历史记录ID： "+m(s),9,ae))),128))])]),t("div",te,[t("div",oe,[(n(!0),r(v,null,g(p.value,s=>(n(),r("div",{key:s.id,class:I(["message",s.sender==="user"?"user-message":"ai-message"])},[t("div",ne,[f(N(T),{class:"mr-3",src:s.avatar,size:32},null,8,["src"]),t("span",re,m(s.sender==="user"?"用户":"AI"),1)]),t("div",le,m(s.text),1),s.sender==="user"&&_.value?(n(),r("div",ce," 加载中... ")):z("",!0)],2))),128))]),t("div",de,[f(o,{type:"text",modelValue:l.value,"onUpdate:modelValue":a[0]||(a[0]=s=>l.value=s),onKeyup:U(k,["enter"]),placeholder:"输入消息"},null,8,["modelValue"]),f(i,{onClick:k},{default:H(()=>[K("发送")]),_:1})])])])}}}),ye=G(ue,[["__scopeId","data-v-c5294b84"]]);export{ye as default};
