var w0=Object.defineProperty;var y0=(Te,we,t)=>we in Te?w0(Te,we,{enumerable:!0,configurable:!0,writable:!0,value:t}):Te[we]=t;var Re=(Te,we,t)=>(y0(Te,typeof we!="symbol"?we+"":we,t),t);import{U as createAssigner,V as copyObject,W as keysIn,X as baseSlice,Y as toString$2,Z as baseClone,$ as isArray,a0 as isObjectLike,a1 as baseGetTag,a2 as isPlainObject,a3 as baseIsEqual,a4 as baseIteratee,a5 as baseForOwn,a6 as baseAssignValue,a7 as baseUnset,a8 as isObject$2,a9 as isFunction,aa as merge$1,ab as clone$3,ac as isEqual,ad as get,ae as set$1,af as cloneDeep,ag as debounce,ah as throttle,Q as getDefaultExportFromCjs,ai as map$1,aj as identity,P as commonjsGlobal,ak as omit,_ as _export_sfc,b as resolveComponent,d as openBlock,e as createElementBlock,g as createBaseVNode,p as createBlock,m as createCommentVNode}from"./index-Cq1Zp2HD.js";import{v as v4}from"./v4-CQkTLCs1.js";function _mergeNamespaces(Te,we){for(var t=0;t<we.length;t++){const te=we[t];if(typeof te!="string"&&!Array.isArray(te)){for(const be in te)if(be!=="default"&&!(be in Te)){const xe=Object.getOwnPropertyDescriptor(te,be);xe&&Object.defineProperty(Te,be,xe.get?xe:{enumerable:!0,get:()=>te[be]})}}}return Object.freeze(Object.defineProperty(Te,Symbol.toStringTag,{value:"Module"}))}var assignIn=createAssigner(function(Te,we){copyObject(we,keysIn(we),Te)});function castSlice(Te,we,t){var te=Te.length;return t=t===void 0?te:t,!we&&t>=te?Te:baseSlice(Te,we,t)}var rsAstralRange$1="\\ud800-\\udfff",rsComboMarksRange$1="\\u0300-\\u036f",reComboHalfMarksRange$1="\\ufe20-\\ufe2f",rsComboSymbolsRange$1="\\u20d0-\\u20ff",rsComboRange$1=rsComboMarksRange$1+reComboHalfMarksRange$1+rsComboSymbolsRange$1,rsVarRange$1="\\ufe0e\\ufe0f",rsZWJ$1="\\u200d",reHasUnicode=RegExp("["+rsZWJ$1+rsAstralRange$1+rsComboRange$1+rsVarRange$1+"]");function hasUnicode(Te){return reHasUnicode.test(Te)}function asciiToArray(Te){return Te.split("")}var rsAstralRange="\\ud800-\\udfff",rsComboMarksRange="\\u0300-\\u036f",reComboHalfMarksRange="\\ufe20-\\ufe2f",rsComboSymbolsRange="\\u20d0-\\u20ff",rsComboRange=rsComboMarksRange+reComboHalfMarksRange+rsComboSymbolsRange,rsVarRange="\\ufe0e\\ufe0f",rsAstral="["+rsAstralRange+"]",rsCombo="["+rsComboRange+"]",rsFitz="\\ud83c[\\udffb-\\udfff]",rsModifier="(?:"+rsCombo+"|"+rsFitz+")",rsNonAstral="[^"+rsAstralRange+"]",rsRegional="(?:\\ud83c[\\udde6-\\uddff]){2}",rsSurrPair="[\\ud800-\\udbff][\\udc00-\\udfff]",rsZWJ="\\u200d",reOptMod=rsModifier+"?",rsOptVar="["+rsVarRange+"]?",rsOptJoin="(?:"+rsZWJ+"(?:"+[rsNonAstral,rsRegional,rsSurrPair].join("|")+")"+rsOptVar+reOptMod+")*",rsSeq=rsOptVar+reOptMod+rsOptJoin,rsSymbol="(?:"+[rsNonAstral+rsCombo+"?",rsCombo,rsRegional,rsSurrPair,rsAstral].join("|")+")",reUnicode=RegExp(rsFitz+"(?="+rsFitz+")|"+rsSymbol+rsSeq,"g");function unicodeToArray(Te){return Te.match(reUnicode)||[]}function stringToArray(Te){return hasUnicode(Te)?unicodeToArray(Te):asciiToArray(Te)}function createCaseFirst(Te){return function(we){we=toString$2(we);var t=hasUnicode(we)?stringToArray(we):void 0,te=t?t[0]:we.charAt(0),be=t?castSlice(t,1).join(""):we.slice(1);return te[Te]()+be}}var upperFirst=createCaseFirst("toUpperCase");function basePropertyOf(Te){return function(we){return Te==null?void 0:Te[we]}}var CLONE_DEEP_FLAG=1,CLONE_SYMBOLS_FLAG=4;function cloneDeepWith(Te,we){return we=typeof we=="function"?we:void 0,baseClone(Te,CLONE_DEEP_FLAG|CLONE_SYMBOLS_FLAG,we)}var htmlEscapes={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},escapeHtmlChar=basePropertyOf(htmlEscapes),reUnescapedHtml=/[&<>"']/g,reHasUnescapedHtml=RegExp(reUnescapedHtml.source);function escape$1(Te){return Te=toString$2(Te),Te&&reHasUnescapedHtml.test(Te)?Te.replace(reUnescapedHtml,escapeHtmlChar):Te}var reRegExpChar=/[\\^$.*+?()[\]{}|]/g,reHasRegExpChar=RegExp(reRegExpChar.source);function escapeRegExp(Te){return Te=toString$2(Te),Te&&reHasRegExpChar.test(Te)?Te.replace(reRegExpChar,"\\$&"):Te}var stringTag="[object String]";function isString$1(Te){return typeof Te=="string"||!isArray(Te)&&isObjectLike(Te)&&baseGetTag(Te)==stringTag}function isElement$1(Te){return isObjectLike(Te)&&Te.nodeType===1&&!isPlainObject(Te)}function isEqualWith(Te,we,t){t=typeof t=="function"?t:void 0;var te=t?t(Te,we):void 0;return te===void 0?baseIsEqual(Te,we,void 0,t):!!te}function mapValues(Te,we){var t={};return we=baseIteratee(we),baseForOwn(Te,function(te,be,xe){baseAssignValue(t,be,we(te,be,xe))}),t}var htmlUnescapes={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"},unescapeHtmlChar=basePropertyOf(htmlUnescapes),reEscapedHtml=/&(?:amp|lt|gt|quot|#39);/g,reHasEscapedHtml=RegExp(reEscapedHtml.source);function unescape$2(Te){return Te=toString$2(Te),Te&&reHasEscapedHtml.test(Te)?Te.replace(reEscapedHtml,unescapeHtmlChar):Te}function unset(Te,we){return Te==null?!0:baseUnset(Te,we)}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 *//**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */let globalVar;try{globalVar={window,document}}catch{/* istanbul ignore next -- @preserve */globalVar={window:{},document:{}}}var global=globalVar;function getUserAgent(){try{return navigator.userAgent.toLowerCase()}catch{return""}}const userAgent=getUserAgent(),env={isMac:isMac(userAgent),isWindows:isWindows(userAgent),isGecko:isGecko(userAgent),isSafari:isSafari(userAgent),isiOS:isiOS(userAgent),isAndroid:isAndroid(userAgent),isBlink:isBlink(userAgent),get isMediaForcedColors(){return isMediaForcedColors()},get isMotionReduced(){return isMotionReduced()},features:{isRegExpUnicodePropertySupported:isRegExpUnicodePropertySupported()}};function isMac(Te){return Te.indexOf("macintosh")>-1}function isWindows(Te){return Te.indexOf("windows")>-1}function isGecko(Te){return!!Te.match(/gecko\/\d+/)}function isSafari(Te){return Te.indexOf(" applewebkit/")>-1&&Te.indexOf("chrome")===-1}function isiOS(Te){return!!Te.match(/iphone|ipad/i)||isMac(Te)&&navigator.maxTouchPoints>0}function isAndroid(Te){return Te.indexOf("android")>-1}function isBlink(Te){return Te.indexOf("chrome/")>-1&&Te.indexOf("edge/")<0}function isRegExpUnicodePropertySupported(){let Te=!1;try{Te="ć".search(new RegExp("[\\p{L}]","u"))===0}catch{}return Te}function isMediaForcedColors(){return global.window.matchMedia?global.window.matchMedia("(forced-colors: active)").matches:!1}function isMotionReduced(){return global.window.matchMedia?global.window.matchMedia("(prefers-reduced-motion)").matches:!1}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function fastDiff(Te,we,t,te){t=t||function(Ie,Ae){return Ie===Ae};const be=Array.isArray(Te)?Te:Array.prototype.slice.call(Te),xe=Array.isArray(we)?we:Array.prototype.slice.call(we),ve=findChangeBoundaryIndexes(be,xe,t);return te?changeIndexesToAtomicChanges(ve,xe.length):changeIndexesToChanges(xe,ve)}function findChangeBoundaryIndexes(Te,we,t){const te=findFirstDifferenceIndex(Te,we,t);if(te===-1)return{firstIndex:-1,lastIndexOld:-1,lastIndexNew:-1};const be=cutAndReverse(Te,te),xe=cutAndReverse(we,te),ve=findFirstDifferenceIndex(be,xe,t),ke=Te.length-ve,Ie=we.length-ve;return{firstIndex:te,lastIndexOld:ke,lastIndexNew:Ie}}function findFirstDifferenceIndex(Te,we,t){for(let te=0;te<Math.max(Te.length,we.length);te++)if(Te[te]===void 0||we[te]===void 0||!t(Te[te],we[te]))return te;return-1}function cutAndReverse(Te,we){return Te.slice(we).reverse()}function changeIndexesToChanges(Te,we){const t=[],{firstIndex:te,lastIndexOld:be,lastIndexNew:xe}=we;return xe-te>0&&t.push({index:te,type:"insert",values:Te.slice(te,xe)}),be-te>0&&t.push({index:te+(xe-te),type:"delete",howMany:be-te}),t}function changeIndexesToAtomicChanges(Te,we){const{firstIndex:t,lastIndexOld:te,lastIndexNew:be}=Te;if(t===-1)return Array(we).fill("equal");let xe=[];return t>0&&(xe=xe.concat(Array(t).fill("equal"))),be-t>0&&(xe=xe.concat(Array(be-t).fill("insert"))),te-t>0&&(xe=xe.concat(Array(te-t).fill("delete"))),be<we&&(xe=xe.concat(Array(we-be).fill("equal"))),xe}function diff$1(Te,we,t){t=t||function(Fe,Be){return Fe===Be};const te=Te.length,be=we.length;if(te>200||be>200||te+be>300)return diff$1.fastDiff(Te,we,t,!0);let xe,ve;if(be<te){const Fe=Te;Te=we,we=Fe,xe="delete",ve="insert"}else xe="insert",ve="delete";const ke=Te.length,Ie=we.length,Ae=Ie-ke,Se={},Oe={};function Ve(Fe){const Be=(Oe[Fe-1]!==void 0?Oe[Fe-1]:-1)+1,$e=Oe[Fe+1]!==void 0?Oe[Fe+1]:-1,Ue=Be>$e?-1:1;Se[Fe+Ue]&&(Se[Fe]=Se[Fe+Ue].slice(0)),Se[Fe]||(Se[Fe]=[]),Se[Fe].push(Be>$e?xe:ve);let He=Math.max(Be,$e),ze=He-Fe;for(;ze<ke&&He<Ie&&t(Te[ze],we[He]);)ze++,He++,Se[Fe].push("equal");return He}let Me=0,De;do{for(De=-Me;De<Ae;De++)Oe[De]=Ve(De);for(De=Ae+Me;De>Ae;De--)Oe[De]=Ve(De);Oe[Ae]=Ve(Ae),Me++}while(Oe[Ae]!==Ie);return Se[Ae].slice(1)}diff$1.fastDiff=fastDiff;/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function diffToChanges(Te,we){const t=[];let te=0,be=null;return Te.forEach(ve=>{ve=="equal"?(xe(),te++):ve=="insert"?(be&&be.type=="insert"?be.values.push(we[te]):(xe(),be={type:"insert",index:te,values:[we[te]]}),te++):be&&be.type=="delete"?be.howMany++:(xe(),be={type:"delete",index:te,howMany:1})}),xe(),t;function xe(){be&&(t.push(be),be=null)}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function spy(){return function Te(){Te.called=!0}}class EventInfo{constructor(we,t){Re(this,"source");Re(this,"name");Re(this,"path");Re(this,"stop");Re(this,"off");Re(this,"return");this.source=we,this.name=t,this.path=[],this.stop=spy(),this.off=spy()}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const HEX_NUMBERS=new Array(256).fill("").map((Te,we)=>("0"+we.toString(16)).slice(-2));function uid(){const Te=Math.random()*4294967296>>>0,we=Math.random()*4294967296>>>0,t=Math.random()*4294967296>>>0,te=Math.random()*4294967296>>>0;return"e"+HEX_NUMBERS[Te>>0&255]+HEX_NUMBERS[Te>>8&255]+HEX_NUMBERS[Te>>16&255]+HEX_NUMBERS[Te>>24&255]+HEX_NUMBERS[we>>0&255]+HEX_NUMBERS[we>>8&255]+HEX_NUMBERS[we>>16&255]+HEX_NUMBERS[we>>24&255]+HEX_NUMBERS[t>>0&255]+HEX_NUMBERS[t>>8&255]+HEX_NUMBERS[t>>16&255]+HEX_NUMBERS[t>>24&255]+HEX_NUMBERS[te>>0&255]+HEX_NUMBERS[te>>8&255]+HEX_NUMBERS[te>>16&255]+HEX_NUMBERS[te>>24&255]}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const priorities={get(Te="normal"){return typeof Te!="number"?this[Te]||this.normal:Te},highest:1e5,high:1e3,normal:0,low:-1e3,lowest:-1e5};function insertToPriorityArray(Te,we){const t=priorities.get(we.priority);for(let te=0;te<Te.length;te++)if(priorities.get(Te[te].priority)<t){Te.splice(te,0,we);return}Te.push(we)}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const DOCUMENTATION_URL="https://ckeditor.com/docs/ckeditor5/latest/support/error-codes.html";class CKEditorError extends Error{constructor(t,te,be){super(getErrorMessage(t,be));Re(this,"context");Re(this,"data");this.name="CKEditorError",this.context=te,this.data=be}is(t){return t==="CKEditorError"}static rethrowUnexpectedError(t,te){if(t.is&&t.is("CKEditorError"))throw t;const be=new CKEditorError(t.message,te);throw be.stack=t.stack,be}}function logWarning(Te,we){console.warn(...formatConsoleArguments(Te,we))}function logError(Te,we){console.error(...formatConsoleArguments(Te,we))}function getLinkToDocumentationMessage(Te){return`
Read more: ${DOCUMENTATION_URL}#error-${Te}`}function getErrorMessage(Te,we){const t=new WeakSet,be=we?` ${JSON.stringify(we,(ve,ke)=>{if(typeof ke=="object"&&ke!==null){if(t.has(ke))return`[object ${ke.constructor.name}]`;t.add(ke)}return ke})}`:"",xe=getLinkToDocumentationMessage(Te);return Te+be+xe}function formatConsoleArguments(Te,we){const t=getLinkToDocumentationMessage(Te);return we?[Te,we,t]:[Te,t]}const version="42.0.1",releaseDate=new Date(2024,6,11);/* istanbul ignore next -- @preserve */if(globalThis.CKEDITOR_VERSION)throw new CKEditorError("ckeditor-duplicated-modules",null);globalThis.CKEDITOR_VERSION=version;const _listeningTo=Symbol("listeningTo"),_emitterId=Symbol("emitterId"),_delegations=Symbol("delegations"),defaultEmitterClass$1=EmitterMixin(Object);function EmitterMixin(Te){if(!Te)return defaultEmitterClass$1;class we extends Te{on(te,be,xe){this.listenTo(this,te,be,xe)}once(te,be,xe){let ve=!1;const ke=(Ie,...Ae)=>{ve||(ve=!0,Ie.off(),be.call(this,Ie,...Ae))};this.listenTo(this,te,ke,xe)}off(te,be){this.stopListening(this,te,be)}listenTo(te,be,xe,ve={}){let ke,Ie;this[_listeningTo]||(this[_listeningTo]={});const Ae=this[_listeningTo];_getEmitterId(te)||_setEmitterId(te);const Se=_getEmitterId(te);(ke=Ae[Se])||(ke=Ae[Se]={emitter:te,callbacks:{}}),(Ie=ke.callbacks[be])||(Ie=ke.callbacks[be]=[]),Ie.push(xe),addEventListener$1(this,te,be,xe,ve)}stopListening(te,be,xe){const ve=this[_listeningTo];let ke=te&&_getEmitterId(te);const Ie=ve&&ke?ve[ke]:void 0,Ae=Ie&&be?Ie.callbacks[be]:void 0;if(!(!ve||te&&!Ie||be&&!Ae))if(xe)removeEventListener$1(this,te,be,xe),Ae.indexOf(xe)!==-1&&(Ae.length===1?delete Ie.callbacks[be]:removeEventListener$1(this,te,be,xe));else if(Ae){for(;xe=Ae.pop();)removeEventListener$1(this,te,be,xe);delete Ie.callbacks[be]}else if(Ie){for(be in Ie.callbacks)this.stopListening(te,be);delete ve[ke]}else{for(ke in ve)this.stopListening(ve[ke].emitter);delete this[_listeningTo]}}fire(te,...be){try{const xe=te instanceof EventInfo?te:new EventInfo(this,te),ve=xe.name;let ke=getCallbacksForEvent(this,ve);if(xe.path.push(this),ke){const Ae=[xe,...be];ke=Array.from(ke);for(let Se=0;Se<ke.length&&(ke[Se].callback.apply(this,Ae),xe.off.called&&(delete xe.off.called,this._removeEventListener(ve,ke[Se].callback)),!xe.stop.called);Se++);}const Ie=this[_delegations];if(Ie){const Ae=Ie.get(ve),Se=Ie.get("*");Ae&&fireDelegatedEvents(Ae,xe,be),Se&&fireDelegatedEvents(Se,xe,be)}return xe.return}catch(xe){/* istanbul ignore next -- @preserve */CKEditorError.rethrowUnexpectedError(xe,this)}}delegate(...te){return{to:(be,xe)=>{this[_delegations]||(this[_delegations]=new Map),te.forEach(ve=>{const ke=this[_delegations].get(ve);ke?ke.set(be,xe):this[_delegations].set(ve,new Map([[be,xe]]))})}}}stopDelegating(te,be){if(this[_delegations])if(!te)this[_delegations].clear();else if(!be)this[_delegations].delete(te);else{const xe=this[_delegations].get(te);xe&&xe.delete(be)}}_addEventListener(te,be,xe){createEventNamespace(this,te);const ve=getCallbacksListsForNamespace(this,te),ke=priorities.get(xe.priority),Ie={callback:be,priority:ke};for(const Ae of ve)insertToPriorityArray(Ae,Ie)}_removeEventListener(te,be){const xe=getCallbacksListsForNamespace(this,te);for(const ve of xe)for(let ke=0;ke<ve.length;ke++)ve[ke].callback==be&&(ve.splice(ke,1),ke--)}}return we}["on","once","off","listenTo","stopListening","fire","delegate","stopDelegating","_addEventListener","_removeEventListener"].forEach(Te=>{EmitterMixin[Te]=defaultEmitterClass$1.prototype[Te]});function _getEmitterListenedTo(Te,we){const t=Te[_listeningTo];return t&&t[we]?t[we].emitter:null}function _setEmitterId(Te,we){Te[_emitterId]||(Te[_emitterId]=we||uid())}function _getEmitterId(Te){return Te[_emitterId]}function getEvents(Te){return Te._events||Object.defineProperty(Te,"_events",{value:{}}),Te._events}function makeEventNode(){return{callbacks:[],childEvents:[]}}function createEventNamespace(Te,we){const t=getEvents(Te);if(t[we])return;let te=we,be=null;const xe=[];for(;te!==""&&!t[te];)t[te]=makeEventNode(),xe.push(t[te]),be&&t[te].childEvents.push(be),be=te,te=te.substr(0,te.lastIndexOf(":"));if(te!==""){for(const ve of xe)ve.callbacks=t[te].callbacks.slice();t[te].childEvents.push(be)}}function getCallbacksListsForNamespace(Te,we){const t=getEvents(Te)[we];if(!t)return[];let te=[t.callbacks];for(let be=0;be<t.childEvents.length;be++){const xe=getCallbacksListsForNamespace(Te,t.childEvents[be]);te=te.concat(xe)}return te}function getCallbacksForEvent(Te,we){let t;return!Te._events||!(t=Te._events[we])||!t.callbacks.length?we.indexOf(":")>-1?getCallbacksForEvent(Te,we.substr(0,we.lastIndexOf(":"))):null:t.callbacks}function fireDelegatedEvents(Te,we,t){for(let[te,be]of Te){be?typeof be=="function"&&(be=be(we.name)):be=we.name;const xe=new EventInfo(we.source,be);xe.path=[...we.path],te.fire(xe,...t)}}function addEventListener$1(Te,we,t,te,be){we._addEventListener?we._addEventListener(t,te,be):Te._addEventListener.call(we,t,te,be)}function removeEventListener$1(Te,we,t,te){we._removeEventListener?we._removeEventListener(t,te):Te._removeEventListener.call(we,t,te)}const observablePropertiesSymbol=Symbol("observableProperties"),boundObservablesSymbol=Symbol("boundObservables"),boundPropertiesSymbol=Symbol("boundProperties"),decoratedMethods=Symbol("decoratedMethods"),decoratedOriginal=Symbol("decoratedOriginal"),defaultObservableClass=ObservableMixin(EmitterMixin());function ObservableMixin(Te){var t,te,be,xe;if(!Te)return defaultObservableClass;class we extends Te{constructor(){super(...arguments);Re(this,t);Re(this,te);Re(this,be);Re(this,xe)}set(Ie,Ae){if(isObject$2(Ie)){Object.keys(Ie).forEach(Oe=>{this.set(Oe,Ie[Oe])},this);return}initObservable(this);const Se=this[observablePropertiesSymbol];if(Ie in this&&!Se.has(Ie))throw new CKEditorError("observable-set-cannot-override",this);Object.defineProperty(this,Ie,{enumerable:!0,configurable:!0,get(){return Se.get(Ie)},set(Oe){const Ve=Se.get(Ie);let Me=this.fire(`set:${Ie}`,Ie,Oe,Ve);Me===void 0&&(Me=Oe),(Ve!==Me||!Se.has(Ie))&&(Se.set(Ie,Me),this.fire(`change:${Ie}`,Ie,Me,Ve))}}),this[Ie]=Ae}bind(...Ie){if(!Ie.length||!isStringArray$1(Ie))throw new CKEditorError("observable-bind-wrong-properties",this);if(new Set(Ie).size!==Ie.length)throw new CKEditorError("observable-bind-duplicate-properties",this);initObservable(this);const Ae=this[boundPropertiesSymbol];Ie.forEach(Oe=>{if(Ae.has(Oe))throw new CKEditorError("observable-bind-rebind",this)});const Se=new Map;return Ie.forEach(Oe=>{const Ve={property:Oe,to:[]};Ae.set(Oe,Ve),Se.set(Oe,Ve)}),{to:bindTo,toMany:bindToMany,_observable:this,_bindProperties:Ie,_to:[],_bindings:Se}}unbind(...Ie){if(!this[observablePropertiesSymbol])return;const Ae=this[boundPropertiesSymbol],Se=this[boundObservablesSymbol];if(Ie.length){if(!isStringArray$1(Ie))throw new CKEditorError("observable-unbind-wrong-properties",this);Ie.forEach(Oe=>{const Ve=Ae.get(Oe);Ve&&(Ve.to.forEach(([Me,De])=>{const Fe=Se.get(Me),Be=Fe[De];Be.delete(Ve),Be.size||delete Fe[De],Object.keys(Fe).length||(Se.delete(Me),this.stopListening(Me,"change"))}),Ae.delete(Oe))})}else Se.forEach((Oe,Ve)=>{this.stopListening(Ve,"change")}),Se.clear(),Ae.clear()}decorate(Ie){initObservable(this);const Ae=this[Ie];if(!Ae)throw new CKEditorError("observablemixin-cannot-decorate-undefined",this,{object:this,methodName:Ie});this.on(Ie,(Se,Oe)=>{Se.return=Ae.apply(this,Oe)}),this[Ie]=function(...Se){return this.fire(Ie,Se)},this[Ie][decoratedOriginal]=Ae,this[decoratedMethods]||(this[decoratedMethods]=[]),this[decoratedMethods].push(Ie)}stopListening(Ie,Ae,Se){if(!Ie&&this[decoratedMethods]){for(const Oe of this[decoratedMethods])this[Oe]=this[Oe][decoratedOriginal];delete this[decoratedMethods]}super.stopListening(Ie,Ae,Se)}}return t=observablePropertiesSymbol,te=decoratedMethods,be=boundPropertiesSymbol,xe=boundObservablesSymbol,we}["set","bind","unbind","decorate","on","once","off","listenTo","stopListening","fire","delegate","stopDelegating","_addEventListener","_removeEventListener"].forEach(Te=>{ObservableMixin[Te]=defaultObservableClass.prototype[Te]});function initObservable(Te){Te[observablePropertiesSymbol]||(Object.defineProperty(Te,observablePropertiesSymbol,{value:new Map}),Object.defineProperty(Te,boundObservablesSymbol,{value:new Map}),Object.defineProperty(Te,boundPropertiesSymbol,{value:new Map}))}function bindTo(...Te){const we=parseBindToArgs(...Te),t=Array.from(this._bindings.keys()),te=t.length;if(!we.callback&&we.to.length>1)throw new CKEditorError("observable-bind-to-no-callback",this);if(te>1&&we.callback)throw new CKEditorError("observable-bind-to-extra-callback",this);we.to.forEach(be=>{if(be.properties.length&&be.properties.length!==te)throw new CKEditorError("observable-bind-to-properties-length",this);be.properties.length||(be.properties=this._bindProperties)}),this._to=we.to,we.callback&&(this._bindings.get(t[0]).callback=we.callback),attachBindToListeners(this._observable,this._to),updateBindToBound(this),this._bindProperties.forEach(be=>{updateBoundObservableProperty(this._observable,be)})}function bindToMany(Te,we,t){if(this._bindings.size>1)throw new CKEditorError("observable-bind-to-many-not-one-binding",this);this.to(...getBindingTargets(Te,we),t)}function getBindingTargets(Te,we){const t=Te.map(te=>[te,we]);return Array.prototype.concat.apply([],t)}function isStringArray$1(Te){return Te.every(we=>typeof we=="string")}function parseBindToArgs(...Te){if(!Te.length)throw new CKEditorError("observable-bind-to-parse-error",null);const we={to:[]};let t;return typeof Te[Te.length-1]=="function"&&(we.callback=Te.pop()),Te.forEach(te=>{if(typeof te=="string")t.properties.push(te);else if(typeof te=="object")t={observable:te,properties:[]},we.to.push(t);else throw new CKEditorError("observable-bind-to-parse-error",null)}),we}function updateBoundObservables(Te,we,t,te){const be=Te[boundObservablesSymbol],xe=be.get(t),ve=xe||{};ve[te]||(ve[te]=new Set),ve[te].add(we),xe||be.set(t,ve)}function updateBindToBound(Te){let we;Te._bindings.forEach((t,te)=>{Te._to.forEach(be=>{we=be.properties[t.callback?0:Te._bindProperties.indexOf(te)],t.to.push([be.observable,we]),updateBoundObservables(Te._observable,t,be.observable,we)})})}function updateBoundObservableProperty(Te,we){const te=Te[boundPropertiesSymbol].get(we);let be;te.callback?be=te.callback.apply(Te,te.to.map(xe=>xe[0][xe[1]])):(be=te.to[0],be=be[0][be[1]]),Object.prototype.hasOwnProperty.call(Te,we)?Te[we]=be:Te.set(we,be)}function attachBindToListeners(Te,we){we.forEach(t=>{const te=Te[boundObservablesSymbol];let be;te.get(t.observable)||Te.listenTo(t.observable,"change",(xe,ve)=>{be=te.get(t.observable)[ve],be&&be.forEach(ke=>{updateBoundObservableProperty(Te,ke.property)})})})}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class ElementReplacer{constructor(){Re(this,"_replacedElements");this._replacedElements=[]}replace(we,t){this._replacedElements.push({element:we,newElement:t}),we.style.display="none",t&&we.parentNode.insertBefore(t,we.nextSibling)}restore(){this._replacedElements.forEach(({element:we,newElement:t})=>{we.style.display="",t&&t.remove()}),this._replacedElements=[]}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function abortableDebounce(Te){let we=new AbortController;function t(...te){return we.abort(),we=new AbortController,Te(we.signal,...te)}return t.abort=()=>we.abort(),t}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function count(Te){let we=0;for(const t of Te)we++;return we}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function compareArrays(Te,we){const t=Math.min(Te.length,we.length);for(let te=0;te<t;te++)if(Te[te]!=we[te])return te;return Te.length==we.length?"same":Te.length<we.length?"prefix":"extension"}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function isIterable(Te){return!!(Te&&Te[Symbol.iterator])}function createElement(Te,we,t={},te=[]){const be=t&&t.xmlns,xe=be?Te.createElementNS(be,we):Te.createElement(we);for(const ve in t)xe.setAttribute(ve,t[ve]);(isString$1(te)||!isIterable(te))&&(te=[te]);for(let ve of te)isString$1(ve)&&(ve=Te.createTextNode(ve)),xe.appendChild(ve);return xe}class Config{constructor(we,t){Re(this,"_config");this._config={},t&&this.define(cloneConfig(t)),we&&this._setObjectToTarget(this._config,we)}set(we,t){this._setToTarget(this._config,we,t)}define(we,t){this._setToTarget(this._config,we,t,!0)}get(we){return this._getFromSource(this._config,we)}*names(){for(const we of Object.keys(this._config))yield we}_setToTarget(we,t,te,be=!1){if(isPlainObject(t)){this._setObjectToTarget(we,t,be);return}const xe=t.split(".");t=xe.pop();for(const ve of xe)isPlainObject(we[ve])||(we[ve]={}),we=we[ve];if(isPlainObject(te)){isPlainObject(we[t])||(we[t]={}),we=we[t],this._setObjectToTarget(we,te,be);return}be&&typeof we[t]<"u"||(we[t]=te)}_getFromSource(we,t){const te=t.split(".");t=te.pop();for(const be of te){if(!isPlainObject(we[be])){we=null;break}we=we[be]}return we?cloneConfig(we[t]):void 0}_setObjectToTarget(we,t,te){Object.keys(t).forEach(be=>{this._setToTarget(we,be,t[be],te)})}}function cloneConfig(Te){return cloneDeepWith(Te,leaveItemReferences)}function leaveItemReferences(Te){return isElement$1(Te)||typeof Te=="function"?Te:void 0}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function isNode(Te){if(Te){if(Te.defaultView)return Te instanceof Te.defaultView.Document;if(Te.ownerDocument&&Te.ownerDocument.defaultView)return Te instanceof Te.ownerDocument.defaultView.Node}return!1}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function isWindow(Te){const we=Object.prototype.toString.apply(Te);return we=="[object Window]"||we=="[object global]"}const defaultEmitterClass=DomEmitterMixin(EmitterMixin());function DomEmitterMixin(Te){if(!Te)return defaultEmitterClass;class we extends Te{listenTo(te,be,xe,ve={}){if(isNode(te)||isWindow(te)){const ke={capture:!!ve.useCapture,passive:!!ve.usePassive},Ie=this._getProxyEmitter(te,ke)||new ProxyEmitter(te,ke);this.listenTo(Ie,be,xe,ve)}else super.listenTo(te,be,xe,ve)}stopListening(te,be,xe){if(isNode(te)||isWindow(te)){const ve=this._getAllProxyEmitters(te);for(const ke of ve)this.stopListening(ke,be,xe)}else super.stopListening(te,be,xe)}_getProxyEmitter(te,be){return _getEmitterListenedTo(this,getProxyEmitterId(te,be))}_getAllProxyEmitters(te){return[{capture:!1,passive:!1},{capture:!1,passive:!0},{capture:!0,passive:!1},{capture:!0,passive:!0}].map(be=>this._getProxyEmitter(te,be)).filter(be=>!!be)}}return we}["_getProxyEmitter","_getAllProxyEmitters","on","once","off","listenTo","stopListening","fire","delegate","stopDelegating","_addEventListener","_removeEventListener"].forEach(Te=>{DomEmitterMixin[Te]=defaultEmitterClass.prototype[Te]});class ProxyEmitter extends EmitterMixin(){constructor(t,te){super();Re(this,"_domNode");Re(this,"_options");Re(this,"_domListeners");_setEmitterId(this,getProxyEmitterId(t,te)),this._domNode=t,this._options=te}attach(t){if(this._domListeners&&this._domListeners[t])return;const te=this._createDomListener(t);this._domNode.addEventListener(t,te,this._options),this._domListeners||(this._domListeners={}),this._domListeners[t]=te}detach(t){let te;this._domListeners[t]&&(!(te=this._events[t])||!te.callbacks.length)&&this._domListeners[t].removeListener()}_addEventListener(t,te,be){this.attach(t),EmitterMixin().prototype._addEventListener.call(this,t,te,be)}_removeEventListener(t,te){EmitterMixin().prototype._removeEventListener.call(this,t,te),this.detach(t)}_createDomListener(t){const te=be=>{this.fire(t,be)};return te.removeListener=()=>{this._domNode.removeEventListener(t,te,this._options),delete this._domListeners[t]},te}}function getNodeUID(Te){return Te["data-ck-expando"]||(Te["data-ck-expando"]=uid())}function getProxyEmitterId(Te,we){let t=getNodeUID(Te);for(const te of Object.keys(we).sort())we[te]&&(t+="-"+te);return t}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function getAncestors(Te){const we=[];let t=Te;for(;t&&t.nodeType!=Node.DOCUMENT_NODE;)we.unshift(t),t=t.parentNode;return we}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function getDataFromElement(Te){return Te instanceof HTMLTextAreaElement?Te.value:Te.innerHTML}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function getBorderWidths(Te){const we=Te.ownerDocument.defaultView.getComputedStyle(Te);return{top:parseInt(we.borderTopWidth,10),right:parseInt(we.borderRightWidth,10),bottom:parseInt(we.borderBottomWidth,10),left:parseInt(we.borderLeftWidth,10)}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function isText(Te){return Object.prototype.toString.call(Te)=="[object Text]"}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function isRange(Te){return Object.prototype.toString.apply(Te)=="[object Range]"}function getPositionedAncestor(Te){return!Te||!Te.parentNode||Te.offsetParent===global.document.body?null:Te.offsetParent}const rectProperties=["top","right","bottom","left","width","height"];class Rect{constructor(we){Re(this,"top");Re(this,"right");Re(this,"bottom");Re(this,"left");Re(this,"width");Re(this,"height");Re(this,"_source");const t=isRange(we);if(Object.defineProperty(this,"_source",{value:we._source||we,writable:!0,enumerable:!1}),isDomElement(we)||t)if(t){const te=Rect.getDomRangeRects(we);copyRectProperties(this,Rect.getBoundingRect(te))}else copyRectProperties(this,we.getBoundingClientRect());else if(isWindow(we)){const{innerWidth:te,innerHeight:be}=we;copyRectProperties(this,{top:0,right:te,bottom:be,left:0,width:te,height:be})}else copyRectProperties(this,we)}clone(){return new Rect(this)}moveTo(we,t){return this.top=t,this.right=we+this.width,this.bottom=t+this.height,this.left=we,this}moveBy(we,t){return this.top+=t,this.right+=we,this.left+=we,this.bottom+=t,this}getIntersection(we){const t={top:Math.max(this.top,we.top),right:Math.min(this.right,we.right),bottom:Math.min(this.bottom,we.bottom),left:Math.max(this.left,we.left),width:0,height:0};if(t.width=t.right-t.left,t.height=t.bottom-t.top,t.width<0||t.height<0)return null;{const te=new Rect(t);return te._source=this._source,te}}getIntersectionArea(we){const t=this.getIntersection(we);return t?t.getArea():0}getArea(){return this.width*this.height}getVisible(){const we=this._source;let t=this.clone();if(isBody(we))return t;let te=we,be=we.parentNode||we.commonAncestorContainer,xe;for(;be&&!isBody(be);){const ve=getElementOverflow(be)==="visible";te instanceof HTMLElement&&getElementPosition(te)==="absolute"&&(xe=te);const ke=getElementPosition(be);if(ve||xe&&(ke==="relative"&&ve||ke!=="relative")){te=be,be=be.parentNode;continue}const Ie=new Rect(be),Ae=t.getIntersection(Ie);if(Ae)Ae.getArea()<t.getArea()&&(t=Ae);else return null;te=be,be=be.parentNode}return t}isEqual(we){for(const t of rectProperties)if(this[t]!==we[t])return!1;return!0}contains(we){const t=this.getIntersection(we);return!!(t&&t.isEqual(we))}toAbsoluteRect(){const{scrollX:we,scrollY:t}=global.window,te=this.clone().moveBy(we,t);if(isDomElement(te._source)){const be=getPositionedAncestor(te._source);be&&shiftRectToCompensatePositionedAncestor(te,be)}return te}excludeScrollbarsAndBorders(){const we=this._source;let t,te,be;if(isWindow(we))t=we.innerWidth-we.document.documentElement.clientWidth,te=we.innerHeight-we.document.documentElement.clientHeight,be=we.getComputedStyle(we.document.documentElement).direction;else{const xe=getBorderWidths(we);t=we.offsetWidth-we.clientWidth-xe.left-xe.right,te=we.offsetHeight-we.clientHeight-xe.top-xe.bottom,be=we.ownerDocument.defaultView.getComputedStyle(we).direction,this.left+=xe.left,this.top+=xe.top,this.right-=xe.right,this.bottom-=xe.bottom,this.width=this.right-this.left,this.height=this.bottom-this.top}return this.width-=t,be==="ltr"?this.right-=t:this.left+=t,this.height-=te,this.bottom-=te,this}static getDomRangeRects(we){const t=[],te=Array.from(we.getClientRects());if(te.length)for(const be of te)t.push(new Rect(be));else{let be=we.startContainer;isText(be)&&(be=be.parentNode);const xe=new Rect(be.getBoundingClientRect());xe.right=xe.left,xe.width=0,t.push(xe)}return t}static getBoundingRect(we){const t={left:Number.POSITIVE_INFINITY,top:Number.POSITIVE_INFINITY,right:Number.NEGATIVE_INFINITY,bottom:Number.NEGATIVE_INFINITY,width:0,height:0};let te=0;for(const be of we)te++,t.left=Math.min(t.left,be.left),t.top=Math.min(t.top,be.top),t.right=Math.max(t.right,be.right),t.bottom=Math.max(t.bottom,be.bottom);return te==0?null:(t.width=t.right-t.left,t.height=t.bottom-t.top,new Rect(t))}}function copyRectProperties(Te,we){for(const t of rectProperties)Te[t]=we[t]}function isBody(Te){return isDomElement(Te)?Te===Te.ownerDocument.body:!1}function isDomElement(Te){return Te!==null&&typeof Te=="object"&&Te.nodeType===1&&typeof Te.getBoundingClientRect=="function"}function getElementPosition(Te){return Te instanceof HTMLElement?Te.ownerDocument.defaultView.getComputedStyle(Te).position:"static"}function getElementOverflow(Te){return Te instanceof HTMLElement?Te.ownerDocument.defaultView.getComputedStyle(Te).overflow:"visible"}function shiftRectToCompensatePositionedAncestor(Te,we){const t=new Rect(we),te=getBorderWidths(we);let be=0,xe=0;be-=t.left,xe-=t.top,be+=we.scrollLeft,xe+=we.scrollTop,be-=te.left,xe-=te.top,Te.moveBy(be,xe)}const yn=class yn{constructor(we,t){Re(this,"_element");Re(this,"_callback");yn._observerInstance||yn._createObserver(),this._element=we,this._callback=t,yn._addElementCallback(we,t),yn._observerInstance.observe(we)}get element(){return this._element}destroy(){yn._deleteElementCallback(this._element,this._callback)}static _addElementCallback(we,t){yn._elementCallbacks||(yn._elementCallbacks=new Map);let te=yn._elementCallbacks.get(we);te||(te=new Set,yn._elementCallbacks.set(we,te)),te.add(t)}static _deleteElementCallback(we,t){const te=yn._getElementCallbacks(we);te&&(te.delete(t),te.size||(yn._elementCallbacks.delete(we),yn._observerInstance.unobserve(we))),yn._elementCallbacks&&!yn._elementCallbacks.size&&(yn._observerInstance=null,yn._elementCallbacks=null)}static _getElementCallbacks(we){return yn._elementCallbacks?yn._elementCallbacks.get(we):null}static _createObserver(){yn._observerInstance=new global.window.ResizeObserver(we=>{for(const t of we){const te=yn._getElementCallbacks(t.target);if(te)for(const be of te)be(t)}})}};Re(yn,"_observerInstance",null),Re(yn,"_elementCallbacks",null);let ResizeObserver=yn;/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function setDataInElement(Te,we){Te instanceof HTMLTextAreaElement&&(Te.value=we),Te.innerHTML=we}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function toUnit(Te){return we=>we+Te}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function indexOf(Te){let we=0;for(;Te.previousSibling;)Te=Te.previousSibling,we++;return we}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function insertAt(Te,we,t){Te.insertBefore(t,Te.childNodes[we]||null)}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function isComment(Te){return Te&&Te.nodeType===Node.COMMENT_NODE}function isValidAttributeName(Te){try{global.document.createAttribute(Te)}catch{return!1}return!0}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function isVisible(Te){return!!(Te&&Te.getClientRects&&Te.getClientRects().length)}function getOptimalPosition({element:Te,target:we,positions:t,limiter:te,fitInViewport:be,viewportOffsetConfig:xe}){isFunction(we)&&(we=we()),isFunction(te)&&(te=te());const ve=getPositionedAncestor(Te),ke=getConstrainedViewportRect$1(xe),Ie=new Rect(Te),Ae=getVisibleViewportIntersectionRect(we,ke);let Se;if(!Ae||!ke.getIntersection(Ae))return null;const Oe={targetRect:Ae,elementRect:Ie,positionedElementAncestor:ve,viewportRect:ke};if(!te&&!be)Se=new PositionObject(t[0],Oe);else{if(te){const Ve=getVisibleViewportIntersectionRect(te,ke);Ve&&(Oe.limiterRect=Ve)}Se=getBestPosition(t,Oe)}return Se}function getVisibleViewportIntersectionRect(Te,we){const t=new Rect(Te).getVisible();return t?t.getIntersection(we):null}function getConstrainedViewportRect$1(Te){Te=Object.assign({top:0,bottom:0,left:0,right:0},Te);const we=new Rect(global.window);return we.top+=Te.top,we.height-=Te.top,we.bottom-=Te.bottom,we.height-=Te.bottom,we}function getBestPosition(Te,we){const{elementRect:t}=we,te=t.getArea(),be=Te.map(ke=>new PositionObject(ke,we)).filter(ke=>!!ke.name);let xe=0,ve=null;for(const ke of be){const{limiterIntersectionArea:Ie,viewportIntersectionArea:Ae}=ke;if(Ie===te)return ke;const Se=Ae**2+Ie**2;Se>xe&&(xe=Se,ve=ke)}return ve}class PositionObject{constructor(we,t){Re(this,"name");Re(this,"config");Re(this,"_positioningFunctionCoordinates");Re(this,"_options");Re(this,"_cachedRect");Re(this,"_cachedAbsoluteRect");const te=we(t.targetRect,t.elementRect,t.viewportRect,t.limiterRect);if(!te)return;const{left:be,top:xe,name:ve,config:ke}=te;this.name=ve,this.config=ke,this._positioningFunctionCoordinates={left:be,top:xe},this._options=t}get left(){return this._absoluteRect.left}get top(){return this._absoluteRect.top}get limiterIntersectionArea(){const we=this._options.limiterRect;return we?we.getIntersectionArea(this._rect):0}get viewportIntersectionArea(){return this._options.viewportRect.getIntersectionArea(this._rect)}get _rect(){return this._cachedRect?this._cachedRect:(this._cachedRect=this._options.elementRect.clone().moveTo(this._positioningFunctionCoordinates.left,this._positioningFunctionCoordinates.top),this._cachedRect)}get _absoluteRect(){return this._cachedAbsoluteRect?this._cachedAbsoluteRect:(this._cachedAbsoluteRect=this._rect.toAbsoluteRect(),this._cachedAbsoluteRect)}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function remove$1(Te){const we=Te.parentNode;we&&we.removeChild(Te)}function scrollViewportToShowTarget({target:Te,viewportOffset:we=0,ancestorOffset:t=0,alignToTop:te,forceScroll:be}){const xe=getWindow(Te);let ve=xe,ke=null;for(we=normalizeViewportOffset(we);ve;){let Ie;ve==xe?Ie=getParentElement(Te):Ie=getParentElement(ke),scrollAncestorsToShowRect({parent:Ie,getRect:()=>getRectRelativeToWindow(Te,ve),alignToTop:te,ancestorOffset:t,forceScroll:be});const Ae=getRectRelativeToWindow(Te,ve);if(scrollWindowToShowRect({window:ve,rect:Ae,viewportOffset:we,alignToTop:te,forceScroll:be}),ve.parent!=ve){if(ke=ve.frameElement,ve=ve.parent,!ke)return}else ve=null}}function scrollAncestorsToShowTarget(Te,we,t){const te=getParentElement(Te);scrollAncestorsToShowRect({parent:te,getRect:()=>new Rect(Te),ancestorOffset:we,limiterElement:t})}function scrollWindowToShowRect({window:Te,rect:we,alignToTop:t,forceScroll:te,viewportOffset:be}){const xe=we.clone().moveBy(0,be.bottom),ve=we.clone().moveBy(0,-be.top),ke=new Rect(Te).excludeScrollbarsAndBorders(),Ie=[ve,xe],Ae=t&&te,Se=Ie.every(Fe=>ke.contains(Fe));let{scrollX:Oe,scrollY:Ve}=Te;const Me=Oe,De=Ve;Ae?Ve-=ke.top-we.top+be.top:Se||(isAbove(ve,ke)?Ve-=ke.top-we.top+be.top:isBelow(xe,ke)&&(t?Ve+=we.top-ke.top-be.top:Ve+=we.bottom-ke.bottom+be.bottom)),Se||(isLeftOf(we,ke)?Oe-=ke.left-we.left+be.left:isRightOf(we,ke)&&(Oe+=we.right-ke.right+be.right)),(Oe!=Me||Ve!==De)&&Te.scrollTo(Oe,Ve)}function scrollAncestorsToShowRect({parent:Te,getRect:we,alignToTop:t,forceScroll:te,ancestorOffset:be=0,limiterElement:xe}){const ve=getWindow(Te),ke=t&&te;let Ie,Ae,Se;const Oe=xe||ve.document.body;for(;Te!=Oe;)Ae=we(),Ie=new Rect(Te).excludeScrollbarsAndBorders(),Se=Ie.contains(Ae),ke?Te.scrollTop-=Ie.top-Ae.top+be:Se||(isAbove(Ae,Ie)?Te.scrollTop-=Ie.top-Ae.top+be:isBelow(Ae,Ie)&&(t?Te.scrollTop+=Ae.top-Ie.top-be:Te.scrollTop+=Ae.bottom-Ie.bottom+be)),Se||(isLeftOf(Ae,Ie)?Te.scrollLeft-=Ie.left-Ae.left+be:isRightOf(Ae,Ie)&&(Te.scrollLeft+=Ae.right-Ie.right+be)),Te=Te.parentNode}function isBelow(Te,we){return Te.bottom>we.bottom}function isAbove(Te,we){return Te.top<we.top}function isLeftOf(Te,we){return Te.left<we.left}function isRightOf(Te,we){return Te.right>we.right}function getWindow(Te){return isRange(Te)?Te.startContainer.ownerDocument.defaultView:Te.ownerDocument.defaultView}function getParentElement(Te){if(isRange(Te)){let we=Te.commonAncestorContainer;return isText(we)&&(we=we.parentNode),we}else return Te.parentNode}function getRectRelativeToWindow(Te,we){const t=getWindow(Te),te=new Rect(Te);if(t===we)return te;{let be=t;for(;be!=we;){const xe=be.frameElement,ve=new Rect(xe).excludeScrollbarsAndBorders();te.moveBy(ve.left,ve.top),be=be.parent}}return te}function normalizeViewportOffset(Te){return typeof Te=="number"?{top:Te,bottom:Te,left:Te,right:Te}:Te}const modifiersToGlyphsMac={ctrl:"⌃",cmd:"⌘",alt:"⌥",shift:"⇧"},modifiersToGlyphsNonMac={ctrl:"Ctrl+",alt:"Alt+",shift:"Shift+"},keyCodesToGlyphs={37:"←",38:"↑",39:"→",40:"↓",9:"⇥",33:"Page Up",34:"Page Down"},keyCodes=generateKnownKeyCodes(),keyCodeNames=Object.fromEntries(Object.entries(keyCodes).map(([Te,we])=>{let t;return we in keyCodesToGlyphs?t=keyCodesToGlyphs[we]:t=Te.charAt(0).toUpperCase()+Te.slice(1),[we,t]}));function getCode(Te){let we;if(typeof Te=="string"){if(we=keyCodes[Te.toLowerCase()],!we)throw new CKEditorError("keyboard-unknown-key",null,{key:Te})}else we=Te.keyCode+(Te.altKey?keyCodes.alt:0)+(Te.ctrlKey?keyCodes.ctrl:0)+(Te.shiftKey?keyCodes.shift:0)+(Te.metaKey?keyCodes.cmd:0);return we}function parseKeystroke(Te){return typeof Te=="string"&&(Te=splitKeystrokeText(Te)),Te.map(we=>typeof we=="string"?getEnvKeyCode(we):we).reduce((we,t)=>t+we,0)}function getEnvKeystrokeText(Te){let we=parseKeystroke(Te);return Object.entries(env.isMac||env.isiOS?modifiersToGlyphsMac:modifiersToGlyphsNonMac).reduce((be,[xe,ve])=>(we&keyCodes[xe]&&(we&=~keyCodes[xe],be+=ve),be),"")+(we?keyCodeNames[we]:"")}function isArrowKeyCode(Te){return Te==keyCodes.arrowright||Te==keyCodes.arrowleft||Te==keyCodes.arrowup||Te==keyCodes.arrowdown}function getLocalizedArrowKeyCodeDirection(Te,we){const t=we==="ltr";switch(Te){case keyCodes.arrowleft:return t?"left":"right";case keyCodes.arrowright:return t?"right":"left";case keyCodes.arrowup:return"up";case keyCodes.arrowdown:return"down"}}function getEnvKeyCode(Te){if(Te.endsWith("!"))return getCode(Te.slice(0,-1));const we=getCode(Te);return(env.isMac||env.isiOS)&&we==keyCodes.ctrl?keyCodes.cmd:we}function isForwardArrowKeyCode(Te,we){const t=getLocalizedArrowKeyCodeDirection(Te,we);return t==="down"||t==="right"}function generateKnownKeyCodes(){const Te={pageup:33,pagedown:34,arrowleft:37,arrowup:38,arrowright:39,arrowdown:40,backspace:8,delete:46,enter:13,space:32,esc:27,tab:9,ctrl:1114112,shift:2228224,alt:4456448,cmd:8912896};for(let we=65;we<=90;we++){const t=String.fromCharCode(we);Te[t.toLowerCase()]=we}for(let we=48;we<=57;we++)Te[we-48]=we;for(let we=112;we<=123;we++)Te["f"+(we-111)]=we;return Object.assign(Te,{"'":222,",":108,"-":109,".":110,"/":111,";":186,"=":187,"[":219,"\\":220,"]":221,"`":223}),Te}function splitKeystrokeText(Te){return Te.split("+").map(we=>we.trim())}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const RTL_LANGUAGE_CODES=["ar","ara","dv","div","fa","per","fas","he","heb","ku","kur","ug","uig"];function getLanguageDirection(Te){return RTL_LANGUAGE_CODES.includes(Te)?"rtl":"ltr"}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function toArray$2(Te){return Array.isArray(Te)?Te:[Te]}/* istanbul ignore else -- @preserve */global.window.CKEDITOR_TRANSLATIONS||(global.window.CKEDITOR_TRANSLATIONS={});function _translate(Te,we,t=1,te){if(typeof t!="number")throw new CKEditorError("translation-service-quantity-not-a-number",null,{quantity:t});const be=te||global.window.CKEDITOR_TRANSLATIONS,xe=getNumberOfLanguages(be);xe===1&&(Te=Object.keys(be)[0]);const ve=we.id||we.string;if(xe===0||!hasTranslation(Te,ve,be))return t!==1?we.plural:we.string;const ke=be[Te].dictionary,Ie=be[Te].getPluralForm||(Oe=>Oe===1?0:1),Ae=ke[ve];if(typeof Ae=="string")return Ae;const Se=Number(Ie(t));return Ae[Se]}function _unifyTranslations(Te){return Array.isArray(Te)?Te.reduce((we,t)=>merge$1(we,t)):Te}function hasTranslation(Te,we,t){return!!t[Te]&&!!t[Te].dictionary[we]}function getNumberOfLanguages(Te){return Object.keys(Te).length}let Locale$1=class{constructor({uiLanguage:we="en",contentLanguage:t,translations:te}={}){Re(this,"uiLanguage");Re(this,"uiLanguageDirection");Re(this,"contentLanguage");Re(this,"contentLanguageDirection");Re(this,"t");Re(this,"translations");this.uiLanguage=we,this.contentLanguage=t||this.uiLanguage,this.uiLanguageDirection=getLanguageDirection(this.uiLanguage),this.contentLanguageDirection=getLanguageDirection(this.contentLanguage),this.translations=_unifyTranslations(te),this.t=(be,xe)=>this._t(be,xe)}get language(){return console.warn("locale-deprecated-language-property: The Locale#language property has been deprecated and will be removed in the near future. Please use #uiLanguage and #contentLanguage properties instead."),this.uiLanguage}_t(we,t=[]){t=toArray$2(t),typeof we=="string"&&(we={string:we});const be=!!we.plural?t[0]:1,xe=_translate(this.uiLanguage,we,be,this.translations);return interpolateString(xe,t)}};function interpolateString(Te,we){return Te.replace(/%(\d+)/g,(t,te)=>te<we.length?we[te]:t)}class Collection extends EmitterMixin(){constructor(t={},te={}){super();Re(this,"_items");Re(this,"_itemMap");Re(this,"_idProperty");Re(this,"_bindToCollection");Re(this,"_bindToExternalToInternalMap");Re(this,"_bindToInternalToExternalMap");Re(this,"_skippedIndexesFromExternal");const be=isIterable(t);if(be||(te=t),this._items=[],this._itemMap=new Map,this._idProperty=te.idProperty||"id",this._bindToExternalToInternalMap=new WeakMap,this._bindToInternalToExternalMap=new WeakMap,this._skippedIndexesFromExternal=[],be)for(const xe of t)this._items.push(xe),this._itemMap.set(this._getItemIdBeforeAdding(xe),xe)}get length(){return this._items.length}get first(){return this._items[0]||null}get last(){return this._items[this.length-1]||null}add(t,te){return this.addMany([t],te)}addMany(t,te){if(te===void 0)te=this._items.length;else if(te>this._items.length||te<0)throw new CKEditorError("collection-add-item-invalid-index",this);let be=0;for(const xe of t){const ve=this._getItemIdBeforeAdding(xe),ke=te+be;this._items.splice(ke,0,xe),this._itemMap.set(ve,xe),this.fire("add",xe,ke),be++}return this.fire("change",{added:t,removed:[],index:te}),this}get(t){let te;if(typeof t=="string")te=this._itemMap.get(t);else if(typeof t=="number")te=this._items[t];else throw new CKEditorError("collection-get-invalid-arg",this);return te||null}has(t){if(typeof t=="string")return this._itemMap.has(t);{const te=this._idProperty,be=t[te];return be&&this._itemMap.has(be)}}getIndex(t){let te;return typeof t=="string"?te=this._itemMap.get(t):te=t,te?this._items.indexOf(te):-1}remove(t){const[te,be]=this._remove(t);return this.fire("change",{added:[],removed:[te],index:be}),te}map(t,te){return this._items.map(t,te)}forEach(t,te){this._items.forEach(t,te)}find(t,te){return this._items.find(t,te)}filter(t,te){return this._items.filter(t,te)}clear(){this._bindToCollection&&(this.stopListening(this._bindToCollection),this._bindToCollection=null);const t=Array.from(this._items);for(;this.length;)this._remove(0);this.fire("change",{added:[],removed:t,index:0})}bindTo(t){if(this._bindToCollection)throw new CKEditorError("collection-bind-to-rebind",this);return this._bindToCollection=t,{as:te=>{this._setUpBindToBinding(be=>new te(be))},using:te=>{typeof te=="function"?this._setUpBindToBinding(te):this._setUpBindToBinding(be=>be[te])}}}_setUpBindToBinding(t){const te=this._bindToCollection,be=(xe,ve,ke)=>{const Ie=te._bindToCollection==this,Ae=te._bindToInternalToExternalMap.get(ve);if(Ie&&Ae)this._bindToExternalToInternalMap.set(ve,Ae),this._bindToInternalToExternalMap.set(Ae,ve);else{const Se=t(ve);if(!Se){this._skippedIndexesFromExternal.push(ke);return}let Oe=ke;for(const Ve of this._skippedIndexesFromExternal)ke>Ve&&Oe--;for(const Ve of te._skippedIndexesFromExternal)Oe>=Ve&&Oe++;this._bindToExternalToInternalMap.set(ve,Se),this._bindToInternalToExternalMap.set(Se,ve),this.add(Se,Oe);for(let Ve=0;Ve<te._skippedIndexesFromExternal.length;Ve++)Oe<=te._skippedIndexesFromExternal[Ve]&&te._skippedIndexesFromExternal[Ve]++}};for(const xe of te)be(null,xe,te.getIndex(xe));this.listenTo(te,"add",be),this.listenTo(te,"remove",(xe,ve,ke)=>{const Ie=this._bindToExternalToInternalMap.get(ve);Ie&&this.remove(Ie),this._skippedIndexesFromExternal=this._skippedIndexesFromExternal.reduce((Ae,Se)=>(ke<Se&&Ae.push(Se-1),ke>Se&&Ae.push(Se),Ae),[])})}_getItemIdBeforeAdding(t){const te=this._idProperty;let be;if(te in t){if(be=t[te],typeof be!="string")throw new CKEditorError("collection-add-invalid-id",this);if(this.get(be))throw new CKEditorError("collection-add-item-already-exists",this)}else t[te]=be=uid();return be}_remove(t){let te,be,xe,ve=!1;const ke=this._idProperty;if(typeof t=="string"?(be=t,xe=this._itemMap.get(be),ve=!xe,xe&&(te=this._items.indexOf(xe))):typeof t=="number"?(te=t,xe=this._items[te],ve=!xe,xe&&(be=xe[ke])):(xe=t,be=xe[ke],te=this._items.indexOf(xe),ve=te==-1||!this._itemMap.get(be)),ve)throw new CKEditorError("collection-remove-404",this);this._items.splice(te,1),this._itemMap.delete(be);const Ie=this._bindToInternalToExternalMap.get(xe);return this._bindToInternalToExternalMap.delete(xe),this._bindToExternalToInternalMap.delete(Ie),this.fire("remove",xe,te),[xe,te]}[Symbol.iterator](){return this._items[Symbol.iterator]()}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function first(Te){const we=Te.next();return we.done?null:we.value}class FocusTracker extends DomEmitterMixin(ObservableMixin()){constructor(){super();Re(this,"_elements",new Set);Re(this,"_nextEventLoopTimeout",null);this.set("isFocused",!1),this.set("focusedElement",null)}add(t){if(this._elements.has(t))throw new CKEditorError("focustracker-add-element-already-exist",this);this.listenTo(t,"focus",()=>this._focus(t),{useCapture:!0}),this.listenTo(t,"blur",()=>this._blur(),{useCapture:!0}),this._elements.add(t)}remove(t){t===this.focusedElement&&this._blur(),this._elements.has(t)&&(this.stopListening(t),this._elements.delete(t))}destroy(){this.stopListening()}_focus(t){clearTimeout(this._nextEventLoopTimeout),this.focusedElement=t,this.isFocused=!0}_blur(){clearTimeout(this._nextEventLoopTimeout),this._nextEventLoopTimeout=setTimeout(()=>{this.focusedElement=null,this.isFocused=!1},0)}}class KeystrokeHandler{constructor(){Re(this,"_listener");this._listener=new(DomEmitterMixin())}listenTo(we){this._listener.listenTo(we,"keydown",(t,te)=>{this._listener.fire("_keydown:"+getCode(te),te)})}set(we,t,te={}){const be=parseKeystroke(we),xe=te.priority;this._listener.listenTo(this._listener,"_keydown:"+be,(ve,ke)=>{t(ke,()=>{ke.preventDefault(),ke.stopPropagation(),ve.stop()}),ve.return=!0},{priority:xe})}press(we){return!!this._listener.fire("_keydown:"+getCode(we),we)}stopListening(we){this._listener.stopListening(we)}destroy(){this.stopListening()}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function objectToMap(Te){const we=new Map;for(const t in Te)we.set(t,Te[t]);return we}function toMap(Te){return isIterable(Te)?new Map(Te):objectToMap(Te)}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function wait(Te,we={}){return new Promise((t,te)=>{const be=we.signal||new AbortController().signal;be.throwIfAborted();const xe=setTimeout(ve,Te);be.addEventListener("abort",ke,{once:!0});function ve(){be.removeEventListener("abort",ke),t()}function ke(){clearTimeout(xe),te(be.reason)}})}async function retry(Te,we={}){const{maxAttempts:t=4,retryDelay:te=exponentialDelay(),signal:be=new AbortController().signal}=we;be.throwIfAborted();for(let xe=0;;xe++){try{return await Te()}catch(ve){if(xe+1>=t)throw ve}await wait(te(xe),{signal:be})}}function exponentialDelay(Te={}){const{delay:we=1e3,factor:t=2,maxDelay:te=1e4}=Te;return be=>Math.min(t**be*we,te)}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const BIG_CHUNK_SIZE=1e4;function spliceArray(Te,we,t,te){if(Math.max(we.length,Te.length)>BIG_CHUNK_SIZE)return Te.slice(0,t).concat(we).concat(Te.slice(t+te,Te.length));{const be=Array.from(Te);return be.splice(t,te,...we),be}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function delay(Te,we){let t;function te(...be){te.cancel(),t=setTimeout(()=>Te(...be),we)}return te.cancel=()=>{clearTimeout(t)},te}function verifyLicense(Te){function we(Oe){return Oe.length>=40&&Oe.length<=255?"VALID":"INVALID"}if(!Te)return"INVALID";let t="";try{t=atob(Te)}catch{return"INVALID"}const te=t.split("-"),be=te[0],xe=te[1];if(!xe)return we(Te);try{atob(xe)}catch{try{if(atob(be),!atob(be).length)return we(Te)}catch{return we(Te)}}if(be.length<40||be.length>255)return"INVALID";let ve="";try{atob(be),ve=atob(xe)}catch{return"INVALID"}if(ve.length!==8)return"INVALID";const ke=Number(ve.substring(0,4)),Ie=Number(ve.substring(4,6))-1,Ae=Number(ve.substring(6,8)),Se=new Date(ke,Ie,Ae);return Se<releaseDate||isNaN(Number(Se))?"INVALID":"VALID"}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function isCombiningMark(Te){return!!Te&&Te.length==1&&/[\u0300-\u036f\u1ab0-\u1aff\u1dc0-\u1dff\u20d0-\u20ff\ufe20-\ufe2f]/.test(Te)}function isHighSurrogateHalf(Te){return!!Te&&Te.length==1&&/[\ud800-\udbff]/.test(Te)}function isLowSurrogateHalf(Te){return!!Te&&Te.length==1&&/[\udc00-\udfff]/.test(Te)}function isInsideSurrogatePair(Te,we){return isHighSurrogateHalf(Te.charAt(we-1))&&isLowSurrogateHalf(Te.charAt(we))}function isInsideCombinedSymbol(Te,we){return isCombiningMark(Te.charAt(we))}const EMOJI_PATTERN=buildEmojiRegexp();function isInsideEmojiSequence(Te,we){const t=String(Te).matchAll(EMOJI_PATTERN);return Array.from(t).some(te=>te.index<we&&we<te.index+te[0].length)}function buildEmojiRegexp(){const Te=[new RegExp("\\p{Emoji}[\\u{E0020}-\\u{E007E}]+\\u{E007F}","u"),new RegExp("\\p{Emoji}\\u{FE0F}?\\u{20E3}","u"),new RegExp("\\p{Emoji}\\u{FE0F}","u"),new RegExp("(?=\\p{General_Category=Other_Symbol})\\p{Emoji}\\p{Emoji_Modifier}*","u")],we=new RegExp("\\p{Regional_Indicator}{2}","u").source,t="(?:"+Te.map(be=>be.source).join("|")+")",te=`${we}|${t}(?:‍${t})*`;return new RegExp(te,"ug")}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const documentPlaceholders=new WeakMap;let hasDisplayedPlaceholderDeprecationWarning=!1;function enablePlaceholder({view:Te,element:we,text:t,isDirectHost:te=!0,keepOnFocus:be=!1}){const xe=Te.document;documentPlaceholders.has(xe)||(documentPlaceholders.set(xe,new Map),xe.registerPostFixer(ke=>updateDocumentPlaceholders(xe,ke)),xe.on("change:isComposing",()=>{Te.change(ke=>updateDocumentPlaceholders(xe,ke))},{priority:"high"})),we.is("editableElement")&&we.on("change:placeholder",(ke,Ie,Ae)=>{ve(Ae)}),we.placeholder?ve(we.placeholder):t&&ve(t),t&&showPlaceholderTextDeprecationWarning();function ve(ke){documentPlaceholders.get(xe).set(we,{text:ke,isDirectHost:te,keepOnFocus:be,hostElement:te?we:null}),Te.change(Ie=>updateDocumentPlaceholders(xe,Ie))}}function disablePlaceholder(Te,we){const t=we.document;documentPlaceholders.has(t)&&Te.change(te=>{const be=documentPlaceholders.get(t),xe=be.get(we);te.removeAttribute("data-placeholder",xe.hostElement),hidePlaceholder(te,xe.hostElement),be.delete(we)})}function showPlaceholder(Te,we){return we.hasClass("ck-placeholder")?!1:(Te.addClass("ck-placeholder",we),!0)}function hidePlaceholder(Te,we){return we.hasClass("ck-placeholder")?(Te.removeClass("ck-placeholder",we),!0):!1}function needsPlaceholder(Te,we){if(!Te.isAttached()||Array.from(Te.getChildren()).some(ve=>!ve.is("uiElement")))return!1;const te=Te.document,xe=te.selection.anchor;return te.isComposing&&xe&&xe.parent===Te?!1:we||!te.isFocused?!0:!!xe&&xe.parent!==Te}function updateDocumentPlaceholders(Te,we){const t=documentPlaceholders.get(Te),te=[];let be=!1;for(const[xe,ve]of t)ve.isDirectHost&&(te.push(xe),updatePlaceholder(we,xe,ve)&&(be=!0));for(const[xe,ve]of t){if(ve.isDirectHost)continue;const ke=getChildPlaceholderHostSubstitute(xe);ke&&(te.includes(ke)||(ve.hostElement=ke,updatePlaceholder(we,xe,ve)&&(be=!0)))}return be}function updatePlaceholder(Te,we,t){const{text:te,isDirectHost:be,hostElement:xe}=t;let ve=!1;return xe.getAttribute("data-placeholder")!==te&&(Te.setAttribute("data-placeholder",te,xe),ve=!0),(be||we.childCount==1)&&needsPlaceholder(xe,t.keepOnFocus)?showPlaceholder(Te,xe)&&(ve=!0):hidePlaceholder(Te,xe)&&(ve=!0),ve}function getChildPlaceholderHostSubstitute(Te){if(Te.childCount){const we=Te.getChild(0);if(we.is("element")&&!we.is("uiElement")&&!we.is("attributeElement"))return we}return null}function showPlaceholderTextDeprecationWarning(){hasDisplayedPlaceholderDeprecationWarning||logWarning("enableplaceholder-deprecated-text-option"),hasDisplayedPlaceholderDeprecationWarning=!0}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */let TypeCheckable$1=class{is(){throw new Error("is() method is abstract")}},Node$2=class extends EmitterMixin(TypeCheckable$1){constructor(t){super();Re(this,"document");Re(this,"parent");this.document=t,this.parent=null}get index(){let t;if(!this.parent)return null;if((t=this.parent.getChildIndex(this))==-1)throw new CKEditorError("view-node-not-found-in-parent",this);return t}get nextSibling(){const t=this.index;return t!==null&&this.parent.getChild(t+1)||null}get previousSibling(){const t=this.index;return t!==null&&this.parent.getChild(t-1)||null}get root(){let t=this;for(;t.parent;)t=t.parent;return t}isAttached(){return this.root.is("rootElement")}getPath(){const t=[];let te=this;for(;te.parent;)t.unshift(te.index),te=te.parent;return t}getAncestors(t={}){const te=[];let be=t.includeSelf?this:this.parent;for(;be;)te[t.parentFirst?"push":"unshift"](be),be=be.parent;return te}getCommonAncestor(t,te={}){const be=this.getAncestors(te),xe=t.getAncestors(te);let ve=0;for(;be[ve]==xe[ve]&&be[ve];)ve++;return ve===0?null:be[ve-1]}isBefore(t){if(this==t||this.root!==t.root)return!1;const te=this.getPath(),be=t.getPath(),xe=compareArrays(te,be);switch(xe){case"prefix":return!0;case"extension":return!1;default:return te[xe]<be[xe]}}isAfter(t){return this==t||this.root!==t.root?!1:!this.isBefore(t)}_remove(){this.parent._removeChildren(this.index)}_fireChange(t,te){this.fire(`change:${t}`,te),this.parent&&this.parent._fireChange(t,te)}toJSON(){const t=clone$3(this);return delete t.parent,t}};Node$2.prototype.is=function(Te){return Te==="node"||Te==="view:node"};let Text$1=class h0 extends Node$2{constructor(t,te){super(t);Re(this,"_textData");this._textData=te}get data(){return this._textData}get _data(){return this.data}set _data(t){this._fireChange("text",this),this._textData=t}isSimilar(t){return t instanceof h0?this===t||this.data===t.data:!1}_clone(){return new h0(this.document,this.data)}};Text$1.prototype.is=function(Te){return Te==="$text"||Te==="view:$text"||Te==="text"||Te==="view:text"||Te==="node"||Te==="view:node"};let TextProxy$1=class extends TypeCheckable$1{constructor(t,te,be){super();Re(this,"textNode");Re(this,"data");Re(this,"offsetInText");if(this.textNode=t,te<0||te>t.data.length)throw new CKEditorError("view-textproxy-wrong-offsetintext",this);if(be<0||te+be>t.data.length)throw new CKEditorError("view-textproxy-wrong-length",this);this.data=t.data.substring(te,te+be),this.offsetInText=te}get offsetSize(){return this.data.length}get isPartial(){return this.data.length!==this.textNode.data.length}get parent(){return this.textNode.parent}get root(){return this.textNode.root}get document(){return this.textNode.document}getAncestors(t={}){const te=[];let be=t.includeSelf?this.textNode:this.parent;for(;be!==null;)te[t.parentFirst?"push":"unshift"](be),be=be.parent;return te}};TextProxy$1.prototype.is=function(Te){return Te==="$textProxy"||Te==="view:$textProxy"||Te==="textProxy"||Te==="view:textProxy"};class Matcher{constructor(...we){Re(this,"_patterns",[]);this.add(...we)}add(...we){for(let t of we)(typeof t=="string"||t instanceof RegExp)&&(t={name:t}),this._patterns.push(t)}match(...we){for(const t of we)for(const te of this._patterns){const be=isElementMatching(t,te);if(be)return{element:t,pattern:te,match:be}}return null}matchAll(...we){const t=[];for(const te of we)for(const be of this._patterns){const xe=isElementMatching(te,be);xe&&t.push({element:te,pattern:be,match:xe})}return t.length>0?t:null}getElementName(){if(this._patterns.length!==1)return null;const we=this._patterns[0],t=we.name;return typeof we!="function"&&t&&!(t instanceof RegExp)?t:null}}function isElementMatching(Te,we){if(typeof we=="function")return we(Te);const t={};return we.name&&(t.name=matchName(we.name,Te.name),!t.name)||we.attributes&&(t.attributes=matchAttributes(we.attributes,Te),!t.attributes)||we.classes&&(t.classes=matchClasses(we.classes,Te),!t.classes)||we.styles&&(t.styles=matchStyles(we.styles,Te),!t.styles)?null:t}function matchName(Te,we){return Te instanceof RegExp?!!we.match(Te):Te===we}function matchPatterns(Te,we,t){const te=normalizePatterns(Te),be=Array.from(we),xe=[];if(te.forEach(([ve,ke])=>{be.forEach(Ie=>{isKeyMatched(ve,Ie)&&isValueMatched(ke,Ie,t)&&xe.push(Ie)})}),!(!te.length||xe.length<te.length))return xe}function normalizePatterns(Te){return Array.isArray(Te)?Te.map(we=>isPlainObject(we)?((we.key===void 0||we.value===void 0)&&logWarning("matcher-pattern-missing-key-or-value",we),[we.key,we.value]):[we,!0]):isPlainObject(Te)?Object.entries(Te):[[Te,!0]]}function isKeyMatched(Te,we){return Te===!0||Te===we||Te instanceof RegExp&&we.match(Te)}function isValueMatched(Te,we,t){if(Te===!0)return!0;const te=t(we);return Te===te||Te instanceof RegExp&&!!String(te).match(Te)}function matchAttributes(Te,we){const t=new Set(we.getAttributeKeys());return isPlainObject(Te)?(Te.style!==void 0&&logWarning("matcher-pattern-deprecated-attributes-style-key",Te),Te.class!==void 0&&logWarning("matcher-pattern-deprecated-attributes-class-key",Te)):(t.delete("style"),t.delete("class")),matchPatterns(Te,t,te=>we.getAttribute(te))}function matchClasses(Te,we){return matchPatterns(Te,we.getClassNames(),()=>{})}function matchStyles(Te,we){return matchPatterns(Te,we.getStyleNames(!0),t=>we.getStyle(t))}class StylesMap{constructor(we){Re(this,"_styles");Re(this,"_styleProcessor");this._styles={},this._styleProcessor=we}get isEmpty(){return!Object.entries(this._styles).length}get size(){return this.isEmpty?0:this.getStyleNames().length}setTo(we){this.clear();const t=parseInlineStyles(we);for(const[te,be]of t)this._styleProcessor.toNormalizedForm(te,be,this._styles)}has(we){if(this.isEmpty)return!1;const te=this._styleProcessor.getReducedForm(we,this._styles).find(([be])=>be===we);return Array.isArray(te)}set(we,t){if(isObject$2(we))for(const[te,be]of Object.entries(we))this._styleProcessor.toNormalizedForm(te,be,this._styles);else this._styleProcessor.toNormalizedForm(we,t,this._styles)}remove(we){const t=toPath(we);unset(this._styles,t),delete this._styles[we],this._cleanEmptyObjectsOnPath(t)}getNormalized(we){return this._styleProcessor.getNormalized(we,this._styles)}toString(){return this.isEmpty?"":this.getStylesEntries().map(we=>we.join(":")).sort().join(";")+";"}getAsString(we){if(this.isEmpty)return;if(this._styles[we]&&!isObject$2(this._styles[we]))return this._styles[we];const te=this._styleProcessor.getReducedForm(we,this._styles).find(([be])=>be===we);if(Array.isArray(te))return te[1]}getStyleNames(we=!1){return this.isEmpty?[]:we?this._styleProcessor.getStyleNames(this._styles):this.getStylesEntries().map(([te])=>te)}clear(){this._styles={}}getStylesEntries(){const we=[],t=Object.keys(this._styles);for(const te of t)we.push(...this._styleProcessor.getReducedForm(te,this._styles));return we}_cleanEmptyObjectsOnPath(we){const t=we.split(".");if(!(t.length>1))return;const be=t.splice(0,t.length-1).join("."),xe=get(this._styles,be);if(!xe)return;!Object.keys(xe).length&&this.remove(be)}}class StylesProcessor{constructor(){Re(this,"_normalizers");Re(this,"_extractors");Re(this,"_reducers");Re(this,"_consumables");this._normalizers=new Map,this._extractors=new Map,this._reducers=new Map,this._consumables=new Map}toNormalizedForm(we,t,te){if(isObject$2(t)){appendStyleValue(te,toPath(we),t);return}if(this._normalizers.has(we)){const be=this._normalizers.get(we),{path:xe,value:ve}=be(t);appendStyleValue(te,xe,ve)}else appendStyleValue(te,we,t)}getNormalized(we,t){if(!we)return merge$1({},t);if(t[we]!==void 0)return t[we];if(this._extractors.has(we)){const te=this._extractors.get(we);if(typeof te=="string")return get(t,te);const be=te(we,t);if(be)return be}return get(t,toPath(we))}getReducedForm(we,t){const te=this.getNormalized(we,t);return te===void 0?[]:this._reducers.has(we)?this._reducers.get(we)(te):[[we,te]]}getStyleNames(we){const t=Array.from(this._consumables.keys()).filter(be=>{const xe=this.getNormalized(be,we);return xe&&typeof xe=="object"?Object.keys(xe).length:xe}),te=new Set([...t,...Object.keys(we)]);return Array.from(te)}getRelatedStyles(we){return this._consumables.get(we)||[]}setNormalizer(we,t){this._normalizers.set(we,t)}setExtractor(we,t){this._extractors.set(we,t)}setReducer(we,t){this._reducers.set(we,t)}setStyleRelation(we,t){this._mapStyleNames(we,t);for(const te of t)this._mapStyleNames(te,[we])}_mapStyleNames(we,t){this._consumables.has(we)||this._consumables.set(we,[]),this._consumables.get(we).push(...t)}}function parseInlineStyles(Te){let we=null,t=0,te=0,be=null;const xe=new Map;if(Te==="")return xe;Te.charAt(Te.length-1)!=";"&&(Te=Te+";");for(let ve=0;ve<Te.length;ve++){const ke=Te.charAt(ve);if(we===null)switch(ke){case":":be||(be=Te.substr(t,ve-t),te=ve+1);break;case'"':case"'":we=ke;break;case";":{const Ie=Te.substr(te,ve-te);be&&xe.set(be.trim(),Ie.trim()),be=null,t=ve+1;break}}else ke===we&&(we=null)}return xe}function toPath(Te){return Te.replace("-",".")}function appendStyleValue(Te,we,t){let te=t;isObject$2(t)&&(te=merge$1({},get(Te,we),t)),set$1(Te,we,te)}let Element$1=class g0 extends Node$2{constructor(t,te,be,xe){super(t);Re(this,"name");Re(this,"_unsafeAttributesToRender",[]);Re(this,"_attrs");Re(this,"_children");Re(this,"_classes");Re(this,"_styles");Re(this,"_customProperties",new Map);if(this.name=te,this._attrs=parseAttributes(be),this._children=[],xe&&this._insertChild(0,xe),this._classes=new Set,this._attrs.has("class")){const ve=this._attrs.get("class");parseClasses(this._classes,ve),this._attrs.delete("class")}this._styles=new StylesMap(this.document.stylesProcessor),this._attrs.has("style")&&(this._styles.setTo(this._attrs.get("style")),this._attrs.delete("style"))}get childCount(){return this._children.length}get isEmpty(){return this._children.length===0}getChild(t){return this._children[t]}getChildIndex(t){return this._children.indexOf(t)}getChildren(){return this._children[Symbol.iterator]()}*getAttributeKeys(){this._classes.size>0&&(yield"class"),this._styles.isEmpty||(yield"style"),yield*this._attrs.keys()}*getAttributes(){yield*this._attrs.entries(),this._classes.size>0&&(yield["class",this.getAttribute("class")]),this._styles.isEmpty||(yield["style",this.getAttribute("style")])}getAttribute(t){if(t=="class")return this._classes.size>0?[...this._classes].join(" "):void 0;if(t=="style"){const te=this._styles.toString();return te==""?void 0:te}return this._attrs.get(t)}hasAttribute(t){return t=="class"?this._classes.size>0:t=="style"?!this._styles.isEmpty:this._attrs.has(t)}isSimilar(t){if(!(t instanceof g0))return!1;if(this===t)return!0;if(this.name!=t.name||this._attrs.size!==t._attrs.size||this._classes.size!==t._classes.size||this._styles.size!==t._styles.size)return!1;for(const[te,be]of this._attrs)if(!t._attrs.has(te)||t._attrs.get(te)!==be)return!1;for(const te of this._classes)if(!t._classes.has(te))return!1;for(const te of this._styles.getStyleNames())if(!t._styles.has(te)||t._styles.getAsString(te)!==this._styles.getAsString(te))return!1;return!0}hasClass(...t){for(const te of t)if(!this._classes.has(te))return!1;return!0}getClassNames(){return this._classes.keys()}getStyle(t){return this._styles.getAsString(t)}getNormalizedStyle(t){return this._styles.getNormalized(t)}getStyleNames(t){return this._styles.getStyleNames(t)}hasStyle(...t){for(const te of t)if(!this._styles.has(te))return!1;return!0}findAncestor(...t){const te=new Matcher(...t);let be=this.parent;for(;be&&!be.is("documentFragment");){if(te.match(be))return be;be=be.parent}return null}getCustomProperty(t){return this._customProperties.get(t)}*getCustomProperties(){yield*this._customProperties.entries()}getIdentity(){const t=Array.from(this._classes).sort().join(","),te=this._styles.toString(),be=Array.from(this._attrs).map(xe=>`${xe[0]}="${xe[1]}"`).sort().join(" ");return this.name+(t==""?"":` class="${t}"`)+(te?` style="${te}"`:"")+(be==""?"":` ${be}`)}shouldRenderUnsafeAttribute(t){return this._unsafeAttributesToRender.includes(t)}_clone(t=!1){const te=[];if(t)for(const xe of this.getChildren())te.push(xe._clone(t));const be=new this.constructor(this.document,this.name,this._attrs,te);return be._classes=new Set(this._classes),be._styles.set(this._styles.getNormalized()),be._customProperties=new Map(this._customProperties),be.getFillerOffset=this.getFillerOffset,be._unsafeAttributesToRender=this._unsafeAttributesToRender,be}_appendChild(t){return this._insertChild(this.childCount,t)}_insertChild(t,te){this._fireChange("children",this);let be=0;const xe=normalize$3(this.document,te);for(const ve of xe)ve.parent!==null&&ve._remove(),ve.parent=this,ve.document=this.document,this._children.splice(t,0,ve),t++,be++;return be}_removeChildren(t,te=1){this._fireChange("children",this);for(let be=t;be<t+te;be++)this._children[be].parent=null;return this._children.splice(t,te)}_setAttribute(t,te){const be=String(te);this._fireChange("attributes",this),t=="class"?parseClasses(this._classes,be):t=="style"?this._styles.setTo(be):this._attrs.set(t,be)}_removeAttribute(t){return this._fireChange("attributes",this),t=="class"?this._classes.size>0?(this._classes.clear(),!0):!1:t=="style"?this._styles.isEmpty?!1:(this._styles.clear(),!0):this._attrs.delete(t)}_addClass(t){this._fireChange("attributes",this);for(const te of toArray$2(t))this._classes.add(te)}_removeClass(t){this._fireChange("attributes",this);for(const te of toArray$2(t))this._classes.delete(te)}_setStyle(t,te){this._fireChange("attributes",this),typeof t!="string"?this._styles.set(t):this._styles.set(t,te)}_removeStyle(t){this._fireChange("attributes",this);for(const te of toArray$2(t))this._styles.remove(te)}_setCustomProperty(t,te){this._customProperties.set(t,te)}_removeCustomProperty(t){return this._customProperties.delete(t)}};Element$1.prototype.is=function(Te,we){return we?we===this.name&&(Te==="element"||Te==="view:element"):Te==="element"||Te==="view:element"||Te==="node"||Te==="view:node"};function parseAttributes(Te){const we=toMap(Te);for(const[t,te]of we)te===null?we.delete(t):typeof te!="string"&&we.set(t,String(te));return we}function parseClasses(Te,we){const t=we.split(/\s+/);Te.clear(),t.forEach(te=>Te.add(te))}function normalize$3(Te,we){return typeof we=="string"?[new Text$1(Te,we)]:(isIterable(we)||(we=[we]),Array.from(we).map(t=>typeof t=="string"?new Text$1(Te,t):t instanceof TextProxy$1?new Text$1(Te,t.data):t))}class ContainerElement extends Element$1{constructor(we,t,te,be){super(we,t,te,be),this.getFillerOffset=getFillerOffset$4}}ContainerElement.prototype.is=function(Te,we){return we?we===this.name&&(Te==="containerElement"||Te==="view:containerElement"||Te==="element"||Te==="view:element"):Te==="containerElement"||Te==="view:containerElement"||Te==="element"||Te==="view:element"||Te==="node"||Te==="view:node"};function getFillerOffset$4(){const Te=[...this.getChildren()],we=Te[this.childCount-1];if(we&&we.is("element","br"))return this.childCount;for(const t of Te)if(!t.is("uiElement"))return null;return this.childCount}class EditableElement extends ObservableMixin(ContainerElement){constructor(we,t,te,be){super(we,t,te,be),this.set("isReadOnly",!1),this.set("isFocused",!1),this.set("placeholder",void 0),this.bind("isReadOnly").to(we),this.bind("isFocused").to(we,"isFocused",xe=>xe&&we.selection.editableElement==this),this.listenTo(we.selection,"change",()=>{this.isFocused=we.isFocused&&we.selection.editableElement==this})}destroy(){this.stopListening()}}EditableElement.prototype.is=function(Te,we){return we?we===this.name&&(Te==="editableElement"||Te==="view:editableElement"||Te==="containerElement"||Te==="view:containerElement"||Te==="element"||Te==="view:element"):Te==="editableElement"||Te==="view:editableElement"||Te==="containerElement"||Te==="view:containerElement"||Te==="element"||Te==="view:element"||Te==="node"||Te==="view:node"};const rootNameSymbol=Symbol("rootName");class RootEditableElement extends EditableElement{constructor(we,t){super(we,t),this.rootName="main"}get rootName(){return this.getCustomProperty(rootNameSymbol)}set rootName(we){this._setCustomProperty(rootNameSymbol,we)}set _name(we){this.name=we}}RootEditableElement.prototype.is=function(Te,we){return we?we===this.name&&(Te==="rootElement"||Te==="view:rootElement"||Te==="editableElement"||Te==="view:editableElement"||Te==="containerElement"||Te==="view:containerElement"||Te==="element"||Te==="view:element"):Te==="rootElement"||Te==="view:rootElement"||Te==="editableElement"||Te==="view:editableElement"||Te==="containerElement"||Te==="view:containerElement"||Te==="element"||Te==="view:element"||Te==="node"||Te==="view:node"};let TreeWalker$1=class{constructor(we={}){Re(this,"direction");Re(this,"boundaries");Re(this,"singleCharacters");Re(this,"shallow");Re(this,"ignoreElementEnd");Re(this,"_position");Re(this,"_boundaryStartParent");Re(this,"_boundaryEndParent");if(!we.boundaries&&!we.startPosition)throw new CKEditorError("view-tree-walker-no-start-position",null);if(we.direction&&we.direction!="forward"&&we.direction!="backward")throw new CKEditorError("view-tree-walker-unknown-direction",we.startPosition,{direction:we.direction});this.boundaries=we.boundaries||null,we.startPosition?this._position=Position$1._createAt(we.startPosition):this._position=Position$1._createAt(we.boundaries[we.direction=="backward"?"end":"start"]),this.direction=we.direction||"forward",this.singleCharacters=!!we.singleCharacters,this.shallow=!!we.shallow,this.ignoreElementEnd=!!we.ignoreElementEnd,this._boundaryStartParent=this.boundaries?this.boundaries.start.parent:null,this._boundaryEndParent=this.boundaries?this.boundaries.end.parent:null}[Symbol.iterator](){return this}get position(){return this._position}skip(we){let t,te;do te=this.position,t=this.next();while(!t.done&&we(t.value));t.done||(this._position=te)}next(){return this.direction=="forward"?this._next():this._previous()}_next(){let we=this.position.clone();const t=this.position,te=we.parent;if(te.parent===null&&we.offset===te.childCount)return{done:!0,value:void 0};if(te===this._boundaryEndParent&&we.offset==this.boundaries.end.offset)return{done:!0,value:void 0};let be;if(te instanceof Text$1){if(we.isAtEnd)return this._position=Position$1._createAfter(te),this._next();be=te.data[we.offset]}else be=te.getChild(we.offset);if(be instanceof Element$1){if(!this.shallow)we=new Position$1(be,0);else{if(this.boundaries&&this.boundaries.end.isBefore(we))return{done:!0,value:void 0};we.offset++}return this._position=we,this._formatReturnValue("elementStart",be,t,we,1)}if(be instanceof Text$1){if(this.singleCharacters)return we=new Position$1(be,0),this._position=we,this._next();let xe=be.data.length,ve;return be==this._boundaryEndParent?(xe=this.boundaries.end.offset,ve=new TextProxy$1(be,0,xe),we=Position$1._createAfter(ve)):(ve=new TextProxy$1(be,0,be.data.length),we.offset++),this._position=we,this._formatReturnValue("text",ve,t,we,xe)}if(typeof be=="string"){let xe;this.singleCharacters?xe=1:xe=(te===this._boundaryEndParent?this.boundaries.end.offset:te.data.length)-we.offset;const ve=new TextProxy$1(te,we.offset,xe);return we.offset+=xe,this._position=we,this._formatReturnValue("text",ve,t,we,xe)}return we=Position$1._createAfter(te),this._position=we,this.ignoreElementEnd?this._next():this._formatReturnValue("elementEnd",te,t,we)}_previous(){let we=this.position.clone();const t=this.position,te=we.parent;if(te.parent===null&&we.offset===0)return{done:!0,value:void 0};if(te==this._boundaryStartParent&&we.offset==this.boundaries.start.offset)return{done:!0,value:void 0};let be;if(te instanceof Text$1){if(we.isAtStart)return this._position=Position$1._createBefore(te),this._previous();be=te.data[we.offset-1]}else be=te.getChild(we.offset-1);if(be instanceof Element$1)return this.shallow?(we.offset--,this._position=we,this._formatReturnValue("elementStart",be,t,we,1)):(we=new Position$1(be,be.childCount),this._position=we,this.ignoreElementEnd?this._previous():this._formatReturnValue("elementEnd",be,t,we));if(be instanceof Text$1){if(this.singleCharacters)return we=new Position$1(be,be.data.length),this._position=we,this._previous();let xe=be.data.length,ve;if(be==this._boundaryStartParent){const ke=this.boundaries.start.offset;ve=new TextProxy$1(be,ke,be.data.length-ke),xe=ve.data.length,we=Position$1._createBefore(ve)}else ve=new TextProxy$1(be,0,be.data.length),we.offset--;return this._position=we,this._formatReturnValue("text",ve,t,we,xe)}if(typeof be=="string"){let xe;if(this.singleCharacters)xe=1;else{const ke=te===this._boundaryStartParent?this.boundaries.start.offset:0;xe=we.offset-ke}we.offset-=xe;const ve=new TextProxy$1(te,we.offset,xe);return this._position=we,this._formatReturnValue("text",ve,t,we,xe)}return we=Position$1._createBefore(te),this._position=we,this._formatReturnValue("elementStart",te,t,we,1)}_formatReturnValue(we,t,te,be,xe){return t instanceof TextProxy$1&&(t.offsetInText+t.data.length==t.textNode.data.length&&(this.direction=="forward"&&!(this.boundaries&&this.boundaries.end.isEqual(this.position))?(be=Position$1._createAfter(t.textNode),this._position=be):te=Position$1._createAfter(t.textNode)),t.offsetInText===0&&(this.direction=="backward"&&!(this.boundaries&&this.boundaries.start.isEqual(this.position))?(be=Position$1._createBefore(t.textNode),this._position=be):te=Position$1._createBefore(t.textNode))),{done:!1,value:{type:we,item:t,previousPosition:te,nextPosition:be,length:xe}}}},Position$1=class _n extends TypeCheckable$1{constructor(t,te){super();Re(this,"parent");Re(this,"offset");this.parent=t,this.offset=te}get nodeAfter(){return this.parent.is("$text")?null:this.parent.getChild(this.offset)||null}get nodeBefore(){return this.parent.is("$text")?null:this.parent.getChild(this.offset-1)||null}get isAtStart(){return this.offset===0}get isAtEnd(){const t=this.parent.is("$text")?this.parent.data.length:this.parent.childCount;return this.offset===t}get root(){return this.parent.root}get editableElement(){let t=this.parent;for(;!(t instanceof EditableElement);)if(t.parent)t=t.parent;else return null;return t}getShiftedBy(t){const te=_n._createAt(this),be=te.offset+t;return te.offset=be<0?0:be,te}getLastMatchingPosition(t,te={}){te.startPosition=this;const be=new TreeWalker$1(te);return be.skip(t),be.position}getAncestors(){return this.parent.is("documentFragment")?[this.parent]:this.parent.getAncestors({includeSelf:!0})}getCommonAncestor(t){const te=this.getAncestors(),be=t.getAncestors();let xe=0;for(;te[xe]==be[xe]&&te[xe];)xe++;return xe===0?null:te[xe-1]}isEqual(t){return this.parent==t.parent&&this.offset==t.offset}isBefore(t){return this.compareWith(t)=="before"}isAfter(t){return this.compareWith(t)=="after"}compareWith(t){if(this.root!==t.root)return"different";if(this.isEqual(t))return"same";const te=this.parent.is("node")?this.parent.getPath():[],be=t.parent.is("node")?t.parent.getPath():[];te.push(this.offset),be.push(t.offset);const xe=compareArrays(te,be);switch(xe){case"prefix":return"before";case"extension":return"after";default:return te[xe]<be[xe]?"before":"after"}}getWalker(t={}){return t.startPosition=this,new TreeWalker$1(t)}clone(){return new _n(this.parent,this.offset)}static _createAt(t,te){if(t instanceof _n)return new this(t.parent,t.offset);{const be=t;if(te=="end")te=be.is("$text")?be.data.length:be.childCount;else{if(te=="before")return this._createBefore(be);if(te=="after")return this._createAfter(be);if(te!==0&&!te)throw new CKEditorError("view-createpositionat-offset-required",be)}return new _n(be,te)}}static _createAfter(t){if(t.is("$textProxy"))return new _n(t.textNode,t.offsetInText+t.data.length);if(!t.parent)throw new CKEditorError("view-position-after-root",t,{root:t});return new _n(t.parent,t.index+1)}static _createBefore(t){if(t.is("$textProxy"))return new _n(t.textNode,t.offsetInText);if(!t.parent)throw new CKEditorError("view-position-before-root",t,{root:t});return new _n(t.parent,t.index)}};Position$1.prototype.is=function(Te){return Te==="position"||Te==="view:position"};let Range$1=class An extends TypeCheckable$1{constructor(t,te=null){super();Re(this,"start");Re(this,"end");this.start=t.clone(),this.end=te?te.clone():t.clone()}*[Symbol.iterator](){yield*new TreeWalker$1({boundaries:this,ignoreElementEnd:!0})}get isCollapsed(){return this.start.isEqual(this.end)}get isFlat(){return this.start.parent===this.end.parent}get root(){return this.start.root}getEnlarged(){let t=this.start.getLastMatchingPosition(enlargeTrimSkip,{direction:"backward"}),te=this.end.getLastMatchingPosition(enlargeTrimSkip);return t.parent.is("$text")&&t.isAtStart&&(t=Position$1._createBefore(t.parent)),te.parent.is("$text")&&te.isAtEnd&&(te=Position$1._createAfter(te.parent)),new An(t,te)}getTrimmed(){let t=this.start.getLastMatchingPosition(enlargeTrimSkip);if(t.isAfter(this.end)||t.isEqual(this.end))return new An(t,t);let te=this.end.getLastMatchingPosition(enlargeTrimSkip,{direction:"backward"});const be=t.nodeAfter,xe=te.nodeBefore;return be&&be.is("$text")&&(t=new Position$1(be,0)),xe&&xe.is("$text")&&(te=new Position$1(xe,xe.data.length)),new An(t,te)}isEqual(t){return this==t||this.start.isEqual(t.start)&&this.end.isEqual(t.end)}containsPosition(t){return t.isAfter(this.start)&&t.isBefore(this.end)}containsRange(t,te=!1){t.isCollapsed&&(te=!1);const be=this.containsPosition(t.start)||te&&this.start.isEqual(t.start),xe=this.containsPosition(t.end)||te&&this.end.isEqual(t.end);return be&&xe}getDifference(t){const te=[];return this.isIntersecting(t)?(this.containsPosition(t.start)&&te.push(new An(this.start,t.start)),this.containsPosition(t.end)&&te.push(new An(t.end,this.end))):te.push(this.clone()),te}getIntersection(t){if(this.isIntersecting(t)){let te=this.start,be=this.end;return this.containsPosition(t.start)&&(te=t.start),this.containsPosition(t.end)&&(be=t.end),new An(te,be)}return null}getWalker(t={}){return t.boundaries=this,new TreeWalker$1(t)}getCommonAncestor(){return this.start.getCommonAncestor(this.end)}getContainedElement(){if(this.isCollapsed)return null;let t=this.start.nodeAfter,te=this.end.nodeBefore;return this.start.parent.is("$text")&&this.start.isAtEnd&&this.start.parent.nextSibling&&(t=this.start.parent.nextSibling),this.end.parent.is("$text")&&this.end.isAtStart&&this.end.parent.previousSibling&&(te=this.end.parent.previousSibling),t&&t.is("element")&&t===te?t:null}clone(){return new An(this.start,this.end)}*getItems(t={}){t.boundaries=this,t.ignoreElementEnd=!0;const te=new TreeWalker$1(t);for(const be of te)yield be.item}*getPositions(t={}){t.boundaries=this;const te=new TreeWalker$1(t);yield te.position;for(const be of te)yield be.nextPosition}isIntersecting(t){return this.start.isBefore(t.end)&&this.end.isAfter(t.start)}static _createFromParentsAndOffsets(t,te,be,xe){return new this(new Position$1(t,te),new Position$1(be,xe))}static _createFromPositionAndShift(t,te){const be=t,xe=t.getShiftedBy(te);return te>0?new this(be,xe):new this(xe,be)}static _createIn(t){return this._createFromParentsAndOffsets(t,0,t,t.childCount)}static _createOn(t){const te=t.is("$textProxy")?t.offsetSize:1;return this._createFromPositionAndShift(Position$1._createBefore(t),te)}};Range$1.prototype.is=function(Te){return Te==="range"||Te==="view:range"};function enlargeTrimSkip(Te){return!!(Te.item.is("attributeElement")||Te.item.is("uiElement"))}let Selection$1=class b0 extends EmitterMixin(TypeCheckable$1){constructor(...t){super();Re(this,"_ranges");Re(this,"_lastRangeBackward");Re(this,"_isFake");Re(this,"_fakeSelectionLabel");this._ranges=[],this._lastRangeBackward=!1,this._isFake=!1,this._fakeSelectionLabel="",t.length&&this.setTo(...t)}get isFake(){return this._isFake}get fakeSelectionLabel(){return this._fakeSelectionLabel}get anchor(){if(!this._ranges.length)return null;const t=this._ranges[this._ranges.length-1];return(this._lastRangeBackward?t.end:t.start).clone()}get focus(){if(!this._ranges.length)return null;const t=this._ranges[this._ranges.length-1];return(this._lastRangeBackward?t.start:t.end).clone()}get isCollapsed(){return this.rangeCount===1&&this._ranges[0].isCollapsed}get rangeCount(){return this._ranges.length}get isBackward(){return!this.isCollapsed&&this._lastRangeBackward}get editableElement(){return this.anchor?this.anchor.editableElement:null}*getRanges(){for(const t of this._ranges)yield t.clone()}getFirstRange(){let t=null;for(const te of this._ranges)(!t||te.start.isBefore(t.start))&&(t=te);return t?t.clone():null}getLastRange(){let t=null;for(const te of this._ranges)(!t||te.end.isAfter(t.end))&&(t=te);return t?t.clone():null}getFirstPosition(){const t=this.getFirstRange();return t?t.start.clone():null}getLastPosition(){const t=this.getLastRange();return t?t.end.clone():null}isEqual(t){if(this.isFake!=t.isFake||this.isFake&&this.fakeSelectionLabel!=t.fakeSelectionLabel||this.rangeCount!=t.rangeCount)return!1;if(this.rangeCount===0)return!0;if(!this.anchor.isEqual(t.anchor)||!this.focus.isEqual(t.focus))return!1;for(const te of this._ranges){let be=!1;for(const xe of t._ranges)if(te.isEqual(xe)){be=!0;break}if(!be)return!1}return!0}isSimilar(t){if(this.isBackward!=t.isBackward)return!1;const te=count(this.getRanges()),be=count(t.getRanges());if(te!=be)return!1;if(te==0)return!0;for(let xe of this.getRanges()){xe=xe.getTrimmed();let ve=!1;for(let ke of t.getRanges())if(ke=ke.getTrimmed(),xe.start.isEqual(ke.start)&&xe.end.isEqual(ke.end)){ve=!0;break}if(!ve)return!1}return!0}getSelectedElement(){return this.rangeCount!==1?null:this.getFirstRange().getContainedElement()}setTo(...t){let[te,be,xe]=t;if(typeof be=="object"&&(xe=be,be=void 0),te===null)this._setRanges([]),this._setFakeOptions(xe);else if(te instanceof b0||te instanceof DocumentSelection$1)this._setRanges(te.getRanges(),te.isBackward),this._setFakeOptions({fake:te.isFake,label:te.fakeSelectionLabel});else if(te instanceof Range$1)this._setRanges([te],xe&&xe.backward),this._setFakeOptions(xe);else if(te instanceof Position$1)this._setRanges([new Range$1(te)]),this._setFakeOptions(xe);else if(te instanceof Node$2){const ve=!!xe&&!!xe.backward;let ke;if(be===void 0)throw new CKEditorError("view-selection-setto-required-second-parameter",this);be=="in"?ke=Range$1._createIn(te):be=="on"?ke=Range$1._createOn(te):ke=new Range$1(Position$1._createAt(te,be)),this._setRanges([ke],ve),this._setFakeOptions(xe)}else if(isIterable(te))this._setRanges(te,xe&&xe.backward),this._setFakeOptions(xe);else throw new CKEditorError("view-selection-setto-not-selectable",this);this.fire("change")}setFocus(t,te){if(this.anchor===null)throw new CKEditorError("view-selection-setfocus-no-ranges",this);const be=Position$1._createAt(t,te);if(be.compareWith(this.focus)=="same")return;const xe=this.anchor;this._ranges.pop(),be.compareWith(xe)=="before"?this._addRange(new Range$1(be,xe),!0):this._addRange(new Range$1(xe,be)),this.fire("change")}_setRanges(t,te=!1){t=Array.from(t),this._ranges=[];for(const be of t)this._addRange(be);this._lastRangeBackward=!!te}_setFakeOptions(t={}){this._isFake=!!t.fake,this._fakeSelectionLabel=t.fake&&t.label||""}_addRange(t,te=!1){if(!(t instanceof Range$1))throw new CKEditorError("view-selection-add-range-not-range",this);this._pushRange(t),this._lastRangeBackward=!!te}_pushRange(t){for(const te of this._ranges)if(t.isIntersecting(te))throw new CKEditorError("view-selection-range-intersects",this,{addedRange:t,intersectingRange:te});this._ranges.push(new Range$1(t.start,t.end))}};Selection$1.prototype.is=function(Te){return Te==="selection"||Te==="view:selection"};let DocumentSelection$1=class extends EmitterMixin(TypeCheckable$1){constructor(...t){super();Re(this,"_selection");this._selection=new Selection$1,this._selection.delegate("change").to(this),t.length&&this._selection.setTo(...t)}get isFake(){return this._selection.isFake}get fakeSelectionLabel(){return this._selection.fakeSelectionLabel}get anchor(){return this._selection.anchor}get focus(){return this._selection.focus}get isCollapsed(){return this._selection.isCollapsed}get rangeCount(){return this._selection.rangeCount}get isBackward(){return this._selection.isBackward}get editableElement(){return this._selection.editableElement}get _ranges(){return this._selection._ranges}*getRanges(){yield*this._selection.getRanges()}getFirstRange(){return this._selection.getFirstRange()}getLastRange(){return this._selection.getLastRange()}getFirstPosition(){return this._selection.getFirstPosition()}getLastPosition(){return this._selection.getLastPosition()}getSelectedElement(){return this._selection.getSelectedElement()}isEqual(t){return this._selection.isEqual(t)}isSimilar(t){return this._selection.isSimilar(t)}_setTo(...t){this._selection.setTo(...t)}_setFocus(t,te){this._selection.setFocus(t,te)}};DocumentSelection$1.prototype.is=function(Te){return Te==="selection"||Te=="documentSelection"||Te=="view:selection"||Te=="view:documentSelection"};class BubblingEventInfo extends EventInfo{constructor(t,te,be){super(t,te);Re(this,"startRange");Re(this,"_eventPhase");Re(this,"_currentTarget");this.startRange=be,this._eventPhase="none",this._currentTarget=null}get eventPhase(){return this._eventPhase}get currentTarget(){return this._currentTarget}}const contextsSymbol=Symbol("bubbling contexts");function BubblingEmitterMixin(Te){class we extends Te{fire(te,...be){try{const xe=te instanceof EventInfo?te:new EventInfo(this,te),ve=getBubblingContexts(this);if(!ve.size)return;if(updateEventInfo(xe,"capturing",this),fireListenerFor(ve,"$capture",xe,...be))return xe.return;const ke=xe.startRange||this.selection.getFirstRange(),Ie=ke?ke.getContainedElement():null,Ae=Ie?!!getCustomContext(ve,Ie):!1;let Se=Ie||getDeeperRangeParent(ke);if(updateEventInfo(xe,"atTarget",Se),!Ae){if(fireListenerFor(ve,"$text",xe,...be))return xe.return;updateEventInfo(xe,"bubbling",Se)}for(;Se;){if(Se.is("rootElement")){if(fireListenerFor(ve,"$root",xe,...be))return xe.return}else if(Se.is("element")&&fireListenerFor(ve,Se.name,xe,...be))return xe.return;if(fireListenerFor(ve,Se,xe,...be))return xe.return;Se=Se.parent,updateEventInfo(xe,"bubbling",Se)}return updateEventInfo(xe,"bubbling",this),fireListenerFor(ve,"$document",xe,...be),xe.return}catch(xe){/* istanbul ignore next -- @preserve */CKEditorError.rethrowUnexpectedError(xe,this)}}_addEventListener(te,be,xe){const ve=toArray$2(xe.context||"$document"),ke=getBubblingContexts(this);for(const Ie of ve){let Ae=ke.get(Ie);Ae||(Ae=new(EmitterMixin()),ke.set(Ie,Ae)),this.listenTo(Ae,te,be,xe)}}_removeEventListener(te,be){const xe=getBubblingContexts(this);for(const ve of xe.values())this.stopListening(ve,te,be)}}return we}{const Te=BubblingEmitterMixin(Object);["fire","_addEventListener","_removeEventListener"].forEach(we=>{BubblingEmitterMixin[we]=Te.prototype[we]})}function updateEventInfo(Te,we,t){Te instanceof BubblingEventInfo&&(Te._eventPhase=we,Te._currentTarget=t)}function fireListenerFor(Te,we,t,...te){const be=typeof we=="string"?Te.get(we):getCustomContext(Te,we);return be?(be.fire(t,...te),t.stop.called):!1}function getCustomContext(Te,we){for(const[t,te]of Te)if(typeof t=="function"&&t(we))return te;return null}function getBubblingContexts(Te){return Te[contextsSymbol]||(Te[contextsSymbol]=new Map),Te[contextsSymbol]}function getDeeperRangeParent(Te){if(!Te)return null;const we=Te.start.parent,t=Te.end.parent,te=we.getPath(),be=t.getPath();return te.length>be.length?we:t}let Document$1=class extends BubblingEmitterMixin(ObservableMixin()){constructor(t){super();Re(this,"selection");Re(this,"roots");Re(this,"stylesProcessor");Re(this,"_postFixers",new Set);this.selection=new DocumentSelection$1,this.roots=new Collection({idProperty:"rootName"}),this.stylesProcessor=t,this.set("isReadOnly",!1),this.set("isFocused",!1),this.set("isSelecting",!1),this.set("isComposing",!1)}getRoot(t="main"){return this.roots.get(t)}registerPostFixer(t){this._postFixers.add(t)}destroy(){this.roots.forEach(t=>t.destroy()),this.stopListening()}_callPostFixers(t){let te=!1;do for(const be of this._postFixers)if(te=be(t),te)break;while(te)}};const DEFAULT_PRIORITY=10;class AttributeElement extends Element$1{constructor(t,te,be,xe){super(t,te,be,xe);Re(this,"_priority",DEFAULT_PRIORITY);Re(this,"_id",null);Re(this,"_clonesGroup",null);this.getFillerOffset=getFillerOffset$3}get priority(){return this._priority}get id(){return this._id}getElementsWithSameId(){if(this.id===null)throw new CKEditorError("attribute-element-get-elements-with-same-id-no-id",this);return new Set(this._clonesGroup)}isSimilar(t){return this.id!==null||t.id!==null?this.id===t.id:super.isSimilar(t)&&this.priority==t.priority}_clone(t=!1){const te=super._clone(t);return te._priority=this._priority,te._id=this._id,te}}Re(AttributeElement,"DEFAULT_PRIORITY",DEFAULT_PRIORITY);AttributeElement.prototype.is=function(Te,we){return we?we===this.name&&(Te==="attributeElement"||Te==="view:attributeElement"||Te==="element"||Te==="view:element"):Te==="attributeElement"||Te==="view:attributeElement"||Te==="element"||Te==="view:element"||Te==="node"||Te==="view:node"};function getFillerOffset$3(){if(nonUiChildrenCount(this))return null;let Te=this.parent;for(;Te&&Te.is("attributeElement");){if(nonUiChildrenCount(Te)>1)return null;Te=Te.parent}return!Te||nonUiChildrenCount(Te)>1?null:this.childCount}function nonUiChildrenCount(Te){return Array.from(Te.getChildren()).filter(we=>!we.is("uiElement")).length}class EmptyElement extends Element$1{constructor(we,t,te,be){super(we,t,te,be),this.getFillerOffset=getFillerOffset$2}_insertChild(we,t){if(t&&(t instanceof Node$2||Array.from(t).length>0))throw new CKEditorError("view-emptyelement-cannot-add",[this,t]);return 0}}EmptyElement.prototype.is=function(Te,we){return we?we===this.name&&(Te==="emptyElement"||Te==="view:emptyElement"||Te==="element"||Te==="view:element"):Te==="emptyElement"||Te==="view:emptyElement"||Te==="element"||Te==="view:element"||Te==="node"||Te==="view:node"};function getFillerOffset$2(){return null}class UIElement extends Element$1{constructor(we,t,te,be){super(we,t,te,be),this.getFillerOffset=getFillerOffset$1}_insertChild(we,t){if(t&&(t instanceof Node$2||Array.from(t).length>0))throw new CKEditorError("view-uielement-cannot-add",[this,t]);return 0}render(we,t){return this.toDomElement(we)}toDomElement(we){const t=we.createElement(this.name);for(const te of this.getAttributeKeys())t.setAttribute(te,this.getAttribute(te));return t}}UIElement.prototype.is=function(Te,we){return we?we===this.name&&(Te==="uiElement"||Te==="view:uiElement"||Te==="element"||Te==="view:element"):Te==="uiElement"||Te==="view:uiElement"||Te==="element"||Te==="view:element"||Te==="node"||Te==="view:node"};function injectUiElementHandling(Te){Te.document.on("arrowKey",(we,t)=>jumpOverUiElement(we,t,Te.domConverter),{priority:"low"})}function getFillerOffset$1(){return null}function jumpOverUiElement(Te,we,t){if(we.keyCode==keyCodes.arrowright){const te=we.domTarget.ownerDocument.defaultView.getSelection(),be=te.rangeCount==1&&te.getRangeAt(0).collapsed;if(be||we.shiftKey){const xe=te.focusNode,ve=te.focusOffset,ke=t.domPositionToView(xe,ve);if(ke===null)return;let Ie=!1;const Ae=ke.getLastMatchingPosition(Se=>(Se.item.is("uiElement")&&(Ie=!0),!!(Se.item.is("uiElement")||Se.item.is("attributeElement"))));if(Ie){const Se=t.viewPositionToDom(Ae);be?te.collapse(Se.parent,Se.offset):te.extend(Se.parent,Se.offset)}}}}class RawElement extends Element$1{constructor(we,t,te,be){super(we,t,te,be),this.getFillerOffset=getFillerOffset$5}_insertChild(we,t){if(t&&(t instanceof Node$2||Array.from(t).length>0))throw new CKEditorError("view-rawelement-cannot-add",[this,t]);return 0}render(we,t){}}RawElement.prototype.is=function(Te,we){return we?we===this.name&&(Te==="rawElement"||Te==="view:rawElement"||Te==="element"||Te==="view:element"):Te==="rawElement"||Te==="view:rawElement"||Te===this.name||Te==="view:"+this.name||Te==="element"||Te==="view:element"||Te==="node"||Te==="view:node"};function getFillerOffset$5(){return null}let DocumentFragment$1=class extends EmitterMixin(TypeCheckable$1){constructor(t,te){super();Re(this,"document");Re(this,"_children",[]);Re(this,"_customProperties",new Map);this.document=t,te&&this._insertChild(0,te)}[Symbol.iterator](){return this._children[Symbol.iterator]()}get childCount(){return this._children.length}get isEmpty(){return this.childCount===0}get root(){return this}get parent(){return null}get name(){}get getFillerOffset(){}getCustomProperty(t){return this._customProperties.get(t)}*getCustomProperties(){yield*this._customProperties.entries()}_appendChild(t){return this._insertChild(this.childCount,t)}getChild(t){return this._children[t]}getChildIndex(t){return this._children.indexOf(t)}getChildren(){return this._children[Symbol.iterator]()}_insertChild(t,te){this._fireChange("children",this);let be=0;const xe=normalize$2(this.document,te);for(const ve of xe)ve.parent!==null&&ve._remove(),ve.parent=this,this._children.splice(t,0,ve),t++,be++;return be}_removeChildren(t,te=1){this._fireChange("children",this);for(let be=t;be<t+te;be++)this._children[be].parent=null;return this._children.splice(t,te)}_fireChange(t,te){this.fire("change:"+t,te)}_setCustomProperty(t,te){this._customProperties.set(t,te)}_removeCustomProperty(t){return this._customProperties.delete(t)}};DocumentFragment$1.prototype.is=function(Te){return Te==="documentFragment"||Te==="view:documentFragment"};function normalize$2(Te,we){return typeof we=="string"?[new Text$1(Te,we)]:(isIterable(we)||(we=[we]),Array.from(we).map(t=>typeof t=="string"?new Text$1(Te,t):t instanceof TextProxy$1?new Text$1(Te,t.data):t))}class DowncastWriter{constructor(we){Re(this,"document");Re(this,"_cloneGroups",new Map);Re(this,"_slotFactory",null);this.document=we}setSelection(...we){this.document.selection._setTo(...we)}setSelectionFocus(we,t){this.document.selection._setFocus(we,t)}createDocumentFragment(we){return new DocumentFragment$1(this.document,we)}createText(we){return new Text$1(this.document,we)}createAttributeElement(we,t,te={}){const be=new AttributeElement(this.document,we,t);return typeof te.priority=="number"&&(be._priority=te.priority),te.id&&(be._id=te.id),te.renderUnsafeAttributes&&be._unsafeAttributesToRender.push(...te.renderUnsafeAttributes),be}createContainerElement(we,t,te={},be={}){let xe=null;isPlainObject(te)?be=te:xe=te;const ve=new ContainerElement(this.document,we,t,xe);return be.renderUnsafeAttributes&&ve._unsafeAttributesToRender.push(...be.renderUnsafeAttributes),ve}createEditableElement(we,t,te={}){const be=new EditableElement(this.document,we,t);return te.renderUnsafeAttributes&&be._unsafeAttributesToRender.push(...te.renderUnsafeAttributes),be}createEmptyElement(we,t,te={}){const be=new EmptyElement(this.document,we,t);return te.renderUnsafeAttributes&&be._unsafeAttributesToRender.push(...te.renderUnsafeAttributes),be}createUIElement(we,t,te){const be=new UIElement(this.document,we,t);return te&&(be.render=te),be}createRawElement(we,t,te,be={}){const xe=new RawElement(this.document,we,t);return te&&(xe.render=te),be.renderUnsafeAttributes&&xe._unsafeAttributesToRender.push(...be.renderUnsafeAttributes),xe}setAttribute(we,t,te){te._setAttribute(we,t)}removeAttribute(we,t){t._removeAttribute(we)}addClass(we,t){t._addClass(we)}removeClass(we,t){t._removeClass(we)}setStyle(we,t,te){isPlainObject(we)&&te===void 0?t._setStyle(we):te._setStyle(we,t)}removeStyle(we,t){t._removeStyle(we)}setCustomProperty(we,t,te){te._setCustomProperty(we,t)}removeCustomProperty(we,t){return t._removeCustomProperty(we)}breakAttributes(we){return we instanceof Position$1?this._breakAttributes(we):this._breakAttributesRange(we)}breakContainer(we){const t=we.parent;if(!t.is("containerElement"))throw new CKEditorError("view-writer-break-non-container-element",this.document);if(!t.parent)throw new CKEditorError("view-writer-break-root",this.document);if(we.isAtStart)return Position$1._createBefore(t);if(!we.isAtEnd){const te=t._clone(!1);this.insert(Position$1._createAfter(t),te);const be=new Range$1(we,Position$1._createAt(t,"end")),xe=new Position$1(te,0);this.move(be,xe)}return Position$1._createAfter(t)}mergeAttributes(we){const t=we.offset,te=we.parent;if(te.is("$text"))return we;if(te.is("attributeElement")&&te.childCount===0){const ve=te.parent,ke=te.index;return te._remove(),this._removeFromClonedElementsGroup(te),this.mergeAttributes(new Position$1(ve,ke))}const be=te.getChild(t-1),xe=te.getChild(t);if(!be||!xe)return we;if(be.is("$text")&&xe.is("$text"))return mergeTextNodes(be,xe);if(be.is("attributeElement")&&xe.is("attributeElement")&&be.isSimilar(xe)){const ve=be.childCount;return be._appendChild(xe.getChildren()),xe._remove(),this._removeFromClonedElementsGroup(xe),this.mergeAttributes(new Position$1(be,ve))}return we}mergeContainers(we){const t=we.nodeBefore,te=we.nodeAfter;if(!t||!te||!t.is("containerElement")||!te.is("containerElement"))throw new CKEditorError("view-writer-merge-containers-invalid-position",this.document);const be=t.getChild(t.childCount-1),xe=be instanceof Text$1?Position$1._createAt(be,"end"):Position$1._createAt(t,"end");return this.move(Range$1._createIn(te),Position$1._createAt(t,"end")),this.remove(Range$1._createOn(te)),xe}insert(we,t){t=isIterable(t)?[...t]:[t],validateNodesToInsert(t,this.document);const te=t.reduce((ve,ke)=>{const Ie=ve[ve.length-1],Ae=!ke.is("uiElement");return!Ie||Ie.breakAttributes!=Ae?ve.push({breakAttributes:Ae,nodes:[ke]}):Ie.nodes.push(ke),ve},[]);let be=null,xe=we;for(const{nodes:ve,breakAttributes:ke}of te){const Ie=this._insertNodes(xe,ve,ke);be||(be=Ie.start),xe=Ie.end}return be?new Range$1(be,xe):new Range$1(we)}remove(we){const t=we instanceof Range$1?we:Range$1._createOn(we);if(validateRangeContainer(t,this.document),t.isCollapsed)return new DocumentFragment$1(this.document);const{start:te,end:be}=this._breakAttributesRange(t,!0),xe=te.parent,ve=be.offset-te.offset,ke=xe._removeChildren(te.offset,ve);for(const Ae of ke)this._removeFromClonedElementsGroup(Ae);const Ie=this.mergeAttributes(te);return t.start=Ie,t.end=Ie.clone(),new DocumentFragment$1(this.document,ke)}clear(we,t){validateRangeContainer(we,this.document);const te=we.getWalker({direction:"backward",ignoreElementEnd:!0});for(const be of te){const xe=be.item;let ve;if(xe.is("element")&&t.isSimilar(xe))ve=Range$1._createOn(xe);else if(!be.nextPosition.isAfter(we.start)&&xe.is("$textProxy")){const ke=xe.getAncestors().find(Ie=>Ie.is("element")&&t.isSimilar(Ie));ke&&(ve=Range$1._createIn(ke))}ve&&(ve.end.isAfter(we.end)&&(ve.end=we.end),ve.start.isBefore(we.start)&&(ve.start=we.start),this.remove(ve))}}move(we,t){let te;if(t.isAfter(we.end)){t=this._breakAttributes(t,!0);const be=t.parent,xe=be.childCount;we=this._breakAttributesRange(we,!0),te=this.remove(we),t.offset+=be.childCount-xe}else te=this.remove(we);return this.insert(t,te)}wrap(we,t){if(!(t instanceof AttributeElement))throw new CKEditorError("view-writer-wrap-invalid-attribute",this.document);if(validateRangeContainer(we,this.document),we.isCollapsed){let te=we.start;te.parent.is("element")&&!_hasNonUiChildren(te.parent)&&(te=te.getLastMatchingPosition(xe=>xe.item.is("uiElement"))),te=this._wrapPosition(te,t);const be=this.document.selection;return be.isCollapsed&&be.getFirstPosition().isEqual(we.start)&&this.setSelection(te),new Range$1(te)}else return this._wrapRange(we,t)}unwrap(we,t){if(!(t instanceof AttributeElement))throw new CKEditorError("view-writer-unwrap-invalid-attribute",this.document);if(validateRangeContainer(we,this.document),we.isCollapsed)return we;const{start:te,end:be}=this._breakAttributesRange(we,!0),xe=te.parent,ve=this._unwrapChildren(xe,te.offset,be.offset,t),ke=this.mergeAttributes(ve.start);ke.isEqual(ve.start)||ve.end.offset--;const Ie=this.mergeAttributes(ve.end);return new Range$1(ke,Ie)}rename(we,t){const te=new ContainerElement(this.document,we,t.getAttributes());return this.insert(Position$1._createAfter(t),te),this.move(Range$1._createIn(t),Position$1._createAt(te,0)),this.remove(Range$1._createOn(t)),te}clearClonedElementsGroup(we){this._cloneGroups.delete(we)}createPositionAt(we,t){return Position$1._createAt(we,t)}createPositionAfter(we){return Position$1._createAfter(we)}createPositionBefore(we){return Position$1._createBefore(we)}createRange(we,t){return new Range$1(we,t)}createRangeOn(we){return Range$1._createOn(we)}createRangeIn(we){return Range$1._createIn(we)}createSelection(...we){return new Selection$1(...we)}createSlot(we="children"){if(!this._slotFactory)throw new CKEditorError("view-writer-invalid-create-slot-context",this.document);return this._slotFactory(this,we)}_registerSlotFactory(we){this._slotFactory=we}_clearSlotFactory(){this._slotFactory=null}_insertNodes(we,t,te){let be;if(te?be=getParentContainer(we):be=we.parent.is("$text")?we.parent.parent:we.parent,!be)throw new CKEditorError("view-writer-invalid-position-container",this.document);let xe;te?xe=this._breakAttributes(we,!0):xe=we.parent.is("$text")?breakTextNode(we):we;const ve=be._insertChild(xe.offset,t);for(const Se of t)this._addToClonedElementsGroup(Se);const ke=xe.getShiftedBy(ve),Ie=this.mergeAttributes(xe);Ie.isEqual(xe)||ke.offset--;const Ae=this.mergeAttributes(ke);return new Range$1(Ie,Ae)}_wrapChildren(we,t,te,be){let xe=t;const ve=[];for(;xe<te;){const Ie=we.getChild(xe),Ae=Ie.is("$text"),Se=Ie.is("attributeElement");if(Se&&this._wrapAttributeElement(be,Ie))ve.push(new Position$1(we,xe));else if(Ae||!Se||shouldABeOutsideB(be,Ie)){const Oe=be._clone();Ie._remove(),Oe._appendChild(Ie),we._insertChild(xe,Oe),this._addToClonedElementsGroup(Oe),ve.push(new Position$1(we,xe))}else this._wrapChildren(Ie,0,Ie.childCount,be);xe++}let ke=0;for(const Ie of ve){if(Ie.offset-=ke,Ie.offset==t)continue;this.mergeAttributes(Ie).isEqual(Ie)||(ke++,te--)}return Range$1._createFromParentsAndOffsets(we,t,we,te)}_unwrapChildren(we,t,te,be){let xe=t;const ve=[];for(;xe<te;){const Ie=we.getChild(xe);if(!Ie.is("attributeElement")){xe++;continue}if(Ie.isSimilar(be)){const Ae=Ie.getChildren(),Se=Ie.childCount;Ie._remove(),we._insertChild(xe,Ae),this._removeFromClonedElementsGroup(Ie),ve.push(new Position$1(we,xe),new Position$1(we,xe+Se)),xe+=Se,te+=Se-1;continue}if(this._unwrapAttributeElement(be,Ie)){ve.push(new Position$1(we,xe),new Position$1(we,xe+1)),xe++;continue}this._unwrapChildren(Ie,0,Ie.childCount,be),xe++}let ke=0;for(const Ie of ve){if(Ie.offset-=ke,Ie.offset==t||Ie.offset==te)continue;this.mergeAttributes(Ie).isEqual(Ie)||(ke++,te--)}return Range$1._createFromParentsAndOffsets(we,t,we,te)}_wrapRange(we,t){const{start:te,end:be}=this._breakAttributesRange(we,!0),xe=te.parent,ve=this._wrapChildren(xe,te.offset,be.offset,t),ke=this.mergeAttributes(ve.start);ke.isEqual(ve.start)||ve.end.offset--;const Ie=this.mergeAttributes(ve.end);return new Range$1(ke,Ie)}_wrapPosition(we,t){if(t.isSimilar(we.parent))return movePositionToTextNode(we.clone());we.parent.is("$text")&&(we=breakTextNode(we));const te=this.createAttributeElement("_wrapPosition-fake-element");te._priority=Number.POSITIVE_INFINITY,te.isSimilar=()=>!1,we.parent._insertChild(we.offset,te);const be=new Range$1(we,we.getShiftedBy(1));this.wrap(be,t);const xe=new Position$1(te.parent,te.index);te._remove();const ve=xe.nodeBefore,ke=xe.nodeAfter;return ve instanceof Text$1&&ke instanceof Text$1?mergeTextNodes(ve,ke):movePositionToTextNode(xe)}_wrapAttributeElement(we,t){if(!canBeJoined(we,t)||we.name!==t.name||we.priority!==t.priority)return!1;for(const te of we.getAttributeKeys())if(!(te==="class"||te==="style")&&t.hasAttribute(te)&&t.getAttribute(te)!==we.getAttribute(te))return!1;for(const te of we.getStyleNames())if(t.hasStyle(te)&&t.getStyle(te)!==we.getStyle(te))return!1;for(const te of we.getAttributeKeys())te==="class"||te==="style"||t.hasAttribute(te)||this.setAttribute(te,we.getAttribute(te),t);for(const te of we.getStyleNames())t.hasStyle(te)||this.setStyle(te,we.getStyle(te),t);for(const te of we.getClassNames())t.hasClass(te)||this.addClass(te,t);return!0}_unwrapAttributeElement(we,t){if(!canBeJoined(we,t)||we.name!==t.name||we.priority!==t.priority)return!1;for(const te of we.getAttributeKeys())if(!(te==="class"||te==="style")&&(!t.hasAttribute(te)||t.getAttribute(te)!==we.getAttribute(te)))return!1;if(!t.hasClass(...we.getClassNames()))return!1;for(const te of we.getStyleNames())if(!t.hasStyle(te)||t.getStyle(te)!==we.getStyle(te))return!1;for(const te of we.getAttributeKeys())te==="class"||te==="style"||this.removeAttribute(te,t);return this.removeClass(Array.from(we.getClassNames()),t),this.removeStyle(Array.from(we.getStyleNames()),t),!0}_breakAttributesRange(we,t=!1){const te=we.start,be=we.end;if(validateRangeContainer(we,this.document),we.isCollapsed){const Ie=this._breakAttributes(we.start,t);return new Range$1(Ie,Ie)}const xe=this._breakAttributes(be,t),ve=xe.parent.childCount,ke=this._breakAttributes(te,t);return xe.offset+=xe.parent.childCount-ve,new Range$1(ke,xe)}_breakAttributes(we,t=!1){const te=we.offset,be=we.parent;if(we.parent.is("emptyElement"))throw new CKEditorError("view-writer-cannot-break-empty-element",this.document);if(we.parent.is("uiElement"))throw new CKEditorError("view-writer-cannot-break-ui-element",this.document);if(we.parent.is("rawElement"))throw new CKEditorError("view-writer-cannot-break-raw-element",this.document);if(!t&&be.is("$text")&&isContainerOrFragment(be.parent)||isContainerOrFragment(be))return we.clone();if(be.is("$text"))return this._breakAttributes(breakTextNode(we),t);const xe=be.childCount;if(te==xe){const ve=new Position$1(be.parent,be.index+1);return this._breakAttributes(ve,t)}else if(te===0){const ve=new Position$1(be.parent,be.index);return this._breakAttributes(ve,t)}else{const ve=be.index+1,ke=be._clone();be.parent._insertChild(ve,ke),this._addToClonedElementsGroup(ke);const Ie=be.childCount-te,Ae=be._removeChildren(te,Ie);ke._appendChild(Ae);const Se=new Position$1(be.parent,ve);return this._breakAttributes(Se,t)}}_addToClonedElementsGroup(we){if(!we.root.is("rootElement"))return;if(we.is("element"))for(const be of we.getChildren())this._addToClonedElementsGroup(be);const t=we.id;if(!t)return;let te=this._cloneGroups.get(t);te||(te=new Set,this._cloneGroups.set(t,te)),te.add(we),we._clonesGroup=te}_removeFromClonedElementsGroup(we){if(we.is("element"))for(const be of we.getChildren())this._removeFromClonedElementsGroup(be);const t=we.id;if(!t)return;const te=this._cloneGroups.get(t);te&&te.delete(we)}}function _hasNonUiChildren(Te){return Array.from(Te.getChildren()).some(we=>!we.is("uiElement"))}function getParentContainer(Te){let we=Te.parent;for(;!isContainerOrFragment(we);){if(!we)return;we=we.parent}return we}function shouldABeOutsideB(Te,we){return Te.priority<we.priority?!0:Te.priority>we.priority?!1:Te.getIdentity()<we.getIdentity()}function movePositionToTextNode(Te){const we=Te.nodeBefore;if(we&&we.is("$text"))return new Position$1(we,we.data.length);const t=Te.nodeAfter;return t&&t.is("$text")?new Position$1(t,0):Te}function breakTextNode(Te){if(Te.offset==Te.parent.data.length)return new Position$1(Te.parent.parent,Te.parent.index+1);if(Te.offset===0)return new Position$1(Te.parent.parent,Te.parent.index);const we=Te.parent.data.slice(Te.offset);return Te.parent._data=Te.parent.data.slice(0,Te.offset),Te.parent.parent._insertChild(Te.parent.index+1,new Text$1(Te.root.document,we)),new Position$1(Te.parent.parent,Te.parent.index+1)}function mergeTextNodes(Te,we){const t=Te.data.length;return Te._data+=we.data,we._remove(),new Position$1(Te,t)}const validNodesToInsert=[Text$1,AttributeElement,ContainerElement,EmptyElement,RawElement,UIElement];function validateNodesToInsert(Te,we){for(const t of Te){if(!validNodesToInsert.some(te=>t instanceof te))throw new CKEditorError("view-writer-insert-invalid-node-type",we);t.is("$text")||validateNodesToInsert(t.getChildren(),we)}}function isContainerOrFragment(Te){return Te&&(Te.is("containerElement")||Te.is("documentFragment"))}function validateRangeContainer(Te,we){const t=getParentContainer(Te.start),te=getParentContainer(Te.end);if(!t||!te||t!==te)throw new CKEditorError("view-writer-invalid-range-container",we)}function canBeJoined(Te,we){return Te.id===null&&we.id===null}const NBSP_FILLER=Te=>Te.createTextNode(" "),MARKED_NBSP_FILLER=Te=>{const we=Te.createElement("span");return we.dataset.ckeFiller="true",we.innerText=" ",we},BR_FILLER=Te=>{const we=Te.createElement("br");return we.dataset.ckeFiller="true",we},INLINE_FILLER_LENGTH=7,INLINE_FILLER="⁠".repeat(INLINE_FILLER_LENGTH);function startsWithFiller(Te){return typeof Te=="string"?Te.substr(0,INLINE_FILLER_LENGTH)===INLINE_FILLER:isText(Te)&&Te.data.substr(0,INLINE_FILLER_LENGTH)===INLINE_FILLER}function isInlineFiller(Te){return Te.data.length==INLINE_FILLER_LENGTH&&startsWithFiller(Te)}function getDataWithoutFiller(Te){const we=typeof Te=="string"?Te:Te.data;return startsWithFiller(Te)?we.slice(INLINE_FILLER_LENGTH):we}function injectQuirksHandling(Te){Te.document.on("arrowKey",jumpOverInlineFiller,{priority:"low"})}function jumpOverInlineFiller(Te,we){if(we.keyCode==keyCodes.arrowleft){const t=we.domTarget.ownerDocument.defaultView.getSelection();if(t.rangeCount==1&&t.getRangeAt(0).collapsed){const te=t.getRangeAt(0).startContainer,be=t.getRangeAt(0).startOffset;startsWithFiller(te)&&be<=INLINE_FILLER_LENGTH&&t.collapse(te,0)}}}let Renderer$1=class extends ObservableMixin(){constructor(t,te){super();Re(this,"domDocuments",new Set);Re(this,"domConverter");Re(this,"markedAttributes",new Set);Re(this,"markedChildren",new Set);Re(this,"markedTexts",new Set);Re(this,"selection");Re(this,"_inlineFiller",null);Re(this,"_fakeSelectionContainer",null);this.domConverter=t,this.selection=te,this.set("isFocused",!1),this.set("isSelecting",!1),env.isBlink&&!env.isAndroid&&this.on("change:isSelecting",()=>{this.isSelecting||this.render()}),this.set("isComposing",!1),this.on("change:isComposing",()=>{this.isComposing||this.render()})}markToSync(t,te){if(t==="text")this.domConverter.mapViewToDom(te.parent)&&this.markedTexts.add(te);else{if(!this.domConverter.mapViewToDom(te))return;if(t==="attributes")this.markedAttributes.add(te);else if(t==="children")this.markedChildren.add(te);else throw new CKEditorError("view-renderer-unknown-type",this)}}render(){if(this.isComposing&&!env.isAndroid)return;let t=null;const te=env.isBlink&&!env.isAndroid?!this.isSelecting:!0;for(const be of this.markedChildren)this._updateChildrenMappings(be);te?(this._inlineFiller&&!this._isSelectionInInlineFiller()&&this._removeInlineFiller(),this._inlineFiller?t=this._getInlineFillerPosition():this._needsInlineFillerAtSelection()&&(t=this.selection.getFirstPosition(),this.markedChildren.add(t.parent))):this._inlineFiller&&this._inlineFiller.parentNode&&(t=this.domConverter.domPositionToView(this._inlineFiller),t&&t.parent.is("$text")&&(t=Position$1._createBefore(t.parent)));for(const be of this.markedAttributes)this._updateAttrs(be);for(const be of this.markedChildren)this._updateChildren(be,{inlineFillerPosition:t});for(const be of this.markedTexts)!this.markedChildren.has(be.parent)&&this.domConverter.mapViewToDom(be.parent)&&this._updateText(be,{inlineFillerPosition:t});if(te)if(t){const be=this.domConverter.viewPositionToDom(t),xe=be.parent.ownerDocument;startsWithFiller(be.parent)?this._inlineFiller=be.parent:this._inlineFiller=addInlineFiller(xe,be.parent,be.offset)}else this._inlineFiller=null;this._updateFocus(),this._updateSelection(),this.domConverter._clearTemporaryCustomProperties(),this.markedTexts.clear(),this.markedAttributes.clear(),this.markedChildren.clear()}_updateChildrenMappings(t){const te=this.domConverter.mapViewToDom(t);if(!te)return;const be=Array.from(te.childNodes),xe=Array.from(this.domConverter.viewChildrenToDom(t,{withChildren:!1})),ve=this._diffNodeLists(be,xe),ke=this._findUpdateActions(ve,be,xe,areSimilarElements);if(ke.indexOf("update")!==-1){const Ie={equal:0,insert:0,delete:0};for(const Ae of ke)if(Ae==="update"){const Se=Ie.equal+Ie.insert,Oe=Ie.equal+Ie.delete,Ve=t.getChild(Se);Ve&&!Ve.is("uiElement")&&!Ve.is("rawElement")&&this._updateElementMappings(Ve,be[Oe]),remove$1(xe[Se]),Ie.equal++}else Ie[Ae]++}}_updateElementMappings(t,te){this.domConverter.unbindDomElement(te),this.domConverter.bindElements(te,t),this.markedChildren.add(t),this.markedAttributes.add(t)}_getInlineFillerPosition(){const t=this.selection.getFirstPosition();return t.parent.is("$text")?Position$1._createBefore(t.parent):t}_isSelectionInInlineFiller(){if(this.selection.rangeCount!=1||!this.selection.isCollapsed)return!1;const t=this.selection.getFirstPosition(),te=this.domConverter.viewPositionToDom(t);return!!(te&&isText(te.parent)&&startsWithFiller(te.parent))}_removeInlineFiller(){const t=this._inlineFiller;if(!startsWithFiller(t))throw new CKEditorError("view-renderer-filler-was-lost",this);isInlineFiller(t)?t.remove():t.data=t.data.substr(INLINE_FILLER_LENGTH),this._inlineFiller=null}_needsInlineFillerAtSelection(){if(this.selection.rangeCount!=1||!this.selection.isCollapsed)return!1;const t=this.selection.getFirstPosition(),te=t.parent,be=t.offset;if(!this.domConverter.mapViewToDom(te.root)||!te.is("element")||!isEditable(te))return!1;const xe=t.nodeBefore,ve=t.nodeAfter;return!(xe instanceof Text$1||ve instanceof Text$1||be===te.getFillerOffset()&&(!xe||!xe.is("element","br"))||env.isAndroid&&(xe||ve))}_updateText(t,te){const be=this.domConverter.findCorrespondingDomText(t);let ve=this.domConverter.viewToDom(t).data;const ke=te.inlineFillerPosition;ke&&ke.parent==t.parent&&ke.offset==t.index&&(ve=INLINE_FILLER+ve),updateTextNode(be,ve)}_updateAttrs(t){const te=this.domConverter.mapViewToDom(t);if(!te)return;const be=Array.from(te.attributes).map(ve=>ve.name),xe=t.getAttributeKeys();for(const ve of xe)this.domConverter.setDomElementAttribute(te,ve,t.getAttribute(ve),t);for(const ve of be)t.hasAttribute(ve)||this.domConverter.removeDomElementAttribute(te,ve)}_updateChildren(t,te){const be=this.domConverter.mapViewToDom(t);if(!be)return;if(env.isAndroid){let Ve=null;for(const Me of Array.from(be.childNodes)){if(Ve&&isText(Ve)&&isText(Me)){be.normalize();break}Ve=Me}}const xe=te.inlineFillerPosition,ve=be.childNodes,ke=Array.from(this.domConverter.viewChildrenToDom(t,{bind:!0}));xe&&xe.parent===t&&addInlineFiller(be.ownerDocument,ke,xe.offset);const Ie=this._diffNodeLists(ve,ke),Ae=this._findUpdateActions(Ie,ve,ke,areTextNodes);let Se=0;const Oe=new Set;for(const Ve of Ae)Ve==="delete"?(Oe.add(ve[Se]),remove$1(ve[Se])):(Ve==="equal"||Ve==="update")&&Se++;Se=0;for(const Ve of Ae)Ve==="insert"?(insertAt(be,Se,ke[Se]),Se++):Ve==="update"?(updateTextNode(ve[Se],ke[Se].data),Se++):Ve==="equal"&&(this._markDescendantTextToSync(this.domConverter.domToView(ke[Se])),Se++);for(const Ve of Oe)Ve.parentNode||this.domConverter.unbindDomElement(Ve)}_diffNodeLists(t,te){return t=filterOutFakeSelectionContainer(t,this._fakeSelectionContainer),diff$1(t,te,sameNodes$1.bind(null,this.domConverter))}_findUpdateActions(t,te,be,xe){if(t.indexOf("insert")===-1||t.indexOf("delete")===-1)return t;let ve=[],ke=[],Ie=[];const Ae={equal:0,insert:0,delete:0};for(const Se of t)Se==="insert"?Ie.push(be[Ae.equal+Ae.insert]):Se==="delete"?ke.push(te[Ae.equal+Ae.delete]):(ve=ve.concat(diff$1(ke,Ie,xe).map(Oe=>Oe==="equal"?"update":Oe)),ve.push("equal"),ke=[],Ie=[]),Ae[Se]++;return ve.concat(diff$1(ke,Ie,xe).map(Se=>Se==="equal"?"update":Se))}_markDescendantTextToSync(t){if(t){if(t.is("$text"))this.markedTexts.add(t);else if(t.is("element"))for(const te of t.getChildren())this._markDescendantTextToSync(te)}}_updateSelection(){if(env.isBlink&&!env.isAndroid&&this.isSelecting&&!this.markedChildren.size)return;if(this.selection.rangeCount===0){this._removeDomSelection(),this._removeFakeSelection();return}const t=this.domConverter.mapViewToDom(this.selection.editableElement);!this.isFocused||!t||(this.selection.isFake?this._updateFakeSelection(t):this._fakeSelectionContainer&&this._fakeSelectionContainer.isConnected?(this._removeFakeSelection(),this._updateDomSelection(t)):this.isComposing&&env.isAndroid||this._updateDomSelection(t))}_updateFakeSelection(t){const te=t.ownerDocument;this._fakeSelectionContainer||(this._fakeSelectionContainer=createFakeSelectionContainer(te));const be=this._fakeSelectionContainer;if(this.domConverter.bindFakeSelection(be,this.selection),!this._fakeSelectionNeedsUpdate(t))return;(!be.parentElement||be.parentElement!=t)&&t.appendChild(be),be.textContent=this.selection.fakeSelectionLabel||" ";const xe=te.getSelection(),ve=te.createRange();xe.removeAllRanges(),ve.selectNodeContents(be),xe.addRange(ve)}_updateDomSelection(t){const te=t.ownerDocument.defaultView.getSelection();if(!this._domSelectionNeedsUpdate(te))return;const be=this.domConverter.viewPositionToDom(this.selection.anchor),xe=this.domConverter.viewPositionToDom(this.selection.focus);te.setBaseAndExtent(be.parent,be.offset,xe.parent,xe.offset),env.isGecko&&fixGeckoSelectionAfterBr(xe,te)}_domSelectionNeedsUpdate(t){if(!this.domConverter.isDomSelectionCorrect(t))return!0;const te=t&&this.domConverter.domSelectionToView(t);return!(te&&this.selection.isEqual(te)||!this.selection.isCollapsed&&this.selection.isSimilar(te))}_fakeSelectionNeedsUpdate(t){const te=this._fakeSelectionContainer,be=t.ownerDocument.getSelection();return!te||te.parentElement!==t||be.anchorNode!==te&&!te.contains(be.anchorNode)?!0:te.textContent!==this.selection.fakeSelectionLabel}_removeDomSelection(){for(const t of this.domDocuments){const te=t.getSelection();if(te.rangeCount){const be=t.activeElement,xe=this.domConverter.mapDomToView(be);be&&xe&&te.removeAllRanges()}}}_removeFakeSelection(){const t=this._fakeSelectionContainer;t&&t.remove()}_updateFocus(){if(this.isFocused){const t=this.selection.editableElement;t&&this.domConverter.focus(t)}}};function isEditable(Te){if(Te.getAttribute("contenteditable")=="false")return!1;const we=Te.findAncestor(t=>t.hasAttribute("contenteditable"));return!we||we.getAttribute("contenteditable")=="true"}function addInlineFiller(Te,we,t){const te=we instanceof Array?we:we.childNodes,be=te[t];if(isText(be))return be.data=INLINE_FILLER+be.data,be;{const xe=Te.createTextNode(INLINE_FILLER);return Array.isArray(we)?te.splice(t,0,xe):insertAt(we,t,xe),xe}}function areSimilarElements(Te,we){return isNode(Te)&&isNode(we)&&!isText(Te)&&!isText(we)&&!isComment(Te)&&!isComment(we)&&Te.tagName.toLowerCase()===we.tagName.toLowerCase()}function areTextNodes(Te,we){return isNode(Te)&&isNode(we)&&isText(Te)&&isText(we)}function sameNodes$1(Te,we,t){return we===t?!0:isText(we)&&isText(t)?we.data===t.data:!!(Te.isBlockFiller(we)&&Te.isBlockFiller(t))}function fixGeckoSelectionAfterBr(Te,we){let t=Te.parent,te=Te.offset;if(isText(t)&&isInlineFiller(t)&&(te=indexOf(t)+1,t=t.parentNode),t.nodeType!=Node.ELEMENT_NODE||te!=t.childNodes.length-1)return;const be=t.childNodes[te];be&&be.tagName=="BR"&&we.addRange(we.getRangeAt(0))}function filterOutFakeSelectionContainer(Te,we){const t=Array.from(Te);return t.length==0||!we||t[t.length-1]==we&&t.pop(),t}function createFakeSelectionContainer(Te){const we=Te.createElement("div");return we.className="ck-fake-selection-container",Object.assign(we.style,{position:"fixed",top:0,left:"-9999px",width:"42px"}),we.textContent=" ",we}function updateTextNode(Te,we){const t=Te.data;if(t==we)return;const te=fastDiff(t,we);for(const be of te)be.type==="insert"?Te.insertData(be.index,be.values.join("")):Te.deleteData(be.index,be.howMany)}const BR_FILLER_REF=BR_FILLER(global.document),NBSP_FILLER_REF=NBSP_FILLER(global.document),MARKED_NBSP_FILLER_REF=MARKED_NBSP_FILLER(global.document),UNSAFE_ATTRIBUTE_NAME_PREFIX="data-ck-unsafe-attribute-",UNSAFE_ELEMENT_REPLACEMENT_ATTRIBUTE="data-ck-unsafe-element";class DomConverter{constructor(we,{blockFillerMode:t,renderingMode:te="editing"}={}){Re(this,"document");Re(this,"renderingMode");Re(this,"blockFillerMode");Re(this,"preElements");Re(this,"blockElements");Re(this,"inlineObjectElements");Re(this,"unsafeElements");Re(this,"_domDocument");Re(this,"_domToViewMapping",new WeakMap);Re(this,"_viewToDomMapping",new WeakMap);Re(this,"_fakeSelectionMapping",new WeakMap);Re(this,"_rawContentElementMatcher",new Matcher);Re(this,"_inlineObjectElementMatcher",new Matcher);Re(this,"_elementsWithTemporaryCustomProperties",new Set);this.document=we,this.renderingMode=te,this.blockFillerMode=t||(te==="editing"?"br":"nbsp"),this.preElements=["pre"],this.blockElements=["address","article","aside","blockquote","caption","center","dd","details","dir","div","dl","dt","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","header","hgroup","legend","li","main","menu","nav","ol","p","pre","section","summary","table","tbody","td","tfoot","th","thead","tr","ul"],this.inlineObjectElements=["object","iframe","input","button","textarea","select","option","video","embed","audio","img","canvas"],this.unsafeElements=["script","style"],this._domDocument=this.renderingMode==="editing"?global.document:global.document.implementation.createHTMLDocument("")}bindFakeSelection(we,t){this._fakeSelectionMapping.set(we,new Selection$1(t))}fakeSelectionToView(we){return this._fakeSelectionMapping.get(we)}bindElements(we,t){this._domToViewMapping.set(we,t),this._viewToDomMapping.set(t,we)}unbindDomElement(we){const t=this._domToViewMapping.get(we);if(t){this._domToViewMapping.delete(we),this._viewToDomMapping.delete(t);for(const te of Array.from(we.children))this.unbindDomElement(te)}}bindDocumentFragments(we,t){this._domToViewMapping.set(we,t),this._viewToDomMapping.set(t,we)}shouldRenderAttribute(we,t,te){return this.renderingMode==="data"?!0:(we=we.toLowerCase(),we.startsWith("on")||we==="srcdoc"&&t.match(/\bon\S+\s*=|javascript:|<\s*\/*script/i)?!1:te==="img"&&(we==="src"||we==="srcset")||te==="source"&&we==="srcset"?!0:!t.match(/^\s*(javascript:|data:(image\/svg|text\/x?html))/i))}setContentOf(we,t){if(this.renderingMode==="data"){we.innerHTML=t;return}const te=new DOMParser().parseFromString(t,"text/html"),be=te.createDocumentFragment(),xe=te.body.childNodes;for(;xe.length>0;)be.appendChild(xe[0]);const ve=te.createTreeWalker(be,NodeFilter.SHOW_ELEMENT),ke=[];let Ie;for(;Ie=ve.nextNode();)ke.push(Ie);for(const Ae of ke){for(const Oe of Ae.getAttributeNames())this.setDomElementAttribute(Ae,Oe,Ae.getAttribute(Oe));const Se=Ae.tagName.toLowerCase();this._shouldRenameElement(Se)&&(_logUnsafeElement(Se),Ae.replaceWith(this._createReplacementDomElement(Se,Ae)))}for(;we.firstChild;)we.firstChild.remove();we.append(be)}viewToDom(we,t={}){if(we.is("$text")){const te=this._processDataFromViewText(we);return this._domDocument.createTextNode(te)}else{const te=we;if(this.mapViewToDom(te))if(te.getCustomProperty("editingPipeline:doNotReuseOnce"))this._elementsWithTemporaryCustomProperties.add(te);else return this.mapViewToDom(te);let be;if(te.is("documentFragment"))be=this._domDocument.createDocumentFragment(),t.bind&&this.bindDocumentFragments(be,te);else{if(te.is("uiElement"))return te.name==="$comment"?be=this._domDocument.createComment(te.getCustomProperty("$rawContent")):be=te.render(this._domDocument,this),t.bind&&this.bindElements(be,te),be;this._shouldRenameElement(te.name)?(_logUnsafeElement(te.name),be=this._createReplacementDomElement(te.name)):te.hasAttribute("xmlns")?be=this._domDocument.createElementNS(te.getAttribute("xmlns"),te.name):be=this._domDocument.createElement(te.name),te.is("rawElement")&&te.render(be,this),t.bind&&this.bindElements(be,te);for(const xe of te.getAttributeKeys())this.setDomElementAttribute(be,xe,te.getAttribute(xe),te)}if(t.withChildren!==!1)for(const xe of this.viewChildrenToDom(te,t))be instanceof HTMLTemplateElement?be.content.appendChild(xe):be.appendChild(xe);return be}}setDomElementAttribute(we,t,te,be){const xe=this.shouldRenderAttribute(t,te,we.tagName.toLowerCase())||be&&be.shouldRenderUnsafeAttribute(t);if(xe||logWarning("domconverter-unsafe-attribute-detected",{domElement:we,key:t,value:te}),!isValidAttributeName(t)){logWarning("domconverter-invalid-attribute-detected",{domElement:we,key:t,value:te});return}we.hasAttribute(t)&&!xe?we.removeAttribute(t):we.hasAttribute(UNSAFE_ATTRIBUTE_NAME_PREFIX+t)&&xe&&we.removeAttribute(UNSAFE_ATTRIBUTE_NAME_PREFIX+t),we.setAttribute(xe?t:UNSAFE_ATTRIBUTE_NAME_PREFIX+t,te)}removeDomElementAttribute(we,t){t!=UNSAFE_ELEMENT_REPLACEMENT_ATTRIBUTE&&(we.removeAttribute(t),we.removeAttribute(UNSAFE_ATTRIBUTE_NAME_PREFIX+t))}*viewChildrenToDom(we,t={}){const te=we.getFillerOffset&&we.getFillerOffset();let be=0;for(const xe of we.getChildren()){te===be&&(yield this._getBlockFiller());const ve=xe.is("element")&&!!xe.getCustomProperty("dataPipeline:transparentRendering")&&!first(xe.getAttributes());ve&&this.renderingMode=="data"?yield*this.viewChildrenToDom(xe,t):(ve&&logWarning("domconverter-transparent-rendering-unsupported-in-editing-pipeline",{viewElement:xe}),yield this.viewToDom(xe,t)),be++}te===be&&(yield this._getBlockFiller())}viewRangeToDom(we){const t=this.viewPositionToDom(we.start),te=this.viewPositionToDom(we.end),be=this._domDocument.createRange();return be.setStart(t.parent,t.offset),be.setEnd(te.parent,te.offset),be}viewPositionToDom(we){const t=we.parent;if(t.is("$text")){const te=this.findCorrespondingDomText(t);if(!te)return null;let be=we.offset;return startsWithFiller(te)&&(be+=INLINE_FILLER_LENGTH),{parent:te,offset:be}}else{let te,be,xe;if(we.offset===0){if(te=this.mapViewToDom(t),!te)return null;xe=te.childNodes[0]}else{const ke=we.nodeBefore;if(be=ke.is("$text")?this.findCorrespondingDomText(ke):this.mapViewToDom(ke),!be)return null;te=be.parentNode,xe=be.nextSibling}if(isText(xe)&&startsWithFiller(xe))return{parent:xe,offset:INLINE_FILLER_LENGTH};const ve=be?indexOf(be)+1:0;return{parent:te,offset:ve}}}domToView(we,t={}){const te=[],be=this._domToView(we,t,te),xe=be.next().value;return!xe||(be.next(),this._processDomInlineNodes(null,te,t),xe.is("$text")&&xe.data.length==0)?null:xe}*domChildrenToView(we,t={},te=[]){let be=[];we instanceof HTMLTemplateElement?be=[...we.content.childNodes]:be=[...we.childNodes];for(let xe=0;xe<be.length;xe++){const ve=be[xe],ke=this._domToView(ve,t,te),Ie=ke.next().value;Ie!==null&&(this._isBlockViewElement(Ie)&&this._processDomInlineNodes(we,te,t),yield Ie,ke.next())}this._processDomInlineNodes(we,te,t)}domSelectionToView(we){if(isGeckoRestrictedDomSelection(we))return new Selection$1([]);if(we.rangeCount===1){let be=we.getRangeAt(0).startContainer;isText(be)&&(be=be.parentNode);const xe=this.fakeSelectionToView(be);if(xe)return xe}const t=this.isDomSelectionBackward(we),te=[];for(let be=0;be<we.rangeCount;be++){const xe=we.getRangeAt(be),ve=this.domRangeToView(xe);ve&&te.push(ve)}return new Selection$1(te,{backward:t})}domRangeToView(we){const t=this.domPositionToView(we.startContainer,we.startOffset),te=this.domPositionToView(we.endContainer,we.endOffset);return t&&te?new Range$1(t,te):null}domPositionToView(we,t=0){if(this.isBlockFiller(we))return this.domPositionToView(we.parentNode,indexOf(we));const te=this.mapDomToView(we);if(te&&(te.is("uiElement")||te.is("rawElement")))return Position$1._createBefore(te);if(isText(we)){if(isInlineFiller(we))return this.domPositionToView(we.parentNode,indexOf(we));const be=this.findCorrespondingViewText(we);let xe=t;return be?(startsWithFiller(we)&&(xe-=INLINE_FILLER_LENGTH,xe=xe<0?0:xe),new Position$1(be,xe)):null}else{if(t===0){const be=this.mapDomToView(we);if(be)return new Position$1(be,0)}else{const be=we.childNodes[t-1];if(isText(be)&&isInlineFiller(be)||be&&this.isBlockFiller(be))return this.domPositionToView(be.parentNode,indexOf(be));const xe=isText(be)?this.findCorrespondingViewText(be):this.mapDomToView(be);if(xe&&xe.parent)return new Position$1(xe.parent,xe.index+1)}return null}}mapDomToView(we){return this.getHostViewElement(we)||this._domToViewMapping.get(we)}findCorrespondingViewText(we){if(isInlineFiller(we))return null;const t=this.getHostViewElement(we);if(t)return t;const te=we.previousSibling;if(te){if(!this.isElement(te))return null;const be=this.mapDomToView(te);if(be){const xe=be.nextSibling;return xe instanceof Text$1?xe:null}}else{const be=this.mapDomToView(we.parentNode);if(be){const xe=be.getChild(0);return xe instanceof Text$1?xe:null}}return null}mapViewToDom(we){return this._viewToDomMapping.get(we)}findCorrespondingDomText(we){const t=we.previousSibling;return t&&this.mapViewToDom(t)?this.mapViewToDom(t).nextSibling:!t&&we.parent&&this.mapViewToDom(we.parent)?this.mapViewToDom(we.parent).childNodes[0]:null}focus(we){const t=this.mapViewToDom(we);if(t&&t.ownerDocument.activeElement!==t){const{scrollX:te,scrollY:be}=global.window,xe=[];forEachDomElementAncestor(t,ve=>{const{scrollLeft:ke,scrollTop:Ie}=ve;xe.push([ke,Ie])}),t.focus(),forEachDomElementAncestor(t,ve=>{const[ke,Ie]=xe.shift();ve.scrollLeft=ke,ve.scrollTop=Ie}),global.window.scrollTo(te,be)}}_clearDomSelection(){const we=this.mapViewToDom(this.document.selection.editableElement);if(!we)return;const t=we.ownerDocument.defaultView.getSelection(),te=this.domSelectionToView(t);te&&te.rangeCount>0&&t.removeAllRanges()}isElement(we){return we&&we.nodeType==Node.ELEMENT_NODE}isDocumentFragment(we){return we&&we.nodeType==Node.DOCUMENT_FRAGMENT_NODE}isBlockFiller(we){return this.blockFillerMode=="br"?we.isEqualNode(BR_FILLER_REF):we.tagName==="BR"&&hasBlockParent(we,this.blockElements)&&we.parentNode.childNodes.length===1?!0:we.isEqualNode(MARKED_NBSP_FILLER_REF)||isNbspBlockFiller(we,this.blockElements)}isDomSelectionBackward(we){if(we.isCollapsed)return!1;const t=this._domDocument.createRange();try{t.setStart(we.anchorNode,we.anchorOffset),t.setEnd(we.focusNode,we.focusOffset)}catch{return!1}const te=t.collapsed;return t.detach(),te}getHostViewElement(we){const t=getAncestors(we);for(t.pop();t.length;){const te=t.pop(),be=this._domToViewMapping.get(te);if(be&&(be.is("uiElement")||be.is("rawElement")))return be}return null}isDomSelectionCorrect(we){return this._isDomSelectionPositionCorrect(we.anchorNode,we.anchorOffset)&&this._isDomSelectionPositionCorrect(we.focusNode,we.focusOffset)}registerRawContentMatcher(we){this._rawContentElementMatcher.add(we)}registerInlineObjectMatcher(we){this._inlineObjectElementMatcher.add(we)}_clearTemporaryCustomProperties(){for(const we of this._elementsWithTemporaryCustomProperties)we._removeCustomProperty("editingPipeline:doNotReuseOnce");this._elementsWithTemporaryCustomProperties.clear()}_getBlockFiller(){switch(this.blockFillerMode){case"nbsp":return NBSP_FILLER(this._domDocument);case"markedNbsp":return MARKED_NBSP_FILLER(this._domDocument);case"br":return BR_FILLER(this._domDocument)}}_isDomSelectionPositionCorrect(we,t){if(isText(we)&&startsWithFiller(we)&&t<INLINE_FILLER_LENGTH||this.isElement(we)&&startsWithFiller(we.childNodes[t]))return!1;const te=this.mapDomToView(we);return!(te&&(te.is("uiElement")||te.is("rawElement")))}*_domToView(we,t,te){if(this.isBlockFiller(we))return null;const be=this.getHostViewElement(we);if(be)return be;if(isComment(we)&&t.skipComments)return null;if(isText(we)){if(isInlineFiller(we))return null;{const xe=we.data;if(xe==="")return null;const ve=new Text$1(this.document,xe);return te.push(ve),ve}}else{let xe=this.mapDomToView(we);if(xe)return this._isInlineObjectElement(xe)&&te.push(xe),xe;if(this.isDocumentFragment(we))xe=new DocumentFragment$1(this.document),t.bind&&this.bindDocumentFragments(we,xe);else{xe=this._createViewElement(we,t),t.bind&&this.bindElements(we,xe);const ke=we.attributes;if(ke)for(let Ie=ke.length,Ae=0;Ae<Ie;Ae++)xe._setAttribute(ke[Ae].name,ke[Ae].value);if(this._isViewElementWithRawContent(xe,t))return xe._setCustomProperty("$rawContent",we.innerHTML),this._isBlockViewElement(xe)||te.push(xe),xe;if(isComment(we))return xe._setCustomProperty("$rawContent",we.data),xe}yield xe;const ve=[];if(t.withChildren!==!1)for(const ke of this.domChildrenToView(we,t,ve))xe._appendChild(ke);if(this._isInlineObjectElement(xe))te.push(xe);else for(const ke of ve)te.push(ke)}}_processDomInlineNodes(we,t,te){if(!t.length||we&&!this.isDocumentFragment(we)&&!this._isBlockDomElement(we))return;let be=!1;for(let xe=0;xe<t.length;xe++){const ve=t[xe];if(!ve.is("$text")){be=!1;continue}let ke,Ie=!1;if(this._isPreFormatted(ve))ke=getDataWithoutFiller(ve.data);else{ke=ve.data.replace(/[ \n\t\r]{1,}/g," "),Ie=/[^\S\u00A0]/.test(ke.charAt(ke.length-1));const Ae=xe>0?t[xe-1]:null,Se=xe+1<t.length?t[xe+1]:null,Oe=!Ae||Ae.is("element")&&Ae.name=="br"||be,Ve=Se?!1:!startsWithFiller(ve.data);te.withChildren!==!1&&(Oe&&(ke=ke.replace(/^ /,"")),Ve&&(ke=ke.replace(/ $/,""))),ke=getDataWithoutFiller(ke),ke=ke.replace(/ \u00A0/g,"  ");const Me=Se&&Se.is("element")&&Se.name!="br",De=Se&&Se.is("$text")&&Se.data.charAt(0)==" ";(/[ \u00A0]\u00A0$/.test(ke)||!Se||Me||De)&&(ke=ke.replace(/\u00A0$/," ")),(Oe||Ae&&Ae.is("element")&&Ae.name!="br")&&(ke=ke.replace(/^\u00A0/," "))}ke.length==0&&ve.parent?(ve._remove(),t.splice(xe,1),xe--):(ve._data=ke,be=Ie)}t.length=0}_processDataFromViewText(we){let t=we.data;if(this._isPreFormatted(we))return t;if(t.charAt(0)==" "){const te=this._getTouchingInlineViewNode(we,!1);(te&&te.is("$textProxy")&&this._nodeEndsWithSpace(te)||!te)&&(t=" "+t.substr(1))}if(t.charAt(t.length-1)==" "){const te=this._getTouchingInlineViewNode(we,!0),be=te&&te.is("$textProxy")&&te.data.charAt(0)==" ";(t.charAt(t.length-2)==" "||!te||be)&&(t=t.substr(0,t.length-1)+" ")}return t.replace(/ {2}/g,"  ")}_nodeEndsWithSpace(we){if(this._isPreFormatted(we))return!1;const t=this._processDataFromViewText(we);return t.charAt(t.length-1)==" "}_isPreFormatted(we){if(_hasViewParentOfType(we,this.preElements))return!0;for(const t of we.getAncestors({parentFirst:!0}))if(!(!t.is("element")||!t.hasStyle("white-space")||t.getStyle("white-space")==="inherit"))return["pre","pre-wrap","break-spaces"].includes(t.getStyle("white-space"));return!1}_getTouchingInlineViewNode(we,t){const te=new TreeWalker$1({startPosition:t?Position$1._createAfter(we):Position$1._createBefore(we),direction:t?"forward":"backward"});for(const be of te){if(be.item.is("element","br"))return null;if(this._isInlineObjectElement(be.item))return be.item;if(be.item.is("containerElement"))return null;if(be.item.is("$textProxy"))return be.item}return null}_isBlockDomElement(we){return this.isElement(we)&&this.blockElements.includes(we.tagName.toLowerCase())}_isBlockViewElement(we){return we.is("element")&&this.blockElements.includes(we.name)}_isInlineObjectElement(we){return we.is("element")?we.name=="br"||this.inlineObjectElements.includes(we.name)||!!this._inlineObjectElementMatcher.match(we):!1}_createViewElement(we,t){if(isComment(we))return new UIElement(this.document,"$comment");const te=t.keepOriginalCase?we.tagName:we.tagName.toLowerCase();return new Element$1(this.document,te)}_isViewElementWithRawContent(we,t){return t.withChildren!==!1&&we.is("element")&&!!this._rawContentElementMatcher.match(we)}_shouldRenameElement(we){const t=we.toLowerCase();return this.renderingMode==="editing"&&this.unsafeElements.includes(t)}_createReplacementDomElement(we,t){const te=this._domDocument.createElement("span");if(te.setAttribute(UNSAFE_ELEMENT_REPLACEMENT_ATTRIBUTE,we),t){for(;t.firstChild;)te.appendChild(t.firstChild);for(const be of t.getAttributeNames())te.setAttribute(be,t.getAttribute(be))}return te}}function _hasViewParentOfType(Te,we){return Te.getAncestors().some(t=>t.is("element")&&we.includes(t.name))}function forEachDomElementAncestor(Te,we){let t=Te;for(;t;)we(t),t=t.parentElement}function isNbspBlockFiller(Te,we){return Te.isEqualNode(NBSP_FILLER_REF)&&hasBlockParent(Te,we)&&Te.parentNode.childNodes.length===1}function hasBlockParent(Te,we){const t=Te.parentNode;return!!t&&!!t.tagName&&we.includes(t.tagName.toLowerCase())}function _logUnsafeElement(Te){Te==="script"&&logWarning("domconverter-unsafe-script-element-detected"),Te==="style"&&logWarning("domconverter-unsafe-style-element-detected")}function isGeckoRestrictedDomSelection(Te){if(!env.isGecko||!Te.rangeCount)return!1;const we=Te.getRangeAt(0).startContainer;try{Object.prototype.toString.call(we)}catch{return!0}return!1}class Observer extends DomEmitterMixin(){constructor(t){super();Re(this,"view");Re(this,"document");Re(this,"_isEnabled",!1);this.view=t,this.document=t.document}get isEnabled(){return this._isEnabled}enable(){this._isEnabled=!0}disable(){this._isEnabled=!1}destroy(){this.disable(),this.stopListening()}checkShouldIgnoreEventFromTarget(t){return t&&t.nodeType===3&&(t=t.parentNode),!t||t.nodeType!==1?!1:t.matches("[data-cke-ignore-events], [data-cke-ignore-events] *")}}class DomEventData{constructor(we,t,te){Re(this,"view");Re(this,"document");Re(this,"domEvent");Re(this,"domTarget");this.view=we,this.document=we.document,this.domEvent=t,this.domTarget=t.target,assignIn(this,te)}get target(){return this.view.domConverter.mapDomToView(this.domTarget)}preventDefault(){this.domEvent.preventDefault()}stopPropagation(){this.domEvent.stopPropagation()}}class DomEventObserver extends Observer{constructor(){super(...arguments);Re(this,"useCapture",!1)}observe(t){(typeof this.domEventType=="string"?[this.domEventType]:this.domEventType).forEach(be=>{this.listenTo(t,be,(xe,ve)=>{this.isEnabled&&!this.checkShouldIgnoreEventFromTarget(ve.target)&&this.onDomEvent(ve)},{useCapture:this.useCapture})})}stopObserving(t){this.stopListening(t)}fire(t,te,be){this.isEnabled&&this.document.fire(t,new DomEventData(this.view,te,be))}}class KeyObserver extends DomEventObserver{constructor(){super(...arguments);Re(this,"domEventType",["keydown","keyup"])}onDomEvent(t){const te={keyCode:t.keyCode,altKey:t.altKey,ctrlKey:t.ctrlKey,shiftKey:t.shiftKey,metaKey:t.metaKey,get keystroke(){return getCode(this)}};this.fire(t.type,t,te)}}class FakeSelectionObserver extends Observer{constructor(t){super(t);Re(this,"_fireSelectionChangeDoneDebounced");this._fireSelectionChangeDoneDebounced=debounce(te=>{this.document.fire("selectionChangeDone",te)},200)}observe(){const t=this.document;t.on("arrowKey",(te,be)=>{t.selection.isFake&&this.isEnabled&&be.preventDefault()},{context:"$capture"}),t.on("arrowKey",(te,be)=>{t.selection.isFake&&this.isEnabled&&this._handleSelectionMove(be.keyCode)},{priority:"lowest"})}stopObserving(){}destroy(){super.destroy(),this._fireSelectionChangeDoneDebounced.cancel()}_handleSelectionMove(t){const te=this.document.selection,be=new Selection$1(te.getRanges(),{backward:te.isBackward,fake:!1});(t==keyCodes.arrowleft||t==keyCodes.arrowup)&&be.setTo(be.getFirstPosition()),(t==keyCodes.arrowright||t==keyCodes.arrowdown)&&be.setTo(be.getLastPosition());const xe={oldSelection:te,newSelection:be,domSelection:null};this.document.fire("selectionChange",xe),this._fireSelectionChangeDoneDebounced(xe)}}let MutationObserver$1=class extends Observer{constructor(t){super(t);Re(this,"domConverter");Re(this,"renderer");Re(this,"_config");Re(this,"_domElements");Re(this,"_mutationObserver");this._config={childList:!0,characterData:!0,subtree:!0},this.domConverter=t.domConverter,this.renderer=t._renderer,this._domElements=new Set,this._mutationObserver=new window.MutationObserver(this._onMutations.bind(this))}flush(){this._onMutations(this._mutationObserver.takeRecords())}observe(t){this._domElements.add(t),this.isEnabled&&this._mutationObserver.observe(t,this._config)}stopObserving(t){if(this._domElements.delete(t),this.isEnabled){this._mutationObserver.disconnect();for(const te of this._domElements)this._mutationObserver.observe(te,this._config)}}enable(){super.enable();for(const t of this._domElements)this._mutationObserver.observe(t,this._config)}disable(){super.disable(),this._mutationObserver.disconnect()}destroy(){super.destroy(),this._mutationObserver.disconnect()}_onMutations(t){if(t.length===0)return;const te=this.domConverter,be=new Set,xe=new Set;for(const ke of t){const Ie=te.mapDomToView(ke.target);Ie&&(Ie.is("uiElement")||Ie.is("rawElement")||ke.type==="childList"&&!this._isBogusBrMutation(ke)&&xe.add(Ie))}for(const ke of t){const Ie=te.mapDomToView(ke.target);if(!(Ie&&(Ie.is("uiElement")||Ie.is("rawElement")))&&ke.type==="characterData"){const Ae=te.findCorrespondingViewText(ke.target);Ae&&!xe.has(Ae.parent)?be.add(Ae):!Ae&&startsWithFiller(ke.target)&&xe.add(te.mapDomToView(ke.target.parentNode))}}let ve=!1;for(const ke of be)ve=!0,this.renderer.markToSync("text",ke);for(const ke of xe){const Ie=te.mapViewToDom(ke),Ae=Array.from(ke.getChildren()),Se=Array.from(te.domChildrenToView(Ie,{withChildren:!1}));isEqualWith(Ae,Se,sameNodes)||(ve=!0,this.renderer.markToSync("children",ke))}ve&&this.view.forceRender()}_isBogusBrMutation(t){let te=null;return t.nextSibling===null&&t.removedNodes.length===0&&t.addedNodes.length==1&&(te=this.domConverter.domToView(t.addedNodes[0],{withChildren:!1})),te&&te.is("element","br")}};function sameNodes(Te,we){if(!Array.isArray(Te))return Te===we?!0:Te.is("$text")&&we.is("$text")?Te.data===we.data:!1}class FocusObserver extends DomEventObserver{constructor(t){super(t);Re(this,"_renderTimeoutId");Re(this,"_isFocusChanging",!1);Re(this,"domEventType",["focus","blur"]);this.useCapture=!0;const te=this.document;te.on("focus",()=>{this._isFocusChanging=!0,this._renderTimeoutId=setTimeout(()=>{this.flush(),t.change(()=>{})},50)}),te.on("blur",(be,xe)=>{const ve=te.selection.editableElement;(ve===null||ve===xe.target)&&(te.isFocused=!1,this._isFocusChanging=!1,t.change(()=>{}))})}flush(){this._isFocusChanging&&(this._isFocusChanging=!1,this.document.isFocused=!0)}onDomEvent(t){this.fire(t.type,t)}destroy(){this._renderTimeoutId&&clearTimeout(this._renderTimeoutId),super.destroy()}}class SelectionObserver extends Observer{constructor(t){super(t);Re(this,"mutationObserver");Re(this,"focusObserver");Re(this,"selection");Re(this,"domConverter");Re(this,"_documents");Re(this,"_fireSelectionChangeDoneDebounced");Re(this,"_clearInfiniteLoopInterval");Re(this,"_documentIsSelectingInactivityTimeoutDebounced");Re(this,"_loopbackCounter");this.mutationObserver=t.getObserver(MutationObserver$1),this.focusObserver=t.getObserver(FocusObserver),this.selection=this.document.selection,this.domConverter=t.domConverter,this._documents=new WeakSet,this._fireSelectionChangeDoneDebounced=debounce(te=>{this.document.fire("selectionChangeDone",te)},200),this._clearInfiniteLoopInterval=setInterval(()=>this._clearInfiniteLoop(),1e3),this._documentIsSelectingInactivityTimeoutDebounced=debounce(()=>this.document.isSelecting=!1,5e3),this._loopbackCounter=0}observe(t){const te=t.ownerDocument,be=()=>{this.document.isSelecting=!0,this._documentIsSelectingInactivityTimeoutDebounced()},xe=()=>{this.document.isSelecting&&(this._handleSelectionChange(null,te),this.document.isSelecting=!1,this._documentIsSelectingInactivityTimeoutDebounced.cancel())};this.listenTo(t,"selectstart",be,{priority:"highest"}),this.listenTo(t,"keydown",xe,{priority:"highest",useCapture:!0}),this.listenTo(t,"keyup",xe,{priority:"highest",useCapture:!0}),!this._documents.has(te)&&(this.listenTo(te,"mouseup",xe,{priority:"highest",useCapture:!0}),this.listenTo(te,"selectionchange",(ve,ke)=>{this.document.isComposing&&!env.isAndroid||(this._handleSelectionChange(ke,te),this._documentIsSelectingInactivityTimeoutDebounced())}),this._documents.add(te))}stopObserving(t){this.stopListening(t)}destroy(){super.destroy(),clearInterval(this._clearInfiniteLoopInterval),this._fireSelectionChangeDoneDebounced.cancel(),this._documentIsSelectingInactivityTimeoutDebounced.cancel()}_reportInfiniteLoop(){}_handleSelectionChange(t,te){if(!this.isEnabled)return;const be=te.defaultView.getSelection();if(this.checkShouldIgnoreEventFromTarget(be.anchorNode))return;this.mutationObserver.flush();const xe=this.domConverter.domSelectionToView(be);if(xe.rangeCount==0){this.view.hasDomSelection=!1;return}if(this.view.hasDomSelection=!0,this.focusObserver.flush(),!(this.selection.isEqual(xe)&&this.domConverter.isDomSelectionCorrect(be))){if(++this._loopbackCounter>60){this._reportInfiniteLoop();return}if(this.selection.isSimilar(xe))this.view.forceRender();else{const ve={oldSelection:this.selection,newSelection:xe,domSelection:be};this.document.fire("selectionChange",ve),this._fireSelectionChangeDoneDebounced(ve)}}}_clearInfiniteLoop(){this._loopbackCounter=0}}class CompositionObserver extends DomEventObserver{constructor(t){super(t);Re(this,"domEventType",["compositionstart","compositionupdate","compositionend"]);const te=this.document;te.on("compositionstart",()=>{te.isComposing=!0},{priority:"low"}),te.on("compositionend",()=>{te.isComposing=!1},{priority:"low"})}onDomEvent(t){this.fire(t.type,t,{data:t.data})}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */let DataTransfer$1=class{constructor(we,t={}){Re(this,"_files");Re(this,"_native");this._files=t.cacheFiles?getFiles(we):null,this._native=we}get files(){return this._files||(this._files=getFiles(this._native)),this._files}get types(){return this._native.types}getData(we){return this._native.getData(we)}setData(we,t){this._native.setData(we,t)}set effectAllowed(we){this._native.effectAllowed=we}get effectAllowed(){return this._native.effectAllowed}set dropEffect(we){this._native.dropEffect=we}get dropEffect(){return this._native.dropEffect}setDragImage(we,t,te){this._native.setDragImage(we,t,te)}get isCanceled(){return this._native.dropEffect=="none"||!!this._native.mozUserCancelled}};function getFiles(Te){const we=Array.from(Te.files||[]),t=Array.from(Te.items||[]);return we.length?we:t.filter(te=>te.kind==="file").map(te=>te.getAsFile())}class InputObserver extends DomEventObserver{constructor(){super(...arguments);Re(this,"domEventType","beforeinput")}onDomEvent(t){const te=t.getTargetRanges(),be=this.view,xe=be.document;let ve=null,ke=null,Ie=[];if(t.dataTransfer&&(ve=new DataTransfer$1(t.dataTransfer)),t.data!==null?ke=t.data:ve&&(ke=ve.getData("text/plain")),xe.selection.isFake)Ie=Array.from(xe.selection.getRanges());else if(te.length)Ie=te.map(Ae=>{const Se=be.domConverter.domPositionToView(Ae.startContainer,Ae.startOffset),Oe=be.domConverter.domPositionToView(Ae.endContainer,Ae.endOffset);if(Se)return be.createRange(Se,Oe);if(Oe)return be.createRange(Oe)}).filter(Ae=>!!Ae);else if(env.isAndroid){const Ae=t.target.ownerDocument.defaultView.getSelection();Ie=Array.from(be.domConverter.domSelectionToView(Ae).getRanges())}if(env.isAndroid&&t.inputType=="insertCompositionText"&&ke&&ke.endsWith(`
`)){this.fire(t.type,t,{inputType:"insertParagraph",targetRanges:[be.createRange(Ie[0].end)]});return}if(t.inputType=="insertText"&&ke&&ke.includes(`
`)){const Ae=ke.split(/\n{1,2}/g);let Se=Ie;for(let Oe=0;Oe<Ae.length;Oe++){const Ve=Ae[Oe];Ve!=""&&(this.fire(t.type,t,{data:Ve,dataTransfer:ve,targetRanges:Se,inputType:t.inputType,isComposing:t.isComposing}),Se=[xe.selection.getFirstRange()]),Oe+1<Ae.length&&(this.fire(t.type,t,{inputType:"insertParagraph",targetRanges:Se}),Se=[xe.selection.getFirstRange()])}return}this.fire(t.type,t,{data:ke,dataTransfer:ve,targetRanges:Ie,inputType:t.inputType,isComposing:t.isComposing})}}class ArrowKeysObserver extends Observer{constructor(we){super(we),this.document.on("keydown",(t,te)=>{if(this.isEnabled&&isArrowKeyCode(te.keyCode)){const be=new BubblingEventInfo(this.document,"arrowKey",this.document.selection.getFirstRange());this.document.fire(be,te),be.stop.called&&t.stop()}})}observe(){}stopObserving(){}}class TabObserver extends Observer{constructor(we){super(we);const t=this.document;t.on("keydown",(te,be)=>{if(!this.isEnabled||be.keyCode!=keyCodes.tab||be.ctrlKey)return;const xe=new BubblingEventInfo(t,"tab",t.selection.getFirstRange());t.fire(xe,be),xe.stop.called&&te.stop()})}observe(){}stopObserving(){}}let View$1=class extends ObservableMixin(){constructor(t){super();Re(this,"document");Re(this,"domConverter");Re(this,"domRoots",new Map);Re(this,"_renderer");Re(this,"_initialDomRootAttributes",new WeakMap);Re(this,"_observers",new Map);Re(this,"_writer");Re(this,"_ongoingChange",!1);Re(this,"_postFixersInProgress",!1);Re(this,"_renderingDisabled",!1);Re(this,"_hasChangedSinceTheLastRendering",!1);this.document=new Document$1(t),this.domConverter=new DomConverter(this.document),this.set("isRenderingInProgress",!1),this.set("hasDomSelection",!1),this._renderer=new Renderer$1(this.domConverter,this.document.selection),this._renderer.bind("isFocused","isSelecting","isComposing").to(this.document,"isFocused","isSelecting","isComposing"),this._writer=new DowncastWriter(this.document),this.addObserver(MutationObserver$1),this.addObserver(FocusObserver),this.addObserver(SelectionObserver),this.addObserver(KeyObserver),this.addObserver(FakeSelectionObserver),this.addObserver(CompositionObserver),this.addObserver(ArrowKeysObserver),this.addObserver(InputObserver),this.addObserver(TabObserver),injectQuirksHandling(this),injectUiElementHandling(this),this.on("render",()=>{this._render(),this.document.fire("layoutChanged"),this._hasChangedSinceTheLastRendering=!1}),this.listenTo(this.document.selection,"change",()=>{this._hasChangedSinceTheLastRendering=!0}),this.listenTo(this.document,"change:isFocused",()=>{this._hasChangedSinceTheLastRendering=!0}),env.isiOS&&this.listenTo(this.document,"blur",(te,be)=>{this.domConverter.mapDomToView(be.domEvent.relatedTarget)||this.domConverter._clearDomSelection()})}attachDomRoot(t,te="main"){const be=this.document.getRoot(te);be._name=t.tagName.toLowerCase();const xe={};for(const{name:ke,value:Ie}of Array.from(t.attributes))xe[ke]=Ie,ke==="class"?this._writer.addClass(Ie.split(" "),be):this._writer.setAttribute(ke,Ie,be);this._initialDomRootAttributes.set(t,xe);const ve=()=>{this._writer.setAttribute("contenteditable",(!be.isReadOnly).toString(),be),be.isReadOnly?this._writer.addClass("ck-read-only",be):this._writer.removeClass("ck-read-only",be)};ve(),this.domRoots.set(te,t),this.domConverter.bindElements(t,be),this._renderer.markToSync("children",be),this._renderer.markToSync("attributes",be),this._renderer.domDocuments.add(t.ownerDocument),be.on("change:children",(ke,Ie)=>this._renderer.markToSync("children",Ie)),be.on("change:attributes",(ke,Ie)=>this._renderer.markToSync("attributes",Ie)),be.on("change:text",(ke,Ie)=>this._renderer.markToSync("text",Ie)),be.on("change:isReadOnly",()=>this.change(ve)),be.on("change",()=>{this._hasChangedSinceTheLastRendering=!0});for(const ke of this._observers.values())ke.observe(t,te)}detachDomRoot(t){const te=this.domRoots.get(t);Array.from(te.attributes).forEach(({name:xe})=>te.removeAttribute(xe));const be=this._initialDomRootAttributes.get(te);for(const xe in be)te.setAttribute(xe,be[xe]);this.domRoots.delete(t),this.domConverter.unbindDomElement(te);for(const xe of this._observers.values())xe.stopObserving(te)}getDomRoot(t="main"){return this.domRoots.get(t)}addObserver(t){let te=this._observers.get(t);if(te)return te;te=new t(this),this._observers.set(t,te);for(const[be,xe]of this.domRoots)te.observe(xe,be);return te.enable(),te}getObserver(t){return this._observers.get(t)}disableObservers(){for(const t of this._observers.values())t.disable()}enableObservers(){for(const t of this._observers.values())t.enable()}scrollToTheSelection({alignToTop:t,forceScroll:te,viewportOffset:be=20,ancestorOffset:xe=20}={}){const ve=this.document.selection.getFirstRange();if(!ve)return;const ke=cloneDeep({alignToTop:t,forceScroll:te,viewportOffset:be,ancestorOffset:xe});typeof be=="number"&&(be={top:be,bottom:be,left:be,right:be});const Ie={target:this.domConverter.viewRangeToDom(ve),viewportOffset:be,ancestorOffset:xe,alignToTop:t,forceScroll:te};this.fire("scrollToTheSelection",Ie,ke),scrollViewportToShowTarget(Ie)}focus(){if(!this.document.isFocused){const t=this.document.selection.editableElement;t&&(this.domConverter.focus(t),this.forceRender())}}change(t){if(this.isRenderingInProgress||this._postFixersInProgress)throw new CKEditorError("cannot-change-view-tree",this);try{if(this._ongoingChange)return t(this._writer);this._ongoingChange=!0;const te=t(this._writer);return this._ongoingChange=!1,!this._renderingDisabled&&this._hasChangedSinceTheLastRendering&&(this._postFixersInProgress=!0,this.document._callPostFixers(this._writer),this._postFixersInProgress=!1,this.fire("render")),te}catch(te){/* istanbul ignore next -- @preserve */CKEditorError.rethrowUnexpectedError(te,this)}}forceRender(){this._hasChangedSinceTheLastRendering=!0,this.getObserver(FocusObserver).flush(),this.change(()=>{})}destroy(){for(const t of this._observers.values())t.destroy();this.document.destroy(),this.stopListening()}createPositionAt(t,te){return Position$1._createAt(t,te)}createPositionAfter(t){return Position$1._createAfter(t)}createPositionBefore(t){return Position$1._createBefore(t)}createRange(t,te){return new Range$1(t,te)}createRangeOn(t){return Range$1._createOn(t)}createRangeIn(t){return Range$1._createIn(t)}createSelection(...t){return new Selection$1(...t)}_disableRendering(t){this._renderingDisabled=t,t==!1&&this.change(()=>{})}_render(){this.isRenderingInProgress=!0,this.disableObservers(),this._renderer.render(),this.enableObservers(),this.isRenderingInProgress=!1}};/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class TypeCheckable{is(){throw new Error("is() method is abstract")}}let Node$1=class extends TypeCheckable{constructor(t){super();Re(this,"parent",null);Re(this,"_attrs");this._attrs=toMap(t)}get document(){return null}get index(){let t;if(!this.parent)return null;if((t=this.parent.getChildIndex(this))===null)throw new CKEditorError("model-node-not-found-in-parent",this);return t}get startOffset(){let t;if(!this.parent)return null;if((t=this.parent.getChildStartOffset(this))===null)throw new CKEditorError("model-node-not-found-in-parent",this);return t}get offsetSize(){return 1}get endOffset(){return this.parent?this.startOffset+this.offsetSize:null}get nextSibling(){const t=this.index;return t!==null&&this.parent.getChild(t+1)||null}get previousSibling(){const t=this.index;return t!==null&&this.parent.getChild(t-1)||null}get root(){let t=this;for(;t.parent;)t=t.parent;return t}isAttached(){return this.parent===null?!1:this.root.isAttached()}getPath(){const t=[];let te=this;for(;te.parent;)t.unshift(te.startOffset),te=te.parent;return t}getAncestors(t={}){const te=[];let be=t.includeSelf?this:this.parent;for(;be;)te[t.parentFirst?"push":"unshift"](be),be=be.parent;return te}getCommonAncestor(t,te={}){const be=this.getAncestors(te),xe=t.getAncestors(te);let ve=0;for(;be[ve]==xe[ve]&&be[ve];)ve++;return ve===0?null:be[ve-1]}isBefore(t){if(this==t||this.root!==t.root)return!1;const te=this.getPath(),be=t.getPath(),xe=compareArrays(te,be);switch(xe){case"prefix":return!0;case"extension":return!1;default:return te[xe]<be[xe]}}isAfter(t){return this==t||this.root!==t.root?!1:!this.isBefore(t)}hasAttribute(t){return this._attrs.has(t)}getAttribute(t){return this._attrs.get(t)}getAttributes(){return this._attrs.entries()}getAttributeKeys(){return this._attrs.keys()}toJSON(){const t={};return this._attrs.size&&(t.attributes=Array.from(this._attrs).reduce((te,be)=>(te[be[0]]=be[1],te),{})),t}_clone(t){return new this.constructor(this._attrs)}_remove(){this.parent._removeChildren(this.index)}_setAttribute(t,te){this._attrs.set(t,te)}_setAttributesTo(t){this._attrs=toMap(t)}_removeAttribute(t){return this._attrs.delete(t)}_clearAttributes(){this._attrs.clear()}};Node$1.prototype.is=function(Te){return Te==="node"||Te==="model:node"};class NodeList{constructor(we){Re(this,"_nodes",[]);we&&this._insertNodes(0,we)}[Symbol.iterator](){return this._nodes[Symbol.iterator]()}get length(){return this._nodes.length}get maxOffset(){return this._nodes.reduce((we,t)=>we+t.offsetSize,0)}getNode(we){return this._nodes[we]||null}getNodeIndex(we){const t=this._nodes.indexOf(we);return t==-1?null:t}getNodeStartOffset(we){const t=this.getNodeIndex(we);return t===null?null:this._nodes.slice(0,t).reduce((te,be)=>te+be.offsetSize,0)}indexToOffset(we){if(we==this._nodes.length)return this.maxOffset;const t=this._nodes[we];if(!t)throw new CKEditorError("model-nodelist-index-out-of-bounds",this);return this.getNodeStartOffset(t)}offsetToIndex(we){let t=0;for(const te of this._nodes){if(we>=t&&we<t+te.offsetSize)return this.getNodeIndex(te);t+=te.offsetSize}if(t!=we)throw new CKEditorError("model-nodelist-offset-out-of-bounds",this,{offset:we,nodeList:this});return this.length}_insertNodes(we,t){for(const te of t)if(!(te instanceof Node$1))throw new CKEditorError("model-nodelist-insertnodes-not-node",this);this._nodes=spliceArray(this._nodes,Array.from(t),we,0)}_removeNodes(we,t=1){return this._nodes.splice(we,t)}toJSON(){return this._nodes.map(we=>we.toJSON())}}class Text extends Node$1{constructor(t,te){super(te);Re(this,"_data");this._data=t||""}get offsetSize(){return this.data.length}get data(){return this._data}toJSON(){const t=super.toJSON();return t.data=this.data,t}_clone(){return new Text(this.data,this.getAttributes())}static fromJSON(t){return new Text(t.data,t.attributes)}}Text.prototype.is=function(Te){return Te==="$text"||Te==="model:$text"||Te==="text"||Te==="model:text"||Te==="node"||Te==="model:node"};class TextProxy extends TypeCheckable{constructor(t,te,be){super();Re(this,"textNode");Re(this,"data");Re(this,"offsetInText");if(this.textNode=t,te<0||te>t.offsetSize)throw new CKEditorError("model-textproxy-wrong-offsetintext",this);if(be<0||te+be>t.offsetSize)throw new CKEditorError("model-textproxy-wrong-length",this);this.data=t.data.substring(te,te+be),this.offsetInText=te}get startOffset(){return this.textNode.startOffset!==null?this.textNode.startOffset+this.offsetInText:null}get offsetSize(){return this.data.length}get endOffset(){return this.startOffset!==null?this.startOffset+this.offsetSize:null}get isPartial(){return this.offsetSize!==this.textNode.offsetSize}get parent(){return this.textNode.parent}get root(){return this.textNode.root}getPath(){const t=this.textNode.getPath();return t.length>0&&(t[t.length-1]+=this.offsetInText),t}getAncestors(t={}){const te=[];let be=t.includeSelf?this:this.parent;for(;be;)te[t.parentFirst?"push":"unshift"](be),be=be.parent;return te}hasAttribute(t){return this.textNode.hasAttribute(t)}getAttribute(t){return this.textNode.getAttribute(t)}getAttributes(){return this.textNode.getAttributes()}getAttributeKeys(){return this.textNode.getAttributeKeys()}}TextProxy.prototype.is=function(Te){return Te==="$textProxy"||Te==="model:$textProxy"||Te==="textProxy"||Te==="model:textProxy"};class Element extends Node$1{constructor(t,te,be){super(te);Re(this,"name");Re(this,"_children",new NodeList);this.name=t,be&&this._insertChild(0,be)}get childCount(){return this._children.length}get maxOffset(){return this._children.maxOffset}get isEmpty(){return this.childCount===0}getChild(t){return this._children.getNode(t)}getChildren(){return this._children[Symbol.iterator]()}getChildIndex(t){return this._children.getNodeIndex(t)}getChildStartOffset(t){return this._children.getNodeStartOffset(t)}offsetToIndex(t){return this._children.offsetToIndex(t)}getNodeByPath(t){let te=this;for(const be of t)te=te.getChild(te.offsetToIndex(be));return te}findAncestor(t,te={}){let be=te.includeSelf?this:this.parent;for(;be;){if(be.name===t)return be;be=be.parent}return null}toJSON(){const t=super.toJSON();if(t.name=this.name,this._children.length>0){t.children=[];for(const te of this._children)t.children.push(te.toJSON())}return t}_clone(t=!1){const te=t?Array.from(this._children).map(be=>be._clone(!0)):void 0;return new Element(this.name,this.getAttributes(),te)}_appendChild(t){this._insertChild(this.childCount,t)}_insertChild(t,te){const be=normalize$1(te);for(const xe of be)xe.parent!==null&&xe._remove(),xe.parent=this;this._children._insertNodes(t,be)}_removeChildren(t,te=1){const be=this._children._removeNodes(t,te);for(const xe of be)xe.parent=null;return be}static fromJSON(t){let te;if(t.children){te=[];for(const be of t.children)be.name?te.push(Element.fromJSON(be)):te.push(Text.fromJSON(be))}return new Element(t.name,t.attributes,te)}}Element.prototype.is=function(Te,we){return we?we===this.name&&(Te==="element"||Te==="model:element"):Te==="element"||Te==="model:element"||Te==="node"||Te==="model:node"};function normalize$1(Te){return typeof Te=="string"?[new Text(Te)]:(isIterable(Te)||(Te=[Te]),Array.from(Te).map(we=>typeof we=="string"?new Text(we):we instanceof TextProxy?new Text(we.data,we.getAttributes()):we))}class TreeWalker{constructor(we){Re(this,"direction");Re(this,"boundaries");Re(this,"singleCharacters");Re(this,"shallow");Re(this,"ignoreElementEnd");Re(this,"_position");Re(this,"_boundaryStartParent");Re(this,"_boundaryEndParent");Re(this,"_visitedParent");if(!we||!we.boundaries&&!we.startPosition)throw new CKEditorError("model-tree-walker-no-start-position",null);const t=we.direction||"forward";if(t!="forward"&&t!="backward")throw new CKEditorError("model-tree-walker-unknown-direction",we,{direction:t});this.direction=t,this.boundaries=we.boundaries||null,we.startPosition?this._position=we.startPosition.clone():this._position=Position._createAt(this.boundaries[this.direction=="backward"?"end":"start"]),this.position.stickiness="toNone",this.singleCharacters=!!we.singleCharacters,this.shallow=!!we.shallow,this.ignoreElementEnd=!!we.ignoreElementEnd,this._boundaryStartParent=this.boundaries?this.boundaries.start.parent:null,this._boundaryEndParent=this.boundaries?this.boundaries.end.parent:null,this._visitedParent=this.position.parent}[Symbol.iterator](){return this}get position(){return this._position}skip(we){let t,te,be,xe;do be=this.position,xe=this._visitedParent,{done:t,value:te}=this.next();while(!t&&we(te));t||(this._position=be,this._visitedParent=xe)}next(){return this.direction=="forward"?this._next():this._previous()}_next(){const we=this.position,t=this.position.clone(),te=this._visitedParent;if(te.parent===null&&t.offset===te.maxOffset)return{done:!0,value:void 0};if(te===this._boundaryEndParent&&t.offset==this.boundaries.end.offset)return{done:!0,value:void 0};const be=getTextNodeAtPosition(t,te),xe=be||getNodeAfterPosition(t,te,be);if(xe instanceof Element){if(!this.shallow)t.path.push(0),this._visitedParent=xe;else{if(this.boundaries&&this.boundaries.end.isBefore(t))return{done:!0,value:void 0};t.offset++}return this._position=t,formatReturnValue("elementStart",xe,we,t,1)}if(xe instanceof Text){let ve;if(this.singleCharacters)ve=1;else{let Ae=xe.endOffset;this._boundaryEndParent==te&&this.boundaries.end.offset<Ae&&(Ae=this.boundaries.end.offset),ve=Ae-t.offset}const ke=t.offset-xe.startOffset,Ie=new TextProxy(xe,ke,ve);return t.offset+=ve,this._position=t,formatReturnValue("text",Ie,we,t,ve)}return t.path.pop(),t.offset++,this._position=t,this._visitedParent=te.parent,this.ignoreElementEnd?this._next():formatReturnValue("elementEnd",te,we,t)}_previous(){const we=this.position,t=this.position.clone(),te=this._visitedParent;if(te.parent===null&&t.offset===0)return{done:!0,value:void 0};if(te==this._boundaryStartParent&&t.offset==this.boundaries.start.offset)return{done:!0,value:void 0};const be=t.parent,xe=getTextNodeAtPosition(t,be),ve=xe||getNodeBeforePosition(t,be,xe);if(ve instanceof Element)return t.offset--,this.shallow?(this._position=t,formatReturnValue("elementStart",ve,we,t,1)):(t.path.push(ve.maxOffset),this._position=t,this._visitedParent=ve,this.ignoreElementEnd?this._previous():formatReturnValue("elementEnd",ve,we,t));if(ve instanceof Text){let ke;if(this.singleCharacters)ke=1;else{let Se=ve.startOffset;this._boundaryStartParent==te&&this.boundaries.start.offset>Se&&(Se=this.boundaries.start.offset),ke=t.offset-Se}const Ie=t.offset-ve.startOffset,Ae=new TextProxy(ve,Ie-ke,ke);return t.offset-=ke,this._position=t,formatReturnValue("text",Ae,we,t,ke)}return t.path.pop(),this._position=t,this._visitedParent=te.parent,formatReturnValue("elementStart",te,we,t,1)}}function formatReturnValue(Te,we,t,te,be){return{done:!1,value:{type:Te,item:we,previousPosition:t,nextPosition:te,length:be}}}class Position extends TypeCheckable{constructor(t,te,be="toNone"){super();Re(this,"root");Re(this,"path");Re(this,"stickiness");if(!t.is("element")&&!t.is("documentFragment"))throw new CKEditorError("model-position-root-invalid",t);if(!(te instanceof Array)||te.length===0)throw new CKEditorError("model-position-path-incorrect-format",t,{path:te});t.is("rootElement")?te=te.slice():(te=[...t.getPath(),...te],t=t.root),this.root=t,this.path=te,this.stickiness=be}get offset(){return this.path[this.path.length-1]}set offset(t){this.path[this.path.length-1]=t}get parent(){let t=this.root;for(let te=0;te<this.path.length-1;te++)if(t=t.getChild(t.offsetToIndex(this.path[te])),!t)throw new CKEditorError("model-position-path-incorrect",this,{position:this});if(t.is("$text"))throw new CKEditorError("model-position-path-incorrect",this,{position:this});return t}get index(){return this.parent.offsetToIndex(this.offset)}get textNode(){return getTextNodeAtPosition(this,this.parent)}get nodeAfter(){const t=this.parent;return getNodeAfterPosition(this,t,getTextNodeAtPosition(this,t))}get nodeBefore(){const t=this.parent;return getNodeBeforePosition(this,t,getTextNodeAtPosition(this,t))}get isAtStart(){return this.offset===0}get isAtEnd(){return this.offset==this.parent.maxOffset}compareWith(t){if(this.root!=t.root)return"different";const te=compareArrays(this.path,t.path);switch(te){case"same":return"same";case"prefix":return"before";case"extension":return"after";default:return this.path[te]<t.path[te]?"before":"after"}}getLastMatchingPosition(t,te={}){te.startPosition=this;const be=new TreeWalker(te);return be.skip(t),be.position}getParentPath(){return this.path.slice(0,-1)}getAncestors(){const t=this.parent;return t.is("documentFragment")?[t]:t.getAncestors({includeSelf:!0})}findAncestor(t){const te=this.parent;return te.is("element")?te.findAncestor(t,{includeSelf:!0}):null}getCommonPath(t){if(this.root!=t.root)return[];const te=compareArrays(this.path,t.path),be=typeof te=="string"?Math.min(this.path.length,t.path.length):te;return this.path.slice(0,be)}getCommonAncestor(t){const te=this.getAncestors(),be=t.getAncestors();let xe=0;for(;te[xe]==be[xe]&&te[xe];)xe++;return xe===0?null:te[xe-1]}getShiftedBy(t){const te=this.clone(),be=te.offset+t;return te.offset=be<0?0:be,te}isAfter(t){return this.compareWith(t)=="after"}isBefore(t){return this.compareWith(t)=="before"}isEqual(t){return this.compareWith(t)=="same"}isTouching(t){if(this.root!==t.root)return!1;const te=Math.min(this.path.length,t.path.length);for(let be=0;be<te;be++){const xe=this.path[be]-t.path[be];if(xe<-1||xe>1)return!1;if(xe===1)return checkTouchingBranch(t,this,be);if(xe===-1)return checkTouchingBranch(this,t,be)}return this.path.length===t.path.length?!0:this.path.length>t.path.length?checkOnlyZeroes(this.path,te):checkOnlyZeroes(t.path,te)}hasSameParentAs(t){if(this.root!==t.root)return!1;const te=this.getParentPath(),be=t.getParentPath();return compareArrays(te,be)=="same"}getTransformedByOperation(t){let te;switch(t.type){case"insert":te=this._getTransformedByInsertOperation(t);break;case"move":case"remove":case"reinsert":te=this._getTransformedByMoveOperation(t);break;case"split":te=this._getTransformedBySplitOperation(t);break;case"merge":te=this._getTransformedByMergeOperation(t);break;default:te=Position._createAt(this);break}return te}_getTransformedByInsertOperation(t){return this._getTransformedByInsertion(t.position,t.howMany)}_getTransformedByMoveOperation(t){return this._getTransformedByMove(t.sourcePosition,t.targetPosition,t.howMany)}_getTransformedBySplitOperation(t){const te=t.movedRange;return te.containsPosition(this)||te.start.isEqual(this)&&this.stickiness=="toNext"?this._getCombined(t.splitPosition,t.moveTargetPosition):t.graveyardPosition?this._getTransformedByMove(t.graveyardPosition,t.insertionPosition,1):this._getTransformedByInsertion(t.insertionPosition,1)}_getTransformedByMergeOperation(t){const te=t.movedRange,be=te.containsPosition(this)||te.start.isEqual(this);let xe;return be?(xe=this._getCombined(t.sourcePosition,t.targetPosition),t.sourcePosition.isBefore(t.targetPosition)&&(xe=xe._getTransformedByDeletion(t.deletionPosition,1))):this.isEqual(t.deletionPosition)?xe=Position._createAt(t.deletionPosition):xe=this._getTransformedByMove(t.deletionPosition,t.graveyardPosition,1),xe}_getTransformedByDeletion(t,te){const be=Position._createAt(this);if(this.root!=t.root)return be;if(compareArrays(t.getParentPath(),this.getParentPath())=="same"){if(t.offset<this.offset){if(t.offset+te>this.offset)return null;be.offset-=te}}else if(compareArrays(t.getParentPath(),this.getParentPath())=="prefix"){const xe=t.path.length-1;if(t.offset<=this.path[xe]){if(t.offset+te>this.path[xe])return null;be.path[xe]-=te}}return be}_getTransformedByInsertion(t,te){const be=Position._createAt(this);if(this.root!=t.root)return be;if(compareArrays(t.getParentPath(),this.getParentPath())=="same")(t.offset<this.offset||t.offset==this.offset&&this.stickiness!="toPrevious")&&(be.offset+=te);else if(compareArrays(t.getParentPath(),this.getParentPath())=="prefix"){const xe=t.path.length-1;t.offset<=this.path[xe]&&(be.path[xe]+=te)}return be}_getTransformedByMove(t,te,be){if(te=te._getTransformedByDeletion(t,be),t.isEqual(te))return Position._createAt(this);const xe=this._getTransformedByDeletion(t,be);return xe===null||t.isEqual(this)&&this.stickiness=="toNext"||t.getShiftedBy(be).isEqual(this)&&this.stickiness=="toPrevious"?this._getCombined(t,te):xe._getTransformedByInsertion(te,be)}_getCombined(t,te){const be=t.path.length-1,xe=Position._createAt(te);return xe.stickiness=this.stickiness,xe.offset=xe.offset+this.path[be]-t.offset,xe.path=[...xe.path,...this.path.slice(be+1)],xe}toJSON(){return{root:this.root.toJSON(),path:Array.from(this.path),stickiness:this.stickiness}}clone(){return new this.constructor(this.root,this.path,this.stickiness)}static _createAt(t,te,be="toNone"){if(t instanceof Position)return new Position(t.root,t.path,t.stickiness);{const xe=t;if(te=="end")te=xe.maxOffset;else{if(te=="before")return this._createBefore(xe,be);if(te=="after")return this._createAfter(xe,be);if(te!==0&&!te)throw new CKEditorError("model-createpositionat-offset-required",[this,t])}if(!xe.is("element")&&!xe.is("documentFragment"))throw new CKEditorError("model-position-parent-incorrect",[this,t]);const ve=xe.getPath();return ve.push(te),new this(xe.root,ve,be)}}static _createAfter(t,te){if(!t.parent)throw new CKEditorError("model-position-after-root",[this,t],{root:t});return this._createAt(t.parent,t.endOffset,te)}static _createBefore(t,te){if(!t.parent)throw new CKEditorError("model-position-before-root",t,{root:t});return this._createAt(t.parent,t.startOffset,te)}static fromJSON(t,te){if(t.root==="$graveyard"){const be=new Position(te.graveyard,t.path);return be.stickiness=t.stickiness,be}if(!te.getRoot(t.root))throw new CKEditorError("model-position-fromjson-no-root",te,{rootName:t.root});return new Position(te.getRoot(t.root),t.path,t.stickiness)}}Position.prototype.is=function(Te){return Te==="position"||Te==="model:position"};function getTextNodeAtPosition(Te,we){const t=we.getChild(we.offsetToIndex(Te.offset));return t&&t.is("$text")&&t.startOffset<Te.offset?t:null}function getNodeAfterPosition(Te,we,t){return t!==null?null:we.getChild(we.offsetToIndex(Te.offset))}function getNodeBeforePosition(Te,we,t){return t!==null?null:we.getChild(we.offsetToIndex(Te.offset)-1)}function checkTouchingBranch(Te,we,t){return!(t+1===Te.path.length||!checkOnlyZeroes(we.path,t+1)||!checkOnlyMaxOffset(Te,t+1))}function checkOnlyZeroes(Te,we){for(;we<Te.length;){if(Te[we]!==0)return!1;we++}return!0}function checkOnlyMaxOffset(Te,we){let t=Te.parent,te=Te.path.length-1,be=0;for(;te>=we;){if(Te.path[te]+be!==t.maxOffset)return!1;be=1,te--,t=t.parent}return!0}class Range extends TypeCheckable{constructor(t,te){super();Re(this,"start");Re(this,"end");this.start=Position._createAt(t),this.end=te?Position._createAt(te):Position._createAt(t),this.start.stickiness=this.isCollapsed?"toNone":"toNext",this.end.stickiness=this.isCollapsed?"toNone":"toPrevious"}*[Symbol.iterator](){yield*new TreeWalker({boundaries:this,ignoreElementEnd:!0})}get isCollapsed(){return this.start.isEqual(this.end)}get isFlat(){const t=this.start.getParentPath(),te=this.end.getParentPath();return compareArrays(t,te)=="same"}get root(){return this.start.root}containsPosition(t){return t.isAfter(this.start)&&t.isBefore(this.end)}containsRange(t,te=!1){t.isCollapsed&&(te=!1);const be=this.containsPosition(t.start)||te&&this.start.isEqual(t.start),xe=this.containsPosition(t.end)||te&&this.end.isEqual(t.end);return be&&xe}containsItem(t){const te=Position._createBefore(t);return this.containsPosition(te)||this.start.isEqual(te)}isEqual(t){return this.start.isEqual(t.start)&&this.end.isEqual(t.end)}isIntersecting(t){return this.start.isBefore(t.end)&&this.end.isAfter(t.start)}getDifference(t){const te=[];return this.isIntersecting(t)?(this.containsPosition(t.start)&&te.push(new Range(this.start,t.start)),this.containsPosition(t.end)&&te.push(new Range(t.end,this.end))):te.push(new Range(this.start,this.end)),te}getIntersection(t){if(this.isIntersecting(t)){let te=this.start,be=this.end;return this.containsPosition(t.start)&&(te=t.start),this.containsPosition(t.end)&&(be=t.end),new Range(te,be)}return null}getJoined(t,te=!1){let be=this.isIntersecting(t);if(be||(this.start.isBefore(t.start)?be=te?this.end.isTouching(t.start):this.end.isEqual(t.start):be=te?t.end.isTouching(this.start):t.end.isEqual(this.start)),!be)return null;let xe=this.start,ve=this.end;return t.start.isBefore(xe)&&(xe=t.start),t.end.isAfter(ve)&&(ve=t.end),new Range(xe,ve)}getMinimalFlatRanges(){const t=[],te=this.start.getCommonPath(this.end).length,be=Position._createAt(this.start);let xe=be.parent;for(;be.path.length>te+1;){const ve=xe.maxOffset-be.offset;ve!==0&&t.push(new Range(be,be.getShiftedBy(ve))),be.path=be.path.slice(0,-1),be.offset++,xe=xe.parent}for(;be.path.length<=this.end.path.length;){const ve=this.end.path[be.path.length-1],ke=ve-be.offset;ke!==0&&t.push(new Range(be,be.getShiftedBy(ke))),be.offset=ve,be.path.push(0)}return t}getWalker(t={}){return t.boundaries=this,new TreeWalker(t)}*getItems(t={}){t.boundaries=this,t.ignoreElementEnd=!0;const te=new TreeWalker(t);for(const be of te)yield be.item}*getPositions(t={}){t.boundaries=this;const te=new TreeWalker(t);yield te.position;for(const be of te)yield be.nextPosition}getTransformedByOperation(t){switch(t.type){case"insert":return this._getTransformedByInsertOperation(t);case"move":case"remove":case"reinsert":return this._getTransformedByMoveOperation(t);case"split":return[this._getTransformedBySplitOperation(t)];case"merge":return[this._getTransformedByMergeOperation(t)]}return[new Range(this.start,this.end)]}getTransformedByOperations(t){const te=[new Range(this.start,this.end)];for(const be of t)for(let xe=0;xe<te.length;xe++){const ve=te[xe].getTransformedByOperation(be);te.splice(xe,1,...ve),xe+=ve.length-1}for(let be=0;be<te.length;be++){const xe=te[be];for(let ve=be+1;ve<te.length;ve++){const ke=te[ve];(xe.containsRange(ke)||ke.containsRange(xe)||xe.isEqual(ke))&&te.splice(ve,1)}}return te}getCommonAncestor(){return this.start.getCommonAncestor(this.end)}getContainedElement(){if(this.isCollapsed)return null;const t=this.start.nodeAfter,te=this.end.nodeBefore;return t&&t.is("element")&&t===te?t:null}toJSON(){return{start:this.start.toJSON(),end:this.end.toJSON()}}clone(){return new this.constructor(this.start,this.end)}_getTransformedByInsertOperation(t,te=!1){return this._getTransformedByInsertion(t.position,t.howMany,te)}_getTransformedByMoveOperation(t,te=!1){const be=t.sourcePosition,xe=t.howMany,ve=t.targetPosition;return this._getTransformedByMove(be,ve,xe,te)}_getTransformedBySplitOperation(t){const te=this.start._getTransformedBySplitOperation(t);let be=this.end._getTransformedBySplitOperation(t);return this.end.isEqual(t.insertionPosition)&&(be=this.end.getShiftedBy(1)),te.root!=be.root&&(be=this.end.getShiftedBy(-1)),new Range(te,be)}_getTransformedByMergeOperation(t){if(this.start.isEqual(t.targetPosition)&&this.end.isEqual(t.deletionPosition))return new Range(this.start);let te=this.start._getTransformedByMergeOperation(t),be=this.end._getTransformedByMergeOperation(t);return te.root!=be.root&&(be=this.end.getShiftedBy(-1)),te.isAfter(be)?(t.sourcePosition.isBefore(t.targetPosition)?(te=Position._createAt(be),te.offset=0):(t.deletionPosition.isEqual(te)||(be=t.deletionPosition),te=t.targetPosition),new Range(te,be)):new Range(te,be)}_getTransformedByInsertion(t,te,be=!1){if(be&&this.containsPosition(t))return[new Range(this.start,t),new Range(t.getShiftedBy(te),this.end._getTransformedByInsertion(t,te))];{const xe=new Range(this.start,this.end);return xe.start=xe.start._getTransformedByInsertion(t,te),xe.end=xe.end._getTransformedByInsertion(t,te),[xe]}}_getTransformedByMove(t,te,be,xe=!1){if(this.isCollapsed){const Ve=this.start._getTransformedByMove(t,te,be);return[new Range(Ve)]}const ve=Range._createFromPositionAndShift(t,be),ke=te._getTransformedByDeletion(t,be);if(this.containsPosition(te)&&!xe&&(ve.containsPosition(this.start)||ve.containsPosition(this.end))){const Ve=this.start._getTransformedByMove(t,te,be),Me=this.end._getTransformedByMove(t,te,be);return[new Range(Ve,Me)]}let Ie;const Ae=this.getDifference(ve);let Se=null;const Oe=this.getIntersection(ve);if(Ae.length==1?Se=new Range(Ae[0].start._getTransformedByDeletion(t,be),Ae[0].end._getTransformedByDeletion(t,be)):Ae.length==2&&(Se=new Range(this.start,this.end._getTransformedByDeletion(t,be))),Se?Ie=Se._getTransformedByInsertion(ke,be,Oe!==null||xe):Ie=[],Oe){const Ve=new Range(Oe.start._getCombined(ve.start,ke),Oe.end._getCombined(ve.start,ke));Ie.length==2?Ie.splice(1,0,Ve):Ie.push(Ve)}return Ie}_getTransformedByDeletion(t,te){let be=this.start._getTransformedByDeletion(t,te),xe=this.end._getTransformedByDeletion(t,te);return be==null&&xe==null?null:(be==null&&(be=t),xe==null&&(xe=t),new Range(be,xe))}static _createFromPositionAndShift(t,te){const be=t,xe=t.getShiftedBy(te);return te>0?new this(be,xe):new this(xe,be)}static _createIn(t){return new this(Position._createAt(t,0),Position._createAt(t,t.maxOffset))}static _createOn(t){return this._createFromPositionAndShift(Position._createBefore(t),t.offsetSize)}static _createFromRanges(t){if(t.length===0)throw new CKEditorError("range-create-from-ranges-empty-array",null);if(t.length==1)return t[0].clone();const te=t[0];t.sort((ve,ke)=>ve.start.isAfter(ke.start)?1:-1);const be=t.indexOf(te),xe=new this(te.start,te.end);if(be>0)for(let ve=be-1;t[ve].end.isEqual(xe.start);ve++)xe.start=Position._createAt(t[ve].start);for(let ve=be+1;ve<t.length&&t[ve].start.isEqual(xe.end);ve++)xe.end=Position._createAt(t[ve].end);return xe}static fromJSON(t,te){return new this(Position.fromJSON(t.start,te),Position.fromJSON(t.end,te))}}Range.prototype.is=function(Te){return Te==="range"||Te==="model:range"};class Mapper extends EmitterMixin(){constructor(){super();Re(this,"_modelToViewMapping",new WeakMap);Re(this,"_viewToModelMapping",new WeakMap);Re(this,"_viewToModelLengthCallbacks",new Map);Re(this,"_markerNameToElements",new Map);Re(this,"_elementToMarkerNames",new Map);Re(this,"_deferredBindingRemovals",new Map);Re(this,"_unboundMarkerNames",new Set);this.on("modelToViewPosition",(t,te)=>{if(te.viewPosition)return;const be=this._modelToViewMapping.get(te.modelPosition.parent);if(!be)throw new CKEditorError("mapping-model-position-view-parent-not-found",this,{modelPosition:te.modelPosition});te.viewPosition=this.findPositionIn(be,te.modelPosition.offset)},{priority:"low"}),this.on("viewToModelPosition",(t,te)=>{if(te.modelPosition)return;const be=this.findMappedViewAncestor(te.viewPosition),xe=this._viewToModelMapping.get(be),ve=this._toModelOffset(te.viewPosition.parent,te.viewPosition.offset,be);te.modelPosition=Position._createAt(xe,ve)},{priority:"low"})}bindElements(t,te){this._modelToViewMapping.set(t,te),this._viewToModelMapping.set(te,t)}unbindViewElement(t,te={}){const be=this.toModelElement(t);if(this._elementToMarkerNames.has(t))for(const xe of this._elementToMarkerNames.get(t))this._unboundMarkerNames.add(xe);te.defer?this._deferredBindingRemovals.set(t,t.root):(this._viewToModelMapping.delete(t),this._modelToViewMapping.get(be)==t&&this._modelToViewMapping.delete(be))}unbindModelElement(t){const te=this.toViewElement(t);this._modelToViewMapping.delete(t),this._viewToModelMapping.get(te)==t&&this._viewToModelMapping.delete(te)}bindElementToMarker(t,te){const be=this._markerNameToElements.get(te)||new Set;be.add(t);const xe=this._elementToMarkerNames.get(t)||new Set;xe.add(te),this._markerNameToElements.set(te,be),this._elementToMarkerNames.set(t,xe)}unbindElementFromMarkerName(t,te){const be=this._markerNameToElements.get(te);be&&(be.delete(t),be.size==0&&this._markerNameToElements.delete(te));const xe=this._elementToMarkerNames.get(t);xe&&(xe.delete(te),xe.size==0&&this._elementToMarkerNames.delete(t))}flushUnboundMarkerNames(){const t=Array.from(this._unboundMarkerNames);return this._unboundMarkerNames.clear(),t}flushDeferredBindings(){for(const[t,te]of this._deferredBindingRemovals)t.root==te&&this.unbindViewElement(t);this._deferredBindingRemovals=new Map}clearBindings(){this._modelToViewMapping=new WeakMap,this._viewToModelMapping=new WeakMap,this._markerNameToElements=new Map,this._elementToMarkerNames=new Map,this._unboundMarkerNames=new Set,this._deferredBindingRemovals=new Map}toModelElement(t){return this._viewToModelMapping.get(t)}toViewElement(t){return this._modelToViewMapping.get(t)}toModelRange(t){return new Range(this.toModelPosition(t.start),this.toModelPosition(t.end))}toViewRange(t){return new Range$1(this.toViewPosition(t.start),this.toViewPosition(t.end))}toModelPosition(t){const te={viewPosition:t,mapper:this};return this.fire("viewToModelPosition",te),te.modelPosition}toViewPosition(t,te={}){const be={modelPosition:t,mapper:this,isPhantom:te.isPhantom};return this.fire("modelToViewPosition",be),be.viewPosition}markerNameToElements(t){const te=this._markerNameToElements.get(t);if(!te)return null;const be=new Set;for(const xe of te)if(xe.is("attributeElement"))for(const ve of xe.getElementsWithSameId())be.add(ve);else be.add(xe);return be}registerViewToModelLength(t,te){this._viewToModelLengthCallbacks.set(t,te)}findMappedViewAncestor(t){let te=t.parent;for(;!this._viewToModelMapping.has(te);)te=te.parent;return te}_toModelOffset(t,te,be){if(be!=t){const ve=this._toModelOffset(t.parent,t.index,be),ke=this._toModelOffset(t,te,t);return ve+ke}if(t.is("$text"))return te;let xe=0;for(let ve=0;ve<te;ve++)xe+=this.getModelLength(t.getChild(ve));return xe}getModelLength(t){if(this._viewToModelLengthCallbacks.get(t.name))return this._viewToModelLengthCallbacks.get(t.name)(t);if(this._viewToModelMapping.has(t))return 1;if(t.is("$text"))return t.data.length;if(t.is("uiElement"))return 0;{let te=0;for(const be of t.getChildren())te+=this.getModelLength(be);return te}}findPositionIn(t,te){let be,xe=0,ve=0,ke=0;if(t.is("$text"))return new Position$1(t,te);for(;ve<te;)be=t.getChild(ke),xe=this.getModelLength(be),ve+=xe,ke++;return ve==te?this._moveViewPositionToTextNode(new Position$1(t,ke)):this.findPositionIn(be,te-(ve-xe))}_moveViewPositionToTextNode(t){const te=t.nodeBefore,be=t.nodeAfter;return te instanceof Text$1?new Position$1(te,te.data.length):be instanceof Text$1?new Position$1(be,0):t}}class ModelConsumable{constructor(){Re(this,"_consumable",new Map);Re(this,"_textProxyRegistry",new Map)}add(we,t){t=_normalizeConsumableType(t),we instanceof TextProxy&&(we=this._getSymbolForTextProxy(we)),this._consumable.has(we)||this._consumable.set(we,new Map),this._consumable.get(we).set(t,!0)}consume(we,t){return t=_normalizeConsumableType(t),we instanceof TextProxy&&(we=this._getSymbolForTextProxy(we)),this.test(we,t)?(this._consumable.get(we).set(t,!1),!0):!1}test(we,t){t=_normalizeConsumableType(t),we instanceof TextProxy&&(we=this._getSymbolForTextProxy(we));const te=this._consumable.get(we);if(te===void 0)return null;const be=te.get(t);return be===void 0?null:be}revert(we,t){t=_normalizeConsumableType(t),we instanceof TextProxy&&(we=this._getSymbolForTextProxy(we));const te=this.test(we,t);return te===!1?(this._consumable.get(we).set(t,!0),!0):te===!0?!1:null}verifyAllConsumed(we){const t=[];for(const[te,be]of this._consumable)for(const[xe,ve]of be){const ke=xe.split(":")[0];ve&&we==ke&&t.push({event:xe,item:te.name||te.description})}if(t.length)throw new CKEditorError("conversion-model-consumable-not-consumed",null,{items:t})}_getSymbolForTextProxy(we){let t=null;const te=this._textProxyRegistry.get(we.startOffset);if(te){const be=te.get(we.endOffset);be&&(t=be.get(we.parent))}return t||(t=this._addSymbolForTextProxy(we)),t}_addSymbolForTextProxy(we){const t=we.startOffset,te=we.endOffset,be=we.parent,xe=Symbol("$textProxy:"+we.data);let ve,ke;return ve=this._textProxyRegistry.get(t),ve||(ve=new Map,this._textProxyRegistry.set(t,ve)),ke=ve.get(te),ke||(ke=new Map,ve.set(te,ke)),ke.set(be,xe),xe}}function _normalizeConsumableType(Te){const we=Te.split(":");return we[0]=="insert"?we[0]:we[0]=="addMarker"||we[0]=="removeMarker"?Te:we.length>1?we[0]+":"+we[1]:we[0]}class DowncastDispatcher extends EmitterMixin(){constructor(t){super();Re(this,"_conversionApi");Re(this,"_firedEventsMap");this._conversionApi={dispatcher:this,...t},this._firedEventsMap=new WeakMap}convertChanges(t,te,be){const xe=this._createConversionApi(be,t.getRefreshedItems());for(const ke of t.getMarkersToRemove())this._convertMarkerRemove(ke.name,ke.range,xe);const ve=this._reduceChanges(t.getChanges());for(const ke of ve)ke.type==="insert"?this._convertInsert(Range._createFromPositionAndShift(ke.position,ke.length),xe):ke.type==="reinsert"?this._convertReinsert(Range._createFromPositionAndShift(ke.position,ke.length),xe):ke.type==="remove"?this._convertRemove(ke.position,ke.length,ke.name,xe):this._convertAttribute(ke.range,ke.attributeKey,ke.attributeOldValue,ke.attributeNewValue,xe);xe.mapper.flushDeferredBindings();for(const ke of xe.mapper.flushUnboundMarkerNames()){const Ie=te.get(ke).getRange();this._convertMarkerRemove(ke,Ie,xe),this._convertMarkerAdd(ke,Ie,xe)}for(const ke of t.getMarkersToAdd())this._convertMarkerAdd(ke.name,ke.range,xe);xe.consumable.verifyAllConsumed("insert")}convert(t,te,be,xe={}){const ve=this._createConversionApi(be,void 0,xe);this._convertInsert(t,ve);for(const[ke,Ie]of te)this._convertMarkerAdd(ke,Ie,ve);ve.consumable.verifyAllConsumed("insert")}convertSelection(t,te,be){const xe=this._createConversionApi(be);this.fire("cleanSelection",{selection:t},xe);const ve=t.getFirstPosition().root;if(!xe.mapper.toViewElement(ve))return;const ke=Array.from(te.getMarkersAtPosition(t.getFirstPosition()));if(this._addConsumablesForSelection(xe.consumable,t,ke),this.fire("selection",{selection:t},xe),!!t.isCollapsed){for(const Ie of ke)if(xe.consumable.test(t,"addMarker:"+Ie.name)){const Ae=Ie.getRange();if(!shouldMarkerChangeBeConverted(t.getFirstPosition(),Ie,xe.mapper))continue;const Se={item:t,markerName:Ie.name,markerRange:Ae};this.fire(`addMarker:${Ie.name}`,Se,xe)}for(const Ie of t.getAttributeKeys())if(xe.consumable.test(t,"attribute:"+Ie)){const Ae={item:t,range:t.getFirstRange(),attributeKey:Ie,attributeOldValue:null,attributeNewValue:t.getAttribute(Ie)};this.fire(`attribute:${Ie}:$text`,Ae,xe)}}}_convertInsert(t,te,be={}){be.doNotAddConsumables||this._addConsumablesForInsert(te.consumable,t);for(const xe of Array.from(t.getWalker({shallow:!0})).map(walkerValueToEventData))this._testAndFire("insert",xe,te)}_convertRemove(t,te,be,xe){this.fire(`remove:${be}`,{position:t,length:te},xe)}_convertAttribute(t,te,be,xe,ve){this._addConsumablesForRange(ve.consumable,t,`attribute:${te}`);for(const ke of t){const Ie={item:ke.item,range:Range._createFromPositionAndShift(ke.previousPosition,ke.length),attributeKey:te,attributeOldValue:be,attributeNewValue:xe};this._testAndFire(`attribute:${te}`,Ie,ve)}}_convertReinsert(t,te){const be=Array.from(t.getWalker({shallow:!0}));this._addConsumablesForInsert(te.consumable,be);for(const xe of be.map(walkerValueToEventData))this._testAndFire("insert",{...xe,reconversion:!0},te)}_convertMarkerAdd(t,te,be){if(te.root.rootName=="$graveyard")return;const xe=`addMarker:${t}`;if(be.consumable.add(te,xe),this.fire(xe,{markerName:t,markerRange:te},be),!!be.consumable.consume(te,xe)){this._addConsumablesForRange(be.consumable,te,xe);for(const ve of te.getItems()){if(!be.consumable.test(ve,xe))continue;const ke={item:ve,range:Range._createOn(ve),markerName:t,markerRange:te};this.fire(xe,ke,be)}}}_convertMarkerRemove(t,te,be){te.root.rootName!="$graveyard"&&this.fire(`removeMarker:${t}`,{markerName:t,markerRange:te},be)}_reduceChanges(t){const te={changes:t};return this.fire("reduceChanges",te),te.changes}_addConsumablesForInsert(t,te){for(const be of te){const xe=be.item;if(t.test(xe,"insert")===null){t.add(xe,"insert");for(const ve of xe.getAttributeKeys())t.add(xe,"attribute:"+ve)}}return t}_addConsumablesForRange(t,te,be){for(const xe of te.getItems())t.add(xe,be);return t}_addConsumablesForSelection(t,te,be){t.add(te,"selection");for(const xe of be)t.add(te,"addMarker:"+xe.name);for(const xe of te.getAttributeKeys())t.add(te,"attribute:"+xe);return t}_testAndFire(t,te,be){const xe=getEventName(t,te),ve=te.item.is("$textProxy")?be.consumable._getSymbolForTextProxy(te.item):te.item,ke=this._firedEventsMap.get(be),Ie=ke.get(ve);if(!Ie)ke.set(ve,new Set([xe]));else if(!Ie.has(xe))Ie.add(xe);else return;this.fire(xe,te,be)}_testAndFireAddAttributes(t,te){const be={item:t,range:Range._createOn(t)};for(const xe of be.item.getAttributeKeys())be.attributeKey=xe,be.attributeOldValue=null,be.attributeNewValue=be.item.getAttribute(xe),this._testAndFire(`attribute:${xe}`,be,te)}_createConversionApi(t,te=new Set,be={}){const xe={...this._conversionApi,consumable:new ModelConsumable,writer:t,options:be,convertItem:ve=>this._convertInsert(Range._createOn(ve),xe),convertChildren:ve=>this._convertInsert(Range._createIn(ve),xe,{doNotAddConsumables:!0}),convertAttributes:ve=>this._testAndFireAddAttributes(ve,xe),canReuseView:ve=>!te.has(xe.mapper.toModelElement(ve))};return this._firedEventsMap.set(xe,new Map),xe}}function shouldMarkerChangeBeConverted(Te,we,t){const te=we.getRange(),be=Array.from(Te.getAncestors());return be.shift(),be.reverse(),!be.some(ve=>{if(te.containsItem(ve))return!!t.toViewElement(ve).getCustomProperty("addHighlight")})}function getEventName(Te,we){const t=we.item.is("element")?we.item.name:"$text";return`${Te}:${t}`}function walkerValueToEventData(Te){const we=Te.item,t=Range._createFromPositionAndShift(Te.previousPosition,Te.length);return{item:we,range:t}}class Selection extends EmitterMixin(TypeCheckable){constructor(...t){super();Re(this,"_lastRangeBackward",!1);Re(this,"_attrs",new Map);Re(this,"_ranges",[]);t.length&&this.setTo(...t)}get anchor(){if(this._ranges.length>0){const t=this._ranges[this._ranges.length-1];return this._lastRangeBackward?t.end:t.start}return null}get focus(){if(this._ranges.length>0){const t=this._ranges[this._ranges.length-1];return this._lastRangeBackward?t.start:t.end}return null}get isCollapsed(){return this._ranges.length===1?this._ranges[0].isCollapsed:!1}get rangeCount(){return this._ranges.length}get isBackward(){return!this.isCollapsed&&this._lastRangeBackward}isEqual(t){if(this.rangeCount!=t.rangeCount)return!1;if(this.rangeCount===0)return!0;if(!this.anchor.isEqual(t.anchor)||!this.focus.isEqual(t.focus))return!1;for(const te of this._ranges){let be=!1;for(const xe of t._ranges)if(te.isEqual(xe)){be=!0;break}if(!be)return!1}return!0}*getRanges(){for(const t of this._ranges)yield new Range(t.start,t.end)}getFirstRange(){let t=null;for(const te of this._ranges)(!t||te.start.isBefore(t.start))&&(t=te);return t?new Range(t.start,t.end):null}getLastRange(){let t=null;for(const te of this._ranges)(!t||te.end.isAfter(t.end))&&(t=te);return t?new Range(t.start,t.end):null}getFirstPosition(){const t=this.getFirstRange();return t?t.start.clone():null}getLastPosition(){const t=this.getLastRange();return t?t.end.clone():null}setTo(...t){let[te,be,xe]=t;if(typeof be=="object"&&(xe=be,be=void 0),te===null)this._setRanges([]);else if(te instanceof Selection)this._setRanges(te.getRanges(),te.isBackward);else if(te&&typeof te.getRanges=="function")this._setRanges(te.getRanges(),te.isBackward);else if(te instanceof Range)this._setRanges([te],!!xe&&!!xe.backward);else if(te instanceof Position)this._setRanges([new Range(te)]);else if(te instanceof Node$1){const ve=!!xe&&!!xe.backward;let ke;if(be=="in")ke=Range._createIn(te);else if(be=="on")ke=Range._createOn(te);else if(be!==void 0)ke=new Range(Position._createAt(te,be));else throw new CKEditorError("model-selection-setto-required-second-parameter",[this,te]);this._setRanges([ke],ve)}else if(isIterable(te))this._setRanges(te,xe&&!!xe.backward);else throw new CKEditorError("model-selection-setto-not-selectable",[this,te])}_setRanges(t,te=!1){const be=Array.from(t),xe=be.some(ve=>{if(!(ve instanceof Range))throw new CKEditorError("model-selection-set-ranges-not-range",[this,t]);return this._ranges.every(ke=>!ke.isEqual(ve))});be.length===this._ranges.length&&!xe||(this._replaceAllRanges(be),this._lastRangeBackward=!!te,this.fire("change:range",{directChange:!0}))}setFocus(t,te){if(this.anchor===null)throw new CKEditorError("model-selection-setfocus-no-ranges",[this,t]);const be=Position._createAt(t,te);if(be.compareWith(this.focus)=="same")return;const xe=this.anchor;this._ranges.length&&this._popRange(),be.compareWith(xe)=="before"?(this._pushRange(new Range(be,xe)),this._lastRangeBackward=!0):(this._pushRange(new Range(xe,be)),this._lastRangeBackward=!1),this.fire("change:range",{directChange:!0})}getAttribute(t){return this._attrs.get(t)}getAttributes(){return this._attrs.entries()}getAttributeKeys(){return this._attrs.keys()}hasAttribute(t){return this._attrs.has(t)}removeAttribute(t){this.hasAttribute(t)&&(this._attrs.delete(t),this.fire("change:attribute",{attributeKeys:[t],directChange:!0}))}setAttribute(t,te){this.getAttribute(t)!==te&&(this._attrs.set(t,te),this.fire("change:attribute",{attributeKeys:[t],directChange:!0}))}getSelectedElement(){return this.rangeCount!==1?null:this.getFirstRange().getContainedElement()}*getSelectedBlocks(){const t=new WeakSet;for(const te of this.getRanges()){const be=getParentBlock$1(te.start,t);isStartBlockSelected(be,te)&&(yield be);for(const ve of te.getWalker()){const ke=ve.item;ve.type=="elementEnd"&&isUnvisitedTopBlock(ke,t,te)&&(yield ke)}const xe=getParentBlock$1(te.end,t);isEndBlockSelected(xe,te)&&(yield xe)}}containsEntireContent(t=this.anchor.root){const te=Position._createAt(t,0),be=Position._createAt(t,"end");return te.isTouching(this.getFirstPosition())&&be.isTouching(this.getLastPosition())}_pushRange(t){this._checkRange(t),this._ranges.push(new Range(t.start,t.end))}_checkRange(t){for(let te=0;te<this._ranges.length;te++)if(t.isIntersecting(this._ranges[te]))throw new CKEditorError("model-selection-range-intersects",[this,t],{addedRange:t,intersectingRange:this._ranges[te]})}_replaceAllRanges(t){this._removeAllRanges();for(const te of t)this._pushRange(te)}_removeAllRanges(){for(;this._ranges.length>0;)this._popRange()}_popRange(){this._ranges.pop()}}Selection.prototype.is=function(Te){return Te==="selection"||Te==="model:selection"};function isUnvisitedBlock(Te,we){return we.has(Te)?!1:(we.add(Te),Te.root.document.model.schema.isBlock(Te)&&!!Te.parent)}function isUnvisitedTopBlock(Te,we,t){return isUnvisitedBlock(Te,we)&&isTopBlockInRange(Te,t)}function getParentBlock$1(Te,we){const te=Te.parent.root.document.model.schema,be=Te.parent.getAncestors({parentFirst:!0,includeSelf:!0});let xe=!1;const ve=be.find(ke=>xe?!1:(xe=te.isLimit(ke),!xe&&isUnvisitedBlock(ke,we)));return be.forEach(ke=>we.add(ke)),ve}function isTopBlockInRange(Te,we){const t=findAncestorBlock(Te);return t?!we.containsRange(Range._createOn(t),!0):!0}function isStartBlockSelected(Te,we){return Te?we.isCollapsed||Te.isEmpty?!0:we.start.isTouching(Position._createAt(Te,Te.maxOffset))?!1:isTopBlockInRange(Te,we):!1}function isEndBlockSelected(Te,we){return Te?we.isCollapsed||Te.isEmpty?!0:we.end.isTouching(Position._createAt(Te,0))?!1:isTopBlockInRange(Te,we):!1}function findAncestorBlock(Te){const we=Te.root.document.model.schema;let t=Te.parent;for(;t;){if(we.isBlock(t))return t;t=t.parent}}class LiveRange extends EmitterMixin(Range){constructor(we,t){super(we,t),bindWithDocument$1.call(this)}detach(){this.stopListening()}toRange(){return new Range(this.start,this.end)}static fromRange(we){return new LiveRange(we.start,we.end)}}LiveRange.prototype.is=function(Te){return Te==="liveRange"||Te==="model:liveRange"||Te=="range"||Te==="model:range"};function bindWithDocument$1(){this.listenTo(this.root.document.model,"applyOperation",(Te,we)=>{const t=we[0];t.isDocumentOperation&&transform$2.call(this,t)},{priority:"low"})}function transform$2(Te){const we=this.getTransformedByOperation(Te),t=Range._createFromRanges(we),te=!t.isEqual(this),be=doesOperationChangeRangeContent(this,Te);let xe=null;if(te){t.root.rootName=="$graveyard"&&(Te.type=="remove"?xe=Te.sourcePosition:xe=Te.deletionPosition);const ve=this.toRange();this.start=t.start,this.end=t.end,this.fire("change:range",ve,{deletionPosition:xe})}else be&&this.fire("change:content",this.toRange(),{deletionPosition:xe})}function doesOperationChangeRangeContent(Te,we){switch(we.type){case"insert":return Te.containsPosition(we.position);case"move":case"remove":case"reinsert":case"merge":return Te.containsPosition(we.sourcePosition)||Te.start.isEqual(we.sourcePosition)||Te.containsPosition(we.targetPosition);case"split":return Te.containsPosition(we.splitPosition)||Te.containsPosition(we.insertionPosition)}return!1}const storePrefix="selection:";class DocumentSelection extends EmitterMixin(TypeCheckable){constructor(t){super();Re(this,"_selection");this._selection=new LiveSelection(t),this._selection.delegate("change:range").to(this),this._selection.delegate("change:attribute").to(this),this._selection.delegate("change:marker").to(this)}get isCollapsed(){return this._selection.isCollapsed}get anchor(){return this._selection.anchor}get focus(){return this._selection.focus}get rangeCount(){return this._selection.rangeCount}get hasOwnRange(){return this._selection.hasOwnRange}get isBackward(){return this._selection.isBackward}get isGravityOverridden(){return this._selection.isGravityOverridden}get markers(){return this._selection.markers}get _ranges(){return this._selection._ranges}getRanges(){return this._selection.getRanges()}getFirstPosition(){return this._selection.getFirstPosition()}getLastPosition(){return this._selection.getLastPosition()}getFirstRange(){return this._selection.getFirstRange()}getLastRange(){return this._selection.getLastRange()}getSelectedBlocks(){return this._selection.getSelectedBlocks()}getSelectedElement(){return this._selection.getSelectedElement()}containsEntireContent(t){return this._selection.containsEntireContent(t)}destroy(){this._selection.destroy()}getAttributeKeys(){return this._selection.getAttributeKeys()}getAttributes(){return this._selection.getAttributes()}getAttribute(t){return this._selection.getAttribute(t)}hasAttribute(t){return this._selection.hasAttribute(t)}refresh(){this._selection.updateMarkers(),this._selection._updateAttributes(!1)}observeMarkers(t){this._selection.observeMarkers(t)}_setFocus(t,te){this._selection.setFocus(t,te)}_setTo(...t){this._selection.setTo(...t)}_setAttribute(t,te){this._selection.setAttribute(t,te)}_removeAttribute(t){this._selection.removeAttribute(t)}_getStoredAttributes(){return this._selection.getStoredAttributes()}_overrideGravity(){return this._selection.overrideGravity()}_restoreGravity(t){this._selection.restoreGravity(t)}static _getStoreAttributeKey(t){return storePrefix+t}static _isStoreAttributeKey(t){return t.startsWith(storePrefix)}}DocumentSelection.prototype.is=function(Te){return Te==="selection"||Te=="model:selection"||Te=="documentSelection"||Te=="model:documentSelection"};class LiveSelection extends Selection{constructor(t){super();Re(this,"markers",new Collection({idProperty:"name"}));Re(this,"_model");Re(this,"_document");Re(this,"_attributePriority",new Map);Re(this,"_selectionRestorePosition",null);Re(this,"_hasChangedRange",!1);Re(this,"_overriddenGravityRegister",new Set);Re(this,"_observedMarkers",new Set);this._model=t.model,this._document=t,this.listenTo(this._model,"applyOperation",(te,be)=>{const xe=be[0];!xe.isDocumentOperation||xe.type=="marker"||xe.type=="rename"||xe.type=="noop"||(this._ranges.length==0&&this._selectionRestorePosition&&this._fixGraveyardSelection(this._selectionRestorePosition),this._selectionRestorePosition=null,this._hasChangedRange&&(this._hasChangedRange=!1,this.fire("change:range",{directChange:!1})))},{priority:"lowest"}),this.on("change:range",()=>{this._validateSelectionRanges(this.getRanges())}),this.listenTo(this._model.markers,"update",(te,be,xe,ve)=>{this._updateMarker(be,ve)}),this.listenTo(this._document,"change",(te,be)=>{clearAttributesStoredInElement(this._model,be)})}get isCollapsed(){return this._ranges.length===0?this._document._getDefaultRange().isCollapsed:super.isCollapsed}get anchor(){return super.anchor||this._document._getDefaultRange().start}get focus(){return super.focus||this._document._getDefaultRange().end}get rangeCount(){return this._ranges.length?this._ranges.length:1}get hasOwnRange(){return this._ranges.length>0}get isGravityOverridden(){return!!this._overriddenGravityRegister.size}destroy(){for(let t=0;t<this._ranges.length;t++)this._ranges[t].detach();this.stopListening()}*getRanges(){this._ranges.length?yield*super.getRanges():yield this._document._getDefaultRange()}getFirstRange(){return super.getFirstRange()||this._document._getDefaultRange()}getLastRange(){return super.getLastRange()||this._document._getDefaultRange()}setTo(...t){super.setTo(...t),this._updateAttributes(!0),this.updateMarkers()}setFocus(t,te){super.setFocus(t,te),this._updateAttributes(!0),this.updateMarkers()}setAttribute(t,te){if(this._setAttribute(t,te)){const be=[t];this.fire("change:attribute",{attributeKeys:be,directChange:!0})}}removeAttribute(t){if(this._removeAttribute(t)){const te=[t];this.fire("change:attribute",{attributeKeys:te,directChange:!0})}}overrideGravity(){const t=uid();return this._overriddenGravityRegister.add(t),this._overriddenGravityRegister.size===1&&this._updateAttributes(!0),t}restoreGravity(t){if(!this._overriddenGravityRegister.has(t))throw new CKEditorError("document-selection-gravity-wrong-restore",this,{uid:t});this._overriddenGravityRegister.delete(t),this.isGravityOverridden||this._updateAttributes(!0)}observeMarkers(t){this._observedMarkers.add(t),this.updateMarkers()}_replaceAllRanges(t){this._validateSelectionRanges(t),super._replaceAllRanges(t)}_popRange(){this._ranges.pop().detach()}_pushRange(t){const te=this._prepareRange(t);te&&this._ranges.push(te)}_validateSelectionRanges(t){for(const te of t)if(!this._document._validateSelectionRange(te))throw new CKEditorError("document-selection-wrong-position",this,{range:te})}_prepareRange(t){if(this._checkRange(t),t.root==this._document.graveyard)return;const te=LiveRange.fromRange(t);return te.on("change:range",(be,xe,ve)=>{if(this._hasChangedRange=!0,te.root==this._document.graveyard){this._selectionRestorePosition=ve.deletionPosition;const ke=this._ranges.indexOf(te);this._ranges.splice(ke,1),te.detach()}}),te}updateMarkers(){if(!this._observedMarkers.size)return;const t=[];let te=!1;for(const xe of this._model.markers){const ve=xe.name.split(":",1)[0];if(!this._observedMarkers.has(ve))continue;const ke=xe.getRange();for(const Ie of this.getRanges())ke.containsRange(Ie,!Ie.isCollapsed)&&t.push(xe)}const be=Array.from(this.markers);for(const xe of t)this.markers.has(xe)||(this.markers.add(xe),te=!0);for(const xe of Array.from(this.markers))t.includes(xe)||(this.markers.remove(xe),te=!0);te&&this.fire("change:marker",{oldMarkers:be,directChange:!1})}_updateMarker(t,te){const be=t.name.split(":",1)[0];if(!this._observedMarkers.has(be))return;let xe=!1;const ve=Array.from(this.markers),ke=this.markers.has(t);if(!te)ke&&(this.markers.remove(t),xe=!0);else{let Ie=!1;for(const Ae of this.getRanges())if(te.containsRange(Ae,!Ae.isCollapsed)){Ie=!0;break}Ie&&!ke?(this.markers.add(t),xe=!0):!Ie&&ke&&(this.markers.remove(t),xe=!0)}xe&&this.fire("change:marker",{oldMarkers:ve,directChange:!1})}_updateAttributes(t){const te=toMap(this._getSurroundingAttributes()),be=toMap(this.getAttributes());if(t)this._attributePriority=new Map,this._attrs=new Map;else for(const[ve,ke]of this._attributePriority)ke=="low"&&(this._attrs.delete(ve),this._attributePriority.delete(ve));this._setAttributesTo(te);const xe=[];for(const[ve,ke]of this.getAttributes())(!be.has(ve)||be.get(ve)!==ke)&&xe.push(ve);for(const[ve]of be)this.hasAttribute(ve)||xe.push(ve);xe.length>0&&this.fire("change:attribute",{attributeKeys:xe,directChange:!1})}_setAttribute(t,te,be=!0){const xe=be?"normal":"low";return xe=="low"&&this._attributePriority.get(t)=="normal"||super.getAttribute(t)===te?!1:(this._attrs.set(t,te),this._attributePriority.set(t,xe),!0)}_removeAttribute(t,te=!0){const be=te?"normal":"low";return be=="low"&&this._attributePriority.get(t)=="normal"||(this._attributePriority.set(t,be),!super.hasAttribute(t))?!1:(this._attrs.delete(t),!0)}_setAttributesTo(t){const te=new Set;for(const[be,xe]of this.getAttributes())t.get(be)!==xe&&this._removeAttribute(be,!1);for(const[be,xe]of t)this._setAttribute(be,xe,!1)&&te.add(be);return te}*getStoredAttributes(){const t=this.getFirstPosition().parent;if(this.isCollapsed&&t.isEmpty)for(const te of t.getAttributeKeys())te.startsWith(storePrefix)&&(yield[te.substr(storePrefix.length),t.getAttribute(te)])}_getSurroundingAttributes(){const t=this.getFirstPosition(),te=this._model.schema;if(t.root.rootName=="$graveyard")return null;let be=null;if(this.isCollapsed){const xe=t.textNode?t.textNode:t.nodeBefore,ve=t.textNode?t.textNode:t.nodeAfter;if(this.isGravityOverridden||(be=getTextAttributes(xe,te)),be||(be=getTextAttributes(ve,te)),!this.isGravityOverridden&&!be){let ke=xe;for(;ke&&!be;)ke=ke.previousSibling,be=getTextAttributes(ke,te)}if(!be){let ke=ve;for(;ke&&!be;)ke=ke.nextSibling,be=getTextAttributes(ke,te)}be||(be=this.getStoredAttributes())}else{const xe=this.getFirstRange();for(const ve of xe){if(ve.item.is("element")&&te.isObject(ve.item)){be=getTextAttributes(ve.item,te);break}if(ve.type=="text"){be=ve.item.getAttributes();break}}}return be}_fixGraveyardSelection(t){const te=this._model.schema.getNearestSelectionRange(t);te&&this._pushRange(te)}}function getTextAttributes(Te,we){if(!Te)return null;if(Te instanceof TextProxy||Te instanceof Text)return Te.getAttributes();if(!we.isInline(Te))return null;if(!we.isObject(Te))return[];const t=[];for(const[te,be]of Te.getAttributes())we.checkAttribute("$text",te)&&we.getAttributeProperties(te).copyFromObject!==!1&&t.push([te,be]);return t}function clearAttributesStoredInElement(Te,we){const t=Te.document.differ;for(const te of t.getChanges()){if(te.type!="insert")continue;const be=te.position.parent;te.length===be.maxOffset&&Te.enqueueChange(we,ve=>{const ke=Array.from(be.getAttributeKeys()).filter(Ie=>Ie.startsWith(storePrefix));for(const Ie of ke)ve.removeAttribute(Ie,be)})}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class ConversionHelpers{constructor(we){Re(this,"_dispatchers");this._dispatchers=we}add(we){for(const t of this._dispatchers)we(t);return this}}class DowncastHelpers extends ConversionHelpers{elementToElement(we){return this.add(downcastElementToElement(we))}elementToStructure(we){return this.add(downcastElementToStructure(we))}attributeToElement(we){return this.add(downcastAttributeToElement(we))}attributeToAttribute(we){return this.add(downcastAttributeToAttribute(we))}markerToElement(we){return this.add(downcastMarkerToElement(we))}markerToHighlight(we){return this.add(downcastMarkerToHighlight(we))}markerToData(we){return this.add(downcastMarkerToData(we))}}function insertText(){return(Te,we,t)=>{if(!t.consumable.consume(we.item,Te.name))return;const te=t.writer,be=t.mapper.toViewPosition(we.range.start),xe=te.createText(we.item.data);te.insert(be,xe)}}function insertAttributesAndChildren(){return(Te,we,t)=>{t.convertAttributes(we.item),!we.reconversion&&we.item.is("element")&&!we.item.isEmpty&&t.convertChildren(we.item)}}function remove(){return(Te,we,t)=>{const te=t.mapper.toViewPosition(we.position),be=we.position.getShiftedBy(we.length),xe=t.mapper.toViewPosition(be,{isPhantom:!0}),ve=t.writer.createRange(te,xe),ke=t.writer.remove(ve.getTrimmed());for(const Ie of t.writer.createRangeIn(ke).getItems())t.mapper.unbindViewElement(Ie,{defer:!0})}}function createViewElementFromHighlightDescriptor(Te,we){const t=Te.createAttributeElement("span",we.attributes);return we.classes&&t._addClass(we.classes),typeof we.priority=="number"&&(t._priority=we.priority),t._id=we.id,t}function convertRangeSelection(){return(Te,we,t)=>{const te=we.selection;if(te.isCollapsed||!t.consumable.consume(te,"selection"))return;const be=[];for(const xe of te.getRanges())be.push(t.mapper.toViewRange(xe));t.writer.setSelection(be,{backward:te.isBackward})}}function convertCollapsedSelection(){return(Te,we,t)=>{const te=we.selection;if(!te.isCollapsed||!t.consumable.consume(te,"selection"))return;const be=t.writer,xe=te.getFirstPosition(),ve=t.mapper.toViewPosition(xe),ke=be.breakAttributes(ve);be.setSelection(ke)}}function cleanSelection(){return(Te,we,t)=>{const te=t.writer,be=te.document.selection;for(const xe of be.getRanges())xe.isCollapsed&&xe.end.parent.isAttached()&&t.writer.mergeAttributes(xe.start);te.setSelection(null)}}function wrap(Te){return(we,t,te)=>{if(!te.consumable.test(t.item,we.name))return;const be=Te(t.attributeOldValue,te,t),xe=Te(t.attributeNewValue,te,t);if(!be&&!xe)return;te.consumable.consume(t.item,we.name);const ve=te.writer,ke=ve.document.selection;if(t.item instanceof Selection||t.item instanceof DocumentSelection)ve.wrap(ke.getFirstRange(),xe);else{let Ie=te.mapper.toViewRange(t.range);t.attributeOldValue!==null&&be&&(Ie=ve.unwrap(Ie,be)),t.attributeNewValue!==null&&xe&&ve.wrap(Ie,xe)}}}function insertElement(Te,we=defaultConsumer){return(t,te,be)=>{if(!we(te.item,be.consumable,{preflight:!0}))return;const xe=Te(te.item,be,te);if(!xe)return;we(te.item,be.consumable);const ve=be.mapper.toViewPosition(te.range.start);be.mapper.bindElements(te.item,xe),be.writer.insert(ve,xe),be.convertAttributes(te.item),reinsertOrConvertNodes(xe,te.item.getChildren(),be,{reconversion:te.reconversion})}}function insertStructure(Te,we){return(t,te,be)=>{if(!we(te.item,be.consumable,{preflight:!0}))return;const xe=new Map;be.writer._registerSlotFactory(createSlotFactory(te.item,xe,be));const ve=Te(te.item,be,te);if(be.writer._clearSlotFactory(),!ve)return;validateSlotsChildren(te.item,xe,be),we(te.item,be.consumable);const ke=be.mapper.toViewPosition(te.range.start);be.mapper.bindElements(te.item,ve),be.writer.insert(ke,ve),be.convertAttributes(te.item),fillSlots(ve,xe,be,{reconversion:te.reconversion})}}function insertUIElement(Te){return(we,t,te)=>{t.isOpening=!0;const be=Te(t,te);t.isOpening=!1;const xe=Te(t,te);if(!be||!xe)return;const ve=t.markerRange;if(ve.isCollapsed&&!te.consumable.consume(ve,we.name))return;for(const Ae of ve)if(!te.consumable.consume(Ae.item,we.name))return;const ke=te.mapper,Ie=te.writer;Ie.insert(ke.toViewPosition(ve.start),be),te.mapper.bindElementToMarker(be,t.markerName),ve.isCollapsed||(Ie.insert(ke.toViewPosition(ve.end),xe),te.mapper.bindElementToMarker(xe,t.markerName)),we.stop()}}function removeUIElement(){return(Te,we,t)=>{const te=t.mapper.markerNameToElements(we.markerName);if(te){for(const be of te)t.mapper.unbindElementFromMarkerName(be,we.markerName),t.writer.clear(t.writer.createRangeOn(be),be);t.writer.clearClonedElementsGroup(we.markerName),Te.stop()}}}function insertMarkerData(Te){return(we,t,te)=>{const be=Te(t.markerName,te);if(!be)return;const xe=t.markerRange;te.consumable.consume(xe,we.name)&&(handleMarkerBoundary(xe,!1,te,t,be),handleMarkerBoundary(xe,!0,te,t,be),we.stop())}}function handleMarkerBoundary(Te,we,t,te,be){const xe=we?Te.start:Te.end,ve=xe.nodeAfter&&xe.nodeAfter.is("element")?xe.nodeAfter:null,ke=xe.nodeBefore&&xe.nodeBefore.is("element")?xe.nodeBefore:null;if(ve||ke){let Ae,Se;we&&ve||!we&&!ke?(Ae=ve,Se=!0):(Ae=ke,Se=!1);const Oe=t.mapper.toViewElement(Ae);if(Oe){insertMarkerAsAttribute(Oe,we,Se,t,te,be);return}}const Ie=t.mapper.toViewPosition(xe);insertMarkerAsElement(Ie,we,t,te,be)}function insertMarkerAsAttribute(Te,we,t,te,be,xe){const ve=`data-${xe.group}-${we?"start":"end"}-${t?"before":"after"}`,ke=Te.hasAttribute(ve)?Te.getAttribute(ve).split(","):[];ke.unshift(xe.name),te.writer.setAttribute(ve,ke.join(","),Te),te.mapper.bindElementToMarker(Te,be.markerName)}function insertMarkerAsElement(Te,we,t,te,be){const xe=`${be.group}-${we?"start":"end"}`,ve=be.name?{name:be.name}:null,ke=t.writer.createUIElement(xe,ve);t.writer.insert(Te,ke),t.mapper.bindElementToMarker(ke,te.markerName)}function removeMarkerData(Te){return(we,t,te)=>{const be=Te(t.markerName,te);if(!be)return;const xe=te.mapper.markerNameToElements(t.markerName);if(!xe)return;for(const ke of xe)te.mapper.unbindElementFromMarkerName(ke,t.markerName),ke.is("containerElement")?(ve(`data-${be.group}-start-before`,ke),ve(`data-${be.group}-start-after`,ke),ve(`data-${be.group}-end-before`,ke),ve(`data-${be.group}-end-after`,ke)):te.writer.clear(te.writer.createRangeOn(ke),ke);te.writer.clearClonedElementsGroup(t.markerName),we.stop();function ve(ke,Ie){if(Ie.hasAttribute(ke)){const Ae=new Set(Ie.getAttribute(ke).split(","));Ae.delete(be.name),Ae.size==0?te.writer.removeAttribute(ke,Ie):te.writer.setAttribute(ke,Array.from(Ae).join(","),Ie)}}}}function changeAttribute(Te){return(we,t,te)=>{if(!te.consumable.test(t.item,we.name))return;const be=Te(t.attributeOldValue,te,t),xe=Te(t.attributeNewValue,te,t);if(!be&&!xe)return;te.consumable.consume(t.item,we.name);const ve=te.mapper.toViewElement(t.item),ke=te.writer;if(!ve)throw new CKEditorError("conversion-attribute-to-attribute-on-text",te.dispatcher,t);if(t.attributeOldValue!==null&&be)if(be.key=="class"){const Ie=typeof be.value=="string"?be.value.split(/\s+/):be.value;for(const Ae of Ie)ke.removeClass(Ae,ve)}else if(be.key=="style")if(typeof be.value=="string"){const Ie=new StylesMap(ke.document.stylesProcessor);Ie.setTo(be.value);for(const[Ae]of Ie.getStylesEntries())ke.removeStyle(Ae,ve)}else{const Ie=Object.keys(be.value);for(const Ae of Ie)ke.removeStyle(Ae,ve)}else ke.removeAttribute(be.key,ve);if(t.attributeNewValue!==null&&xe)if(xe.key=="class"){const Ie=typeof xe.value=="string"?xe.value.split(/\s+/):xe.value;for(const Ae of Ie)ke.addClass(Ae,ve)}else if(xe.key=="style")if(typeof xe.value=="string"){const Ie=new StylesMap(ke.document.stylesProcessor);Ie.setTo(xe.value);for(const[Ae,Se]of Ie.getStylesEntries())ke.setStyle(Ae,Se,ve)}else{const Ie=Object.keys(xe.value);for(const Ae of Ie)ke.setStyle(Ae,xe.value[Ae],ve)}else ke.setAttribute(xe.key,xe.value,ve)}}function highlightText(Te){return(we,t,te)=>{if(!t.item||!(t.item instanceof Selection||t.item instanceof DocumentSelection)&&!t.item.is("$textProxy"))return;const be=prepareDescriptor(Te,t,te);if(!be||!te.consumable.consume(t.item,we.name))return;const xe=te.writer,ve=createViewElementFromHighlightDescriptor(xe,be),ke=xe.document.selection;if(t.item instanceof Selection||t.item instanceof DocumentSelection)xe.wrap(ke.getFirstRange(),ve);else{const Ie=te.mapper.toViewRange(t.range),Ae=xe.wrap(Ie,ve);for(const Se of Ae.getItems())if(Se.is("attributeElement")&&Se.isSimilar(ve)){te.mapper.bindElementToMarker(Se,t.markerName);break}}}}function highlightElement(Te){return(we,t,te)=>{if(!t.item||!(t.item instanceof Element))return;const be=prepareDescriptor(Te,t,te);if(!be||!te.consumable.test(t.item,we.name))return;const xe=te.mapper.toViewElement(t.item);if(xe&&xe.getCustomProperty("addHighlight")){te.consumable.consume(t.item,we.name);for(const ke of Range._createIn(t.item))te.consumable.consume(ke.item,we.name);xe.getCustomProperty("addHighlight")(xe,be,te.writer),te.mapper.bindElementToMarker(xe,t.markerName)}}}function removeHighlight$1(Te){return(we,t,te)=>{if(t.markerRange.isCollapsed)return;const be=prepareDescriptor(Te,t,te);if(!be)return;const xe=createViewElementFromHighlightDescriptor(te.writer,be),ve=te.mapper.markerNameToElements(t.markerName);if(ve){for(const ke of ve)te.mapper.unbindElementFromMarkerName(ke,t.markerName),ke.is("attributeElement")?te.writer.unwrap(te.writer.createRangeOn(ke),xe):ke.getCustomProperty("removeHighlight")(ke,be.id,te.writer);te.writer.clearClonedElementsGroup(t.markerName),we.stop()}}}function downcastElementToElement(Te){const we=normalizeModelElementConfig(Te.model),t=normalizeToElementConfig(Te.view,"container");return we.attributes.length&&(we.children=!0),te=>{te.on(`insert:${we.name}`,insertElement(t,createConsumer(we)),{priority:Te.converterPriority||"normal"}),(we.children||we.attributes.length)&&te.on("reduceChanges",createChangeReducer(we),{priority:"low"})}}function downcastElementToStructure(Te){const we=normalizeModelElementConfig(Te.model),t=normalizeToElementConfig(Te.view,"container");return we.children=!0,te=>{if(te._conversionApi.schema.checkChild(we.name,"$text"))throw new CKEditorError("conversion-element-to-structure-disallowed-text",te,{elementName:we.name});te.on(`insert:${we.name}`,insertStructure(t,createConsumer(we)),{priority:Te.converterPriority||"normal"}),te.on("reduceChanges",createChangeReducer(we),{priority:"low"})}}function downcastAttributeToElement(Te){Te=cloneDeep(Te);let we=Te.model;typeof we=="string"&&(we={key:we});let t=`attribute:${we.key}`;if(we.name&&(t+=":"+we.name),we.values)for(const be of we.values)Te.view[be]=normalizeToElementConfig(Te.view[be],"attribute");else Te.view=normalizeToElementConfig(Te.view,"attribute");const te=getFromAttributeCreator(Te);return be=>{be.on(t,wrap(te),{priority:Te.converterPriority||"normal"})}}function downcastAttributeToAttribute(Te){Te=cloneDeep(Te);let we=Te.model;typeof we=="string"&&(we={key:we});let t=`attribute:${we.key}`;if(we.name&&(t+=":"+we.name),we.values)for(const be of we.values)Te.view[be]=normalizeToAttributeConfig(Te.view[be]);else Te.view=normalizeToAttributeConfig(Te.view);const te=getFromAttributeCreator(Te);return be=>{be.on(t,changeAttribute(te),{priority:Te.converterPriority||"normal"})}}function downcastMarkerToElement(Te){const we=normalizeToElementConfig(Te.view,"ui");return t=>{t.on(`addMarker:${Te.model}`,insertUIElement(we),{priority:Te.converterPriority||"normal"}),t.on(`removeMarker:${Te.model}`,removeUIElement(),{priority:Te.converterPriority||"normal"})}}function downcastMarkerToData(Te){Te=cloneDeep(Te);const we=Te.model;let t=Te.view;return t||(t=te=>({group:we,name:te.substr(Te.model.length+1)})),te=>{te.on(`addMarker:${we}`,insertMarkerData(t),{priority:Te.converterPriority||"normal"}),te.on(`removeMarker:${we}`,removeMarkerData(t),{priority:Te.converterPriority||"normal"})}}function downcastMarkerToHighlight(Te){return we=>{we.on(`addMarker:${Te.model}`,highlightText(Te.view),{priority:Te.converterPriority||"normal"}),we.on(`addMarker:${Te.model}`,highlightElement(Te.view),{priority:Te.converterPriority||"normal"}),we.on(`removeMarker:${Te.model}`,removeHighlight$1(Te.view),{priority:Te.converterPriority||"normal"})}}function normalizeModelElementConfig(Te){return typeof Te=="string"&&(Te={name:Te}),{name:Te.name,attributes:Te.attributes?toArray$2(Te.attributes):[],children:!!Te.children}}function normalizeToElementConfig(Te,we){return typeof Te=="function"?Te:(t,te)=>createViewElementFromDefinition(Te,te,we)}function createViewElementFromDefinition(Te,we,t){typeof Te=="string"&&(Te={name:Te});let te;const be=we.writer,xe=Object.assign({},Te.attributes);if(t=="container")te=be.createContainerElement(Te.name,xe);else if(t=="attribute"){const ve={priority:Te.priority||AttributeElement.DEFAULT_PRIORITY};te=be.createAttributeElement(Te.name,xe,ve)}else te=be.createUIElement(Te.name,xe);if(Te.styles){const ve=Object.keys(Te.styles);for(const ke of ve)be.setStyle(ke,Te.styles[ke],te)}if(Te.classes){const ve=Te.classes;if(typeof ve=="string")be.addClass(ve,te);else for(const ke of ve)be.addClass(ke,te)}return te}function getFromAttributeCreator(Te){return Te.model.values?(we,t,te)=>{const be=Te.view[we];return be?be(we,t,te):null}:Te.view}function normalizeToAttributeConfig(Te){return typeof Te=="string"?we=>({key:Te,value:we}):typeof Te=="object"?Te.value?()=>Te:we=>({key:Te.key,value:we}):Te}function prepareDescriptor(Te,we,t){const te=typeof Te=="function"?Te(we,t):Te;return te?(te.priority||(te.priority=10),te.id||(te.id=we.markerName),te):null}function createChangeReducerCallback(Te){return(we,t)=>{if(!we.is("element",Te.name))return!1;if(t.type=="attribute"){if(Te.attributes.includes(t.attributeKey))return!0}else{/* istanbul ignore else: This is always true because otherwise it would not register a reducer callback. -- @preserve */if(Te.children)return!0}return!1}}function createChangeReducer(Te){const we=createChangeReducerCallback(Te);return(t,te)=>{const be=[];te.reconvertedElements||(te.reconvertedElements=new Set);for(const xe of te.changes){const ve=xe.type=="attribute"?xe.range.start.nodeAfter:xe.position.parent;if(!ve||!we(ve,xe)){be.push(xe);continue}if(!te.reconvertedElements.has(ve)){te.reconvertedElements.add(ve);const ke=Position._createBefore(ve);let Ie=be.length;for(let Ae=be.length-1;Ae>=0;Ae--){const Se=be[Ae],Ve=(Se.type=="attribute"?Se.range.start:Se.position).compareWith(ke);if(Ve=="before"||Se.type=="remove"&&Ve=="same")break;Ie=Ae}be.splice(Ie,0,{type:"remove",name:ve.name,position:ke,length:1},{type:"reinsert",name:ve.name,position:ke,length:1})}}te.changes=be}}function createConsumer(Te){return(we,t,te={})=>{const be=["insert"];for(const xe of Te.attributes)we.hasAttribute(xe)&&be.push(`attribute:${xe}`);return be.every(xe=>t.test(we,xe))?(te.preflight||be.forEach(xe=>t.consume(we,xe)),!0):!1}}function createSlotFactory(Te,we,t){return(te,be)=>{const xe=te.createContainerElement("$slot");let ve=null;if(be==="children")ve=Array.from(Te.getChildren());else if(typeof be=="function")ve=Array.from(Te.getChildren()).filter(ke=>be(ke));else throw new CKEditorError("conversion-slot-mode-unknown",t.dispatcher,{modeOrFilter:be});return we.set(xe,ve),xe}}function validateSlotsChildren(Te,we,t){const te=Array.from(we.values()).flat(),be=new Set(te);if(be.size!=te.length)throw new CKEditorError("conversion-slot-filter-overlap",t.dispatcher,{element:Te});if(be.size!=Te.childCount)throw new CKEditorError("conversion-slot-filter-incomplete",t.dispatcher,{element:Te})}function fillSlots(Te,we,t,te){t.mapper.on("modelToViewPosition",ve,{priority:"highest"});let be=null,xe=null;for([be,xe]of we)reinsertOrConvertNodes(Te,xe,t,te),t.writer.move(t.writer.createRangeIn(be),t.writer.createPositionBefore(be)),t.writer.remove(be);t.mapper.off("modelToViewPosition",ve);function ve(ke,Ie){const Ae=Ie.modelPosition.nodeAfter,Se=xe.indexOf(Ae);Se<0||(Ie.viewPosition=Ie.mapper.findPositionIn(be,Se))}}function reinsertOrConvertNodes(Te,we,t,te){for(const be of we)reinsertNode(Te.root,be,t,te)||t.convertItem(be)}function reinsertNode(Te,we,t,te){const{writer:be,mapper:xe}=t;if(!te.reconversion)return!1;const ve=xe.toViewElement(we);return!ve||ve.root==Te||!t.canReuseView(ve)?!1:(be.move(be.createRangeOn(ve),xe.toViewPosition(Position._createBefore(we))),!0)}function defaultConsumer(Te,we,{preflight:t}={}){return t?we.test(Te,"insert"):we.consume(Te,"insert")}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function autoParagraphEmptyRoots(Te){const{schema:we,document:t}=Te.model;for(const te of t.getRoots())if(te.isEmpty&&!we.checkChild(te,"$text")&&we.checkChild(te,"paragraph"))return Te.insertElement("paragraph",te),!0;return!1}function isParagraphable(Te,we,t){const te=t.createContext(Te);return!(!t.checkChild(te,"paragraph")||!t.checkChild(te.push("paragraph"),we))}function wrapInParagraph(Te,we){const t=we.createElement("paragraph");return we.insert(t,Te),we.createPositionAt(t,0)}class UpcastHelpers extends ConversionHelpers{elementToElement(we){return this.add(upcastElementToElement(we))}elementToAttribute(we){return this.add(upcastElementToAttribute(we))}attributeToAttribute(we){return this.add(upcastAttributeToAttribute(we))}elementToMarker(we){return this.add(upcastElementToMarker(we))}dataToMarker(we){return this.add(upcastDataToMarker(we))}}function convertToModelFragment$1(){return(Te,we,t)=>{if(!we.modelRange&&t.consumable.consume(we.viewItem,{name:!0})){const{modelRange:te,modelCursor:be}=t.convertChildren(we.viewItem,we.modelCursor);we.modelRange=te,we.modelCursor=be}}}function convertText(){return(Te,we,{schema:t,consumable:te,writer:be})=>{let xe=we.modelCursor;if(!te.test(we.viewItem))return;if(!t.checkChild(xe,"$text")){if(!isParagraphable(xe,"$text",t)||we.viewItem.data.trim().length==0)return;const ke=xe.nodeBefore;xe=wrapInParagraph(xe,be),ke&&ke.is("element","$marker")&&(be.move(be.createRangeOn(ke),xe),xe=be.createPositionAfter(ke))}te.consume(we.viewItem);const ve=be.createText(we.viewItem.data);be.insert(ve,xe),we.modelRange=be.createRange(xe,xe.getShiftedBy(ve.offsetSize)),we.modelCursor=we.modelRange.end}}function convertSelectionChange(Te,we){return(t,te)=>{const be=te.newSelection,xe=[];for(const ke of be.getRanges())xe.push(we.toModelRange(ke));const ve=Te.createSelection(xe,{backward:be.isBackward});ve.isEqual(Te.document.selection)||Te.change(ke=>{ke.setSelection(ve)})}}function upcastElementToElement(Te){Te=cloneDeep(Te);const we=prepareToElementConverter(Te),t=getViewElementNameFromConfig(Te.view),te=t?`element:${t}`:"element";return be=>{be.on(te,we,{priority:Te.converterPriority||"normal"})}}function upcastElementToAttribute(Te){Te=cloneDeep(Te),normalizeModelAttributeConfig(Te);const we=prepareToAttributeConverter(Te,!1),t=getViewElementNameFromConfig(Te.view),te=t?`element:${t}`:"element";return be=>{be.on(te,we,{priority:Te.converterPriority||"low"})}}function upcastAttributeToAttribute(Te){Te=cloneDeep(Te);let we=null;(typeof Te.view=="string"||Te.view.key)&&(we=normalizeViewAttributeKeyValueConfig(Te)),normalizeModelAttributeConfig(Te,we);const t=prepareToAttributeConverter(Te,!0);return te=>{te.on("element",t,{priority:Te.converterPriority||"low"})}}function upcastElementToMarker(Te){const we=normalizeElementToMarkerModelConfig(Te.model);return upcastElementToElement({...Te,model:we})}function upcastDataToMarker(Te){Te=cloneDeep(Te),Te.model||(Te.model=be=>be?Te.view+":"+be:Te.view);const we={view:Te.view,model:Te.model},t=prepareToElementConverter(normalizeDataToMarkerConfig(we,"start")),te=prepareToElementConverter(normalizeDataToMarkerConfig(we,"end"));return be=>{be.on(`element:${Te.view}-start`,t,{priority:Te.converterPriority||"normal"}),be.on(`element:${Te.view}-end`,te,{priority:Te.converterPriority||"normal"});const xe=priorities.low,ve=priorities.highest,ke=priorities.get(Te.converterPriority)/ve;be.on("element",upcastAttributeToMarker(we),{priority:xe+ke})}}function upcastAttributeToMarker(Te){return(we,t,te)=>{const be=`data-${Te.view}`;if(!te.consumable.test(t.viewItem,{attributes:be+"-end-after"})&&!te.consumable.test(t.viewItem,{attributes:be+"-start-after"})&&!te.consumable.test(t.viewItem,{attributes:be+"-end-before"})&&!te.consumable.test(t.viewItem,{attributes:be+"-start-before"}))return;t.modelRange||Object.assign(t,te.convertChildren(t.viewItem,t.modelCursor)),te.consumable.consume(t.viewItem,{attributes:be+"-end-after"})&&xe(t.modelRange.end,t.viewItem.getAttribute(be+"-end-after").split(",")),te.consumable.consume(t.viewItem,{attributes:be+"-start-after"})&&xe(t.modelRange.end,t.viewItem.getAttribute(be+"-start-after").split(",")),te.consumable.consume(t.viewItem,{attributes:be+"-end-before"})&&xe(t.modelRange.start,t.viewItem.getAttribute(be+"-end-before").split(",")),te.consumable.consume(t.viewItem,{attributes:be+"-start-before"})&&xe(t.modelRange.start,t.viewItem.getAttribute(be+"-start-before").split(","));function xe(ve,ke){for(const Ie of ke){const Ae=Te.model(Ie,te),Se=te.writer.createElement("$marker",{"data-name":Ae});te.writer.insert(Se,ve),t.modelCursor.isEqual(ve)?t.modelCursor=t.modelCursor.getShiftedBy(1):t.modelCursor=t.modelCursor._getTransformedByInsertion(ve,1),t.modelRange=t.modelRange._getTransformedByInsertion(ve,1)[0]}}}}function getViewElementNameFromConfig(Te){return typeof Te=="string"?Te:typeof Te=="object"&&typeof Te.name=="string"?Te.name:null}function prepareToElementConverter(Te){const we=new Matcher(Te.view);return(t,te,be)=>{const xe=we.match(te.viewItem);if(!xe)return;const ve=xe.match;if(ve.name=!0,!be.consumable.test(te.viewItem,ve))return;const ke=getModelElement(Te.model,te.viewItem,be);ke&&be.safeInsert(ke,te.modelCursor)&&(be.consumable.consume(te.viewItem,ve),be.convertChildren(te.viewItem,ke),be.updateConversionResult(ke,te))}}function getModelElement(Te,we,t){return Te instanceof Function?Te(we,t):t.writer.createElement(Te)}function normalizeViewAttributeKeyValueConfig(Te){typeof Te.view=="string"&&(Te.view={key:Te.view});const we=Te.view.key,t=typeof Te.view.value>"u"?/[\s\S]*/:Te.view.value;let te;return we=="class"||we=="style"?te={[we=="class"?"classes":"styles"]:t}:te={attributes:{[we]:t}},Te.view.name&&(te.name=Te.view.name),Te.view=te,we}function normalizeModelAttributeConfig(Te,we=null){const t=we===null?!0:xe=>xe.getAttribute(we),te=typeof Te.model!="object"?Te.model:Te.model.key,be=typeof Te.model!="object"||typeof Te.model.value>"u"?t:Te.model.value;Te.model={key:te,value:be}}function prepareToAttributeConverter(Te,we){const t=new Matcher(Te.view);return(te,be,xe)=>{if(!be.modelRange&&we)return;const ve=t.match(be.viewItem);if(!ve||(onlyViewNameIsDefined(Te.view,be.viewItem)?ve.match.name=!0:delete ve.match.name,!xe.consumable.test(be.viewItem,ve.match)))return;const ke=Te.model.key,Ie=typeof Te.model.value=="function"?Te.model.value(be.viewItem,xe):Te.model.value;if(Ie===null)return;be.modelRange||Object.assign(be,xe.convertChildren(be.viewItem,be.modelCursor)),setAttributeOn(be.modelRange,{key:ke,value:Ie},we,xe)&&(xe.consumable.test(be.viewItem,{name:!0})&&(ve.match.name=!0),xe.consumable.consume(be.viewItem,ve.match))}}function onlyViewNameIsDefined(Te,we){const t=typeof Te=="function"?Te(we):Te;return typeof t=="object"&&!getViewElementNameFromConfig(t)?!1:!t.classes&&!t.attributes&&!t.styles}function setAttributeOn(Te,we,t,te){let be=!1;for(const xe of Array.from(Te.getItems({shallow:t})))te.schema.checkAttribute(xe,we.key)&&(be=!0,!xe.hasAttribute(we.key)&&te.writer.setAttribute(we.key,we.value,xe));return be}function normalizeElementToMarkerModelConfig(Te){return(we,t)=>{const te=typeof Te=="string"?Te:Te(we,t);return t.writer.createElement("$marker",{"data-name":te})}}function normalizeDataToMarkerConfig(Te,we){const t=(te,be)=>{const xe=te.getAttribute("name"),ve=Te.model(xe,be);return be.writer.createElement("$marker",{"data-name":ve})};return{view:`${Te.view}-${we}`,model:t}}function injectSelectionPostFixer$1(Te){Te.document.registerPostFixer(we=>selectionPostFixer(we,Te))}function selectionPostFixer(Te,we){const t=we.document.selection,te=we.schema,be=[];let xe=!1;for(const ve of t.getRanges()){const ke=tryFixingRange(ve,te);ke&&!ke.isEqual(ve)?(be.push(ke),xe=!0):be.push(ve)}return xe&&Te.setSelection(mergeIntersectingRanges(be),{backward:t.isBackward}),!1}function tryFixingRange(Te,we){return Te.isCollapsed?tryFixingCollapsedRange(Te,we):tryFixingNonCollapsedRage(Te,we)}function tryFixingCollapsedRange(Te,we){const t=Te.start,te=we.getNearestSelectionRange(t);if(!te){const xe=t.getAncestors().reverse().find(ve=>we.isObject(ve));return xe?Range._createOn(xe):null}if(!te.isCollapsed)return te;const be=te.start;return t.isEqual(be)?null:new Range(be)}function tryFixingNonCollapsedRage(Te,we){const{start:t,end:te}=Te,be=we.checkChild(t,"$text"),xe=we.checkChild(te,"$text"),ve=we.getLimitElement(t),ke=we.getLimitElement(te);if(ve===ke){if(be&&xe)return null;if(checkSelectionOnNonLimitElements(t,te,we)){const Oe=t.nodeAfter&&we.isSelectable(t.nodeAfter)?null:we.getNearestSelectionRange(t,"forward"),Me=te.nodeBefore&&we.isSelectable(te.nodeBefore)?null:we.getNearestSelectionRange(te,"backward"),De=Oe?Oe.start:t,Fe=Me?Me.end:te;return new Range(De,Fe)}}const Ie=ve&&!ve.is("rootElement"),Ae=ke&&!ke.is("rootElement");if(Ie||Ae){const Se=t.nodeAfter&&te.nodeBefore&&t.nodeAfter.parent===te.nodeBefore.parent,Oe=Ie&&(!Se||!isSelectable(t.nodeAfter,we)),Ve=Ae&&(!Se||!isSelectable(te.nodeBefore,we));let Me=t,De=te;return Oe&&(Me=Position._createBefore(findOutermostLimitAncestor(ve,we))),Ve&&(De=Position._createAfter(findOutermostLimitAncestor(ke,we))),new Range(Me,De)}return null}function findOutermostLimitAncestor(Te,we){let t=Te,te=t;for(;we.isLimit(te)&&te.parent;)t=te,te=te.parent;return t}function checkSelectionOnNonLimitElements(Te,we,t){const te=Te.nodeAfter&&!t.isLimit(Te.nodeAfter)||t.checkChild(Te,"$text"),be=we.nodeBefore&&!t.isLimit(we.nodeBefore)||t.checkChild(we,"$text");return te||be}function mergeIntersectingRanges(Te){const we=[...Te],t=new Set;let te=1;for(;te<we.length;){const xe=we[te],ve=we.slice(0,te);for(const[ke,Ie]of ve.entries())if(!t.has(ke)){if(xe.isEqual(Ie))t.add(ke);else if(xe.isIntersecting(Ie)){t.add(ke),t.add(te);const Ae=xe.getJoined(Ie);we.push(Ae)}}te++}return we.filter((xe,ve)=>!t.has(ve))}function isSelectable(Te,we){return Te&&we.isSelectable(Te)}class EditingController extends ObservableMixin(){constructor(t,te){super();Re(this,"model");Re(this,"view");Re(this,"mapper");Re(this,"downcastDispatcher");this.model=t,this.view=new View$1(te),this.mapper=new Mapper,this.downcastDispatcher=new DowncastDispatcher({mapper:this.mapper,schema:t.schema});const be=this.model.document,xe=be.selection,ve=this.model.markers;this.listenTo(this.model,"_beforeChanges",()=>{this.view._disableRendering(!0)},{priority:"highest"}),this.listenTo(this.model,"_afterChanges",()=>{this.view._disableRendering(!1)},{priority:"lowest"}),this.listenTo(be,"change",()=>{this.view.change(ke=>{this.downcastDispatcher.convertChanges(be.differ,ve,ke),this.downcastDispatcher.convertSelection(xe,ve,ke)})},{priority:"low"}),this.listenTo(this.view.document,"selectionChange",convertSelectionChange(this.model,this.mapper)),this.listenTo(this.view.document,"beforeinput",fixTargetRanges(this.mapper,this.model.schema,this.view),{priority:"high"}),this.downcastDispatcher.on("insert:$text",insertText(),{priority:"lowest"}),this.downcastDispatcher.on("insert",insertAttributesAndChildren(),{priority:"lowest"}),this.downcastDispatcher.on("remove",remove(),{priority:"low"}),this.downcastDispatcher.on("cleanSelection",cleanSelection()),this.downcastDispatcher.on("selection",convertRangeSelection(),{priority:"low"}),this.downcastDispatcher.on("selection",convertCollapsedSelection(),{priority:"low"}),this.view.document.roots.bindTo(this.model.document.roots).using(ke=>{if(ke.rootName=="$graveyard")return null;const Ie=new RootEditableElement(this.view.document,ke.name);return Ie.rootName=ke.rootName,this.mapper.bindElements(ke,Ie),Ie})}destroy(){this.view.destroy(),this.stopListening()}reconvertMarker(t){const te=typeof t=="string"?t:t.name,be=this.model.markers.get(te);if(!be)throw new CKEditorError("editingcontroller-reconvertmarker-marker-not-exist",this,{markerName:te});this.model.change(()=>{this.model.markers._refresh(be)})}reconvertItem(t){this.model.change(()=>{this.model.document.differ._refreshItem(t)})}}function fixTargetRanges(Te,we,t){return(te,be)=>{if(!(t.document.isComposing&&!env.isAndroid))for(let xe=0;xe<be.targetRanges.length;xe++){const ve=be.targetRanges[xe],ke=Te.toModelRange(ve),Ie=tryFixingRange(ke,we);!Ie||Ie.isEqual(ke)||(be.targetRanges[xe]=Te.toViewRange(Ie))}}}class ViewConsumable{constructor(){Re(this,"_consumables",new Map)}add(we,t){let te;if(we.is("$text")||we.is("documentFragment")){this._consumables.set(we,!0);return}this._consumables.has(we)?te=this._consumables.get(we):(te=new ViewElementConsumables(we),this._consumables.set(we,te)),te.add(t)}test(we,t){const te=this._consumables.get(we);return te===void 0?null:we.is("$text")||we.is("documentFragment")?te:te.test(t)}consume(we,t){return this.test(we,t)?(we.is("$text")||we.is("documentFragment")?this._consumables.set(we,!1):this._consumables.get(we).consume(t),!0):!1}revert(we,t){const te=this._consumables.get(we);te!==void 0&&(we.is("$text")||we.is("documentFragment")?this._consumables.set(we,!0):te.revert(t))}static consumablesFromElement(we){const t={element:we,name:!0,attributes:[],classes:[],styles:[]},te=we.getAttributeKeys();for(const ve of te)ve=="style"||ve=="class"||t.attributes.push(ve);const be=we.getClassNames();for(const ve of be)t.classes.push(ve);const xe=we.getStyleNames();for(const ve of xe)t.styles.push(ve);return t}static createFrom(we,t){if(t||(t=new ViewConsumable),we.is("$text"))return t.add(we),t;we.is("element")&&t.add(we,ViewConsumable.consumablesFromElement(we)),we.is("documentFragment")&&t.add(we);for(const te of we.getChildren())t=ViewConsumable.createFrom(te,t);return t}}const CONSUMABLE_TYPES=["attributes","classes","styles"];class ViewElementConsumables{constructor(we){Re(this,"element");Re(this,"_canConsumeName");Re(this,"_consumables");this.element=we,this._canConsumeName=null,this._consumables={attributes:new Map,styles:new Map,classes:new Map}}add(we){we.name&&(this._canConsumeName=!0);for(const t of CONSUMABLE_TYPES)t in we&&this._add(t,we[t])}test(we){if(we.name&&!this._canConsumeName)return this._canConsumeName;for(const t of CONSUMABLE_TYPES)if(t in we){const te=this._test(t,we[t]);if(te!==!0)return te}return!0}consume(we){we.name&&(this._canConsumeName=!1);for(const t of CONSUMABLE_TYPES)t in we&&this._consume(t,we[t])}revert(we){we.name&&(this._canConsumeName=!0);for(const t of CONSUMABLE_TYPES)t in we&&this._revert(t,we[t])}_add(we,t){const te=toArray$2(t),be=this._consumables[we];for(const xe of te){if(we==="attributes"&&(xe==="class"||xe==="style"))throw new CKEditorError("viewconsumable-invalid-attribute",this);if(be.set(xe,!0),we==="styles")for(const ve of this.element.document.stylesProcessor.getRelatedStyles(xe))be.set(ve,!0)}}_test(we,t){const te=toArray$2(t),be=this._consumables[we];for(const xe of te)if(we==="attributes"&&(xe==="class"||xe==="style")){const ve=xe=="class"?"classes":"styles",ke=this._test(ve,[...this._consumables[ve].keys()]);if(ke!==!0)return ke}else{const ve=be.get(xe);if(ve===void 0)return null;if(!ve)return!1}return!0}_consume(we,t){const te=toArray$2(t),be=this._consumables[we];for(const xe of te)if(we==="attributes"&&(xe==="class"||xe==="style")){const ve=xe=="class"?"classes":"styles";this._consume(ve,[...this._consumables[ve].keys()])}else if(be.set(xe,!1),we=="styles")for(const ve of this.element.document.stylesProcessor.getRelatedStyles(xe))be.set(ve,!1)}_revert(we,t){const te=toArray$2(t),be=this._consumables[we];for(const xe of te)if(we==="attributes"&&(xe==="class"||xe==="style")){const ve=xe=="class"?"classes":"styles";this._revert(ve,[...this._consumables[ve].keys()])}else be.get(xe)===!1&&be.set(xe,!0)}}class Schema extends ObservableMixin(){constructor(){super();Re(this,"_sourceDefinitions",{});Re(this,"_attributeProperties",{});Re(this,"_compiledDefinitions");this.decorate("checkChild"),this.decorate("checkAttribute"),this.on("checkAttribute",(t,te)=>{te[0]=new SchemaContext(te[0])},{priority:"highest"}),this.on("checkChild",(t,te)=>{te[0]=new SchemaContext(te[0]),te[1]=this.getDefinition(te[1])},{priority:"highest"})}register(t,te){if(this._sourceDefinitions[t])throw new CKEditorError("schema-cannot-register-item-twice",this,{itemName:t});this._sourceDefinitions[t]=[Object.assign({},te)],this._clearCache()}extend(t,te){if(!this._sourceDefinitions[t])throw new CKEditorError("schema-cannot-extend-missing-item",this,{itemName:t});this._sourceDefinitions[t].push(Object.assign({},te)),this._clearCache()}getDefinitions(){return this._compiledDefinitions||this._compile(),this._compiledDefinitions}getDefinition(t){let te;return typeof t=="string"?te=t:"is"in t&&(t.is("$text")||t.is("$textProxy"))?te="$text":te=t.name,this.getDefinitions()[te]}isRegistered(t){return!!this.getDefinition(t)}isBlock(t){const te=this.getDefinition(t);return!!(te&&te.isBlock)}isLimit(t){const te=this.getDefinition(t);return te?!!(te.isLimit||te.isObject):!1}isObject(t){const te=this.getDefinition(t);return te?!!(te.isObject||te.isLimit&&te.isSelectable&&te.isContent):!1}isInline(t){const te=this.getDefinition(t);return!!(te&&te.isInline)}isSelectable(t){const te=this.getDefinition(t);return te?!!(te.isSelectable||te.isObject):!1}isContent(t){const te=this.getDefinition(t);return te?!!(te.isContent||te.isObject):!1}checkChild(t,te){return te?this._checkContextMatch(te,t):!1}checkAttribute(t,te){const be=this.getDefinition(t.last);return be?be.allowAttributes.includes(te):!1}checkMerge(t,te){if(t instanceof Position){const be=t.nodeBefore,xe=t.nodeAfter;if(!(be instanceof Element))throw new CKEditorError("schema-check-merge-no-element-before",this);if(!(xe instanceof Element))throw new CKEditorError("schema-check-merge-no-element-after",this);return this.checkMerge(be,xe)}for(const be of te.getChildren())if(!this.checkChild(t,be))return!1;return!0}addChildCheck(t){this.on("checkChild",(te,[be,xe])=>{if(!xe)return;const ve=t(be,xe);typeof ve=="boolean"&&(te.stop(),te.return=ve)},{priority:"high"})}addAttributeCheck(t){this.on("checkAttribute",(te,[be,xe])=>{const ve=t(be,xe);typeof ve=="boolean"&&(te.stop(),te.return=ve)},{priority:"high"})}setAttributeProperties(t,te){this._attributeProperties[t]=Object.assign(this.getAttributeProperties(t),te)}getAttributeProperties(t){return this._attributeProperties[t]||{}}getLimitElement(t){let te;for(t instanceof Position?te=t.parent:te=(t instanceof Range?[t]:Array.from(t.getRanges())).reduce((xe,ve)=>{const ke=ve.getCommonAncestor();return xe?xe.getCommonAncestor(ke,{includeSelf:!0}):ke},null);!this.isLimit(te)&&te.parent;)te=te.parent;return te}checkAttributeInSelection(t,te){if(t.isCollapsed){const xe=[...t.getFirstPosition().getAncestors(),new Text("",t.getAttributes())];return this.checkAttribute(xe,te)}else{const be=t.getRanges();for(const xe of be)for(const ve of xe)if(this.checkAttribute(ve.item,te))return!0}return!1}*getValidRanges(t,te){t=convertToMinimalFlatRanges(t);for(const be of t)yield*this._getValidRangesForRange(be,te)}getNearestSelectionRange(t,te="both"){if(t.root.rootName=="$graveyard")return null;if(this.checkChild(t,"$text"))return new Range(t);let be,xe;const ve=t.getAncestors().reverse().find(ke=>this.isLimit(ke))||t.root;(te=="both"||te=="backward")&&(be=new TreeWalker({boundaries:Range._createIn(ve),startPosition:t,direction:"backward"})),(te=="both"||te=="forward")&&(xe=new TreeWalker({boundaries:Range._createIn(ve),startPosition:t}));for(const ke of combineWalkers(be,xe)){const Ie=ke.walker==be?"elementEnd":"elementStart",Ae=ke.value;if(Ae.type==Ie&&this.isObject(Ae.item))return Range._createOn(Ae.item);if(this.checkChild(Ae.nextPosition,"$text"))return new Range(Ae.nextPosition)}return null}findAllowedParent(t,te){let be=t.parent;for(;be;){if(this.checkChild(be,te))return be;if(this.isLimit(be))return null;be=be.parent}return null}setAllowedAttributes(t,te,be){const xe=be.model;for(const[ve,ke]of Object.entries(te))xe.schema.checkAttribute(t,ve)&&be.setAttribute(ve,ke,t)}removeDisallowedAttributes(t,te){for(const be of t)if(be.is("$text"))removeDisallowedAttributeFromNode(this,be,te);else{const ve=Range._createIn(be).getPositions();for(const ke of ve){const Ie=ke.nodeBefore||ke.parent;removeDisallowedAttributeFromNode(this,Ie,te)}}}getAttributesWithProperty(t,te,be){const xe={};for(const[ve,ke]of t.getAttributes()){const Ie=this.getAttributeProperties(ve);Ie[te]!==void 0&&(be===void 0||be===Ie[te])&&(xe[ve]=ke)}return xe}createContext(t){return new SchemaContext(t)}_clearCache(){this._compiledDefinitions=null}_compile(){const t={},te=this._sourceDefinitions,be=Object.keys(te);for(const ve of be)t[ve]=compileBaseItemRule(te[ve],ve);const xe=Object.values(t);for(const ve of xe)propagateAllowIn(t,ve),propagateAllowChildren(t,ve),propagateDisallowIn(t,ve),propagateDisallowChildren(t,ve);for(const ve of xe)resolveDisallows(t,ve);for(const ve of xe)compileAllowContentOf(t,ve);for(const ve of xe)compileAllowWhere(t,ve);for(const ve of xe)compileAllowAttributesOf(t,ve);for(const ve of xe)compileInheritPropertiesFrom(t,ve);this._compiledDefinitions=compileDefinitions(t)}_checkContextMatch(t,te,be=te.length-1){const xe=te.getItem(be);if(t.allowIn.includes(xe.name)){if(be==0)return!0;{const ve=this.getDefinition(xe);return this._checkContextMatch(ve,te,be-1)}}else return!1}*_getValidRangesForRange(t,te){let be=t.start,xe=t.start;for(const ve of t.getItems({shallow:!0}))ve.is("element")&&(yield*this._getValidRangesForRange(Range._createIn(ve),te)),this.checkAttribute(ve,te)||(be.isEqual(xe)||(yield new Range(be,xe)),be=Position._createAfter(ve)),xe=Position._createAfter(ve);be.isEqual(xe)||(yield new Range(be,xe))}findOptimalInsertionRange(t,te){const be=t.getSelectedElement();if(be&&this.isObject(be)&&!this.isInline(be))return te=="before"||te=="after"?new Range(Position._createAt(be,te)):Range._createOn(be);const xe=first(t.getSelectedBlocks());if(!xe)return new Range(t.focus);if(xe.isEmpty)return new Range(Position._createAt(xe,0));const ve=Position._createAfter(xe);return t.focus.isTouching(ve)?new Range(ve):new Range(Position._createBefore(xe))}}class SchemaContext{constructor(we){Re(this,"_items");if(we instanceof SchemaContext)return we;let t;typeof we=="string"?t=[we]:Array.isArray(we)?t=we:t=we.getAncestors({includeSelf:!0}),this._items=t.map(mapContextItem)}get length(){return this._items.length}get last(){return this._items[this._items.length-1]}[Symbol.iterator](){return this._items[Symbol.iterator]()}push(we){const t=new SchemaContext([we]);return t._items=[...this._items,...t._items],t}getItem(we){return this._items[we]}*getNames(){yield*this._items.map(we=>we.name)}endsWith(we){return Array.from(this.getNames()).join(" ").endsWith(we)}startsWith(we){return Array.from(this.getNames()).join(" ").startsWith(we)}}function compileBaseItemRule(Te,we){const t={name:we,allowIn:new Set,allowChildren:new Set,disallowIn:new Set,disallowChildren:new Set,allowContentOf:new Set,allowWhere:new Set,allowAttributes:new Set,disallowAttributes:new Set,allowAttributesOf:new Set,inheritTypesFrom:new Set};return copyTypes(Te,t),copyProperty(Te,t,"allowIn"),copyProperty(Te,t,"allowChildren"),copyProperty(Te,t,"disallowIn"),copyProperty(Te,t,"disallowChildren"),copyProperty(Te,t,"allowContentOf"),copyProperty(Te,t,"allowWhere"),copyProperty(Te,t,"allowAttributes"),copyProperty(Te,t,"disallowAttributes"),copyProperty(Te,t,"allowAttributesOf"),copyProperty(Te,t,"inheritTypesFrom"),resolveInheritAll(Te,t),t}function propagateAllowIn(Te,we){for(const t of we.allowIn){const te=Te[t];te?te.allowChildren.add(we.name):we.allowIn.delete(t)}}function propagateAllowChildren(Te,we){for(const t of we.allowChildren){const te=Te[t];te?te.allowIn.add(we.name):we.allowChildren.delete(t)}}function propagateDisallowIn(Te,we){for(const t of we.disallowIn){const te=Te[t];te?te.disallowChildren.add(we.name):we.disallowIn.delete(t)}}function propagateDisallowChildren(Te,we){for(const t of we.disallowChildren){const te=Te[t];te?te.disallowIn.add(we.name):we.disallowChildren.delete(t)}}function resolveDisallows(Te,we){for(const t of we.disallowChildren)we.allowChildren.delete(t);for(const t of we.disallowIn)we.allowIn.delete(t);for(const t of we.disallowAttributes)we.allowAttributes.delete(t)}function compileAllowContentOf(Te,we){for(const t of we.allowContentOf){const te=Te[t];te&&(te.disallowChildren.forEach(be=>{we.allowChildren.has(be)||(we.disallowChildren.add(be),Te[be].disallowIn.add(we.name))}),te.allowChildren.forEach(be=>{we.disallowChildren.has(be)||(we.allowChildren.add(be),Te[be].allowIn.add(we.name))}))}}function compileAllowWhere(Te,we){for(const t of we.allowWhere){const te=Te[t];te&&(te.disallowIn.forEach(be=>{we.allowIn.has(be)||(we.disallowIn.add(be),Te[be].disallowChildren.add(we.name))}),te.allowIn.forEach(be=>{we.disallowIn.has(be)||(we.allowIn.add(be),Te[be].allowChildren.add(we.name))}))}}function compileDefinitions(Te){const we={};for(const t of Object.values(Te))we[t.name]={name:t.name,isBlock:!!t.isBlock,isContent:!!t.isContent,isInline:!!t.isInline,isLimit:!!t.isLimit,isObject:!!t.isObject,isSelectable:!!t.isSelectable,allowIn:Array.from(t.allowIn).filter(te=>!!Te[te]),allowChildren:Array.from(t.allowChildren).filter(te=>!!Te[te]),allowAttributes:Array.from(t.allowAttributes)};return we}function compileAllowAttributesOf(Te,we){for(const t of we.allowAttributesOf){const te=Te[t];if(!te)return;te.allowAttributes.forEach(be=>{we.disallowAttributes.has(be)||we.allowAttributes.add(be)})}}function compileInheritPropertiesFrom(Te,we){for(const t of we.inheritTypesFrom){const te=Te[t];if(te){const be=Object.keys(te).filter(xe=>xe.startsWith("is"));for(const xe of be)xe in we||(we[xe]=te[xe])}}}function copyTypes(Te,we){for(const t of Te){const te=Object.keys(t).filter(be=>be.startsWith("is"));for(const be of te)we[be]=!!t[be]}}function copyProperty(Te,we,t){for(const te of Te){let be=te[t];typeof be=="string"&&(be=[be]),Array.isArray(be)&&be.forEach(xe=>we[t].add(xe))}}function resolveInheritAll(Te,we){for(const t of Te){const te=t.inheritAllFrom;te&&(we.allowContentOf.add(te),we.allowWhere.add(te),we.allowAttributesOf.add(te),we.inheritTypesFrom.add(te))}}function mapContextItem(Te){return typeof Te=="string"||Te.is("documentFragment")?{name:typeof Te=="string"?Te:"$documentFragment",*getAttributeKeys(){},getAttribute(){}}:{name:Te.is("element")?Te.name:"$text",*getAttributeKeys(){yield*Te.getAttributeKeys()},getAttribute(we){return Te.getAttribute(we)}}}function*combineWalkers(Te,we){let t=!1;for(;!t;){if(t=!0,Te){const te=Te.next();te.done||(t=!1,yield{walker:Te,value:te.value})}if(we){const te=we.next();te.done||(t=!1,yield{walker:we,value:te.value})}}}function*convertToMinimalFlatRanges(Te){for(const we of Te)yield*we.getMinimalFlatRanges()}function removeDisallowedAttributeFromNode(Te,we,t){for(const te of we.getAttributeKeys())Te.checkAttribute(we,te)||t.removeAttribute(te,we)}class UpcastDispatcher extends EmitterMixin(){constructor(t){super();Re(this,"conversionApi");Re(this,"_splitParts",new Map);Re(this,"_cursorParents",new Map);Re(this,"_modelCursor",null);Re(this,"_emptyElementsToKeep",new Set);this.conversionApi={...t,consumable:null,writer:null,store:null,convertItem:(te,be)=>this._convertItem(te,be),convertChildren:(te,be)=>this._convertChildren(te,be),safeInsert:(te,be)=>this._safeInsert(te,be),updateConversionResult:(te,be)=>this._updateConversionResult(te,be),splitToAllowedParent:(te,be)=>this._splitToAllowedParent(te,be),getSplitParts:te=>this._getSplitParts(te),keepEmptyElement:te=>this._keepEmptyElement(te)}}convert(t,te,be=["$root"]){this.fire("viewCleanup",t),this._modelCursor=createContextTree(be,te),this.conversionApi.writer=te,this.conversionApi.consumable=ViewConsumable.createFrom(t),this.conversionApi.store={};const{modelRange:xe}=this._convertItem(t,this._modelCursor),ve=te.createDocumentFragment();if(xe){this._removeEmptyElements();for(const ke of Array.from(this._modelCursor.parent.getChildren()))te.append(ke,ve);ve.markers=extractMarkersFromModelFragment(ve,te)}return this._modelCursor=null,this._splitParts.clear(),this._cursorParents.clear(),this._emptyElementsToKeep.clear(),this.conversionApi.writer=null,this.conversionApi.store=null,ve}_convertItem(t,te){const be={viewItem:t,modelCursor:te,modelRange:null};if(t.is("element")?this.fire(`element:${t.name}`,be,this.conversionApi):t.is("$text")?this.fire("text",be,this.conversionApi):this.fire("documentFragment",be,this.conversionApi),be.modelRange&&!(be.modelRange instanceof Range))throw new CKEditorError("view-conversion-dispatcher-incorrect-result",this);return{modelRange:be.modelRange,modelCursor:be.modelCursor}}_convertChildren(t,te){let be=te.is("position")?te:Position._createAt(te,0);const xe=new Range(be);for(const ve of Array.from(t.getChildren())){const ke=this._convertItem(ve,be);ke.modelRange instanceof Range&&(xe.end=ke.modelRange.end,be=ke.modelCursor)}return{modelRange:xe,modelCursor:be}}_safeInsert(t,te){const be=this._splitToAllowedParent(t,te);return be?(this.conversionApi.writer.insert(t,be.position),!0):!1}_updateConversionResult(t,te){const be=this._getSplitParts(t),xe=this.conversionApi.writer;te.modelRange||(te.modelRange=xe.createRange(xe.createPositionBefore(t),xe.createPositionAfter(be[be.length-1])));const ve=this._cursorParents.get(t);ve?te.modelCursor=xe.createPositionAt(ve,0):te.modelCursor=te.modelRange.end}_splitToAllowedParent(t,te){const{schema:be,writer:xe}=this.conversionApi;let ve=be.findAllowedParent(te,t);if(ve){if(ve===te.parent)return{position:te};this._modelCursor.parent.getAncestors().includes(ve)&&(ve=null)}if(!ve)return isParagraphable(te,t,be)?{position:wrapInParagraph(te,xe)}:null;const ke=this.conversionApi.writer.split(te,ve),Ie=[];for(const Se of ke.range.getWalker())if(Se.type=="elementEnd")Ie.push(Se.item);else{const Oe=Ie.pop(),Ve=Se.item;this._registerSplitPair(Oe,Ve)}const Ae=ke.range.end.parent;return this._cursorParents.set(t,Ae),{position:ke.position,cursorParent:Ae}}_registerSplitPair(t,te){this._splitParts.has(t)||this._splitParts.set(t,[t]);const be=this._splitParts.get(t);this._splitParts.set(te,be),be.push(te)}_getSplitParts(t){let te;return this._splitParts.has(t)?te=this._splitParts.get(t):te=[t],te}_keepEmptyElement(t){this._emptyElementsToKeep.add(t)}_removeEmptyElements(){let t=!1;for(const te of this._splitParts.keys())te.isEmpty&&!this._emptyElementsToKeep.has(te)&&(this.conversionApi.writer.remove(te),this._splitParts.delete(te),t=!0);t&&this._removeEmptyElements()}}function extractMarkersFromModelFragment(Te,we){const t=new Set,te=new Map,be=Range._createIn(Te).getItems();for(const xe of be)xe.is("element","$marker")&&t.add(xe);for(const xe of t){const ve=xe.getAttribute("data-name"),ke=we.createPositionBefore(xe);te.has(ve)?te.get(ve).end=ke.clone():te.set(ve,new Range(ke.clone())),we.remove(xe)}return te}function createContextTree(Te,we){let t;for(const te of new SchemaContext(Te)){const be={};for(const ve of te.getAttributeKeys())be[ve]=te.getAttribute(ve);const xe=we.createElement(te.name,be);t&&we.insert(xe,t),t=Position._createAt(xe,0)}return t}class BasicHtmlWriter{getHtml(we){const te=global.document.implementation.createHTMLDocument("").createElement("div");return te.appendChild(we),te.innerHTML}}class HtmlDataProcessor{constructor(we){Re(this,"domParser");Re(this,"domConverter");Re(this,"htmlWriter");Re(this,"skipComments",!0);this.domParser=new DOMParser,this.domConverter=new DomConverter(we,{renderingMode:"data"}),this.htmlWriter=new BasicHtmlWriter}toData(we){const t=this.domConverter.viewToDom(we);return this.htmlWriter.getHtml(t)}toView(we){const t=this._toDom(we);return this.domConverter.domToView(t,{skipComments:this.skipComments})}registerRawContentMatcher(we){this.domConverter.registerRawContentMatcher(we)}useFillerType(we){this.domConverter.blockFillerMode=we=="marked"?"markedNbsp":"nbsp"}_toDom(we){we.match(/<(?:html|body|head|meta)(?:\s[^>]*)?>/i)||(we=`<body>${we}</body>`);const t=this.domParser.parseFromString(we,"text/html"),te=t.createDocumentFragment(),be=t.body.childNodes;for(;be.length>0;)te.appendChild(be[0]);return te}}class DataController extends EmitterMixin(){constructor(t,te){super();Re(this,"model");Re(this,"mapper");Re(this,"downcastDispatcher");Re(this,"upcastDispatcher");Re(this,"viewDocument");Re(this,"stylesProcessor");Re(this,"htmlProcessor");Re(this,"processor");Re(this,"_viewWriter");this.model=t,this.mapper=new Mapper,this.downcastDispatcher=new DowncastDispatcher({mapper:this.mapper,schema:t.schema}),this.downcastDispatcher.on("insert:$text",insertText(),{priority:"lowest"}),this.downcastDispatcher.on("insert",insertAttributesAndChildren(),{priority:"lowest"}),this.upcastDispatcher=new UpcastDispatcher({schema:t.schema}),this.viewDocument=new Document$1(te),this.stylesProcessor=te,this.htmlProcessor=new HtmlDataProcessor(this.viewDocument),this.processor=this.htmlProcessor,this._viewWriter=new DowncastWriter(this.viewDocument),this.upcastDispatcher.on("text",convertText(),{priority:"lowest"}),this.upcastDispatcher.on("element",convertToModelFragment$1(),{priority:"lowest"}),this.upcastDispatcher.on("documentFragment",convertToModelFragment$1(),{priority:"lowest"}),ObservableMixin().prototype.decorate.call(this,"init"),ObservableMixin().prototype.decorate.call(this,"set"),ObservableMixin().prototype.decorate.call(this,"get"),ObservableMixin().prototype.decorate.call(this,"toView"),ObservableMixin().prototype.decorate.call(this,"toModel"),this.on("init",()=>{this.fire("ready")},{priority:"lowest"}),this.on("ready",()=>{this.model.enqueueChange({isUndoable:!1},autoParagraphEmptyRoots)},{priority:"lowest"})}get(t={}){const{rootName:te="main",trim:be="empty"}=t;if(!this._checkIfRootsExists([te]))throw new CKEditorError("datacontroller-get-non-existent-root",this);const xe=this.model.document.getRoot(te);return xe.isAttached()||logWarning("datacontroller-get-detached-root",this),be==="empty"&&!this.model.hasContent(xe,{ignoreWhitespaces:!0})?"":this.stringify(xe,t)}stringify(t,te={}){const be=this.toView(t,te);return this.processor.toData(be)}toView(t,te={}){const be=this.viewDocument,xe=this._viewWriter;this.mapper.clearBindings();const ve=Range._createIn(t),ke=new DocumentFragment$1(be);this.mapper.bindElements(t,ke);const Ie=t.is("documentFragment")?t.markers:_getMarkersRelativeToElement(t);return this.downcastDispatcher.convert(ve,Ie,xe,te),ke}init(t){if(this.model.document.version)throw new CKEditorError("datacontroller-init-document-not-empty",this);let te={};if(typeof t=="string"?te.main=t:te=t,!this._checkIfRootsExists(Object.keys(te)))throw new CKEditorError("datacontroller-init-non-existent-root",this);return this.model.enqueueChange({isUndoable:!1},be=>{for(const xe of Object.keys(te)){const ve=this.model.document.getRoot(xe);be.insert(this.parse(te[xe],ve),ve,0)}}),Promise.resolve()}set(t,te={}){let be={};if(typeof t=="string"?be.main=t:be=t,!this._checkIfRootsExists(Object.keys(be)))throw new CKEditorError("datacontroller-set-non-existent-root",this);this.model.enqueueChange(te.batchType||{},xe=>{xe.setSelection(null),xe.removeSelectionAttribute(this.model.document.selection.getAttributeKeys());for(const ve of Object.keys(be)){const ke=this.model.document.getRoot(ve);xe.remove(xe.createRangeIn(ke)),xe.insert(this.parse(be[ve],ke),ke,0)}})}parse(t,te="$root"){const be=this.processor.toView(t);return this.toModel(be,te)}toModel(t,te="$root"){return this.model.change(be=>this.upcastDispatcher.convert(t,be,te))}addStyleProcessorRules(t){t(this.stylesProcessor)}registerRawContentMatcher(t){this.processor&&this.processor!==this.htmlProcessor&&this.processor.registerRawContentMatcher(t),this.htmlProcessor.registerRawContentMatcher(t)}destroy(){this.stopListening()}_checkIfRootsExists(t){for(const te of t)if(!this.model.document.getRoot(te))return!1;return!0}}function _getMarkersRelativeToElement(Te){const we=[],t=Te.root.document;if(!t)return new Map;const te=Range._createIn(Te);for(const be of t.model.markers){const xe=be.getRange(),ve=xe.isCollapsed,ke=xe.start.isEqual(te.start)||xe.end.isEqual(te.end);if(ve&&ke)we.push([be.name,xe]);else{const Ie=te.getIntersection(xe);Ie&&we.push([be.name,Ie])}}return we.sort(([be,xe],[ve,ke])=>{if(xe.end.compareWith(ke.start)!=="after")return 1;if(xe.start.compareWith(ke.end)!=="before")return-1;switch(xe.start.compareWith(ke.start)){case"before":return 1;case"after":return-1;default:switch(xe.end.compareWith(ke.end)){case"before":return 1;case"after":return-1;default:return ve.localeCompare(be)}}}),new Map(we)}class Conversion{constructor(we,t){Re(this,"_helpers",new Map);Re(this,"_downcast");Re(this,"_upcast");this._downcast=toArray$2(we),this._createConversionHelpers({name:"downcast",dispatchers:this._downcast,isDowncast:!0}),this._upcast=toArray$2(t),this._createConversionHelpers({name:"upcast",dispatchers:this._upcast,isDowncast:!1})}addAlias(we,t){const te=this._downcast.includes(t);if(!this._upcast.includes(t)&&!te)throw new CKEditorError("conversion-add-alias-dispatcher-not-registered",this);this._createConversionHelpers({name:we,dispatchers:[t],isDowncast:te})}for(we){if(!this._helpers.has(we))throw new CKEditorError("conversion-for-unknown-group",this);return this._helpers.get(we)}elementToElement(we){this.for("downcast").elementToElement(we);for(const{model:t,view:te}of _getAllUpcastDefinitions(we))this.for("upcast").elementToElement({model:t,view:te,converterPriority:we.converterPriority})}attributeToElement(we){this.for("downcast").attributeToElement(we);for(const{model:t,view:te}of _getAllUpcastDefinitions(we))this.for("upcast").elementToAttribute({view:te,model:t,converterPriority:we.converterPriority})}attributeToAttribute(we){this.for("downcast").attributeToAttribute(we);for(const{model:t,view:te}of _getAllUpcastDefinitions(we))this.for("upcast").attributeToAttribute({view:te,model:t})}_createConversionHelpers({name:we,dispatchers:t,isDowncast:te}){if(this._helpers.has(we))throw new CKEditorError("conversion-group-exists",this);const be=te?new DowncastHelpers(t):new UpcastHelpers(t);this._helpers.set(we,be)}}function*_getAllUpcastDefinitions(Te){if(Te.model.values)for(const we of Te.model.values){const t={key:Te.model.key,value:we},te=Te.view[we],be=Te.upcastAlso?Te.upcastAlso[we]:void 0;yield*_getUpcastDefinition(t,te,be)}else yield*_getUpcastDefinition(Te.model,Te.view,Te.upcastAlso)}function*_getUpcastDefinition(Te,we,t){if(yield{model:Te,view:we},t)for(const te of toArray$2(t))yield{model:Te,view:te}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Operation{constructor(we){Re(this,"baseVersion");Re(this,"isDocumentOperation");Re(this,"batch");this.baseVersion=we,this.isDocumentOperation=this.baseVersion!==null,this.batch=null}_validate(){}toJSON(){const we=Object.assign({},this);return we.__className=this.constructor.className,delete we.batch,delete we.isDocumentOperation,we}static get className(){return"Operation"}static fromJSON(we,t){return new this(we.baseVersion)}}function _insert(Te,we){const t=_normalizeNodes(we),te=t.reduce((ve,ke)=>ve+ke.offsetSize,0),be=Te.parent;_splitNodeAtPosition(Te);const xe=Te.index;return be._insertChild(xe,t),_mergeNodesAtIndex(be,xe+t.length),_mergeNodesAtIndex(be,xe),new Range(Te,Te.getShiftedBy(te))}function _remove(Te){if(!Te.isFlat)throw new CKEditorError("operation-utils-remove-range-not-flat",this);const we=Te.start.parent;_splitNodeAtPosition(Te.start),_splitNodeAtPosition(Te.end);const t=we._removeChildren(Te.start.index,Te.end.index-Te.start.index);return _mergeNodesAtIndex(we,Te.start.index),t}function _move(Te,we){if(!Te.isFlat)throw new CKEditorError("operation-utils-move-range-not-flat",this);const t=_remove(Te);return we=we._getTransformedByDeletion(Te.start,Te.end.offset-Te.start.offset),_insert(we,t)}function _setAttribute(Te,we,t){_splitNodeAtPosition(Te.start),_splitNodeAtPosition(Te.end);for(const te of Te.getItems({shallow:!0})){const be=te.is("$textProxy")?te.textNode:te;t!==null?be._setAttribute(we,t):be._removeAttribute(we),_mergeNodesAtIndex(be.parent,be.index)}_mergeNodesAtIndex(Te.end.parent,Te.end.index)}function _normalizeNodes(Te){const we=[];function t(te){if(typeof te=="string")we.push(new Text(te));else if(te instanceof TextProxy)we.push(new Text(te.data,te.getAttributes()));else if(te instanceof Node$1)we.push(te);else if(isIterable(te))for(const be of te)t(be)}t(Te);for(let te=1;te<we.length;te++){const be=we[te],xe=we[te-1];be instanceof Text&&xe instanceof Text&&_haveSameAttributes(be,xe)&&(we.splice(te-1,2,new Text(xe.data+be.data,xe.getAttributes())),te--)}return we}function _mergeNodesAtIndex(Te,we){const t=Te.getChild(we-1),te=Te.getChild(we);if(t&&te&&t.is("$text")&&te.is("$text")&&_haveSameAttributes(t,te)){const be=new Text(t.data+te.data,t.getAttributes());Te._removeChildren(we-1,2),Te._insertChild(we-1,be)}}function _splitNodeAtPosition(Te){const we=Te.textNode,t=Te.parent;if(we){const te=Te.offset-we.startOffset,be=we.index;t._removeChildren(be,1);const xe=new Text(we.data.substr(0,te),we.getAttributes()),ve=new Text(we.data.substr(te),we.getAttributes());t._insertChild(be,[xe,ve])}}function _haveSameAttributes(Te,we){const t=Te.getAttributes(),te=we.getAttributes();for(const be of t){if(be[1]!==we.getAttribute(be[0]))return!1;te.next()}return te.next().done}class MoveOperation extends Operation{constructor(t,te,be,xe){super(xe);Re(this,"sourcePosition");Re(this,"howMany");Re(this,"targetPosition");this.sourcePosition=t.clone(),this.sourcePosition.stickiness="toNext",this.howMany=te,this.targetPosition=be.clone(),this.targetPosition.stickiness="toNone"}get type(){return this.targetPosition.root.rootName=="$graveyard"?"remove":this.sourcePosition.root.rootName=="$graveyard"?"reinsert":"move"}get affectedSelectable(){return[Range._createFromPositionAndShift(this.sourcePosition,this.howMany),Range._createFromPositionAndShift(this.targetPosition,0)]}clone(){return new MoveOperation(this.sourcePosition,this.howMany,this.targetPosition,this.baseVersion)}getMovedRangeStart(){return this.targetPosition._getTransformedByDeletion(this.sourcePosition,this.howMany)}getReversed(){const t=this.sourcePosition._getTransformedByInsertion(this.targetPosition,this.howMany);return new MoveOperation(this.getMovedRangeStart(),this.howMany,t,this.baseVersion+1)}_validate(){const t=this.sourcePosition.parent,te=this.targetPosition.parent,be=this.sourcePosition.offset,xe=this.targetPosition.offset;if(be+this.howMany>t.maxOffset)throw new CKEditorError("move-operation-nodes-do-not-exist",this);if(t===te&&be<xe&&xe<be+this.howMany)throw new CKEditorError("move-operation-range-into-itself",this);if(this.sourcePosition.root==this.targetPosition.root&&compareArrays(this.sourcePosition.getParentPath(),this.targetPosition.getParentPath())=="prefix"){const ve=this.sourcePosition.path.length-1;if(this.targetPosition.path[ve]>=be&&this.targetPosition.path[ve]<be+this.howMany)throw new CKEditorError("move-operation-node-into-itself",this)}}_execute(){_move(Range._createFromPositionAndShift(this.sourcePosition,this.howMany),this.targetPosition)}toJSON(){const t=super.toJSON();return t.sourcePosition=this.sourcePosition.toJSON(),t.targetPosition=this.targetPosition.toJSON(),t}static get className(){return"MoveOperation"}static fromJSON(t,te){const be=Position.fromJSON(t.sourcePosition,te),xe=Position.fromJSON(t.targetPosition,te);return new this(be,t.howMany,xe,t.baseVersion)}}class InsertOperation extends Operation{constructor(t,te,be){super(be);Re(this,"position");Re(this,"nodes");Re(this,"shouldReceiveAttributes");this.position=t.clone(),this.position.stickiness="toNone",this.nodes=new NodeList(_normalizeNodes(te)),this.shouldReceiveAttributes=!1}get type(){return"insert"}get howMany(){return this.nodes.maxOffset}get affectedSelectable(){return this.position.clone()}clone(){const t=new NodeList([...this.nodes].map(be=>be._clone(!0))),te=new InsertOperation(this.position,t,this.baseVersion);return te.shouldReceiveAttributes=this.shouldReceiveAttributes,te}getReversed(){const t=this.position.root.document.graveyard,te=new Position(t,[0]);return new MoveOperation(this.position,this.nodes.maxOffset,te,this.baseVersion+1)}_validate(){const t=this.position.parent;if(!t||t.maxOffset<this.position.offset)throw new CKEditorError("insert-operation-position-invalid",this)}_execute(){const t=this.nodes;this.nodes=new NodeList([...t].map(te=>te._clone(!0))),_insert(this.position,t)}toJSON(){const t=super.toJSON();return t.position=this.position.toJSON(),t.nodes=this.nodes.toJSON(),t}static get className(){return"InsertOperation"}static fromJSON(t,te){const be=[];for(const ve of t.nodes)ve.name?be.push(Element.fromJSON(ve)):be.push(Text.fromJSON(ve));const xe=new InsertOperation(Position.fromJSON(t.position,te),be,t.baseVersion);return xe.shouldReceiveAttributes=t.shouldReceiveAttributes,xe}}class SplitOperation extends Operation{constructor(t,te,be,xe,ve){super(ve);Re(this,"splitPosition");Re(this,"howMany");Re(this,"insertionPosition");Re(this,"graveyardPosition");this.splitPosition=t.clone(),this.splitPosition.stickiness="toNext",this.howMany=te,this.insertionPosition=be,this.graveyardPosition=xe?xe.clone():null,this.graveyardPosition&&(this.graveyardPosition.stickiness="toNext")}get type(){return"split"}get moveTargetPosition(){const t=this.insertionPosition.path.slice();return t.push(0),new Position(this.insertionPosition.root,t)}get movedRange(){const t=this.splitPosition.getShiftedBy(Number.POSITIVE_INFINITY);return new Range(this.splitPosition,t)}get affectedSelectable(){const t=[Range._createFromPositionAndShift(this.splitPosition,0),Range._createFromPositionAndShift(this.insertionPosition,0)];return this.graveyardPosition&&t.push(Range._createFromPositionAndShift(this.graveyardPosition,0)),t}clone(){return new SplitOperation(this.splitPosition,this.howMany,this.insertionPosition,this.graveyardPosition,this.baseVersion)}getReversed(){const t=this.splitPosition.root.document.graveyard,te=new Position(t,[0]);return new MergeOperation(this.moveTargetPosition,this.howMany,this.splitPosition,te,this.baseVersion+1)}_validate(){const t=this.splitPosition.parent,te=this.splitPosition.offset;if(!t||t.maxOffset<te)throw new CKEditorError("split-operation-position-invalid",this);if(t.parent){if(this.howMany!=t.maxOffset-this.splitPosition.offset)throw new CKEditorError("split-operation-how-many-invalid",this);if(this.graveyardPosition&&!this.graveyardPosition.nodeAfter)throw new CKEditorError("split-operation-graveyard-position-invalid",this)}else throw new CKEditorError("split-operation-split-in-root",this)}_execute(){const t=this.splitPosition.parent;if(this.graveyardPosition)_move(Range._createFromPositionAndShift(this.graveyardPosition,1),this.insertionPosition);else{const be=t._clone();_insert(this.insertionPosition,be)}const te=new Range(Position._createAt(t,this.splitPosition.offset),Position._createAt(t,t.maxOffset));_move(te,this.moveTargetPosition)}toJSON(){const t=super.toJSON();return t.splitPosition=this.splitPosition.toJSON(),t.insertionPosition=this.insertionPosition.toJSON(),this.graveyardPosition&&(t.graveyardPosition=this.graveyardPosition.toJSON()),t}static get className(){return"SplitOperation"}static getInsertionPosition(t){const te=t.path.slice(0,-1);return te[te.length-1]++,new Position(t.root,te,"toPrevious")}static fromJSON(t,te){const be=Position.fromJSON(t.splitPosition,te),xe=Position.fromJSON(t.insertionPosition,te),ve=t.graveyardPosition?Position.fromJSON(t.graveyardPosition,te):null;return new this(be,t.howMany,xe,ve,t.baseVersion)}}class MergeOperation extends Operation{constructor(t,te,be,xe,ve){super(ve);Re(this,"sourcePosition");Re(this,"howMany");Re(this,"targetPosition");Re(this,"graveyardPosition");this.sourcePosition=t.clone(),this.sourcePosition.stickiness="toPrevious",this.howMany=te,this.targetPosition=be.clone(),this.targetPosition.stickiness="toNext",this.graveyardPosition=xe.clone()}get type(){return"merge"}get deletionPosition(){return new Position(this.sourcePosition.root,this.sourcePosition.path.slice(0,-1))}get movedRange(){const t=this.sourcePosition.getShiftedBy(Number.POSITIVE_INFINITY);return new Range(this.sourcePosition,t)}get affectedSelectable(){const t=this.sourcePosition.parent;return[Range._createOn(t),Range._createFromPositionAndShift(this.targetPosition,0),Range._createFromPositionAndShift(this.graveyardPosition,0)]}clone(){return new MergeOperation(this.sourcePosition,this.howMany,this.targetPosition,this.graveyardPosition,this.baseVersion)}getReversed(){const t=this.targetPosition._getTransformedByMergeOperation(this),te=this.sourcePosition.path.slice(0,-1),be=new Position(this.sourcePosition.root,te)._getTransformedByMergeOperation(this);return new SplitOperation(t,this.howMany,be,this.graveyardPosition,this.baseVersion+1)}_validate(){const t=this.sourcePosition.parent,te=this.targetPosition.parent;if(t.parent)if(te.parent){if(this.howMany!=t.maxOffset)throw new CKEditorError("merge-operation-how-many-invalid",this)}else throw new CKEditorError("merge-operation-target-position-invalid",this);else throw new CKEditorError("merge-operation-source-position-invalid",this)}_execute(){const t=this.sourcePosition.parent,te=Range._createIn(t);_move(te,this.targetPosition),_move(Range._createOn(t),this.graveyardPosition)}toJSON(){const t=super.toJSON();return t.sourcePosition=t.sourcePosition.toJSON(),t.targetPosition=t.targetPosition.toJSON(),t.graveyardPosition=t.graveyardPosition.toJSON(),t}static get className(){return"MergeOperation"}static fromJSON(t,te){const be=Position.fromJSON(t.sourcePosition,te),xe=Position.fromJSON(t.targetPosition,te),ve=Position.fromJSON(t.graveyardPosition,te);return new this(be,t.howMany,xe,ve,t.baseVersion)}}class MarkerOperation extends Operation{constructor(t,te,be,xe,ve,ke){super(ke);Re(this,"name");Re(this,"oldRange");Re(this,"newRange");Re(this,"affectsData");Re(this,"_markers");this.name=t,this.oldRange=te?te.clone():null,this.newRange=be?be.clone():null,this.affectsData=ve,this._markers=xe}get type(){return"marker"}get affectedSelectable(){const t=[];return this.oldRange&&t.push(this.oldRange.clone()),this.newRange&&(this.oldRange?t.push(...this.newRange.getDifference(this.oldRange)):t.push(this.newRange.clone())),t}clone(){return new MarkerOperation(this.name,this.oldRange,this.newRange,this._markers,this.affectsData,this.baseVersion)}getReversed(){return new MarkerOperation(this.name,this.newRange,this.oldRange,this._markers,this.affectsData,this.baseVersion+1)}_execute(){this.newRange?this._markers._set(this.name,this.newRange,!0,this.affectsData):this._markers._remove(this.name)}toJSON(){const t=super.toJSON();return this.oldRange&&(t.oldRange=this.oldRange.toJSON()),this.newRange&&(t.newRange=this.newRange.toJSON()),delete t._markers,t}static get className(){return"MarkerOperation"}static fromJSON(t,te){return new MarkerOperation(t.name,t.oldRange?Range.fromJSON(t.oldRange,te):null,t.newRange?Range.fromJSON(t.newRange,te):null,te.model.markers,t.affectsData,t.baseVersion)}}class AttributeOperation extends Operation{constructor(t,te,be,xe,ve){super(ve);Re(this,"range");Re(this,"key");Re(this,"oldValue");Re(this,"newValue");this.range=t.clone(),this.key=te,this.oldValue=be===void 0?null:be,this.newValue=xe===void 0?null:xe}get type(){return this.oldValue===null?"addAttribute":this.newValue===null?"removeAttribute":"changeAttribute"}get affectedSelectable(){return this.range.clone()}clone(){return new AttributeOperation(this.range,this.key,this.oldValue,this.newValue,this.baseVersion)}getReversed(){return new AttributeOperation(this.range,this.key,this.newValue,this.oldValue,this.baseVersion+1)}toJSON(){const t=super.toJSON();return t.range=this.range.toJSON(),t}_validate(){if(!this.range.isFlat)throw new CKEditorError("attribute-operation-range-not-flat",this);for(const t of this.range.getItems({shallow:!0})){if(this.oldValue!==null&&!isEqual(t.getAttribute(this.key),this.oldValue))throw new CKEditorError("attribute-operation-wrong-old-value",this,{item:t,key:this.key,value:this.oldValue});if(this.oldValue===null&&this.newValue!==null&&t.hasAttribute(this.key))throw new CKEditorError("attribute-operation-attribute-exists",this,{node:t,key:this.key})}}_execute(){isEqual(this.oldValue,this.newValue)||_setAttribute(this.range,this.key,this.newValue)}static get className(){return"AttributeOperation"}static fromJSON(t,te){return new AttributeOperation(Range.fromJSON(t.range,te),t.key,t.oldValue,t.newValue,t.baseVersion)}}class NoOperation extends Operation{get type(){return"noop"}get affectedSelectable(){return null}clone(){return new NoOperation(this.baseVersion)}getReversed(){return new NoOperation(this.baseVersion+1)}_execute(){}static get className(){return"NoOperation"}}class RenameOperation extends Operation{constructor(t,te,be,xe){super(xe);Re(this,"position");Re(this,"oldName");Re(this,"newName");this.position=t,this.position.stickiness="toNext",this.oldName=te,this.newName=be}get type(){return"rename"}get affectedSelectable(){return this.position.nodeAfter}clone(){return new RenameOperation(this.position.clone(),this.oldName,this.newName,this.baseVersion)}getReversed(){return new RenameOperation(this.position.clone(),this.newName,this.oldName,this.baseVersion+1)}_validate(){const t=this.position.nodeAfter;if(t instanceof Element){if(t.name!==this.oldName)throw new CKEditorError("rename-operation-wrong-name",this)}else throw new CKEditorError("rename-operation-wrong-position",this)}_execute(){const t=this.position.nodeAfter;t.name=this.newName}toJSON(){const t=super.toJSON();return t.position=this.position.toJSON(),t}static get className(){return"RenameOperation"}static fromJSON(t,te){return new RenameOperation(Position.fromJSON(t.position,te),t.oldName,t.newName,t.baseVersion)}}class RootAttributeOperation extends Operation{constructor(t,te,be,xe,ve){super(ve);Re(this,"root");Re(this,"key");Re(this,"oldValue");Re(this,"newValue");this.root=t,this.key=te,this.oldValue=be===void 0?null:be,this.newValue=xe===void 0?null:xe}get type(){return this.oldValue===null?"addRootAttribute":this.newValue===null?"removeRootAttribute":"changeRootAttribute"}get affectedSelectable(){return this.root}clone(){return new RootAttributeOperation(this.root,this.key,this.oldValue,this.newValue,this.baseVersion)}getReversed(){return new RootAttributeOperation(this.root,this.key,this.newValue,this.oldValue,this.baseVersion+1)}_validate(){if(this.root!=this.root.root||this.root.is("documentFragment"))throw new CKEditorError("rootattribute-operation-not-a-root",this,{root:this.root,key:this.key});if(this.oldValue!==null&&this.root.getAttribute(this.key)!==this.oldValue)throw new CKEditorError("rootattribute-operation-wrong-old-value",this,{root:this.root,key:this.key});if(this.oldValue===null&&this.newValue!==null&&this.root.hasAttribute(this.key))throw new CKEditorError("rootattribute-operation-attribute-exists",this,{root:this.root,key:this.key})}_execute(){this.newValue!==null?this.root._setAttribute(this.key,this.newValue):this.root._removeAttribute(this.key)}toJSON(){const t=super.toJSON();return t.root=this.root.toJSON(),t}static get className(){return"RootAttributeOperation"}static fromJSON(t,te){if(!te.getRoot(t.root))throw new CKEditorError("rootattribute-operation-fromjson-no-root",this,{rootName:t.root});return new RootAttributeOperation(te.getRoot(t.root),t.key,t.oldValue,t.newValue,t.baseVersion)}}class RootOperation extends Operation{constructor(t,te,be,xe,ve){super(ve);Re(this,"rootName");Re(this,"elementName");Re(this,"isAdd");Re(this,"_document");if(this.rootName=t,this.elementName=te,this.isAdd=be,this._document=xe,!this._document.getRoot(this.rootName)){const ke=this._document.createRoot(this.elementName,this.rootName);ke._isAttached=!1}}get type(){return this.isAdd?"addRoot":"detachRoot"}get affectedSelectable(){return this._document.getRoot(this.rootName)}clone(){return new RootOperation(this.rootName,this.elementName,this.isAdd,this._document,this.baseVersion)}getReversed(){return new RootOperation(this.rootName,this.elementName,!this.isAdd,this._document,this.baseVersion+1)}_execute(){this._document.getRoot(this.rootName)._isAttached=this.isAdd}toJSON(){const t=super.toJSON();return delete t._document,t}static get className(){return"RootOperation"}static fromJSON(t,te){return new RootOperation(t.rootName,t.elementName,t.isAdd,te,t.baseVersion)}}const operations={};operations[AttributeOperation.className]=AttributeOperation;operations[InsertOperation.className]=InsertOperation;operations[MarkerOperation.className]=MarkerOperation;operations[MoveOperation.className]=MoveOperation;operations[NoOperation.className]=NoOperation;operations[Operation.className]=Operation;operations[RenameOperation.className]=RenameOperation;operations[RootAttributeOperation.className]=RootAttributeOperation;operations[RootOperation.className]=RootOperation;operations[SplitOperation.className]=SplitOperation;operations[MergeOperation.className]=MergeOperation;class OperationFactory{static fromJSON(we,t){return operations[we.__className].fromJSON(we,t)}}const transformations=new Map;function setTransformation(Te,we,t){let te=transformations.get(Te);te||(te=new Map,transformations.set(Te,te)),te.set(we,t)}function getTransformation(Te,we){const t=transformations.get(Te);return t&&t.has(we)?t.get(we):noUpdateTransformation}function noUpdateTransformation(Te){return[Te]}function transform$1(Te,we,t={}){const te=getTransformation(Te.constructor,we.constructor);try{return Te=Te.clone(),te(Te,we,t)}catch(be){throw be}}function transformSets(Te,we,t){Te=Te.slice(),we=we.slice();const te=new ContextFactory(t.document,t.useRelations,t.forceWeakRemove);te.setOriginalOperations(Te),te.setOriginalOperations(we);const be=te.originalOperations;if(Te.length==0||we.length==0)return{operationsA:Te,operationsB:we,originalOperations:be};const xe=new WeakMap;for(const Ie of Te)xe.set(Ie,0);const ve={nextBaseVersionA:Te[Te.length-1].baseVersion+1,nextBaseVersionB:we[we.length-1].baseVersion+1,originalOperationsACount:Te.length,originalOperationsBCount:we.length};let ke=0;for(;ke<Te.length;){const Ie=Te[ke],Ae=xe.get(Ie);if(Ae==we.length){ke++;continue}const Se=we[Ae],Oe=transform$1(Ie,Se,te.getContext(Ie,Se,!0)),Ve=transform$1(Se,Ie,te.getContext(Se,Ie,!1));te.updateRelation(Ie,Se),te.setOriginalOperations(Oe,Ie),te.setOriginalOperations(Ve,Se);for(const Me of Oe)xe.set(Me,Ae+Ve.length);Te.splice(ke,1,...Oe),we.splice(Ae,1,...Ve)}if(t.padWithNoOps){const Ie=Te.length-ve.originalOperationsACount,Ae=we.length-ve.originalOperationsBCount;padWithNoOps(Te,Ae-Ie),padWithNoOps(we,Ie-Ae)}return updateBaseVersions(Te,ve.nextBaseVersionB),updateBaseVersions(we,ve.nextBaseVersionA),{operationsA:Te,operationsB:we,originalOperations:be}}class ContextFactory{constructor(we,t,te=!1){Re(this,"originalOperations");Re(this,"_history");Re(this,"_useRelations");Re(this,"_forceWeakRemove");Re(this,"_relations");this.originalOperations=new Map,this._history=we.history,this._useRelations=t,this._forceWeakRemove=!!te,this._relations=new Map}setOriginalOperations(we,t=null){const te=t?this.originalOperations.get(t):null;for(const be of we)this.originalOperations.set(be,te||be)}updateRelation(we,t){if(we instanceof MoveOperation)t instanceof MergeOperation?we.targetPosition.isEqual(t.sourcePosition)||t.movedRange.containsPosition(we.targetPosition)?this._setRelation(we,t,"insertAtSource"):we.targetPosition.isEqual(t.deletionPosition)?this._setRelation(we,t,"insertBetween"):we.targetPosition.isAfter(t.sourcePosition)&&this._setRelation(we,t,"moveTargetAfter"):t instanceof MoveOperation&&(we.targetPosition.isEqual(t.sourcePosition)||we.targetPosition.isBefore(t.sourcePosition)?this._setRelation(we,t,"insertBefore"):this._setRelation(we,t,"insertAfter"));else if(we instanceof SplitOperation){if(t instanceof MergeOperation)we.splitPosition.isBefore(t.sourcePosition)&&this._setRelation(we,t,"splitBefore");else if(t instanceof MoveOperation)if(we.splitPosition.isEqual(t.sourcePosition)||we.splitPosition.isBefore(t.sourcePosition))this._setRelation(we,t,"splitBefore");else{const te=Range._createFromPositionAndShift(t.sourcePosition,t.howMany);if(we.splitPosition.hasSameParentAs(t.sourcePosition)&&te.containsPosition(we.splitPosition)){const be=te.end.offset-we.splitPosition.offset,xe=we.splitPosition.offset-te.start.offset;this._setRelation(we,t,{howMany:be,offset:xe})}}}else if(we instanceof MergeOperation)t instanceof MergeOperation?(we.targetPosition.isEqual(t.sourcePosition)||this._setRelation(we,t,"mergeTargetNotMoved"),we.sourcePosition.isEqual(t.targetPosition)&&this._setRelation(we,t,"mergeSourceNotMoved"),we.sourcePosition.isEqual(t.sourcePosition)&&this._setRelation(we,t,"mergeSameElement")):t instanceof SplitOperation?we.sourcePosition.isEqual(t.splitPosition)&&this._setRelation(we,t,"splitAtSource"):t instanceof MoveOperation&&t.howMany>0&&(we.sourcePosition.isEqual(t.sourcePosition.getShiftedBy(t.howMany))&&this._setRelation(we,t,"mergeSourceAffected"),we.targetPosition.isEqual(t.sourcePosition)&&this._setRelation(we,t,"mergeTargetWasBefore"));else if(we instanceof MarkerOperation){const te=we.newRange;if(!te)return;if(t instanceof MoveOperation){const be=Range._createFromPositionAndShift(t.sourcePosition,t.howMany),xe=be.containsPosition(te.start)||be.start.isEqual(te.start),ve=be.containsPosition(te.end)||be.end.isEqual(te.end);(xe||ve)&&!be.containsRange(te)&&this._setRelation(we,t,{side:xe?"left":"right",path:xe?te.start.path.slice():te.end.path.slice()})}else if(t instanceof MergeOperation){const be=te.start.isEqual(t.targetPosition),xe=te.start.isEqual(t.deletionPosition),ve=te.end.isEqual(t.deletionPosition),ke=te.end.isEqual(t.sourcePosition);(be||xe||ve||ke)&&this._setRelation(we,t,{wasInLeftElement:be,wasStartBeforeMergedElement:xe,wasEndBeforeMergedElement:ve,wasInRightElement:ke})}}}getContext(we,t,te){return{aIsStrong:te,aWasUndone:this._wasUndone(we),bWasUndone:this._wasUndone(t),abRelation:this._useRelations?this._getRelation(we,t):null,baRelation:this._useRelations?this._getRelation(t,we):null,forceWeakRemove:this._forceWeakRemove}}_wasUndone(we){const t=this.originalOperations.get(we);return t.wasUndone||this._history.isUndoneOperation(t)}_getRelation(we,t){const te=this.originalOperations.get(t),be=this._history.getUndoneOperation(te);if(!be)return null;const xe=this.originalOperations.get(we),ve=this._relations.get(xe);return ve&&ve.get(be)||null}_setRelation(we,t,te){const be=this.originalOperations.get(we),xe=this.originalOperations.get(t);let ve=this._relations.get(be);ve||(ve=new Map,this._relations.set(be,ve)),ve.set(xe,te)}}function updateBaseVersions(Te,we){for(const t of Te)t.baseVersion=we++}function padWithNoOps(Te,we){for(let t=0;t<we;t++)Te.push(new NoOperation(0))}setTransformation(AttributeOperation,AttributeOperation,(Te,we,t)=>{if(Te.key===we.key&&Te.range.start.hasSameParentAs(we.range.start)){const te=Te.range.getDifference(we.range).map(xe=>new AttributeOperation(xe,Te.key,Te.oldValue,Te.newValue,0)),be=Te.range.getIntersection(we.range);return be&&t.aIsStrong&&te.push(new AttributeOperation(be,we.key,we.newValue,Te.newValue,0)),te.length==0?[new NoOperation(0)]:te}else return[Te]});setTransformation(AttributeOperation,InsertOperation,(Te,we)=>{if(Te.range.start.hasSameParentAs(we.position)&&Te.range.containsPosition(we.position)){const te=Te.range._getTransformedByInsertion(we.position,we.howMany,!we.shouldReceiveAttributes).map(be=>new AttributeOperation(be,Te.key,Te.oldValue,Te.newValue,Te.baseVersion));if(we.shouldReceiveAttributes){const be=_getComplementaryAttributeOperations(we,Te.key,Te.oldValue);be&&te.unshift(be)}return te}return Te.range=Te.range._getTransformedByInsertion(we.position,we.howMany,!1)[0],[Te]});function _getComplementaryAttributeOperations(Te,we,t){const be=Te.nodes.getNode(0).getAttribute(we);if(be==t)return null;const xe=new Range(Te.position,Te.position.getShiftedBy(Te.howMany));return new AttributeOperation(xe,we,be,t,0)}setTransformation(AttributeOperation,MergeOperation,(Te,we)=>{const t=[];Te.range.start.hasSameParentAs(we.deletionPosition)&&(Te.range.containsPosition(we.deletionPosition)||Te.range.start.isEqual(we.deletionPosition))&&t.push(Range._createFromPositionAndShift(we.graveyardPosition,1));const te=Te.range._getTransformedByMergeOperation(we);return te.isCollapsed||t.push(te),t.map(be=>new AttributeOperation(be,Te.key,Te.oldValue,Te.newValue,Te.baseVersion))});setTransformation(AttributeOperation,MoveOperation,(Te,we)=>_breakRangeByMoveOperation(Te.range,we).map(te=>new AttributeOperation(te,Te.key,Te.oldValue,Te.newValue,Te.baseVersion)));function _breakRangeByMoveOperation(Te,we){const t=Range._createFromPositionAndShift(we.sourcePosition,we.howMany);let te=null,be=[];t.containsRange(Te,!0)?te=Te:Te.start.hasSameParentAs(t.start)?(be=Te.getDifference(t),te=Te.getIntersection(t)):be=[Te];const xe=[];for(let ve of be){ve=ve._getTransformedByDeletion(we.sourcePosition,we.howMany);const ke=we.getMovedRangeStart(),Ie=ve.start.hasSameParentAs(ke),Ae=ve._getTransformedByInsertion(ke,we.howMany,Ie);xe.push(...Ae)}return te&&xe.push(te._getTransformedByMove(we.sourcePosition,we.targetPosition,we.howMany,!1)[0]),xe}setTransformation(AttributeOperation,SplitOperation,(Te,we)=>{if(Te.range.end.isEqual(we.insertionPosition))return we.graveyardPosition||Te.range.end.offset++,[Te];if(Te.range.start.hasSameParentAs(we.splitPosition)&&Te.range.containsPosition(we.splitPosition)){const t=Te.clone();return t.range=new Range(we.moveTargetPosition.clone(),Te.range.end._getCombined(we.splitPosition,we.moveTargetPosition)),Te.range.end=we.splitPosition.clone(),Te.range.end.stickiness="toPrevious",[Te,t]}return Te.range=Te.range._getTransformedBySplitOperation(we),[Te]});setTransformation(InsertOperation,AttributeOperation,(Te,we)=>{const t=[Te];if(Te.shouldReceiveAttributes&&Te.position.hasSameParentAs(we.range.start)&&we.range.containsPosition(Te.position)){const te=_getComplementaryAttributeOperations(Te,we.key,we.newValue);te&&t.push(te)}return t});setTransformation(InsertOperation,InsertOperation,(Te,we,t)=>Te.position.isEqual(we.position)&&t.aIsStrong?[Te]:(Te.position=Te.position._getTransformedByInsertOperation(we),[Te]));setTransformation(InsertOperation,MoveOperation,(Te,we)=>(Te.position=Te.position._getTransformedByMoveOperation(we),[Te]));setTransformation(InsertOperation,SplitOperation,(Te,we)=>(Te.position=Te.position._getTransformedBySplitOperation(we),[Te]));setTransformation(InsertOperation,MergeOperation,(Te,we)=>(Te.position=Te.position._getTransformedByMergeOperation(we),[Te]));setTransformation(MarkerOperation,InsertOperation,(Te,we)=>(Te.oldRange&&(Te.oldRange=Te.oldRange._getTransformedByInsertOperation(we)[0]),Te.newRange&&(Te.newRange=Te.newRange._getTransformedByInsertOperation(we)[0]),[Te]));setTransformation(MarkerOperation,MarkerOperation,(Te,we,t)=>{if(Te.name==we.name)if(t.aIsStrong)Te.oldRange=we.newRange?we.newRange.clone():null;else return[new NoOperation(0)];return[Te]});setTransformation(MarkerOperation,MergeOperation,(Te,we)=>(Te.oldRange&&(Te.oldRange=Te.oldRange._getTransformedByMergeOperation(we)),Te.newRange&&(Te.newRange=Te.newRange._getTransformedByMergeOperation(we)),[Te]));setTransformation(MarkerOperation,MoveOperation,(Te,we,t)=>{if(Te.oldRange&&(Te.oldRange=Range._createFromRanges(Te.oldRange._getTransformedByMoveOperation(we))),Te.newRange){if(t.abRelation){const te=Range._createFromRanges(Te.newRange._getTransformedByMoveOperation(we));if(t.abRelation.side=="left"&&we.targetPosition.isEqual(Te.newRange.start))return Te.newRange.end=te.end,Te.newRange.start.path=t.abRelation.path,[Te];if(t.abRelation.side=="right"&&we.targetPosition.isEqual(Te.newRange.end))return Te.newRange.start=te.start,Te.newRange.end.path=t.abRelation.path,[Te]}Te.newRange=Range._createFromRanges(Te.newRange._getTransformedByMoveOperation(we))}return[Te]});setTransformation(MarkerOperation,SplitOperation,(Te,we,t)=>{if(Te.oldRange&&(Te.oldRange=Te.oldRange._getTransformedBySplitOperation(we)),Te.newRange){if(t.abRelation){const te=Te.newRange._getTransformedBySplitOperation(we);return Te.newRange.start.isEqual(we.splitPosition)&&t.abRelation.wasStartBeforeMergedElement?Te.newRange.start=Position._createAt(we.insertionPosition):Te.newRange.start.isEqual(we.splitPosition)&&!t.abRelation.wasInLeftElement&&(Te.newRange.start=Position._createAt(we.moveTargetPosition)),Te.newRange.end.isEqual(we.splitPosition)&&t.abRelation.wasInRightElement?Te.newRange.end=Position._createAt(we.moveTargetPosition):Te.newRange.end.isEqual(we.splitPosition)&&t.abRelation.wasEndBeforeMergedElement?Te.newRange.end=Position._createAt(we.insertionPosition):Te.newRange.end=te.end,[Te]}Te.newRange=Te.newRange._getTransformedBySplitOperation(we)}return[Te]});setTransformation(MergeOperation,InsertOperation,(Te,we)=>(Te.sourcePosition.hasSameParentAs(we.position)&&(Te.howMany+=we.howMany),Te.sourcePosition=Te.sourcePosition._getTransformedByInsertOperation(we),Te.targetPosition=Te.targetPosition._getTransformedByInsertOperation(we),[Te]));setTransformation(MergeOperation,MergeOperation,(Te,we,t)=>{if(Te.sourcePosition.isEqual(we.sourcePosition)&&Te.targetPosition.isEqual(we.targetPosition))if(t.bWasUndone){const te=we.graveyardPosition.path.slice();return te.push(0),Te.sourcePosition=new Position(we.graveyardPosition.root,te),Te.howMany=0,[Te]}else return[new NoOperation(0)];if(Te.sourcePosition.isEqual(we.sourcePosition)&&!Te.targetPosition.isEqual(we.targetPosition)&&!t.bWasUndone&&t.abRelation!="splitAtSource"){const te=Te.targetPosition.root.rootName=="$graveyard",be=we.targetPosition.root.rootName=="$graveyard";if(be&&!te||!(te&&!be)&&t.aIsStrong){const Ie=we.targetPosition._getTransformedByMergeOperation(we),Ae=Te.targetPosition._getTransformedByMergeOperation(we);return[new MoveOperation(Ie,Te.howMany,Ae,0)]}else return[new NoOperation(0)]}return Te.sourcePosition.hasSameParentAs(we.targetPosition)&&(Te.howMany+=we.howMany),Te.sourcePosition=Te.sourcePosition._getTransformedByMergeOperation(we),Te.targetPosition=Te.targetPosition._getTransformedByMergeOperation(we),(!Te.graveyardPosition.isEqual(we.graveyardPosition)||!t.aIsStrong)&&(Te.graveyardPosition=Te.graveyardPosition._getTransformedByMergeOperation(we)),[Te]});setTransformation(MergeOperation,MoveOperation,(Te,we,t)=>{const te=Range._createFromPositionAndShift(we.sourcePosition,we.howMany);return we.type=="remove"&&!t.bWasUndone&&!t.forceWeakRemove&&Te.deletionPosition.hasSameParentAs(we.sourcePosition)&&te.containsPosition(Te.sourcePosition)?[new NoOperation(0)]:(we.sourcePosition.getShiftedBy(we.howMany).isEqual(Te.sourcePosition)?Te.sourcePosition.stickiness="toNone":we.targetPosition.isEqual(Te.sourcePosition)&&t.abRelation=="mergeSourceAffected"?Te.sourcePosition.stickiness="toNext":we.sourcePosition.isEqual(Te.targetPosition)?(Te.targetPosition.stickiness="toNone",Te.howMany-=we.howMany):we.targetPosition.isEqual(Te.targetPosition)&&t.abRelation=="mergeTargetWasBefore"?(Te.targetPosition.stickiness="toPrevious",Te.howMany+=we.howMany):(Te.sourcePosition.hasSameParentAs(we.targetPosition)&&(Te.howMany+=we.howMany),Te.sourcePosition.hasSameParentAs(we.sourcePosition)&&(Te.howMany-=we.howMany)),Te.sourcePosition=Te.sourcePosition._getTransformedByMoveOperation(we),Te.targetPosition=Te.targetPosition._getTransformedByMoveOperation(we),Te.sourcePosition.stickiness="toPrevious",Te.targetPosition.stickiness="toNext",Te.graveyardPosition.isEqual(we.targetPosition)||(Te.graveyardPosition=Te.graveyardPosition._getTransformedByMoveOperation(we)),[Te])});setTransformation(MergeOperation,SplitOperation,(Te,we,t)=>{if(we.graveyardPosition&&(Te.graveyardPosition=Te.graveyardPosition._getTransformedByDeletion(we.graveyardPosition,1),Te.deletionPosition.isEqual(we.graveyardPosition)&&(Te.howMany=we.howMany)),Te.targetPosition.isEqual(we.splitPosition)){const te=we.howMany!=0,be=we.graveyardPosition&&Te.deletionPosition.isEqual(we.graveyardPosition);if(te||be||t.abRelation=="mergeTargetNotMoved")return Te.sourcePosition=Te.sourcePosition._getTransformedBySplitOperation(we),[Te]}if(Te.sourcePosition.isEqual(we.splitPosition)){if(t.abRelation=="mergeSourceNotMoved")return Te.howMany=0,Te.targetPosition=Te.targetPosition._getTransformedBySplitOperation(we),[Te];if(t.abRelation=="mergeSameElement"||Te.sourcePosition.offset>0)return Te.sourcePosition=we.moveTargetPosition.clone(),Te.targetPosition=Te.targetPosition._getTransformedBySplitOperation(we),[Te]}return Te.sourcePosition.hasSameParentAs(we.splitPosition)&&(Te.howMany=we.splitPosition.offset),Te.sourcePosition=Te.sourcePosition._getTransformedBySplitOperation(we),Te.targetPosition=Te.targetPosition._getTransformedBySplitOperation(we),[Te]});setTransformation(MoveOperation,InsertOperation,(Te,we)=>{const te=Range._createFromPositionAndShift(Te.sourcePosition,Te.howMany)._getTransformedByInsertOperation(we,!1)[0];return Te.sourcePosition=te.start,Te.howMany=te.end.offset-te.start.offset,Te.targetPosition.isEqual(we.position)||(Te.targetPosition=Te.targetPosition._getTransformedByInsertOperation(we)),[Te]});setTransformation(MoveOperation,MoveOperation,(Te,we,t)=>{const te=Range._createFromPositionAndShift(Te.sourcePosition,Te.howMany),be=Range._createFromPositionAndShift(we.sourcePosition,we.howMany);let xe=t.aIsStrong,ve=!t.aIsStrong;t.abRelation=="insertBefore"||t.baRelation=="insertAfter"?ve=!0:(t.abRelation=="insertAfter"||t.baRelation=="insertBefore")&&(ve=!1);let ke;if(Te.targetPosition.isEqual(we.targetPosition)&&ve?ke=Te.targetPosition._getTransformedByDeletion(we.sourcePosition,we.howMany):ke=Te.targetPosition._getTransformedByMove(we.sourcePosition,we.targetPosition,we.howMany),_moveTargetIntoMovedRange(Te,we)&&_moveTargetIntoMovedRange(we,Te))return[we.getReversed()];if(te.containsPosition(we.targetPosition)&&te.containsRange(be,!0))return te.start=te.start._getTransformedByMove(we.sourcePosition,we.targetPosition,we.howMany),te.end=te.end._getTransformedByMove(we.sourcePosition,we.targetPosition,we.howMany),_makeMoveOperationsFromRanges([te],ke);if(be.containsPosition(Te.targetPosition)&&be.containsRange(te,!0))return te.start=te.start._getCombined(we.sourcePosition,we.getMovedRangeStart()),te.end=te.end._getCombined(we.sourcePosition,we.getMovedRangeStart()),_makeMoveOperationsFromRanges([te],ke);const Se=compareArrays(Te.sourcePosition.getParentPath(),we.sourcePosition.getParentPath());if(Se=="prefix"||Se=="extension")return te.start=te.start._getTransformedByMove(we.sourcePosition,we.targetPosition,we.howMany),te.end=te.end._getTransformedByMove(we.sourcePosition,we.targetPosition,we.howMany),_makeMoveOperationsFromRanges([te],ke);Te.type=="remove"&&we.type!="remove"&&!t.aWasUndone&&!t.forceWeakRemove?xe=!0:Te.type!="remove"&&we.type=="remove"&&!t.bWasUndone&&!t.forceWeakRemove&&(xe=!1);const Oe=[],Ve=te.getDifference(be);for(const De of Ve){De.start=De.start._getTransformedByDeletion(we.sourcePosition,we.howMany),De.end=De.end._getTransformedByDeletion(we.sourcePosition,we.howMany);const Fe=compareArrays(De.start.getParentPath(),we.getMovedRangeStart().getParentPath())=="same",Be=De._getTransformedByInsertion(we.getMovedRangeStart(),we.howMany,Fe);Oe.push(...Be)}const Me=te.getIntersection(be);return Me!==null&&xe&&(Me.start=Me.start._getCombined(we.sourcePosition,we.getMovedRangeStart()),Me.end=Me.end._getCombined(we.sourcePosition,we.getMovedRangeStart()),Oe.length===0?Oe.push(Me):Oe.length==1?be.start.isBefore(te.start)||be.start.isEqual(te.start)?Oe.unshift(Me):Oe.push(Me):Oe.splice(1,0,Me)),Oe.length===0?[new NoOperation(Te.baseVersion)]:_makeMoveOperationsFromRanges(Oe,ke)});setTransformation(MoveOperation,SplitOperation,(Te,we,t)=>{let te=Te.targetPosition.clone();(!Te.targetPosition.isEqual(we.insertionPosition)||!we.graveyardPosition||t.abRelation=="moveTargetAfter")&&(te=Te.targetPosition._getTransformedBySplitOperation(we));const be=Range._createFromPositionAndShift(Te.sourcePosition,Te.howMany);if(be.end.isEqual(we.insertionPosition))return we.graveyardPosition||Te.howMany++,Te.targetPosition=te,[Te];if(be.start.hasSameParentAs(we.splitPosition)&&be.containsPosition(we.splitPosition)){let ke=new Range(we.splitPosition,be.end);ke=ke._getTransformedBySplitOperation(we);const Ie=[new Range(be.start,we.splitPosition),ke];return _makeMoveOperationsFromRanges(Ie,te)}Te.targetPosition.isEqual(we.splitPosition)&&t.abRelation=="insertAtSource"&&(te=we.moveTargetPosition),Te.targetPosition.isEqual(we.insertionPosition)&&t.abRelation=="insertBetween"&&(te=Te.targetPosition);const ve=[be._getTransformedBySplitOperation(we)];if(we.graveyardPosition){const ke=be.start.isEqual(we.graveyardPosition)||be.containsPosition(we.graveyardPosition);Te.howMany>1&&ke&&!t.aWasUndone&&ve.push(Range._createFromPositionAndShift(we.insertionPosition,1))}return _makeMoveOperationsFromRanges(ve,te)});setTransformation(MoveOperation,MergeOperation,(Te,we,t)=>{const te=Range._createFromPositionAndShift(Te.sourcePosition,Te.howMany);if(we.deletionPosition.hasSameParentAs(Te.sourcePosition)&&te.containsPosition(we.sourcePosition)){if(Te.type=="remove"&&!t.forceWeakRemove){if(!t.aWasUndone){const ve=[];let ke=we.graveyardPosition.clone(),Ie=we.targetPosition._getTransformedByMergeOperation(we);Te.howMany>1&&(ve.push(new MoveOperation(Te.sourcePosition,Te.howMany-1,Te.targetPosition,0)),ke=ke._getTransformedByMove(Te.sourcePosition,Te.targetPosition,Te.howMany-1),Ie=Ie._getTransformedByMove(Te.sourcePosition,Te.targetPosition,Te.howMany-1));const Ae=we.deletionPosition._getCombined(Te.sourcePosition,Te.targetPosition),Se=new MoveOperation(ke,1,Ae,0),Oe=Se.getMovedRangeStart().path.slice();Oe.push(0);const Ve=new Position(Se.targetPosition.root,Oe);Ie=Ie._getTransformedByMove(ke,Ae,1);const Me=new MoveOperation(Ie,we.howMany,Ve,0);return ve.push(Se),ve.push(Me),ve}}else if(Te.howMany==1)return t.bWasUndone?(Te.sourcePosition=we.graveyardPosition.clone(),Te.targetPosition=Te.targetPosition._getTransformedByMergeOperation(we),[Te]):[new NoOperation(0)]}const xe=Range._createFromPositionAndShift(Te.sourcePosition,Te.howMany)._getTransformedByMergeOperation(we);return Te.sourcePosition=xe.start,Te.howMany=xe.end.offset-xe.start.offset,Te.targetPosition=Te.targetPosition._getTransformedByMergeOperation(we),[Te]});setTransformation(RenameOperation,InsertOperation,(Te,we)=>(Te.position=Te.position._getTransformedByInsertOperation(we),[Te]));setTransformation(RenameOperation,MergeOperation,(Te,we)=>Te.position.isEqual(we.deletionPosition)?(Te.position=we.graveyardPosition.clone(),Te.position.stickiness="toNext",[Te]):(Te.position=Te.position._getTransformedByMergeOperation(we),[Te]));setTransformation(RenameOperation,MoveOperation,(Te,we)=>(Te.position=Te.position._getTransformedByMoveOperation(we),[Te]));setTransformation(RenameOperation,RenameOperation,(Te,we,t)=>{if(Te.position.isEqual(we.position))if(t.aIsStrong)Te.oldName=we.newName;else return[new NoOperation(0)];return[Te]});setTransformation(RenameOperation,SplitOperation,(Te,we)=>{const t=Te.position.path,te=we.splitPosition.getParentPath();if(compareArrays(t,te)=="same"&&!we.graveyardPosition){const be=new RenameOperation(Te.position.getShiftedBy(1),Te.oldName,Te.newName,0);return[Te,be]}return Te.position=Te.position._getTransformedBySplitOperation(we),[Te]});setTransformation(RootAttributeOperation,RootAttributeOperation,(Te,we,t)=>{if(Te.root===we.root&&Te.key===we.key){if(!t.aIsStrong||Te.newValue===we.newValue)return[new NoOperation(0)];Te.oldValue=we.newValue}return[Te]});setTransformation(RootOperation,RootOperation,(Te,we)=>Te.rootName===we.rootName&&Te.isAdd===we.isAdd?[new NoOperation(0)]:[Te]);setTransformation(SplitOperation,InsertOperation,(Te,we)=>(Te.splitPosition.hasSameParentAs(we.position)&&Te.splitPosition.offset<we.position.offset&&(Te.howMany+=we.howMany),Te.splitPosition=Te.splitPosition._getTransformedByInsertOperation(we),Te.insertionPosition=Te.insertionPosition._getTransformedByInsertOperation(we),[Te]));setTransformation(SplitOperation,MergeOperation,(Te,we,t)=>{if(!Te.graveyardPosition&&!t.bWasUndone&&Te.splitPosition.hasSameParentAs(we.sourcePosition)){const te=we.graveyardPosition.path.slice();te.push(0);const be=new Position(we.graveyardPosition.root,te),xe=SplitOperation.getInsertionPosition(new Position(we.graveyardPosition.root,te)),ve=new SplitOperation(be,0,xe,null,0);return Te.splitPosition=Te.splitPosition._getTransformedByMergeOperation(we),Te.insertionPosition=SplitOperation.getInsertionPosition(Te.splitPosition),Te.graveyardPosition=ve.insertionPosition.clone(),Te.graveyardPosition.stickiness="toNext",[ve,Te]}return Te.splitPosition.hasSameParentAs(we.deletionPosition)&&!Te.splitPosition.isAfter(we.deletionPosition)&&Te.howMany--,Te.splitPosition.hasSameParentAs(we.targetPosition)&&(Te.howMany+=we.howMany),Te.splitPosition=Te.splitPosition._getTransformedByMergeOperation(we),Te.insertionPosition=SplitOperation.getInsertionPosition(Te.splitPosition),Te.graveyardPosition&&(Te.graveyardPosition=Te.graveyardPosition._getTransformedByMergeOperation(we)),[Te]});setTransformation(SplitOperation,MoveOperation,(Te,we,t)=>{const te=Range._createFromPositionAndShift(we.sourcePosition,we.howMany);if(Te.graveyardPosition){const xe=te.start.isEqual(Te.graveyardPosition)||te.containsPosition(Te.graveyardPosition);if(!t.bWasUndone&&xe){const ve=Te.splitPosition._getTransformedByMoveOperation(we),ke=Te.graveyardPosition._getTransformedByMoveOperation(we),Ie=ke.path.slice();Ie.push(0);const Ae=new Position(ke.root,Ie);return[new MoveOperation(ve,Te.howMany,Ae,0)]}Te.graveyardPosition=Te.graveyardPosition._getTransformedByMoveOperation(we)}const be=Te.splitPosition.isEqual(we.targetPosition);if(be&&(t.baRelation=="insertAtSource"||t.abRelation=="splitBefore"))return Te.howMany+=we.howMany,Te.splitPosition=Te.splitPosition._getTransformedByDeletion(we.sourcePosition,we.howMany),Te.insertionPosition=SplitOperation.getInsertionPosition(Te.splitPosition),[Te];if(be&&t.abRelation&&t.abRelation.howMany){const{howMany:xe,offset:ve}=t.abRelation;return Te.howMany+=xe,Te.splitPosition=Te.splitPosition.getShiftedBy(ve),[Te]}if(Te.splitPosition.hasSameParentAs(we.sourcePosition)&&te.containsPosition(Te.splitPosition)){const xe=we.howMany-(Te.splitPosition.offset-we.sourcePosition.offset);return Te.howMany-=xe,Te.splitPosition.hasSameParentAs(we.targetPosition)&&Te.splitPosition.offset<we.targetPosition.offset&&(Te.howMany+=we.howMany),Te.splitPosition=we.sourcePosition.clone(),Te.insertionPosition=SplitOperation.getInsertionPosition(Te.splitPosition),[Te]}return we.sourcePosition.isEqual(we.targetPosition)||(Te.splitPosition.hasSameParentAs(we.sourcePosition)&&Te.splitPosition.offset<=we.sourcePosition.offset&&(Te.howMany-=we.howMany),Te.splitPosition.hasSameParentAs(we.targetPosition)&&Te.splitPosition.offset<we.targetPosition.offset&&(Te.howMany+=we.howMany)),Te.splitPosition.stickiness="toNone",Te.splitPosition=Te.splitPosition._getTransformedByMoveOperation(we),Te.splitPosition.stickiness="toNext",Te.graveyardPosition?Te.insertionPosition=Te.insertionPosition._getTransformedByMoveOperation(we):Te.insertionPosition=SplitOperation.getInsertionPosition(Te.splitPosition),[Te]});setTransformation(SplitOperation,SplitOperation,(Te,we,t)=>{if(Te.splitPosition.isEqual(we.splitPosition)){if(!Te.graveyardPosition&&!we.graveyardPosition)return[new NoOperation(0)];if(Te.graveyardPosition&&we.graveyardPosition&&Te.graveyardPosition.isEqual(we.graveyardPosition))return[new NoOperation(0)];if(t.abRelation=="splitBefore")return Te.howMany=0,Te.graveyardPosition=Te.graveyardPosition._getTransformedBySplitOperation(we),[Te]}if(Te.graveyardPosition&&we.graveyardPosition&&Te.graveyardPosition.isEqual(we.graveyardPosition)){const te=Te.splitPosition.root.rootName=="$graveyard",be=we.splitPosition.root.rootName=="$graveyard";if(be&&!te||!(te&&!be)&&t.aIsStrong){const Ie=[];return we.howMany&&Ie.push(new MoveOperation(we.moveTargetPosition,we.howMany,we.splitPosition,0)),Te.howMany&&Ie.push(new MoveOperation(Te.splitPosition,Te.howMany,Te.moveTargetPosition,0)),Ie}else return[new NoOperation(0)]}if(Te.graveyardPosition&&(Te.graveyardPosition=Te.graveyardPosition._getTransformedBySplitOperation(we)),Te.splitPosition.isEqual(we.insertionPosition)&&t.abRelation=="splitBefore")return Te.howMany++,[Te];if(we.splitPosition.isEqual(Te.insertionPosition)&&t.baRelation=="splitBefore"){const te=we.insertionPosition.path.slice();te.push(0);const be=new Position(we.insertionPosition.root,te),xe=new MoveOperation(Te.insertionPosition,1,be,0);return[Te,xe]}return Te.splitPosition.hasSameParentAs(we.splitPosition)&&Te.splitPosition.offset<we.splitPosition.offset&&(Te.howMany-=we.howMany),Te.splitPosition=Te.splitPosition._getTransformedBySplitOperation(we),Te.insertionPosition=SplitOperation.getInsertionPosition(Te.splitPosition),[Te]});function _moveTargetIntoMovedRange(Te,we){return Te.targetPosition._getTransformedByDeletion(we.sourcePosition,we.howMany)===null}function _makeMoveOperationsFromRanges(Te,we){const t=[];for(let te=0;te<Te.length;te++){const be=Te[te],xe=new MoveOperation(be.start,be.end.offset-be.start.offset,we,0);t.push(xe);for(let ve=te+1;ve<Te.length;ve++)Te[ve]=Te[ve]._getTransformedByMove(xe.sourcePosition,xe.targetPosition,xe.howMany)[0];we=we._getTransformedByMove(xe.sourcePosition,xe.targetPosition,xe.howMany)}return t}class LivePosition extends EmitterMixin(Position){constructor(we,t,te="toNone"){if(super(we,t,te),!this.root.is("rootElement"))throw new CKEditorError("model-liveposition-root-not-rootelement",we);bindWithDocument.call(this)}detach(){this.stopListening()}toPosition(){return new Position(this.root,this.path.slice(),this.stickiness)}static fromPosition(we,t){return new this(we.root,we.path.slice(),t||we.stickiness)}}LivePosition.prototype.is=function(Te){return Te==="livePosition"||Te==="model:livePosition"||Te=="position"||Te==="model:position"};function bindWithDocument(){this.listenTo(this.root.document.model,"applyOperation",(Te,we)=>{const t=we[0];t.isDocumentOperation&&transform.call(this,t)},{priority:"low"})}function transform(Te){const we=this.getTransformedByOperation(Te);if(!this.isEqual(we)){const t=this.toPosition();this.path=we.path,this.root=we.root,this.fire("change",t)}}class Batch{constructor(we={}){Re(this,"operations");Re(this,"isUndoable");Re(this,"isLocal");Re(this,"isUndo");Re(this,"isTyping");typeof we=="string"&&(we=we==="transparent"?{isUndoable:!1}:{},logWarning("batch-constructor-deprecated-string-type"));const{isUndoable:t=!0,isLocal:te=!0,isUndo:be=!1,isTyping:xe=!1}=we;this.operations=[],this.isUndoable=t,this.isLocal=te,this.isUndo=be,this.isTyping=xe}get type(){return logWarning("batch-type-deprecated"),"default"}get baseVersion(){for(const we of this.operations)if(we.baseVersion!==null)return we.baseVersion;return null}addOperation(we){return we.batch=this,this.operations.push(we),we}}const Ui=class Ui{constructor(we){Re(this,"_markerCollection");Re(this,"_changesInElement",new Map);Re(this,"_elementsSnapshots",new Map);Re(this,"_elementChildrenSnapshots",new Map);Re(this,"_elementState",new Map);Re(this,"_changedMarkers",new Map);Re(this,"_changedRoots",new Map);Re(this,"_changeCount",0);Re(this,"_cachedChanges",null);Re(this,"_cachedChangesWithGraveyard",null);Re(this,"_refreshedItems",new Set);this._markerCollection=we}get isEmpty(){return this._changesInElement.size==0&&this._changedMarkers.size==0&&this._changedRoots.size==0}bufferOperation(we){const t=we;switch(t.type){case"insert":{if(this._isInInsertedElement(t.position.parent))return;this._markInsert(t.position.parent,t.position.offset,t.nodes.maxOffset);break}case"addAttribute":case"removeAttribute":case"changeAttribute":{for(const te of t.range.getItems({shallow:!0}))this._isInInsertedElement(te.parent)||this._markAttribute(te);break}case"remove":case"move":case"reinsert":{if(t.sourcePosition.isEqual(t.targetPosition)||t.sourcePosition.getShiftedBy(t.howMany).isEqual(t.targetPosition))return;const te=this._isInInsertedElement(t.sourcePosition.parent),be=this._isInInsertedElement(t.targetPosition.parent);te||this._markRemove(t.sourcePosition.parent,t.sourcePosition.offset,t.howMany),be||this._markInsert(t.targetPosition.parent,t.getMovedRangeStart().offset,t.howMany);const xe=Range._createFromPositionAndShift(t.sourcePosition,t.howMany);for(const ve of xe.getItems({shallow:!0}))this._setElementState(ve,"move");break}case"rename":{if(this._isInInsertedElement(t.position.parent))return;this._markRemove(t.position.parent,t.position.offset,1),this._markInsert(t.position.parent,t.position.offset,1);const te=Range._createFromPositionAndShift(t.position,1);for(const be of this._markerCollection.getMarkersIntersectingRange(te)){const xe=be.getData();this.bufferMarkerChange(be.name,xe,xe)}this._setElementState(t.position.nodeAfter,"rename");break}case"split":{const te=t.splitPosition.parent;if(!this._isInInsertedElement(te)){this._markRemove(te,t.splitPosition.offset,t.howMany);const be=Range._createFromPositionAndShift(t.splitPosition,t.howMany);for(const xe of be.getItems({shallow:!0}))this._setElementState(xe,"move")}this._isInInsertedElement(t.insertionPosition.parent)||this._markInsert(t.insertionPosition.parent,t.insertionPosition.offset,1),t.graveyardPosition&&(this._markRemove(t.graveyardPosition.parent,t.graveyardPosition.offset,1),this._setElementState(t.graveyardPosition.nodeAfter,"move"));break}case"merge":{const te=t.sourcePosition.parent;this._isInInsertedElement(te.parent)||this._markRemove(te.parent,te.startOffset,1);const be=t.graveyardPosition.parent;this._markInsert(be,t.graveyardPosition.offset,1),this._setElementState(te,"move");const xe=t.targetPosition.parent;if(!this._isInInsertedElement(xe)){this._markInsert(xe,t.targetPosition.offset,te.maxOffset);const ve=Range._createFromPositionAndShift(t.sourcePosition,t.howMany);for(const ke of ve.getItems({shallow:!0}))this._setElementState(ke,"move")}break}case"detachRoot":case"addRoot":{const te=t.affectedSelectable;if(!te._isLoaded||te.isAttached()==t.isAdd)return;this._bufferRootStateChange(t.rootName,t.isAdd);break}case"addRootAttribute":case"removeRootAttribute":case"changeRootAttribute":{if(!t.root._isLoaded)return;const te=t.root.rootName;this._bufferRootAttributeChange(te,t.key,t.oldValue,t.newValue);break}}this._cachedChanges=null}bufferMarkerChange(we,t,te){t.range&&t.range.root.is("rootElement")&&!t.range.root._isLoaded&&(t.range=null),te.range&&te.range.root.is("rootElement")&&!te.range.root._isLoaded&&(te.range=null);let be=this._changedMarkers.get(we);be?be.newMarkerData=te:(be={newMarkerData:te,oldMarkerData:t},this._changedMarkers.set(we,be)),be.oldMarkerData.range==null&&te.range==null&&this._changedMarkers.delete(we)}getMarkersToRemove(){const we=[];for(const[t,te]of this._changedMarkers)te.oldMarkerData.range!=null&&we.push({name:t,range:te.oldMarkerData.range});return we}getMarkersToAdd(){const we=[];for(const[t,te]of this._changedMarkers)te.newMarkerData.range!=null&&we.push({name:t,range:te.newMarkerData.range});return we}getChangedMarkers(){return Array.from(this._changedMarkers).map(([we,t])=>({name:we,data:{oldRange:t.oldMarkerData.range,newRange:t.newMarkerData.range}}))}hasDataChanges(){if(this.getChanges().length||this._changedRoots.size>0)return!0;for(const{newMarkerData:we,oldMarkerData:t}of this._changedMarkers.values()){if(we.affectsData!==t.affectsData)return!0;if(we.affectsData){const te=we.range&&!t.range,be=!we.range&&t.range,xe=we.range&&t.range&&!we.range.isEqual(t.range);if(te||be||xe)return!0}}return!1}getChanges(we={}){if(this._cachedChanges)return we.includeChangesInGraveyard?this._cachedChangesWithGraveyard.slice():this._cachedChanges.slice();let t=[];for(const te of this._changesInElement.keys()){const be=this._changesInElement.get(te).sort((Se,Oe)=>Se.offset===Oe.offset?Se.type!=Oe.type?Se.type=="remove"?-1:1:0:Se.offset<Oe.offset?-1:1),xe=this._elementChildrenSnapshots.get(te),ve=_getChildrenSnapshots(te.getChildren()),ke=_generateDiffInstructionsFromChanges(xe.length,be);let Ie=0,Ae=0;for(const Se of ke)if(Se==="i"){const Oe=this._getDiffActionForNode(ve[Ie].node,"insert"),Ve=this._elementsSnapshots.get(ve[Ie].node),Me=this._getInsertDiff(te,Ie,Oe,ve[Ie],Ve);t.push(Me),Ie++}else if(Se==="r"){const Oe=this._getDiffActionForNode(xe[Ae].node,"remove"),Ve=this._getRemoveDiff(te,Ie,Oe,xe[Ae]);t.push(Ve),Ae++}else if(Se==="a"){const Oe=xe[Ae].attributes,Ve=ve[Ie].attributes;let Me;if(ve[Ie].name=="$text")Me=new Range(Position._createAt(te,Ie),Position._createAt(te,Ie+1));else{const Fe=te.offsetToIndex(Ie);Me=new Range(Position._createAt(te,Ie),Position._createAt(te.getChild(Fe),0))}const De=this._getAttributesDiff(Me,Oe,Ve);t.push(...De),Ie++,Ae++}else Ie++,Ae++}t.sort((te,be)=>te.position.root!=be.position.root?te.position.root.rootName<be.position.root.rootName?-1:1:te.position.isEqual(be.position)?te.changeCount-be.changeCount:te.position.isBefore(be.position)?-1:1);for(let te=1,be=0;te<t.length;te++){const xe=t[be],ve=t[te],ke=xe.type=="remove"&&ve.type=="remove"&&xe.name=="$text"&&ve.name=="$text"&&xe.position.isEqual(ve.position),Ie=xe.type=="insert"&&ve.type=="insert"&&xe.name=="$text"&&ve.name=="$text"&&xe.position.parent==ve.position.parent&&xe.position.offset+xe.length==ve.position.offset,Ae=xe.type=="attribute"&&ve.type=="attribute"&&xe.position.parent==ve.position.parent&&xe.range.isFlat&&ve.range.isFlat&&xe.position.offset+xe.length==ve.position.offset&&xe.attributeKey==ve.attributeKey&&xe.attributeOldValue==ve.attributeOldValue&&xe.attributeNewValue==ve.attributeNewValue;ke||Ie||Ae?(xe.length++,Ae&&(xe.range.end=xe.range.end.getShiftedBy(1)),t[te]=null):be=te}t=t.filter(te=>te);for(const te of t)delete te.changeCount,te.type=="attribute"&&(delete te.position,delete te.length);return this._changeCount=0,this._cachedChangesWithGraveyard=t,this._cachedChanges=t.filter(_changesInGraveyardFilter),we.includeChangesInGraveyard?this._cachedChangesWithGraveyard.slice():this._cachedChanges.slice()}getChangedRoots(){return Array.from(this._changedRoots.values()).map(we=>{const t={...we};return t.state!==void 0&&delete t.attributes,t})}getRefreshedItems(){return new Set(this._refreshedItems)}reset(){this._changesInElement.clear(),this._elementChildrenSnapshots.clear(),this._elementsSnapshots.clear(),this._elementState.clear(),this._changedMarkers.clear(),this._changedRoots.clear(),this._refreshedItems.clear(),this._cachedChanges=null}_refreshItem(we){if(this._isInInsertedElement(we.parent))return;this._markRemove(we.parent,we.startOffset,we.offsetSize),this._markInsert(we.parent,we.startOffset,we.offsetSize),this._refreshedItems.add(we),this._setElementState(we,"refresh");const t=Range._createOn(we);for(const te of this._markerCollection.getMarkersIntersectingRange(t)){const be=te.getData();this.bufferMarkerChange(te.name,be,be)}this._cachedChanges=null}_bufferRootLoad(we){if(we.isAttached()){this._bufferRootStateChange(we.rootName,!0),this._markInsert(we,0,we.maxOffset);for(const t of we.getAttributeKeys())this._bufferRootAttributeChange(we.rootName,t,null,we.getAttribute(t));for(const t of this._markerCollection)if(t.getRange().root==we){const te=t.getData();this.bufferMarkerChange(t.name,{...te,range:null},te)}}}_bufferRootStateChange(we,t){if(!this._changedRoots.has(we)){this._changedRoots.set(we,{name:we,state:t?"attached":"detached"});return}const te=this._changedRoots.get(we);te.state!==void 0?(delete te.state,te.attributes===void 0&&this._changedRoots.delete(we)):te.state=t?"attached":"detached"}_bufferRootAttributeChange(we,t,te,be){const xe=this._changedRoots.get(we)||{name:we},ve=xe.attributes||{};if(ve[t]){const ke=ve[t];be===ke.oldValue?delete ve[t]:ke.newValue=be}else ve[t]={oldValue:te,newValue:be};Object.entries(ve).length===0?(delete xe.attributes,xe.state===void 0&&this._changedRoots.delete(we)):(xe.attributes=ve,this._changedRoots.set(we,xe))}_markInsert(we,t,te){if(we.root.is("rootElement")&&!we.root._isLoaded)return;const be={type:"insert",offset:t,howMany:te,count:this._changeCount++};this._markChange(we,be)}_markRemove(we,t,te){if(we.root.is("rootElement")&&!we.root._isLoaded)return;const be={type:"remove",offset:t,howMany:te,count:this._changeCount++};this._markChange(we,be),this._removeAllNestedChanges(we,t,te)}_markAttribute(we){if(we.root.is("rootElement")&&!we.root._isLoaded)return;const t={type:"attribute",offset:we.startOffset,howMany:we.offsetSize,count:this._changeCount++};this._markChange(we.parent,t)}_markChange(we,t){this._makeSnapshots(we);const te=this._getChangesForElement(we);this._handleChange(t,te),te.push(t);for(let be=0;be<te.length;be++)te[be].howMany<1&&(te.splice(be,1),be--)}_setElementState(we,t){if(!we.is("element"))return;const te=Ui._statesPriority.indexOf(this._elementState.get(we));Ui._statesPriority.indexOf(t)>te&&this._elementState.set(we,t)}_getDiffActionForNode(we,t){if(!we.is("element")||!this._elementsSnapshots.has(we))return t;const te=this._elementState.get(we);return!te||te=="move"?t:te}_getChangesForElement(we){let t;return this._changesInElement.has(we)?t=this._changesInElement.get(we):(t=[],this._changesInElement.set(we,t)),t}_makeSnapshots(we){if(this._elementChildrenSnapshots.has(we))return;const t=_getChildrenSnapshots(we.getChildren());this._elementChildrenSnapshots.set(we,t);for(const te of t)this._elementsSnapshots.set(te.node,te)}_handleChange(we,t){we.nodesToHandle=we.howMany;for(const te of t){const be=we.offset+we.howMany,xe=te.offset+te.howMany;if(we.type=="insert"&&(te.type=="insert"&&(we.offset<=te.offset?te.offset+=we.howMany:we.offset<xe&&(te.howMany+=we.nodesToHandle,we.nodesToHandle=0)),te.type=="remove"&&we.offset<te.offset&&(te.offset+=we.howMany),te.type=="attribute")){if(we.offset<=te.offset)te.offset+=we.howMany;else if(we.offset<xe){const ve=te.howMany;te.howMany=we.offset-te.offset,t.unshift({type:"attribute",offset:be,howMany:ve-te.howMany,count:this._changeCount++})}}if(we.type=="remove"){if(te.type=="insert"){if(be<=te.offset)te.offset-=we.howMany;else if(be<=xe)if(we.offset<te.offset){const ve=be-te.offset;te.offset=we.offset,te.howMany-=ve,we.nodesToHandle-=ve}else te.howMany-=we.nodesToHandle,we.nodesToHandle=0;else if(we.offset<=te.offset)we.nodesToHandle-=te.howMany,te.howMany=0;else if(we.offset<xe){const ve=xe-we.offset;te.howMany-=ve,we.nodesToHandle-=ve}}if(te.type=="remove"&&(be<=te.offset?te.offset-=we.howMany:we.offset<te.offset&&(we.nodesToHandle+=te.howMany,te.howMany=0)),te.type=="attribute"){if(be<=te.offset)te.offset-=we.howMany;else if(we.offset<te.offset){const ve=be-te.offset;te.offset=we.offset,te.howMany-=ve}else if(we.offset<xe)if(be<=xe){const ve=te.howMany;te.howMany=we.offset-te.offset;const ke=ve-te.howMany-we.nodesToHandle;t.unshift({type:"attribute",offset:we.offset,howMany:ke,count:this._changeCount++})}else te.howMany-=xe-we.offset}}if(we.type=="attribute"){if(te.type=="insert")if(we.offset<te.offset&&be>te.offset){if(be>xe){const ve={type:"attribute",offset:xe,howMany:be-xe,count:this._changeCount++};this._handleChange(ve,t),t.push(ve)}we.nodesToHandle=te.offset-we.offset,we.howMany=we.nodesToHandle}else we.offset>=te.offset&&we.offset<xe&&(be>xe?(we.nodesToHandle=be-xe,we.offset=xe):we.nodesToHandle=0);if(te.type=="remove"&&we.offset<te.offset&&be>te.offset){const ve={type:"attribute",offset:te.offset,howMany:be-te.offset,count:this._changeCount++};this._handleChange(ve,t),t.push(ve),we.nodesToHandle=te.offset-we.offset,we.howMany=we.nodesToHandle}te.type=="attribute"&&(we.offset>=te.offset&&be<=xe?(we.nodesToHandle=0,we.howMany=0,we.offset=0):we.offset<=te.offset&&be>=xe&&(te.howMany=0))}}we.howMany=we.nodesToHandle,delete we.nodesToHandle}_getInsertDiff(we,t,te,be,xe){const ve={type:"insert",position:Position._createAt(we,t),name:be.name,attributes:new Map(be.attributes),length:1,changeCount:this._changeCount++,action:te};return te!="insert"&&xe&&(ve.before={name:xe.name,attributes:new Map(xe.attributes)}),ve}_getRemoveDiff(we,t,te,be){return{type:"remove",action:te,position:Position._createAt(we,t),name:be.name,attributes:new Map(be.attributes),length:1,changeCount:this._changeCount++}}_getAttributesDiff(we,t,te){const be=[];te=new Map(te);for(const[xe,ve]of t){const ke=te.has(xe)?te.get(xe):null;ke!==ve&&be.push({type:"attribute",position:we.start,range:we.clone(),length:1,attributeKey:xe,attributeOldValue:ve,attributeNewValue:ke,changeCount:this._changeCount++}),te.delete(xe)}for(const[xe,ve]of te)be.push({type:"attribute",position:we.start,range:we.clone(),length:1,attributeKey:xe,attributeOldValue:null,attributeNewValue:ve,changeCount:this._changeCount++});return be}_isInInsertedElement(we){const t=we.parent;if(!t)return!1;const te=this._changesInElement.get(t),be=we.startOffset;if(te){for(const xe of te)if(xe.type=="insert"&&be>=xe.offset&&be<xe.offset+xe.howMany)return!0}return this._isInInsertedElement(t)}_removeAllNestedChanges(we,t,te){const be=new Range(Position._createAt(we,t),Position._createAt(we,t+te));for(const xe of be.getItems({shallow:!0}))xe.is("element")&&(this._changesInElement.delete(xe),this._removeAllNestedChanges(xe,0,xe.maxOffset))}};Re(Ui,"_statesPriority",[void 0,"refresh","rename","move"]);let Differ=Ui;function _getSingleNodeSnapshot(Te){return{node:Te,name:Te.is("$text")?"$text":Te.name,attributes:new Map(Te.getAttributes())}}function _getChildrenSnapshots(Te){const we=[];for(const t of Te)if(t.is("$text"))for(let te=0;te<t.data.length;++te)we.push(_getSingleNodeSnapshot(t));else we.push(_getSingleNodeSnapshot(t));return we}function _generateDiffInstructionsFromChanges(Te,we){const t=[];let te=0,be=0;for(const xe of we){if(xe.offset>te){for(let ve=0;ve<xe.offset-te;ve++)t.push("e");be+=xe.offset-te}if(xe.type=="insert"){for(let ve=0;ve<xe.howMany;ve++)t.push("i");te=xe.offset+xe.howMany}else if(xe.type=="remove"){for(let ve=0;ve<xe.howMany;ve++)t.push("r");te=xe.offset,be+=xe.howMany}else t.push(..."a".repeat(xe.howMany).split("")),te=xe.offset+xe.howMany,be+=xe.howMany}if(be<Te)for(let xe=0;xe<Te-be-te;xe++)t.push("e");return t}function _changesInGraveyardFilter(Te){const we="position"in Te&&Te.position.root.rootName=="$graveyard",t="range"in Te&&Te.range.root.rootName=="$graveyard";return!we&&!t}class History{constructor(){Re(this,"_operations",[]);Re(this,"_undoPairs",new Map);Re(this,"_undoneOperations",new Set);Re(this,"_baseVersionToOperationIndex",new Map);Re(this,"_version",0);Re(this,"_gaps",new Map)}get version(){return this._version}set version(we){this._operations.length&&we>this._version+1&&this._gaps.set(this._version,we),this._version=we}get lastOperation(){return this._operations[this._operations.length-1]}addOperation(we){if(we.baseVersion!==this.version)throw new CKEditorError("model-document-history-addoperation-incorrect-version",this,{operation:we,historyVersion:this.version});this._operations.push(we),this._version++,this._baseVersionToOperationIndex.set(we.baseVersion,this._operations.length-1)}getOperations(we,t=this.version){if(!this._operations.length)return[];const te=this._operations[0];we===void 0&&(we=te.baseVersion);let be=t-1;for(const[ke,Ie]of this._gaps)we>ke&&we<Ie&&(we=Ie),be>ke&&be<Ie&&(be=ke-1);if(be<te.baseVersion||we>this.lastOperation.baseVersion)return[];let xe=this._baseVersionToOperationIndex.get(we);xe===void 0&&(xe=0);let ve=this._baseVersionToOperationIndex.get(be);return ve===void 0&&(ve=this._operations.length-1),this._operations.slice(xe,ve+1)}getOperation(we){const t=this._baseVersionToOperationIndex.get(we);if(t!==void 0)return this._operations[t]}setOperationAsUndone(we,t){this._undoPairs.set(t,we),this._undoneOperations.add(we)}isUndoingOperation(we){return this._undoPairs.has(we)}isUndoneOperation(we){return this._undoneOperations.has(we)}getUndoneOperation(we){return this._undoPairs.get(we)}reset(){this._version=0,this._undoPairs=new Map,this._operations=[],this._undoneOperations=new Set,this._gaps=new Map,this._baseVersionToOperationIndex=new Map}}class RootElement extends Element{constructor(t,te,be="main"){super(te);Re(this,"rootName");Re(this,"_document");Re(this,"_isAttached",!0);Re(this,"_isLoaded",!0);this._document=t,this.rootName=be}get document(){return this._document}isAttached(){return this._isAttached}toJSON(){return this.rootName}}RootElement.prototype.is=function(Te,we){return we?we===this.name&&(Te==="rootElement"||Te==="model:rootElement"||Te==="element"||Te==="model:element"):Te==="rootElement"||Te==="model:rootElement"||Te==="element"||Te==="model:element"||Te==="node"||Te==="model:node"};const graveyardName="$graveyard";class Document extends EmitterMixin(){constructor(t){super();Re(this,"model");Re(this,"history");Re(this,"selection");Re(this,"roots");Re(this,"differ");Re(this,"isReadOnly");Re(this,"_postFixers");Re(this,"_hasSelectionChangedFromTheLastChangeBlock");this.model=t,this.history=new History,this.selection=new DocumentSelection(this),this.roots=new Collection({idProperty:"rootName"}),this.differ=new Differ(t.markers),this.isReadOnly=!1,this._postFixers=new Set,this._hasSelectionChangedFromTheLastChangeBlock=!1,this.createRoot("$root",graveyardName),this.listenTo(t,"applyOperation",(te,be)=>{const xe=be[0];xe.isDocumentOperation&&this.differ.bufferOperation(xe)},{priority:"high"}),this.listenTo(t,"applyOperation",(te,be)=>{const xe=be[0];xe.isDocumentOperation&&this.history.addOperation(xe)},{priority:"low"}),this.listenTo(this.selection,"change",()=>{this._hasSelectionChangedFromTheLastChangeBlock=!0}),this.listenTo(t.markers,"update",(te,be,xe,ve,ke)=>{const Ie={...be.getData(),range:ve};this.differ.bufferMarkerChange(be.name,ke,Ie),xe===null&&be.on("change",(Ae,Se)=>{const Oe=be.getData();this.differ.bufferMarkerChange(be.name,{...Oe,range:Se},Oe)})}),this.registerPostFixer(te=>{let be=!1;for(const xe of this.roots)!xe.isAttached()&&!xe.isEmpty&&(te.remove(te.createRangeIn(xe)),be=!0);for(const xe of this.model.markers)xe.getRange().root.isAttached()||(te.removeMarker(xe),be=!0);return be})}get version(){return this.history.version}set version(t){this.history.version=t}get graveyard(){return this.getRoot(graveyardName)}createRoot(t="$root",te="main"){if(this.roots.get(te))throw new CKEditorError("model-document-createroot-name-exists",this,{name:te});const be=new RootElement(this,t,te);return this.roots.add(be),be}destroy(){this.selection.destroy(),this.stopListening()}getRoot(t="main"){return this.roots.get(t)}getRootNames(t=!1){return this.getRoots(t).map(te=>te.rootName)}getRoots(t=!1){return this.roots.filter(te=>te!=this.graveyard&&(t||te.isAttached())&&te._isLoaded)}registerPostFixer(t){this._postFixers.add(t)}toJSON(){const t=clone$3(this);return t.selection="[engine.model.DocumentSelection]",t.model="[engine.model.Model]",t}_handleChangeBlock(t){this._hasDocumentChangedFromTheLastChangeBlock()&&(this._callPostFixers(t),this.selection.refresh(),this.differ.hasDataChanges()?this.fire("change:data",t.batch):this.fire("change",t.batch),this.selection.refresh(),this.differ.reset()),this._hasSelectionChangedFromTheLastChangeBlock=!1}_hasDocumentChangedFromTheLastChangeBlock(){return!this.differ.isEmpty||this._hasSelectionChangedFromTheLastChangeBlock}_getDefaultRoot(){const t=this.getRoots();return t.length?t[0]:this.graveyard}_getDefaultRange(){const t=this._getDefaultRoot(),te=this.model,be=te.schema,xe=te.createPositionFromPath(t,[0]);return be.getNearestSelectionRange(xe)||te.createRange(xe)}_validateSelectionRange(t){return validateTextNodePosition(t.start)&&validateTextNodePosition(t.end)}_callPostFixers(t){let te=!1;do for(const be of this._postFixers)if(this.selection.refresh(),te=be(t),te)break;while(te)}}function validateTextNodePosition(Te){const we=Te.textNode;if(we){const t=we.data,te=Te.offset-we.startOffset;return!isInsideSurrogatePair(t,te)&&!isInsideCombinedSymbol(t,te)}return!0}class MarkerCollection extends EmitterMixin(){constructor(){super(...arguments);Re(this,"_markers",new Map)}[Symbol.iterator](){return this._markers.values()}has(t){const te=t instanceof Marker?t.name:t;return this._markers.has(te)}get(t){return this._markers.get(t)||null}_set(t,te,be=!1,xe=!1){const ve=t instanceof Marker?t.name:t;if(ve.includes(","))throw new CKEditorError("markercollection-incorrect-marker-name",this);const ke=this._markers.get(ve);if(ke){const Se=ke.getData(),Oe=ke.getRange();let Ve=!1;return Oe.isEqual(te)||(ke._attachLiveRange(LiveRange.fromRange(te)),Ve=!0),be!=ke.managedUsingOperations&&(ke._managedUsingOperations=be,Ve=!0),typeof xe=="boolean"&&xe!=ke.affectsData&&(ke._affectsData=xe,Ve=!0),Ve&&this.fire(`update:${ve}`,ke,Oe,te,Se),ke}const Ie=LiveRange.fromRange(te),Ae=new Marker(ve,Ie,be,xe);return this._markers.set(ve,Ae),this.fire(`update:${ve}`,Ae,null,te,{...Ae.getData(),range:null}),Ae}_remove(t){const te=t instanceof Marker?t.name:t,be=this._markers.get(te);return be?(this._markers.delete(te),this.fire(`update:${te}`,be,be.getRange(),null,be.getData()),this._destroyMarker(be),!0):!1}_refresh(t){const te=t instanceof Marker?t.name:t,be=this._markers.get(te);if(!be)throw new CKEditorError("markercollection-refresh-marker-not-exists",this);const xe=be.getRange();this.fire(`update:${te}`,be,xe,xe,be.getData())}*getMarkersAtPosition(t){for(const te of this)te.getRange().containsPosition(t)&&(yield te)}*getMarkersIntersectingRange(t){for(const te of this)te.getRange().getIntersection(t)!==null&&(yield te)}destroy(){for(const t of this._markers.values())this._destroyMarker(t);this._markers=null,this.stopListening()}*getMarkersGroup(t){for(const te of this._markers.values())te.name.startsWith(t+":")&&(yield te)}_destroyMarker(t){t.stopListening(),t._detachLiveRange()}}class Marker extends EmitterMixin(TypeCheckable){constructor(t,te,be,xe){super();Re(this,"name");Re(this,"_managedUsingOperations");Re(this,"_affectsData");Re(this,"_liveRange");this.name=t,this._liveRange=this._attachLiveRange(te),this._managedUsingOperations=be,this._affectsData=xe}get managedUsingOperations(){if(!this._liveRange)throw new CKEditorError("marker-destroyed",this);return this._managedUsingOperations}get affectsData(){if(!this._liveRange)throw new CKEditorError("marker-destroyed",this);return this._affectsData}getData(){return{range:this.getRange(),affectsData:this.affectsData,managedUsingOperations:this.managedUsingOperations}}getStart(){if(!this._liveRange)throw new CKEditorError("marker-destroyed",this);return this._liveRange.start.clone()}getEnd(){if(!this._liveRange)throw new CKEditorError("marker-destroyed",this);return this._liveRange.end.clone()}getRange(){if(!this._liveRange)throw new CKEditorError("marker-destroyed",this);return this._liveRange.toRange()}_attachLiveRange(t){return this._liveRange&&this._detachLiveRange(),t.delegate("change:range").to(this),t.delegate("change:content").to(this),this._liveRange=t,t}_detachLiveRange(){this._liveRange.stopDelegating("change:range",this),this._liveRange.stopDelegating("change:content",this),this._liveRange.detach(),this._liveRange=null}}Marker.prototype.is=function(Te){return Te==="marker"||Te==="model:marker"};class DetachOperation extends Operation{constructor(t,te){super(null);Re(this,"sourcePosition");Re(this,"howMany");this.sourcePosition=t.clone(),this.howMany=te}get type(){return"detach"}get affectedSelectable(){return null}toJSON(){const t=super.toJSON();return t.sourcePosition=this.sourcePosition.toJSON(),t}_validate(){if(this.sourcePosition.root.document)throw new CKEditorError("detach-operation-on-document-node",this)}_execute(){_remove(Range._createFromPositionAndShift(this.sourcePosition,this.howMany))}static get className(){return"DetachOperation"}}class DocumentFragment extends TypeCheckable{constructor(t){super();Re(this,"markers",new Map);Re(this,"_children",new NodeList);t&&this._insertChild(0,t)}[Symbol.iterator](){return this.getChildren()}get childCount(){return this._children.length}get maxOffset(){return this._children.maxOffset}get isEmpty(){return this.childCount===0}get nextSibling(){return null}get previousSibling(){return null}get root(){return this}get parent(){return null}get document(){return null}isAttached(){return!1}getAncestors(){return[]}getChild(t){return this._children.getNode(t)}getChildren(){return this._children[Symbol.iterator]()}getChildIndex(t){return this._children.getNodeIndex(t)}getChildStartOffset(t){return this._children.getNodeStartOffset(t)}getPath(){return[]}getNodeByPath(t){let te=this;for(const be of t)te=te.getChild(te.offsetToIndex(be));return te}offsetToIndex(t){return this._children.offsetToIndex(t)}toJSON(){const t=[];for(const te of this._children)t.push(te.toJSON());return t}static fromJSON(t){const te=[];for(const be of t)be.name?te.push(Element.fromJSON(be)):te.push(Text.fromJSON(be));return new DocumentFragment(te)}_appendChild(t){this._insertChild(this.childCount,t)}_insertChild(t,te){const be=normalize$4(te);for(const xe of be)xe.parent!==null&&xe._remove(),xe.parent=this;this._children._insertNodes(t,be)}_removeChildren(t,te=1){const be=this._children._removeNodes(t,te);for(const xe of be)xe.parent=null;return be}}DocumentFragment.prototype.is=function(Te){return Te==="documentFragment"||Te==="model:documentFragment"};function normalize$4(Te){return typeof Te=="string"?[new Text(Te)]:(isIterable(Te)||(Te=[Te]),Array.from(Te).map(we=>typeof we=="string"?new Text(we):we instanceof TextProxy?new Text(we.data,we.getAttributes()):we))}let Writer$2=class{constructor(we,t){Re(this,"model");Re(this,"batch");this.model=we,this.batch=t}createText(we,t){return new Text(we,t)}createElement(we,t){return new Element(we,t)}createDocumentFragment(){return new DocumentFragment}cloneElement(we,t=!0){return we._clone(t)}insert(we,t,te=0){if(this._assertWriterUsedCorrectly(),we instanceof Text&&we.data=="")return;const be=Position._createAt(t,te);if(we.parent)if(isSameTree(we.root,be.root)){this.move(Range._createOn(we),be);return}else{if(we.root.document)throw new CKEditorError("model-writer-insert-forbidden-move",this);this.remove(we)}const xe=be.root.document?be.root.document.version:null,ve=new InsertOperation(be,we,xe);if(we instanceof Text&&(ve.shouldReceiveAttributes=!0),this.batch.addOperation(ve),this.model.applyOperation(ve),we instanceof DocumentFragment)for(const[ke,Ie]of we.markers){const Ae=Position._createAt(Ie.root,0),Oe={range:new Range(Ie.start._getCombined(Ae,be),Ie.end._getCombined(Ae,be)),usingOperation:!0,affectsData:!0};this.model.markers.has(ke)?this.updateMarker(ke,Oe):this.addMarker(ke,Oe)}}insertText(we,t,te,be){t instanceof DocumentFragment||t instanceof Element||t instanceof Position?this.insert(this.createText(we),t,te):this.insert(this.createText(we,t),te,be)}insertElement(we,t,te,be){t instanceof DocumentFragment||t instanceof Element||t instanceof Position?this.insert(this.createElement(we),t,te):this.insert(this.createElement(we,t),te,be)}append(we,t){this.insert(we,t,"end")}appendText(we,t,te){t instanceof DocumentFragment||t instanceof Element?this.insert(this.createText(we),t,"end"):this.insert(this.createText(we,t),te,"end")}appendElement(we,t,te){t instanceof DocumentFragment||t instanceof Element?this.insert(this.createElement(we),t,"end"):this.insert(this.createElement(we,t),te,"end")}setAttribute(we,t,te){if(this._assertWriterUsedCorrectly(),te instanceof Range){const be=te.getMinimalFlatRanges();for(const xe of be)setAttributeOnRange(this,we,t,xe)}else setAttributeOnItem(this,we,t,te)}setAttributes(we,t){for(const[te,be]of toMap(we))this.setAttribute(te,be,t)}removeAttribute(we,t){if(this._assertWriterUsedCorrectly(),t instanceof Range){const te=t.getMinimalFlatRanges();for(const be of te)setAttributeOnRange(this,we,null,be)}else setAttributeOnItem(this,we,null,t)}clearAttributes(we){this._assertWriterUsedCorrectly();const t=te=>{for(const be of te.getAttributeKeys())this.removeAttribute(be,te)};if(!(we instanceof Range))t(we);else for(const te of we.getItems())t(te)}move(we,t,te){if(this._assertWriterUsedCorrectly(),!(we instanceof Range))throw new CKEditorError("writer-move-invalid-range",this);if(!we.isFlat)throw new CKEditorError("writer-move-range-not-flat",this);const be=Position._createAt(t,te);if(be.isEqual(we.start))return;if(this._addOperationForAffectedMarkers("move",we),!isSameTree(we.root,be.root))throw new CKEditorError("writer-move-different-document",this);const xe=we.root.document?we.root.document.version:null,ve=new MoveOperation(we.start,we.end.offset-we.start.offset,be,xe);this.batch.addOperation(ve),this.model.applyOperation(ve)}remove(we){this._assertWriterUsedCorrectly();const te=(we instanceof Range?we:Range._createOn(we)).getMinimalFlatRanges().reverse();for(const be of te)this._addOperationForAffectedMarkers("move",be),applyRemoveOperation(be.start,be.end.offset-be.start.offset,this.batch,this.model)}merge(we){this._assertWriterUsedCorrectly();const t=we.nodeBefore,te=we.nodeAfter;if(this._addOperationForAffectedMarkers("merge",we),!(t instanceof Element))throw new CKEditorError("writer-merge-no-element-before",this);if(!(te instanceof Element))throw new CKEditorError("writer-merge-no-element-after",this);we.root.document?this._merge(we):this._mergeDetached(we)}createPositionFromPath(we,t,te){return this.model.createPositionFromPath(we,t,te)}createPositionAt(we,t){return this.model.createPositionAt(we,t)}createPositionAfter(we){return this.model.createPositionAfter(we)}createPositionBefore(we){return this.model.createPositionBefore(we)}createRange(we,t){return this.model.createRange(we,t)}createRangeIn(we){return this.model.createRangeIn(we)}createRangeOn(we){return this.model.createRangeOn(we)}createSelection(...we){return this.model.createSelection(...we)}_mergeDetached(we){const t=we.nodeBefore,te=we.nodeAfter;this.move(Range._createIn(te),Position._createAt(t,"end")),this.remove(te)}_merge(we){const t=Position._createAt(we.nodeBefore,"end"),te=Position._createAt(we.nodeAfter,0),be=we.root.document.graveyard,xe=new Position(be,[0]),ve=we.root.document.version,ke=new MergeOperation(te,we.nodeAfter.maxOffset,t,xe,ve);this.batch.addOperation(ke),this.model.applyOperation(ke)}rename(we,t){if(this._assertWriterUsedCorrectly(),!(we instanceof Element))throw new CKEditorError("writer-rename-not-element-instance",this);const te=we.root.document?we.root.document.version:null,be=new RenameOperation(Position._createBefore(we),we.name,t,te);this.batch.addOperation(be),this.model.applyOperation(be)}split(we,t){this._assertWriterUsedCorrectly();let te=we.parent;if(!te.parent)throw new CKEditorError("writer-split-element-no-parent",this);if(t||(t=te.parent),!we.parent.getAncestors({includeSelf:!0}).includes(t))throw new CKEditorError("writer-split-invalid-limit-element",this);let be,xe;do{const ve=te.root.document?te.root.document.version:null,ke=te.maxOffset-we.offset,Ie=SplitOperation.getInsertionPosition(we),Ae=new SplitOperation(we,ke,Ie,null,ve);this.batch.addOperation(Ae),this.model.applyOperation(Ae),!be&&!xe&&(be=te,xe=we.parent.nextSibling),we=this.createPositionAfter(we.parent),te=we.parent}while(te!==t);return{position:we,range:new Range(Position._createAt(be,"end"),Position._createAt(xe,0))}}wrap(we,t){if(this._assertWriterUsedCorrectly(),!we.isFlat)throw new CKEditorError("writer-wrap-range-not-flat",this);const te=t instanceof Element?t:new Element(t);if(te.childCount>0)throw new CKEditorError("writer-wrap-element-not-empty",this);if(te.parent!==null)throw new CKEditorError("writer-wrap-element-attached",this);this.insert(te,we.start);const be=new Range(we.start.getShiftedBy(1),we.end.getShiftedBy(1));this.move(be,Position._createAt(te,0))}unwrap(we){if(this._assertWriterUsedCorrectly(),we.parent===null)throw new CKEditorError("writer-unwrap-element-no-parent",this);this.move(Range._createIn(we),this.createPositionAfter(we)),this.remove(we)}addMarker(we,t){if(this._assertWriterUsedCorrectly(),!t||typeof t.usingOperation!="boolean")throw new CKEditorError("writer-addmarker-no-usingoperation",this);const te=t.usingOperation,be=t.range,xe=t.affectsData===void 0?!1:t.affectsData;if(this.model.markers.has(we))throw new CKEditorError("writer-addmarker-marker-exists",this);if(!be)throw new CKEditorError("writer-addmarker-no-range",this);return te?(applyMarkerOperation(this,we,null,be,xe),this.model.markers.get(we)):this.model.markers._set(we,be,te,xe)}updateMarker(we,t){this._assertWriterUsedCorrectly();const te=typeof we=="string"?we:we.name,be=this.model.markers.get(te);if(!be)throw new CKEditorError("writer-updatemarker-marker-not-exists",this);if(!t){logWarning("writer-updatemarker-reconvert-using-editingcontroller",{markerName:te}),this.model.markers._refresh(be);return}const xe=typeof t.usingOperation=="boolean",ve=typeof t.affectsData=="boolean",ke=ve?t.affectsData:be.affectsData;if(!xe&&!t.range&&!ve)throw new CKEditorError("writer-updatemarker-wrong-options",this);const Ie=be.getRange(),Ae=t.range?t.range:Ie;if(xe&&t.usingOperation!==be.managedUsingOperations){t.usingOperation?applyMarkerOperation(this,te,null,Ae,ke):(applyMarkerOperation(this,te,Ie,null,ke),this.model.markers._set(te,Ae,void 0,ke));return}be.managedUsingOperations?applyMarkerOperation(this,te,Ie,Ae,ke):this.model.markers._set(te,Ae,void 0,ke)}removeMarker(we){this._assertWriterUsedCorrectly();const t=typeof we=="string"?we:we.name;if(!this.model.markers.has(t))throw new CKEditorError("writer-removemarker-no-marker",this);const te=this.model.markers.get(t);if(!te.managedUsingOperations){this.model.markers._remove(t);return}const be=te.getRange();applyMarkerOperation(this,t,be,null,te.affectsData)}addRoot(we,t="$root"){this._assertWriterUsedCorrectly();const te=this.model.document.getRoot(we);if(te&&te.isAttached())throw new CKEditorError("writer-addroot-root-exists",this);const be=this.model.document,xe=new RootOperation(we,t,!0,be,be.version);return this.batch.addOperation(xe),this.model.applyOperation(xe),this.model.document.getRoot(we)}detachRoot(we){this._assertWriterUsedCorrectly();const t=typeof we=="string"?this.model.document.getRoot(we):we;if(!t||!t.isAttached())throw new CKEditorError("writer-detachroot-no-root",this);for(const xe of this.model.markers)xe.getRange().root===t&&this.removeMarker(xe);for(const xe of t.getAttributeKeys())this.removeAttribute(xe,t);this.remove(this.createRangeIn(t));const te=this.model.document,be=new RootOperation(t.rootName,t.name,!1,te,te.version);this.batch.addOperation(be),this.model.applyOperation(be)}setSelection(...we){this._assertWriterUsedCorrectly(),this.model.document.selection._setTo(...we)}setSelectionFocus(we,t){this._assertWriterUsedCorrectly(),this.model.document.selection._setFocus(we,t)}setSelectionAttribute(we,t){if(this._assertWriterUsedCorrectly(),typeof we=="string")this._setSelectionAttribute(we,t);else for(const[te,be]of toMap(we))this._setSelectionAttribute(te,be)}removeSelectionAttribute(we){if(this._assertWriterUsedCorrectly(),typeof we=="string")this._removeSelectionAttribute(we);else for(const t of we)this._removeSelectionAttribute(t)}overrideSelectionGravity(){return this.model.document.selection._overrideGravity()}restoreSelectionGravity(we){this.model.document.selection._restoreGravity(we)}_setSelectionAttribute(we,t){const te=this.model.document.selection;if(te.isCollapsed&&te.anchor.parent.isEmpty){const be=DocumentSelection._getStoreAttributeKey(we);this.setAttribute(be,t,te.anchor.parent)}te._setAttribute(we,t)}_removeSelectionAttribute(we){const t=this.model.document.selection;if(t.isCollapsed&&t.anchor.parent.isEmpty){const te=DocumentSelection._getStoreAttributeKey(we);this.removeAttribute(te,t.anchor.parent)}t._removeAttribute(we)}_assertWriterUsedCorrectly(){if(this.model._currentWriter!==this)throw new CKEditorError("writer-incorrect-use",this)}_addOperationForAffectedMarkers(we,t){for(const te of this.model.markers){if(!te.managedUsingOperations)continue;const be=te.getRange();let xe=!1;if(we==="move"){const ve=t;xe=ve.containsPosition(be.start)||ve.start.isEqual(be.start)||ve.containsPosition(be.end)||ve.end.isEqual(be.end)}else{const ve=t,ke=ve.nodeBefore,Ie=ve.nodeAfter,Ae=be.start.parent==ke&&be.start.isAtEnd,Se=be.end.parent==Ie&&be.end.offset==0,Oe=be.end.nodeAfter==Ie,Ve=be.start.nodeAfter==Ie;xe=Ae||Se||Oe||Ve}xe&&this.updateMarker(te.name,{range:be})}}};function setAttributeOnRange(Te,we,t,te){const be=Te.model,xe=be.document;let ve=te.start,ke,Ie,Ae;for(const Oe of te.getWalker({shallow:!0}))Ae=Oe.item.getAttribute(we),ke&&Ie!=Ae&&(Ie!=t&&Se(),ve=ke),ke=Oe.nextPosition,Ie=Ae;ke instanceof Position&&ke!=ve&&Ie!=t&&Se();function Se(){const Oe=new Range(ve,ke),Ve=Oe.root.document?xe.version:null,Me=new AttributeOperation(Oe,we,Ie,t,Ve);Te.batch.addOperation(Me),be.applyOperation(Me)}}function setAttributeOnItem(Te,we,t,te){const be=Te.model,xe=be.document,ve=te.getAttribute(we);let ke,Ie;if(ve!=t){if(te.root===te){const Se=te.document?xe.version:null;Ie=new RootAttributeOperation(te,we,ve,t,Se)}else{ke=new Range(Position._createBefore(te),Te.createPositionAfter(te));const Se=ke.root.document?xe.version:null;Ie=new AttributeOperation(ke,we,ve,t,Se)}Te.batch.addOperation(Ie),be.applyOperation(Ie)}}function applyMarkerOperation(Te,we,t,te,be){const xe=Te.model,ve=xe.document,ke=new MarkerOperation(we,t,te,xe.markers,!!be,ve.version);Te.batch.addOperation(ke),xe.applyOperation(ke)}function applyRemoveOperation(Te,we,t,te){let be;if(Te.root.document){const xe=te.document,ve=new Position(xe.graveyard,[0]);be=new MoveOperation(Te,we,ve,xe.version)}else be=new DetachOperation(Te,we);t.addOperation(be),te.applyOperation(be)}function isSameTree(Te,we){return Te===we||Te instanceof RootElement&&we instanceof RootElement}function deleteContent(Te,we,t={}){if(we.isCollapsed)return;const te=we.getFirstRange();if(te.root.rootName=="$graveyard")return;const be=Te.schema;Te.change(xe=>{if(!t.doNotResetEntireContent&&shouldEntireContentBeReplacedWithParagraph(be,we)){replaceEntireContentWithParagraph(xe,we);return}const ve={};if(!t.doNotAutoparagraph){const Ae=we.getSelectedElement();Ae&&Object.assign(ve,be.getAttributesWithProperty(Ae,"copyOnReplace",!0))}const[ke,Ie]=getLivePositionsForSelectedBlocks(te);ke.isTouching(Ie)||xe.remove(xe.createRange(ke,Ie)),t.leaveUnmerged||(mergeBranches(xe,ke,Ie),be.removeDisallowedAttributes(ke.parent.getChildren(),xe)),collapseSelectionAt(xe,we,ke),!t.doNotAutoparagraph&&shouldAutoparagraph(be,ke)&&insertParagraph(xe,ke,we,ve),ke.detach(),Ie.detach()})}function getLivePositionsForSelectedBlocks(Te){const we=Te.root.document.model,t=Te.start;let te=Te.end;if(we.hasContent(Te,{ignoreMarkers:!0})){const be=getParentBlock(te);if(be&&te.isTouching(we.createPositionAt(be,0))){const xe=we.createSelection(Te);we.modifySelection(xe,{direction:"backward"});const ve=xe.getLastPosition(),ke=we.createRange(ve,te);we.hasContent(ke,{ignoreMarkers:!0})||(te=ve)}}return[LivePosition.fromPosition(t,"toPrevious"),LivePosition.fromPosition(te,"toNext")]}function getParentBlock(Te){const we=Te.parent,t=we.root.document.model.schema,te=we.getAncestors({parentFirst:!0,includeSelf:!0});for(const be of te){if(t.isLimit(be))return null;if(t.isBlock(be))return be}}function mergeBranches(Te,we,t){const te=Te.model;if(!checkShouldMerge(Te.model.schema,we,t))return;const[be,xe]=getAncestorsJustBelowCommonAncestor(we,t);!be||!xe||(!te.hasContent(be,{ignoreMarkers:!0})&&te.hasContent(xe,{ignoreMarkers:!0})?mergeBranchesRight(Te,we,t,be.parent):mergeBranchesLeft(Te,we,t,be.parent))}function mergeBranchesLeft(Te,we,t,te){const be=we.parent,xe=t.parent;if(!(be==te||xe==te)){for(we=Te.createPositionAfter(be),t=Te.createPositionBefore(xe),t.isEqual(we)||Te.insert(xe,we),Te.merge(we);t.parent.isEmpty;){const ve=t.parent;t=Te.createPositionBefore(ve),Te.remove(ve)}checkShouldMerge(Te.model.schema,we,t)&&mergeBranchesLeft(Te,we,t,te)}}function mergeBranchesRight(Te,we,t,te){const be=we.parent,xe=t.parent;if(!(be==te||xe==te)){for(we=Te.createPositionAfter(be),t=Te.createPositionBefore(xe),t.isEqual(we)||Te.insert(be,t);we.parent.isEmpty;){const ve=we.parent;we=Te.createPositionBefore(ve),Te.remove(ve)}t=Te.createPositionBefore(xe),mergeRight(Te,t),checkShouldMerge(Te.model.schema,we,t)&&mergeBranchesRight(Te,we,t,te)}}function mergeRight(Te,we){const t=we.nodeBefore,te=we.nodeAfter;t.name!=te.name&&Te.rename(t,te.name),Te.clearAttributes(t),Te.setAttributes(Object.fromEntries(te.getAttributes()),t),Te.merge(we)}function checkShouldMerge(Te,we,t){const te=we.parent,be=t.parent;return te==be||Te.isLimit(te)||Te.isLimit(be)?!1:isCrossingLimitElement(we,t,Te)}function getAncestorsJustBelowCommonAncestor(Te,we){const t=Te.getAncestors(),te=we.getAncestors();let be=0;for(;t[be]&&t[be]==te[be];)be++;return[t[be],te[be]]}function shouldAutoparagraph(Te,we){const t=Te.checkChild(we,"$text"),te=Te.checkChild(we,"paragraph");return!t&&te}function isCrossingLimitElement(Te,we,t){const te=new Range(Te,we);for(const be of te.getWalker())if(t.isLimit(be.item))return!1;return!0}function insertParagraph(Te,we,t,te={}){const be=Te.createElement("paragraph");Te.model.schema.setAllowedAttributes(be,te,Te),Te.insert(be,we),collapseSelectionAt(Te,t,Te.createPositionAt(be,0))}function replaceEntireContentWithParagraph(Te,we){const t=Te.model.schema.getLimitElement(we);Te.remove(Te.createRangeIn(t)),insertParagraph(Te,Te.createPositionAt(t,0),we)}function shouldEntireContentBeReplacedWithParagraph(Te,we){const t=Te.getLimitElement(we);if(!we.containsEntireContent(t))return!1;const te=we.getFirstRange();return te.start.parent==te.end.parent?!1:Te.checkChild(t,"paragraph")}function collapseSelectionAt(Te,we,t){we instanceof DocumentSelection?Te.setSelection(t):we.setTo(t)}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function getSelectedContent(Te,we){return Te.change(t=>{const te=t.createDocumentFragment(),be=we.getFirstRange();if(!be||be.isCollapsed)return te;const xe=be.start.root,ve=be.start.getCommonPath(be.end),ke=xe.getNodeByPath(ve);let Ie;be.start.parent==be.end.parent?Ie=be:Ie=t.createRange(t.createPositionAt(ke,be.start.path[ve.length]),t.createPositionAt(ke,be.end.path[ve.length]+1));const Ae=Ie.end.offset-Ie.start.offset;for(const Se of Ie.getItems({shallow:!0}))Se.is("$textProxy")?t.appendText(Se.data,Se.getAttributes(),te):t.append(t.cloneElement(Se,!0),te);if(Ie!=be){const Se=be._getTransformedByMove(Ie.start,t.createPositionAt(te,0),Ae)[0],Oe=t.createRange(t.createPositionAt(te,0),Se.start),Ve=t.createRange(Se.end,t.createPositionAt(te,"end"));removeRangeContent(Ve,t),removeRangeContent(Oe,t)}return te})}function removeRangeContent(Te,we){const t=[];Array.from(Te.getItems({direction:"backward"})).map(te=>we.createRangeOn(te)).filter(te=>(te.start.isAfter(Te.start)||te.start.isEqual(Te.start))&&(te.end.isBefore(Te.end)||te.end.isEqual(Te.end))).forEach(te=>{t.push(te.start.parent),we.remove(te)}),t.forEach(te=>{let be=te;for(;be.parent&&be.isEmpty;){const xe=we.createRangeOn(be);be=be.parent,we.remove(xe)}})}function insertContent(Te,we,t){return Te.change(te=>{const be=t||Te.document.selection;be.isCollapsed||Te.deleteContent(be,{doNotAutoparagraph:!0});const xe=new Insertion(Te,te,be.anchor),ve=[];let ke;if(we.is("documentFragment")){if(we.markers.size){const Se=[];for(const[Oe,Ve]of we.markers){const{start:Me,end:De}=Ve,Fe=Me.isEqual(De);Se.push({position:Me,name:Oe,isCollapsed:Fe},{position:De,name:Oe,isCollapsed:Fe})}Se.sort(({position:Oe},{position:Ve})=>Oe.isBefore(Ve)?1:-1);for(const{position:Oe,name:Ve,isCollapsed:Me}of Se){let De=null,Fe=null;const Be=Oe.parent===we&&Oe.isAtStart,$e=Oe.parent===we&&Oe.isAtEnd;!Be&&!$e?(De=te.createElement("$marker"),te.insert(De,Oe)):Me&&(Fe=Be?"start":"end"),ve.push({name:Ve,element:De,collapsed:Fe})}}ke=we.getChildren()}else ke=[we];xe.handleNodes(ke);let Ie=xe.getSelectionRange();if(we.is("documentFragment")&&ve.length){const Se=Ie?LiveRange.fromRange(Ie):null,Oe={};for(let Ve=ve.length-1;Ve>=0;Ve--){const{name:Me,element:De,collapsed:Fe}=ve[Ve],Be=!Oe[Me];if(Be&&(Oe[Me]=[]),De){const $e=te.createPositionAt(De,"before");Oe[Me].push($e),te.remove(De)}else{const $e=xe.getAffectedRange();if(!$e){Fe&&Oe[Me].push(xe.position);continue}Fe?Oe[Me].push($e[Fe]):Oe[Me].push(Be?$e.start:$e.end)}}for(const[Ve,[Me,De]]of Object.entries(Oe))Me&&De&&Me.root===De.root&&Me.root.document&&!te.model.markers.has(Ve)&&te.addMarker(Ve,{usingOperation:!0,affectsData:!0,range:new Range(Me,De)});Se&&(Ie=Se.toRange(),Se.detach())}/* istanbul ignore else -- @preserve */Ie&&(be instanceof DocumentSelection?te.setSelection(Ie):be.setTo(Ie));const Ae=xe.getAffectedRange()||Te.createRange(be.anchor);return xe.destroy(),Ae})}class Insertion{constructor(we,t,te){Re(this,"model");Re(this,"writer");Re(this,"position");Re(this,"canMergeWith");Re(this,"schema");Re(this,"_documentFragment");Re(this,"_documentFragmentPosition");Re(this,"_firstNode",null);Re(this,"_lastNode",null);Re(this,"_lastAutoParagraph",null);Re(this,"_filterAttributesOf",[]);Re(this,"_affectedStart",null);Re(this,"_affectedEnd",null);Re(this,"_nodeToSelect",null);this.model=we,this.writer=t,this.position=te,this.canMergeWith=new Set([this.position.parent]),this.schema=we.schema,this._documentFragment=t.createDocumentFragment(),this._documentFragmentPosition=t.createPositionAt(this._documentFragment,0)}handleNodes(we){for(const t of Array.from(we))this._handleNode(t);this._insertPartialFragment(),this._lastAutoParagraph&&this._updateLastNodeFromAutoParagraph(this._lastAutoParagraph),this._mergeOnRight(),this.schema.removeDisallowedAttributes(this._filterAttributesOf,this.writer),this._filterAttributesOf=[]}_updateLastNodeFromAutoParagraph(we){const t=this.writer.createPositionAfter(this._lastNode),te=this.writer.createPositionAfter(we);if(te.isAfter(t)){this._lastNode=we;/* istanbul ignore if -- @preserve */if(this.position.parent!=we||!this.position.isAtEnd)throw new CKEditorError("insertcontent-invalid-insertion-position",this);this.position=te,this._setAffectedBoundaries(this.position)}}getSelectionRange(){return this._nodeToSelect?Range._createOn(this._nodeToSelect):this.model.schema.getNearestSelectionRange(this.position)}getAffectedRange(){return this._affectedStart?new Range(this._affectedStart,this._affectedEnd):null}destroy(){this._affectedStart&&this._affectedStart.detach(),this._affectedEnd&&this._affectedEnd.detach()}_handleNode(we){if(this.schema.isObject(we)){this._handleObject(we);return}let t=this._checkAndAutoParagraphToAllowedPosition(we);if(!t&&(t=this._checkAndSplitToAllowedPosition(we),!t)){this._handleDisallowedNode(we);return}this._appendToFragment(we),this._firstNode||(this._firstNode=we),this._lastNode=we}_insertPartialFragment(){if(this._documentFragment.isEmpty)return;const we=LivePosition.fromPosition(this.position,"toNext");this._setAffectedBoundaries(this.position),this._documentFragment.getChild(0)==this._firstNode&&(this.writer.insert(this._firstNode,this.position),this._mergeOnLeft(),this.position=we.toPosition()),this._documentFragment.isEmpty||this.writer.insert(this._documentFragment,this.position),this._documentFragmentPosition=this.writer.createPositionAt(this._documentFragment,0),this.position=we.toPosition(),we.detach()}_handleObject(we){this._checkAndSplitToAllowedPosition(we)?this._appendToFragment(we):this._tryAutoparagraphing(we)}_handleDisallowedNode(we){we.is("element")?this.handleNodes(we.getChildren()):this._tryAutoparagraphing(we)}_appendToFragment(we){/* istanbul ignore if -- @preserve */if(!this.schema.checkChild(this.position,we))throw new CKEditorError("insertcontent-wrong-position",this,{node:we,position:this.position});this.writer.insert(we,this._documentFragmentPosition),this._documentFragmentPosition=this._documentFragmentPosition.getShiftedBy(we.offsetSize),this.schema.isObject(we)&&!this.schema.checkChild(this.position,"$text")?this._nodeToSelect=we:this._nodeToSelect=null,this._filterAttributesOf.push(we)}_setAffectedBoundaries(we){this._affectedStart||(this._affectedStart=LivePosition.fromPosition(we,"toPrevious")),(!this._affectedEnd||this._affectedEnd.isBefore(we))&&(this._affectedEnd&&this._affectedEnd.detach(),this._affectedEnd=LivePosition.fromPosition(we,"toNext"))}_mergeOnLeft(){const we=this._firstNode;if(!(we instanceof Element)||!this._canMergeLeft(we))return;const t=LivePosition._createBefore(we);t.stickiness="toNext";const te=LivePosition.fromPosition(this.position,"toNext");this._affectedStart.isEqual(t)&&(this._affectedStart.detach(),this._affectedStart=LivePosition._createAt(t.nodeBefore,"end","toPrevious")),this._firstNode===this._lastNode&&(this._firstNode=t.nodeBefore,this._lastNode=t.nodeBefore),this.writer.merge(t),t.isEqual(this._affectedEnd)&&this._firstNode===this._lastNode&&(this._affectedEnd.detach(),this._affectedEnd=LivePosition._createAt(t.nodeBefore,"end","toNext")),this.position=te.toPosition(),te.detach(),this._filterAttributesOf.push(this.position.parent),t.detach()}_mergeOnRight(){const we=this._lastNode;if(!(we instanceof Element)||!this._canMergeRight(we))return;const t=LivePosition._createAfter(we);t.stickiness="toNext";/* istanbul ignore if -- @preserve */if(!this.position.isEqual(t))throw new CKEditorError("insertcontent-invalid-insertion-position",this);this.position=Position._createAt(t.nodeBefore,"end");const te=LivePosition.fromPosition(this.position,"toPrevious");this._affectedEnd.isEqual(t)&&(this._affectedEnd.detach(),this._affectedEnd=LivePosition._createAt(t.nodeBefore,"end","toNext")),this._firstNode===this._lastNode&&(this._firstNode=t.nodeBefore,this._lastNode=t.nodeBefore),this.writer.merge(t),t.getShiftedBy(-1).isEqual(this._affectedStart)&&this._firstNode===this._lastNode&&(this._affectedStart.detach(),this._affectedStart=LivePosition._createAt(t.nodeBefore,0,"toPrevious")),this.position=te.toPosition(),te.detach(),this._filterAttributesOf.push(this.position.parent),t.detach()}_canMergeLeft(we){const t=we.previousSibling;return t instanceof Element&&this.canMergeWith.has(t)&&this.model.schema.checkMerge(t,we)}_canMergeRight(we){const t=we.nextSibling;return t instanceof Element&&this.canMergeWith.has(t)&&this.model.schema.checkMerge(we,t)}_tryAutoparagraphing(we){const t=this.writer.createElement("paragraph");this._getAllowedIn(this.position.parent,t)&&this.schema.checkChild(t,we)&&(t._appendChild(we),this._handleNode(t))}_checkAndAutoParagraphToAllowedPosition(we){if(this.schema.checkChild(this.position.parent,we))return!0;if(!this.schema.checkChild(this.position.parent,"paragraph")||!this.schema.checkChild("paragraph",we))return!1;this._insertPartialFragment();const t=this.writer.createElement("paragraph");return this.writer.insert(t,this.position),this._setAffectedBoundaries(this.position),this._lastAutoParagraph=t,this.position=this.writer.createPositionAt(t,0),!0}_checkAndSplitToAllowedPosition(we){const t=this._getAllowedIn(this.position.parent,we);if(!t)return!1;for(t!=this.position.parent&&this._insertPartialFragment();t!=this.position.parent;)if(this.position.isAtStart){const te=this.position.parent;this.position=this.writer.createPositionBefore(te),te.isEmpty&&te.parent===t&&this.writer.remove(te)}else if(this.position.isAtEnd)this.position=this.writer.createPositionAfter(this.position.parent);else{const te=this.writer.createPositionAfter(this.position.parent);this._setAffectedBoundaries(this.position),this.writer.split(this.position),this.position=te,this.canMergeWith.add(this.position.nodeAfter)}return!0}_getAllowedIn(we,t){return this.schema.checkChild(we,t)?we:this.schema.isLimit(we)?null:this._getAllowedIn(we.parent,t)}}function insertObject(Te,we,t,te={}){if(!Te.schema.isObject(we))throw new CKEditorError("insertobject-element-not-an-object",Te,{object:we});const be=t||Te.document.selection;let xe=be;te.findOptimalPosition&&Te.schema.isBlock(we)&&(xe=Te.createSelection(Te.schema.findOptimalInsertionRange(be,te.findOptimalPosition)));const ve=first(be.getSelectedBlocks()),ke={};return ve&&Object.assign(ke,Te.schema.getAttributesWithProperty(ve,"copyOnReplace",!0)),Te.change(Ie=>{xe.isCollapsed||Te.deleteContent(xe,{doNotAutoparagraph:!0});let Ae=we;const Se=xe.anchor.parent;!Te.schema.checkChild(Se,we)&&Te.schema.checkChild(Se,"paragraph")&&Te.schema.checkChild("paragraph",we)&&(Ae=Ie.createElement("paragraph"),Ie.insert(we,Ae)),Te.schema.setAllowedAttributes(Ae,ke,Ie);const Oe=Te.insertContent(Ae,xe);return Oe.isCollapsed||te.setSelection&&updateSelection(Ie,we,te.setSelection,ke),Oe})}function updateSelection(Te,we,t,te){const be=Te.model;if(t=="on"){Te.setSelection(we,"on");return}if(t!="after")throw new CKEditorError("insertobject-invalid-place-parameter-value",be);let xe=we.nextSibling;if(be.schema.isInline(we)){Te.setSelection(we,"after");return}!(xe&&be.schema.checkChild(xe,"$text"))&&be.schema.checkChild(we.parent,"paragraph")&&(xe=Te.createElement("paragraph"),be.schema.setAllowedAttributes(xe,te,Te),be.insertContent(xe,Te.createPositionAfter(we))),xe&&Te.setSelection(xe,0)}const wordBoundaryCharacters=' ,.?!:;"-()';function modifySelection(Te,we,t={}){const te=Te.schema,be=t.direction!="backward",xe=t.unit?t.unit:"character",ve=!!t.treatEmojiAsSingleUnit,ke=we.focus,Ie=new TreeWalker({boundaries:getSearchRange(ke,be),singleCharacters:!0,direction:be?"forward":"backward"}),Ae={walker:Ie,schema:te,isForward:be,unit:xe,treatEmojiAsSingleUnit:ve};let Se;for(;Se=Ie.next();){if(Se.done)return;const Oe=tryExtendingTo(Ae,Se.value);if(Oe){we instanceof DocumentSelection?Te.change(Ve=>{Ve.setSelectionFocus(Oe)}):we.setFocus(Oe);return}}}function tryExtendingTo(Te,we){const{isForward:t,walker:te,unit:be,schema:xe,treatEmojiAsSingleUnit:ve}=Te,{type:ke,item:Ie,nextPosition:Ae}=we;if(ke=="text")return Te.unit==="word"?getCorrectWordBreakPosition(te,t):getCorrectPosition(te,be,ve);if(ke==(t?"elementStart":"elementEnd")){if(xe.isSelectable(Ie))return Position._createAt(Ie,t?"after":"before");if(xe.checkChild(Ae,"$text"))return Ae}else{if(xe.isLimit(Ie)){te.skip(()=>!0);return}if(xe.checkChild(Ae,"$text"))return Ae}}function getCorrectPosition(Te,we,t){const te=Te.position.textNode;if(te){const be=te.data;let xe=Te.position.offset-te.startOffset;for(;isInsideSurrogatePair(be,xe)||we=="character"&&isInsideCombinedSymbol(be,xe)||t&&isInsideEmojiSequence(be,xe);)Te.next(),xe=Te.position.offset-te.startOffset}return Te.position}function getCorrectWordBreakPosition(Te,we){let t=Te.position.textNode;for(t||(t=we?Te.position.nodeAfter:Te.position.nodeBefore);t&&t.is("$text");){const te=Te.position.offset-t.startOffset;if(isAtNodeBoundary(t,te,we))t=we?Te.position.nodeAfter:Te.position.nodeBefore;else{if(isAtWordBoundary(t.data,te,we))break;Te.next()}}return Te.position}function getSearchRange(Te,we){const t=Te.root,te=Position._createAt(t,we?"end":0);return we?new Range(Te,te):new Range(te,Te)}function isAtWordBoundary(Te,we,t){const te=we+(t?0:-1);return wordBoundaryCharacters.includes(Te.charAt(te))}function isAtNodeBoundary(Te,we,t){return we===(t?Te.offsetSize:0)}let Model$1=class extends ObservableMixin(){constructor(){super();Re(this,"markers");Re(this,"document");Re(this,"schema");Re(this,"_pendingChanges");Re(this,"_currentWriter");this.markers=new MarkerCollection,this.document=new Document(this),this.schema=new Schema,this._pendingChanges=[],this._currentWriter=null,["deleteContent","modifySelection","getSelectedContent","applyOperation"].forEach(t=>this.decorate(t)),this.on("applyOperation",(t,te)=>{te[0]._validate()},{priority:"highest"}),this.schema.register("$root",{isLimit:!0}),this.schema.register("$container",{allowIn:["$root","$container"]}),this.schema.register("$block",{allowIn:["$root","$container"],isBlock:!0}),this.schema.register("$blockObject",{allowWhere:"$block",isBlock:!0,isObject:!0}),this.schema.register("$inlineObject",{allowWhere:"$text",allowAttributesOf:"$text",isInline:!0,isObject:!0}),this.schema.register("$text",{allowIn:"$block",isInline:!0,isContent:!0}),this.schema.register("$clipboardHolder",{allowContentOf:"$root",allowChildren:"$text",isLimit:!0}),this.schema.register("$documentFragment",{allowContentOf:"$root",allowChildren:"$text",isLimit:!0}),this.schema.register("$marker"),this.schema.addChildCheck((t,te)=>{if(te.name==="$marker")return!0}),injectSelectionPostFixer$1(this),this.document.registerPostFixer(autoParagraphEmptyRoots),this.on("insertContent",(t,[te,be])=>{t.return=insertContent(this,te,be)}),this.on("insertObject",(t,[te,be,xe])=>{t.return=insertObject(this,te,be,xe)}),this.on("canEditAt",t=>{const te=!this.document.isReadOnly;t.return=te,te||t.stop()})}change(t){try{return this._pendingChanges.length===0?(this._pendingChanges.push({batch:new Batch,callback:t}),this._runPendingChanges()[0]):t(this._currentWriter)}catch(te){/* istanbul ignore next -- @preserve */CKEditorError.rethrowUnexpectedError(te,this)}}enqueueChange(t,te){try{t?typeof t=="function"?(te=t,t=new Batch):t instanceof Batch||(t=new Batch(t)):t=new Batch,this._pendingChanges.push({batch:t,callback:te}),this._pendingChanges.length==1&&this._runPendingChanges()}catch(be){/* istanbul ignore next -- @preserve */CKEditorError.rethrowUnexpectedError(be,this)}}applyOperation(t){t._execute()}insertContent(t,te,be,...xe){const ve=normalizeSelectable(te,be);return this.fire("insertContent",[t,ve,be,...xe])}insertObject(t,te,be,xe,...ve){const ke=normalizeSelectable(te,be);return this.fire("insertObject",[t,ke,xe,xe,...ve])}deleteContent(t,te){deleteContent(this,t,te)}modifySelection(t,te){modifySelection(this,t,te)}getSelectedContent(t){return getSelectedContent(this,t)}hasContent(t,te={}){const be=t instanceof Range?t:Range._createIn(t);if(be.isCollapsed)return!1;const{ignoreWhitespaces:xe=!1,ignoreMarkers:ve=!1}=te;if(!ve){for(const ke of this.markers.getMarkersIntersectingRange(be))if(ke.affectsData)return!0}for(const ke of be.getItems())if(this.schema.isContent(ke))if(ke.is("$textProxy"))if(xe){if(ke.data.search(/\S/)!==-1)return!0}else return!0;else return!0;return!1}canEditAt(t){const te=normalizeSelectable(t);return this.fire("canEditAt",[te])}createPositionFromPath(t,te,be){return new Position(t,te,be)}createPositionAt(t,te){return Position._createAt(t,te)}createPositionAfter(t){return Position._createAfter(t)}createPositionBefore(t){return Position._createBefore(t)}createRange(t,te){return new Range(t,te)}createRangeIn(t){return Range._createIn(t)}createRangeOn(t){return Range._createOn(t)}createSelection(...t){return new Selection(...t)}createBatch(t){return new Batch(t)}createOperationFromJSON(t){return OperationFactory.fromJSON(t,this.document)}destroy(){this.document.destroy(),this.stopListening()}_runPendingChanges(){const t=[];this.fire("_beforeChanges");try{for(;this._pendingChanges.length;){const te=this._pendingChanges[0].batch;this._currentWriter=new Writer$2(this,te);const be=this._pendingChanges[0].callback(this._currentWriter);t.push(be),this.document._handleChangeBlock(this._currentWriter),this._pendingChanges.shift(),this._currentWriter=null}}finally{this._pendingChanges.length=0,this._currentWriter=null,this.fire("_afterChanges")}return t}};function normalizeSelectable(Te,we){if(Te)return Te instanceof Selection||Te instanceof DocumentSelection?Te:Te instanceof Node$1?we||we===0?new Selection(Te,we):Te.is("rootElement")?new Selection(Te,"in"):new Selection(Te,"on"):new Selection(Te)}class ClickObserver extends DomEventObserver{constructor(){super(...arguments);Re(this,"domEventType","click")}onDomEvent(t){this.fire(t.type,t)}}class MouseObserver extends DomEventObserver{constructor(){super(...arguments);Re(this,"domEventType",["mousedown","mouseup","mouseover","mouseout"])}onDomEvent(t){this.fire(t.type,t)}}class UpcastWriter{constructor(we){Re(this,"document");this.document=we}createDocumentFragment(we){return new DocumentFragment$1(this.document,we)}createElement(we,t,te){return new Element$1(this.document,we,t,te)}createText(we){return new Text$1(this.document,we)}clone(we,t=!1){return we._clone(t)}appendChild(we,t){return t._appendChild(we)}insertChild(we,t,te){return te._insertChild(we,t)}removeChildren(we,t,te){return te._removeChildren(we,t)}remove(we){const t=we.parent;return t?this.removeChildren(t.getChildIndex(we),1,t):[]}replace(we,t){const te=we.parent;if(te){const be=te.getChildIndex(we);return this.removeChildren(be,1,te),this.insertChild(be,t,te),!0}return!1}unwrapElement(we){const t=we.parent;if(t){const te=t.getChildIndex(we);this.remove(we),this.insertChild(te,we.getChildren(),t)}}rename(we,t){const te=new Element$1(this.document,we,t.getAttributes(),t.getChildren());return this.replace(t,te)?te:null}setAttribute(we,t,te){te._setAttribute(we,t)}removeAttribute(we,t){t._removeAttribute(we)}addClass(we,t){t._addClass(we)}removeClass(we,t){t._removeClass(we)}setStyle(we,t,te){isPlainObject(we)&&te===void 0?t._setStyle(we):te._setStyle(we,t)}removeStyle(we,t){t._removeStyle(we)}setCustomProperty(we,t,te){te._setCustomProperty(we,t)}removeCustomProperty(we,t){return t._removeCustomProperty(we)}createPositionAt(we,t){return Position$1._createAt(we,t)}createPositionAfter(we){return Position$1._createAfter(we)}createPositionBefore(we){return Position$1._createBefore(we)}createRange(we,t){return new Range$1(we,t)}createRangeOn(we){return Range$1._createOn(we)}createRangeIn(we){return Range$1._createIn(we)}createSelection(...we){return new Selection$1(...we)}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const HEX_COLOR_REGEXP=/^#([0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/i,RGB_COLOR_REGEXP=/^rgb\([ ]?([0-9]{1,3}[ %]?,[ ]?){2,3}[0-9]{1,3}[ %]?\)$/i,RGBA_COLOR_REGEXP=/^rgba\([ ]?([0-9]{1,3}[ %]?,[ ]?){3}(1|[0-9]+%|[0]?\.?[0-9]+)\)$/i,HSL_COLOR_REGEXP=/^hsl\([ ]?([0-9]{1,3}[ %]?[,]?[ ]*){3}(1|[0-9]+%|[0]?\.?[0-9]+)?\)$/i,HSLA_COLOR_REGEXP=/^hsla\([ ]?([0-9]{1,3}[ %]?,[ ]?){2,3}(1|[0-9]+%|[0]?\.?[0-9]+)\)$/i,CSS_SHORTHAND_VALUE_REGEXP=/\w+\((?:[^()]|\([^()]*\))*\)|\S+/gi,COLOR_NAMES=new Set(["black","silver","gray","white","maroon","red","purple","fuchsia","green","lime","olive","yellow","navy","blue","teal","aqua","orange","aliceblue","antiquewhite","aquamarine","azure","beige","bisque","blanchedalmond","blueviolet","brown","burlywood","cadetblue","chartreuse","chocolate","coral","cornflowerblue","cornsilk","crimson","cyan","darkblue","darkcyan","darkgoldenrod","darkgray","darkgreen","darkgrey","darkkhaki","darkmagenta","darkolivegreen","darkorange","darkorchid","darkred","darksalmon","darkseagreen","darkslateblue","darkslategray","darkslategrey","darkturquoise","darkviolet","deeppink","deepskyblue","dimgray","dimgrey","dodgerblue","firebrick","floralwhite","forestgreen","gainsboro","ghostwhite","gold","goldenrod","greenyellow","grey","honeydew","hotpink","indianred","indigo","ivory","khaki","lavender","lavenderblush","lawngreen","lemonchiffon","lightblue","lightcoral","lightcyan","lightgoldenrodyellow","lightgray","lightgreen","lightgrey","lightpink","lightsalmon","lightseagreen","lightskyblue","lightslategray","lightslategrey","lightsteelblue","lightyellow","limegreen","linen","magenta","mediumaquamarine","mediumblue","mediumorchid","mediumpurple","mediumseagreen","mediumslateblue","mediumspringgreen","mediumturquoise","mediumvioletred","midnightblue","mintcream","mistyrose","moccasin","navajowhite","oldlace","olivedrab","orangered","orchid","palegoldenrod","palegreen","paleturquoise","palevioletred","papayawhip","peachpuff","peru","pink","plum","powderblue","rosybrown","royalblue","saddlebrown","salmon","sandybrown","seagreen","seashell","sienna","skyblue","slateblue","slategray","slategrey","snow","springgreen","steelblue","tan","thistle","tomato","turquoise","violet","wheat","whitesmoke","yellowgreen","activeborder","activecaption","appworkspace","background","buttonface","buttonhighlight","buttonshadow","buttontext","captiontext","graytext","highlight","highlighttext","inactiveborder","inactivecaption","inactivecaptiontext","infobackground","infotext","menu","menutext","scrollbar","threeddarkshadow","threedface","threedhighlight","threedlightshadow","threedshadow","window","windowframe","windowtext","rebeccapurple","currentcolor","transparent"]);function isColor(Te){return Te.startsWith("#")?HEX_COLOR_REGEXP.test(Te):Te.startsWith("rgb")?RGB_COLOR_REGEXP.test(Te)||RGBA_COLOR_REGEXP.test(Te):Te.startsWith("hsl")?HSL_COLOR_REGEXP.test(Te)||HSLA_COLOR_REGEXP.test(Te):COLOR_NAMES.has(Te.toLowerCase())}const lineStyleValues=["none","hidden","dotted","dashed","solid","double","groove","ridge","inset","outset"];function isLineStyle(Te){return lineStyleValues.includes(Te)}const lengthRegExp=/^([+-]?[0-9]*([.][0-9]+)?(px|cm|mm|in|pc|pt|ch|em|ex|rem|vh|vw|vmin|vmax)|0)$/;function isLength(Te){return lengthRegExp.test(Te)}const PERCENTAGE_VALUE_REGEXP=/^[+-]?[0-9]*([.][0-9]+)?%$/;function isPercentage(Te){return PERCENTAGE_VALUE_REGEXP.test(Te)}const repeatValues=["repeat-x","repeat-y","repeat","space","round","no-repeat"];function isRepeat(Te){return repeatValues.includes(Te)}const positionValues=["center","top","bottom","left","right"];function isPosition(Te){return positionValues.includes(Te)}const attachmentValues=["fixed","scroll","local"];function isAttachment(Te){return attachmentValues.includes(Te)}const urlRegExp=/^url\(/;function isURL(Te){return urlRegExp.test(Te)}function getBoxSidesValues(Te=""){if(Te==="")return{top:void 0,right:void 0,bottom:void 0,left:void 0};const we=getShorthandValues(Te),t=we[0],te=we[2]||t,be=we[1]||t,xe=we[3]||be;return{top:t,bottom:te,right:be,left:xe}}function getBoxSidesValueReducer(Te){return we=>{const{top:t,right:te,bottom:be,left:xe}=we,ve=[];return[t,te,xe,be].every(ke=>!!ke)?ve.push([Te,getBoxSidesShorthandValue(we)]):(t&&ve.push([Te+"-top",t]),te&&ve.push([Te+"-right",te]),be&&ve.push([Te+"-bottom",be]),xe&&ve.push([Te+"-left",xe])),ve}}function getBoxSidesShorthandValue({top:Te,right:we,bottom:t,left:te}){const be=[];return te!==we?be.push(Te,we,t,te):t!==Te?be.push(Te,we,t):we!==Te?be.push(Te,we):be.push(Te),be.join(" ")}function getPositionShorthandNormalizer(Te){return we=>({path:Te,value:getBoxSidesValues(we)})}function getShorthandValues(Te){const we=Te.matchAll(CSS_SHORTHAND_VALUE_REGEXP);return Array.from(we).map(t=>t[0])}function addBackgroundRules(Te){Te.setNormalizer("background",getBackgroundNormalizer()),Te.setNormalizer("background-color",getBackgroundColorNormalizer()),Te.setReducer("background",getBackgroundReducer()),Te.setStyleRelation("background",["background-color"])}function getBackgroundNormalizer(){return Te=>{const we={},t=getShorthandValues(Te);for(const te of t)isRepeat(te)?(we.repeat=we.repeat||[],we.repeat.push(te)):isPosition(te)?(we.position=we.position||[],we.position.push(te)):isAttachment(te)?we.attachment=te:isColor(te)?we.color=te:isURL(te)&&(we.image=te);return{path:"background",value:we}}}function getBackgroundColorNormalizer(){return Te=>({path:"background.color",value:Te})}function getBackgroundReducer(){return Te=>{const we=[];return we.push(["background-color",Te.color]),we}}function addBorderRules(Te){Te.setNormalizer("border",getBorderNormalizer()),Te.setNormalizer("border-top",getBorderPositionNormalizer("top")),Te.setNormalizer("border-right",getBorderPositionNormalizer("right")),Te.setNormalizer("border-bottom",getBorderPositionNormalizer("bottom")),Te.setNormalizer("border-left",getBorderPositionNormalizer("left")),Te.setNormalizer("border-color",getBorderPropertyNormalizer("color")),Te.setNormalizer("border-width",getBorderPropertyNormalizer("width")),Te.setNormalizer("border-style",getBorderPropertyNormalizer("style")),Te.setNormalizer("border-top-color",getBorderPropertyPositionNormalizer("color","top")),Te.setNormalizer("border-top-style",getBorderPropertyPositionNormalizer("style","top")),Te.setNormalizer("border-top-width",getBorderPropertyPositionNormalizer("width","top")),Te.setNormalizer("border-right-color",getBorderPropertyPositionNormalizer("color","right")),Te.setNormalizer("border-right-style",getBorderPropertyPositionNormalizer("style","right")),Te.setNormalizer("border-right-width",getBorderPropertyPositionNormalizer("width","right")),Te.setNormalizer("border-bottom-color",getBorderPropertyPositionNormalizer("color","bottom")),Te.setNormalizer("border-bottom-style",getBorderPropertyPositionNormalizer("style","bottom")),Te.setNormalizer("border-bottom-width",getBorderPropertyPositionNormalizer("width","bottom")),Te.setNormalizer("border-left-color",getBorderPropertyPositionNormalizer("color","left")),Te.setNormalizer("border-left-style",getBorderPropertyPositionNormalizer("style","left")),Te.setNormalizer("border-left-width",getBorderPropertyPositionNormalizer("width","left")),Te.setExtractor("border-top",getBorderPositionExtractor("top")),Te.setExtractor("border-right",getBorderPositionExtractor("right")),Te.setExtractor("border-bottom",getBorderPositionExtractor("bottom")),Te.setExtractor("border-left",getBorderPositionExtractor("left")),Te.setExtractor("border-top-color","border.color.top"),Te.setExtractor("border-right-color","border.color.right"),Te.setExtractor("border-bottom-color","border.color.bottom"),Te.setExtractor("border-left-color","border.color.left"),Te.setExtractor("border-top-width","border.width.top"),Te.setExtractor("border-right-width","border.width.right"),Te.setExtractor("border-bottom-width","border.width.bottom"),Te.setExtractor("border-left-width","border.width.left"),Te.setExtractor("border-top-style","border.style.top"),Te.setExtractor("border-right-style","border.style.right"),Te.setExtractor("border-bottom-style","border.style.bottom"),Te.setExtractor("border-left-style","border.style.left"),Te.setReducer("border-color",getBoxSidesValueReducer("border-color")),Te.setReducer("border-style",getBoxSidesValueReducer("border-style")),Te.setReducer("border-width",getBoxSidesValueReducer("border-width")),Te.setReducer("border-top",getBorderPositionReducer("top")),Te.setReducer("border-right",getBorderPositionReducer("right")),Te.setReducer("border-bottom",getBorderPositionReducer("bottom")),Te.setReducer("border-left",getBorderPositionReducer("left")),Te.setReducer("border",getBorderReducer()),Te.setStyleRelation("border",["border-color","border-style","border-width","border-top","border-right","border-bottom","border-left","border-top-color","border-right-color","border-bottom-color","border-left-color","border-top-style","border-right-style","border-bottom-style","border-left-style","border-top-width","border-right-width","border-bottom-width","border-left-width"]),Te.setStyleRelation("border-color",["border-top-color","border-right-color","border-bottom-color","border-left-color"]),Te.setStyleRelation("border-style",["border-top-style","border-right-style","border-bottom-style","border-left-style"]),Te.setStyleRelation("border-width",["border-top-width","border-right-width","border-bottom-width","border-left-width"]),Te.setStyleRelation("border-top",["border-top-color","border-top-style","border-top-width"]),Te.setStyleRelation("border-right",["border-right-color","border-right-style","border-right-width"]),Te.setStyleRelation("border-bottom",["border-bottom-color","border-bottom-style","border-bottom-width"]),Te.setStyleRelation("border-left",["border-left-color","border-left-style","border-left-width"])}function getBorderNormalizer(){return Te=>{const{color:we,style:t,width:te}=normalizeBorderShorthand(Te);return{path:"border",value:{color:getBoxSidesValues(we),style:getBoxSidesValues(t),width:getBoxSidesValues(te)}}}}function getBorderPositionNormalizer(Te){return we=>{const{color:t,style:te,width:be}=normalizeBorderShorthand(we),xe={};return t!==void 0&&(xe.color={[Te]:t}),te!==void 0&&(xe.style={[Te]:te}),be!==void 0&&(xe.width={[Te]:be}),{path:"border",value:xe}}}function getBorderPropertyNormalizer(Te){return we=>({path:"border",value:toBorderPropertyShorthand(we,Te)})}function toBorderPropertyShorthand(Te,we){return{[we]:getBoxSidesValues(Te)}}function getBorderPropertyPositionNormalizer(Te,we){return t=>({path:"border",value:{[Te]:{[we]:t}}})}function getBorderPositionExtractor(Te){return(we,t)=>{if(t.border)return extractBorderPosition(t.border,Te)}}function extractBorderPosition(Te,we){const t={};return Te.width&&Te.width[we]&&(t.width=Te.width[we]),Te.style&&Te.style[we]&&(t.style=Te.style[we]),Te.color&&Te.color[we]&&(t.color=Te.color[we]),t}function normalizeBorderShorthand(Te){const we={},t=getShorthandValues(Te);for(const te of t)isLength(te)||/thin|medium|thick/.test(te)?we.width=te:isLineStyle(te)?we.style=te:we.color=te;return we}function getBorderReducer(){return we=>{const t=extractBorderPosition(we,"top"),te=extractBorderPosition(we,"right"),be=extractBorderPosition(we,"bottom"),xe=extractBorderPosition(we,"left"),ve=[t,te,be,xe],ke={width:Te(ve,"width"),style:Te(ve,"style"),color:Te(ve,"color")},Ie=reduceBorderPosition(ke,"all");return Ie.length?Ie:[...Object.entries(ke).reduce((Se,[Oe,Ve])=>(Ve&&(Se.push([`border-${Oe}`,Ve]),ve.forEach(Me=>delete Me[Oe])),Se),[]),...reduceBorderPosition(t,"top"),...reduceBorderPosition(te,"right"),...reduceBorderPosition(be,"bottom"),...reduceBorderPosition(xe,"left")]};function Te(we,t){return we.map(te=>te[t]).reduce((te,be)=>te==be?te:null)}}function getBorderPositionReducer(Te){return we=>reduceBorderPosition(we,Te)}function reduceBorderPosition(Te,we){const t=[];if(Te&&Te.width&&t.push("width"),Te&&Te.style&&t.push("style"),Te&&Te.color&&t.push("color"),t.length==3){const te=t.map(be=>Te[be]).join(" ");return[we=="all"?["border",te]:[`border-${we}`,te]]}return we=="all"?[]:t.map(te=>[`border-${we}-${te}`,Te[te]])}function addMarginRules(Te){Te.setNormalizer("margin",getPositionShorthandNormalizer("margin")),Te.setNormalizer("margin-top",we=>({path:"margin.top",value:we})),Te.setNormalizer("margin-right",we=>({path:"margin.right",value:we})),Te.setNormalizer("margin-bottom",we=>({path:"margin.bottom",value:we})),Te.setNormalizer("margin-left",we=>({path:"margin.left",value:we})),Te.setReducer("margin",getBoxSidesValueReducer("margin")),Te.setStyleRelation("margin",["margin-top","margin-right","margin-bottom","margin-left"])}function addPaddingRules(Te){Te.setNormalizer("padding",getPositionShorthandNormalizer("padding")),Te.setNormalizer("padding-top",we=>({path:"padding.top",value:we})),Te.setNormalizer("padding-right",we=>({path:"padding.right",value:we})),Te.setNormalizer("padding-bottom",we=>({path:"padding.bottom",value:we})),Te.setNormalizer("padding-left",we=>({path:"padding.left",value:we})),Te.setReducer("padding",getBoxSidesValueReducer("padding")),Te.setStyleRelation("padding",["padding-top","padding-right","padding-bottom","padding-left"])}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 *//**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Watchdog{constructor(we){Re(this,"crashes",[]);Re(this,"state","initializing");Re(this,"_crashNumberLimit");Re(this,"_now",Date.now);Re(this,"_minimumNonErrorTimePeriod");Re(this,"_boundErrorHandler");Re(this,"_listeners");if(this.crashes=[],this._crashNumberLimit=typeof we.crashNumberLimit=="number"?we.crashNumberLimit:3,this._minimumNonErrorTimePeriod=typeof we.minimumNonErrorTimePeriod=="number"?we.minimumNonErrorTimePeriod:5e3,this._boundErrorHandler=t=>{const te="error"in t?t.error:t.reason;te instanceof Error&&this._handleError(te,t)},this._listeners={},!this._restart)throw new Error("The Watchdog class was split into the abstract `Watchdog` class and the `EditorWatchdog` class. Please, use `EditorWatchdog` if you have used the `Watchdog` class previously.")}destroy(){this._stopErrorHandling(),this._listeners={}}on(we,t){this._listeners[we]||(this._listeners[we]=[]),this._listeners[we].push(t)}off(we,t){this._listeners[we]=this._listeners[we].filter(te=>te!==t)}_fire(we,...t){const te=this._listeners[we]||[];for(const be of te)be.apply(this,[null,...t])}_startErrorHandling(){window.addEventListener("error",this._boundErrorHandler),window.addEventListener("unhandledrejection",this._boundErrorHandler)}_stopErrorHandling(){window.removeEventListener("error",this._boundErrorHandler),window.removeEventListener("unhandledrejection",this._boundErrorHandler)}_handleError(we,t){if(this._shouldReactToError(we)){this.crashes.push({message:we.message,stack:we.stack,filename:t instanceof ErrorEvent?t.filename:void 0,lineno:t instanceof ErrorEvent?t.lineno:void 0,colno:t instanceof ErrorEvent?t.colno:void 0,date:this._now()});const te=this._shouldRestart();this.state="crashed",this._fire("stateChange"),this._fire("error",{error:we,causesRestart:te}),te?this._restart():(this.state="crashedPermanently",this._fire("stateChange"))}}_shouldReactToError(we){return we.is&&we.is("CKEditorError")&&we.context!==void 0&&we.context!==null&&this.state==="ready"&&this._isErrorComingFromThisItem(we)}_shouldRestart(){if(this.crashes.length<=this._crashNumberLimit)return!0;const we=this.crashes[this.crashes.length-1].date,t=this.crashes[this.crashes.length-1-this._crashNumberLimit].date;return(we-t)/this._crashNumberLimit>this._minimumNonErrorTimePeriod}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function getSubNodes(Te,we=new Set){const t=[Te],te=new Set;let be=0;for(;t.length>be;){const xe=t[be++];if(!(te.has(xe)||!shouldNodeBeIncluded(xe)||we.has(xe)))if(te.add(xe),Symbol.iterator in xe)try{for(const ve of xe)t.push(ve)}catch{}else for(const ve in xe)ve!=="defaultValue"&&t.push(xe[ve])}return te}function shouldNodeBeIncluded(Te){const we=Object.prototype.toString.call(Te),t=typeof Te;return!(t==="number"||t==="boolean"||t==="string"||t==="symbol"||t==="function"||we==="[object Date]"||we==="[object RegExp]"||we==="[object Module]"||Te===void 0||Te===null||Te._watchdogExcluded||Te instanceof EventTarget||Te instanceof Event)}function areConnectedThroughProperties(Te,we,t=new Set){if(Te===we&&isObject$1(Te))return!0;const te=getSubNodes(Te,t),be=getSubNodes(we,t);for(const xe of te)if(be.has(xe))return!0;return!1}function isObject$1(Te){return typeof Te=="object"&&Te!==null}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class EditorWatchdog extends Watchdog{constructor(t,te={}){super(te);Re(this,"_editor",null);Re(this,"_lifecyclePromise",null);Re(this,"_throttledSave");Re(this,"_data");Re(this,"_lastDocumentVersion");Re(this,"_elementOrData");Re(this,"_initUsingData",!0);Re(this,"_editables",{});Re(this,"_config");Re(this,"_excludedProps");this._throttledSave=throttle(this._save.bind(this),typeof te.saveInterval=="number"?te.saveInterval:5e3),t&&(this._creator=(be,xe)=>t.create(be,xe)),this._destructor=be=>be.destroy()}get editor(){return this._editor}get _item(){return this._editor}setCreator(t){this._creator=t}setDestructor(t){this._destructor=t}_restart(){return Promise.resolve().then(()=>(this.state="initializing",this._fire("stateChange"),this._destroy())).catch(t=>{console.error("An error happened during the editor destroying.",t)}).then(()=>{const t={},te=[],be=this._config.rootsAttributes||{},xe={};for(const[ke,Ie]of Object.entries(this._data.roots))Ie.isLoaded?(t[ke]="",xe[ke]=be[ke]||{}):te.push(ke);const ve={...this._config,extraPlugins:this._config.extraPlugins||[],lazyRoots:te,rootsAttributes:xe,_watchdogInitialData:this._data};return delete ve.initialData,ve.extraPlugins.push(EditorWatchdogInitPlugin),this._initUsingData?this.create(t,ve,ve.context):isElement$1(this._elementOrData)?this.create(this._elementOrData,ve,ve.context):this.create(this._editables,ve,ve.context)}).then(()=>{this._fire("restart")})}create(t=this._elementOrData,te=this._config,be){return this._lifecyclePromise=Promise.resolve(this._lifecyclePromise).then(()=>(super._startErrorHandling(),this._elementOrData=t,this._initUsingData=typeof t=="string"||Object.keys(t).length>0&&typeof Object.values(t)[0]=="string",this._config=this._cloneEditorConfiguration(te)||{},this._config.context=be,this._creator(t,this._config))).then(xe=>{this._editor=xe,xe.model.document.on("change:data",this._throttledSave),this._lastDocumentVersion=xe.model.document.version,this._data=this._getData(),this._initUsingData||(this._editables=this._getEditables()),this.state="ready",this._fire("stateChange")}).finally(()=>{this._lifecyclePromise=null}),this._lifecyclePromise}destroy(){return this._lifecyclePromise=Promise.resolve(this._lifecyclePromise).then(()=>(this.state="destroyed",this._fire("stateChange"),super.destroy(),this._destroy())).finally(()=>{this._lifecyclePromise=null}),this._lifecyclePromise}_destroy(){return Promise.resolve().then(()=>{this._stopErrorHandling(),this._throttledSave.cancel();const t=this._editor;return this._editor=null,t.model.document.off("change:data",this._throttledSave),this._destructor(t)})}_save(){const t=this._editor.model.document.version;try{this._data=this._getData(),this._initUsingData||(this._editables=this._getEditables()),this._lastDocumentVersion=t}catch(te){console.error(te,"An error happened during restoring editor data. Editor will be restored from the previously saved data.")}}_setExcludedProperties(t){this._excludedProps=t}_getData(){const t=this._editor,te=t.model.document.roots.filter(Ie=>Ie.isAttached()&&Ie.rootName!="$graveyard"),{plugins:be}=t,xe=be.has("CommentsRepository")&&be.get("CommentsRepository"),ve=be.has("TrackChanges")&&be.get("TrackChanges"),ke={roots:{},markers:{},commentThreads:JSON.stringify([]),suggestions:JSON.stringify([])};te.forEach(Ie=>{ke.roots[Ie.rootName]={content:JSON.stringify(Array.from(Ie.getChildren())),attributes:JSON.stringify(Array.from(Ie.getAttributes())),isLoaded:Ie._isLoaded}});for(const Ie of t.model.markers)Ie._affectsData&&(ke.markers[Ie.name]={rangeJSON:Ie.getRange().toJSON(),usingOperation:Ie._managedUsingOperations,affectsData:Ie._affectsData});return xe&&(ke.commentThreads=JSON.stringify(xe.getCommentThreads({toJSON:!0,skipNotAttached:!0}))),ve&&(ke.suggestions=JSON.stringify(ve.getSuggestions({toJSON:!0,skipNotAttached:!0}))),ke}_getEditables(){const t={};for(const te of this.editor.model.document.getRootNames()){const be=this.editor.ui.getEditableElement(te);be&&(t[te]=be)}return t}_isErrorComingFromThisItem(t){return areConnectedThroughProperties(this._editor,t.context,this._excludedProps)}_cloneEditorConfiguration(t){return cloneDeepWith(t,(te,be)=>{if(isElement$1(te)||be==="context")return te})}}class EditorWatchdogInitPlugin{constructor(we){Re(this,"editor");Re(this,"_data");this.editor=we,this._data=we.config.get("_watchdogInitialData")}init(){this.editor.data.on("init",we=>{we.stop(),this.editor.model.enqueueChange({isUndoable:!1},t=>{this._restoreCollaborationData(),this._restoreEditorData(t)}),this.editor.data.fire("ready")},{priority:999})}_createNode(we,t){if("name"in t){const te=we.createElement(t.name,t.attributes);if(t.children)for(const be of t.children)te._appendChild(this._createNode(we,be));return te}else return we.createText(t.data,t.attributes)}_restoreEditorData(we){const t=this.editor;Object.entries(this._data.roots).forEach(([te,{content:be,attributes:xe}])=>{const ve=JSON.parse(be),ke=JSON.parse(xe),Ie=t.model.document.getRoot(te);for(const[Ae,Se]of ke)we.setAttribute(Ae,Se,Ie);for(const Ae of ve){const Se=this._createNode(we,Ae);we.insert(Se,Ie,"end")}}),Object.entries(this._data.markers).forEach(([te,be])=>{const{document:xe}=t.model,{rangeJSON:{start:ve,end:ke},...Ie}=be,Ae=xe.getRoot(ve.root),Se=we.createPositionFromPath(Ae,ve.path,ve.stickiness),Oe=we.createPositionFromPath(Ae,ke.path,ke.stickiness),Ve=we.createRange(Se,Oe);we.addMarker(te,{range:Ve,...Ie})})}_restoreCollaborationData(){const we=JSON.parse(this._data.commentThreads),t=JSON.parse(this._data.suggestions);we.forEach(te=>{const be=this.editor.config.get("collaboration.channelId"),xe=this.editor.plugins.get("CommentsRepository");xe.hasCommentThread(te.threadId)&&xe.getCommentThread(te.threadId).remove(),xe.addCommentThread({channelId:be,...te})}),t.forEach(te=>{const be=this.editor.plugins.get("TrackChangesEditing");if(be.hasSuggestion(te.id)){const xe=be.getSuggestion(te.id);xe.attributes=te.attributes}else be.addSuggestionData(te)})}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const mainQueueId=Symbol("MainQueueId");class ContextWatchdog extends Watchdog{constructor(t,te={}){super(te);Re(this,"_watchdogs",new Map);Re(this,"_watchdogConfig");Re(this,"_context",null);Re(this,"_contextProps",new Set);Re(this,"_actionQueues",new ActionQueues);Re(this,"_contextConfig");Re(this,"_item");this._watchdogConfig=te,this._creator=be=>t.create(be),this._destructor=be=>be.destroy(),this._actionQueues.onEmpty(()=>{this.state==="initializing"&&(this.state="ready",this._fire("stateChange"))})}setCreator(t){this._creator=t}setDestructor(t){this._destructor=t}get context(){return this._context}create(t={}){return this._actionQueues.enqueue(mainQueueId,()=>(this._contextConfig=t,this._create()))}getItem(t){return this._getWatchdog(t)._item}getItemState(t){return this._getWatchdog(t).state}add(t){const te=toArray$1(t);return Promise.all(te.map(be=>this._actionQueues.enqueue(be.id,()=>{if(this.state==="destroyed")throw new Error("Cannot add items to destroyed watchdog.");if(!this._context)throw new Error("Context was not created yet. You should call the `ContextWatchdog#create()` method first.");let xe;if(this._watchdogs.has(be.id))throw new Error(`Item with the given id is already added: '${be.id}'.`);if(be.type==="editor")return xe=new EditorWatchdog(null,this._watchdogConfig),xe.setCreator(be.creator),xe._setExcludedProperties(this._contextProps),be.destructor&&xe.setDestructor(be.destructor),this._watchdogs.set(be.id,xe),xe.on("error",(ve,{error:ke,causesRestart:Ie})=>{this._fire("itemError",{itemId:be.id,error:ke}),Ie&&this._actionQueues.enqueue(be.id,()=>new Promise(Ae=>{const Se=()=>{xe.off("restart",Se),this._fire("itemRestart",{itemId:be.id}),Ae()};xe.on("restart",Se)}))}),xe.create(be.sourceElementOrData,be.config,this._context);throw new Error(`Not supported item type: '${be.type}'.`)})))}remove(t){const te=toArray$1(t);return Promise.all(te.map(be=>this._actionQueues.enqueue(be,()=>{const xe=this._getWatchdog(be);return this._watchdogs.delete(be),xe.destroy()})))}destroy(){return this._actionQueues.enqueue(mainQueueId,()=>(this.state="destroyed",this._fire("stateChange"),super.destroy(),this._destroy()))}_restart(){return this._actionQueues.enqueue(mainQueueId,()=>(this.state="initializing",this._fire("stateChange"),this._destroy().catch(t=>{console.error("An error happened during destroying the context or items.",t)}).then(()=>this._create()).then(()=>this._fire("restart"))))}_create(){return Promise.resolve().then(()=>(this._startErrorHandling(),this._creator(this._contextConfig))).then(t=>(this._context=t,this._contextProps=getSubNodes(this._context),Promise.all(Array.from(this._watchdogs.values()).map(te=>(te._setExcludedProperties(this._contextProps),te.create(void 0,void 0,this._context))))))}_destroy(){return Promise.resolve().then(()=>{this._stopErrorHandling();const t=this._context;return this._context=null,this._contextProps=new Set,Promise.all(Array.from(this._watchdogs.values()).map(te=>te.destroy())).then(()=>this._destructor(t))})}_getWatchdog(t){const te=this._watchdogs.get(t);if(!te)throw new Error(`Item with the given id was not registered: ${t}.`);return te}_isErrorComingFromThisItem(t){for(const te of this._watchdogs.values())if(te._isErrorComingFromThisItem(t))return!1;return areConnectedThroughProperties(this._context,t.context)}}class ActionQueues{constructor(){Re(this,"_onEmptyCallbacks",[]);Re(this,"_queues",new Map);Re(this,"_activeActions",0)}onEmpty(we){this._onEmptyCallbacks.push(we)}enqueue(we,t){const te=we===mainQueueId;this._activeActions++,this._queues.get(we)||this._queues.set(we,Promise.resolve());const xe=(te?Promise.all(this._queues.values()):Promise.all([this._queues.get(mainQueueId),this._queues.get(we)])).then(t),ve=xe.catch(()=>{});return this._queues.set(we,ve),xe.finally(()=>{this._activeActions--,this._queues.get(we)===ve&&this._activeActions===0&&this._onEmptyCallbacks.forEach(ke=>ke())})}}function toArray$1(Te){return Array.isArray(Te)?Te:[Te]}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Plugin extends ObservableMixin(){constructor(t){super();Re(this,"editor");Re(this,"_disableStack",new Set);this.editor=t,this.set("isEnabled",!0)}forceDisabled(t){this._disableStack.add(t),this._disableStack.size==1&&(this.on("set:isEnabled",forceDisable$1,{priority:"highest"}),this.isEnabled=!1)}clearForceDisabled(t){this._disableStack.delete(t),this._disableStack.size==0&&(this.off("set:isEnabled",forceDisable$1),this.isEnabled=!0)}destroy(){this.stopListening()}static get isContextPlugin(){return!1}}function forceDisable$1(Te){Te.return=!1,Te.stop()}class Command extends ObservableMixin(){constructor(t){super();Re(this,"editor");Re(this,"_isEnabledBasedOnSelection");Re(this,"_affectsData");Re(this,"_disableStack");this.editor=t,this.set("value",void 0),this.set("isEnabled",!1),this._affectsData=!0,this._isEnabledBasedOnSelection=!0,this._disableStack=new Set,this.decorate("execute"),this.listenTo(this.editor.model.document,"change",()=>{this.refresh()}),this.listenTo(t,"change:isReadOnly",()=>{this.refresh()}),this.on("set:isEnabled",te=>{if(!this.affectsData)return;const be=t.model.document.selection,ve=!(be.getFirstPosition().root.rootName=="$graveyard")&&t.model.canEditAt(be);(t.isReadOnly||this._isEnabledBasedOnSelection&&!ve)&&(te.return=!1,te.stop())},{priority:"highest"}),this.on("execute",te=>{this.isEnabled||te.stop()},{priority:"high"})}get affectsData(){return this._affectsData}set affectsData(t){this._affectsData=t}refresh(){this.isEnabled=!0}forceDisabled(t){this._disableStack.add(t),this._disableStack.size==1&&(this.on("set:isEnabled",forceDisable,{priority:"highest"}),this.isEnabled=!1)}clearForceDisabled(t){this._disableStack.delete(t),this._disableStack.size==0&&(this.off("set:isEnabled",forceDisable),this.refresh())}execute(...t){}destroy(){this.stopListening()}}function forceDisable(Te){Te.return=!1,Te.stop()}class MultiCommand extends Command{constructor(){super(...arguments);Re(this,"_childCommandsDefinitions",[])}refresh(){}execute(...t){const te=this._getFirstEnabledCommand();return!!te&&te.execute(t)}registerChildCommand(t,te={}){insertToPriorityArray(this._childCommandsDefinitions,{command:t,priority:te.priority||"normal"}),t.on("change:isEnabled",()=>this._checkEnabled()),this._checkEnabled()}_checkEnabled(){this.isEnabled=!!this._getFirstEnabledCommand()}_getFirstEnabledCommand(){const t=this._childCommandsDefinitions.find(({command:te})=>te.isEnabled);return t&&t.command}}class PluginCollection extends EmitterMixin(){constructor(t,te=[],be=[]){super();Re(this,"_context");Re(this,"_plugins",new Map);Re(this,"_availablePlugins");Re(this,"_contextPlugins");this._context=t,this._availablePlugins=new Map;for(const xe of te)xe.pluginName&&this._availablePlugins.set(xe.pluginName,xe);this._contextPlugins=new Map;for(const[xe,ve]of be)this._contextPlugins.set(xe,ve),this._contextPlugins.set(ve,xe),xe.pluginName&&this._availablePlugins.set(xe.pluginName,xe)}*[Symbol.iterator](){for(const t of this._plugins)typeof t[0]=="function"&&(yield t)}get(t){const te=this._plugins.get(t);if(!te){let be=t;throw typeof t=="function"&&(be=t.pluginName||t.name),new CKEditorError("plugincollection-plugin-not-loaded",this._context,{plugin:be})}return te}has(t){return this._plugins.has(t)}init(t,te=[],be=[]){const xe=this,ve=this._context;De(t),Be(t);const ke=t.filter(Qe=>!Ve(Qe,te)),Ie=[...Fe(ke)];Ke(Ie,be);const Ae=ze(Ie);return qe(Ae,"init").then(()=>qe(Ae,"afterInit")).then(()=>Ae);function Se(Qe){return typeof Qe=="function"}function Oe(Qe){return Se(Qe)&&!!Qe.isContextPlugin}function Ve(Qe,je){return je.some(Ye=>Ye===Qe||Me(Qe)===Ye||Me(Ye)===Qe)}function Me(Qe){return Se(Qe)?Qe.pluginName||Qe.name:Qe}function De(Qe,je=new Set){Qe.forEach(Ye=>{Se(Ye)&&(je.has(Ye)||(je.add(Ye),Ye.pluginName&&!xe._availablePlugins.has(Ye.pluginName)&&xe._availablePlugins.set(Ye.pluginName,Ye),Ye.requires&&De(Ye.requires,je)))})}function Fe(Qe,je=new Set){return Qe.map(Ye=>Se(Ye)?Ye:xe._availablePlugins.get(Ye)).reduce((Ye,ht)=>je.has(ht)?Ye:(je.add(ht),ht.requires&&(Be(ht.requires,ht),Fe(ht.requires,je).forEach(Ze=>Ye.add(Ze))),Ye.add(ht)),new Set)}function Be(Qe,je=null){Qe.map(Ye=>Se(Ye)?Ye:xe._availablePlugins.get(Ye)||Ye).forEach(Ye=>{$e(Ye,je),Ue(Ye,je),He(Ye,je)})}function $e(Qe,je){if(!Se(Qe))throw je?new CKEditorError("plugincollection-soft-required",ve,{missingPlugin:Qe,requiredBy:Me(je)}):new CKEditorError("plugincollection-plugin-not-found",ve,{plugin:Qe})}function Ue(Qe,je){if(Oe(je)&&!Oe(Qe))throw new CKEditorError("plugincollection-context-required",ve,{plugin:Me(Qe),requiredBy:Me(je)})}function He(Qe,je){if(je&&Ve(Qe,te))throw new CKEditorError("plugincollection-required",ve,{plugin:Me(Qe),requiredBy:Me(je)})}function ze(Qe){return Qe.map(je=>{let Ye=xe._contextPlugins.get(je);return Ye=Ye||new je(ve),xe._add(je,Ye),Ye})}function qe(Qe,je){return Qe.reduce((Ye,ht)=>!ht[je]||xe._contextPlugins.has(ht)?Ye:Ye.then(ht[je].bind(ht)),Promise.resolve())}function Ke(Qe,je){for(const Ye of je){if(typeof Ye!="function")throw new CKEditorError("plugincollection-replace-plugin-invalid-type",null,{pluginItem:Ye});const ht=Ye.pluginName;if(!ht)throw new CKEditorError("plugincollection-replace-plugin-missing-name",null,{pluginItem:Ye});if(Ye.requires&&Ye.requires.length)throw new CKEditorError("plugincollection-plugin-for-replacing-cannot-have-dependencies",null,{pluginName:ht});const Ze=xe._availablePlugins.get(ht);if(!Ze)throw new CKEditorError("plugincollection-plugin-for-replacing-not-exist",null,{pluginName:ht});const Bt=Qe.indexOf(Ze);if(Bt===-1){if(xe._contextPlugins.has(Ze))return;throw new CKEditorError("plugincollection-plugin-for-replacing-not-loaded",null,{pluginName:ht})}if(Ze.requires&&Ze.requires.length)throw new CKEditorError("plugincollection-replaced-plugin-cannot-have-dependencies",null,{pluginName:ht});Qe.splice(Bt,1,Ye),xe._availablePlugins.set(ht,Ye)}}}destroy(){const t=[];for(const[,te]of this)typeof te.destroy=="function"&&!this._contextPlugins.has(te)&&t.push(te.destroy());return Promise.all(t)}_add(t,te){this._plugins.set(t,te);const be=t.pluginName;if(be){if(this._plugins.has(be))throw new CKEditorError("plugincollection-plugin-name-conflict",null,{pluginName:be,plugin1:this._plugins.get(be).constructor,plugin2:t});this._plugins.set(be,te)}}}class Context{constructor(we){Re(this,"config");Re(this,"plugins");Re(this,"locale");Re(this,"t");Re(this,"editors");Re(this,"_contextOwner",null);const{translations:t,...te}=we||{};this.config=new Config(te,this.constructor.defaultConfig);const be=this.constructor.builtinPlugins;this.config.define("plugins",be),this.plugins=new PluginCollection(this,be);const xe=this.config.get("language")||{};this.locale=new Locale$1({uiLanguage:typeof xe=="string"?xe:xe.ui,contentLanguage:this.config.get("language.content"),translations:t}),this.t=this.locale.t,this.editors=new Collection}initPlugins(){const we=this.config.get("plugins")||[],t=this.config.get("substitutePlugins")||[];for(const te of we.concat(t)){if(typeof te!="function")throw new CKEditorError("context-initplugins-constructor-only",null,{Plugin:te});if(te.isContextPlugin!==!0)throw new CKEditorError("context-initplugins-invalid-plugin",null,{Plugin:te})}return this.plugins.init(we,[],t)}destroy(){return Promise.all(Array.from(this.editors,we=>we.destroy())).then(()=>this.plugins.destroy())}_addEditor(we,t){if(this._contextOwner)throw new CKEditorError("context-addeditor-private-context");this.editors.add(we),t&&(this._contextOwner=we)}_removeEditor(we){return this.editors.has(we)&&this.editors.remove(we),this._contextOwner===we?this.destroy():Promise.resolve()}_getEditorConfig(){const we={};for(const t of this.config.names())["plugins","removePlugins","extraPlugins"].includes(t)||(we[t]=this.config.get(t));return we}static create(we){return new Promise(t=>{const te=new this(we);t(te.initPlugins().then(()=>te))})}}Re(Context,"defaultConfig"),Re(Context,"builtinPlugins");class ContextPlugin extends ObservableMixin(){constructor(t){super();Re(this,"context");this.context=t}destroy(){this.stopListening()}static get isContextPlugin(){return!0}}class CommandCollection{constructor(){Re(this,"_commands");this._commands=new Map}add(we,t){this._commands.set(we,t)}get(we){return this._commands.get(we)}execute(we,...t){const te=this.get(we);if(!te)throw new CKEditorError("commandcollection-command-not-found",this,{commandName:we});return te.execute(...t)}*names(){yield*this._commands.keys()}*commands(){yield*this._commands.values()}[Symbol.iterator](){return this._commands[Symbol.iterator]()}destroy(){for(const we of this.commands())we.destroy()}}class EditingKeystrokeHandler extends KeystrokeHandler{constructor(t){super();Re(this,"editor");this.editor=t}set(t,te,be={}){if(typeof te=="string"){const xe=te;te=(ve,ke)=>{this.editor.execute(xe),ke()}}super.set(t,te,be)}}const DEFAULT_CATEGORY_ID="contentEditing",DEFAULT_GROUP_ID="common";class Accessibility{constructor(we){Re(this,"keystrokeInfos",new Map);Re(this,"_editor");this._editor=we;const t=we.config.get("menuBar.isVisible"),te=we.locale.t;this.addKeystrokeInfoCategory({id:DEFAULT_CATEGORY_ID,label:te("Content editing keystrokes"),description:te("These keyboard shortcuts allow for quick access to content editing features.")});const be=[{label:te("Close contextual balloons, dropdowns, and dialogs"),keystroke:"Esc"},{label:te("Open the accessibility help dialog"),keystroke:"Alt+0"},{label:te("Move focus between form fields (inputs, buttons, etc.)"),keystroke:[["Tab"],["Shift+Tab"]]},{label:te("Move focus to the toolbar, navigate between toolbars"),keystroke:"Alt+F10",mayRequireFn:!0},{label:te("Navigate through the toolbar or menu bar"),keystroke:[["arrowup"],["arrowright"],["arrowdown"],["arrowleft"]]},{label:te("Execute the currently focused button. Executing buttons that interact with the editor content moves the focus back to the content."),keystroke:[["Enter"],["Space"]]}];t&&be.push({label:te("Move focus to the menu bar, navigate between menu bars"),keystroke:"Alt+F9",mayRequireFn:!0}),this.addKeystrokeInfoCategory({id:"navigation",label:te("User interface and content navigation keystrokes"),description:te("Use the following keystrokes for more efficient navigation in the CKEditor 5 user interface."),groups:[{id:"common",keystrokes:be}]})}addKeystrokeInfoCategory({id:we,label:t,description:te,groups:be}){this.keystrokeInfos.set(we,{id:we,label:t,description:te,groups:new Map}),this.addKeystrokeInfoGroup({categoryId:we,id:DEFAULT_GROUP_ID}),be&&be.forEach(xe=>{this.addKeystrokeInfoGroup({categoryId:we,...xe})})}addKeystrokeInfoGroup({categoryId:we=DEFAULT_CATEGORY_ID,id:t,label:te,keystrokes:be}){const xe=this.keystrokeInfos.get(we);if(!xe)throw new CKEditorError("accessibility-unknown-keystroke-info-category",this._editor,{groupId:t,categoryId:we});xe.groups.set(t,{id:t,label:te,keystrokes:be||[]})}addKeystrokeInfos({categoryId:we=DEFAULT_CATEGORY_ID,groupId:t=DEFAULT_GROUP_ID,keystrokes:te}){if(!this.keystrokeInfos.has(we))throw new CKEditorError("accessibility-unknown-keystroke-info-category",this._editor,{categoryId:we,keystrokes:te});const be=this.keystrokeInfos.get(we);if(!be.groups.has(t))throw new CKEditorError("accessibility-unknown-keystroke-info-group",this._editor,{groupId:t,categoryId:we,keystrokes:te});be.groups.get(t).keystrokes.push(...te)}}class Editor extends ObservableMixin(){constructor(t={}){super();Re(this,"accessibility");Re(this,"commands");Re(this,"config");Re(this,"conversion");Re(this,"data");Re(this,"editing");Re(this,"locale");Re(this,"model");Re(this,"plugins");Re(this,"keystrokes");Re(this,"t");Re(this,"_context");Re(this,"_readOnlyLocks");const te=this.constructor,{translations:be,...xe}=te.defaultConfig||{},{translations:ve=be,...ke}=t,Ie=t.language||xe.language;this._context=t.context||new Context({language:Ie,translations:ve}),this._context._addEditor(this,!t.context);const Ae=Array.from(te.builtinPlugins||[]);this.config=new Config(ke,xe),this.config.define("plugins",Ae),this.config.define(this._context._getEditorConfig()),this.plugins=new PluginCollection(this,Ae,this._context.plugins),this.locale=this._context.locale,this.t=this.locale.t,this._readOnlyLocks=new Set,this.commands=new CommandCollection,this.set("state","initializing"),this.once("ready",()=>this.state="ready",{priority:"high"}),this.once("destroy",()=>this.state="destroyed",{priority:"high"}),this.model=new Model$1,this.on("change:isReadOnly",()=>{this.model.document.isReadOnly=this.isReadOnly});const Se=new StylesProcessor;this.data=new DataController(this.model,Se),this.editing=new EditingController(this.model,Se),this.editing.view.document.bind("isReadOnly").to(this),this.conversion=new Conversion([this.editing.downcastDispatcher,this.data.downcastDispatcher],this.data.upcastDispatcher),this.conversion.addAlias("dataDowncast",this.data.downcastDispatcher),this.conversion.addAlias("editingDowncast",this.editing.downcastDispatcher),this.keystrokes=new EditingKeystrokeHandler(this),this.keystrokes.listenTo(this.editing.view.document),this.accessibility=new Accessibility(this)}get isReadOnly(){return this._readOnlyLocks.size>0}set isReadOnly(t){throw new CKEditorError("editor-isreadonly-has-no-setter")}enableReadOnlyMode(t){if(typeof t!="string"&&typeof t!="symbol")throw new CKEditorError("editor-read-only-lock-id-invalid",null,{lockId:t});this._readOnlyLocks.has(t)||(this._readOnlyLocks.add(t),this._readOnlyLocks.size===1&&this.fire("change:isReadOnly","isReadOnly",!0,!1))}disableReadOnlyMode(t){if(typeof t!="string"&&typeof t!="symbol")throw new CKEditorError("editor-read-only-lock-id-invalid",null,{lockId:t});this._readOnlyLocks.has(t)&&(this._readOnlyLocks.delete(t),this._readOnlyLocks.size===0&&this.fire("change:isReadOnly","isReadOnly",!1,!0))}setData(t){this.data.set(t)}getData(t){return this.data.get(t)}initPlugins(){const t=this.config,te=t.get("plugins"),be=t.get("removePlugins")||[],xe=t.get("extraPlugins")||[],ve=t.get("substitutePlugins")||[];return this.plugins.init(te.concat(xe),be,ve)}destroy(){let t=Promise.resolve();return this.state=="initializing"&&(t=new Promise(te=>this.once("ready",te))),t.then(()=>{this.fire("destroy"),this.stopListening(),this.commands.destroy()}).then(()=>this.plugins.destroy()).then(()=>{this.model.destroy(),this.data.destroy(),this.editing.destroy(),this.keystrokes.destroy()}).then(()=>this._context._removeEditor(this))}execute(t,...te){try{return this.commands.execute(t,...te)}catch(be){/* istanbul ignore next -- @preserve */CKEditorError.rethrowUnexpectedError(be,this)}}focus(){this.editing.view.focus()}static create(...t){throw new Error("This is an abstract method.")}}Re(Editor,"defaultConfig"),Re(Editor,"builtinPlugins"),Re(Editor,"Context",Context),Re(Editor,"EditorWatchdog",EditorWatchdog),Re(Editor,"ContextWatchdog",ContextWatchdog);function ElementApiMixin(Te){class we extends Te{constructor(){super(...arguments);Re(this,"sourceElement")}updateSourceElement(be){if(!this.sourceElement)throw new CKEditorError("editor-missing-sourceelement",this);const xe=this.config.get("updateSourceElementOnDestroy"),ve=this.sourceElement instanceof HTMLTextAreaElement;if(!xe&&!ve){setDataInElement(this.sourceElement,"");return}const ke=typeof be=="string"?be:this.data.get();setDataInElement(this.sourceElement,ke)}}return we}ElementApiMixin.updateSourceElement=ElementApiMixin(Object).prototype.updateSourceElement;function secureSourceElement(Te,we){if(we.ckeditorInstance)throw new CKEditorError("editor-source-element-already-used",Te);we.ckeditorInstance=Te,Te.once("destroy",()=>{delete we.ckeditorInstance})}class PendingActions extends ContextPlugin{constructor(){super(...arguments);Re(this,"_actions")}static get pluginName(){return"PendingActions"}init(){this.set("hasAny",!1),this._actions=new Collection({idProperty:"_id"}),this._actions.delegate("add","remove").to(this)}add(t){if(typeof t!="string")throw new CKEditorError("pendingactions-add-invalid-message",this);const te=new(ObservableMixin());return te.set("message",t),this._actions.add(te),this.hasAny=!0,te}remove(t){this._actions.remove(t),this.hasAny=!!this._actions.length}get first(){return this._actions.get(0)}[Symbol.iterator](){return this._actions[Symbol.iterator]()}}var cancel='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="m11.591 10.177 4.243 4.242a1 1 0 0 1-1.415 1.415l-4.242-4.243-4.243 4.243a1 1 0 0 1-1.414-1.415l4.243-4.242L4.52 5.934A1 1 0 0 1 5.934 4.52l4.243 4.243 4.242-4.243a1 1 0 1 1 1.415 1.414l-4.243 4.243z"/></svg>',caption='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M2 16h9a1 1 0 0 1 0 2H2a1 1 0 0 1 0-2z"/><path d="M17 1a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V3a2 2 0 0 1 2-2h14zm0 1.5H3a.5.5 0 0 0-.492.41L2.5 3v9a.5.5 0 0 0 .41.492L3 12.5h14a.5.5 0 0 0 .492-.41L17.5 12V3a.5.5 0 0 0-.41-.492L17 2.5z" fill-opacity=".6"/></svg>',check='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M6.972 16.615a.997.997 0 0 1-.744-.292l-4.596-4.596a1 1 0 1 1 1.414-1.414l3.926 3.926 9.937-9.937a1 1 0 0 1 1.414 1.415L7.717 16.323a.997.997 0 0 1-.745.292z"/></svg>',cog='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="m11.333 2 .19 2.263a5.899 5.899 0 0 1 1.458.604L14.714 3.4 16.6 5.286l-1.467 1.733c.263.452.468.942.605 1.46L18 8.666v2.666l-2.263.19a5.899 5.899 0 0 1-.604 1.458l1.467 1.733-1.886 1.886-1.733-1.467a5.899 5.899 0 0 1-1.46.605L11.334 18H8.667l-.19-2.263a5.899 5.899 0 0 1-1.458-.604L5.286 16.6 3.4 14.714l1.467-1.733a5.899 5.899 0 0 1-.604-1.458L2 11.333V8.667l2.262-.189a5.899 5.899 0 0 1 .605-1.459L3.4 5.286 5.286 3.4l1.733 1.467a5.899 5.899 0 0 1 1.46-.605L8.666 2h2.666zM10 6.267a3.733 3.733 0 1 0 0 7.466 3.733 3.733 0 0 0 0-7.466z"/></svg>',colorPalette='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M10.209 18.717A8.5 8.5 0 1 1 18.686 9.6h-.008l.002.12a3 3 0 0 1-2.866 2.997h-.268l-.046-.002v.002h-4.791a2 2 0 1 0 0 4 1 1 0 1 1-.128 1.992 8.665 8.665 0 0 1-.372.008Zm-3.918-7.01a1.25 1.25 0 1 0-2.415-.648 1.25 1.25 0 0 0 2.415.647ZM5.723 8.18a1.25 1.25 0 1 0 .647-2.414 1.25 1.25 0 0 0-.647 2.414ZM9.76 6.155a1.25 1.25 0 1 0 .647-2.415 1.25 1.25 0 0 0-.647 2.415Zm4.028 1.759a1.25 1.25 0 1 0 .647-2.415 1.25 1.25 0 0 0-.647 2.415Z"/></svg>',eraser='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="m8.636 9.531-2.758 3.94a.5.5 0 0 0 .122.696l3.224 2.284h1.314l2.636-3.736L8.636 9.53zm.288 8.451L5.14 15.396a2 2 0 0 1-.491-2.786l6.673-9.53a2 2 0 0 1 2.785-.49l3.742 2.62a2 2 0 0 1 .491 2.785l-7.269 10.053-2.147-.066z"/><path d="M4 18h5.523v-1H4zm-2 0h1v-1H2z"/></svg>',history='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M11 1a9 9 0 1 1-8.027 13.075l1.128-1.129A7.502 7.502 0 0 0 18.5 10a7.5 7.5 0 1 0-14.962.759l-.745-.746-.76.76A9 9 0 0 1 11 1z"/><path d="M.475 8.17a.75.75 0 0 1 .978.047l.075.082 1.284 1.643 1.681-1.284a.75.75 0 0 1 .978.057l.073.083a.75.75 0 0 1-.057.978l-.083.073-2.27 1.737a.75.75 0 0 1-.973-.052l-.074-.082-1.741-2.23a.75.75 0 0 1 .13-1.052z"/><path d="M11.5 5v4.999l3.196 3.196-1.06 1.06L10.1 10.72l-.1-.113V5z"/></svg>',lowVision='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M5.085 6.22 2.943 4.078a.75.75 0 1 1 1.06-1.06l2.592 2.59A11.094 11.094 0 0 1 10 5.068c4.738 0 8.578 3.101 8.578 5.083 0 1.197-1.401 2.803-3.555 3.887l1.714 1.713a.75.75 0 0 1-.09 1.138.488.488 0 0 1-.15.084.75.75 0 0 1-.821-.16L6.17 7.304c-.258.11-.51.233-.757.365l6.239 6.24-.006.005.78.78c-.388.094-.78.166-1.174.215l-1.11-1.11h.011L4.55 8.197a7.2 7.2 0 0 0-.665.514l-.112.098 4.897 4.897-.005.006 1.276 1.276a10.164 10.164 0 0 1-1.477-.117l-.479-.479-.009.009-4.863-4.863-.022.031a2.563 2.563 0 0 0-.124.2c-.043.077-.08.158-.108.241a.534.534 0 0 0-.028.133.29.29 0 0 0 .008.072.927.927 0 0 0 .082.226c.067.133.145.26.234.379l3.242 3.365.025.01.59.623c-3.265-.918-5.59-3.155-5.59-4.668 0-1.194 1.448-2.838 3.663-3.93zm7.07.531a4.632 4.632 0 0 1 1.108 5.992l.345.344.046-.018a9.313 9.313 0 0 0 2-1.112c.256-.187.5-.392.727-.613.137-.134.27-.277.392-.431.072-.091.141-.185.203-.286.057-.093.107-.19.148-.292a.72.72 0 0 0 .036-.12.29.29 0 0 0 .008-.072.492.492 0 0 0-.028-.133.999.999 0 0 0-.036-.096 2.165 2.165 0 0 0-.071-.145 2.917 2.917 0 0 0-.125-.2 3.592 3.592 0 0 0-.263-.335 5.444 5.444 0 0 0-.53-.523 7.955 7.955 0 0 0-1.054-.768 9.766 9.766 0 0 0-1.879-.891c-.337-.118-.68-.219-1.027-.301zm-2.85.21-.069.002a.508.508 0 0 0-.254.097.496.496 0 0 0-.104.679.498.498 0 0 0 .326.199l.045.005c.091.003.181.003.272.012a2.45 2.45 0 0 1 2.017 1.513c.024.061.043.125.069.185a.494.494 0 0 0 .45.287h.008a.496.496 0 0 0 .35-.158.482.482 0 0 0 .13-.335.638.638 0 0 0-.048-.219 3.379 3.379 0 0 0-.36-.723 3.438 3.438 0 0 0-2.791-1.543l-.028-.001h-.013z"/></svg>',textAlternative='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M3.035 1C2.446 1 2 1.54 2 2.098V10.5h1.5v-8h13v8H18V2.098C18 1.539 17.48 1 16.9 1H3.035Zm10.453 2.61a1.885 1.885 0 0 0-1.442.736 1.89 1.89 0 0 0 1.011 2.976 1.903 1.903 0 0 0 2.253-1.114 1.887 1.887 0 0 0-1.822-2.598ZM7.463 8.163a.611.611 0 0 0-.432.154L5.071 10.5h5.119L7.88 8.348a.628.628 0 0 0-.417-.185Zm6.236 1.059a.62.62 0 0 0-.42.164L12.07 10.5h2.969l-.92-1.113a.618.618 0 0 0-.42-.165ZM.91 11.5a.91.91 0 0 0-.91.912v6.877c0 .505.405.91.91.91h18.178a.91.91 0 0 0 .912-.91v-6.877a.908.908 0 0 0-.912-.912H.91ZM3.668 13h1.947l2.135 5.7H5.898l-.28-.946H3.601l-.278.945H1.516L3.668 13Zm4.947 0h1.801v4.3h2.7v1.4h-4.5V13h-.001Zm4.5 0h5.4v1.4h-1.798v4.3h-1.701v-4.3h-1.9V13h-.001Zm-8.517 1.457-.614 2.059h1.262l-.648-2.059Z"/></svg>',loupe='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M12.68 13.74h-.001l4.209 4.208a1 1 0 1 0 1.414-1.414l-4.267-4.268a6 6 0 1 0-1.355 1.474ZM13 9a4 4 0 1 1-8 0 4 4 0 0 1 8 0Z"/></svg>',previousArrow='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M11.463 5.187a.888.888 0 1 1 1.254 1.255L9.16 10l3.557 3.557a.888.888 0 1 1-1.254 1.255L7.26 10.61a.888.888 0 0 1 .16-1.382l4.043-4.042z"/></svg>',nextArrow='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M8.537 14.813a.888.888 0 1 1-1.254-1.255L10.84 10 7.283 6.442a.888.888 0 1 1 1.254-1.255L12.74 9.39a.888.888 0 0 1-.16 1.382l-4.043 4.042z"/></svg>',image='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M6.66 9.118a.693.693 0 0 1 .956.032l3.65 3.411 2.422-2.238a.695.695 0 0 1 .945 0L17.5 13.6V2.5h-15v11.1l4.16-4.482ZM17.8 1c.652 0 1.2.47 1.2 1.1v14.362c0 .64-.532 1.038-1.184 1.038H2.184C1.532 17.5 1 17.103 1 16.462V2.1C1 1.47 1.537 1 2.2 1h15.6Zm-5.655 6a2.128 2.128 0 0 1 .157-2.364A2.133 2.133 0 1 1 12.145 7Z"/></svg>',imageUpload='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M1.201 1C.538 1 0 1.47 0 2.1v14.363c0 .64.534 1.037 1.186 1.037h9.494a2.97 2.97 0 0 1-.414-.287 2.998 2.998 0 0 1-1.055-2.03 3.003 3.003 0 0 1 .693-2.185l.383-.455-.02.018-3.65-3.41a.695.695 0 0 0-.957-.034L1.5 13.6V2.5h15v5.535a2.97 2.97 0 0 1 1.412.932l.088.105V2.1c0-.63-.547-1.1-1.2-1.1H1.202Zm11.713 2.803a2.146 2.146 0 0 0-2.049 1.992 2.14 2.14 0 0 0 1.28 2.096 2.13 2.13 0 0 0 2.644-3.11 2.134 2.134 0 0 0-1.875-.978Z"/><path d="M15.522 19.1a.79.79 0 0 0 .79-.79v-5.373l2.059 2.455a.79.79 0 1 0 1.211-1.015l-3.352-3.995a.79.79 0 0 0-.995-.179.784.784 0 0 0-.299.221l-3.35 3.99a.79.79 0 1 0 1.21 1.017l1.936-2.306v5.185c0 .436.353.79.79.79Z"/><path d="M15.522 19.1a.79.79 0 0 0 .79-.79v-5.373l2.059 2.455a.79.79 0 1 0 1.211-1.015l-3.352-3.995a.79.79 0 0 0-.995-.179.784.784 0 0 0-.299.221l-3.35 3.99a.79.79 0 1 0 1.21 1.017l1.936-2.306v5.185c0 .436.353.79.79.79Z"/></svg>',imageAssetManager='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M1.201 1c-.662 0-1.2.47-1.2 1.1v14.248c0 .64.533 1.152 1.185 1.152h6.623v-7.236L6.617 9.15a.694.694 0 0 0-.957-.033L1.602 13.55V2.553l14.798.003V9.7H18V2.1c0-.63-.547-1.1-1.2-1.1H1.202Zm11.723 2.805a2.094 2.094 0 0 0-1.621.832 2.127 2.127 0 0 0 1.136 3.357 2.13 2.13 0 0 0 2.611-1.506 2.133 2.133 0 0 0-.76-2.244 2.13 2.13 0 0 0-1.366-.44Z"/><path clip-rule="evenodd" d="M19.898 12.369v6.187a.844.844 0 0 1-.844.844h-8.719a.844.844 0 0 1-.843-.844v-7.312a.844.844 0 0 1 .843-.844h2.531a.843.843 0 0 1 .597.248l.838.852h4.75c.223 0 .441.114.6.272a.844.844 0 0 1 .247.597Zm-1.52.654-4.377.02-1.1-1.143H11v6h7.4l-.023-4.877Z"/></svg>',imageUrl='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M1.201 1C.538 1 0 1.47 0 2.1v14.363c0 .64.534 1.037 1.186 1.037h7.029a5.401 5.401 0 0 1 .615-4.338l.762-1.232-2.975-2.78a.696.696 0 0 0-.957-.033L1.5 13.6V2.5h15v6.023c.449.131.887.32 1.307.573l.058.033c.046.028.09.057.135.086V2.1c0-.63-.547-1.1-1.2-1.1H1.202Zm11.713 2.803a2.15 2.15 0 0 0-1.611.834 2.118 2.118 0 0 0-.438 1.158 2.14 2.14 0 0 0 1.277 2.096 2.132 2.132 0 0 0 2.645-3.11 2.13 2.13 0 0 0-1.873-.978Z"/><path d="M16.63 10.294a3.003 3.003 0 0 0-4.142.887l-.117.177a.647.647 0 0 0-.096.492.664.664 0 0 0 .278.418.7.7 0 0 0 .944-.234 1.741 1.741 0 0 1 2.478-.463 1.869 1.869 0 0 1 .476 2.55.637.637 0 0 0-.071.5.646.646 0 0 0 .309.396.627.627 0 0 0 .869-.19l.027-.041a3.226 3.226 0 0 0-.956-4.492Zm-6.061 3.78-.044.066a3.228 3.228 0 0 0 .82 4.403 3.005 3.005 0 0 0 4.275-.798l.13-.197a.626.626 0 0 0 .092-.475.638.638 0 0 0-.268-.402.713.713 0 0 0-.99.26l-.018.029a1.741 1.741 0 0 1-2.477.461 1.87 1.87 0 0 1-.475-2.55l.029-.047a.647.647 0 0 0 .086-.485.66.66 0 0 0-.275-.408l-.04-.027a.609.609 0 0 0-.845.17Z"/><path d="M15.312 13.925c.24-.36.154-.838-.19-1.067-.346-.23-.82-.124-1.059.236l-1.268 1.907c-.239.36-.153.838.192 1.067.345.23.818.123 1.057-.236l1.268-1.907Z"/></svg>',alignBottom='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="m9.239 13.938-2.88-1.663a.75.75 0 0 1 .75-1.3L9 12.067V4.75a.75.75 0 1 1 1.5 0v7.318l1.89-1.093a.75.75 0 0 1 .75 1.3l-2.879 1.663a.752.752 0 0 1-.511.187.752.752 0 0 1-.511-.187zM4.25 17a.75.75 0 1 1 0-1.5h10.5a.75.75 0 0 1 0 1.5H4.25z"/></svg>',alignMiddle='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M9.75 11.875a.752.752 0 0 1 .508.184l2.883 1.666a.75.75 0 0 1-.659 1.344l-.091-.044-1.892-1.093.001 4.318a.75.75 0 1 1-1.5 0v-4.317l-1.89 1.092a.75.75 0 0 1-.75-1.3l2.879-1.663a.752.752 0 0 1 .51-.187zM15.25 9a.75.75 0 1 1 0 1.5H4.75a.75.75 0 1 1 0-1.5h10.5zM9.75.375a.75.75 0 0 1 .75.75v4.318l1.89-1.093.092-.045a.75.75 0 0 1 .659 1.344l-2.883 1.667a.752.752 0 0 1-.508.184.752.752 0 0 1-.511-.187L6.359 5.65a.75.75 0 0 1 .75-1.299L9 5.442V1.125a.75.75 0 0 1 .75-.75z"/></svg>',alignTop='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="m10.261 7.062 2.88 1.663a.75.75 0 0 1-.75 1.3L10.5 8.933v7.317a.75.75 0 1 1-1.5 0V8.932l-1.89 1.093a.75.75 0 0 1-.75-1.3l2.879-1.663a.752.752 0 0 1 .511-.187.752.752 0 0 1 .511.187zM15.25 4a.75.75 0 1 1 0 1.5H4.75a.75.75 0 0 1 0-1.5h10.5z"/></svg>',alignLeft='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M2 3.75c0 .414.336.75.75.75h14.5a.75.75 0 1 0 0-1.5H2.75a.75.75 0 0 0-.75.75zm0 8c0 .414.336.75.75.75h14.5a.75.75 0 1 0 0-1.5H2.75a.75.75 0 0 0-.75.75zm0 4c0 .414.336.75.75.75h9.929a.75.75 0 1 0 0-1.5H2.75a.75.75 0 0 0-.75.75zm0-8c0 .414.336.75.75.75h9.929a.75.75 0 1 0 0-1.5H2.75a.75.75 0 0 0-.75.75z"/></svg>',alignCenter='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M2 3.75c0 .414.336.75.75.75h14.5a.75.75 0 1 0 0-1.5H2.75a.75.75 0 0 0-.75.75zm0 8c0 .414.336.75.75.75h14.5a.75.75 0 1 0 0-1.5H2.75a.75.75 0 0 0-.75.75zm2.286 4c0 .414.336.75.75.75h9.928a.75.75 0 1 0 0-1.5H5.036a.75.75 0 0 0-.75.75zm0-8c0 .414.336.75.75.75h9.928a.75.75 0 1 0 0-1.5H5.036a.75.75 0 0 0-.75.75z"/></svg>',alignRight='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M18 3.75a.75.75 0 0 1-.75.75H2.75a.75.75 0 1 1 0-1.5h14.5a.75.75 0 0 1 .75.75zm0 8a.75.75 0 0 1-.75.75H2.75a.75.75 0 1 1 0-1.5h14.5a.75.75 0 0 1 .75.75zm0 4a.75.75 0 0 1-.75.75H7.321a.75.75 0 1 1 0-1.5h9.929a.75.75 0 0 1 .75.75zm0-8a.75.75 0 0 1-.75.75H7.321a.75.75 0 1 1 0-1.5h9.929a.75.75 0 0 1 .75.75z"/></svg>',alignJustify='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M2 3.75c0 .414.336.75.75.75h14.5a.75.75 0 1 0 0-1.5H2.75a.75.75 0 0 0-.75.75zm0 8c0 .414.336.75.75.75h14.5a.75.75 0 1 0 0-1.5H2.75a.75.75 0 0 0-.75.75zm0 4c0 .414.336.75.75.75h9.929a.75.75 0 1 0 0-1.5H2.75a.75.75 0 0 0-.75.75zm0-8c0 .414.336.75.75.75h14.5a.75.75 0 1 0 0-1.5H2.75a.75.75 0 0 0-.75.75z"/></svg>',objectBlockLeft='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path opacity=".5" d="M2 3h16v1.5H2zm0 12h16v1.5H2z"/><path d="M12.003 7v5.5a1 1 0 0 1-1 1H2.996a1 1 0 0 1-1-1V7a1 1 0 0 1 1-1h8.007a1 1 0 0 1 1 1zm-1.506.5H3.5V12h6.997V7.5z"/></svg>',objectCenter='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path opacity=".5" d="M2 3h16v1.5H2zm0 12h16v1.5H2z"/><path d="M15.003 7v5.5a1 1 0 0 1-1 1H5.996a1 1 0 0 1-1-1V7a1 1 0 0 1 1-1h8.007a1 1 0 0 1 1 1zm-1.506.5H6.5V12h6.997V7.5z"/></svg>',objectBlockRight='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path opacity=".5" d="M2 3h16v1.5H2zm0 12h16v1.5H2z"/><path d="M18.003 7v5.5a1 1 0 0 1-1 1H8.996a1 1 0 0 1-1-1V7a1 1 0 0 1 1-1h8.007a1 1 0 0 1 1 1zm-1.506.5H9.5V12h6.997V7.5z"/></svg>',objectFullWidth='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path opacity=".5" d="M2 3h16v1.5H2zm0 12h16v1.5H2z"/><path d="M18 7v5.5a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V7a1 1 0 0 1 1-1h14a1 1 0 0 1 1 1zm-1.505.5H3.504V12h12.991V7.5z"/></svg>',objectInline='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path opacity=".5" d="M2 3h16v1.5H2zm11.5 9H18v1.5h-4.5zM2 15h16v1.5H2z"/><path d="M12.003 7v5.5a1 1 0 0 1-1 1H2.996a1 1 0 0 1-1-1V7a1 1 0 0 1 1-1h8.007a1 1 0 0 1 1 1zm-1.506.5H3.5V12h6.997V7.5z"/></svg>',objectLeft='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path opacity=".5" d="M2 3h16v1.5H2zm11.5 9H18v1.5h-4.5zm0-3H18v1.5h-4.5zm0-3H18v1.5h-4.5zM2 15h16v1.5H2z"/><path d="M12.003 7v5.5a1 1 0 0 1-1 1H2.996a1 1 0 0 1-1-1V7a1 1 0 0 1 1-1h8.007a1 1 0 0 1 1 1zm-1.506.5H3.5V12h6.997V7.5z"/></svg>',objectRight='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path opacity=".5" d="M2 3h16v1.5H2zm0 12h16v1.5H2zm0-9h5v1.5H2zm0 3h5v1.5H2zm0 3h5v1.5H2z"/><path d="M18.003 7v5.5a1 1 0 0 1-1 1H8.996a1 1 0 0 1-1-1V7a1 1 0 0 1 1-1h8.007a1 1 0 0 1 1 1zm-1.506.5H9.5V12h6.997V7.5z"/></svg>',objectSizeFull='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"><path d="M2.5 17v1h-1v-1h1zm2 0v1h-1v-1h1zm2 0v1h-1v-1h1zm2 0v1h-1v-1h1zm2 0v1h-1v-1h1zm2 0v1h-1v-1h1zm2 0v1h-1v-1h1zm2 0v1h-1v-1h1zm2 0v1h-1v-1h1zM1 15.5v1H0v-1h1zm19 0v1h-1v-1h1zm-19-2v1H0v-1h1zm19 0v1h-1v-1h1zm-19-2v1H0v-1h1zm19 0v1h-1v-1h1zm-19-2v1H0v-1h1zm19 0v1h-1v-1h1zm-19-2v1H0v-1h1zm19 0v1h-1v-1h1zm-19-2v1H0v-1h1zm19 0v1h-1v-1h1zm0-2v1h-1v-1h1zm-19 0v1H0v-1h1zM14.5 2v1h-1V2h1zm2 0v1h-1V2h1zm2 0v1h-1V2h1zm-8 0v1h-1V2h1zm-2 0v1h-1V2h1zm-2 0v1h-1V2h1zm-2 0v1h-1V2h1zm8 0v1h-1V2h1zm-10 0v1h-1V2h1z"/><path d="M18.095 2H1.905C.853 2 0 2.895 0 4v12c0 1.105.853 2 1.905 2h16.19C19.147 18 20 17.105 20 16V4c0-1.105-.853-2-1.905-2zm0 1.5c.263 0 .476.224.476.5v12c0 .276-.213.5-.476.5H1.905a.489.489 0 0 1-.476-.5V4c0-.276.213-.5.476-.5h16.19z"/></svg>',objectSizeCustom='<svg xmlns="http://www.w3.org/2000/svg" xmlns:v="https://vecta.io/nano" viewBox="0 0 20 20"><path d="M.95 1.43a.95.95 0 0 0-.95.95v3.1a.95.95 0 0 0 .95.95h.75v6.3H.95a.95.95 0 0 0-.95.95v3.1a.95.95 0 0 0 .95.95h3.1a.95.95 0 0 0 .95-.95v-.65h1.932l1.539-1.5H5v-.95a.95.95 0 0 0-.95-.95H3.2v-6.3h.85A.95.95 0 0 0 5 5.48v-.55h10v.55a.95.95 0 0 0 .95.95h3.1a.95.95 0 0 0 .95-.95v-3.1a.95.95 0 0 0-.95-.95h-3.1a.95.95 0 0 0-.95.95v1.05H5V2.38a.95.95 0 0 0-.95-.95H.95zm.55 3.5v-2h2v2h-2zm0 9.3v2h2v-2h-2zm15-11.3v2h2v-2h-2z"/><path d="M8.139 20.004v-2.388l7.045-7.048 2.391 2.391-7.046 7.046h-2.39zm11.421-9.101a.64.64 0 0 1-.138.206l-1.165 1.168-2.391-2.391 1.167-1.163a.63.63 0 0 1 .206-.138.635.635 0 0 1 .243-.049.63.63 0 0 1 .449.187l1.491 1.488c.059.059.108.129.138.206s.049.16.049.243a.6.6 0 0 1-.049.243z"/></svg>',objectSizeLarge='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M2.5 16.5v1h-1v-1h1Zm2 0v1h-1v-1h1Zm2 0v1h-1v-1h1Zm2 0v1h-1v-1h1Zm2 0v1h-1v-1h1Zm2 0v1h-1v-1h1Zm2 0v1h-1v-1h1Zm2 0v1h-1v-1h1Zm2 0v1h-1v-1h1ZM1 15v1H0v-1h1Zm19 0v1h-1v-1h1ZM1 13v1H0v-1h1Zm19 0v1h-1v-1h1ZM1 11v1H0v-1h1Zm19 0v1h-1v-1h1ZM1 9v1H0V9h1Zm19 0v1h-1V9h1ZM1 7v1H0V7h1Zm19 0v1h-1V7h1ZM1 5v1H0V5h1Zm19 0v1h-1V5h1Zm0-2v1h-1V3h1ZM1 3v1H0V3h1Zm13.5-1.5v1h-1v-1h1Zm2 0v1h-1v-1h1Zm2 0v1h-1v-1h1Zm-8 0v1h-1v-1h1Zm-2 0v1h-1v-1h1Zm-2 0v1h-1v-1h1Zm-2 0v1h-1v-1h1Zm8 0v1h-1v-1h1Zm-10 0v1h-1v-1h1Z"/><path d="M13 5.5H2a2 2 0 0 0-2 2v8a2 2 0 0 0 2 2h11a2 2 0 0 0 2-2v-8a2 2 0 0 0-2-2ZM13 7a.5.5 0 0 1 .5.5v8a.5.5 0 0 1-.5.5H2a.5.5 0 0 1-.5-.5v-8A.5.5 0 0 1 2 7h11Z"/></svg>',objectSizeSmall='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M2.5 16.5v1h-1v-1h1Zm2 0v1h-1v-1h1Zm2 0v1h-1v-1h1Zm2 0v1h-1v-1h1Zm2 0v1h-1v-1h1Zm2 0v1h-1v-1h1Zm2 0v1h-1v-1h1Zm2 0v1h-1v-1h1Zm2 0v1h-1v-1h1ZM1 15v1H0v-1h1Zm19 0v1h-1v-1h1ZM1 13v1H0v-1h1Zm19 0v1h-1v-1h1ZM1 11v1H0v-1h1Zm19 0v1h-1v-1h1ZM1 9v1H0V9h1Zm19 0v1h-1V9h1ZM1 7v1H0V7h1Zm19 0v1h-1V7h1ZM1 5v1H0V5h1Zm19 0v1h-1V5h1Zm0-2v1h-1V3h1ZM1 3v1H0V3h1Zm13.5-1.5v1h-1v-1h1Zm2 0v1h-1v-1h1Zm2 0v1h-1v-1h1Zm-8 0v1h-1v-1h1Zm-2 0v1h-1v-1h1Zm-2 0v1h-1v-1h1Zm-2 0v1h-1v-1h1Zm8 0v1h-1v-1h1Zm-10 0v1h-1v-1h1Z"/><path d="M7 9.5H2a2 2 0 0 0-2 2v4a2 2 0 0 0 2 2h5a2 2 0 0 0 2-2v-4a2 2 0 0 0-2-2ZM7 11a.5.5 0 0 1 .5.5v4a.5.5 0 0 1-.5.5H2a.5.5 0 0 1-.5-.5v-4A.5.5 0 0 1 2 11h5Z"/></svg>',objectSizeMedium='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M2.5 16.5v1h-1v-1h1Zm2 0v1h-1v-1h1Zm2 0v1h-1v-1h1Zm2 0v1h-1v-1h1Zm2 0v1h-1v-1h1Zm2 0v1h-1v-1h1Zm2 0v1h-1v-1h1Zm2 0v1h-1v-1h1Zm2 0v1h-1v-1h1ZM1 15v1H0v-1h1Zm19 0v1h-1v-1h1ZM1 13v1H0v-1h1Zm19 0v1h-1v-1h1ZM1 11v1H0v-1h1Zm19 0v1h-1v-1h1ZM1 9v1H0V9h1Zm19 0v1h-1V9h1ZM1 7v1H0V7h1Zm19 0v1h-1V7h1ZM1 5v1H0V5h1Zm19 0v1h-1V5h1Zm0-2v1h-1V3h1ZM1 3v1H0V3h1Zm13.5-1.5v1h-1v-1h1Zm2 0v1h-1v-1h1Zm2 0v1h-1v-1h1Zm-8 0v1h-1v-1h1Zm-2 0v1h-1v-1h1Zm-2 0v1h-1v-1h1Zm-2 0v1h-1v-1h1Zm8 0v1h-1v-1h1Zm-10 0v1h-1v-1h1Z"/><path d="M10 7.5H2a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2v-6a2 2 0 0 0-2-2ZM10 9a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-.5.5H2a.5.5 0 0 1-.5-.5v-6A.5.5 0 0 1 2 9h8Z"/></svg>',pencil='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="m7.3 17.37-.061.088a1.518 1.518 0 0 1-.934.535l-4.178.663-.806-4.153a1.495 1.495 0 0 1 .187-1.058l.056-.086L8.77 2.639c.958-1.351 2.803-1.076 4.296-.03 1.497 1.047 2.387 2.693 1.433 4.055L7.3 17.37zM9.14 4.728l-5.545 8.346 3.277 2.294 5.544-8.346L9.14 4.728zM6.07 16.512l-3.276-2.295.53 2.73 2.746-.435zM9.994 3.506 13.271 5.8c.316-.452-.16-1.333-1.065-1.966-.905-.634-1.895-.78-2.212-.328zM8 18.5 9.375 17H19v1.5H8z"/></svg>',pilcrow='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M6.999 2H15a1 1 0 0 1 0 2h-1.004v13a1 1 0 1 1-2 0V4H8.999v13a1 1 0 1 1-2 0v-7A4 4 0 0 1 3 6a4 4 0 0 1 3.999-4z"/></svg>',quote='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M3 10.423a6.5 6.5 0 0 1 6.056-6.408l.038.67C6.448 5.423 5.354 7.663 5.22 10H9c.552 0 .5.432.5.986v4.511c0 .554-.448.503-1 .503h-5c-.552 0-.5-.449-.5-1.003v-4.574zm8 0a6.5 6.5 0 0 1 6.056-6.408l.038.67c-2.646.739-3.74 2.979-3.873 5.315H17c.552 0 .5.432.5.986v4.511c0 .554-.448.503-1 .503h-5c-.552 0-.5-.449-.5-1.003v-4.574z"/></svg>',threeVerticalDots='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><circle cx="9.5" cy="4.5" r="1.5"/><circle cx="9.5" cy="10.5" r="1.5"/><circle cx="9.5" cy="16.5" r="1.5"/></svg>',dragIndicator='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M5 3.25a1.5 1.5 0 1 0 3 0 1.5 1.5 0 1 0-3 0"/><path d="M12 3.25a1.5 1.5 0 1 0 3 0 1.5 1.5 0 1 0-3 0"/><path d="M5 10a1.5 1.5 0 1 0 3 0 1.5 1.5 0 1 0-3 0"/><path d="M12 10a1.5 1.5 0 1 0 3 0 1.5 1.5 0 1 0-3 0"/><path d="M5 16.75a1.5 1.5 0 1 0 3 0 1.5 1.5 0 1 0-3 0"/><path d="M12 16.75a1.5 1.5 0 1 0 3 0 1.5 1.5 0 1 0-3 0"/></svg>',bold='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M10.187 17H5.773c-.637 0-1.092-.138-1.364-.415-.273-.277-.409-.718-.409-1.323V4.738c0-.617.14-1.062.419-1.332.279-.27.73-.406 1.354-.406h4.68c.69 0 1.288.041 1.793.124.506.083.96.242 1.36.478.341.197.644.447.906.75a3.262 3.262 0 0 1 .808 2.162c0 1.401-.722 2.426-2.167 3.075C15.05 10.175 16 11.315 16 13.01a3.756 3.756 0 0 1-2.296 3.504 6.1 6.1 0 0 1-1.517.377c-.571.073-1.238.11-2 .11zm-.217-6.217H7v4.087h3.069c1.977 0 2.965-.69 2.965-2.072 0-.707-.256-1.22-.768-1.537-.512-.319-1.277-.478-2.296-.478zM7 5.13v3.619h2.606c.729 0 1.292-.067 1.69-.2a1.6 1.6 0 0 0 .91-.765c.165-.267.247-.566.247-.897 0-.707-.26-1.176-.778-1.409-.519-.232-1.31-.348-2.375-.348H7z"/></svg>',paragraph='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M10.5 5.5H7v5h3.5a2.5 2.5 0 1 0 0-5zM5 3h6.5v.025a5 5 0 0 1 0 9.95V13H7v4a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1z"/></svg>',plus='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M10 2a1 1 0 0 0-1 1v6H3a1 1 0 1 0 0 2h6v6a1 1 0 1 0 2 0v-6h6a1 1 0 1 0 0-2h-6V3a1 1 0 0 0-1-1Z"/></svg>',text='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M9.816 11.5 7.038 4.785 4.261 11.5h5.555Zm.62 1.5H3.641l-1.666 4.028H.312l5.789-14h1.875l5.789 14h-1.663L10.436 13Z"/><path d="m12.09 17-.534-1.292.848-1.971.545 1.319L12.113 17h-.023Zm1.142-5.187.545 1.319L15.5 9.13l1.858 4.316h-3.45l.398.965h3.467L18.887 17H20l-3.873-9h-1.254l-1.641 3.813Z"/></svg>',importExport='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M19 4.5 14 0H3v12.673l.868-1.041c.185-.222.4-.402.632-.54V1.5h8v5h5v7.626a2.24 2.24 0 0 1 1.5.822V4.5ZM14 5V2l3.3 3H14Zm-3.692 12.5c.062.105.133.206.213.303L11.52 19H8v-.876a2.243 2.243 0 0 0 1.82-.624h.488Zm7.518-.657a.75.75 0 0 0-1.152-.96L15.5 17.29V12H14v5.29l-1.174-1.408a.75.75 0 0 0-1.152.96l2.346 2.816a.95.95 0 0 0 1.46 0l2.346-2.815Zm-15.056-.38a.75.75 0 0 1-.096-1.056l2.346-2.815a.95.95 0 0 1 1.46 0l2.346 2.815a.75.75 0 1 1-1.152.96L6.5 14.96V20H5v-5.04l-1.174 1.408a.75.75 0 0 1-1.056.096Z"/></svg>',redo='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="m14.958 9.367-2.189 1.837a.75.75 0 0 0 .965 1.149l3.788-3.18a.747.747 0 0 0 .21-.284.75.75 0 0 0-.17-.945L13.77 4.762a.75.75 0 1 0-.964 1.15l2.331 1.955H6.22A.75.75 0 0 0 6 7.9a4 4 0 1 0 1.477 7.718l-.344-1.489A2.5 2.5 0 1 1 6.039 9.4l-.008-.032h8.927z"/></svg>',undo='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="m5.042 9.367 2.189 1.837a.75.75 0 0 1-.965 1.149l-3.788-3.18a.747.747 0 0 1-.21-.284.75.75 0 0 1 .17-.945L6.23 4.762a.75.75 0 1 1 .964 1.15L4.863 7.866h8.917A.75.75 0 0 1 14 7.9a4 4 0 1 1-1.477 7.718l.344-1.489a2.5 2.5 0 1 0 1.094-4.73l.008-.032H5.042z"/></svg>',bulletedList='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M7 5.75c0 .414.336.75.75.75h9.5a.75.75 0 1 0 0-1.5h-9.5a.75.75 0 0 0-.75.75zm-6 0C1 4.784 1.777 4 2.75 4c.966 0 1.75.777 1.75 1.75 0 .966-.777 1.75-1.75 1.75C1.784 7.5 1 6.723 1 5.75zm6 9c0 .414.336.75.75.75h9.5a.75.75 0 1 0 0-1.5h-9.5a.75.75 0 0 0-.75.75zm-6 0c0-.966.777-1.75 1.75-1.75.966 0 1.75.777 1.75 1.75 0 .966-.777 1.75-1.75 1.75-.966 0-1.75-.777-1.75-1.75z"/></svg>',numberedList='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M7 5.75c0 .414.336.75.75.75h9.5a.75.75 0 1 0 0-1.5h-9.5a.75.75 0 0 0-.75.75zM3.5 3v5H2V3.7H1v-1h2.5V3zM.343 17.857l2.59-3.257H2.92a.6.6 0 1 0-1.04 0H.302a2 2 0 1 1 3.995 0h-.001c-.048.405-.16.734-.333.988-.175.254-.59.692-1.244 1.312H4.3v1h-4l.043-.043zM7 14.75a.75.75 0 0 1 .75-.75h9.5a.75.75 0 1 1 0 1.5h-9.5a.75.75 0 0 1-.75-.75z"/></svg>',todoList='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="m2.315 14.705 2.224-2.24a.689.689 0 0 1 .963 0 .664.664 0 0 1 0 .949L2.865 16.07a.682.682 0 0 1-.112.089.647.647 0 0 1-.852-.051L.688 14.886a.635.635 0 0 1 0-.903.647.647 0 0 1 .91 0l.717.722zm5.185.045a.75.75 0 0 1 .75-.75h9.5a.75.75 0 1 1 0 1.5h-9.5a.75.75 0 0 1-.75-.75zM2.329 5.745l2.21-2.226a.689.689 0 0 1 .963 0 .664.664 0 0 1 0 .95L2.865 7.125a.685.685 0 0 1-.496.196.644.644 0 0 1-.468-.187L.688 5.912a.635.635 0 0 1 0-.903.647.647 0 0 1 .91 0l.73.736zM7.5 5.75A.75.75 0 0 1 8.25 5h9.5a.75.75 0 1 1 0 1.5h-9.5a.75.75 0 0 1-.75-.75z"/></svg>',codeBlock='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M12.87 12.61a.75.75 0 0 1-.089.976l-.085.07-3.154 2.254 3.412 2.414a.75.75 0 0 1 .237.95l-.057.095a.75.75 0 0 1-.95.237l-.096-.058-4.272-3.022-.003-1.223 4.01-2.867a.75.75 0 0 1 1.047.174zm2.795-.231.095.057 4.011 2.867-.003 1.223-4.272 3.022-.095.058a.75.75 0 0 1-.88-.151l-.07-.086-.058-.095a.75.75 0 0 1 .15-.88l.087-.07 3.412-2.414-3.154-2.253-.085-.071a.75.75 0 0 1 .862-1.207zM16 0a2 2 0 0 1 2 2v9.354l-.663-.492-.837-.001V2a.5.5 0 0 0-.5-.5H2a.5.5 0 0 0-.5.5v15a.5.5 0 0 0 .5.5h3.118L7.156 19H2a2 2 0 0 1-2-2V2a2 2 0 0 1 2-2h14zM5.009 15l.003 1H3v-1h2.009zm2.188-2-1.471 1H5v-1h2.197zM10 11v.095L8.668 12H7v-1h3zm4-2v1H7V9h7zm0-2v1H7V7h7zm-4-2v1H5V5h5zM6 3v1H3V3h3z"/></svg>',browseFiles='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M11.627 16.5zm5.873-.196zm0-7.001V8h-13v8.5h4.341c.191.54.457 1.044.785 1.5H2a1.5 1.5 0 0 1-1.5-1.5v-13A1.5 1.5 0 0 1 2 2h4.5a1.5 1.5 0 0 1 1.06.44L9.122 4H16a1.5 1.5 0 0 1 1.5 1.5v1A1.5 1.5 0 0 1 19 8v2.531a6.027 6.027 0 0 0-1.5-1.228zM16 6.5v-1H8.5l-2-2H2v13h1V8a1.5 1.5 0 0 1 1.5-1.5H16z"/><path d="M14.5 19.5a5 5 0 1 1 0-10 5 5 0 0 1 0 10zM15 14v-2h-1v2h-2v1h2v2h1v-2h2v-1h-2z"/></svg>',heading1='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M19 9v10h-2v-8h-2V9h4zM4 8.5h5V4a1 1 0 0 1 1-1h.5a1 1 0 0 1 1 1v11.5a1 1 0 0 1-1 1H10a1 1 0 0 1-1-1V11H4v4.5a1 1 0 0 1-1 1h-.5a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1H3a1 1 0 0 1 1 1v4.5z"/></svg>',heading2='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M3 8.5h5V4a1 1 0 0 1 1-1h.5a1 1 0 0 1 1 1v11.5a1 1 0 0 1-1 1H9a1 1 0 0 1-1-1V11H3v4.5a1 1 0 0 1-1 1h-.5a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1H2a1 1 0 0 1 1 1v4.5zm16.076 8.343V18.5h-6.252c.067-.626.27-1.22.61-1.78.338-.561 1.006-1.305 2.005-2.232.804-.749 1.297-1.257 1.479-1.523.245-.368.368-.732.368-1.092 0-.398-.107-.703-.32-.917-.214-.214-.51-.32-.886-.32-.372 0-.669.111-.889.336-.22.224-.347.596-.38 1.117l-1.778-.178c.106-.982.438-1.686.997-2.114.558-.427 1.257-.64 2.095-.64.918 0 1.64.247 2.164.742.525.495.787 1.11.787 1.847 0 .419-.075.818-.225 1.197-.15.378-.388.775-.714 1.19-.216.275-.605.67-1.168 1.187-.563.516-.92.859-1.07 1.028a3.11 3.11 0 0 0-.365.495h3.542z"/></svg>',heading3='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M3 8.5h5V4a1 1 0 0 1 1-1h.5a1 1 0 0 1 1 1v11.5a1 1 0 0 1-1 1H9a1 1 0 0 1-1-1V11H3v4.5a1 1 0 0 1-1 1h-.5a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1H2a1 1 0 0 1 1 1v4.5zm9.989 7.53 1.726-.209c.055.44.203.777.445 1.01.24.232.533.349.876.349.368 0 .678-.14.93-.42.251-.279.377-.655.377-1.13 0-.448-.12-.803-.362-1.066a1.153 1.153 0 0 0-.882-.393c-.228 0-.501.044-.819.133l.197-1.453c.482.012.85-.092 1.105-.315.253-.222.38-.517.38-.885 0-.313-.093-.563-.279-.75-.186-.185-.434-.278-.743-.278a1.07 1.07 0 0 0-.78.317c-.216.212-.347.52-.394.927l-1.644-.28c.114-.562.287-1.012.517-1.348.231-.337.553-.601.965-.794a3.24 3.24 0 0 1 1.387-.289c.876 0 1.579.28 2.108.838.436.457.653.973.653 1.549 0 .817-.446 1.468-1.339 1.955.533.114.96.37 1.28.768.319.398.478.878.478 1.441 0 .817-.298 1.513-.895 2.088-.596.576-1.339.864-2.228.864-.842 0-1.54-.243-2.094-.727-.555-.485-.876-1.118-.965-1.901z"/></svg>',heading4='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M3.5 8.5h5V4a1 1 0 0 1 1-1h.5a1 1 0 0 1 1 1v11.5a1 1 0 0 1-1 1h-.5a1 1 0 0 1-1-1V11h-5v4.5a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1h.5a1 1 0 0 1 1 1v4.5zm13.55 10v-1.873h-3.81v-1.561l4.037-5.91h1.498v5.904h1.156v1.567h-1.156V18.5H17.05zm0-3.44v-3.18l-2.14 3.18h2.14z"/></svg>',heading5='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M3.5 8.5h5V4a1 1 0 0 1 1-1h.5a1 1 0 0 1 1 1v11.5a1 1 0 0 1-1 1h-.5a1 1 0 0 1-1-1V11h-5v4.5a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1h.5a1 1 0 0 1 1 1v4.5zm9.578 7.607 1.777-.184c.05.402.201.72.45.955a1.223 1.223 0 0 0 1.81-.101c.258-.303.387-.759.387-1.368 0-.572-.128-1-.384-1.286-.256-.285-.59-.428-1-.428-.512 0-.971.226-1.377.679l-1.448-.21.915-4.843h4.716v1.67H15.56l-.28 1.58a2.697 2.697 0 0 1 1.219-.298 2.68 2.68 0 0 1 2.012.863c.55.576.825 1.323.825 2.241a3.36 3.36 0 0 1-.666 2.05c-.605.821-1.445 1.232-2.52 1.232-.86 0-1.56-.23-2.101-.692-.542-.461-.866-1.081-.971-1.86z"/></svg>',heading6='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M3.5 8.5h5V4a1 1 0 0 1 1-1h.5a1 1 0 0 1 1 1v11.5a1 1 0 0 1-1 1h-.5a1 1 0 0 1-1-1V11h-5v4.5a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1h.5a1 1 0 0 1 1 1v4.5zm15.595 2.973-1.726.19c-.043-.355-.153-.617-.33-.787-.178-.169-.409-.253-.692-.253-.377 0-.695.169-.956.507-.26.339-.424 1.043-.492 2.114.445-.525.997-.787 1.657-.787.745 0 1.383.284 1.914.85.531.568.797 1.3.797 2.197 0 .952-.28 1.716-.838 2.291-.559.576-1.276.864-2.152.864-.94 0-1.712-.365-2.317-1.095-.605-.73-.908-1.927-.908-3.59 0-1.705.316-2.935.946-3.688.63-.753 1.45-1.13 2.457-1.13.706 0 1.291.198 1.755.594.463.395.758.97.885 1.723zm-4.043 3.891c0 .58.133 1.028.4 1.343.266.315.57.473.914.473.33 0 .605-.13.825-.388.22-.258.33-.68.33-1.27 0-.604-.118-1.047-.355-1.329a1.115 1.115 0 0 0-.89-.422c-.342 0-.632.134-.869.403s-.355.666-.355 1.19z"/></svg>',horizontalLine='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M2 9h16v2H2z"/></svg>',html='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M17 0a2 2 0 0 1 2 2v7a1 1 0 0 1 1 1v5a1 1 0 0 1-.883.993l-.118.006L19 17a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2l-.001-1.001-.116-.006A1 1 0 0 1 0 15v-5a1 1 0 0 1 .999-1L1 2a2 2 0 0 1 2-2h14zm.499 15.999h-15L2.5 17a.5.5 0 0 0 .5.5h14a.5.5 0 0 0 .5-.5l-.001-1.001zm-3.478-6.013-.014.014H14v.007l-1.525 1.525-1.46-1.46-.015.013V10h-1v5h1v-3.53l1.428 1.43.048.043.131-.129L14 11.421V15h1v-5h-.965l-.014-.014zM2 10H1v5h1v-2h2v2h1v-5H4v2H2v-2zm7 0H6v1h1v4h1v-4h1v-1zm8 0h-1v5h3v-1h-2v-4zm0-8.5H3a.5.5 0 0 0-.5.5l-.001 6.999h15L17.5 2a.5.5 0 0 0-.5-.5zM10 7v1H4V7h6zm3-2v1H4V5h9zm-3-2v1H4V3h6z"/></svg>',indent='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M2 3.75c0 .414.336.75.75.75h14.5a.75.75 0 1 0 0-1.5H2.75a.75.75 0 0 0-.75.75zm5 6c0 .414.336.75.75.75h9.5a.75.75 0 1 0 0-1.5h-9.5a.75.75 0 0 0-.75.75zM2.75 16.5h14.5a.75.75 0 1 0 0-1.5H2.75a.75.75 0 1 0 0 1.5zM1.632 6.95 5.02 9.358a.4.4 0 0 1-.013.661l-3.39 2.207A.4.4 0 0 1 1 11.892V7.275a.4.4 0 0 1 .632-.326z"/></svg>',outdent='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M2 3.75c0 .414.336.75.75.75h14.5a.75.75 0 1 0 0-1.5H2.75a.75.75 0 0 0-.75.75zm5 6c0 .414.336.75.75.75h9.5a.75.75 0 1 0 0-1.5h-9.5a.75.75 0 0 0-.75.75zM2.75 16.5h14.5a.75.75 0 1 0 0-1.5H2.75a.75.75 0 1 0 0 1.5zm1.618-9.55L.98 9.358a.4.4 0 0 0 .013.661l3.39 2.207A.4.4 0 0 0 5 11.892V7.275a.4.4 0 0 0-.632-.326z"/></svg>',table='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M3 5.5v3h4v-3H3Zm0 4v3h4v-3H3Zm0 4v3h4v-3H3Zm5 3h4v-3H8v3Zm5 0h4v-3h-4v3Zm4-4v-3h-4v3h4Zm0-4v-3h-4v3h4Zm1.5 8A1.5 1.5 0 0 1 17 18H3a1.5 1.5 0 0 1-1.5-1.5V3c.222-.863 1.068-1.5 2-1.5h13c.932 0 1.778.637 2 1.5v13.5Zm-6.5-4v-3H8v3h4Zm0-4v-3H8v3h4Z"/></svg>';const icons={bold,cancel,caption,check,cog,colorPalette,eraser,history,image,imageUpload,imageAssetManager,imageUrl,lowVision,textAlternative,loupe,previousArrow,nextArrow,importExport,paragraph,plus,text,alignBottom,alignMiddle,alignTop,alignLeft,alignCenter,alignRight,alignJustify,objectLeft,objectCenter,objectRight,objectFullWidth,objectInline,objectBlockLeft,objectBlockRight,objectSizeCustom,objectSizeFull,objectSizeLarge,objectSizeSmall,objectSizeMedium,pencil,pilcrow,quote,threeVerticalDots,dragIndicator,redo,undo,bulletedList,numberedList,todoList,codeBlock,browseFiles,heading1,heading2,heading3,heading4,heading5,heading6,horizontalLine,html,indent,outdent,table};/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */let FileReader$1=class extends ObservableMixin(){constructor(){super();Re(this,"total");Re(this,"_reader");Re(this,"_data");const t=new window.FileReader;this._reader=t,this._data=void 0,this.set("loaded",0),t.onprogress=te=>{this.loaded=te.loaded}}get error(){return this._reader.error}get data(){return this._data}read(t){const te=this._reader;return this.total=t.size,new Promise((be,xe)=>{te.onload=()=>{const ve=te.result;this._data=ve,be(ve)},te.onerror=()=>{xe("error")},te.onabort=()=>{xe("aborted")},this._reader.readAsDataURL(t)})}abort(){this._reader.abort()}};class FileRepository extends Plugin{constructor(){super(...arguments);Re(this,"loaders",new Collection);Re(this,"_loadersMap",new Map);Re(this,"_pendingAction",null)}static get pluginName(){return"FileRepository"}static get requires(){return[PendingActions]}init(){this.loaders.on("change",()=>this._updatePendingAction()),this.set("uploaded",0),this.set("uploadTotal",null),this.bind("uploadedPercent").to(this,"uploaded",this,"uploadTotal",(t,te)=>te?t/te*100:0)}getLoader(t){return this._loadersMap.get(t)||null}createLoader(t){if(!this.createUploadAdapter)return logWarning("filerepository-no-upload-adapter"),null;const te=new FileLoader(Promise.resolve(t),this.createUploadAdapter);return this.loaders.add(te),this._loadersMap.set(t,te),t instanceof Promise&&te.file.then(be=>{this._loadersMap.set(be,te)}).catch(()=>{}),te.on("change:uploaded",()=>{let be=0;for(const xe of this.loaders)be+=xe.uploaded;this.uploaded=be}),te.on("change:uploadTotal",()=>{let be=0;for(const xe of this.loaders)xe.uploadTotal&&(be+=xe.uploadTotal);this.uploadTotal=be}),te}destroyLoader(t){const te=t instanceof FileLoader?t:this.getLoader(t);te._destroy(),this.loaders.remove(te),this._loadersMap.forEach((be,xe)=>{be===te&&this._loadersMap.delete(xe)})}_updatePendingAction(){const t=this.editor.plugins.get(PendingActions);if(this.loaders.length){if(!this._pendingAction){const te=this.editor.t,be=xe=>`${te("Upload in progress")} ${parseInt(xe)}%.`;this._pendingAction=t.add(be(this.uploadedPercent)),this._pendingAction.bind("message").to(this,"uploadedPercent",be)}}else t.remove(this._pendingAction),this._pendingAction=null}}class FileLoader extends ObservableMixin(){constructor(t,te){super();Re(this,"id");Re(this,"_filePromiseWrapper");Re(this,"_adapter");Re(this,"_reader");this.id=uid(),this._filePromiseWrapper=this._createFilePromiseWrapper(t),this._adapter=te(this),this._reader=new FileReader$1,this.set("status","idle"),this.set("uploaded",0),this.set("uploadTotal",null),this.bind("uploadedPercent").to(this,"uploaded",this,"uploadTotal",(be,xe)=>xe?be/xe*100:0),this.set("uploadResponse",null)}get file(){return this._filePromiseWrapper?this._filePromiseWrapper.promise.then(t=>this._filePromiseWrapper?t:null):Promise.resolve(null)}get data(){return this._reader.data}read(){if(this.status!="idle")throw new CKEditorError("filerepository-read-wrong-status",this);return this.status="reading",this.file.then(t=>this._reader.read(t)).then(t=>{if(this.status!=="reading")throw this.status;return this.status="idle",t}).catch(t=>{throw t==="aborted"?(this.status="aborted","aborted"):(this.status="error",this._reader.error?this._reader.error:t)})}upload(){if(this.status!="idle")throw new CKEditorError("filerepository-upload-wrong-status",this);return this.status="uploading",this.file.then(()=>this._adapter.upload()).then(t=>(this.uploadResponse=t,this.status="idle",t)).catch(t=>{throw this.status==="aborted"?"aborted":(this.status="error",t)})}abort(){const t=this.status;this.status="aborted",this._filePromiseWrapper.isFulfilled?t=="reading"?this._reader.abort():t=="uploading"&&this._adapter.abort&&this._adapter.abort():(this._filePromiseWrapper.promise.catch(()=>{}),this._filePromiseWrapper.rejecter("aborted")),this._destroy()}_destroy(){this._filePromiseWrapper=void 0,this._reader=void 0,this._adapter=void 0,this.uploadResponse=void 0}_createFilePromiseWrapper(t){const te={};return te.promise=new Promise((be,xe)=>{te.rejecter=xe,te.isFulfilled=!1,t.then(ve=>{te.isFulfilled=!0,be(ve)}).catch(ve=>{te.isFulfilled=!0,xe(ve)})}),te}}var colorName$1={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};const names=getDefaultExportFromCjs(colorName$1);var baseHues={red:0,orange:60,yellow:120,green:180,blue:240,purple:300};function parse$2(Te){var we,t=[],te=1,be;if(typeof Te=="string")if(names[Te])t=names[Te].slice(),be="rgb";else if(Te==="transparent")te=0,be="rgb",t=[0,0,0];else if(/^#[A-Fa-f0-9]+$/.test(Te)){var xe=Te.slice(1),ve=xe.length,ke=ve<=4;te=1,ke?(t=[parseInt(xe[0]+xe[0],16),parseInt(xe[1]+xe[1],16),parseInt(xe[2]+xe[2],16)],ve===4&&(te=parseInt(xe[3]+xe[3],16)/255)):(t=[parseInt(xe[0]+xe[1],16),parseInt(xe[2]+xe[3],16),parseInt(xe[4]+xe[5],16)],ve===8&&(te=parseInt(xe[6]+xe[7],16)/255)),t[0]||(t[0]=0),t[1]||(t[1]=0),t[2]||(t[2]=0),be="rgb"}else if(we=/^((?:rgb|hs[lvb]|hwb|cmyk?|xy[zy]|gray|lab|lchu?v?|[ly]uv|lms)a?)\s*\(([^\)]*)\)/.exec(Te)){var Ie=we[1],Ae=Ie==="rgb",xe=Ie.replace(/a$/,"");be=xe;var ve=xe==="cmyk"?4:xe==="gray"?1:3;t=we[2].trim().split(/\s*[,\/]\s*|\s+/).map(function(Ve,Me){if(/%$/.test(Ve))return Me===ve?parseFloat(Ve)/100:xe==="rgb"?parseFloat(Ve)*255/100:parseFloat(Ve);if(xe[Me]==="h"){if(/deg$/.test(Ve))return parseFloat(Ve);if(baseHues[Ve]!==void 0)return baseHues[Ve]}return parseFloat(Ve)}),Ie===xe&&t.push(1),te=Ae||t[ve]===void 0?1:t[ve],t=t.slice(0,ve)}else Te.length>10&&/[0-9](?:\s|\/)/.test(Te)&&(t=Te.match(/([0-9]+)/g).map(function(Se){return parseFloat(Se)}),be=Te.match(/([a-z])/ig).join("").toLowerCase());else isNaN(Te)?Array.isArray(Te)||Te.length?(t=[Te[0],Te[1],Te[2]],be="rgb",te=Te.length===4?Te[3]:1):Te instanceof Object&&(Te.r!=null||Te.red!=null||Te.R!=null?(be="rgb",t=[Te.r||Te.red||Te.R||0,Te.g||Te.green||Te.G||0,Te.b||Te.blue||Te.B||0]):(be="hsl",t=[Te.h||Te.hue||Te.H||0,Te.s||Te.saturation||Te.S||0,Te.l||Te.lightness||Te.L||Te.b||Te.brightness]),te=Te.a||Te.alpha||Te.opacity||1,Te.opacity!=null&&(te/=100)):(be="rgb",t=[Te>>>16,(Te&65280)>>>8,Te&255]);return{space:be,values:t,alpha:te}}var colorName={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};const cssKeywords=colorName,reverseKeywords={};for(const Te of Object.keys(cssKeywords))reverseKeywords[cssKeywords[Te]]=Te;const convert$3={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};var conversions$2=convert$3;for(const Te of Object.keys(convert$3)){if(!("channels"in convert$3[Te]))throw new Error("missing channels property: "+Te);if(!("labels"in convert$3[Te]))throw new Error("missing channel labels property: "+Te);if(convert$3[Te].labels.length!==convert$3[Te].channels)throw new Error("channel and label counts mismatch: "+Te);const{channels:we,labels:t}=convert$3[Te];delete convert$3[Te].channels,delete convert$3[Te].labels,Object.defineProperty(convert$3[Te],"channels",{value:we}),Object.defineProperty(convert$3[Te],"labels",{value:t})}convert$3.rgb.hsl=function(Te){const we=Te[0]/255,t=Te[1]/255,te=Te[2]/255,be=Math.min(we,t,te),xe=Math.max(we,t,te),ve=xe-be;let ke,Ie;xe===be?ke=0:we===xe?ke=(t-te)/ve:t===xe?ke=2+(te-we)/ve:te===xe&&(ke=4+(we-t)/ve),ke=Math.min(ke*60,360),ke<0&&(ke+=360);const Ae=(be+xe)/2;return xe===be?Ie=0:Ae<=.5?Ie=ve/(xe+be):Ie=ve/(2-xe-be),[ke,Ie*100,Ae*100]};convert$3.rgb.hsv=function(Te){let we,t,te,be,xe;const ve=Te[0]/255,ke=Te[1]/255,Ie=Te[2]/255,Ae=Math.max(ve,ke,Ie),Se=Ae-Math.min(ve,ke,Ie),Oe=function(Ve){return(Ae-Ve)/6/Se+1/2};return Se===0?(be=0,xe=0):(xe=Se/Ae,we=Oe(ve),t=Oe(ke),te=Oe(Ie),ve===Ae?be=te-t:ke===Ae?be=1/3+we-te:Ie===Ae&&(be=2/3+t-we),be<0?be+=1:be>1&&(be-=1)),[be*360,xe*100,Ae*100]};convert$3.rgb.hwb=function(Te){const we=Te[0],t=Te[1];let te=Te[2];const be=convert$3.rgb.hsl(Te)[0],xe=1/255*Math.min(we,Math.min(t,te));return te=1-1/255*Math.max(we,Math.max(t,te)),[be,xe*100,te*100]};convert$3.rgb.cmyk=function(Te){const we=Te[0]/255,t=Te[1]/255,te=Te[2]/255,be=Math.min(1-we,1-t,1-te),xe=(1-we-be)/(1-be)||0,ve=(1-t-be)/(1-be)||0,ke=(1-te-be)/(1-be)||0;return[xe*100,ve*100,ke*100,be*100]};function comparativeDistance(Te,we){return(Te[0]-we[0])**2+(Te[1]-we[1])**2+(Te[2]-we[2])**2}convert$3.rgb.keyword=function(Te){const we=reverseKeywords[Te];if(we)return we;let t=1/0,te;for(const be of Object.keys(cssKeywords)){const xe=cssKeywords[be],ve=comparativeDistance(Te,xe);ve<t&&(t=ve,te=be)}return te};convert$3.keyword.rgb=function(Te){return cssKeywords[Te]};convert$3.rgb.xyz=function(Te){let we=Te[0]/255,t=Te[1]/255,te=Te[2]/255;we=we>.04045?((we+.055)/1.055)**2.4:we/12.92,t=t>.04045?((t+.055)/1.055)**2.4:t/12.92,te=te>.04045?((te+.055)/1.055)**2.4:te/12.92;const be=we*.4124+t*.3576+te*.1805,xe=we*.2126+t*.7152+te*.0722,ve=we*.0193+t*.1192+te*.9505;return[be*100,xe*100,ve*100]};convert$3.rgb.lab=function(Te){const we=convert$3.rgb.xyz(Te);let t=we[0],te=we[1],be=we[2];t/=95.047,te/=100,be/=108.883,t=t>.008856?t**(1/3):7.787*t+16/116,te=te>.008856?te**(1/3):7.787*te+16/116,be=be>.008856?be**(1/3):7.787*be+16/116;const xe=116*te-16,ve=500*(t-te),ke=200*(te-be);return[xe,ve,ke]};convert$3.hsl.rgb=function(Te){const we=Te[0]/360,t=Te[1]/100,te=Te[2]/100;let be,xe,ve;if(t===0)return ve=te*255,[ve,ve,ve];te<.5?be=te*(1+t):be=te+t-te*t;const ke=2*te-be,Ie=[0,0,0];for(let Ae=0;Ae<3;Ae++)xe=we+1/3*-(Ae-1),xe<0&&xe++,xe>1&&xe--,6*xe<1?ve=ke+(be-ke)*6*xe:2*xe<1?ve=be:3*xe<2?ve=ke+(be-ke)*(2/3-xe)*6:ve=ke,Ie[Ae]=ve*255;return Ie};convert$3.hsl.hsv=function(Te){const we=Te[0];let t=Te[1]/100,te=Te[2]/100,be=t;const xe=Math.max(te,.01);te*=2,t*=te<=1?te:2-te,be*=xe<=1?xe:2-xe;const ve=(te+t)/2,ke=te===0?2*be/(xe+be):2*t/(te+t);return[we,ke*100,ve*100]};convert$3.hsv.rgb=function(Te){const we=Te[0]/60,t=Te[1]/100;let te=Te[2]/100;const be=Math.floor(we)%6,xe=we-Math.floor(we),ve=255*te*(1-t),ke=255*te*(1-t*xe),Ie=255*te*(1-t*(1-xe));switch(te*=255,be){case 0:return[te,Ie,ve];case 1:return[ke,te,ve];case 2:return[ve,te,Ie];case 3:return[ve,ke,te];case 4:return[Ie,ve,te];case 5:return[te,ve,ke]}};convert$3.hsv.hsl=function(Te){const we=Te[0],t=Te[1]/100,te=Te[2]/100,be=Math.max(te,.01);let xe,ve;ve=(2-t)*te;const ke=(2-t)*be;return xe=t*be,xe/=ke<=1?ke:2-ke,xe=xe||0,ve/=2,[we,xe*100,ve*100]};convert$3.hwb.rgb=function(Te){const we=Te[0]/360;let t=Te[1]/100,te=Te[2]/100;const be=t+te;let xe;be>1&&(t/=be,te/=be);const ve=Math.floor(6*we),ke=1-te;xe=6*we-ve,ve&1&&(xe=1-xe);const Ie=t+xe*(ke-t);let Ae,Se,Oe;switch(ve){default:case 6:case 0:Ae=ke,Se=Ie,Oe=t;break;case 1:Ae=Ie,Se=ke,Oe=t;break;case 2:Ae=t,Se=ke,Oe=Ie;break;case 3:Ae=t,Se=Ie,Oe=ke;break;case 4:Ae=Ie,Se=t,Oe=ke;break;case 5:Ae=ke,Se=t,Oe=Ie;break}return[Ae*255,Se*255,Oe*255]};convert$3.cmyk.rgb=function(Te){const we=Te[0]/100,t=Te[1]/100,te=Te[2]/100,be=Te[3]/100,xe=1-Math.min(1,we*(1-be)+be),ve=1-Math.min(1,t*(1-be)+be),ke=1-Math.min(1,te*(1-be)+be);return[xe*255,ve*255,ke*255]};convert$3.xyz.rgb=function(Te){const we=Te[0]/100,t=Te[1]/100,te=Te[2]/100;let be,xe,ve;return be=we*3.2406+t*-1.5372+te*-.4986,xe=we*-.9689+t*1.8758+te*.0415,ve=we*.0557+t*-.204+te*1.057,be=be>.0031308?1.055*be**(1/2.4)-.055:be*12.92,xe=xe>.0031308?1.055*xe**(1/2.4)-.055:xe*12.92,ve=ve>.0031308?1.055*ve**(1/2.4)-.055:ve*12.92,be=Math.min(Math.max(0,be),1),xe=Math.min(Math.max(0,xe),1),ve=Math.min(Math.max(0,ve),1),[be*255,xe*255,ve*255]};convert$3.xyz.lab=function(Te){let we=Te[0],t=Te[1],te=Te[2];we/=95.047,t/=100,te/=108.883,we=we>.008856?we**(1/3):7.787*we+16/116,t=t>.008856?t**(1/3):7.787*t+16/116,te=te>.008856?te**(1/3):7.787*te+16/116;const be=116*t-16,xe=500*(we-t),ve=200*(t-te);return[be,xe,ve]};convert$3.lab.xyz=function(Te){const we=Te[0],t=Te[1],te=Te[2];let be,xe,ve;xe=(we+16)/116,be=t/500+xe,ve=xe-te/200;const ke=xe**3,Ie=be**3,Ae=ve**3;return xe=ke>.008856?ke:(xe-16/116)/7.787,be=Ie>.008856?Ie:(be-16/116)/7.787,ve=Ae>.008856?Ae:(ve-16/116)/7.787,be*=95.047,xe*=100,ve*=108.883,[be,xe,ve]};convert$3.lab.lch=function(Te){const we=Te[0],t=Te[1],te=Te[2];let be;be=Math.atan2(te,t)*360/2/Math.PI,be<0&&(be+=360);const ve=Math.sqrt(t*t+te*te);return[we,ve,be]};convert$3.lch.lab=function(Te){const we=Te[0],t=Te[1],be=Te[2]/360*2*Math.PI,xe=t*Math.cos(be),ve=t*Math.sin(be);return[we,xe,ve]};convert$3.rgb.ansi16=function(Te,we=null){const[t,te,be]=Te;let xe=we===null?convert$3.rgb.hsv(Te)[2]:we;if(xe=Math.round(xe/50),xe===0)return 30;let ve=30+(Math.round(be/255)<<2|Math.round(te/255)<<1|Math.round(t/255));return xe===2&&(ve+=60),ve};convert$3.hsv.ansi16=function(Te){return convert$3.rgb.ansi16(convert$3.hsv.rgb(Te),Te[2])};convert$3.rgb.ansi256=function(Te){const we=Te[0],t=Te[1],te=Te[2];return we===t&&t===te?we<8?16:we>248?231:Math.round((we-8)/247*24)+232:16+36*Math.round(we/255*5)+6*Math.round(t/255*5)+Math.round(te/255*5)};convert$3.ansi16.rgb=function(Te){let we=Te%10;if(we===0||we===7)return Te>50&&(we+=3.5),we=we/10.5*255,[we,we,we];const t=(~~(Te>50)+1)*.5,te=(we&1)*t*255,be=(we>>1&1)*t*255,xe=(we>>2&1)*t*255;return[te,be,xe]};convert$3.ansi256.rgb=function(Te){if(Te>=232){const xe=(Te-232)*10+8;return[xe,xe,xe]}Te-=16;let we;const t=Math.floor(Te/36)/5*255,te=Math.floor((we=Te%36)/6)/5*255,be=we%6/5*255;return[t,te,be]};convert$3.rgb.hex=function(Te){const t=(((Math.round(Te[0])&255)<<16)+((Math.round(Te[1])&255)<<8)+(Math.round(Te[2])&255)).toString(16).toUpperCase();return"000000".substring(t.length)+t};convert$3.hex.rgb=function(Te){const we=Te.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!we)return[0,0,0];let t=we[0];we[0].length===3&&(t=t.split("").map(ke=>ke+ke).join(""));const te=parseInt(t,16),be=te>>16&255,xe=te>>8&255,ve=te&255;return[be,xe,ve]};convert$3.rgb.hcg=function(Te){const we=Te[0]/255,t=Te[1]/255,te=Te[2]/255,be=Math.max(Math.max(we,t),te),xe=Math.min(Math.min(we,t),te),ve=be-xe;let ke,Ie;return ve<1?ke=xe/(1-ve):ke=0,ve<=0?Ie=0:be===we?Ie=(t-te)/ve%6:be===t?Ie=2+(te-we)/ve:Ie=4+(we-t)/ve,Ie/=6,Ie%=1,[Ie*360,ve*100,ke*100]};convert$3.hsl.hcg=function(Te){const we=Te[1]/100,t=Te[2]/100,te=t<.5?2*we*t:2*we*(1-t);let be=0;return te<1&&(be=(t-.5*te)/(1-te)),[Te[0],te*100,be*100]};convert$3.hsv.hcg=function(Te){const we=Te[1]/100,t=Te[2]/100,te=we*t;let be=0;return te<1&&(be=(t-te)/(1-te)),[Te[0],te*100,be*100]};convert$3.hcg.rgb=function(Te){const we=Te[0]/360,t=Te[1]/100,te=Te[2]/100;if(t===0)return[te*255,te*255,te*255];const be=[0,0,0],xe=we%1*6,ve=xe%1,ke=1-ve;let Ie=0;switch(Math.floor(xe)){case 0:be[0]=1,be[1]=ve,be[2]=0;break;case 1:be[0]=ke,be[1]=1,be[2]=0;break;case 2:be[0]=0,be[1]=1,be[2]=ve;break;case 3:be[0]=0,be[1]=ke,be[2]=1;break;case 4:be[0]=ve,be[1]=0,be[2]=1;break;default:be[0]=1,be[1]=0,be[2]=ke}return Ie=(1-t)*te,[(t*be[0]+Ie)*255,(t*be[1]+Ie)*255,(t*be[2]+Ie)*255]};convert$3.hcg.hsv=function(Te){const we=Te[1]/100,t=Te[2]/100,te=we+t*(1-we);let be=0;return te>0&&(be=we/te),[Te[0],be*100,te*100]};convert$3.hcg.hsl=function(Te){const we=Te[1]/100,te=Te[2]/100*(1-we)+.5*we;let be=0;return te>0&&te<.5?be=we/(2*te):te>=.5&&te<1&&(be=we/(2*(1-te))),[Te[0],be*100,te*100]};convert$3.hcg.hwb=function(Te){const we=Te[1]/100,t=Te[2]/100,te=we+t*(1-we);return[Te[0],(te-we)*100,(1-te)*100]};convert$3.hwb.hcg=function(Te){const we=Te[1]/100,te=1-Te[2]/100,be=te-we;let xe=0;return be<1&&(xe=(te-be)/(1-be)),[Te[0],be*100,xe*100]};convert$3.apple.rgb=function(Te){return[Te[0]/65535*255,Te[1]/65535*255,Te[2]/65535*255]};convert$3.rgb.apple=function(Te){return[Te[0]/255*65535,Te[1]/255*65535,Te[2]/255*65535]};convert$3.gray.rgb=function(Te){return[Te[0]/100*255,Te[0]/100*255,Te[0]/100*255]};convert$3.gray.hsl=function(Te){return[0,0,Te[0]]};convert$3.gray.hsv=convert$3.gray.hsl;convert$3.gray.hwb=function(Te){return[0,100,Te[0]]};convert$3.gray.cmyk=function(Te){return[0,0,0,Te[0]]};convert$3.gray.lab=function(Te){return[Te[0],0,0]};convert$3.gray.hex=function(Te){const we=Math.round(Te[0]/100*255)&255,te=((we<<16)+(we<<8)+we).toString(16).toUpperCase();return"000000".substring(te.length)+te};convert$3.rgb.gray=function(Te){return[(Te[0]+Te[1]+Te[2])/3/255*100]};const conversions$1=conversions$2;function buildGraph(){const Te={},we=Object.keys(conversions$1);for(let t=we.length,te=0;te<t;te++)Te[we[te]]={distance:-1,parent:null};return Te}function deriveBFS(Te){const we=buildGraph(),t=[Te];for(we[Te].distance=0;t.length;){const te=t.pop(),be=Object.keys(conversions$1[te]);for(let xe=be.length,ve=0;ve<xe;ve++){const ke=be[ve],Ie=we[ke];Ie.distance===-1&&(Ie.distance=we[te].distance+1,Ie.parent=te,t.unshift(ke))}}return we}function link(Te,we){return function(t){return we(Te(t))}}function wrapConversion(Te,we){const t=[we[Te].parent,Te];let te=conversions$1[we[Te].parent][Te],be=we[Te].parent;for(;we[be].parent;)t.unshift(we[be].parent),te=link(conversions$1[we[be].parent][be],te),be=we[be].parent;return te.conversion=t,te}var route$1=function(Te){const we=deriveBFS(Te),t={},te=Object.keys(we);for(let be=te.length,xe=0;xe<be;xe++){const ve=te[xe];we[ve].parent!==null&&(t[ve]=wrapConversion(ve,we))}return t};const conversions=conversions$2,route=route$1,convert$1={},models=Object.keys(conversions);function wrapRaw(Te){const we=function(...t){const te=t[0];return te==null?te:(te.length>1&&(t=te),Te(t))};return"conversion"in Te&&(we.conversion=Te.conversion),we}function wrapRounded(Te){const we=function(...t){const te=t[0];if(te==null)return te;te.length>1&&(t=te);const be=Te(t);if(typeof be=="object")for(let xe=be.length,ve=0;ve<xe;ve++)be[ve]=Math.round(be[ve]);return be};return"conversion"in Te&&(we.conversion=Te.conversion),we}models.forEach(Te=>{convert$1[Te]={},Object.defineProperty(convert$1[Te],"channels",{value:conversions[Te].channels}),Object.defineProperty(convert$1[Te],"labels",{value:conversions[Te].labels});const we=route(Te);Object.keys(we).forEach(te=>{const be=we[te];convert$1[Te][te]=wrapRounded(be),convert$1[Te][te].raw=wrapRaw(be)})});var colorConvert=convert$1;const index$1=getDefaultExportFromCjs(colorConvert),convert$2=_mergeNamespaces({__proto__:null,default:index$1},[colorConvert]),clamp$1=(Te,we=0,t=1)=>Te>t?t:Te<we?we:Te,round=(Te,we=0,t=Math.pow(10,we))=>Math.round(t*Te)/t,hexToHsva=Te=>rgbaToHsva(hexToRgba(Te)),hexToRgba=Te=>(Te[0]==="#"&&(Te=Te.substring(1)),Te.length<6?{r:parseInt(Te[0]+Te[0],16),g:parseInt(Te[1]+Te[1],16),b:parseInt(Te[2]+Te[2],16),a:Te.length===4?round(parseInt(Te[3]+Te[3],16)/255,2):1}:{r:parseInt(Te.substring(0,2),16),g:parseInt(Te.substring(2,4),16),b:parseInt(Te.substring(4,6),16),a:Te.length===8?round(parseInt(Te.substring(6,8),16)/255,2):1}),hsvaToHex=Te=>rgbaToHex(hsvaToRgba(Te)),hsvaToHsla=({h:Te,s:we,v:t,a:te})=>{const be=(200-we)*t/100;return{h:round(Te),s:round(be>0&&be<200?we*t/100/(be<=100?be:200-be)*100:0),l:round(be/2),a:round(te,2)}},hsvaToHslString=Te=>{const{h:we,s:t,l:te}=hsvaToHsla(Te);return`hsl(${we}, ${t}%, ${te}%)`},hsvaToRgba=({h:Te,s:we,v:t,a:te})=>{Te=Te/360*6,we=we/100,t=t/100;const be=Math.floor(Te),xe=t*(1-we),ve=t*(1-(Te-be)*we),ke=t*(1-(1-Te+be)*we),Ie=be%6;return{r:round([t,ve,xe,xe,ke,t][Ie]*255),g:round([ke,t,t,ve,xe,xe][Ie]*255),b:round([xe,xe,ke,t,t,ve][Ie]*255),a:round(te,2)}},format$1=Te=>{const we=Te.toString(16);return we.length<2?"0"+we:we},rgbaToHex=({r:Te,g:we,b:t,a:te})=>{const be=te<1?format$1(round(te*255)):"";return"#"+format$1(Te)+format$1(we)+format$1(t)+be},rgbaToHsva=({r:Te,g:we,b:t,a:te})=>{const be=Math.max(Te,we,t),xe=be-Math.min(Te,we,t),ve=xe?be===Te?(we-t)/xe:be===we?2+(t-Te)/xe:4+(Te-we)/xe:0;return{h:round(60*(ve<0?ve+6:ve)),s:round(be?xe/be*100:0),v:round(be/255*100),a:te}},equalColorObjects=(Te,we)=>{if(Te===we)return!0;for(const t in Te)if(Te[t]!==we[t])return!1;return!0},equalHex=(Te,we)=>Te.toLowerCase()===we.toLowerCase()?!0:equalColorObjects(hexToRgba(Te),hexToRgba(we)),cache$1={},tpl=Te=>{let we=cache$1[Te];return we||(we=document.createElement("template"),we.innerHTML=Te,cache$1[Te]=we),we},fire=(Te,we,t)=>{Te.dispatchEvent(new CustomEvent(we,{bubbles:!0,detail:t}))};let hasTouched=!1;const isTouch=Te=>"touches"in Te,isValid$1=Te=>hasTouched&&!isTouch(Te)?!1:(hasTouched||(hasTouched=isTouch(Te)),!0),pointerMove=(Te,we)=>{const t=isTouch(we)?we.touches[0]:we,te=Te.el.getBoundingClientRect();fire(Te.el,"move",Te.getMove({x:clamp$1((t.pageX-(te.left+window.pageXOffset))/te.width),y:clamp$1((t.pageY-(te.top+window.pageYOffset))/te.height)}))},keyMove=(Te,we)=>{const t=we.keyCode;t>40||Te.xy&&t<37||t<33||(we.preventDefault(),fire(Te.el,"move",Te.getMove({x:t===39?.01:t===37?-.01:t===34?.05:t===33?-.05:t===35?1:t===36?-1:0,y:t===40?.01:t===38?-.01:0},!0)))};class Slider{constructor(we,t,te,be){const xe=tpl(`<div role="slider" tabindex="0" part="${t}" ${te}><div part="${t}-pointer"></div></div>`);we.appendChild(xe.content.cloneNode(!0));const ve=we.querySelector(`[part=${t}]`);ve.addEventListener("mousedown",this),ve.addEventListener("touchstart",this),ve.addEventListener("keydown",this),this.el=ve,this.xy=be,this.nodes=[ve.firstChild,ve]}set dragging(we){const t=we?document.addEventListener:document.removeEventListener;t(hasTouched?"touchmove":"mousemove",this),t(hasTouched?"touchend":"mouseup",this)}handleEvent(we){switch(we.type){case"mousedown":case"touchstart":if(we.preventDefault(),!isValid$1(we)||!hasTouched&&we.button!=0)return;this.el.focus(),pointerMove(this,we),this.dragging=!0;break;case"mousemove":case"touchmove":we.preventDefault(),pointerMove(this,we);break;case"mouseup":case"touchend":this.dragging=!1;break;case"keydown":keyMove(this,we);break}}style(we){we.forEach((t,te)=>{for(const be in t)this.nodes[te].style.setProperty(be,t[be])})}}class Hue extends Slider{constructor(we){super(we,"hue",'aria-label="Hue" aria-valuemin="0" aria-valuemax="360"',!1)}update({h:we}){this.h=we,this.style([{left:`${we/360*100}%`,color:hsvaToHslString({h:we,s:100,v:100,a:1})}]),this.el.setAttribute("aria-valuenow",`${round(we)}`)}getMove(we,t){return{h:t?clamp$1(this.h+we.x*360,0,360):360*we.x}}}class Saturation extends Slider{constructor(we){super(we,"saturation",'aria-label="Color"',!0)}update(we){this.hsva=we,this.style([{top:`${100-we.v}%`,left:`${we.s}%`,color:hsvaToHslString(we)},{"background-color":hsvaToHslString({h:we.h,s:100,v:100,a:1})}]),this.el.setAttribute("aria-valuetext",`Saturation ${round(we.s)}%, Brightness ${round(we.v)}%`)}getMove(we,t){return{s:t?clamp$1(this.hsva.s+we.x*100,0,100):we.x*100,v:t?clamp$1(this.hsva.v-we.y*100,0,100):Math.round(100-we.y*100)}}}const css=':host{display:flex;flex-direction:column;position:relative;width:200px;height:200px;user-select:none;-webkit-user-select:none;cursor:default}:host([hidden]){display:none!important}[role=slider]{position:relative;touch-action:none;user-select:none;-webkit-user-select:none;outline:0}[role=slider]:last-child{border-radius:0 0 8px 8px}[part$=pointer]{position:absolute;z-index:1;box-sizing:border-box;width:28px;height:28px;display:flex;place-content:center center;transform:translate(-50%,-50%);background-color:#fff;border:2px solid #fff;border-radius:50%;box-shadow:0 2px 4px rgba(0,0,0,.2)}[part$=pointer]::after{content:"";width:100%;height:100%;border-radius:inherit;background-color:currentColor}[role=slider]:focus [part$=pointer]{transform:translate(-50%,-50%) scale(1.1)}',hueCss="[part=hue]{flex:0 0 24px;background:linear-gradient(to right,red 0,#ff0 17%,#0f0 33%,#0ff 50%,#00f 67%,#f0f 83%,red 100%)}[part=hue-pointer]{top:50%;z-index:2}",saturationCss="[part=saturation]{flex-grow:1;border-color:transparent;border-bottom:12px solid #000;border-radius:8px 8px 0 0;background-image:linear-gradient(to top,#000,transparent),linear-gradient(to right,#fff,rgba(255,255,255,0));box-shadow:inset 0 0 0 1px rgba(0,0,0,.05)}[part=saturation-pointer]{z-index:3}",$isSame=Symbol("same"),$color=Symbol("color"),$hsva=Symbol("hsva"),$update=Symbol("update"),$parts=Symbol("parts"),$css=Symbol("css"),$sliders=Symbol("sliders");class ColorPicker extends HTMLElement{static get observedAttributes(){return["color"]}get[$css](){return[css,hueCss,saturationCss]}get[$sliders](){return[Saturation,Hue]}get color(){return this[$color]}set color(we){if(!this[$isSame](we)){const t=this.colorModel.toHsva(we);this[$update](t),this[$color]=we}}constructor(){super();const we=tpl(`<style>${this[$css].join("")}</style>`),t=this.attachShadow({mode:"open"});t.appendChild(we.content.cloneNode(!0)),t.addEventListener("move",this),this[$parts]=this[$sliders].map(te=>new te(t))}connectedCallback(){if(this.hasOwnProperty("color")){const we=this.color;delete this.color,this.color=we}else this.color||(this.color=this.colorModel.defaultColor)}attributeChangedCallback(we,t,te){const be=this.colorModel.fromAttr(te);this[$isSame](be)||(this.color=be)}handleEvent(we){const t=this[$hsva],te={...t,...we.detail};this[$update](te);let be;!equalColorObjects(te,t)&&!this[$isSame](be=this.colorModel.fromHsva(te))&&(this[$color]=be,fire(this,"color-changed",{value:be}))}[$isSame](we){return this.color&&this.colorModel.equal(we,this.color)}[$update](we){this[$hsva]=we,this[$parts].forEach(t=>t.update(we))}}const colorModel={defaultColor:"#000",toHsva:hexToHsva,fromHsva:({h:Te,s:we,v:t})=>hsvaToHex({h:Te,s:we,v:t,a:1}),equal:equalHex,fromAttr:Te=>Te};class HexBase extends ColorPicker{get colorModel(){return colorModel}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class ViewCollection extends Collection{constructor(t=[]){super(t,{idProperty:"viewUid"});Re(this,"_parentElement");this.on("add",(te,be,xe)=>{this._renderViewIntoCollectionParent(be,xe)}),this.on("remove",(te,be)=>{be.element&&this._parentElement&&be.element.remove()}),this._parentElement=null}destroy(){this.map(t=>t.destroy())}setParent(t){this._parentElement=t;for(const te of this)this._renderViewIntoCollectionParent(te)}delegate(...t){if(!t.length||!isStringArray(t))throw new CKEditorError("ui-viewcollection-delegate-wrong-events",this);return{to:te=>{for(const be of this)for(const xe of t)be.delegate(xe).to(te);this.on("add",(be,xe)=>{for(const ve of t)xe.delegate(ve).to(te)}),this.on("remove",(be,xe)=>{for(const ve of t)xe.stopDelegating(ve,te)})}}}_renderViewIntoCollectionParent(t,te){t.isRendered||t.render(),t.element&&this._parentElement&&this._parentElement.insertBefore(t.element,this._parentElement.children[te])}remove(t){return super.remove(t)}}function isStringArray(Te){return Te.every(we=>typeof we=="string")}const xhtmlNs="http://www.w3.org/1999/xhtml";class Template extends EmitterMixin(){constructor(t){super();Re(this,"ns");Re(this,"tag");Re(this,"text");Re(this,"attributes");Re(this,"children");Re(this,"eventListeners");Re(this,"_isRendered");Re(this,"_revertData");Object.assign(this,normalize(clone$2(t))),this._isRendered=!1,this._revertData=null}render(){const t=this._renderNode({intoFragment:!0});return this._isRendered=!0,t}apply(t){return this._revertData=getEmptyRevertData(),this._renderNode({node:t,intoFragment:!1,isApplying:!0,revertData:this._revertData}),t}revert(t){if(!this._revertData)throw new CKEditorError("ui-template-revert-not-applied",[this,t]);this._revertTemplateFromNode(t,this._revertData)}*getViews(){function*t(te){if(te.children)for(const be of te.children)isView$2(be)?yield be:isTemplate(be)&&(yield*t(be))}yield*t(this)}static bind(t,te){return{to(be,xe){return new TemplateToBinding({eventNameOrFunction:be,attribute:be,observable:t,emitter:te,callback:xe})},if(be,xe,ve){return new TemplateIfBinding({observable:t,emitter:te,attribute:be,valueIfTrue:xe,callback:ve})}}}static extend(t,te){if(t._isRendered)throw new CKEditorError("template-extend-render",[this,t]);extendTemplate(t,normalize(clone$2(te)))}_renderNode(t){let te;if(t.node?te=this.tag&&this.text:te=this.tag?this.text:!this.text,te)throw new CKEditorError("ui-template-wrong-syntax",this);return this.text?this._renderText(t):this._renderElement(t)}_renderElement(t){let te=t.node;return te||(te=t.node=document.createElementNS(this.ns||xhtmlNs,this.tag)),this._renderAttributes(t),this._renderElementChildren(t),this._setUpListeners(t),te}_renderText(t){let te=t.node;return te?t.revertData.text=te.textContent:te=t.node=document.createTextNode(""),hasTemplateBinding(this.text)?this._bindToObservable({schema:this.text,updater:getTextUpdater(te),data:t}):te.textContent=this.text.join(""),te}_renderAttributes(t){if(!this.attributes)return;const te=t.node,be=t.revertData;for(const xe in this.attributes){const ve=te.getAttribute(xe),ke=this.attributes[xe];be&&(be.attributes[xe]=ve);const Ie=isNamespaced(ke)?ke[0].ns:null;if(hasTemplateBinding(ke)){const Ae=isNamespaced(ke)?ke[0].value:ke;be&&shouldExtend(xe)&&Ae.unshift(ve),this._bindToObservable({schema:Ae,updater:getAttributeUpdater(te,xe,Ie),data:t})}else if(xe=="style"&&typeof ke[0]!="string")this._renderStyleAttribute(ke[0],t);else{be&&ve&&shouldExtend(xe)&&ke.unshift(ve);const Ae=ke.map(Se=>Se&&(Se.value||Se)).reduce((Se,Oe)=>Se.concat(Oe),[]).reduce(arrayValueReducer,"");isFalsy(Ae)||te.setAttributeNS(Ie,xe,Ae)}}}_renderStyleAttribute(t,te){const be=te.node;for(const xe in t){const ve=t[xe];hasTemplateBinding(ve)?this._bindToObservable({schema:[ve],updater:getStyleUpdater(be,xe),data:te}):be.style[xe]=ve}}_renderElementChildren(t){const te=t.node,be=t.intoFragment?document.createDocumentFragment():te,xe=t.isApplying;let ve=0;for(const ke of this.children)if(isViewCollection(ke)){if(!xe){ke.setParent(te);for(const Ie of ke)be.appendChild(Ie.element)}}else if(isView$2(ke))xe||(ke.isRendered||ke.render(),be.appendChild(ke.element));else if(isNode(ke))be.appendChild(ke);else if(xe){const Ie=t.revertData,Ae=getEmptyRevertData();Ie.children.push(Ae),ke._renderNode({intoFragment:!1,node:be.childNodes[ve++],isApplying:!0,revertData:Ae})}else be.appendChild(ke.render());t.intoFragment&&te.appendChild(be)}_setUpListeners(t){if(this.eventListeners)for(const te in this.eventListeners){const be=this.eventListeners[te].map(xe=>{const[ve,ke]=te.split("@");return xe.activateDomEventListener(ve,ke,t)});t.revertData&&t.revertData.bindings.push(be)}}_bindToObservable({schema:t,updater:te,data:be}){const xe=be.revertData;syncValueSchemaValue(t,te,be);const ve=t.filter(ke=>!isFalsy(ke)).filter(ke=>ke.observable).map(ke=>ke.activateAttributeListener(t,te,be));xe&&xe.bindings.push(ve)}_revertTemplateFromNode(t,te){for(const xe of te.bindings)for(const ve of xe)ve();if(te.text){t.textContent=te.text;return}const be=t;for(const xe in te.attributes){const ve=te.attributes[xe];ve===null?be.removeAttribute(xe):be.setAttribute(xe,ve)}for(let xe=0;xe<te.children.length;++xe)this._revertTemplateFromNode(be.childNodes[xe],te.children[xe])}}class TemplateBinding{constructor(we){Re(this,"attribute");Re(this,"observable");Re(this,"emitter");Re(this,"callback");this.attribute=we.attribute,this.observable=we.observable,this.emitter=we.emitter,this.callback=we.callback}getValue(we){const t=this.observable[this.attribute];return this.callback?this.callback(t,we):t}activateAttributeListener(we,t,te){const be=()=>syncValueSchemaValue(we,t,te);return this.emitter.listenTo(this.observable,`change:${this.attribute}`,be),()=>{this.emitter.stopListening(this.observable,`change:${this.attribute}`,be)}}}class TemplateToBinding extends TemplateBinding{constructor(t){super(t);Re(this,"eventNameOrFunction");this.eventNameOrFunction=t.eventNameOrFunction}activateDomEventListener(t,te,be){const xe=(ve,ke)=>{(!te||ke.target.matches(te))&&(typeof this.eventNameOrFunction=="function"?this.eventNameOrFunction(ke):this.observable.fire(this.eventNameOrFunction,ke))};return this.emitter.listenTo(be.node,t,xe),()=>{this.emitter.stopListening(be.node,t,xe)}}}class TemplateIfBinding extends TemplateBinding{constructor(t){super(t);Re(this,"valueIfTrue");this.valueIfTrue=t.valueIfTrue}getValue(t){const te=super.getValue(t);return isFalsy(te)?!1:this.valueIfTrue||!0}}function hasTemplateBinding(Te){return Te?(Te.value&&(Te=Te.value),Array.isArray(Te)?Te.some(hasTemplateBinding):Te instanceof TemplateBinding):!1}function getValueSchemaValue(Te,we){return Te.map(t=>t instanceof TemplateBinding?t.getValue(we):t)}function syncValueSchemaValue(Te,we,{node:t}){const te=getValueSchemaValue(Te,t);let be;Te.length==1&&Te[0]instanceof TemplateIfBinding?be=te[0]:be=te.reduce(arrayValueReducer,""),isFalsy(be)?we.remove():we.set(be)}function getTextUpdater(Te){return{set(we){Te.textContent=we},remove(){Te.textContent=""}}}function getAttributeUpdater(Te,we,t){return{set(te){Te.setAttributeNS(t,we,te)},remove(){Te.removeAttributeNS(t,we)}}}function getStyleUpdater(Te,we){return{set(t){Te.style[we]=t},remove(){Te.style[we]=null}}}function clone$2(Te){return cloneDeepWith(Te,t=>{if(t&&(t instanceof TemplateBinding||isTemplate(t)||isView$2(t)||isViewCollection(t)))return t})}function normalize(Te){if(typeof Te=="string"?Te=normalizePlainTextDefinition(Te):Te.text&&normalizeTextDefinition(Te),Te.on&&(Te.eventListeners=normalizeListeners(Te.on),delete Te.on),!Te.text){Te.attributes&&normalizeAttributes(Te.attributes);const we=[];if(Te.children)if(isViewCollection(Te.children))we.push(Te.children);else for(const t of Te.children)isTemplate(t)||isView$2(t)||isNode(t)?we.push(t):we.push(new Template(t));Te.children=we}return Te}function normalizeAttributes(Te){for(const we in Te)Te[we].value&&(Te[we].value=toArray$2(Te[we].value)),arrayify(Te,we)}function normalizeListeners(Te){for(const we in Te)arrayify(Te,we);return Te}function normalizePlainTextDefinition(Te){return{text:[Te]}}function normalizeTextDefinition(Te){Te.text=toArray$2(Te.text)}function arrayify(Te,we){Te[we]=toArray$2(Te[we])}function arrayValueReducer(Te,we){return isFalsy(we)?Te:isFalsy(Te)?we:`${Te} ${we}`}function extendObjectValueArray(Te,we){for(const t in we)Te[t]?Te[t].push(...we[t]):Te[t]=we[t]}function extendTemplate(Te,we){if(we.attributes&&(Te.attributes||(Te.attributes={}),extendObjectValueArray(Te.attributes,we.attributes)),we.eventListeners&&(Te.eventListeners||(Te.eventListeners={}),extendObjectValueArray(Te.eventListeners,we.eventListeners)),we.text&&Te.text.push(...we.text),we.children&&we.children.length){if(Te.children.length!=we.children.length)throw new CKEditorError("ui-template-extend-children-mismatch",Te);let t=0;for(const te of we.children)extendTemplate(Te.children[t++],te)}}function isFalsy(Te){return!Te&&Te!==0}function isView$2(Te){return Te instanceof View}function isTemplate(Te){return Te instanceof Template}function isViewCollection(Te){return Te instanceof ViewCollection}function isNamespaced(Te){return isObject$2(Te[0])&&Te[0].ns}function getEmptyRevertData(){return{children:[],bindings:[],attributes:{}}}function shouldExtend(Te){return Te=="class"||Te=="style"}class View extends DomEmitterMixin(ObservableMixin()){constructor(t){super();Re(this,"element");Re(this,"isRendered");Re(this,"locale");Re(this,"t");Re(this,"template");Re(this,"_viewCollections");Re(this,"_unboundChildren");Re(this,"_bindTemplate");this.element=null,this.isRendered=!1,this.locale=t,this.t=t&&t.t,this._viewCollections=new Collection,this._unboundChildren=this.createCollection(),this._viewCollections.on("add",(te,be)=>{be.locale=t,be.t=t&&t.t}),this.decorate("render")}get bindTemplate(){return this._bindTemplate?this._bindTemplate:this._bindTemplate=Template.bind(this,this)}createCollection(t){const te=new ViewCollection(t);return this._viewCollections.add(te),te}registerChild(t){isIterable(t)||(t=[t]);for(const te of t)this._unboundChildren.add(te)}deregisterChild(t){isIterable(t)||(t=[t]);for(const te of t)this._unboundChildren.remove(te)}setTemplate(t){this.template=new Template(t)}extendTemplate(t){Template.extend(this.template,t)}render(){if(this.isRendered)throw new CKEditorError("ui-view-render-already-rendered",this);this.template&&(this.element=this.template.render(),this.registerChild(this.template.getViews())),this.isRendered=!0}destroy(){this.stopListening(),this._viewCollections.map(t=>t.destroy()),this.template&&this.template._revertData&&this.template.revert(this.element)}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function clickOutsideHandler({emitter:Te,activator:we,callback:t,contextElements:te}){Te.listenTo(document,"mousedown",(be,xe)=>{if(!we())return;const ve=typeof xe.composedPath=="function"?xe.composedPath():[],ke=typeof te=="function"?te():te;for(const Ie of ke)if(Ie.contains(xe.target)||ve.includes(Ie))return;t()})}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function injectCssTransitionDisabler(Te){const we=Te;we.set("_isCssTransitionsDisabled",!1),we.disableCssTransitions=()=>{we._isCssTransitionsDisabled=!0},we.enableCssTransitions=()=>{we._isCssTransitionsDisabled=!1},we.extendTemplate({attributes:{class:[we.bindTemplate.if("_isCssTransitionsDisabled","ck-transitions-disabled")]}})}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function CssTransitionDisablerMixin(Te){class we extends Te{disableCssTransitions(){this._isCssTransitionsDisabled=!0}enableCssTransitions(){this._isCssTransitionsDisabled=!1}constructor(...te){super(...te),this.set("_isCssTransitionsDisabled",!1),this.initializeCssTransitionDisablerMixin()}initializeCssTransitionDisablerMixin(){this.extendTemplate({attributes:{class:[this.bindTemplate.if("_isCssTransitionsDisabled","ck-transitions-disabled")]}})}}return we}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function submitHandler({view:Te}){Te.listenTo(Te.element,"submit",(we,t)=>{t.preventDefault(),Te.fire("submit")},{useCapture:!0})}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function addKeyboardHandlingForGrid({keystrokeHandler:Te,focusTracker:we,gridItems:t,numberOfColumns:te,uiLanguageDirection:be}){const xe=typeof te=="number"?()=>te:te;Te.set("arrowright",ve((Ae,Se)=>be==="rtl"?Ie(Ae,Se.length):ke(Ae,Se.length))),Te.set("arrowleft",ve((Ae,Se)=>be==="rtl"?ke(Ae,Se.length):Ie(Ae,Se.length))),Te.set("arrowup",ve((Ae,Se)=>{let Oe=Ae-xe();return Oe<0&&(Oe=Ae+xe()*Math.floor(Se.length/xe()),Oe>Se.length-1&&(Oe-=xe())),Oe})),Te.set("arrowdown",ve((Ae,Se)=>{let Oe=Ae+xe();return Oe>Se.length-1&&(Oe=Ae%xe()),Oe}));function ve(Ae){return Se=>{const Oe=t.find(De=>De.element===we.focusedElement),Ve=t.getIndex(Oe),Me=Ae(Ve,t);t.get(Me).focus(),Se.stopPropagation(),Se.preventDefault()}}function ke(Ae,Se){return Ae===Se-1?0:Ae+1}function Ie(Ae,Se){return Ae===0?Se-1:Ae-1}}const o0=class o0 extends View{constructor(){super();const we=this.bindTemplate;this.set("content",""),this.set("viewBox","0 0 20 20"),this.set("fillColor",""),this.set("isColorInherited",!0),this.set("isVisible",!0),this.setTemplate({tag:"svg",ns:"http://www.w3.org/2000/svg",attributes:{class:["ck","ck-icon",we.if("isVisible","ck-hidden",t=>!t),"ck-reset_all-excluded",we.if("isColorInherited","ck-icon_inherit-color")],viewBox:we.to("viewBox")}})}render(){super.render(),this._updateXMLContent(),this._colorFillPaths(),this.on("change:content",()=>{this._updateXMLContent(),this._colorFillPaths()}),this.on("change:fillColor",()=>{this._colorFillPaths()})}_updateXMLContent(){if(this.content){const t=new DOMParser().parseFromString(this.content.trim(),"image/svg+xml").querySelector("svg"),te=t.getAttribute("viewBox");te&&(this.viewBox=te);for(const{name:be,value:xe}of Array.from(t.attributes))o0.presentationalAttributeNames.includes(be)&&this.element.setAttribute(be,xe);for(;this.element.firstChild;)this.element.removeChild(this.element.firstChild);for(;t.childNodes.length>0;)this.element.appendChild(t.childNodes[0])}}_colorFillPaths(){this.fillColor&&this.element.querySelectorAll(".ck-icon__fill").forEach(we=>{we.style.fill=this.fillColor})}};Re(o0,"presentationalAttributeNames",["alignment-baseline","baseline-shift","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-rendering","cursor","direction","display","dominant-baseline","fill","fill-opacity","fill-rule","filter","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","image-rendering","letter-spacing","lighting-color","marker-end","marker-mid","marker-start","mask","opacity","overflow","paint-order","pointer-events","shape-rendering","stop-color","stop-opacity","stroke","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","text-anchor","text-decoration","text-overflow","text-rendering","transform","unicode-bidi","vector-effect","visibility","white-space","word-spacing","writing-mode"]);let IconView=o0;class ButtonLabelView extends View{constructor(){super(),this.set({style:void 0,text:void 0,id:void 0});const we=this.bindTemplate;this.setTemplate({tag:"span",attributes:{class:["ck","ck-button__label"],style:we.to("style"),id:we.to("id")},children:[{text:we.to("text")}]})}}class ButtonView extends View{constructor(t,te=new ButtonLabelView){super(t);Re(this,"children");Re(this,"labelView");Re(this,"iconView");Re(this,"keystrokeView");Re(this,"_focusDelayed",null);const be=this.bindTemplate,xe=uid();this.set("ariaLabel",void 0),this.set("ariaLabelledBy",`ck-editor__aria-label_${xe}`),this.set("class",void 0),this.set("labelStyle",void 0),this.set("icon",void 0),this.set("isEnabled",!0),this.set("isOn",!1),this.set("isVisible",!0),this.set("isToggleable",!1),this.set("keystroke",void 0),this.set("label",void 0),this.set("role",void 0),this.set("tabindex",-1),this.set("tooltip",!1),this.set("tooltipPosition","s"),this.set("type","button"),this.set("withText",!1),this.set("withKeystroke",!1),this.children=this.createCollection(),this.labelView=this._setupLabelView(te),this.iconView=new IconView,this.iconView.extendTemplate({attributes:{class:"ck-button__icon"}}),this.keystrokeView=this._createKeystrokeView(),this.bind("_tooltipString").to(this,"tooltip",this,"label",this,"keystroke",this._getTooltipString.bind(this));const ve={tag:"button",attributes:{class:["ck","ck-button",be.to("class"),be.if("isEnabled","ck-disabled",ke=>!ke),be.if("isVisible","ck-hidden",ke=>!ke),be.to("isOn",ke=>ke?"ck-on":"ck-off"),be.if("withText","ck-button_with-text"),be.if("withKeystroke","ck-button_with-keystroke")],role:be.to("role"),type:be.to("type",ke=>ke||"button"),tabindex:be.to("tabindex"),"aria-checked":be.to("ariaChecked"),"aria-label":be.to("ariaLabel"),"aria-labelledby":be.to("ariaLabelledBy"),"aria-disabled":be.if("isEnabled",!0,ke=>!ke),"aria-pressed":be.to("isOn",ke=>this.isToggleable?String(!!ke):!1),"data-cke-tooltip-text":be.to("_tooltipString"),"data-cke-tooltip-position":be.to("tooltipPosition")},children:this.children,on:{click:be.to(ke=>{this.isEnabled?this.fire("execute"):ke.preventDefault()})}};env.isSafari&&(this._focusDelayed||(this._focusDelayed=delay(()=>this.focus(),0)),ve.on.mousedown=be.to(()=>{this._focusDelayed()}),ve.on.mouseup=be.to(()=>{this._focusDelayed.cancel()})),this.setTemplate(ve)}render(){super.render(),this.icon&&(this.iconView.bind("content").to(this,"icon"),this.children.add(this.iconView)),this.children.add(this.labelView),this.withKeystroke&&this.keystroke&&this.children.add(this.keystrokeView)}focus(){this.element.focus()}destroy(){this._focusDelayed&&this._focusDelayed.cancel(),super.destroy()}_setupLabelView(t){return t.bind("text","style","id").to(this,"label","labelStyle","ariaLabelledBy"),t}_createKeystrokeView(){const t=new View;return t.setTemplate({tag:"span",attributes:{class:["ck","ck-button__keystroke"]},children:[{text:this.bindTemplate.to("keystroke",te=>getEnvKeystrokeText(te))}]}),t}_getTooltipString(t,te,be){return t?typeof t=="string"?t:(be&&(be=getEnvKeystrokeText(be)),t instanceof Function?t(te,be):`${te}${be?` (${be})`:""}`):""}}class FormHeaderView extends View{constructor(t,te={}){super(t);Re(this,"children");Re(this,"iconView");const be=this.bindTemplate;this.set("label",te.label||""),this.set("class",te.class||null),this.children=this.createCollection(),this.setTemplate({tag:"div",attributes:{class:["ck","ck-form__header",be.to("class")]},children:this.children}),te.icon&&(this.iconView=new IconView,this.iconView.content=te.icon,this.children.add(this.iconView));const xe=new View(t);xe.setTemplate({tag:"h2",attributes:{class:["ck","ck-form__header__label"],role:"presentation"},children:[{text:be.to("label")}]}),this.children.add(xe)}}class FocusCycler extends EmitterMixin(){constructor(t){super();Re(this,"focusables");Re(this,"focusTracker");Re(this,"keystrokeHandler");Re(this,"actions");if(this.focusables=t.focusables,this.focusTracker=t.focusTracker,this.keystrokeHandler=t.keystrokeHandler,this.actions=t.actions,t.actions&&t.keystrokeHandler)for(const te in t.actions){let be=t.actions[te];typeof be=="string"&&(be=[be]);for(const xe of be)t.keystrokeHandler.set(xe,(ve,ke)=>{this[te](),ke()})}this.on("forwardCycle",()=>this.focusFirst(),{priority:"low"}),this.on("backwardCycle",()=>this.focusLast(),{priority:"low"})}get first(){return this.focusables.find(isDomFocusable)||null}get last(){return this.focusables.filter(isDomFocusable).slice(-1)[0]||null}get next(){return this._getDomFocusableItem(1)}get previous(){return this._getDomFocusableItem(-1)}get current(){let t=null;return this.focusTracker.focusedElement===null?null:(this.focusables.find((te,be)=>{const xe=te.element===this.focusTracker.focusedElement;return xe&&(t=be),xe}),t)}focusFirst(){this._focus(this.first,1)}focusLast(){this._focus(this.last,-1)}focusNext(){const t=this.next;if(t&&this.focusables.getIndex(t)===this.current){this.fire("forwardCycle");return}t===this.first?this.fire("forwardCycle"):this._focus(t,1)}focusPrevious(){const t=this.previous;if(t&&this.focusables.getIndex(t)===this.current){this.fire("backwardCycle");return}t===this.last?this.fire("backwardCycle"):this._focus(t,-1)}_focus(t,te){t&&this.focusTracker.focusedElement!==t.element&&t.focus(te)}_getDomFocusableItem(t){const te=this.focusables.length;if(!te)return null;const be=this.current;if(be===null)return this[t===1?"first":"last"];let xe=this.focusables.get(be),ve=(be+te+t)%te;do{const ke=this.focusables.get(ve);if(isDomFocusable(ke)){xe=ke;break}ve=(ve+te+t)%te}while(ve!==be);return xe}}function isDomFocusable(Te){return isFocusable(Te)&&isVisible(Te.element)}function isFocusable(Te){return"focus"in Te&&typeof Te.focus=="function"}function isViewWithFocusCycler(Te){return isFocusable(Te)&&"focusCycler"in Te&&Te.focusCycler instanceof FocusCycler}function DraggableViewMixin(Te){class we extends Te{constructor(...be){super(...be);Re(this,"_onDragBound",this._onDrag.bind(this));Re(this,"_onDragEndBound",this._onDragEnd.bind(this));Re(this,"_lastDraggingCoordinates",{x:0,y:0});this.on("render",()=>{this._attachListeners()}),this.set("isDragging",!1)}_attachListeners(){this.listenTo(this.element,"mousedown",this._onDragStart.bind(this)),this.listenTo(this.element,"touchstart",this._onDragStart.bind(this))}_attachDragListeners(){this.listenTo(global.document,"mouseup",this._onDragEndBound),this.listenTo(global.document,"touchend",this._onDragEndBound),this.listenTo(global.document,"mousemove",this._onDragBound),this.listenTo(global.document,"touchmove",this._onDragBound)}_detachDragListeners(){this.stopListening(global.document,"mouseup",this._onDragEndBound),this.stopListening(global.document,"touchend",this._onDragEndBound),this.stopListening(global.document,"mousemove",this._onDragBound),this.stopListening(global.document,"touchmove",this._onDragBound)}_onDragStart(be,xe){if(!this._isHandleElementPressed(xe))return;this._attachDragListeners();let ve=0,ke=0;xe instanceof MouseEvent?(ve=xe.clientX,ke=xe.clientY):(ve=xe.touches[0].clientX,ke=xe.touches[0].clientY),this._lastDraggingCoordinates={x:ve,y:ke},this.isDragging=!0}_onDrag(be,xe){if(!this.isDragging){this._detachDragListeners();return}let ve=0,ke=0;xe instanceof MouseEvent?(ve=xe.clientX,ke=xe.clientY):(ve=xe.touches[0].clientX,ke=xe.touches[0].clientY),xe.preventDefault(),this.fire("drag",{deltaX:Math.round(ve-this._lastDraggingCoordinates.x),deltaY:Math.round(ke-this._lastDraggingCoordinates.y)}),this._lastDraggingCoordinates={x:ve,y:ke}}_onDragEnd(){this._detachDragListeners(),this.isDragging=!1}_isHandleElementPressed(be){return this.dragHandleElement?this.dragHandleElement===be.target||be.target instanceof HTMLElement&&this.dragHandleElement.contains(be.target):!1}}return we}class DialogActionsView extends View{constructor(t){super(t);Re(this,"children");Re(this,"keystrokes");Re(this,"focusCycler");Re(this,"_focusTracker");Re(this,"_focusables");this.children=this.createCollection(),this.keystrokes=new KeystrokeHandler,this._focusTracker=new FocusTracker,this._focusables=new ViewCollection,this.focusCycler=new FocusCycler({focusables:this._focusables,focusTracker:this._focusTracker,keystrokeHandler:this.keystrokes,actions:{focusPrevious:"shift + tab",focusNext:"tab"}}),this.setTemplate({tag:"div",attributes:{class:["ck","ck-dialog__actions"]},children:this.children})}render(){super.render(),this.keystrokes.listenTo(this.element)}setButtons(t){for(const te of t){const be=new ButtonView(this.locale);let xe;be.on("execute",()=>te.onExecute()),te.onCreate&&te.onCreate(be);for(xe in te)xe!="onExecute"&&xe!="onCreate"&&be.set(xe,te[xe]);this.children.add(be)}this._updateFocusCyclableItems()}focus(t){t===-1?this.focusCycler.focusLast():this.focusCycler.focusFirst()}_updateFocusCyclableItems(){Array.from(this.children).forEach(t=>{this._focusables.add(t),this._focusTracker.add(t.element)})}}class DialogContentView extends View{constructor(t){super(t);Re(this,"children");this.children=this.createCollection(),this.setTemplate({tag:"div",attributes:{class:["ck","ck-dialog__content"]},children:this.children})}reset(){for(;this.children.length;)this.children.remove(0)}}const DialogViewPosition={SCREEN_CENTER:"screen-center",EDITOR_CENTER:"editor-center",EDITOR_TOP_SIDE:"editor-top-side",EDITOR_TOP_CENTER:"editor-top-center",EDITOR_BOTTOM_CENTER:"editor-bottom-center",EDITOR_ABOVE_CENTER:"editor-above-center",EDITOR_BELOW_CENTER:"editor-below-center"},toPx$6=toUnit("px"),r0=class r0 extends DraggableViewMixin(View){constructor(t,{getCurrentDomRoot:te,getViewportOffset:be}){super(t);Re(this,"parts");Re(this,"headerView");Re(this,"closeButtonView");Re(this,"actionsView");Re(this,"contentView");Re(this,"keystrokes");Re(this,"focusTracker");Re(this,"wasMoved",!1);Re(this,"_getCurrentDomRoot");Re(this,"_getViewportOffset");Re(this,"_focusables");Re(this,"_focusCycler");const xe=this.bindTemplate,ve=t.t;this.set("className",""),this.set("ariaLabel",ve("Editor dialog")),this.set("isModal",!1),this.set("position",DialogViewPosition.SCREEN_CENTER),this.set("_isVisible",!1),this.set("_isTransparent",!1),this.set("_top",0),this.set("_left",0),this._getCurrentDomRoot=te,this._getViewportOffset=be,this.decorate("moveTo"),this.parts=this.createCollection(),this.keystrokes=new KeystrokeHandler,this.focusTracker=new FocusTracker,this._focusables=new ViewCollection,this._focusCycler=new FocusCycler({focusables:this._focusables,focusTracker:this.focusTracker,keystrokeHandler:this.keystrokes,actions:{focusPrevious:"shift + tab",focusNext:"tab"}}),this.setTemplate({tag:"div",attributes:{class:["ck","ck-dialog-overlay",xe.if("isModal","ck-dialog-overlay__transparent",ke=>!ke),xe.if("_isVisible","ck-hidden",ke=>!ke)],tabindex:"-1"},children:[{tag:"div",attributes:{tabindex:"-1",class:["ck","ck-dialog",xe.to("className")],role:"dialog","aria-label":xe.to("ariaLabel"),style:{top:xe.to("_top",ke=>toPx$6(ke)),left:xe.to("_left",ke=>toPx$6(ke)),visibility:xe.if("_isTransparent","hidden")}},children:this.parts}]})}render(){super.render(),this.keystrokes.set("Esc",(t,te)=>{this.fire("close",{source:"escKeyPress"}),te()}),this.on("drag",(t,{deltaX:te,deltaY:be})=>{this.wasMoved=!0,this.moveBy(te,be)}),this.listenTo(global.window,"resize",()=>{this._isVisible&&!this.wasMoved&&this.updatePosition()}),this.listenTo(global.document,"scroll",()=>{this._isVisible&&!this.wasMoved&&this.updatePosition()}),this.on("change:_isVisible",(t,te,be)=>{be&&(this._isTransparent=!0,setTimeout(()=>{this.updatePosition(),this._isTransparent=!1,this.focus()},10))}),this.keystrokes.listenTo(this.element)}get dragHandleElement(){return this.headerView?this.headerView.element:null}setupParts({icon:t,title:te,hasCloseButton:be=!0,content:xe,actionButtons:ve}){te&&(this.headerView=new FormHeaderView(this.locale,{icon:t}),be&&(this.closeButtonView=this._createCloseButton(),this.headerView.children.add(this.closeButtonView)),this.headerView.label=te,this.ariaLabel=te,this.parts.add(this.headerView,0)),xe&&(xe instanceof View&&(xe=[xe]),this.contentView=new DialogContentView(this.locale),this.contentView.children.addMany(xe),this.parts.add(this.contentView)),ve&&(this.actionsView=new DialogActionsView(this.locale),this.actionsView.setButtons(ve),this.parts.add(this.actionsView)),this._updateFocusCyclableItems()}focus(){this._focusCycler.focusFirst()}moveTo(t,te){const be=this._getViewportRect(),xe=this._getDialogRect();t+xe.width>be.right&&(t=be.right-xe.width),t<be.left&&(t=be.left),te<be.top&&(te=be.top),this._moveTo(t,te)}_moveTo(t,te){this._left=t,this._top=te}moveBy(t,te){this.moveTo(this._left+t,this._top+te)}_moveOffScreen(){this._moveTo(-9999,-9999)}updatePosition(){if(!this.element||!this.element.parentNode)return;const t=this._getViewportRect();let te=this.position,be;this._getCurrentDomRoot()?be=this._getVisibleDomRootRect(t):te=DialogViewPosition.SCREEN_CENTER;const xe=r0.defaultOffset,ve=this._getDialogRect();switch(te){case DialogViewPosition.EDITOR_TOP_SIDE:{if(be){const ke=this.locale.contentLanguageDirection==="ltr"?be.right-ve.width-xe:be.left+xe;this.moveTo(ke,be.top+xe)}else this._moveOffScreen();break}case DialogViewPosition.EDITOR_CENTER:{be?this.moveTo(Math.round(be.left+be.width/2-ve.width/2),Math.round(be.top+be.height/2-ve.height/2)):this._moveOffScreen();break}case DialogViewPosition.SCREEN_CENTER:{this.moveTo(Math.round((t.width-ve.width)/2),Math.round((t.height-ve.height)/2));break}case DialogViewPosition.EDITOR_TOP_CENTER:{be?this.moveTo(Math.round(be.left+be.width/2-ve.width/2),be.top+xe):this._moveOffScreen();break}case DialogViewPosition.EDITOR_BOTTOM_CENTER:{be?this.moveTo(Math.round(be.left+be.width/2-ve.width/2),be.bottom-ve.height-xe):this._moveOffScreen();break}case DialogViewPosition.EDITOR_ABOVE_CENTER:{be?this.moveTo(Math.round(be.left+be.width/2-ve.width/2),be.top-ve.height-xe):this._moveOffScreen();break}case DialogViewPosition.EDITOR_BELOW_CENTER:{be?this.moveTo(Math.round(be.left+be.width/2-ve.width/2),be.bottom+xe):this._moveOffScreen();break}}}_getVisibleDomRootRect(t){let te=new Rect(this._getCurrentDomRoot()).getVisible();if(te){if(te=t.getIntersection(te),!te)return null}else return null;return te}_getDialogRect(){return new Rect(this.element.firstElementChild)}_getViewportRect(){return getConstrainedViewportRect(this._getViewportOffset())}_updateFocusCyclableItems(){const t=[];if(this.contentView)for(const te of this.contentView.children)isFocusable(te)&&t.push(te);this.actionsView&&t.push(this.actionsView),this.closeButtonView&&t.push(this.closeButtonView),t.forEach(te=>{this._focusables.add(te),this.focusTracker.add(te.element),isViewWithFocusCycler(te)&&(this.listenTo(te.focusCycler,"forwardCycle",be=>{this._focusCycler.focusNext(),this._focusCycler.next!==this._focusCycler.focusables.get(this._focusCycler.current)&&be.stop()}),this.listenTo(te.focusCycler,"backwardCycle",be=>{this._focusCycler.focusPrevious(),this._focusCycler.previous!==this._focusCycler.focusables.get(this._focusCycler.current)&&be.stop()}))})}_createCloseButton(){const t=new ButtonView(this.locale),te=this.locale.t;return t.set({label:te("Close"),tooltip:!0,icon:icons.cancel}),t.on("execute",()=>this.fire("close",{source:"closeButton"})),t}};Re(r0,"defaultOffset",15);let DialogView=r0;function getConstrainedViewportRect(Te){Te=Object.assign({top:0,bottom:0,left:0,right:0},Te);const we=new Rect(global.window);return we.top+=Te.top,we.height-=Te.top,we.bottom-=Te.bottom,we.height-=Te.bottom,we.left+=Te.left,we.right-=Te.right,we.width-=Te.left+Te.right,we}const kn=class kn extends Plugin{constructor(t){super(t);Re(this,"view");Re(this,"_onHide");const te=t.t;this._initShowHideListeners(),this._initFocusToggler(),this._initMultiRootIntegration(),this.set("id",null),t.accessibility.addKeystrokeInfos({categoryId:"navigation",keystrokes:[{label:te("Move focus in and out of an active dialog window"),keystroke:"Ctrl+F6",mayRequireFn:!0}]})}static get pluginName(){return"Dialog"}_initShowHideListeners(){this.on("show",(t,te)=>{this._show(te)}),this.on("show",(t,te)=>{te.onShow&&te.onShow(this)},{priority:"low"}),this.on("hide",()=>{kn._visibleDialogPlugin&&kn._visibleDialogPlugin._hide()}),this.on("hide",()=>{this._onHide&&(this._onHide(this),this._onHide=void 0)},{priority:"low"})}_initFocusToggler(){const t=this.editor;t.keystrokes.set("Ctrl+F6",(te,be)=>{!this.isOpen||this.view.isModal||(this.view.focusTracker.isFocused?t.editing.view.focus():this.view.focus(),be())})}_initMultiRootIntegration(){const t=this.editor.model;t.document.on("change:data",()=>{if(!this.view)return;const te=t.document.differ.getChangedRoots();for(const be of te)be.state&&this.view.updatePosition()})}show(t){this.hide(),this.fire(`show:${t.id}`,t)}_show({id:t,icon:te,title:be,hasCloseButton:xe=!0,content:ve,actionButtons:ke,className:Ie,isModal:Ae,position:Se,onHide:Oe}){const Ve=this.editor;this.view=new DialogView(Ve.locale,{getCurrentDomRoot:()=>Ve.editing.view.getDomRoot(Ve.model.document.selection.anchor.root.rootName),getViewportOffset:()=>Ve.ui.viewportOffset});const Me=this.view;Me.on("close",()=>{this.hide()}),Ve.ui.view.body.add(Me),Ve.ui.focusTracker.add(Me.element),Ve.keystrokes.listenTo(Me.element),Se||(Se=Ae?DialogViewPosition.SCREEN_CENTER:DialogViewPosition.EDITOR_CENTER),Me.set({position:Se,_isVisible:!0,className:Ie,isModal:Ae}),Me.setupParts({icon:te,title:be,hasCloseButton:xe,content:ve,actionButtons:ke}),this.id=t,Oe&&(this._onHide=Oe),this.isOpen=!0,kn._visibleDialogPlugin=this}hide(){kn._visibleDialogPlugin&&kn._visibleDialogPlugin.fire(`hide:${kn._visibleDialogPlugin.id}`)}_hide(){if(!this.view)return;const t=this.editor,te=this.view;te.contentView&&te.contentView.reset(),t.ui.view.body.remove(te),t.ui.focusTracker.remove(te.element),t.keystrokes.stopListening(te.element),te.destroy(),t.editing.view.focus(),this.id=null,this.isOpen=!1,kn._visibleDialogPlugin=null}};Re(kn,"_visibleDialogPlugin");let Dialog=kn;class MenuBarMenuListItemButtonView extends ButtonView{constructor(we){super(we),this.set({withText:!0,withKeystroke:!0,tooltip:!1,role:"menuitem"}),this.extendTemplate({attributes:{class:["ck-menu-bar__menu__item__button"]}})}}class LabelView extends View{constructor(t){super(t);Re(this,"id");this.set("text",void 0),this.set("for",void 0),this.id=`ck-editor__label_${uid()}`;const te=this.bindTemplate;this.setTemplate({tag:"label",attributes:{class:["ck","ck-label"],id:this.id,for:te.to("for")},children:[{text:te.to("text")}]})}}class AccessibilityHelpContentView extends View{constructor(we,t){super(we);const te=we.t,be=new LabelView;be.text=te("Help Contents. To close this dialog press ESC."),this.setTemplate({tag:"div",attributes:{class:["ck","ck-accessibility-help-dialog__content"],"aria-labelledby":be.id,role:"document",tabindex:-1},children:[createElement(document,"p",{},te("Below, you can find a list of keyboard shortcuts that can be used in the editor.")),...this._createCategories(Array.from(t.values())),be]})}focus(){this.element.focus()}_createCategories(we){return we.map(t=>{const te=[createElement(document,"h3",{},t.label),...Array.from(t.groups.values()).map(be=>this._createGroup(be)).flat()];return t.description&&te.splice(1,0,createElement(document,"p",{},t.description)),createElement(document,"section",{},te)})}_createGroup(we){const t=we.keystrokes.sort((be,xe)=>be.label.localeCompare(xe.label)).map(be=>this._createGroupRow(be)).flat(),te=[createElement(document,"dl",{},t)];return we.label&&te.unshift(createElement(document,"h4",{},we.label)),te}_createGroupRow(we){const t=this.locale.t,te=createElement(document,"dt"),be=createElement(document,"dd"),xe=normalizeKeystrokeDefinition(we.keystroke),ve=[];for(const ke of xe)ve.push(ke.map(keystrokeToEnvKbd).join(""));return te.innerHTML=we.label,be.innerHTML=ve.join(", ")+(we.mayRequireFn&&env.isMac?` ${t("(may require <kbd>Fn</kbd>)")}`:""),[te,be]}}function keystrokeToEnvKbd(Te){return getEnvKeystrokeText(Te).split("+").map(we=>`<kbd>${we}</kbd>`).join("+")}function normalizeKeystrokeDefinition(Te){return typeof Te=="string"?[[Te]]:typeof Te[0]=="string"?[Te]:Te}var accessibilityIcon='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M10 6.628a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3Z"/><path d="M8.5 9.125a.3.3 0 0 0-.253-.296L5.11 8.327a.75.75 0 1 1 .388-1.449l4.04.716c.267.072.624.08.893.009l4.066-.724a.75.75 0 1 1 .388 1.45l-3.132.5a.3.3 0 0 0-.253.296v1.357a.3.3 0 0 0 .018.102l1.615 4.438a.75.75 0 0 1-1.41.513l-1.35-3.71a.3.3 0 0 0-.281-.197h-.209a.3.3 0 0 0-.282.198l-1.35 3.711a.75.75 0 0 1-1.41-.513l1.64-4.509a.3.3 0 0 0 .019-.103V9.125Z"/><path clip-rule="evenodd" d="M10 18.5a8.5 8.5 0 1 1 0-17 8.5 8.5 0 0 1 0 17Zm0 1.5c5.523 0 10-4.477 10-10S15.523 0 10 0 0 4.477 0 10s4.477 10 10 10Z"/></svg>';class AccessibilityHelp extends Plugin{constructor(){super(...arguments);Re(this,"contentView",null)}static get requires(){return[Dialog]}static get pluginName(){return"AccessibilityHelp"}init(){const t=this.editor,te=t.locale.t;t.ui.componentFactory.add("accessibilityHelp",()=>{const be=this._createButton(ButtonView);return be.set({tooltip:!0,withText:!1,label:te("Accessibility help")}),be}),t.ui.componentFactory.add("menuBar:accessibilityHelp",()=>{const be=this._createButton(MenuBarMenuListItemButtonView);return be.label=te("Accessibility"),be}),t.keystrokes.set("Alt+0",(be,xe)=>{this._showDialog(),xe()}),this._setupRootLabels()}_createButton(t){const be=this.editor.locale,xe=new t(be);return xe.set({keystroke:"Alt+0",icon:accessibilityIcon}),xe.on("execute",()=>this._showDialog()),xe}_setupRootLabels(){const t=this.editor,te=t.editing.view,be=t.t;t.ui.on("ready",()=>{te.change(ve=>{for(const ke of te.document.roots)xe(ve,ke)}),t.on("addRoot",(ve,ke)=>{const Ie=t.editing.view.document.getRoot(ke.rootName);te.change(Ae=>xe(Ae,Ie))},{priority:"low"})});function xe(ve,ke){const Ae=`${ke.getAttribute("aria-label")}. ${be("Press %0 for help.",[getEnvKeystrokeText("Alt+0")])}`;ve.setAttribute("aria-label",Ae,ke)}}_showDialog(){const t=this.editor,te=t.plugins.get("Dialog"),be=t.locale.t;this.contentView||(this.contentView=new AccessibilityHelpContentView(t.locale,t.accessibility.keystrokeInfos)),te.show({id:"accessibilityHelp",className:"ck-accessibility-help-dialog",title:be("Accessibility help"),icon:accessibilityIcon,hasCloseButton:!0,content:this.contentView})}}class BodyCollection extends ViewCollection{constructor(t,te=[]){super(te);Re(this,"locale");Re(this,"_bodyCollectionContainer");this.locale=t}get bodyCollectionContainer(){return this._bodyCollectionContainer}attachToDom(){this._bodyCollectionContainer=new Template({tag:"div",attributes:{class:["ck","ck-reset_all","ck-body","ck-rounded-corners"],dir:this.locale.uiLanguageDirection},children:this}).render();let t=document.querySelector(".ck-body-wrapper");t||(t=createElement(document,"div",{class:"ck-body-wrapper"}),document.body.appendChild(t)),t.appendChild(this._bodyCollectionContainer)}detachFromDom(){super.destroy(),this._bodyCollectionContainer&&this._bodyCollectionContainer.remove();const t=document.querySelector(".ck-body-wrapper");t&&t.childElementCount==0&&t.remove()}}class SwitchButtonView extends ButtonView{constructor(t){super(t);Re(this,"toggleSwitchView");this.isToggleable=!0,this.toggleSwitchView=this._createToggleView(),this.extendTemplate({attributes:{class:"ck-switchbutton"}})}render(){super.render(),this.children.add(this.toggleSwitchView)}_createToggleView(){const t=new View;return t.setTemplate({tag:"span",attributes:{class:["ck","ck-button__toggle"]},children:[{tag:"span",attributes:{class:["ck","ck-button__toggle__inner"]}}]}),t}}class FileDialogButtonView extends ButtonView{constructor(t){super(t);Re(this,"buttonView");Re(this,"_fileInputView");this.buttonView=this,this._fileInputView=new FileInputView(t),this._fileInputView.bind("acceptedType").to(this),this._fileInputView.bind("allowMultipleFiles").to(this),this._fileInputView.delegate("done").to(this),this.on("execute",()=>{this._fileInputView.open()}),this.extendTemplate({attributes:{class:"ck-file-dialog-button"}})}render(){super.render(),this.children.add(this._fileInputView)}}class FileInputView extends View{constructor(we){super(we),this.set("acceptedType",void 0),this.set("allowMultipleFiles",!1);const t=this.bindTemplate;this.setTemplate({tag:"input",attributes:{class:["ck-hidden"],type:"file",tabindex:"-1",accept:t.to("acceptedType"),multiple:t.to("allowMultipleFiles")},on:{change:t.to(()=>{this.element&&this.element.files&&this.element.files.length&&this.fire("done",this.element.files),this.element.value=""})}})}open(){this.element.click()}}var dropdownArrowIcon='<svg viewBox="0 0 10 10" xmlns="http://www.w3.org/2000/svg"><path d="M.941 4.523a.75.75 0 1 1 1.06-1.06l3.006 3.005 3.005-3.005a.75.75 0 1 1 1.06 1.06l-3.549 3.55a.75.75 0 0 1-1.168-.136L.941 4.523z"/></svg>';class CollapsibleView extends View{constructor(t,te){super(t);Re(this,"buttonView");Re(this,"children");const be=this.bindTemplate;this.set("isCollapsed",!1),this.set("label",""),this.buttonView=this._createButtonView(),this.children=this.createCollection(),this.set("_collapsibleAriaLabelUid",void 0),te&&this.children.addMany(te),this.setTemplate({tag:"div",attributes:{class:["ck","ck-collapsible",be.if("isCollapsed","ck-collapsible_collapsed")]},children:[this.buttonView,{tag:"div",attributes:{class:["ck","ck-collapsible__children"],role:"region",hidden:be.if("isCollapsed","hidden"),"aria-labelledby":be.to("_collapsibleAriaLabelUid")},children:this.children}]})}render(){super.render(),this._collapsibleAriaLabelUid=this.buttonView.labelView.element.id}focus(){this.buttonView.focus()}_createButtonView(){const t=new ButtonView(this.locale),te=t.bindTemplate;return t.set({withText:!0,icon:dropdownArrowIcon}),t.extendTemplate({attributes:{"aria-expanded":te.to("isOn",be=>String(be))}}),t.bind("label").to(this),t.bind("isOn").to(this,"isCollapsed",be=>!be),t.on("execute",()=>{this.isCollapsed=!this.isCollapsed}),t}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function getLocalizedColorOptions(Te,we){const t=Te.t,te={Black:t("Black"),"Dim grey":t("Dim grey"),Grey:t("Grey"),"Light grey":t("Light grey"),White:t("White"),Red:t("Red"),Orange:t("Orange"),Yellow:t("Yellow"),"Light green":t("Light green"),Green:t("Green"),Aquamarine:t("Aquamarine"),Turquoise:t("Turquoise"),"Light blue":t("Light blue"),Blue:t("Blue"),Purple:t("Purple")};return we.map(be=>{const xe=te[be.label];return xe&&xe!=be.label&&(be.label=xe),be})}function normalizeColorOptions(Te){return Te.map(normalizeSingleColorDefinition).filter(we=>!!we)}function normalizeSingleColorDefinition(Te){return typeof Te=="string"?{model:Te,label:Te,hasBorder:!1,view:{name:"span",styles:{color:Te}}}:{model:Te.color,label:Te.label||Te.color,hasBorder:Te.hasBorder===void 0?!1:Te.hasBorder,view:{name:"span",styles:{color:`${Te.color}`}}}}var checkIcon='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path class="ck-icon__fill" d="M16.935 5.328a2 2 0 0 1 0 2.829l-7.778 7.778a2 2 0 0 1-2.829 0L3.5 13.107a1.999 1.999 0 1 1 2.828-2.829l.707.707a1 1 0 0 0 1.414 0l5.658-5.657a2 2 0 0 1 2.828 0z"/><path d="M14.814 6.035 8.448 12.4a1 1 0 0 1-1.414 0l-1.413-1.415A1 1 0 1 0 4.207 12.4l2.829 2.829a1 1 0 0 0 1.414 0l7.778-7.778a1 1 0 1 0-1.414-1.415z"/></svg>';class ColorTileView extends ButtonView{constructor(we){super(we);const t=this.bindTemplate;this.set("color",void 0),this.set("hasBorder",!1),this.icon=checkIcon,this.extendTemplate({attributes:{style:{backgroundColor:t.to("color",te=>env.isMediaForcedColors?null:te)},class:["ck","ck-color-grid__tile",t.if("hasBorder","ck-color-selector__color-tile_bordered")]}})}render(){super.render(),this.iconView.fillColor="hsl(0, 0%, 100%)"}}class ColorGridView extends View{constructor(t,te){super(t);Re(this,"columns");Re(this,"items");Re(this,"focusTracker");Re(this,"keystrokes");const be=te&&te.colorDefinitions?te.colorDefinitions:[];this.columns=te&&te.columns?te.columns:5;const xe={gridTemplateColumns:`repeat( ${this.columns}, 1fr)`};this.set("selectedColor",void 0),this.items=this.createCollection(),this.focusTracker=new FocusTracker,this.keystrokes=new KeystrokeHandler,this.items.on("add",(ve,ke)=>{ke.isOn=ke.color===this.selectedColor}),be.forEach(ve=>{const ke=new ColorTileView;ke.set({color:ve.color,label:ve.label,tooltip:!0,hasBorder:ve.options.hasBorder}),ke.on("execute",()=>{this.fire("execute",{value:ve.color,hasBorder:ve.options.hasBorder,label:ve.label})}),this.items.add(ke)}),this.setTemplate({tag:"div",children:this.items,attributes:{class:["ck","ck-color-grid"],style:xe}}),this.on("change:selectedColor",(ve,ke,Ie)=>{for(const Ae of this.items)Ae.isOn=Ae.color===Ie})}focus(){this.items.length&&this.items.first.focus()}focusLast(){this.items.length&&this.items.last.focus()}render(){super.render();for(const t of this.items)this.focusTracker.add(t.element);this.items.on("add",(t,te)=>{this.focusTracker.add(te.element)}),this.items.on("remove",(t,te)=>{this.focusTracker.remove(te.element)}),this.keystrokes.listenTo(this.element),addKeyboardHandlingForGrid({keystrokeHandler:this.keystrokes,focusTracker:this.focusTracker,gridItems:this.items,numberOfColumns:this.columns,uiLanguageDirection:this.locale&&this.locale.uiLanguageDirection})}destroy(){super.destroy(),this.focusTracker.destroy(),this.keystrokes.destroy()}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function convertColor(Te,we){if(!Te)return"";const t=parseColorString(Te);if(!t)return"";if(t.space===we)return Te;if(!canConvertParsedColor(t))return"";const be=convert$2[t.space][we];if(!be)return"";const xe=be(t.space==="hex"?t.hexValue:t.values);return formatColorOutput(xe,we)}function convertToHex(Te){if(!Te)return"";const we=parseColorString(Te);return we?we.space==="hex"?we.hexValue:convertColor(Te,"hex"):"#000"}function registerCustomElement(Te,we){customElements.get(Te)===void 0&&customElements.define(Te,we)}function formatColorOutput(Te,we){switch(we){case"hex":return`#${Te}`;case"rgb":return`rgb( ${Te[0]}, ${Te[1]}, ${Te[2]} )`;case"hsl":return`hsl( ${Te[0]}, ${Te[1]}%, ${Te[2]}% )`;case"hwb":return`hwb( ${Te[0]}, ${Te[1]}, ${Te[2]} )`;case"lab":return`lab( ${Te[0]}% ${Te[1]} ${Te[2]} )`;case"lch":return`lch( ${Te[0]}% ${Te[1]} ${Te[2]} )`;default:return""}}function parseColorString(Te){if(Te.startsWith("#")){const t=parse$2(Te);return{space:"hex",values:t.values,hexValue:Te,alpha:t.alpha}}const we=parse$2(Te);return we.space?we:null}function canConvertParsedColor(Te){return Object.keys(convert$2).includes(Te.space)}class LabeledFieldView extends View{constructor(t,te){super(t);Re(this,"fieldView");Re(this,"labelView");Re(this,"statusView");Re(this,"fieldWrapperChildren");const be=`ck-labeled-field-view-${uid()}`,xe=`ck-labeled-field-view-status-${uid()}`;this.fieldView=te(this,be,xe),this.set("label",void 0),this.set("isEnabled",!0),this.set("isEmpty",!0),this.set("isFocused",!1),this.set("errorText",null),this.set("infoText",null),this.set("class",void 0),this.set("placeholder",void 0),this.labelView=this._createLabelView(be),this.statusView=this._createStatusView(xe),this.fieldWrapperChildren=this.createCollection([this.fieldView,this.labelView]),this.bind("_statusText").to(this,"errorText",this,"infoText",(ke,Ie)=>ke||Ie);const ve=this.bindTemplate;this.setTemplate({tag:"div",attributes:{class:["ck","ck-labeled-field-view",ve.to("class"),ve.if("isEnabled","ck-disabled",ke=>!ke),ve.if("isEmpty","ck-labeled-field-view_empty"),ve.if("isFocused","ck-labeled-field-view_focused"),ve.if("placeholder","ck-labeled-field-view_placeholder"),ve.if("errorText","ck-error")]},children:[{tag:"div",attributes:{class:["ck","ck-labeled-field-view__input-wrapper"]},children:this.fieldWrapperChildren},this.statusView]})}_createLabelView(t){const te=new LabelView(this.locale);return te.for=t,te.bind("text").to(this,"label"),te}_createStatusView(t){const te=new View(this.locale),be=this.bindTemplate;return te.setTemplate({tag:"div",attributes:{class:["ck","ck-labeled-field-view__status",be.if("errorText","ck-labeled-field-view__status_error"),be.if("_statusText","ck-hidden",xe=>!xe)],id:t,role:be.if("errorText","alert")},children:[{text:be.to("_statusText")}]}),te}focus(t){this.fieldView.focus(t)}}class InputBase extends View{constructor(t){super(t);Re(this,"focusTracker");this.set("value",void 0),this.set("id",void 0),this.set("placeholder",void 0),this.set("tabIndex",void 0),this.set("isReadOnly",!1),this.set("hasError",!1),this.set("ariaDescribedById",void 0),this.set("ariaLabel",void 0),this.focusTracker=new FocusTracker,this.bind("isFocused").to(this.focusTracker),this.set("isEmpty",!0);const te=this.bindTemplate;this.setTemplate({tag:"input",attributes:{class:["ck","ck-input",te.if("isFocused","ck-input_focused"),te.if("isEmpty","ck-input-text_empty"),te.if("hasError","ck-error")],id:te.to("id"),placeholder:te.to("placeholder"),tabindex:te.to("tabIndex"),readonly:te.to("isReadOnly"),"aria-invalid":te.if("hasError",!0),"aria-describedby":te.to("ariaDescribedById"),"aria-label":te.to("ariaLabel")},on:{input:te.to((...be)=>{this.fire("input",...be),this._updateIsEmpty()}),change:te.to(this._updateIsEmpty.bind(this))}})}render(){super.render(),this.focusTracker.add(this.element),this._setDomElementValue(this.value),this._updateIsEmpty(),this.on("change:value",(t,te,be)=>{this._setDomElementValue(be),this._updateIsEmpty()})}destroy(){super.destroy(),this.focusTracker.destroy()}select(){this.element.select()}focus(){this.element.focus()}reset(){this.value=this.element.value="",this._updateIsEmpty()}_updateIsEmpty(){this.isEmpty=isInputElementEmpty(this.element)}_setDomElementValue(t){this.element.value=!t&&t!==0?"":t}}function isInputElementEmpty(Te){return!Te.value}class InputView extends InputBase{constructor(we){super(we),this.set("inputMode","text");const t=this.bindTemplate;this.extendTemplate({attributes:{inputmode:t.to("inputMode")}})}}class InputTextView extends InputView{constructor(we){super(we),this.extendTemplate({attributes:{type:"text",class:["ck-input-text"]}})}}class InputNumberView extends InputView{constructor(we,{min:t,max:te,step:be}={}){super(we);const xe=this.bindTemplate;this.set("min",t),this.set("max",te),this.set("step",be),this.extendTemplate({attributes:{type:"number",class:["ck-input-number"],min:xe.to("min"),max:xe.to("max"),step:xe.to("step")}})}}class TextareaView extends InputBase{constructor(t){super(t);Re(this,"_resizeObserver");Re(this,"_isUpdateAutoGrowHeightPending",!1);const te=toUnit("px");this.set("minRows",2),this.set("maxRows",5),this.set("_height",null),this.set("resize","none"),this._resizeObserver=null,this.on("change:minRows",this._validateMinMaxRows.bind(this)),this.on("change:maxRows",this._validateMinMaxRows.bind(this));const be=this.bindTemplate;this.template.tag="textarea",this.extendTemplate({attributes:{class:["ck-textarea"],style:{height:be.to("_height",xe=>xe?te(xe):null),resize:be.to("resize")},rows:be.to("minRows")}})}render(){super.render();let t=!1;this.on("input",()=>{this._updateAutoGrowHeight(!0),this.fire("update")}),this.on("change:value",()=>{global.window.requestAnimationFrame(()=>{if(!isVisible(this.element)){this._isUpdateAutoGrowHeightPending=!0;return}this._updateAutoGrowHeight(),this.fire("update")})}),this._resizeObserver=new ResizeObserver(this.element,te=>{const be=!!te.contentRect.width&&!!te.contentRect.height;!t&&be&&this._isUpdateAutoGrowHeightPending&&global.window.requestAnimationFrame(()=>{this._updateAutoGrowHeight(),this.fire("update")}),t=be})}destroy(){this._resizeObserver&&this._resizeObserver.destroy()}reset(){super.reset(),this._updateAutoGrowHeight(),this.fire("update")}_updateAutoGrowHeight(t){const te=this.element;if(!te.offsetParent){this._isUpdateAutoGrowHeightPending=!0;return}this._isUpdateAutoGrowHeightPending=!1;const be=getTextareaElementClone(te,"1"),xe=getTextareaElementClone(te,te.value),ve=be.ownerDocument.defaultView.getComputedStyle(be),ke=parseFloat(ve.paddingTop)+parseFloat(ve.paddingBottom),Ie=getBorderWidths(be),Ae=parseFloat(ve.lineHeight),Se=Ie.top+Ie.bottom,Oe=new Rect(be).height,Ve=Math.round((xe.scrollHeight-ke)/Ae),Me=this.maxRows*Ae+ke+Se,De=Ve===1?Oe:this.minRows*Ae+ke+Se;this._height=Math.min(Math.max(Math.max(Ve,this.minRows)*Ae+ke+Se,De),Me),t&&(te.scrollTop=te.scrollHeight),be.remove(),xe.remove()}_validateMinMaxRows(){if(this.minRows>this.maxRows)throw new CKEditorError("ui-textarea-view-min-rows-greater-than-max-rows",{textareaView:this,minRows:this.minRows,maxRows:this.maxRows})}}function getTextareaElementClone(Te,we){const t=Te.cloneNode();return t.style.position="absolute",t.style.top="-99999px",t.style.left="-99999px",t.style.height="auto",t.style.overflow="hidden",t.style.width=Te.ownerDocument.defaultView.getComputedStyle(Te).width,t.tabIndex=-1,t.rows=1,t.value=we,Te.parentNode.insertBefore(t,Te),t}class DropdownPanelView extends View{constructor(t){super(t);Re(this,"children");const te=this.bindTemplate;this.set("isVisible",!1),this.set("position","se"),this.children=this.createCollection(),this.setTemplate({tag:"div",attributes:{class:["ck","ck-reset","ck-dropdown__panel",te.to("position",be=>`ck-dropdown__panel_${be}`),te.if("isVisible","ck-dropdown__panel-visible")],tabindex:"-1"},children:this.children,on:{selectstart:te.to(be=>{be.target.tagName.toLocaleLowerCase()!=="input"&&be.preventDefault()})}})}focus(){if(this.children.length){const t=this.children.first;typeof t.focus=="function"?t.focus():logWarning("ui-dropdown-panel-focus-child-missing-focus",{childView:this.children.first,dropdownPanel:this})}}focusLast(){if(this.children.length){const t=this.children.last;typeof t.focusLast=="function"?t.focusLast():t.focus()}}}const Ri=class Ri extends View{constructor(t,te,be){super(t);Re(this,"buttonView");Re(this,"panelView");Re(this,"focusTracker");Re(this,"keystrokes");Re(this,"listView");Re(this,"toolbarView");const xe=this.bindTemplate;this.buttonView=te,this.panelView=be,this.set("isOpen",!1),this.set("isEnabled",!0),this.set("class",void 0),this.set("id",void 0),this.set("panelPosition","auto"),this.panelView.bind("isVisible").to(this,"isOpen"),this.keystrokes=new KeystrokeHandler,this.focusTracker=new FocusTracker,this.setTemplate({tag:"div",attributes:{class:["ck","ck-dropdown",xe.to("class"),xe.if("isEnabled","ck-disabled",ve=>!ve)],id:xe.to("id"),"aria-describedby":xe.to("ariaDescribedById")},children:[te,be]}),te.extendTemplate({attributes:{class:["ck-dropdown__button"],"data-cke-tooltip-disabled":xe.to("isOpen")}})}render(){super.render(),this.focusTracker.add(this.buttonView.element),this.focusTracker.add(this.panelView.element),this.listenTo(this.buttonView,"open",()=>{this.isOpen=!this.isOpen}),this.on("change:isOpen",(te,be,xe)=>{if(xe)if(this.panelPosition==="auto"){const ve=Ri._getOptimalPosition({element:this.panelView.element,target:this.buttonView.element,fitInViewport:!0,positions:this._panelPositions});this.panelView.position=ve?ve.name:this._panelPositions[0].name}else this.panelView.position=this.panelPosition}),this.keystrokes.listenTo(this.element);const t=(te,be)=>{this.isOpen&&(this.isOpen=!1,be())};this.keystrokes.set("arrowdown",(te,be)=>{this.buttonView.isEnabled&&!this.isOpen&&(this.isOpen=!0,be())}),this.keystrokes.set("arrowright",(te,be)=>{this.isOpen&&be()}),this.keystrokes.set("arrowleft",t),this.keystrokes.set("esc",t)}focus(){this.buttonView.focus()}get _panelPositions(){const{south:t,north:te,southEast:be,southWest:xe,northEast:ve,northWest:ke,southMiddleEast:Ie,southMiddleWest:Ae,northMiddleEast:Se,northMiddleWest:Oe}=Ri.defaultPanelPositions;return this.locale.uiLanguageDirection!=="rtl"?[be,xe,Ie,Ae,t,ve,ke,Se,Oe,te]:[xe,be,Ae,Ie,t,ke,ve,Oe,Se,te]}};Re(Ri,"defaultPanelPositions",{south:(t,te)=>({top:t.bottom,left:t.left-(te.width-t.width)/2,name:"s"}),southEast:t=>({top:t.bottom,left:t.left,name:"se"}),southWest:(t,te)=>({top:t.bottom,left:t.left-te.width+t.width,name:"sw"}),southMiddleEast:(t,te)=>({top:t.bottom,left:t.left-(te.width-t.width)/4,name:"sme"}),southMiddleWest:(t,te)=>({top:t.bottom,left:t.left-(te.width-t.width)*3/4,name:"smw"}),north:(t,te)=>({top:t.top-te.height,left:t.left-(te.width-t.width)/2,name:"n"}),northEast:(t,te)=>({top:t.top-te.height,left:t.left,name:"ne"}),northWest:(t,te)=>({top:t.top-te.height,left:t.left-te.width+t.width,name:"nw"}),northMiddleEast:(t,te)=>({top:t.top-te.height,left:t.left-(te.width-t.width)/4,name:"nme"}),northMiddleWest:(t,te)=>({top:t.top-te.height,left:t.left-(te.width-t.width)*3/4,name:"nmw"})}),Re(Ri,"_getOptimalPosition",getOptimalPosition);let DropdownView=Ri;class DropdownButtonView extends ButtonView{constructor(t){super(t);Re(this,"arrowView");this.arrowView=this._createArrowView(),this.extendTemplate({attributes:{"aria-haspopup":!0,"aria-expanded":this.bindTemplate.to("isOn",te=>String(te))}}),this.delegate("execute").to(this,"open")}render(){super.render(),this.children.add(this.arrowView)}_createArrowView(){const t=new IconView;return t.content=dropdownArrowIcon,t.extendTemplate({attributes:{class:"ck-dropdown__arrow"}}),t}}class ToolbarSeparatorView extends View{constructor(we){super(we),this.setTemplate({tag:"span",attributes:{class:["ck","ck-toolbar__separator"]}})}}class ToolbarLineBreakView extends View{constructor(we){super(we),this.setTemplate({tag:"span",attributes:{class:["ck","ck-toolbar__line-break"]}})}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function preventDefault(Te){return Te.bindTemplate.to(we=>{we.target===Te.element&&we.preventDefault()})}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function normalizeToolbarConfig(Te){if(Array.isArray(Te))return{items:Te,removeItems:[]};const we={items:[],removeItems:[]};return Te?{...we,...Te}:we}const NESTED_TOOLBAR_ICONS={alignLeft:icons.alignLeft,bold:icons.bold,importExport:icons.importExport,paragraph:icons.paragraph,plus:icons.plus,text:icons.text,threeVerticalDots:icons.threeVerticalDots,pilcrow:icons.pilcrow,dragIndicator:icons.dragIndicator};class ToolbarView extends View{constructor(t,te){super(t);Re(this,"options");Re(this,"items");Re(this,"focusTracker");Re(this,"keystrokes");Re(this,"itemsView");Re(this,"children");Re(this,"focusables");Re(this,"_focusCycler");Re(this,"_behavior");const be=this.bindTemplate,xe=this.t;this.options=te||{},this.set("ariaLabel",xe("Editor toolbar")),this.set("maxWidth","auto"),this.items=this.createCollection(),this.focusTracker=new FocusTracker,this.keystrokes=new KeystrokeHandler,this.set("class",void 0),this.set("isCompact",!1),this.itemsView=new ItemsView(t),this.children=this.createCollection(),this.children.add(this.itemsView),this.focusables=this.createCollection();const ve=t.uiLanguageDirection==="rtl";this._focusCycler=new FocusCycler({focusables:this.focusables,focusTracker:this.focusTracker,keystrokeHandler:this.keystrokes,actions:{focusPrevious:[ve?"arrowright":"arrowleft","arrowup"],focusNext:[ve?"arrowleft":"arrowright","arrowdown"]}});const ke=["ck","ck-toolbar",be.to("class"),be.if("isCompact","ck-toolbar_compact")];this.options.shouldGroupWhenFull&&this.options.isFloating&&ke.push("ck-toolbar_floating"),this.setTemplate({tag:"div",attributes:{class:ke,role:"toolbar","aria-label":be.to("ariaLabel"),style:{maxWidth:be.to("maxWidth")},tabindex:-1},children:this.children,on:{mousedown:preventDefault(this)}}),this._behavior=this.options.shouldGroupWhenFull?new DynamicGrouping(this):new StaticLayout(this)}render(){super.render(),this.focusTracker.add(this.element);for(const t of this.items)this.focusTracker.add(t.element);this.items.on("add",(t,te)=>{this.focusTracker.add(te.element)}),this.items.on("remove",(t,te)=>{this.focusTracker.remove(te.element)}),this.keystrokes.listenTo(this.element),this._behavior.render(this)}destroy(){return this._behavior.destroy(),this.focusTracker.destroy(),this.keystrokes.destroy(),super.destroy()}focus(){this._focusCycler.focusFirst()}focusLast(){this._focusCycler.focusLast()}fillFromConfig(t,te,be){this.items.addMany(this._buildItemsFromConfig(t,te,be))}_buildItemsFromConfig(t,te,be){const xe=normalizeToolbarConfig(t),ve=be||xe.removeItems;return this._cleanItemsConfiguration(xe.items,te,ve).map(Ie=>isObject$2(Ie)?this._createNestedToolbarDropdown(Ie,te,ve):Ie==="|"?new ToolbarSeparatorView:Ie==="-"?new ToolbarLineBreakView:te.create(Ie)).filter(Ie=>!!Ie)}_cleanItemsConfiguration(t,te,be){const xe=t.filter((ve,ke,Ie)=>ve==="|"?!0:be.indexOf(ve)!==-1?!1:ve==="-"?this.options.shouldGroupWhenFull?(logWarning("toolbarview-line-break-ignored-when-grouping-items",Ie),!1):!0:!isObject$2(ve)&&!te.has(ve)?(logWarning("toolbarview-item-unavailable",{item:ve}),!1):!0);return this._cleanSeparatorsAndLineBreaks(xe)}_cleanSeparatorsAndLineBreaks(t){const te=ke=>ke!=="-"&&ke!=="|",be=t.length,xe=t.findIndex(te);if(xe===-1)return[];const ve=be-t.slice().reverse().findIndex(te);return t.slice(xe,ve).filter((ke,Ie,Ae)=>te(ke)?!0:!(Ie>0&&Ae[Ie-1]===ke))}_createNestedToolbarDropdown(t,te,be){let{label:xe,icon:ve,items:ke,tooltip:Ie=!0,withText:Ae=!1}=t;if(ke=this._cleanItemsConfiguration(ke,te,be),!ke.length)return null;const Se=this.locale,Oe=createDropdown(Se);return xe||logWarning("toolbarview-nested-toolbar-dropdown-missing-label",t),Oe.class="ck-toolbar__nested-toolbar-dropdown",Oe.buttonView.set({label:xe,tooltip:Ie,withText:!!Ae}),ve!==!1?Oe.buttonView.icon=NESTED_TOOLBAR_ICONS[ve]||ve||icons.threeVerticalDots:Oe.buttonView.withText=!0,addToolbarToDropdown(Oe,()=>Oe.toolbarView._buildItemsFromConfig(ke,te,be)),Oe}}class ItemsView extends View{constructor(t){super(t);Re(this,"children");this.children=this.createCollection(),this.setTemplate({tag:"div",attributes:{class:["ck","ck-toolbar__items"]},children:this.children})}}class StaticLayout{constructor(we){const t=we.bindTemplate;we.set("isVertical",!1),we.itemsView.children.bindTo(we.items).using(te=>te),we.focusables.bindTo(we.items).using(te=>isFocusable(te)?te:null),we.extendTemplate({attributes:{class:[t.if("isVertical","ck-toolbar_vertical")]}})}render(){}destroy(){}}class DynamicGrouping{constructor(we){Re(this,"view");Re(this,"viewChildren");Re(this,"viewFocusables");Re(this,"viewItemsView");Re(this,"viewFocusTracker");Re(this,"viewLocale");Re(this,"ungroupedItems");Re(this,"groupedItems");Re(this,"groupedItemsDropdown");Re(this,"resizeObserver",null);Re(this,"cachedPadding",null);Re(this,"shouldUpdateGroupingOnNextResize",!1);Re(this,"viewElement");this.view=we,this.viewChildren=we.children,this.viewFocusables=we.focusables,this.viewItemsView=we.itemsView,this.viewFocusTracker=we.focusTracker,this.viewLocale=we.locale,this.ungroupedItems=we.createCollection(),this.groupedItems=we.createCollection(),this.groupedItemsDropdown=this._createGroupedItemsDropdown(),we.itemsView.children.bindTo(this.ungroupedItems).using(t=>t),this.ungroupedItems.on("change",this._updateFocusCyclableItems.bind(this)),we.children.on("change",this._updateFocusCyclableItems.bind(this)),we.items.on("change",(t,te)=>{const be=te.index,xe=Array.from(te.added);for(const ve of te.removed)be>=this.ungroupedItems.length?this.groupedItems.remove(ve):this.ungroupedItems.remove(ve);for(let ve=be;ve<be+xe.length;ve++){const ke=xe[ve-be];ve>this.ungroupedItems.length?this.groupedItems.add(ke,ve-this.ungroupedItems.length):this.ungroupedItems.add(ke,ve)}this._updateGrouping()}),we.extendTemplate({attributes:{class:["ck-toolbar_grouping"]}})}render(we){this.viewElement=we.element,this._enableGroupingOnResize(),this._enableGroupingOnMaxWidthChange(we)}destroy(){this.groupedItemsDropdown.destroy(),this.resizeObserver.destroy()}_updateGrouping(){if(!this.viewElement.ownerDocument.body.contains(this.viewElement))return;if(!isVisible(this.viewElement)){this.shouldUpdateGroupingOnNextResize=!0;return}const we=this.groupedItems.length;let t;for(;this._areItemsOverflowing;)this._groupLastItem(),t=!0;if(!t&&this.groupedItems.length){for(;this.groupedItems.length&&!this._areItemsOverflowing;)this._ungroupFirstItem();this._areItemsOverflowing&&this._groupLastItem()}this.groupedItems.length!==we&&this.view.fire("groupedItemsUpdate")}get _areItemsOverflowing(){if(!this.ungroupedItems.length)return!1;const we=this.viewElement,t=this.viewLocale.uiLanguageDirection,te=new Rect(we.lastChild),be=new Rect(we);if(!this.cachedPadding){const xe=global.window.getComputedStyle(we),ve=t==="ltr"?"paddingRight":"paddingLeft";this.cachedPadding=Number.parseInt(xe[ve])}return t==="ltr"?te.right>be.right-this.cachedPadding:te.left<be.left+this.cachedPadding}_enableGroupingOnResize(){let we;this.resizeObserver=new ResizeObserver(this.viewElement,t=>{(!we||we!==t.contentRect.width||this.shouldUpdateGroupingOnNextResize)&&(this.shouldUpdateGroupingOnNextResize=!1,this._updateGrouping(),we=t.contentRect.width)}),this._updateGrouping()}_enableGroupingOnMaxWidthChange(we){we.on("change:maxWidth",()=>{this._updateGrouping()})}_groupLastItem(){this.groupedItems.length||(this.viewChildren.add(new ToolbarSeparatorView),this.viewChildren.add(this.groupedItemsDropdown),this.viewFocusTracker.add(this.groupedItemsDropdown.element)),this.groupedItems.add(this.ungroupedItems.remove(this.ungroupedItems.last),0)}_ungroupFirstItem(){this.ungroupedItems.add(this.groupedItems.remove(this.groupedItems.first)),this.groupedItems.length||(this.viewChildren.remove(this.groupedItemsDropdown),this.viewChildren.remove(this.viewChildren.last),this.viewFocusTracker.remove(this.groupedItemsDropdown.element))}_createGroupedItemsDropdown(){const we=this.viewLocale,t=we.t,te=createDropdown(we);return te.class="ck-toolbar__grouped-dropdown",te.panelPosition=we.uiLanguageDirection==="ltr"?"sw":"se",addToolbarToDropdown(te,this.groupedItems),te.buttonView.set({label:t("Show more items"),tooltip:!0,tooltipPosition:we.uiLanguageDirection==="rtl"?"se":"sw",icon:icons.threeVerticalDots}),te}_updateFocusCyclableItems(){this.viewFocusables.clear(),this.ungroupedItems.map(we=>{isFocusable(we)&&this.viewFocusables.add(we)}),this.groupedItems.length&&this.viewFocusables.add(this.groupedItemsDropdown)}}class ListItemView extends View{constructor(t){super(t);Re(this,"children");const te=this.bindTemplate;this.set("isVisible",!0),this.children=this.createCollection(),this.setTemplate({tag:"li",attributes:{class:["ck","ck-list__item",te.if("isVisible","ck-hidden",be=>!be)],role:"presentation"},children:this.children})}focus(){this.children.first&&this.children.first.focus()}}class ListSeparatorView extends View{constructor(we){super(we),this.setTemplate({tag:"li",attributes:{class:["ck","ck-list__separator"]}})}}class ListItemGroupView extends View{constructor(t,te=new LabelView){super(t);Re(this,"labelView");Re(this,"items");Re(this,"children");const be=this.bindTemplate,xe=new ListView(t);this.set({label:"",isVisible:!0}),this.labelView=te,this.labelView.bind("text").to(this,"label"),this.children=this.createCollection(),this.children.addMany([this.labelView,xe]),xe.set({role:"group",ariaLabelledBy:te.id}),xe.focusTracker.destroy(),xe.keystrokes.destroy(),this.items=xe.items,this.setTemplate({tag:"li",attributes:{role:"presentation",class:["ck","ck-list__group",be.if("isVisible","ck-hidden",ve=>!ve)]},children:this.children})}focus(){if(this.items){const t=this.items.find(te=>!(te instanceof ListSeparatorView));t&&t.focus()}}}class ListView extends View{constructor(t){super(t);Re(this,"focusables");Re(this,"items");Re(this,"focusTracker");Re(this,"keystrokes");Re(this,"_focusCycler");Re(this,"_listItemGroupToChangeListeners",new WeakMap);const te=this.bindTemplate;this.focusables=new ViewCollection,this.items=this.createCollection(),this.focusTracker=new FocusTracker,this.keystrokes=new KeystrokeHandler,this._focusCycler=new FocusCycler({focusables:this.focusables,focusTracker:this.focusTracker,keystrokeHandler:this.keystrokes,actions:{focusPrevious:"arrowup",focusNext:"arrowdown"}}),this.set("ariaLabel",void 0),this.set("ariaLabelledBy",void 0),this.set("role",void 0),this.setTemplate({tag:"ul",attributes:{class:["ck","ck-reset","ck-list"],role:te.to("role"),"aria-label":te.to("ariaLabel"),"aria-labelledby":te.to("ariaLabelledBy")},children:this.items})}render(){super.render();for(const t of this.items)t instanceof ListItemGroupView?this._registerFocusableItemsGroup(t):t instanceof ListItemView&&this._registerFocusableListItem(t);this.items.on("change",(t,te)=>{for(const be of te.removed)be instanceof ListItemGroupView?this._deregisterFocusableItemsGroup(be):be instanceof ListItemView&&this._deregisterFocusableListItem(be);for(const be of Array.from(te.added).reverse())be instanceof ListItemGroupView?this._registerFocusableItemsGroup(be,te.index):this._registerFocusableListItem(be,te.index)}),this.keystrokes.listenTo(this.element)}destroy(){super.destroy(),this.focusTracker.destroy(),this.keystrokes.destroy()}focus(){this._focusCycler.focusFirst()}focusFirst(){this._focusCycler.focusFirst()}focusLast(){this._focusCycler.focusLast()}_registerFocusableListItem(t,te){this.focusTracker.add(t.element),this.focusables.add(t,te)}_deregisterFocusableListItem(t){this.focusTracker.remove(t.element),this.focusables.remove(t)}_getOnGroupItemsChangeCallback(t){return(te,be)=>{for(const xe of be.removed)this._deregisterFocusableListItem(xe);for(const xe of Array.from(be.added).reverse())this._registerFocusableListItem(xe,this.items.getIndex(t)+be.index)}}_registerFocusableItemsGroup(t,te){Array.from(t.items).forEach((xe,ve)=>{const ke=typeof te<"u"?te+ve:void 0;this._registerFocusableListItem(xe,ke)});const be=this._getOnGroupItemsChangeCallback(t);this._listItemGroupToChangeListeners.set(t,be),t.items.on("change",be)}_deregisterFocusableItemsGroup(t){for(const te of t.items)this._deregisterFocusableListItem(te);t.items.off("change",this._listItemGroupToChangeListeners.get(t)),this._listItemGroupToChangeListeners.delete(t)}}class SplitButtonView extends View{constructor(t,te){super(t);Re(this,"children");Re(this,"actionView");Re(this,"arrowView");Re(this,"keystrokes");Re(this,"focusTracker");const be=this.bindTemplate;this.set("class",void 0),this.set("labelStyle",void 0),this.set("icon",void 0),this.set("isEnabled",!0),this.set("isOn",!1),this.set("isToggleable",!1),this.set("isVisible",!0),this.set("keystroke",void 0),this.set("withKeystroke",!1),this.set("label",void 0),this.set("tabindex",-1),this.set("tooltip",!1),this.set("tooltipPosition","s"),this.set("type","button"),this.set("withText",!1),this.children=this.createCollection(),this.actionView=this._createActionView(te),this.arrowView=this._createArrowView(),this.keystrokes=new KeystrokeHandler,this.focusTracker=new FocusTracker,this.setTemplate({tag:"div",attributes:{class:["ck","ck-splitbutton",be.to("class"),be.if("isVisible","ck-hidden",xe=>!xe),this.arrowView.bindTemplate.if("isOn","ck-splitbutton_open")]},children:this.children})}render(){super.render(),this.children.add(this.actionView),this.children.add(this.arrowView),this.focusTracker.add(this.actionView.element),this.focusTracker.add(this.arrowView.element),this.keystrokes.listenTo(this.element),this.keystrokes.set("arrowright",(t,te)=>{this.focusTracker.focusedElement===this.actionView.element&&(this.arrowView.focus(),te())}),this.keystrokes.set("arrowleft",(t,te)=>{this.focusTracker.focusedElement===this.arrowView.element&&(this.actionView.focus(),te())})}destroy(){super.destroy(),this.focusTracker.destroy(),this.keystrokes.destroy()}focus(){this.actionView.focus()}_createActionView(t){const te=t||new ButtonView;return t||te.bind("icon","isEnabled","isOn","isToggleable","keystroke","label","tabindex","tooltip","tooltipPosition","type","withText").to(this),te.extendTemplate({attributes:{class:"ck-splitbutton__action"}}),te.delegate("execute").to(this),te}_createArrowView(){const t=new ButtonView,te=t.bindTemplate;return t.icon=dropdownArrowIcon,t.extendTemplate({attributes:{class:["ck-splitbutton__arrow"],"data-cke-tooltip-disabled":te.to("isOn"),"aria-haspopup":!0,"aria-expanded":te.to("isOn",be=>String(be))}}),t.bind("isEnabled").to(this),t.bind("label").to(this),t.bind("tooltip").to(this),t.delegate("execute").to(this,"open"),t}}function createDropdown(Te,we=DropdownButtonView){const t=typeof we=="function"?new we(Te):we,te=new DropdownPanelView(Te),be=new DropdownView(Te,t,te);return t.bind("isEnabled").to(be),t instanceof SplitButtonView?t.arrowView.bind("isOn").to(be,"isOpen"):t.bind("isOn").to(be,"isOpen"),addDefaultBehavior(be),be}function addToolbarToDropdown(Te,we,t={}){Te.extendTemplate({attributes:{class:["ck-toolbar-dropdown"]}}),Te.isOpen?addToolbarToOpenDropdown(Te,we,t):Te.once("change:isOpen",()=>addToolbarToOpenDropdown(Te,we,t),{priority:"highest"}),t.enableActiveItemFocusOnDropdownOpen&&focusChildOnDropdownOpen(Te,()=>Te.toolbarView.items.find(te=>te.isOn))}function addToolbarToOpenDropdown(Te,we,t){const te=Te.locale,be=te.t,xe=Te.toolbarView=new ToolbarView(te),ve=typeof we=="function"?we():we;xe.ariaLabel=t.ariaLabel||be("Dropdown toolbar"),t.maxWidth&&(xe.maxWidth=t.maxWidth),t.class&&(xe.class=t.class),t.isCompact&&(xe.isCompact=t.isCompact),t.isVertical&&(xe.isVertical=!0),ve instanceof ViewCollection?xe.items.bindTo(ve).using(ke=>ke):xe.items.addMany(ve),Te.panelView.children.add(xe),xe.items.delegate("execute").to(Te)}function addListToDropdown(Te,we,t={}){Te.isOpen?addListToOpenDropdown(Te,we,t):Te.once("change:isOpen",()=>addListToOpenDropdown(Te,we,t),{priority:"highest"}),focusChildOnDropdownOpen(Te,()=>Te.listView.items.find(te=>te instanceof ListItemView?te.children.first.isOn:!1))}function addListToOpenDropdown(Te,we,t){const te=Te.locale,be=Te.listView=new ListView(te),xe=typeof we=="function"?we():we;be.ariaLabel=t.ariaLabel,be.role=t.role,bindViewCollectionItemsToDefinitions(Te,be.items,xe,te),Te.panelView.children.add(be),be.items.delegate("execute").to(Te)}function focusChildOnDropdownOpen(Te,we){Te.on("change:isOpen",()=>{if(!Te.isOpen)return;const t=we();t&&(typeof t.focus=="function"?t.focus():logWarning("ui-dropdown-focus-child-on-open-child-missing-focus",{view:t}))},{priority:priorities.low-10})}function addDefaultBehavior(Te){closeDropdownOnClickOutside(Te),closeDropdownOnExecute(Te),closeDropdownOnBlur(Te),focusDropdownContentsOnArrows(Te),focusDropdownButtonOnClose(Te),focusDropdownPanelOnOpen(Te)}function closeDropdownOnClickOutside(Te){Te.on("render",()=>{clickOutsideHandler({emitter:Te,activator:()=>Te.isOpen,callback:()=>{Te.isOpen=!1},contextElements:()=>[Te.element,...Te.focusTracker._elements]})})}function closeDropdownOnExecute(Te){Te.on("execute",we=>{we.source instanceof SwitchButtonView||(Te.isOpen=!1)})}function closeDropdownOnBlur(Te){Te.focusTracker.on("change:isFocused",(we,t,te)=>{Te.isOpen&&!te&&(Te.isOpen=!1)})}function focusDropdownContentsOnArrows(Te){Te.keystrokes.set("arrowdown",(we,t)=>{Te.isOpen&&(Te.panelView.focus(),t())}),Te.keystrokes.set("arrowup",(we,t)=>{Te.isOpen&&(Te.panelView.focusLast(),t())})}function focusDropdownButtonOnClose(Te){Te.on("change:isOpen",(we,t,te)=>{if(te)return;const be=Te.panelView.element;be&&be.contains(global.document.activeElement)&&Te.buttonView.focus()})}function focusDropdownPanelOnOpen(Te){Te.on("change:isOpen",(we,t,te)=>{te&&Te.panelView.focus()},{priority:"low"})}function bindViewCollectionItemsToDefinitions(Te,we,t,te){we.bindTo(t).using(be=>{if(be.type==="separator")return new ListSeparatorView(te);if(be.type==="group"){const xe=new ListItemGroupView(te);return xe.set({label:be.label}),bindViewCollectionItemsToDefinitions(Te,xe.items,be.items,te),xe.items.delegate("execute").to(Te),xe}else if(be.type==="button"||be.type==="switchbutton"){const xe=new ListItemView(te);let ve;return be.type==="button"?(ve=new ButtonView(te),ve.bind("ariaChecked").to(ve,"isOn")):ve=new SwitchButtonView(te),ve.bind(...Object.keys(be.model)).to(be.model),ve.delegate("execute").to(xe),xe.children.add(ve),xe}return null})}const createLabeledInputText=(Te,we,t)=>{const te=new InputTextView(Te.locale);return te.set({id:we,ariaDescribedById:t}),te.bind("isReadOnly").to(Te,"isEnabled",be=>!be),te.bind("hasError").to(Te,"errorText",be=>!!be),te.on("input",()=>{Te.errorText=null}),Te.bind("isEmpty","isFocused","placeholder").to(te),te},createLabeledInputNumber=(Te,we,t)=>{const te=new InputNumberView(Te.locale);return te.set({id:we,ariaDescribedById:t,inputMode:"numeric"}),te.bind("isReadOnly").to(Te,"isEnabled",be=>!be),te.bind("hasError").to(Te,"errorText",be=>!!be),te.on("input",()=>{Te.errorText=null}),Te.bind("isEmpty","isFocused","placeholder").to(te),te},createLabeledTextarea=(Te,we,t)=>{const te=new TextareaView(Te.locale);return te.set({id:we,ariaDescribedById:t}),te.bind("isReadOnly").to(Te,"isEnabled",be=>!be),te.bind("hasError").to(Te,"errorText",be=>!!be),te.on("input",()=>{Te.errorText=null}),Te.bind("isEmpty","isFocused","placeholder").to(te),te},createLabeledDropdown=(Te,we,t)=>{const te=createDropdown(Te.locale);return te.set({id:we,ariaDescribedById:t}),te.bind("isEnabled").to(Te),te},waitingTime=150;class ColorPickerView extends View{constructor(t,te={}){super(t);Re(this,"hexInputRow");Re(this,"_debounceColorPickerEvent");Re(this,"_config");this.set({color:"",_hexColor:""}),this.hexInputRow=this._createInputRow();const be=this.createCollection();te.hideInput||be.add(this.hexInputRow),this.setTemplate({tag:"div",attributes:{class:["ck","ck-color-picker"],tabindex:-1},children:be}),this._config=te,this._debounceColorPickerEvent=debounce(xe=>{this.set("color",xe),this.fire("colorSelected",{color:this.color})},waitingTime,{leading:!0}),this.on("set:color",(xe,ve,ke)=>{xe.return=convertColor(ke,this._config.format||"hsl")}),this.on("change:color",()=>{this._hexColor=convertColorToCommonHexFormat(this.color)}),this.on("change:_hexColor",()=>{document.activeElement!==this.picker&&this.picker.setAttribute("color",this._hexColor),convertColorToCommonHexFormat(this.color)!=convertColorToCommonHexFormat(this._hexColor)&&(this.color=this._hexColor)})}render(){if(super.render(),registerCustomElement("hex-color-picker",HexBase),this.picker=global.document.createElement("hex-color-picker"),this.picker.setAttribute("class","hex-color-picker"),this.picker.setAttribute("tabindex","-1"),this._createSlidersView(),this.element){this.hexInputRow.element?this.element.insertBefore(this.picker,this.hexInputRow.element):this.element.appendChild(this.picker);const t=document.createElement("style");t.textContent='[role="slider"]:focus [part$="pointer"] {border: 1px solid #fff;outline: 1px solid var(--ck-color-focus-border);box-shadow: 0 0 0 2px #fff;}',this.picker.shadowRoot.appendChild(t)}this.picker.addEventListener("color-changed",t=>{const te=t.detail.value;this._debounceColorPickerEvent(te)})}focus(){/* istanbul ignore next -- @preserve */!this._config.hideInput&&(env.isGecko||env.isiOS||env.isSafari)&&this.hexInputRow.children.get(1).focus(),this.slidersView.first.focus()}_createSlidersView(){const be=[...this.picker.shadowRoot.children].filter(xe=>xe.getAttribute("role")==="slider").map(xe=>new SliderView(xe));this.slidersView=this.createCollection(),be.forEach(xe=>{this.slidersView.add(xe)})}_createInputRow(){const t=this._createColorInput();return new ColorPickerInputRowView(this.locale,t)}_createColorInput(){const t=new LabeledFieldView(this.locale,createLabeledInputText),{t:te}=this.locale;return t.set({label:te("HEX"),class:"color-picker-hex-input"}),t.fieldView.bind("value").to(this,"_hexColor",be=>t.isFocused?t.fieldView.value:be.startsWith("#")?be.substring(1):be),t.fieldView.on("input",()=>{const be=t.fieldView.element.value;if(be){const xe=tryParseHexColor(be);xe&&this._debounceColorPickerEvent(xe)}}),t}isValid(){const{t}=this.locale;return this.resetValidationStatus(),this.hexInputRow.getParsedColor()?!0:(this.hexInputRow.inputView.errorText=t('Please enter a valid color (e.g. "ff0000").'),!1)}resetValidationStatus(){this.hexInputRow.inputView.errorText=null}}function convertColorToCommonHexFormat(Te){let we=convertToHex(Te);return we||(we="#000"),we.length===4&&(we="#"+[we[1],we[1],we[2],we[2],we[3],we[3]].join("")),we.toLowerCase()}class SliderView extends View{constructor(we){super(),this.element=we}focus(){this.element.focus()}}class HashView extends View{constructor(we){super(we),this.setTemplate({tag:"div",attributes:{class:["ck","ck-color-picker__hash-view"]},children:"#"})}}class ColorPickerInputRowView extends View{constructor(t,te){super(t);Re(this,"children");Re(this,"inputView");this.inputView=te,this.children=this.createCollection([new HashView,this.inputView]),this.setTemplate({tag:"div",attributes:{class:["ck","ck-color-picker__row"]},children:this.children})}getParsedColor(){return tryParseHexColor(this.inputView.fieldView.element.value)}}function tryParseHexColor(Te){if(!Te)return null;const we=Te.trim().replace(/^#/,"");return![3,4,6,8].includes(we.length)||!/^(([0-9a-fA-F]{2}){3,4}|([0-9a-fA-F]){3,4})$/.test(we)?null:`#${we}`}class DocumentColorCollection extends ObservableMixin(Collection){constructor(we){super(we),this.set("isEmpty",!0),this.on("change",()=>{this.set("isEmpty",this.length===0)})}add(we,t){return this.find(te=>te.color===we.color)?this:super.add(we,t)}hasColor(we){return!!this.find(t=>t.color===we)}}class ColorGridsFragmentView extends View{constructor(t,{colors:te,columns:be,removeButtonLabel:xe,documentColorsLabel:ve,documentColorsCount:ke,colorPickerLabel:Ie,focusTracker:Ae,focusables:Se}){super(t);Re(this,"items");Re(this,"colorDefinitions");Re(this,"focusTracker");Re(this,"columns");Re(this,"documentColors");Re(this,"documentColorsCount");Re(this,"staticColorsGrid");Re(this,"documentColorsGrid");Re(this,"colorPickerButtonView");Re(this,"removeColorButtonView");Re(this,"_focusables");Re(this,"_documentColorsLabel");Re(this,"_removeButtonLabel");Re(this,"_colorPickerLabel");const Oe=this.bindTemplate;this.set("isVisible",!0),this.focusTracker=Ae,this.items=this.createCollection(),this.colorDefinitions=te,this.columns=be,this.documentColors=new DocumentColorCollection,this.documentColorsCount=ke,this._focusables=Se,this._removeButtonLabel=xe,this._colorPickerLabel=Ie,this._documentColorsLabel=ve,this.setTemplate({tag:"div",attributes:{class:["ck-color-grids-fragment",Oe.if("isVisible","ck-hidden",Ve=>!Ve)]},children:this.items}),this.removeColorButtonView=this._createRemoveColorButton(),this.items.add(this.removeColorButtonView)}updateDocumentColors(t,te){const be=t.document,xe=this.documentColorsCount;this.documentColors.clear();for(const ve of be.getRoots()){const ke=t.createRangeIn(ve);for(const Ie of ke.getItems())if(Ie.is("$textProxy")&&Ie.hasAttribute(te)&&(this._addColorToDocumentColors(Ie.getAttribute(te)),this.documentColors.length>=xe))return}}updateSelectedColors(){const t=this.documentColorsGrid,te=this.staticColorsGrid,be=this.selectedColor;te.selectedColor=be,t&&(t.selectedColor=be)}render(){if(super.render(),this.staticColorsGrid=this._createStaticColorsGrid(),this.items.add(this.staticColorsGrid),this.documentColorsCount){const t=Template.bind(this.documentColors,this.documentColors),te=new LabelView(this.locale);te.text=this._documentColorsLabel,te.extendTemplate({attributes:{class:["ck","ck-color-grid__label",t.if("isEmpty","ck-hidden")]}}),this.items.add(te),this.documentColorsGrid=this._createDocumentColorsGrid(),this.items.add(this.documentColorsGrid)}this._createColorPickerButton(),this._addColorSelectorElementsToFocusTracker()}focus(){this.removeColorButtonView.focus()}destroy(){super.destroy()}addColorPickerButton(){this.colorPickerButtonView&&(this.items.add(this.colorPickerButtonView),this.focusTracker.add(this.colorPickerButtonView.element),this._focusables.add(this.colorPickerButtonView))}_addColorSelectorElementsToFocusTracker(){this.focusTracker.add(this.removeColorButtonView.element),this._focusables.add(this.removeColorButtonView),this.staticColorsGrid&&(this.focusTracker.add(this.staticColorsGrid.element),this._focusables.add(this.staticColorsGrid)),this.documentColorsGrid&&(this.focusTracker.add(this.documentColorsGrid.element),this._focusables.add(this.documentColorsGrid))}_createColorPickerButton(){this.colorPickerButtonView=new ButtonView,this.colorPickerButtonView.set({label:this._colorPickerLabel,withText:!0,icon:icons.colorPalette,class:"ck-color-selector__color-picker"}),this.colorPickerButtonView.on("execute",()=>{this.fire("colorPicker:show")})}_createRemoveColorButton(){const t=new ButtonView;return t.set({withText:!0,icon:icons.eraser,label:this._removeButtonLabel}),t.class="ck-color-selector__remove-color",t.on("execute",()=>{this.fire("execute",{value:null,source:"removeColorButton"})}),t.render(),t}_createStaticColorsGrid(){const t=new ColorGridView(this.locale,{colorDefinitions:this.colorDefinitions,columns:this.columns});return t.on("execute",(te,be)=>{this.fire("execute",{value:be.value,source:"staticColorsGrid"})}),t}_createDocumentColorsGrid(){const t=Template.bind(this.documentColors,this.documentColors),te=new ColorGridView(this.locale,{columns:this.columns});return te.extendTemplate({attributes:{class:t.if("isEmpty","ck-hidden")}}),te.items.bindTo(this.documentColors).using(be=>{const xe=new ColorTileView;return xe.set({color:be.color,hasBorder:be.options&&be.options.hasBorder}),be.label&&xe.set({label:be.label,tooltip:!0}),xe.on("execute",()=>{this.fire("execute",{value:be.color,source:"documentColorsGrid"})}),xe}),this.documentColors.on("change:isEmpty",(be,xe,ve)=>{ve&&(te.selectedColor=null)}),te}_addColorToDocumentColors(t){const te=this.colorDefinitions.find(be=>be.color===t);te?this.documentColors.add(Object.assign({},te)):this.documentColors.add({color:t,label:t,options:{hasBorder:!1}})}}class ColorPickerFragmentView extends View{constructor(t,{focusTracker:te,focusables:be,keystrokes:xe,colorPickerViewConfig:ve}){super(t);Re(this,"items");Re(this,"colorPickerView");Re(this,"saveButtonView");Re(this,"cancelButtonView");Re(this,"actionBarView");Re(this,"focusTracker");Re(this,"keystrokes");Re(this,"_focusables");Re(this,"_colorPickerViewConfig");this.items=this.createCollection(),this.focusTracker=te,this.keystrokes=xe,this.set("isVisible",!1),this.set("selectedColor",void 0),this._focusables=be,this._colorPickerViewConfig=ve;const ke=this.bindTemplate,{saveButtonView:Ie,cancelButtonView:Ae}=this._createActionButtons();this.saveButtonView=Ie,this.cancelButtonView=Ae,this.actionBarView=this._createActionBarView({saveButtonView:Ie,cancelButtonView:Ae}),this.setTemplate({tag:"div",attributes:{class:["ck-color-picker-fragment",ke.if("isVisible","ck-hidden",Se=>!Se)]},children:this.items})}render(){super.render();const t=new ColorPickerView(this.locale,{...this._colorPickerViewConfig});this.colorPickerView=t,this.colorPickerView.render(),this.selectedColor&&(t.color=this.selectedColor),this.listenTo(this,"change:selectedColor",(te,be,xe)=>{t.color=xe}),this.items.add(this.colorPickerView),this.items.add(this.actionBarView),this._addColorPickersElementsToFocusTracker(),this._stopPropagationOnArrowsKeys(),this._executeOnEnterPress(),this._executeUponColorChange()}destroy(){super.destroy()}focus(){this.colorPickerView.focus()}resetValidationStatus(){this.colorPickerView.resetValidationStatus()}_executeOnEnterPress(){this.keystrokes.set("enter",t=>{this.isVisible&&this.focusTracker.focusedElement!==this.cancelButtonView.element&&this.colorPickerView.isValid()&&(this.fire("execute",{value:this.selectedColor}),t.stopPropagation(),t.preventDefault())})}_stopPropagationOnArrowsKeys(){const t=te=>te.stopPropagation();this.keystrokes.set("arrowright",t),this.keystrokes.set("arrowleft",t),this.keystrokes.set("arrowup",t),this.keystrokes.set("arrowdown",t)}_addColorPickersElementsToFocusTracker(){for(const te of this.colorPickerView.slidersView)this.focusTracker.add(te.element),this._focusables.add(te);const t=this.colorPickerView.hexInputRow.children.get(1);t.element&&(this.focusTracker.add(t.element),this._focusables.add(t)),this.focusTracker.add(this.saveButtonView.element),this._focusables.add(this.saveButtonView),this.focusTracker.add(this.cancelButtonView.element),this._focusables.add(this.cancelButtonView)}_createActionBarView({saveButtonView:t,cancelButtonView:te}){const be=new View,xe=this.createCollection();return xe.add(t),xe.add(te),be.setTemplate({tag:"div",attributes:{class:["ck","ck-color-selector_action-bar"]},children:xe}),be}_createActionButtons(){const t=this.locale,te=t.t,be=new ButtonView(t),xe=new ButtonView(t);return be.set({icon:icons.check,class:"ck-button-save",type:"button",withText:!1,label:te("Accept")}),xe.set({icon:icons.cancel,class:"ck-button-cancel",type:"button",withText:!1,label:te("Cancel")}),be.on("execute",()=>{this.colorPickerView.isValid()&&this.fire("execute",{source:"colorPickerSaveButton",value:this.selectedColor})}),xe.on("execute",()=>{this.fire("colorPicker:cancel")}),{saveButtonView:be,cancelButtonView:xe}}_executeUponColorChange(){this.colorPickerView.on("colorSelected",(t,te)=>{this.fire("execute",{value:te.color,source:"colorPicker"}),this.set("selectedColor",te.color)})}}class ColorSelectorView extends View{constructor(t,{colors:te,columns:be,removeButtonLabel:xe,documentColorsLabel:ve,documentColorsCount:ke,colorPickerLabel:Ie,colorPickerViewConfig:Ae}){super(t);Re(this,"focusTracker");Re(this,"keystrokes");Re(this,"items");Re(this,"colorGridsFragmentView");Re(this,"colorPickerFragmentView");Re(this,"_focusCycler");Re(this,"_focusables");Re(this,"_colorPickerViewConfig");this.items=this.createCollection(),this.focusTracker=new FocusTracker,this.keystrokes=new KeystrokeHandler,this._focusables=new ViewCollection,this._colorPickerViewConfig=Ae,this._focusCycler=new FocusCycler({focusables:this._focusables,focusTracker:this.focusTracker,keystrokeHandler:this.keystrokes,actions:{focusPrevious:"shift + tab",focusNext:"tab"}}),this.colorGridsFragmentView=new ColorGridsFragmentView(t,{colors:te,columns:be,removeButtonLabel:xe,documentColorsLabel:ve,documentColorsCount:ke,colorPickerLabel:Ie,focusTracker:this.focusTracker,focusables:this._focusables}),this.colorPickerFragmentView=new ColorPickerFragmentView(t,{focusables:this._focusables,focusTracker:this.focusTracker,keystrokes:this.keystrokes,colorPickerViewConfig:Ae}),this.set("_isColorGridsFragmentVisible",!0),this.set("_isColorPickerFragmentVisible",!1),this.set("selectedColor",void 0),this.colorGridsFragmentView.bind("isVisible").to(this,"_isColorGridsFragmentVisible"),this.colorPickerFragmentView.bind("isVisible").to(this,"_isColorPickerFragmentVisible"),this.on("change:selectedColor",(Se,Oe,Ve)=>{this.colorGridsFragmentView.set("selectedColor",Ve),this.colorPickerFragmentView.set("selectedColor",Ve)}),this.colorGridsFragmentView.on("change:selectedColor",(Se,Oe,Ve)=>{this.set("selectedColor",Ve)}),this.colorPickerFragmentView.on("change:selectedColor",(Se,Oe,Ve)=>{this.set("selectedColor",Ve)}),this.setTemplate({tag:"div",attributes:{class:["ck","ck-color-selector"]},children:this.items})}render(){super.render(),this.keystrokes.listenTo(this.element)}destroy(){super.destroy(),this.focusTracker.destroy(),this.keystrokes.destroy()}appendUI(){this._appendColorGridsFragment(),this._colorPickerViewConfig&&this._appendColorPickerFragment()}showColorPickerFragment(){!this.colorPickerFragmentView.colorPickerView||this._isColorPickerFragmentVisible||(this._isColorPickerFragmentVisible=!0,this.colorPickerFragmentView.focus(),this.colorPickerFragmentView.resetValidationStatus(),this._isColorGridsFragmentVisible=!1)}showColorGridsFragment(){this._isColorGridsFragmentVisible||(this._isColorGridsFragmentVisible=!0,this.colorGridsFragmentView.focus(),this._isColorPickerFragmentVisible=!1)}focus(){this._focusCycler.focusFirst()}focusLast(){this._focusCycler.focusLast()}updateDocumentColors(t,te){this.colorGridsFragmentView.updateDocumentColors(t,te)}updateSelectedColors(){this.colorGridsFragmentView.updateSelectedColors()}_appendColorGridsFragment(){this.items.length||(this.items.add(this.colorGridsFragmentView),this.colorGridsFragmentView.delegate("execute").to(this),this.colorGridsFragmentView.delegate("colorPicker:show").to(this))}_appendColorPickerFragment(){this.items.length!==2&&(this.items.add(this.colorPickerFragmentView),this.colorGridsFragmentView.colorPickerButtonView&&this.colorGridsFragmentView.colorPickerButtonView.on("execute",()=>{this.showColorPickerFragment()}),this.colorGridsFragmentView.addColorPickerButton(),this.colorPickerFragmentView.delegate("execute").to(this),this.colorPickerFragmentView.delegate("colorPicker:cancel").to(this))}}class ComponentFactory{constructor(we){Re(this,"editor");Re(this,"_components",new Map);this.editor=we}*names(){for(const we of this._components.values())yield we.originalName}add(we,t){this._components.set(getNormalized(we),{callback:t,originalName:we})}create(we){if(!this.has(we))throw new CKEditorError("componentfactory-item-missing",this,{name:we});return this._components.get(getNormalized(we)).callback(this.editor.locale)}has(we){return this._components.has(getNormalized(we))}}function getNormalized(Te){return String(Te).toLowerCase()}const toPx$5=toUnit("px"),POSITION_OFF_SCREEN={top:-99999,left:-99999,name:"arrowless",config:{withArrow:!1}},Cn=class Cn extends View{constructor(t){super(t);Re(this,"content");Re(this,"_pinWhenIsVisibleCallback");const te=this.bindTemplate;this.set("top",0),this.set("left",0),this.set("position","arrow_nw"),this.set("isVisible",!1),this.set("withArrow",!0),this.set("class",void 0),this._pinWhenIsVisibleCallback=null,this.content=this.createCollection(),this.setTemplate({tag:"div",attributes:{class:["ck","ck-balloon-panel",te.to("position",be=>`ck-balloon-panel_${be}`),te.if("isVisible","ck-balloon-panel_visible"),te.if("withArrow","ck-balloon-panel_with-arrow"),te.to("class")],style:{top:te.to("top",toPx$5),left:te.to("left",toPx$5)}},children:this.content})}show(){this.isVisible=!0}hide(){this.isVisible=!1}attachTo(t){this.show();const te=Cn.defaultPositions,be=Object.assign({},{element:this.element,positions:[te.southArrowNorth,te.southArrowNorthMiddleWest,te.southArrowNorthMiddleEast,te.southArrowNorthWest,te.southArrowNorthEast,te.northArrowSouth,te.northArrowSouthMiddleWest,te.northArrowSouthMiddleEast,te.northArrowSouthWest,te.northArrowSouthEast,te.viewportStickyNorth],limiter:global.document.body,fitInViewport:!0},t),xe=Cn._getOptimalPosition(be)||POSITION_OFF_SCREEN,ve=parseInt(xe.left),ke=parseInt(xe.top),Ie=xe.name,Ae=xe.config||{},{withArrow:Se=!0}=Ae;this.top=ke,this.left=ve,this.position=Ie,this.withArrow=Se}pin(t){this.unpin(),this._pinWhenIsVisibleCallback=()=>{this.isVisible?this._startPinning(t):this._stopPinning()},this._startPinning(t),this.listenTo(this,"change:isVisible",this._pinWhenIsVisibleCallback)}unpin(){this._pinWhenIsVisibleCallback&&(this._stopPinning(),this.stopListening(this,"change:isVisible",this._pinWhenIsVisibleCallback),this._pinWhenIsVisibleCallback=null,this.hide())}_startPinning(t){this.attachTo(t);const te=getDomElement(t.target),be=t.limiter?getDomElement(t.limiter):global.document.body;this.listenTo(global.document,"scroll",(xe,ve)=>{const ke=ve.target,Ie=te&&ke.contains(te),Ae=be&&ke.contains(be);(Ie||Ae||!te||!be)&&this.attachTo(t)},{useCapture:!0}),this.listenTo(global.window,"resize",()=>{this.attachTo(t)})}_stopPinning(){this.stopListening(global.document,"scroll"),this.stopListening(global.window,"resize")}static generatePositions(t={}){const{sideOffset:te=Cn.arrowSideOffset,heightOffset:be=Cn.arrowHeightOffset,stickyVerticalOffset:xe=Cn.stickyVerticalOffset,config:ve}=t;return{northWestArrowSouthWest:(Ae,Se)=>({top:ke(Ae,Se),left:Ae.left-te,name:"arrow_sw",...ve&&{config:ve}}),northWestArrowSouthMiddleWest:(Ae,Se)=>({top:ke(Ae,Se),left:Ae.left-Se.width*.25-te,name:"arrow_smw",...ve&&{config:ve}}),northWestArrowSouth:(Ae,Se)=>({top:ke(Ae,Se),left:Ae.left-Se.width/2,name:"arrow_s",...ve&&{config:ve}}),northWestArrowSouthMiddleEast:(Ae,Se)=>({top:ke(Ae,Se),left:Ae.left-Se.width*.75+te,name:"arrow_sme",...ve&&{config:ve}}),northWestArrowSouthEast:(Ae,Se)=>({top:ke(Ae,Se),left:Ae.left-Se.width+te,name:"arrow_se",...ve&&{config:ve}}),northArrowSouthWest:(Ae,Se)=>({top:ke(Ae,Se),left:Ae.left+Ae.width/2-te,name:"arrow_sw",...ve&&{config:ve}}),northArrowSouthMiddleWest:(Ae,Se)=>({top:ke(Ae,Se),left:Ae.left+Ae.width/2-Se.width*.25-te,name:"arrow_smw",...ve&&{config:ve}}),northArrowSouth:(Ae,Se)=>({top:ke(Ae,Se),left:Ae.left+Ae.width/2-Se.width/2,name:"arrow_s",...ve&&{config:ve}}),northArrowSouthMiddleEast:(Ae,Se)=>({top:ke(Ae,Se),left:Ae.left+Ae.width/2-Se.width*.75+te,name:"arrow_sme",...ve&&{config:ve}}),northArrowSouthEast:(Ae,Se)=>({top:ke(Ae,Se),left:Ae.left+Ae.width/2-Se.width+te,name:"arrow_se",...ve&&{config:ve}}),northEastArrowSouthWest:(Ae,Se)=>({top:ke(Ae,Se),left:Ae.right-te,name:"arrow_sw",...ve&&{config:ve}}),northEastArrowSouthMiddleWest:(Ae,Se)=>({top:ke(Ae,Se),left:Ae.right-Se.width*.25-te,name:"arrow_smw",...ve&&{config:ve}}),northEastArrowSouth:(Ae,Se)=>({top:ke(Ae,Se),left:Ae.right-Se.width/2,name:"arrow_s",...ve&&{config:ve}}),northEastArrowSouthMiddleEast:(Ae,Se)=>({top:ke(Ae,Se),left:Ae.right-Se.width*.75+te,name:"arrow_sme",...ve&&{config:ve}}),northEastArrowSouthEast:(Ae,Se)=>({top:ke(Ae,Se),left:Ae.right-Se.width+te,name:"arrow_se",...ve&&{config:ve}}),southWestArrowNorthWest:Ae=>({top:Ie(Ae),left:Ae.left-te,name:"arrow_nw",...ve&&{config:ve}}),southWestArrowNorthMiddleWest:(Ae,Se)=>({top:Ie(Ae),left:Ae.left-Se.width*.25-te,name:"arrow_nmw",...ve&&{config:ve}}),southWestArrowNorth:(Ae,Se)=>({top:Ie(Ae),left:Ae.left-Se.width/2,name:"arrow_n",...ve&&{config:ve}}),southWestArrowNorthMiddleEast:(Ae,Se)=>({top:Ie(Ae),left:Ae.left-Se.width*.75+te,name:"arrow_nme",...ve&&{config:ve}}),southWestArrowNorthEast:(Ae,Se)=>({top:Ie(Ae),left:Ae.left-Se.width+te,name:"arrow_ne",...ve&&{config:ve}}),southArrowNorthWest:Ae=>({top:Ie(Ae),left:Ae.left+Ae.width/2-te,name:"arrow_nw",...ve&&{config:ve}}),southArrowNorthMiddleWest:(Ae,Se)=>({top:Ie(Ae),left:Ae.left+Ae.width/2-Se.width*.25-te,name:"arrow_nmw",...ve&&{config:ve}}),southArrowNorth:(Ae,Se)=>({top:Ie(Ae),left:Ae.left+Ae.width/2-Se.width/2,name:"arrow_n",...ve&&{config:ve}}),southArrowNorthMiddleEast:(Ae,Se)=>({top:Ie(Ae),left:Ae.left+Ae.width/2-Se.width*.75+te,name:"arrow_nme",...ve&&{config:ve}}),southArrowNorthEast:(Ae,Se)=>({top:Ie(Ae),left:Ae.left+Ae.width/2-Se.width+te,name:"arrow_ne",...ve&&{config:ve}}),southEastArrowNorthWest:Ae=>({top:Ie(Ae),left:Ae.right-te,name:"arrow_nw",...ve&&{config:ve}}),southEastArrowNorthMiddleWest:(Ae,Se)=>({top:Ie(Ae),left:Ae.right-Se.width*.25-te,name:"arrow_nmw",...ve&&{config:ve}}),southEastArrowNorth:(Ae,Se)=>({top:Ie(Ae),left:Ae.right-Se.width/2,name:"arrow_n",...ve&&{config:ve}}),southEastArrowNorthMiddleEast:(Ae,Se)=>({top:Ie(Ae),left:Ae.right-Se.width*.75+te,name:"arrow_nme",...ve&&{config:ve}}),southEastArrowNorthEast:(Ae,Se)=>({top:Ie(Ae),left:Ae.right-Se.width+te,name:"arrow_ne",...ve&&{config:ve}}),westArrowEast:(Ae,Se)=>({top:Ae.top+Ae.height/2-Se.height/2,left:Ae.left-Se.width-be,name:"arrow_e",...ve&&{config:ve}}),eastArrowWest:(Ae,Se)=>({top:Ae.top+Ae.height/2-Se.height/2,left:Ae.right+be,name:"arrow_w",...ve&&{config:ve}}),viewportStickyNorth:(Ae,Se,Oe,Ve)=>{const Me=Ve||Oe;return!Ae.getIntersection(Me)||Me.height-Ae.height>xe?null:{top:Me.top+xe,left:Ae.left+Ae.width/2-Se.width/2,name:"arrowless",config:{withArrow:!1,...ve}}}};function ke(Ae,Se){return Ae.top-Se.height-be}function Ie(Ae){return Ae.bottom+be}}};Re(Cn,"arrowSideOffset",25),Re(Cn,"arrowHeightOffset",10),Re(Cn,"stickyVerticalOffset",20),Re(Cn,"_getOptimalPosition",getOptimalPosition),Re(Cn,"defaultPositions",Cn.generatePositions());let BalloonPanelView=Cn;function getDomElement(Te){return isElement$1(Te)?Te:isRange(Te)?Te.commonAncestorContainer:typeof Te=="function"?getDomElement(Te()):null}const BALLOON_CLASS="ck-tooltip",vn=class vn extends DomEmitterMixin(){constructor(t){super();Re(this,"tooltipTextView");Re(this,"balloonPanelView");Re(this,"_currentElementWithTooltip",null);Re(this,"_currentTooltipPosition",null);Re(this,"_resizeObserver",null);Re(this,"_mutationObserver",null);Re(this,"_pinTooltipDebounced");Re(this,"_unpinTooltipDebounced");Re(this,"_watchdogExcluded");if(vn._editors.add(t),vn._instance)return vn._instance;vn._instance=this,this.tooltipTextView=new View(t.locale),this.tooltipTextView.set("text",""),this.tooltipTextView.setTemplate({tag:"span",attributes:{class:["ck","ck-tooltip__text"]},children:[{text:this.tooltipTextView.bindTemplate.to("text")}]}),this.balloonPanelView=new BalloonPanelView(t.locale),this.balloonPanelView.class=BALLOON_CLASS,this.balloonPanelView.content.add(this.tooltipTextView),this._mutationObserver=createMutationObserver(()=>{this._updateTooltipPosition()}),this._pinTooltipDebounced=debounce(this._pinTooltip,600),this._unpinTooltipDebounced=debounce(this._unpinTooltip,400),this.listenTo(global.document,"keydown",this._onKeyDown.bind(this),{useCapture:!0}),this.listenTo(global.document,"mouseenter",this._onEnterOrFocus.bind(this),{useCapture:!0}),this.listenTo(global.document,"mouseleave",this._onLeaveOrBlur.bind(this),{useCapture:!0}),this.listenTo(global.document,"focus",this._onEnterOrFocus.bind(this),{useCapture:!0}),this.listenTo(global.document,"blur",this._onLeaveOrBlur.bind(this),{useCapture:!0}),this.listenTo(global.document,"scroll",this._onScroll.bind(this),{useCapture:!0}),this._watchdogExcluded=!0}destroy(t){const te=t.ui.view&&t.ui.view.body;vn._editors.delete(t),this.stopListening(t.ui),te&&te.has(this.balloonPanelView)&&te.remove(this.balloonPanelView),vn._editors.size||(this._unpinTooltip(),this.balloonPanelView.destroy(),this.stopListening(),vn._instance=null)}static getPositioningFunctions(t){const te=vn.defaultBalloonPositions;return{s:[te.southArrowNorth,te.southArrowNorthEast,te.southArrowNorthWest],n:[te.northArrowSouth],e:[te.eastArrowWest],w:[te.westArrowEast],sw:[te.southArrowNorthEast],se:[te.southArrowNorthWest]}[t]}_onKeyDown(t,te){te.key==="Escape"&&this._currentElementWithTooltip&&(this._unpinTooltip(),te.stopPropagation())}_onEnterOrFocus(t,{target:te}){const be=getDescendantWithTooltip(te);if(!be){t.name==="focus"&&this._unpinTooltip();return}be!==this._currentElementWithTooltip&&(this._unpinTooltip(),t.name==="focus"&&!be.matches(":hover")?this._pinTooltip(be,getTooltipData(be)):this._pinTooltipDebounced(be,getTooltipData(be)))}_onLeaveOrBlur(t,{target:te,relatedTarget:be}){if(t.name==="mouseleave"){if(!isElement$1(te))return;const xe=this.balloonPanelView.element,ve=xe&&(xe===be||xe.contains(be)),ke=!ve&&te===xe;if(ve){this._unpinTooltipDebounced.cancel();return}if(!ke&&this._currentElementWithTooltip&&te!==this._currentElementWithTooltip)return;const Ie=getDescendantWithTooltip(te),Ae=getDescendantWithTooltip(be);(ke||Ie&&Ie!==Ae)&&this._unpinTooltipDebounced()}else{if(this._currentElementWithTooltip&&te!==this._currentElementWithTooltip)return;this._unpinTooltipDebounced()}}_onScroll(t,{target:te}){this._currentElementWithTooltip&&(te.contains(this.balloonPanelView.element)&&te.contains(this._currentElementWithTooltip)||this._unpinTooltip())}_pinTooltip(t,{text:te,position:be,cssClass:xe}){this._unpinTooltip();const ve=first(vn._editors.values()).ui.view.body;ve.has(this.balloonPanelView)||ve.add(this.balloonPanelView),this.tooltipTextView.text=te,this.balloonPanelView.class=[BALLOON_CLASS,xe].filter(ke=>ke).join(" "),this.balloonPanelView.pin({target:t,positions:vn.getPositioningFunctions(be)}),this._resizeObserver=new ResizeObserver(t,()=>{isVisible(t)||this._unpinTooltip()}),this._mutationObserver.attach(t);for(const ke of vn._editors)this.listenTo(ke.ui,"update",this._updateTooltipPosition.bind(this),{priority:"low"});this._currentElementWithTooltip=t,this._currentTooltipPosition=be}_unpinTooltip(){this._unpinTooltipDebounced.cancel(),this._pinTooltipDebounced.cancel(),this.balloonPanelView.unpin();for(const t of vn._editors)this.stopListening(t.ui,"update");this._currentElementWithTooltip=null,this._currentTooltipPosition=null,this.tooltipTextView.text="",this._resizeObserver&&this._resizeObserver.destroy(),this._mutationObserver.detach()}_updateTooltipPosition(){if(!this._currentElementWithTooltip)return;const t=getTooltipData(this._currentElementWithTooltip);if(!isVisible(this._currentElementWithTooltip)||!t.text){this._unpinTooltip();return}this.balloonPanelView.pin({target:this._currentElementWithTooltip,positions:vn.getPositioningFunctions(t.position)})}};Re(vn,"defaultBalloonPositions",BalloonPanelView.generatePositions({heightOffset:5,sideOffset:13})),Re(vn,"_editors",new Set),Re(vn,"_instance",null);let TooltipManager=vn;function getDescendantWithTooltip(Te){return isElement$1(Te)?Te.closest("[data-cke-tooltip-text]:not([data-cke-tooltip-disabled])"):null}function getTooltipData(Te){return{text:Te.dataset.ckeTooltipText,position:Te.dataset.ckeTooltipPosition||"s",cssClass:Te.dataset.ckeTooltipClass||""}}function createMutationObserver(Te){const we=new MutationObserver(()=>{Te()});return{attach(t){we.observe(t,{attributes:!0,attributeFilter:["data-cke-tooltip-text","data-cke-tooltip-position"]})},detach(){we.disconnect()}}}var poweredByIcon=`<svg xmlns="http://www.w3.org/2000/svg" width="53" height="10" viewBox="0 0 53 10"><path fill="#1C2331" d="M31.724 1.492a15.139 15.139 0 0 0 .045 1.16 2.434 2.434 0 0 0-.687-.34 3.68 3.68 0 0 0-1.103-.166 2.332 2.332 0 0 0-1.14.255 1.549 1.549 0 0 0-.686.87c-.15.41-.225.98-.225 1.712 0 .939.148 1.659.444 2.161.297.503.792.754 1.487.754.452.015.9-.094 1.294-.316.296-.174.557-.4.771-.669l.14.852h1.282V.007h-1.623v1.485ZM31 6.496a1.77 1.77 0 0 1-.494.061.964.964 0 0 1-.521-.127.758.758 0 0 1-.296-.466 3.984 3.984 0 0 1-.093-.992 4.208 4.208 0 0 1 .098-1.052.753.753 0 0 1 .307-.477 1.08 1.08 0 0 1 .55-.122c.233-.004.466.026.69.089l.483.144v2.553c-.11.076-.213.143-.307.2a1.73 1.73 0 0 1-.417.189ZM35.68 0l-.702.004c-.322.002-.482.168-.48.497l.004.581c.002.33.164.493.486.49l.702-.004c.322-.002.481-.167.48-.496L36.165.49c-.002-.33-.164-.493-.486-.491ZM36.145 2.313l-1.612.01.034 5.482 1.613-.01-.035-5.482ZM39.623.79 37.989.8 38 2.306l-.946.056.006 1.009.949-.006.024 2.983c.003.476.143.844.419 1.106.275.26.658.39 1.148.387.132 0 .293-.01.483-.03.19-.02.38-.046.57-.08.163-.028.324-.068.482-.119l-.183-1.095-.702.004a.664.664 0 0 1-.456-.123.553.553 0 0 1-.14-.422l-.016-2.621 1.513-.01-.006-1.064-1.514.01-.01-1.503ZM46.226 2.388c-.41-.184-.956-.274-1.636-.27-.673.004-1.215.101-1.627.29-.402.179-.72.505-.888.91-.18.419-.268.979-.264 1.68.004.688.1 1.24.285 1.655.172.404.495.724.9.894.414.18.957.268 1.63.264.68-.004 1.224-.099 1.632-.284.4-.176.714-.501.878-.905.176-.418.263-.971.258-1.658-.004-.702-.097-1.261-.28-1.677a1.696 1.696 0 0 0-.888-.9Zm-.613 3.607a.77.77 0 0 1-.337.501 1.649 1.649 0 0 1-1.317.009.776.776 0 0 1-.343-.497 4.066 4.066 0 0 1-.105-1.02 4.136 4.136 0 0 1 .092-1.03.786.786 0 0 1 .337-.507 1.59 1.59 0 0 1 1.316-.008.79.79 0 0 1 .344.502c.078.337.113.683.105 1.03.012.343-.019.685-.092 1.02ZM52.114 2.07a2.67 2.67 0 0 0-1.128.278c-.39.191-.752.437-1.072.73l-.157-.846-1.273.008.036 5.572 1.623-.01-.024-3.78c.35-.124.646-.22.887-.286.26-.075.53-.114.8-.118l.45-.003.144-1.546-.286.001ZM22.083 7.426l-1.576-2.532a2.137 2.137 0 0 0-.172-.253 1.95 1.95 0 0 0-.304-.29.138.138 0 0 1 .042-.04 1.7 1.7 0 0 0 .328-.374l1.75-2.71c.01-.015.025-.028.024-.048-.01-.01-.021-.007-.031-.007L20.49 1.17a.078.078 0 0 0-.075.045l-.868 1.384c-.23.366-.46.732-.688 1.099a.108.108 0 0 1-.112.06c-.098-.005-.196-.001-.294-.002-.018 0-.038.006-.055-.007.002-.02.002-.039.005-.058a4.6 4.6 0 0 0 .046-.701V1.203c0-.02-.009-.032-.03-.03h-.033L16.93 1.17c-.084 0-.073-.01-.073.076v6.491c-.001.018.006.028.025.027h1.494c.083 0 .072.007.072-.071v-2.19c0-.055-.003-.11-.004-.166a3.366 3.366 0 0 0-.05-.417h.06c.104 0 .209.002.313-.002a.082.082 0 0 1 .084.05c.535.913 1.07 1.824 1.607 2.736a.104.104 0 0 0 .103.062c.554-.003 1.107-.002 1.66-.002l.069-.003-.019-.032-.188-.304ZM27.112 6.555c-.005-.08-.004-.08-.082-.08h-2.414c-.053 0-.106-.003-.159-.011a.279.279 0 0 1-.246-.209.558.558 0 0 1-.022-.15c0-.382 0-.762-.002-1.143 0-.032.007-.049.042-.044h2.504c.029.003.037-.012.034-.038V3.814c0-.089.013-.078-.076-.078h-2.44c-.07 0-.062.003-.062-.06v-.837c0-.047.004-.093.013-.14a.283.283 0 0 1 .241-.246.717.717 0 0 1 .146-.011h2.484c.024.002.035-.009.036-.033l.003-.038.03-.496c.01-.183.024-.365.034-.548.005-.085.003-.087-.082-.094-.218-.018-.437-.038-.655-.05a17.845 17.845 0 0 0-.657-.026 72.994 72.994 0 0 0-1.756-.016 1.7 1.7 0 0 0-.471.064 1.286 1.286 0 0 0-.817.655c-.099.196-.149.413-.145.633v3.875c0 .072.003.144.011.216a1.27 1.27 0 0 0 .711 1.029c.228.113.48.167.734.158.757-.005 1.515.002 2.272-.042.274-.016.548-.034.82-.053.03-.002.043-.008.04-.041-.008-.104-.012-.208-.019-.312a69.964 69.964 0 0 1-.05-.768ZM16.14 7.415l-.127-1.075c-.004-.03-.014-.04-.044-.037a13.125 13.125 0 0 1-.998.073c-.336.01-.672.02-1.008.016-.116-.001-.233-.014-.347-.039a.746.746 0 0 1-.45-.262c-.075-.1-.132-.211-.167-.33a3.324 3.324 0 0 1-.126-.773 9.113 9.113 0 0 1-.015-.749c0-.285.022-.57.065-.852.023-.158.066-.312.127-.46a.728.728 0 0 1 .518-.443 1.64 1.64 0 0 1 .397-.048c.628-.001 1.255.003 1.882.05.022.001.033-.006.036-.026l.003-.031.06-.55c.019-.177.036-.355.057-.532.004-.034-.005-.046-.04-.056a5.595 5.595 0 0 0-1.213-.21 10.783 10.783 0 0 0-.708-.02c-.24-.003-.48.01-.719.041a3.477 3.477 0 0 0-.625.14 1.912 1.912 0 0 0-.807.497c-.185.2-.33.433-.424.688a4.311 4.311 0 0 0-.24 1.096c-.031.286-.045.572-.042.86-.006.43.024.86.091 1.286.04.25.104.497.193.734.098.279.26.53.473.734.214.205.473.358.756.446.344.11.702.17 1.063.177a8.505 8.505 0 0 0 1.578-.083 6.11 6.11 0 0 0 .766-.18c.03-.008.047-.023.037-.057a.157.157 0 0 1-.003-.025Z"/><path fill="#AFE229" d="M6.016 6.69a1.592 1.592 0 0 0-.614.21c-.23.132-.422.32-.56.546-.044.072-.287.539-.287.539l-.836 1.528.009.006c.038.025.08.046.123.063.127.046.26.07.395.073.505.023 1.011-.007 1.517-.003.29.009.58.002.869-.022a.886.886 0 0 0 .395-.116.962.962 0 0 0 .312-.286c.056-.083.114-.163.164-.249.24-.408.48-.816.718-1.226.075-.128.148-.257.222-.386l.112-.192a1.07 1.07 0 0 0 .153-.518l-1.304.023s-1.258-.005-1.388.01Z"/><path fill="#771BFF" d="m2.848 9.044.76-1.39.184-.352c-.124-.067-.245-.14-.367-.21-.346-.204-.706-.384-1.045-.6a.984.984 0 0 1-.244-.207c-.108-.134-.136-.294-.144-.46-.021-.409-.002-.818-.009-1.227-.003-.195 0-.39.003-.585.004-.322.153-.553.427-.713l.833-.488c.22-.13.44-.257.662-.385.05-.029.105-.052.158-.077.272-.128.519-.047.76.085l.044.028c.123.06.242.125.358.196.318.178.635.357.952.537.095.056.187.117.275.184.194.144.254.35.266.578.016.284.007.569.006.853-.001.28.004.558 0 .838.592-.003 1.259 0 1.259 0l.723-.013c-.003-.292-.007-.584-.007-.876 0-.524.015-1.048-.016-1.571-.024-.42-.135-.8-.492-1.067a5.02 5.02 0 0 0-.506-.339A400.52 400.52 0 0 0 5.94.787C5.722.664 5.513.524 5.282.423 5.255.406 5.228.388 5.2.373 4.758.126 4.305-.026 3.807.21c-.097.046-.197.087-.29.14A699.896 699.896 0 0 0 .783 1.948c-.501.294-.773.717-.778 1.31-.004.36-.009.718-.001 1.077.016.754-.017 1.508.024 2.261.016.304.07.6.269.848.127.15.279.28.448.382.622.4 1.283.734 1.92 1.11l.183.109Z"/></svg>
`;const ICON_WIDTH=53,ICON_HEIGHT=10,NARROW_ROOT_HEIGHT_THRESHOLD=50,NARROW_ROOT_WIDTH_THRESHOLD=350,DEFAULT_LABEL="Powered by";class PoweredBy extends DomEmitterMixin(){constructor(t){super();Re(this,"editor");Re(this,"_balloonView");Re(this,"_showBalloonThrottled");Re(this,"_lastFocusedEditableElement");this.editor=t,this._balloonView=null,this._lastFocusedEditableElement=null,this._showBalloonThrottled=throttle(this._showBalloon.bind(this),50,{leading:!0}),t.on("ready",this._handleEditorReady.bind(this))}destroy(){const t=this._balloonView;t&&(t.unpin(),this._balloonView=null),this._showBalloonThrottled.cancel(),this.stopListening()}_handleEditorReady(){const t=this.editor,te=!!t.config.get("ui.poweredBy.forceVisible");/* istanbul ignore next -- @preserve */!te&&verifyLicense(t.config.get("licenseKey"))==="VALID"||t.ui.view&&(t.ui.focusTracker.on("change:isFocused",(be,xe,ve)=>{this._updateLastFocusedEditableElement(),ve?this._showBalloon():this._hideBalloon()}),t.ui.focusTracker.on("change:focusedElement",(be,xe,ve)=>{this._updateLastFocusedEditableElement(),ve&&this._showBalloon()}),t.ui.on("update",()=>{this._showBalloonThrottled()}))}_createBalloonView(){const t=this.editor,te=this._balloonView=new BalloonPanelView,be=getNormalizedConfig(t),xe=new PoweredByView(t.locale,be.label);te.content.add(xe),te.set({class:"ck-powered-by-balloon"}),t.ui.view.body.add(te),t.ui.focusTracker.add(te.element),this._balloonView=te}_showBalloon(){if(!this._lastFocusedEditableElement)return;const t=getBalloonAttachOptions(this.editor,this._lastFocusedEditableElement);t&&(this._balloonView||this._createBalloonView(),this._balloonView.pin(t))}_hideBalloon(){this._balloonView&&this._balloonView.unpin()}_updateLastFocusedEditableElement(){const t=this.editor,te=t.ui.focusTracker.isFocused,be=t.ui.focusTracker.focusedElement;if(!te||!be){this._lastFocusedEditableElement=null;return}const xe=Array.from(t.ui.getEditableElementsNames()).map(ve=>t.ui.getEditableElement(ve));xe.includes(be)?this._lastFocusedEditableElement=be:this._lastFocusedEditableElement=xe[0]}}class PoweredByView extends View{constructor(we,t){super(we);const te=new IconView,be=this.bindTemplate;te.set({content:poweredByIcon,isColorInherited:!1}),te.extendTemplate({attributes:{style:{width:ICON_WIDTH+"px",height:ICON_HEIGHT+"px"}}}),this.setTemplate({tag:"div",attributes:{class:["ck","ck-powered-by"],"aria-hidden":!0},children:[{tag:"a",attributes:{href:"https://ckeditor.com/?utm_source=ckeditor&utm_medium=referral&utm_campaign=701Dn000000hVgmIAE_powered_by_ckeditor_logo",target:"_blank",tabindex:"-1"},children:[...t?[{tag:"span",attributes:{class:["ck","ck-powered-by__label"]},children:[t]}]:[],te],on:{dragstart:be.to(xe=>xe.preventDefault())}}]})}}function getBalloonAttachOptions(Te,we){const t=getNormalizedConfig(Te),te=t.side==="right"?getLowerRightCornerPosition(we,t):getLowerLeftCornerPosition(we,t);return{target:we,positions:[te]}}function getLowerRightCornerPosition(Te,we){return getLowerCornerPosition(Te,we,(t,te)=>t.left+t.width-te.width-we.horizontalOffset)}function getLowerLeftCornerPosition(Te,we){return getLowerCornerPosition(Te,we,t=>t.left+we.horizontalOffset)}function getLowerCornerPosition(Te,we,t){return(te,be)=>{const xe=new Rect(Te);if(xe.width<NARROW_ROOT_WIDTH_THRESHOLD||xe.height<NARROW_ROOT_HEIGHT_THRESHOLD)return null;let ve;we.position==="inside"?ve=xe.bottom-be.height:ve=xe.bottom-be.height/2,ve-=we.verticalOffset;const ke=t(xe,be),Ae=te.clone().moveTo(ke,ve).getIntersection(be.clone().moveTo(ke,ve)).getVisible();return!Ae||Ae.getArea()<be.getArea()?null:{top:ve,left:ke,name:`position_${we.position}-side_${we.side}`,config:{withArrow:!1}}}}function getNormalizedConfig(Te){const we=Te.config.get("ui.poweredBy"),t=we&&we.position||"border";return{position:t,label:DEFAULT_LABEL,verticalOffset:t==="inside"?5:0,horizontalOffset:5,side:Te.locale.contentLanguageDirection==="ltr"?"right":"left",...we}}const AriaLiveAnnouncerPoliteness={POLITE:"polite",ASSERTIVE:"assertive"};class AriaLiveAnnouncer{constructor(we){Re(this,"editor");Re(this,"view");this.editor=we,we.once("ready",()=>{for(const t of Object.values(AriaLiveAnnouncerPoliteness))this.announce("",t)})}announce(we,t=AriaLiveAnnouncerPoliteness.POLITE){const te=this.editor;if(!te.ui.view)return;this.view||(this.view=new AriaLiveAnnouncerView(te.locale),te.ui.view.body.add(this.view));const{politeness:be,isUnsafeHTML:xe}=typeof t=="string"?{politeness:t}:t;let ve=this.view.regionViews.find(ke=>ke.politeness===be);ve||(ve=new AriaLiveAnnouncerRegionView(te,be),this.view.regionViews.add(ve)),ve.announce({announcement:we,isUnsafeHTML:xe})}}class AriaLiveAnnouncerView extends View{constructor(t){super(t);Re(this,"regionViews");this.regionViews=this.createCollection(),this.setTemplate({tag:"div",attributes:{class:["ck","ck-aria-live-announcer"]},children:this.regionViews})}}class AriaLiveAnnouncerRegionView extends View{constructor(t,te){super(t.locale);Re(this,"politeness");Re(this,"_domConverter");Re(this,"_pruneAnnouncementsInterval");this.setTemplate({tag:"div",attributes:{role:"region","aria-live":te,"aria-relevant":"additions"},children:[{tag:"ul",attributes:{class:["ck","ck-aria-live-region-list"]}}]}),t.on("destroy",()=>{this._pruneAnnouncementsInterval!==null&&(clearInterval(this._pruneAnnouncementsInterval),this._pruneAnnouncementsInterval=null)}),this.politeness=te,this._domConverter=t.data.htmlProcessor.domConverter,this._pruneAnnouncementsInterval=setInterval(()=>{this.element&&this._listElement.firstChild&&this._listElement.firstChild.remove()},5e3)}announce({announcement:t,isUnsafeHTML:te}){if(!t.trim().length)return;const be=document.createElement("li");te?this._domConverter.setContentOf(be,t):be.innerText=t,this._listElement.appendChild(be)}get _listElement(){return this.element.querySelector("ul")}}class EditorUI extends ObservableMixin(){constructor(t){super();Re(this,"editor");Re(this,"componentFactory");Re(this,"focusTracker");Re(this,"tooltipManager");Re(this,"poweredBy");Re(this,"ariaLiveAnnouncer");Re(this,"isReady",!1);Re(this,"_editableElementsMap",new Map);Re(this,"_focusableToolbarDefinitions",[]);const te=t.editing.view;this.editor=t,this.componentFactory=new ComponentFactory(t),this.focusTracker=new FocusTracker,this.tooltipManager=new TooltipManager(t),this.poweredBy=new PoweredBy(t),this.ariaLiveAnnouncer=new AriaLiveAnnouncer(t),this.set("viewportOffset",this._readViewportOffsetFromConfig()),this.once("ready",()=>{this.isReady=!0}),this.listenTo(te.document,"layoutChanged",this.update.bind(this)),this.listenTo(te,"scrollToTheSelection",this._handleScrollToTheSelection.bind(this)),this._initFocusTracking()}get element(){return null}update(){this.fire("update")}destroy(){this.stopListening(),this.focusTracker.destroy(),this.tooltipManager.destroy(this.editor),this.poweredBy.destroy();for(const t of this._editableElementsMap.values())t.ckeditorInstance=null,this.editor.keystrokes.stopListening(t);this._editableElementsMap=new Map,this._focusableToolbarDefinitions=[]}setEditableElement(t,te){this._editableElementsMap.set(t,te),te.ckeditorInstance||(te.ckeditorInstance=this.editor),this.focusTracker.add(te);const be=()=>{this.editor.editing.view.getDomRoot(t)||this.editor.keystrokes.listenTo(te)};this.isReady?be():this.once("ready",be)}removeEditableElement(t){const te=this._editableElementsMap.get(t);te&&(this._editableElementsMap.delete(t),this.editor.keystrokes.stopListening(te),this.focusTracker.remove(te),te.ckeditorInstance=null)}getEditableElement(t="main"){return this._editableElementsMap.get(t)}getEditableElementsNames(){return this._editableElementsMap.keys()}addToolbar(t,te={}){t.isRendered?(this.focusTracker.add(t.element),this.editor.keystrokes.listenTo(t.element)):t.once("render",()=>{this.focusTracker.add(t.element),this.editor.keystrokes.listenTo(t.element)}),this._focusableToolbarDefinitions.push({toolbarView:t,options:te})}get _editableElements(){return console.warn("editor-ui-deprecated-editable-elements: The EditorUI#_editableElements property has been deprecated and will be removed in the near future.",{editorUI:this}),this._editableElementsMap}_readViewportOffsetFromConfig(){const t=this.editor,te=t.config.get("ui.viewportOffset");if(te)return te;const be=t.config.get("toolbar.viewportTopOffset");return be?(console.warn("editor-ui-deprecated-viewport-offset-config: The `toolbar.vieportTopOffset` configuration option is deprecated. It will be removed from future CKEditor versions. Use `ui.viewportOffset.top` instead."),{top:be}):{top:0}}_initFocusTracking(){const t=this.editor,te=t.editing.view;let be,xe;t.keystrokes.set("Alt+F10",(ve,ke)=>{const Ie=this.focusTracker.focusedElement;Array.from(this._editableElementsMap.values()).includes(Ie)&&!Array.from(te.domRoots.values()).includes(Ie)&&(be=Ie);const Ae=this._getCurrentFocusedToolbarDefinition();(!Ae||!xe)&&(xe=this._getFocusableCandidateToolbarDefinitions());for(let Se=0;Se<xe.length;Se++){const Oe=xe.shift();if(xe.push(Oe),Oe!==Ae&&this._focusFocusableCandidateToolbar(Oe)){Ae&&Ae.options.afterBlur&&Ae.options.afterBlur();break}}ke()}),t.keystrokes.set("Esc",(ve,ke)=>{const Ie=this._getCurrentFocusedToolbarDefinition();Ie&&(be?(be.focus(),be=null):t.editing.view.focus(),Ie.options.afterBlur&&Ie.options.afterBlur(),ke())})}_getFocusableCandidateToolbarDefinitions(){const t=[];for(const te of this._focusableToolbarDefinitions){const{toolbarView:be,options:xe}=te;(isVisible(be.element)||xe.beforeFocus)&&t.push(te)}return t.sort((te,be)=>getToolbarDefinitionWeight(te)-getToolbarDefinitionWeight(be)),t}_getCurrentFocusedToolbarDefinition(){for(const t of this._focusableToolbarDefinitions)if(t.toolbarView.element&&t.toolbarView.element.contains(this.focusTracker.focusedElement))return t;return null}_focusFocusableCandidateToolbar(t){const{toolbarView:te,options:{beforeFocus:be}}=t;return be&&be(),isVisible(te.element)?(te.focus(),!0):!1}_handleScrollToTheSelection(t,te){const be={top:0,bottom:0,left:0,right:0,...this.viewportOffset};te.viewportOffset.top+=be.top,te.viewportOffset.bottom+=be.bottom,te.viewportOffset.left+=be.left,te.viewportOffset.right+=be.right}}function getToolbarDefinitionWeight(Te){const{toolbarView:we,options:t}=Te;let te=10;return isVisible(we.element)&&te--,t.isContextual&&te--,te}class EditorUIView extends View{constructor(t){super(t);Re(this,"body");this.body=new BodyCollection(t)}render(){super.render(),this.body.attachToDom()}destroy(){return this.body.detachFromDom(),super.destroy()}}class BoxedEditorUIView extends EditorUIView{constructor(t){super(t);Re(this,"top");Re(this,"main");Re(this,"_voiceLabelView");this.top=this.createCollection(),this.main=this.createCollection(),this._voiceLabelView=this._createVoiceLabel(),this.setTemplate({tag:"div",attributes:{class:["ck","ck-reset","ck-editor","ck-rounded-corners"],role:"application",dir:t.uiLanguageDirection,lang:t.uiLanguage,"aria-labelledby":this._voiceLabelView.id},children:[this._voiceLabelView,{tag:"div",attributes:{class:["ck","ck-editor__top","ck-reset_all"],role:"presentation"},children:this.top},{tag:"div",attributes:{class:["ck","ck-editor__main"],role:"presentation"},children:this.main}]})}_createVoiceLabel(){const t=this.t,te=new LabelView;return te.text=t("Rich Text Editor"),te.extendTemplate({attributes:{class:"ck-voice-label"}}),te}}class EditableUIView extends View{constructor(t,te,be){super(t);Re(this,"name",null);Re(this,"_editingView");Re(this,"_editableElement");Re(this,"_hasExternalElement");this.setTemplate({tag:"div",attributes:{class:["ck","ck-content","ck-editor__editable","ck-rounded-corners"],lang:t.contentLanguage,dir:t.contentLanguageDirection}}),this.set("isFocused",!1),this._editableElement=be,this._hasExternalElement=!!this._editableElement,this._editingView=te}render(){super.render(),this._hasExternalElement?this.template.apply(this.element=this._editableElement):this._editableElement=this.element,this.on("change:isFocused",()=>this._updateIsFocusedClasses()),this._updateIsFocusedClasses()}destroy(){this._hasExternalElement&&this.template.revert(this._editableElement),super.destroy()}get hasExternalElement(){return this._hasExternalElement}_updateIsFocusedClasses(){const t=this._editingView;t.isRenderingInProgress?be(this):te(this);function te(xe){t.change(ve=>{const ke=t.document.getRoot(xe.name);ve.addClass(xe.isFocused?"ck-focused":"ck-blurred",ke),ve.removeClass(xe.isFocused?"ck-blurred":"ck-focused",ke)})}function be(xe){t.once("change:isRenderingInProgress",(ve,ke,Ie)=>{Ie?be(xe):te(xe)})}}}class InlineEditableUIView extends EditableUIView{constructor(t,te,be,xe={}){super(t,te,be);Re(this,"_generateLabel");const ve=t.t;this.extendTemplate({attributes:{role:"textbox",class:"ck-editor__editable_inline"}}),this._generateLabel=xe.label||(()=>ve("Editor editing area: %0",this.name))}render(){super.render();const t=this._editingView;t.change(te=>{const be=t.document.getRoot(this.name);te.setAttribute("aria-label",this._generateLabel(this),be)})}}class Notification extends ContextPlugin{static get pluginName(){return"Notification"}init(){this.on("show:warning",(we,t)=>{window.alert(t.message)},{priority:"lowest"})}showSuccess(we,t={}){this._showNotification({message:we,type:"success",namespace:t.namespace,title:t.title})}showInfo(we,t={}){this._showNotification({message:we,type:"info",namespace:t.namespace,title:t.title})}showWarning(we,t={}){this._showNotification({message:we,type:"warning",namespace:t.namespace,title:t.title})}_showNotification(we){const t=we.namespace?`show:${we.type}:${we.namespace}`:`show:${we.type}`;this.fire(t,{message:we.message,type:we.type,title:we.title||""})}}class Model extends ObservableMixin(){constructor(we,t){super(),t&&assignIn(this,t),we&&this.set(we)}}const toPx$4=toUnit("px");class ContextualBalloon extends Plugin{constructor(t){super(t);Re(this,"positionLimiter");Re(this,"visibleStack");Re(this,"_viewToStack",new Map);Re(this,"_idToStack",new Map);Re(this,"_view",null);Re(this,"_rotatorView",null);Re(this,"_fakePanelsView",null);this.positionLimiter=()=>{const te=this.editor.editing.view,xe=te.document.selection.editableElement;return xe?te.domConverter.mapViewToDom(xe.root):null},this.set("visibleView",null),this.set("_numberOfStacks",0),this.set("_singleViewMode",!1)}static get pluginName(){return"ContextualBalloon"}destroy(){super.destroy(),this._view&&this._view.destroy(),this._rotatorView&&this._rotatorView.destroy(),this._fakePanelsView&&this._fakePanelsView.destroy()}get view(){return this._view||this._createPanelView(),this._view}hasView(t){return Array.from(this._viewToStack.keys()).includes(t)}add(t){if(this._view||this._createPanelView(),this.hasView(t.view))throw new CKEditorError("contextualballoon-add-view-exist",[this,t]);const te=t.stackId||"main";if(!this._idToStack.has(te)){this._idToStack.set(te,new Map([[t.view,t]])),this._viewToStack.set(t.view,this._idToStack.get(te)),this._numberOfStacks=this._idToStack.size,(!this._visibleStack||t.singleViewMode)&&this.showStack(te);return}const be=this._idToStack.get(te);t.singleViewMode&&this.showStack(te),be.set(t.view,t),this._viewToStack.set(t.view,be),be===this._visibleStack&&this._showView(t)}remove(t){if(!this.hasView(t))throw new CKEditorError("contextualballoon-remove-view-not-exist",[this,t]);const te=this._viewToStack.get(t);this._singleViewMode&&this.visibleView===t&&(this._singleViewMode=!1),this.visibleView===t&&(te.size===1?this._idToStack.size>1?this._showNextStack():(this.view.hide(),this.visibleView=null,this._rotatorView.hideView()):this._showView(Array.from(te.values())[te.size-2])),te.size===1?(this._idToStack.delete(this._getStackId(te)),this._numberOfStacks=this._idToStack.size):te.delete(t),this._viewToStack.delete(t)}updatePosition(t){t&&(this._visibleStack.get(this.visibleView).position=t),this.view.pin(this._getBalloonPosition()),this._fakePanelsView.updatePosition()}showStack(t){this.visibleStack=t;const te=this._idToStack.get(t);if(!te)throw new CKEditorError("contextualballoon-showstack-stack-not-exist",this);this._visibleStack!==te&&this._showView(Array.from(te.values()).pop())}_createPanelView(){this._view=new BalloonPanelView(this.editor.locale),this.editor.ui.view.body.add(this._view),this.editor.ui.focusTracker.add(this._view.element),this._rotatorView=this._createRotatorView(),this._fakePanelsView=this._createFakePanelsView()}get _visibleStack(){return this._viewToStack.get(this.visibleView)}_getStackId(t){return Array.from(this._idToStack.entries()).find(be=>be[1]===t)[0]}_showNextStack(){const t=Array.from(this._idToStack.values());let te=t.indexOf(this._visibleStack)+1;t[te]||(te=0),this.showStack(this._getStackId(t[te]))}_showPrevStack(){const t=Array.from(this._idToStack.values());let te=t.indexOf(this._visibleStack)-1;t[te]||(te=t.length-1),this.showStack(this._getStackId(t[te]))}_createRotatorView(){const t=new RotatorView(this.editor.locale),te=this.editor.locale.t;return this.view.content.add(t),t.bind("isNavigationVisible").to(this,"_numberOfStacks",this,"_singleViewMode",(be,xe)=>!xe&&be>1),t.on("change:isNavigationVisible",()=>this.updatePosition(),{priority:"low"}),t.bind("counter").to(this,"visibleView",this,"_numberOfStacks",(be,xe)=>{if(xe<2)return"";const ve=Array.from(this._idToStack.values()).indexOf(this._visibleStack)+1;return te("%0 of %1",[ve,xe])}),t.buttonNextView.on("execute",()=>{t.focusTracker.isFocused&&this.editor.editing.view.focus(),this._showNextStack()}),t.buttonPrevView.on("execute",()=>{t.focusTracker.isFocused&&this.editor.editing.view.focus(),this._showPrevStack()}),t}_createFakePanelsView(){const t=new FakePanelsView(this.editor.locale,this.view);return t.bind("numberOfPanels").to(this,"_numberOfStacks",this,"_singleViewMode",(te,be)=>!be&&te>=2?Math.min(te-1,2):0),t.listenTo(this.view,"change:top",()=>t.updatePosition()),t.listenTo(this.view,"change:left",()=>t.updatePosition()),this.editor.ui.view.body.add(t),t}_showView({view:t,balloonClassName:te="",withArrow:be=!0,singleViewMode:xe=!1}){this.view.class=te,this.view.withArrow=be,this._rotatorView.showView(t),this.visibleView=t,this.view.pin(this._getBalloonPosition()),this._fakePanelsView.updatePosition(),xe&&(this._singleViewMode=!0)}_getBalloonPosition(){let t=Array.from(this._visibleStack.values()).pop().position;return t&&(t.limiter||(t=Object.assign({},t,{limiter:this.positionLimiter})),t=Object.assign({},t,{viewportOffsetConfig:this.editor.ui.viewportOffset})),t}}class RotatorView extends View{constructor(t){super(t);Re(this,"focusTracker");Re(this,"buttonPrevView");Re(this,"buttonNextView");Re(this,"content");const te=t.t,be=this.bindTemplate;this.set("isNavigationVisible",!0),this.focusTracker=new FocusTracker,this.buttonPrevView=this._createButtonView(te("Previous"),icons.previousArrow),this.buttonNextView=this._createButtonView(te("Next"),icons.nextArrow),this.content=this.createCollection(),this.setTemplate({tag:"div",attributes:{class:["ck","ck-balloon-rotator"],"z-index":"-1"},children:[{tag:"div",attributes:{class:["ck-balloon-rotator__navigation",be.to("isNavigationVisible",xe=>xe?"":"ck-hidden")]},children:[this.buttonPrevView,{tag:"span",attributes:{class:["ck-balloon-rotator__counter"]},children:[{text:be.to("counter")}]},this.buttonNextView]},{tag:"div",attributes:{class:"ck-balloon-rotator__content"},children:this.content}]})}render(){super.render(),this.focusTracker.add(this.element)}destroy(){super.destroy(),this.focusTracker.destroy()}showView(t){this.hideView(),this.content.add(t)}hideView(){this.content.clear()}_createButtonView(t,te){const be=new ButtonView(this.locale);return be.set({label:t,icon:te,tooltip:!0}),be}}class FakePanelsView extends View{constructor(t,te){super(t);Re(this,"content");Re(this,"_balloonPanelView");const be=this.bindTemplate;this.set("top",0),this.set("left",0),this.set("height",0),this.set("width",0),this.set("numberOfPanels",0),this.content=this.createCollection(),this._balloonPanelView=te,this.setTemplate({tag:"div",attributes:{class:["ck-fake-panel",be.to("numberOfPanels",xe=>xe?"":"ck-hidden")],style:{top:be.to("top",toPx$4),left:be.to("left",toPx$4),width:be.to("width",toPx$4),height:be.to("height",toPx$4)}},children:this.content}),this.on("change:numberOfPanels",(xe,ve,ke,Ie)=>{ke>Ie?this._addPanels(ke-Ie):this._removePanels(Ie-ke),this.updatePosition()})}_addPanels(t){for(;t--;){const te=new View;te.setTemplate({tag:"div"}),this.content.add(te),this.registerChild(te)}}_removePanels(t){for(;t--;){const te=this.content.last;this.content.remove(te),this.deregisterChild(te),te.destroy()}}updatePosition(){if(this.numberOfPanels){const{top:t,left:te}=this._balloonPanelView,{width:be,height:xe}=new Rect(this._balloonPanelView.element);Object.assign(this,{top:t,left:te,width:be,height:xe})}}}const toPx$3=toUnit("px");class StickyPanelView extends View{constructor(t){super(t);Re(this,"content");Re(this,"contentPanelElement");Re(this,"_contentPanelPlaceholder");const te=this.bindTemplate;this.set("isActive",!1),this.set("isSticky",!1),this.set("limiterElement",null),this.set("limiterBottomOffset",50),this.set("viewportTopOffset",0),this.set("_marginLeft",null),this.set("_isStickyToTheBottomOfLimiter",!1),this.set("_stickyTopOffset",null),this.set("_stickyBottomOffset",null),this.content=this.createCollection(),this._contentPanelPlaceholder=new Template({tag:"div",attributes:{class:["ck","ck-sticky-panel__placeholder"],style:{display:te.to("isSticky",be=>be?"block":"none"),height:te.to("isSticky",be=>be?toPx$3(this._contentPanelRect.height):null)}}}).render(),this.contentPanelElement=new Template({tag:"div",attributes:{class:["ck","ck-sticky-panel__content",te.if("isSticky","ck-sticky-panel__content_sticky"),te.if("_isStickyToTheBottomOfLimiter","ck-sticky-panel__content_sticky_bottom-limit")],style:{width:te.to("isSticky",be=>be?toPx$3(this._contentPanelPlaceholder.getBoundingClientRect().width):null),top:te.to("_stickyTopOffset",be=>be&&toPx$3(be)),bottom:te.to("_stickyBottomOffset",be=>be&&toPx$3(be)),marginLeft:te.to("_marginLeft")}},children:this.content}).render(),this.setTemplate({tag:"div",attributes:{class:["ck","ck-sticky-panel"]},children:[this._contentPanelPlaceholder,this.contentPanelElement]})}render(){super.render(),this.checkIfShouldBeSticky(),this.listenTo(global.document,"scroll",()=>{this.checkIfShouldBeSticky()},{useCapture:!0}),this.listenTo(this,"change:isActive",()=>{this.checkIfShouldBeSticky()})}checkIfShouldBeSticky(){if(!this.limiterElement||!this.isActive){this._unstick();return}const t=new Rect(this.limiterElement);let te=t.getVisible();if(te){const be=new Rect(global.window);be.top+=this.viewportTopOffset,be.height-=this.viewportTopOffset,te=te.getIntersection(be)}if(te&&t.top<te.top){const be=te.top;if(be+this._contentPanelRect.height+this.limiterBottomOffset>te.bottom){const xe=Math.max(t.bottom-te.bottom,0)+this.limiterBottomOffset;t.bottom-xe>t.top+this._contentPanelRect.height?this._stickToBottomOfLimiter(xe):this._unstick()}else this._contentPanelRect.height+this.limiterBottomOffset<t.height?this._stickToTopOfAncestors(be):this._unstick()}else this._unstick()}_stickToTopOfAncestors(t){this.isSticky=!0,this._isStickyToTheBottomOfLimiter=!1,this._stickyTopOffset=t,this._stickyBottomOffset=null,this._marginLeft=toPx$3(-global.window.scrollX)}_stickToBottomOfLimiter(t){this.isSticky=!0,this._isStickyToTheBottomOfLimiter=!0,this._stickyTopOffset=null,this._stickyBottomOffset=t,this._marginLeft=toPx$3(-global.window.scrollX)}_unstick(){this.isSticky=!1,this._isStickyToTheBottomOfLimiter=!1,this._stickyTopOffset=null,this._stickyBottomOffset=null,this._marginLeft=null}get _contentPanelRect(){return new Rect(this.contentPanelElement)}}class SearchTextQueryView extends LabeledFieldView{constructor(t,te){const be=t.t,xe=Object.assign({},{showResetButton:!0,showIcon:!0,creator:createLabeledInputText},te);super(t,xe.creator);Re(this,"iconView");Re(this,"resetButtonView");Re(this,"_viewConfig");this.label=te.label,this._viewConfig=xe,this._viewConfig.showIcon&&(this.iconView=new IconView,this.iconView.content=icons.loupe,this.fieldWrapperChildren.add(this.iconView,0),this.extendTemplate({attributes:{class:"ck-search__query_with-icon"}})),this._viewConfig.showResetButton&&(this.resetButtonView=new ButtonView(t),this.resetButtonView.set({label:be("Clear"),icon:icons.cancel,class:"ck-search__reset",isVisible:!1,tooltip:!0}),this.resetButtonView.on("execute",()=>{this.reset(),this.focus(),this.fire("reset")}),this.resetButtonView.bind("isVisible").to(this.fieldView,"isEmpty",ve=>!ve),this.fieldWrapperChildren.add(this.resetButtonView),this.extendTemplate({attributes:{class:"ck-search__query_with-reset"}}))}reset(){this.fieldView.reset(),this._viewConfig.showResetButton&&(this.resetButtonView.isVisible=!1)}}class SearchInfoView extends View{constructor(){super();const we=this.bindTemplate;this.set({isVisible:!1,primaryText:"",secondaryText:""}),this.setTemplate({tag:"div",attributes:{class:["ck","ck-search__info",we.if("isVisible","ck-hidden",t=>!t)],tabindex:-1},children:[{tag:"span",children:[{text:[we.to("primaryText")]}]},{tag:"span",children:[{text:[we.to("secondaryText")]}]}]})}focus(){this.element.focus()}}class SearchResultsView extends View{constructor(t){super(t);Re(this,"focusTracker");Re(this,"children");Re(this,"_focusCycler");this.children=this.createCollection(),this.focusTracker=new FocusTracker,this.setTemplate({tag:"div",attributes:{class:["ck","ck-search__results"],tabindex:-1},children:this.children}),this._focusCycler=new FocusCycler({focusables:this.children,focusTracker:this.focusTracker})}render(){super.render();for(const t of this.children)this.focusTracker.add(t.element)}focus(){this._focusCycler.focusFirst()}focusFirst(){this._focusCycler.focusFirst()}focusLast(){this._focusCycler.focusLast()}}class SearchTextView extends View{constructor(t,te){super(t);Re(this,"focusTracker");Re(this,"keystrokes");Re(this,"resultsView");Re(this,"filteredView");Re(this,"infoView");Re(this,"queryView");Re(this,"focusCycler");Re(this,"_config");this._config=te,this.filteredView=te.filteredView,this.queryView=this._createSearchTextQueryView(),this.focusTracker=new FocusTracker,this.keystrokes=new KeystrokeHandler,this.resultsView=new SearchResultsView(t),this.children=this.createCollection(),this.focusableChildren=this.createCollection([this.queryView,this.resultsView]),this.set("isEnabled",!0),this.set("resultsCount",0),this.set("totalItemsCount",0),te.infoView&&te.infoView.instance?this.infoView=te.infoView.instance:(this.infoView=new SearchInfoView,this._enableDefaultInfoViewBehavior(),this.on("render",()=>{this.search("")})),this.resultsView.children.addMany([this.infoView,this.filteredView]),this.focusCycler=new FocusCycler({focusables:this.focusableChildren,focusTracker:this.focusTracker,keystrokeHandler:this.keystrokes,actions:{focusPrevious:"shift + tab",focusNext:"tab"}}),this.on("search",(be,{resultsCount:xe,totalItemsCount:ve})=>{this.resultsCount=xe,this.totalItemsCount=ve}),this.setTemplate({tag:"div",attributes:{class:["ck","ck-search",te.class||null],tabindex:"-1"},children:this.children})}render(){super.render(),this.children.addMany([this.queryView,this.resultsView]);const t=te=>te.stopPropagation();for(const te of this.focusableChildren)this.focusTracker.add(te.element);this.keystrokes.listenTo(this.element),this.keystrokes.set("arrowright",t),this.keystrokes.set("arrowleft",t),this.keystrokes.set("arrowup",t),this.keystrokes.set("arrowdown",t)}focus(){this.queryView.focus()}reset(){this.queryView.reset(),this.search("")}search(t){const te=t?new RegExp(escapeRegExp(t),"ig"):null,be=this.filteredView.filter(te);this.fire("search",{query:t,...be})}_createSearchTextQueryView(){const t=new SearchTextQueryView(this.locale,this._config.queryView);return this.listenTo(t.fieldView,"input",()=>{this.search(t.fieldView.element.value)}),t.on("reset",()=>this.reset()),t.bind("isEnabled").to(this),t}_enableDefaultInfoViewBehavior(){const t=this.locale.t,te=this.infoView;this.on("search",(xe,ve)=>{if(ve.resultsCount)te.set({isVisible:!1});else{const ke=this._config.infoView&&this._config.infoView.text;let Ie,Ae;ve.totalItemsCount?ke&&ke.notFound?(Ie=ke.notFound.primary,Ae=ke.notFound.secondary):(Ie=t("No results found"),Ae=""):ke&&ke.noSearchableItems?(Ie=ke.noSearchableItems.primary,Ae=ke.noSearchableItems.secondary):(Ie=t("No searchable items"),Ae=""),te.set({primaryText:be(Ie,ve),secondaryText:be(Ae,ve),isVisible:!0})}});function be(xe,{query:ve,resultsCount:ke,totalItemsCount:Ie}){return typeof xe=="function"?xe(ve,ke,Ie):xe}}}const Pi=class Pi extends SearchTextView{constructor(t,te){super(t,te);Re(this,"_config");this._config=te;const be=toUnit("px");this.extendTemplate({attributes:{class:["ck-autocomplete"]}});const xe=this.resultsView.bindTemplate;this.resultsView.set("isVisible",!1),this.resultsView.set("_position","s"),this.resultsView.set("_width",0),this.resultsView.extendTemplate({attributes:{class:[xe.if("isVisible","ck-hidden",ve=>!ve),xe.to("_position",ve=>`ck-search__results_${ve}`)],style:{width:xe.to("_width",be)}}}),this.focusTracker.on("change:isFocused",(ve,ke,Ie)=>{this._updateResultsVisibility(),Ie?this.resultsView.element.scrollTop=0:te.resetOnBlur&&this.queryView.reset()}),this.on("search",()=>{this._updateResultsVisibility(),this._updateResultsViewWidthAndPosition()}),this.keystrokes.set("esc",(ve,ke)=>{this.resultsView.isVisible&&(this.queryView.focus(),this.resultsView.isVisible=!1,ke())}),this.listenTo(global.document,"scroll",()=>{this._updateResultsViewWidthAndPosition()}),this.on("change:isEnabled",()=>{this._updateResultsVisibility()}),this.filteredView.on("execute",(ve,{value:ke})=>{this.focus(),this.reset(),this.queryView.fieldView.value=this.queryView.fieldView.element.value=ke,this.resultsView.isVisible=!1}),this.resultsView.on("change:isVisible",()=>{this._updateResultsViewWidthAndPosition()})}_updateResultsViewWidthAndPosition(){if(!this.resultsView.isVisible)return;this.resultsView._width=new Rect(this.queryView.fieldView.element).width;const t=Pi._getOptimalPosition({element:this.resultsView.element,target:this.queryView.element,fitInViewport:!0,positions:Pi.defaultResultsPositions});this.resultsView._position=t?t.name:"s"}_updateResultsVisibility(){const t=typeof this._config.queryMinChars>"u"?0:this._config.queryMinChars,te=this.queryView.fieldView.element.value.length;this.resultsView.isVisible=this.focusTracker.isFocused&&this.isEnabled&&te>=t}};Re(Pi,"defaultResultsPositions",[t=>({top:t.bottom,left:t.left,name:"s"}),(t,te)=>({top:t.top-te.height,left:t.left,name:"n"})]),Re(Pi,"_getOptimalPosition",getOptimalPosition);let AutocompleteView=Pi;class HighlightedTextView extends View{constructor(){super(),this.set("text",void 0),this.setTemplate({tag:"span",attributes:{class:["ck","ck-highlighted-text"]}}),this.on("render",()=>{this.on("change:text",()=>{this._updateInnerHTML(this.text)}),this._updateInnerHTML(this.text)})}highlightText(we){this._updateInnerHTML(markText(this.text||"",we))}_updateInnerHTML(we){this.element.innerHTML=we||""}}function markText(Te,we){if(!we)return escape$1(Te);const t=[];let te=0,be=we.exec(Te);for(;be!==null;){const ve=be.index;ve!==te&&t.push({text:Te.substring(te,ve),isMatch:!1}),t.push({text:be[0],isMatch:!0}),te=we.lastIndex,be=we.exec(Te)}return te!==Te.length&&t.push({text:Te.substring(te),isMatch:!1}),t.map(ve=>(ve.text=escape$1(ve.text),ve)).map(ve=>ve.isMatch?`<mark>${ve.text}</mark>`:ve.text).join("")}class SpinnerView extends View{constructor(){super(),this.set("isVisible",!1);const we=this.bindTemplate;this.setTemplate({tag:"span",attributes:{class:["ck","ck-spinner-container",we.if("isVisible","ck-hidden",t=>!t)]},children:[{tag:"span",attributes:{class:["ck","ck-spinner"]}}]})}}const toPx$2=toUnit("px");class BalloonToolbar extends Plugin{constructor(t){super(t);Re(this,"toolbarView");Re(this,"focusTracker");Re(this,"_balloonConfig");Re(this,"_resizeObserver",null);Re(this,"_balloon");Re(this,"_fireSelectionChangeDebounced");this._balloonConfig=normalizeToolbarConfig(t.config.get("balloonToolbar")),this.toolbarView=this._createToolbarView(),this.focusTracker=new FocusTracker,t.ui.once("ready",()=>{this.focusTracker.add(t.ui.getEditableElement()),this.focusTracker.add(this.toolbarView.element)}),t.ui.addToolbar(this.toolbarView,{beforeFocus:()=>this.show(!0),afterBlur:()=>this.hide(),isContextual:!0}),this._balloon=t.plugins.get(ContextualBalloon),this._fireSelectionChangeDebounced=debounce(()=>this.fire("_selectionChangeDebounced"),200),this.decorate("show")}static get pluginName(){return"BalloonToolbar"}static get requires(){return[ContextualBalloon]}init(){const t=this.editor,te=t.model.document.selection;this.listenTo(this.focusTracker,"change:isFocused",(be,xe,ve)=>{const ke=this._balloon.visibleView===this.toolbarView;!ve&&ke?this.hide():ve&&this.show()}),this.listenTo(te,"change:range",(be,xe)=>{(xe.directChange||te.isCollapsed)&&this.hide(),this._fireSelectionChangeDebounced()}),this.listenTo(this,"_selectionChangeDebounced",()=>{this.editor.editing.view.document.isFocused&&this.show()}),this._balloonConfig.shouldNotGroupWhenFull||this.listenTo(t,"ready",()=>{const be=t.ui.view.editable.element;this._resizeObserver=new ResizeObserver(be,xe=>{this.toolbarView.maxWidth=toPx$2(xe.contentRect.width*.9)})}),this.listenTo(this.toolbarView,"groupedItemsUpdate",()=>{this._updatePosition()}),t.ui.once("ready",()=>{this.toolbarView.fillFromConfig(this._balloonConfig,this.editor.ui.componentFactory)})}_createToolbarView(){const t=this.editor.locale.t,te=!this._balloonConfig.shouldNotGroupWhenFull,be=new ToolbarView(this.editor.locale,{shouldGroupWhenFull:te,isFloating:!0});return be.ariaLabel=t("Editor contextual toolbar"),be.render(),be}show(t=!1){const te=this.editor,be=te.model.document.selection,xe=te.model.schema;this._balloon.hasView(this.toolbarView)||be.isCollapsed&&!t||selectionContainsOnlyMultipleSelectables(be,xe)||Array.from(this.toolbarView.items).every(ve=>ve.isEnabled!==void 0&&!ve.isEnabled)||(this.listenTo(this.editor.ui,"update",()=>{this._updatePosition()}),this._balloon.add({view:this.toolbarView,position:this._getBalloonPositionData(),balloonClassName:"ck-toolbar-container"}))}hide(){this._balloon.hasView(this.toolbarView)&&(this.stopListening(this.editor.ui,"update"),this._balloon.remove(this.toolbarView))}_getBalloonPositionData(){const te=this.editor.editing.view,be=te.document,xe=be.selection,ve=be.selection.isBackward;return{target:()=>{const ke=ve?xe.getFirstRange():xe.getLastRange(),Ie=Rect.getDomRangeRects(te.domConverter.viewRangeToDom(ke));return ve?Ie[0]:(Ie.length>1&&Ie[Ie.length-1].width===0&&Ie.pop(),Ie[Ie.length-1])},positions:this._getBalloonPositions(ve)}}_updatePosition(){this._balloon.updatePosition(this._getBalloonPositionData())}destroy(){super.destroy(),this.stopListening(),this._fireSelectionChangeDebounced.cancel(),this.toolbarView.destroy(),this.focusTracker.destroy(),this._resizeObserver&&this._resizeObserver.destroy()}_getBalloonPositions(t){const be=env.isSafari&&env.isiOS?BalloonPanelView.generatePositions({heightOffset:Math.max(BalloonPanelView.arrowHeightOffset,Math.round(20/global.window.visualViewport.scale))}):BalloonPanelView.defaultPositions;return t?[be.northWestArrowSouth,be.northWestArrowSouthWest,be.northWestArrowSouthEast,be.northWestArrowSouthMiddleEast,be.northWestArrowSouthMiddleWest,be.southWestArrowNorth,be.southWestArrowNorthWest,be.southWestArrowNorthEast,be.southWestArrowNorthMiddleWest,be.southWestArrowNorthMiddleEast]:[be.southEastArrowNorth,be.southEastArrowNorthEast,be.southEastArrowNorthWest,be.southEastArrowNorthMiddleEast,be.southEastArrowNorthMiddleWest,be.northEastArrowSouth,be.northEastArrowSouthEast,be.northEastArrowSouthWest,be.northEastArrowSouthMiddleEast,be.northEastArrowSouthMiddleWest]}}function selectionContainsOnlyMultipleSelectables(Te,we){return Te.rangeCount===1?!1:[...Te.getRanges()].every(t=>{const te=t.getContainedElement();return te&&we.isSelectable(te)})}class MenuBarMenuButtonView extends ButtonView{constructor(t){super(t);Re(this,"arrowView");const te=this.bindTemplate;this.set({withText:!0,role:"menuitem"}),this.arrowView=this._createArrowView(),this.extendTemplate({attributes:{class:["ck-menu-bar__menu__button"],"aria-haspopup":!0,"aria-expanded":this.bindTemplate.to("isOn",be=>String(be)),"data-cke-tooltip-disabled":te.to("isOn")},on:{mouseenter:te.to("mouseenter")}})}render(){super.render(),this.children.add(this.arrowView)}_createArrowView(){const t=new IconView;return t.content=dropdownArrowIcon,t.extendTemplate({attributes:{class:"ck-menu-bar__menu__button__arrow"}}),t}}class MenuBarMenuListItemView extends ListItemView{constructor(we,t){super(we);const te=this.bindTemplate;this.extendTemplate({attributes:{class:["ck-menu-bar__menu__item"]},on:{mouseenter:te.to("mouseenter")}}),this.delegate("mouseenter").to(t)}}const NESTED_PANEL_HORIZONTAL_OFFSET=5,MenuBarBehaviors={toggleMenusAndFocusItemsOnHover(Te){Te.on("menu:mouseenter",we=>{if(Te.isOpen){for(const t of Te.menus){const te=we.path[0],be=te instanceof MenuBarMenuListItemView&&te.children.first===t;t.isOpen=(we.path.includes(t)||be)&&t.isEnabled}we.source.focus()}})},focusCycleMenusOnArrows(Te){const we=Te.locale.uiLanguageDirection==="rtl";Te.on("menu:arrowright",te=>{t(te.source,we?-1:1)}),Te.on("menu:arrowleft",te=>{t(te.source,we?1:-1)});function t(te,be){const xe=Te.children.getIndex(te),ve=te.isOpen,ke=Te.children.length,Ie=Te.children.get((xe+ke+be)%ke);te.isOpen=!1,ve&&(Ie.isOpen=!0),Ie.buttonView.focus()}},closeMenusWhenTheBarCloses(Te){Te.on("change:isOpen",()=>{Te.isOpen||Te.menus.forEach(we=>{we.isOpen=!1})})},closeMenuWhenAnotherOnTheSameLevelOpens(Te){Te.on("menu:change:isOpen",(we,t,te)=>{te&&Te.menus.filter(be=>we.source.parentMenuView===be.parentMenuView&&we.source!==be&&be.isOpen).forEach(be=>{be.isOpen=!1})})},closeOnClickOutside(Te){clickOutsideHandler({emitter:Te,activator:()=>Te.isOpen,callback:()=>Te.close(),contextElements:()=>Te.children.map(we=>we.element)})}},MenuBarMenuBehaviors={openAndFocusPanelOnArrowDownKey(Te){Te.keystrokes.set("arrowdown",(we,t)=>{Te.focusTracker.focusedElement===Te.buttonView.element&&(Te.isOpen||(Te.isOpen=!0),Te.panelView.focus(),t())})},openOnArrowRightKey(Te){const we=Te.locale.uiLanguageDirection==="rtl"?"arrowleft":"arrowright";Te.keystrokes.set(we,(t,te)=>{Te.focusTracker.focusedElement!==Te.buttonView.element||!Te.isEnabled||(Te.isOpen||(Te.isOpen=!0),Te.panelView.focus(),te())})},openOnButtonClick(Te){Te.buttonView.on("execute",()=>{Te.isOpen=!0,Te.panelView.focus()})},toggleOnButtonClick(Te){Te.buttonView.on("execute",()=>{Te.isOpen=!Te.isOpen,Te.isOpen&&Te.panelView.focus()})},closeOnArrowLeftKey(Te){const we=Te.locale.uiLanguageDirection==="rtl"?"arrowright":"arrowleft";Te.keystrokes.set(we,(t,te)=>{Te.isOpen&&(Te.isOpen=!1,Te.focus(),te())})},closeOnEscKey(Te){Te.keystrokes.set("esc",(we,t)=>{Te.isOpen&&(Te.isOpen=!1,Te.focus(),t())})},closeOnParentClose(Te){Te.parentMenuView.on("change:isOpen",(we,t,te)=>{!te&&we.source===Te.parentMenuView&&(Te.isOpen=!1)})}},MenuBarMenuViewPanelPositioningFunctions={southEast:Te=>({top:Te.bottom,left:Te.left,name:"se"}),southWest:(Te,we)=>({top:Te.bottom,left:Te.left-we.width+Te.width,name:"sw"}),northEast:(Te,we)=>({top:Te.top-we.height,left:Te.left,name:"ne"}),northWest:(Te,we)=>({top:Te.top-we.height,left:Te.left-we.width+Te.width,name:"nw"}),eastSouth:Te=>({top:Te.top,left:Te.right-NESTED_PANEL_HORIZONTAL_OFFSET,name:"es"}),eastNorth:(Te,we)=>({top:Te.top-we.height,left:Te.right-NESTED_PANEL_HORIZONTAL_OFFSET,name:"en"}),westSouth:(Te,we)=>({top:Te.top,left:Te.left-we.width+NESTED_PANEL_HORIZONTAL_OFFSET,name:"ws"}),westNorth:(Te,we)=>({top:Te.top-we.height,left:Te.left-we.width+NESTED_PANEL_HORIZONTAL_OFFSET,name:"wn"})},DefaultMenuBarItems=[{menuId:"file",label:"File",groups:[{groupId:"export",items:["menuBar:exportPdf","menuBar:exportWord"]},{groupId:"import",items:["menuBar:importWord"]},{groupId:"revisionHistory",items:["menuBar:revisionHistory"]}]},{menuId:"edit",label:"Edit",groups:[{groupId:"undo",items:["menuBar:undo","menuBar:redo"]},{groupId:"selectAll",items:["menuBar:selectAll"]},{groupId:"findAndReplace",items:["menuBar:findAndReplace"]}]},{menuId:"view",label:"View",groups:[{groupId:"sourceEditing",items:["menuBar:sourceEditing"]},{groupId:"showBlocks",items:["menuBar:showBlocks"]},{groupId:"restrictedEditingException",items:["menuBar:restrictedEditingException"]}]},{menuId:"insert",label:"Insert",groups:[{groupId:"insertMainWidgets",items:["menuBar:insertImage","menuBar:ckbox","menuBar:ckfinder","menuBar:insertTable"]},{groupId:"insertInline",items:["menuBar:link","menuBar:comment"]},{groupId:"insertMinorWidgets",items:["menuBar:mediaEmbed","menuBar:insertTemplate","menuBar:blockQuote","menuBar:codeBlock","menuBar:htmlEmbed"]},{groupId:"insertStructureWidgets",items:["menuBar:horizontalLine","menuBar:pageBreak","menuBar:tableOfContents"]},{groupId:"restrictedEditing",items:["menuBar:restrictedEditing"]}]},{menuId:"format",label:"Format",groups:[{groupId:"textAndFont",items:[{menuId:"text",label:"Text",groups:[{groupId:"basicStyles",items:["menuBar:bold","menuBar:italic","menuBar:underline","menuBar:strikethrough","menuBar:superscript","menuBar:subscript","menuBar:code"]},{groupId:"textPartLanguage",items:["menuBar:textPartLanguage"]}]},{menuId:"font",label:"Font",groups:[{groupId:"fontProperties",items:["menuBar:fontSize","menuBar:fontFamily"]},{groupId:"fontColors",items:["menuBar:fontColor","menuBar:fontBackgroundColor"]},{groupId:"highlight",items:["menuBar:highlight"]}]},"menuBar:heading"]},{groupId:"list",items:["menuBar:bulletedList","menuBar:numberedList","menuBar:multiLevelList","menuBar:todoList"]},{groupId:"indent",items:["menuBar:alignment","menuBar:indent","menuBar:outdent"]},{groupId:"caseChange",items:["menuBar:caseChange"]},{groupId:"removeFormat",items:["menuBar:removeFormat"]}]},{menuId:"tools",label:"Tools",groups:[{groupId:"aiTools",items:["menuBar:aiAssistant","menuBar:aiCommands"]},{groupId:"tools",items:["menuBar:trackChanges","menuBar:commentsArchive"]}]},{menuId:"help",label:"Help",groups:[{groupId:"help",items:["menuBar:accessibilityHelp"]}]}];function normalizeMenuBarConfig(Te){let we;return!("items"in Te)||!Te.items?we={items:cloneDeep(DefaultMenuBarItems),addItems:[],removeItems:[],isVisible:!0,isUsingDefaultConfig:!0,...Te}:we={items:Te.items,removeItems:[],addItems:[],isVisible:!0,isUsingDefaultConfig:!1,...Te},we}function processMenuBarConfig({normalizedConfig:Te,locale:we,componentFactory:t}){const te=cloneDeep(Te);return handleRemovals(Te,te),handleAdditions(Te,te),purgeUnavailableComponents(Te,te,t),purgeEmptyMenus(Te,te),localizeMenuLabels(te,we),te}function handleRemovals(Te,we){const t=we.removeItems,te=[];we.items=we.items.filter(({menuId:be})=>t.includes(be)?(te.push(be),!1):!0),walkConfigMenus(we.items,be=>{be.groups=be.groups.filter(({groupId:xe})=>t.includes(xe)?(te.push(xe),!1):!0);for(const xe of be.groups)xe.items=xe.items.filter(ve=>{const ke=getIdFromGroupItem(ve);return t.includes(ke)?(te.push(ke),!1):!0})});for(const be of t)te.includes(be)||logWarning("menu-bar-item-could-not-be-removed",{menuBarConfig:Te,itemName:be})}function handleAdditions(Te,we){const t=we.addItems,te=[];for(const be of t){const xe=getRelationFromPosition(be.position),ve=getRelativeIdFromPosition(be.position);if(isMenuBarMenuAddition(be))if(!ve)xe==="start"?(we.items.unshift(be.menu),te.push(be)):xe==="end"&&(we.items.push(be.menu),te.push(be));else{const ke=we.items.findIndex(Ie=>Ie.menuId===ve);ke!=-1?xe==="before"?(we.items.splice(ke,0,be.menu),te.push(be)):xe==="after"&&(we.items.splice(ke+1,0,be.menu),te.push(be)):addMenuOrItemToGroup(we,be.menu,ve,xe)&&te.push(be)}else isMenuBarMenuGroupAddition(be)?walkConfigMenus(we.items,ke=>{if(ke.menuId===ve)xe==="start"?(ke.groups.unshift(be.group),te.push(be)):xe==="end"&&(ke.groups.push(be.group),te.push(be));else{const Ie=ke.groups.findIndex(Ae=>Ae.groupId===ve);Ie!==-1&&(xe==="before"?(ke.groups.splice(Ie,0,be.group),te.push(be)):xe==="after"&&(ke.groups.splice(Ie+1,0,be.group),te.push(be)))}}):addMenuOrItemToGroup(we,be.item,ve,xe)&&te.push(be)}for(const be of t)te.includes(be)||logWarning("menu-bar-item-could-not-be-added",{menuBarConfig:Te,addedItemConfig:be})}function addMenuOrItemToGroup(Te,we,t,te){let be=!1;return walkConfigMenus(Te.items,xe=>{for(const{groupId:ve,items:ke}of xe.groups){if(be)return;if(ve===t)te==="start"?(ke.unshift(we),be=!0):te==="end"&&(ke.push(we),be=!0);else{const Ie=ke.findIndex(Ae=>getIdFromGroupItem(Ae)===t);Ie!==-1&&(te==="before"?(ke.splice(Ie,0,we),be=!0):te==="after"&&(ke.splice(Ie+1,0,we),be=!0))}}}),be}function purgeUnavailableComponents(Te,we,t){walkConfigMenus(we.items,te=>{for(const be of te.groups)be.items=be.items.filter(xe=>{const ve=typeof xe=="string"&&!t.has(xe);return ve&&!we.isUsingDefaultConfig&&logWarning("menu-bar-item-unavailable",{menuBarConfig:Te,parentMenuConfig:cloneDeep(te),componentName:xe}),!ve})})}function purgeEmptyMenus(Te,we){const t=we.isUsingDefaultConfig;let te=!1;if(we.items=we.items.filter(be=>be.groups.length?!0:(warnAboutEmptyMenu(Te,be,t),!1)),!we.items.length){warnAboutEmptyMenu(Te,Te,t);return}walkConfigMenus(we.items,be=>{be.groups=be.groups.filter(xe=>xe.items.length?!0:(te=!0,!1));for(const xe of be.groups)xe.items=xe.items.filter(ve=>isMenuDefinition(ve)&&!ve.groups.length?(warnAboutEmptyMenu(Te,ve,t),te=!0,!1):!0)}),te&&purgeEmptyMenus(Te,we)}function warnAboutEmptyMenu(Te,we,t){t||logWarning("menu-bar-menu-empty",{menuBarConfig:Te,emptyMenuConfig:we})}function localizeMenuLabels(Te,we){const t=we.t,te={File:t({string:"File",id:"MENU_BAR_MENU_FILE"}),Edit:t({string:"Edit",id:"MENU_BAR_MENU_EDIT"}),View:t({string:"View",id:"MENU_BAR_MENU_VIEW"}),Insert:t({string:"Insert",id:"MENU_BAR_MENU_INSERT"}),Format:t({string:"Format",id:"MENU_BAR_MENU_FORMAT"}),Tools:t({string:"Tools",id:"MENU_BAR_MENU_TOOLS"}),Help:t({string:"Help",id:"MENU_BAR_MENU_HELP"}),Text:t({string:"Text",id:"MENU_BAR_MENU_TEXT"}),Font:t({string:"Font",id:"MENU_BAR_MENU_FONT"})};walkConfigMenus(Te.items,be=>{be.label in te&&(be.label=te[be.label])})}function walkConfigMenus(Te,we){if(Array.isArray(Te))for(const te of Te)t(te);function t(te){we(te);for(const be of te.groups)for(const xe of be.items)isMenuDefinition(xe)&&t(xe)}}function isMenuBarMenuAddition(Te){return typeof Te=="object"&&"menu"in Te}function isMenuBarMenuGroupAddition(Te){return typeof Te=="object"&&"group"in Te}function getRelationFromPosition(Te){return Te.startsWith("start")?"start":Te.startsWith("end")?"end":Te.startsWith("after")?"after":"before"}function getRelativeIdFromPosition(Te){const we=Te.match(/^[^:]+:(.+)/);return we?we[1]:null}function getIdFromGroupItem(Te){return typeof Te=="string"?Te:Te.menuId}function isMenuDefinition(Te){return typeof Te=="object"&&"menuId"in Te}function _initMenuBar(Te,we){const t=we.element;Te.ui.focusTracker.add(t),Te.keystrokes.listenTo(t);const te=normalizeMenuBarConfig(Te.config.get("menuBar")||{});we.fillFromConfig(te,Te.ui.componentFactory),Te.keystrokes.set("Esc",(be,xe)=>{t.contains(Te.ui.focusTracker.focusedElement)&&(Te.editing.view.focus(),xe())}),Te.keystrokes.set("Alt+F9",(be,xe)=>{t.contains(Te.ui.focusTracker.focusedElement)||(we.focus(),xe())})}class MenuBarMenuPanelView extends View{constructor(t){super(t);Re(this,"children");const te=this.bindTemplate;this.set("isVisible",!1),this.set("position","se"),this.children=this.createCollection(),this.setTemplate({tag:"div",attributes:{class:["ck","ck-reset","ck-menu-bar__menu__panel",te.to("position",be=>`ck-menu-bar__menu__panel_position_${be}`),te.if("isVisible","ck-hidden",be=>!be)],tabindex:"-1"},children:this.children,on:{selectstart:te.to(be=>{be.target.tagName.toLocaleLowerCase()!=="input"&&be.preventDefault()})}})}focus(t=1){this.children.length&&(t===1?this.children.first.focus():this.children.last.focus())}}const a0=class a0 extends View{constructor(t){super(t);Re(this,"buttonView");Re(this,"panelView");Re(this,"focusTracker");Re(this,"keystrokes");const te=this.bindTemplate;this.buttonView=new MenuBarMenuButtonView(t),this.buttonView.delegate("mouseenter").to(this),this.buttonView.bind("isOn","isEnabled").to(this,"isOpen","isEnabled"),this.panelView=new MenuBarMenuPanelView(t),this.panelView.bind("isVisible").to(this,"isOpen"),this.keystrokes=new KeystrokeHandler,this.focusTracker=new FocusTracker,this.set("isOpen",!1),this.set("isEnabled",!0),this.set("panelPosition","w"),this.set("class",void 0),this.set("parentMenuView",null),this.setTemplate({tag:"div",attributes:{class:["ck","ck-menu-bar__menu",te.to("class"),te.if("isEnabled","ck-disabled",be=>!be),te.if("parentMenuView","ck-menu-bar__menu_top-level",be=>!be)]},children:[this.buttonView,this.panelView]})}render(){super.render(),this.focusTracker.add(this.buttonView.element),this.focusTracker.add(this.panelView.element),this.keystrokes.listenTo(this.element),MenuBarMenuBehaviors.closeOnEscKey(this),this._repositionPanelOnOpen()}_attachBehaviors(){this.parentMenuView?(MenuBarMenuBehaviors.openOnButtonClick(this),MenuBarMenuBehaviors.openOnArrowRightKey(this),MenuBarMenuBehaviors.closeOnArrowLeftKey(this),MenuBarMenuBehaviors.closeOnParentClose(this)):(this._propagateArrowKeystrokeEvents(),MenuBarMenuBehaviors.openAndFocusPanelOnArrowDownKey(this),MenuBarMenuBehaviors.toggleOnButtonClick(this))}_propagateArrowKeystrokeEvents(){this.keystrokes.set("arrowright",(t,te)=>{this.fire("arrowright"),te()}),this.keystrokes.set("arrowleft",(t,te)=>{this.fire("arrowleft"),te()})}_repositionPanelOnOpen(){this.on("change:isOpen",(t,te,be)=>{if(!be)return;const xe=a0._getOptimalPosition({element:this.panelView.element,target:this.buttonView.element,fitInViewport:!0,positions:this._panelPositions});this.panelView.position=xe?xe.name:this._panelPositions[0].name})}focus(){this.buttonView.focus()}get _panelPositions(){const{southEast:t,southWest:te,northEast:be,northWest:xe,westSouth:ve,eastSouth:ke,westNorth:Ie,eastNorth:Ae}=MenuBarMenuViewPanelPositioningFunctions;return this.locale.uiLanguageDirection==="ltr"?this.parentMenuView?[ke,Ae,ve,Ie]:[t,te,be,xe]:this.parentMenuView?[ve,Ie,ke,Ae]:[te,t,xe,be]}};Re(a0,"_getOptimalPosition",getOptimalPosition);let MenuBarMenuView=a0;class MenuBarMenuListView extends ListView{constructor(we){super(we),this.role="menu"}}class MenuBarMenuListItemFileDialogButtonView extends FileDialogButtonView{constructor(we){super(we),this.set({withText:!0,withKeystroke:!0,tooltip:!1,role:"menuitem"}),this.extendTemplate({attributes:{class:["ck-menu-bar__menu__item__button"]}})}}const EVENT_NAME_DELEGATES=["mouseenter","arrowleft","arrowright","change:isOpen"];class MenuBarView extends View{constructor(t){super(t);Re(this,"children");Re(this,"menus",[]);const te=t.t;this.set("isOpen",!1),this._setupIsOpenUpdater(),this.children=this.createCollection(),this.setTemplate({tag:"div",attributes:{class:["ck","ck-menu-bar"],"aria-label":te("Editor menu bar"),role:"menubar"},children:this.children})}fillFromConfig(t,te){const be=this.locale,ve=processMenuBarConfig({normalizedConfig:t,locale:be,componentFactory:te}).items.map(ke=>this._createMenu({componentFactory:te,menuDefinition:ke}));this.children.addMany(ve)}render(){super.render(),MenuBarBehaviors.toggleMenusAndFocusItemsOnHover(this),MenuBarBehaviors.closeMenusWhenTheBarCloses(this),MenuBarBehaviors.closeMenuWhenAnotherOnTheSameLevelOpens(this),MenuBarBehaviors.focusCycleMenusOnArrows(this),MenuBarBehaviors.closeOnClickOutside(this)}focus(){this.children.first&&this.children.first.focus()}close(){for(const t of this.children)t.isOpen=!1}registerMenu(t,te=null){te?(t.delegate(...EVENT_NAME_DELEGATES).to(te),t.parentMenuView=te):t.delegate(...EVENT_NAME_DELEGATES).to(this,be=>"menu:"+be),t._attachBehaviors(),this.menus.push(t)}_createMenu({componentFactory:t,menuDefinition:te,parentMenuView:be}){const xe=this.locale,ve=new MenuBarMenuView(xe);return this.registerMenu(ve,be),ve.buttonView.set({label:te.label}),ve.once("change:isOpen",()=>{const ke=new MenuBarMenuListView(xe);ke.ariaLabel=te.label,ve.panelView.children.add(ke),ke.items.addMany(this._createMenuItems({menuDefinition:te,parentMenuView:ve,componentFactory:t}))}),ve}_createMenuItems({menuDefinition:t,parentMenuView:te,componentFactory:be}){const xe=this.locale,ve=[];for(const ke of t.groups){for(const Ie of ke.items){const Ae=new MenuBarMenuListItemView(xe,te);if(isObject$2(Ie))Ae.children.add(this._createMenu({componentFactory:be,menuDefinition:Ie,parentMenuView:te}));else{const Se=this._createMenuItemContentFromFactory({componentName:Ie,componentFactory:be,parentMenuView:te});if(!Se)continue;Ae.children.add(Se)}ve.push(Ae)}ke!==t.groups[t.groups.length-1]&&ve.push(new ListSeparatorView(xe))}return ve}_createMenuItemContentFromFactory({componentName:t,parentMenuView:te,componentFactory:be}){const xe=be.create(t);return xe instanceof MenuBarMenuView||xe instanceof MenuBarMenuListItemButtonView||xe instanceof MenuBarMenuListItemFileDialogButtonView?(this._registerMenuTree(xe,te),xe.on("execute",()=>{this.close()}),xe):(logWarning("menu-bar-component-unsupported",{componentName:t,componentView:xe}),null)}_registerMenuTree(t,te){if(!(t instanceof MenuBarMenuView)){t.delegate("mouseenter").to(te);return}this.registerMenu(t,te);const be=t.panelView.children.filter(ve=>ve instanceof MenuBarMenuListView)[0];if(!be){t.delegate("mouseenter").to(te);return}const xe=be.items.filter(ve=>ve instanceof ListItemView);for(const ve of xe)this._registerMenuTree(ve.children.get(0),t)}_setupIsOpenUpdater(){let t;this.on("menu:change:isOpen",(te,be,xe)=>{clearTimeout(t),xe?this.isOpen=!0:t=setTimeout(()=>{this.isOpen=Array.from(this.children).some(ve=>ve.isOpen)},0)})}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const supportedOptions=["left","right","center","justify"];function isSupported(Te){return supportedOptions.includes(Te)}function isDefault(Te,we){return we.contentLanguageDirection=="rtl"?Te==="right":Te==="left"}function normalizeAlignmentOptions(Te){const we=Te.map(te=>{let be;return typeof te=="string"?be={name:te}:be=te,be}).filter(te=>{const be=supportedOptions.includes(te.name);return be||logWarning("alignment-config-name-not-recognized",{option:te}),be}),t=we.filter(te=>!!te.className).length;if(t&&t<we.length)throw new CKEditorError("alignment-config-classnames-are-missing",{configuredOptions:Te});return we.forEach((te,be,xe)=>{const ve=xe.slice(be+1);if(ve.some(Ie=>Ie.name==te.name))throw new CKEditorError("alignment-config-name-already-defined",{option:te,configuredOptions:Te});if(te.className&&ve.some(Ae=>Ae.className==te.className))throw new CKEditorError("alignment-config-classname-already-defined",{option:te,configuredOptions:Te})}),we}const ALIGNMENT="alignment";class AlignmentCommand extends Command{refresh(){const t=this.editor.locale,te=first(this.editor.model.document.selection.getSelectedBlocks());this.isEnabled=!!te&&this._canBeAligned(te),this.isEnabled&&te.hasAttribute("alignment")?this.value=te.getAttribute("alignment"):this.value=t.contentLanguageDirection==="rtl"?"right":"left"}execute(we={}){const t=this.editor,te=t.locale,be=t.model,xe=be.document,ve=we.value;be.change(ke=>{const Ie=Array.from(xe.selection.getSelectedBlocks()).filter(Oe=>this._canBeAligned(Oe)),Ae=Ie[0].getAttribute("alignment");isDefault(ve,te)||Ae===ve||!ve?removeAlignmentFromSelection(Ie,ke):setAlignmentOnSelection(Ie,ke,ve)})}_canBeAligned(we){return this.editor.model.schema.checkAttribute(we,ALIGNMENT)}}function removeAlignmentFromSelection(Te,we){for(const t of Te)we.removeAttribute(ALIGNMENT,t)}function setAlignmentOnSelection(Te,we,t){for(const te of Te)we.setAttribute(ALIGNMENT,t,te)}class AlignmentEditing extends Plugin{static get pluginName(){return"AlignmentEditing"}constructor(we){super(we),we.config.define("alignment",{options:supportedOptions.map(t=>({name:t}))})}init(){const we=this.editor,t=we.locale,te=we.model.schema,xe=normalizeAlignmentOptions(we.config.get("alignment.options")).filter(Ae=>isSupported(Ae.name)&&!isDefault(Ae.name,t)),ve=xe.some(Ae=>!!Ae.className);te.extend("$block",{allowAttributes:"alignment"}),we.model.schema.setAttributeProperties("alignment",{isFormatting:!0}),ve?we.conversion.attributeToAttribute(buildClassDefinition(xe)):we.conversion.for("downcast").attributeToAttribute(buildDowncastInlineDefinition(xe));const ke=buildUpcastInlineDefinitions(xe);for(const Ae of ke)we.conversion.for("upcast").attributeToAttribute(Ae);const Ie=buildUpcastCompatibilityDefinitions(xe);for(const Ae of Ie)we.conversion.for("upcast").attributeToAttribute(Ae);we.commands.add("alignment",new AlignmentCommand(we))}}function buildDowncastInlineDefinition(Te){const we={};for(const{name:te}of Te)we[te]={key:"style",value:{"text-align":te}};return{model:{key:"alignment",values:Te.map(te=>te.name)},view:we}}function buildUpcastInlineDefinitions(Te){const we=[];for(const{name:t}of Te)we.push({view:{key:"style",value:{"text-align":t}},model:{key:"alignment",value:t}});return we}function buildUpcastCompatibilityDefinitions(Te){const we=[];for(const{name:t}of Te)we.push({view:{key:"align",value:t},model:{key:"alignment",value:t}});return we}function buildClassDefinition(Te){const we={};for(const te of Te)we[te.name]={key:"class",value:te.className};return{model:{key:"alignment",values:Te.map(te=>te.name)},view:we}}const iconsMap=new Map([["left",icons.alignLeft],["right",icons.alignRight],["center",icons.alignCenter],["justify",icons.alignJustify]]);class AlignmentUI extends Plugin{get localizedOptionTitles(){const we=this.editor.t;return{left:we("Align left"),right:we("Align right"),center:we("Align center"),justify:we("Justify")}}static get pluginName(){return"AlignmentUI"}init(){const we=this.editor,t=normalizeAlignmentOptions(we.config.get("alignment.options"));t.map(te=>te.name).filter(isSupported).forEach(te=>this._addButton(te)),this._addToolbarDropdown(t),this._addMenuBarMenu(t)}_addButton(we){this.editor.ui.componentFactory.add(`alignment:${we}`,te=>this._createButton(te,we))}_createButton(we,t,te={}){const be=this.editor,xe=be.commands.get("alignment"),ve=new ButtonView(we);return ve.set({label:this.localizedOptionTitles[t],icon:iconsMap.get(t),tooltip:!0,isToggleable:!0,...te}),ve.bind("isEnabled").to(xe),ve.bind("isOn").to(xe,"value",ke=>ke===t),this.listenTo(ve,"execute",()=>{be.execute("alignment",{value:t}),be.editing.view.focus()}),ve}_addToolbarDropdown(we){const t=this.editor;t.ui.componentFactory.add("alignment",be=>{const xe=createDropdown(be),ve=be.uiLanguageDirection==="rtl"?"w":"e",ke=be.t;addToolbarToDropdown(xe,()=>we.map(Se=>this._createButton(be,Se.name,{tooltipPosition:ve})),{enableActiveItemFocusOnDropdownOpen:!0,isVertical:!0,ariaLabel:ke("Text alignment toolbar")}),xe.buttonView.set({label:ke("Text alignment"),tooltip:!0}),xe.extendTemplate({attributes:{class:"ck-alignment-dropdown"}});const Ie=be.contentLanguageDirection==="rtl"?iconsMap.get("right"):iconsMap.get("left"),Ae=t.commands.get("alignment");return xe.buttonView.bind("icon").to(Ae,"value",Se=>iconsMap.get(Se)||Ie),xe.bind("isEnabled").to(Ae,"isEnabled"),this.listenTo(xe,"execute",()=>{t.editing.view.focus()}),xe})}_addMenuBarMenu(we){const t=this.editor;t.ui.componentFactory.add("menuBar:alignment",te=>{const be=t.commands.get("alignment"),xe=te.t,ve=new MenuBarMenuView(te),ke=new MenuBarMenuListView(te);ve.bind("isEnabled").to(be),ke.set({ariaLabel:xe("Text alignment"),role:"menu"}),ve.buttonView.set({label:xe("Text alignment")});for(const Ie of we){const Ae=new MenuBarMenuListItemView(te,ve),Se=new MenuBarMenuListItemButtonView(te);Se.extendTemplate({attributes:{"aria-checked":Se.bindTemplate.to("isOn")}}),Se.delegate("execute").to(ve),Se.set({label:this.localizedOptionTitles[Ie.name],icon:iconsMap.get(Ie.name)}),Se.on("execute",()=>{t.execute("alignment",{value:Ie.name}),t.editing.view.focus()}),Se.bind("isOn").to(be,"value",Oe=>Oe===Ie.name),Se.bind("isEnabled").to(be,"isEnabled"),Ae.children.add(Se),ke.items.add(Ae)}return ve.panelView.children.add(ke),ve})}}class Alignment extends Plugin{static get requires(){return[AlignmentEditing,AlignmentUI]}static get pluginName(){return"Alignment"}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 *//**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class ChangeBuffer{constructor(we,t=20){Re(this,"model");Re(this,"limit");Re(this,"_isLocked");Re(this,"_size");Re(this,"_batch",null);Re(this,"_changeCallback");Re(this,"_selectionChangeCallback");this.model=we,this._size=0,this.limit=t,this._isLocked=!1,this._changeCallback=(te,be)=>{be.isLocal&&be.isUndoable&&be!==this._batch&&this._reset(!0)},this._selectionChangeCallback=()=>{this._reset()},this.model.document.on("change",this._changeCallback),this.model.document.selection.on("change:range",this._selectionChangeCallback),this.model.document.selection.on("change:attribute",this._selectionChangeCallback)}get batch(){return this._batch||(this._batch=this.model.createBatch({isTyping:!0})),this._batch}get size(){return this._size}input(we){this._size+=we,this._size>=this.limit&&this._reset(!0)}get isLocked(){return this._isLocked}lock(){this._isLocked=!0}unlock(){this._isLocked=!1}destroy(){this.model.document.off("change",this._changeCallback),this.model.document.selection.off("change:range",this._selectionChangeCallback),this.model.document.selection.off("change:attribute",this._selectionChangeCallback)}_reset(we=!1){(!this.isLocked||we)&&(this._batch=null,this._size=0)}}class InsertTextCommand extends Command{constructor(t,te){super(t);Re(this,"_buffer");this._buffer=new ChangeBuffer(t.model,te),this._isEnabledBasedOnSelection=!1}get buffer(){return this._buffer}destroy(){super.destroy(),this._buffer.destroy()}execute(t={}){const te=this.editor.model,be=te.document,xe=t.text||"",ve=xe.length;let ke=be.selection;if(t.selection?ke=t.selection:t.range&&(ke=te.createSelection(t.range)),!te.canEditAt(ke))return;const Ie=t.resultRange;te.enqueueChange(this._buffer.batch,Ae=>{this._buffer.lock();const Se=Array.from(be.selection.getAttributes());te.deleteContent(ke),xe&&te.insertContent(Ae.createText(xe,Se),ke),Ie?Ae.setSelection(Ie):ke.is("documentSelection")||Ae.setSelection(ke),this._buffer.unlock(),this._buffer.input(ve)})}}const TYPING_INPUT_TYPES=["insertText","insertReplacementText"];class InsertTextObserver extends Observer{constructor(t){super(t);Re(this,"focusObserver");this.focusObserver=t.getObserver(FocusObserver),env.isAndroid&&TYPING_INPUT_TYPES.push("insertCompositionText");const te=t.document;te.on("beforeinput",(be,xe)=>{if(!this.isEnabled)return;const{data:ve,targetRanges:ke,inputType:Ie,domEvent:Ae}=xe;if(!TYPING_INPUT_TYPES.includes(Ie))return;this.focusObserver.flush();const Se=new EventInfo(te,"insertText");te.fire(Se,new DomEventData(t,Ae,{text:ve,selection:t.createSelection(ke)})),Se.stop.called&&be.stop()}),te.on("compositionend",(be,{data:xe,domEvent:ve})=>{!this.isEnabled||env.isAndroid||xe&&te.fire("insertText",new DomEventData(t,ve,{text:xe,selection:te.selection}))},{priority:"lowest"})}observe(){}stopObserving(){}}class Input extends Plugin{static get pluginName(){return"Input"}init(){const we=this.editor,t=we.model,te=we.editing.view,be=t.document.selection;te.addObserver(InsertTextObserver);const xe=new InsertTextCommand(we,we.config.get("typing.undoStep")||20);we.commands.add("insertText",xe),we.commands.add("input",xe),this.listenTo(te.document,"insertText",(ve,ke)=>{te.document.isComposing||ke.preventDefault();const{text:Ie,selection:Ae,resultRange:Se}=ke,Oe=Array.from(Ae.getRanges()).map(De=>we.editing.mapper.toModelRange(De));let Ve=Ie;if(env.isAndroid){const De=Array.from(Oe[0].getItems()).reduce((Fe,Be)=>Fe+(Be.is("$textProxy")?Be.data:""),"");De&&(De.length<=Ve.length?Ve.startsWith(De)&&(Ve=Ve.substring(De.length),Oe[0].start=Oe[0].start.getShiftedBy(De.length)):De.startsWith(Ve)&&(Oe[0].start=Oe[0].start.getShiftedBy(Ve.length),Ve=""))}const Me={text:Ve,selection:t.createSelection(Oe)};Se&&(Me.resultRange=we.editing.mapper.toModelRange(Se)),we.execute("insertText",Me),te.scrollToTheSelection()}),env.isAndroid?this.listenTo(te.document,"keydown",(ve,ke)=>{be.isCollapsed||ke.keyCode!=229||!te.document.isComposing||deleteSelectionContent(t,xe)}):this.listenTo(te.document,"compositionstart",()=>{be.isCollapsed||deleteSelectionContent(t,xe)})}}function deleteSelectionContent(Te,we){if(!we.isEnabled)return;const t=we.buffer;t.lock(),Te.enqueueChange(t.batch,()=>{Te.deleteContent(Te.document.selection)}),t.unlock()}class DeleteCommand extends Command{constructor(t,te){super(t);Re(this,"direction");Re(this,"_buffer");this.direction=te,this._buffer=new ChangeBuffer(t.model,t.config.get("typing.undoStep")),this._isEnabledBasedOnSelection=!1}get buffer(){return this._buffer}execute(t={}){const te=this.editor.model,be=te.document;te.enqueueChange(this._buffer.batch,xe=>{this._buffer.lock();const ve=xe.createSelection(t.selection||be.selection);if(!te.canEditAt(ve))return;const ke=t.sequence||1,Ie=ve.isCollapsed;if(ve.isCollapsed&&te.modifySelection(ve,{direction:this.direction,unit:t.unit,treatEmojiAsSingleUnit:!0}),this._shouldEntireContentBeReplacedWithParagraph(ke)){this._replaceEntireContentWithParagraph(xe);return}if(this._shouldReplaceFirstBlockWithParagraph(ve,ke)){this.editor.execute("paragraph",{selection:ve});return}if(ve.isCollapsed)return;let Ae=0;ve.getFirstRange().getMinimalFlatRanges().forEach(Se=>{Ae+=count(Se.getWalker({singleCharacters:!0,ignoreElementEnd:!0,shallow:!0}))}),te.deleteContent(ve,{doNotResetEntireContent:Ie,direction:this.direction}),this._buffer.input(Ae),xe.setSelection(ve),this._buffer.unlock()})}_shouldEntireContentBeReplacedWithParagraph(t){if(t>1)return!1;const te=this.editor.model,xe=te.document.selection,ve=te.schema.getLimitElement(xe);if(!(xe.isCollapsed&&xe.containsEntireContent(ve))||!te.schema.checkChild(ve,"paragraph"))return!1;const Ie=ve.getChild(0);return!(Ie&&Ie.is("element","paragraph"))}_replaceEntireContentWithParagraph(t){const te=this.editor.model,xe=te.document.selection,ve=te.schema.getLimitElement(xe),ke=t.createElement("paragraph");t.remove(t.createRangeIn(ve)),t.insert(ke,ve),t.setSelection(ke,0)}_shouldReplaceFirstBlockWithParagraph(t,te){const be=this.editor.model;if(te>1||this.direction!="backward"||!t.isCollapsed)return!1;const xe=t.getFirstPosition(),ve=be.schema.getLimitElement(xe),ke=ve.getChild(0);return!(xe.parent!=ke||!t.containsEntireContent(ke)||!be.schema.checkChild(ve,"paragraph")||ke.name=="paragraph")}}const DELETE_CHARACTER="character",DELETE_WORD="word",DELETE_CODE_POINT="codePoint",DELETE_SELECTION="selection",DELETE_BACKWARD="backward",DELETE_FORWARD="forward",DELETE_EVENT_TYPES={deleteContent:{unit:DELETE_SELECTION,direction:DELETE_BACKWARD},deleteContentBackward:{unit:DELETE_CODE_POINT,direction:DELETE_BACKWARD},deleteWordBackward:{unit:DELETE_WORD,direction:DELETE_BACKWARD},deleteHardLineBackward:{unit:DELETE_SELECTION,direction:DELETE_BACKWARD},deleteSoftLineBackward:{unit:DELETE_SELECTION,direction:DELETE_BACKWARD},deleteContentForward:{unit:DELETE_CHARACTER,direction:DELETE_FORWARD},deleteWordForward:{unit:DELETE_WORD,direction:DELETE_FORWARD},deleteHardLineForward:{unit:DELETE_SELECTION,direction:DELETE_FORWARD},deleteSoftLineForward:{unit:DELETE_SELECTION,direction:DELETE_FORWARD}};class DeleteObserver extends Observer{constructor(we){super(we);const t=we.document;let te=0;t.on("keydown",()=>{te++}),t.on("keyup",()=>{te=0}),t.on("beforeinput",(be,xe)=>{if(!this.isEnabled)return;const{targetRanges:ve,domEvent:ke,inputType:Ie}=xe,Ae=DELETE_EVENT_TYPES[Ie];if(!Ae)return;const Se={direction:Ae.direction,unit:Ae.unit,sequence:te};Se.unit==DELETE_SELECTION&&(Se.selectionToRemove=we.createSelection(ve[0])),Ie==="deleteContentBackward"&&(env.isAndroid&&(Se.sequence=1),shouldUseTargetRanges(ve)&&(Se.unit=DELETE_SELECTION,Se.selectionToRemove=we.createSelection(ve)));const Oe=new BubblingEventInfo(t,"delete",ve[0]);t.fire(Oe,new DomEventData(we,ke,Se)),Oe.stop.called&&be.stop()}),env.isBlink&&enableChromeWorkaround(this)}observe(){}stopObserving(){}}function enableChromeWorkaround(Te){const we=Te.view,t=we.document;let te=null,be=!1;t.on("keydown",(ke,{keyCode:Ie})=>{te=Ie,be=!1}),t.on("keyup",(ke,{keyCode:Ie,domEvent:Ae})=>{const Se=t.selection,Oe=Te.isEnabled&&Ie==te&&xe(Ie)&&!Se.isCollapsed&&!be;if(te=null,Oe){const Ve=Se.getFirstRange(),Me=new BubblingEventInfo(t,"delete",Ve),De={unit:DELETE_SELECTION,direction:ve(Ie),selectionToRemove:Se};t.fire(Me,new DomEventData(we,Ae,De))}}),t.on("beforeinput",(ke,{inputType:Ie})=>{const Ae=DELETE_EVENT_TYPES[Ie];xe(te)&&Ae&&Ae.direction==ve(te)&&(be=!0)},{priority:"high"}),t.on("beforeinput",(ke,{inputType:Ie,data:Ae})=>{te==keyCodes.delete&&Ie=="insertText"&&Ae==""&&ke.stop()},{priority:"high"});function xe(ke){return ke==keyCodes.backspace||ke==keyCodes.delete}function ve(ke){return ke==keyCodes.backspace?DELETE_BACKWARD:DELETE_FORWARD}}function shouldUseTargetRanges(Te){if(Te.length!=1||Te[0].isCollapsed)return!1;const we=Te[0].getWalker({direction:"backward",singleCharacters:!0,ignoreElementEnd:!0});let t=0;for(const{nextPosition:te,item:be}of we){if(te.parent.is("$text")){const xe=te.parent.data,ve=te.offset;if(isInsideSurrogatePair(xe,ve)||isInsideCombinedSymbol(xe,ve)||isInsideEmojiSequence(xe,ve))continue;t++}else(be.is("containerElement")||be.is("emptyElement"))&&t++;if(t>1)return!0}return!1}class Delete extends Plugin{constructor(){super(...arguments);Re(this,"_undoOnBackspace")}static get pluginName(){return"Delete"}init(){const t=this.editor,te=t.editing.view,be=te.document,xe=t.model.document;te.addObserver(DeleteObserver),this._undoOnBackspace=!1;const ve=new DeleteCommand(t,"forward");t.commands.add("deleteForward",ve),t.commands.add("forwardDelete",ve),t.commands.add("delete",new DeleteCommand(t,"backward")),this.listenTo(be,"delete",(ke,Ie)=>{be.isComposing||Ie.preventDefault();const{direction:Ae,sequence:Se,selectionToRemove:Oe,unit:Ve}=Ie,Me=Ae==="forward"?"deleteForward":"delete",De={sequence:Se};if(Ve=="selection"){const Fe=Array.from(Oe.getRanges()).map(Be=>t.editing.mapper.toModelRange(Be));De.selection=t.model.createSelection(Fe)}else De.unit=Ve;t.execute(Me,De),te.scrollToTheSelection()},{priority:"low"}),this.editor.plugins.has("UndoEditing")&&(this.listenTo(be,"delete",(ke,Ie)=>{this._undoOnBackspace&&Ie.direction=="backward"&&Ie.sequence==1&&Ie.unit=="codePoint"&&(this._undoOnBackspace=!1,t.execute("undo"),Ie.preventDefault(),ke.stop())},{context:"$capture"}),this.listenTo(xe,"change",()=>{this._undoOnBackspace=!1}))}requestUndoOnBackspace(){this.editor.plugins.has("UndoEditing")&&(this._undoOnBackspace=!0)}}class Typing extends Plugin{static get requires(){return[Input,Delete]}static get pluginName(){return"Typing"}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function getLastTextLine(Te,we){let t=Te.start;return{text:Array.from(Te.getWalker({ignoreElementEnd:!1})).reduce((be,{item:xe})=>xe.is("$text")||xe.is("$textProxy")?be+xe.data:(t=we.createPositionAfter(xe),""),""),range:we.createRange(t,Te.end)}}class TextWatcher extends ObservableMixin(){constructor(t,te){super();Re(this,"model");Re(this,"testCallback");Re(this,"_hasMatch");this.model=t,this.testCallback=te,this._hasMatch=!1,this.set("isEnabled",!0),this.on("change:isEnabled",()=>{this.isEnabled?this._startListening():(this.stopListening(t.document.selection),this.stopListening(t.document))}),this._startListening()}get hasMatch(){return this._hasMatch}_startListening(){const te=this.model.document;this.listenTo(te.selection,"change:range",(be,{directChange:xe})=>{if(xe){if(!te.selection.isCollapsed){this.hasMatch&&(this.fire("unmatched"),this._hasMatch=!1);return}this._evaluateTextBeforeSelection("selection")}}),this.listenTo(te,"change:data",(be,xe)=>{xe.isUndo||!xe.isLocal||this._evaluateTextBeforeSelection("data",{batch:xe})})}_evaluateTextBeforeSelection(t,te={}){const be=this.model,ve=be.document.selection,ke=be.createRange(be.createPositionAt(ve.focus.parent,0),ve.focus),{text:Ie,range:Ae}=getLastTextLine(ke,be),Se=this.testCallback(Ie);if(!Se&&this.hasMatch&&this.fire("unmatched"),this._hasMatch=!!Se,Se){const Oe=Object.assign(te,{text:Ie,range:Ae});typeof Se=="object"&&Object.assign(Oe,Se),this.fire(`matched:${t}`,Oe)}}}class TwoStepCaretMovement extends Plugin{constructor(t){super(t);Re(this,"attributes");Re(this,"_overrideUid");Re(this,"_isNextGravityRestorationSkipped",!1);this.attributes=new Set,this._overrideUid=null}static get pluginName(){return"TwoStepCaretMovement"}init(){const t=this.editor,te=t.model,be=t.editing.view,xe=t.locale,ve=te.document.selection;this.listenTo(be.document,"arrowKey",(ke,Ie)=>{if(!ve.isCollapsed||Ie.shiftKey||Ie.altKey||Ie.ctrlKey)return;const Ae=Ie.keyCode==keyCodes.arrowright,Se=Ie.keyCode==keyCodes.arrowleft;if(!Ae&&!Se)return;const Oe=xe.contentLanguageDirection;let Ve=!1;Oe==="ltr"&&Ae||Oe==="rtl"&&Se?Ve=this._handleForwardMovement(Ie):Ve=this._handleBackwardMovement(Ie),Ve===!0&&ke.stop()},{context:"$text",priority:"highest"}),this.listenTo(ve,"change:range",(ke,Ie)=>{if(this._isNextGravityRestorationSkipped){this._isNextGravityRestorationSkipped=!1;return}this._isGravityOverridden&&(!Ie.directChange&&isBetweenDifferentAttributes(ve.getFirstPosition(),this.attributes)||this._restoreGravity())}),this._enableClickingAfterNode(),this._enableInsertContentSelectionAttributesFixer(),this._handleDeleteContentAfterNode()}registerAttribute(t){this.attributes.add(t)}_handleForwardMovement(t){const te=this.attributes,be=this.editor.model,xe=be.document.selection,ve=xe.getFirstPosition();return this._isGravityOverridden||ve.isAtStart&&hasAnyAttribute$1(xe,te)?!1:isBetweenDifferentAttributes(ve,te)?(preventCaretMovement(t),hasAnyAttribute$1(xe,te)&&isBetweenDifferentAttributes(ve,te,!0)?clearSelectionAttributes(be,te):this._overrideGravity(),!0):!1}_handleBackwardMovement(t){const te=this.attributes,be=this.editor.model,xe=be.document.selection,ve=xe.getFirstPosition();return this._isGravityOverridden?(preventCaretMovement(t),this._restoreGravity(),isBetweenDifferentAttributes(ve,te,!0)?clearSelectionAttributes(be,te):setSelectionAttributesFromTheNodeBefore(be,te,ve),!0):ve.isAtStart?hasAnyAttribute$1(xe,te)?(preventCaretMovement(t),setSelectionAttributesFromTheNodeBefore(be,te,ve),!0):!1:!hasAnyAttribute$1(xe,te)&&isBetweenDifferentAttributes(ve,te,!0)?(preventCaretMovement(t),setSelectionAttributesFromTheNodeBefore(be,te,ve),!0):isStepAfterAnyAttributeBoundary(ve,te)?ve.isAtEnd&&!hasAnyAttribute$1(xe,te)&&isBetweenDifferentAttributes(ve,te)?(preventCaretMovement(t),setSelectionAttributesFromTheNodeBefore(be,te,ve),!0):(this._isNextGravityRestorationSkipped=!0,this._overrideGravity(),!1):!1}_enableClickingAfterNode(){const t=this.editor,te=t.model,be=te.document.selection,xe=t.editing.view.document;t.editing.view.addObserver(MouseObserver);let ve=!1;this.listenTo(xe,"mousedown",()=>{ve=!0}),this.listenTo(xe,"selectionChange",()=>{const ke=this.attributes;if(!ve||(ve=!1,!be.isCollapsed)||!hasAnyAttribute$1(be,ke))return;const Ie=be.getFirstPosition();isBetweenDifferentAttributes(Ie,ke)&&(Ie.isAtStart||isBetweenDifferentAttributes(Ie,ke,!0)?clearSelectionAttributes(te,ke):this._isGravityOverridden||this._overrideGravity())})}_enableInsertContentSelectionAttributesFixer(){const te=this.editor.model,be=te.document.selection,xe=this.attributes;this.listenTo(te,"insertContent",()=>{const ve=be.getFirstPosition();hasAnyAttribute$1(be,xe)&&isBetweenDifferentAttributes(ve,xe)&&clearSelectionAttributes(te,xe)},{priority:"low"})}_handleDeleteContentAfterNode(){const t=this.editor,te=t.model,be=te.document.selection,xe=t.editing.view;let ve=!1,ke=!1;this.listenTo(xe.document,"delete",(Ie,Ae)=>{ve=Ae.direction==="backward"},{priority:"high"}),this.listenTo(te,"deleteContent",()=>{if(!ve)return;const Ie=be.getFirstPosition();ke=hasAnyAttribute$1(be,this.attributes)&&!isStepAfterAnyAttributeBoundary(Ie,this.attributes)},{priority:"high"}),this.listenTo(te,"deleteContent",()=>{ve&&(ve=!1,!ke&&t.model.enqueueChange(()=>{const Ie=be.getFirstPosition();hasAnyAttribute$1(be,this.attributes)&&isBetweenDifferentAttributes(Ie,this.attributes)&&(Ie.isAtStart||isBetweenDifferentAttributes(Ie,this.attributes,!0)?clearSelectionAttributes(te,this.attributes):this._isGravityOverridden||this._overrideGravity())}))},{priority:"low"})}get _isGravityOverridden(){return!!this._overrideUid}_overrideGravity(){this._overrideUid=this.editor.model.change(t=>t.overrideSelectionGravity())}_restoreGravity(){this.editor.model.change(t=>{t.restoreSelectionGravity(this._overrideUid),this._overrideUid=null})}}function hasAnyAttribute$1(Te,we){for(const t of we)if(Te.hasAttribute(t))return!0;return!1}function setSelectionAttributesFromTheNodeBefore(Te,we,t){const te=t.nodeBefore;Te.change(be=>{if(te){const xe=[],ve=Te.schema.isObject(te)&&Te.schema.isInline(te);for(const[ke,Ie]of te.getAttributes())Te.schema.checkAttribute("$text",ke)&&(!ve||Te.schema.getAttributeProperties(ke).copyFromObject!==!1)&&xe.push([ke,Ie]);be.setSelectionAttribute(xe)}else be.removeSelectionAttribute(we)})}function clearSelectionAttributes(Te,we){Te.change(t=>{t.removeSelectionAttribute(we)})}function preventCaretMovement(Te){Te.preventDefault()}function isStepAfterAnyAttributeBoundary(Te,we){const t=Te.getShiftedBy(-1);return isBetweenDifferentAttributes(t,we)}function isBetweenDifferentAttributes(Te,we,t=!1){const{nodeBefore:te,nodeAfter:be}=Te;for(const xe of we){const ve=te?te.getAttribute(xe):void 0,ke=be?be.getAttribute(xe):void 0;if(!(t&&(ve===void 0||ke===void 0))&&ke!==ve)return!0}return!1}const TRANSFORMATIONS={copyright:{from:"(c)",to:"©"},registeredTrademark:{from:"(r)",to:"®"},trademark:{from:"(tm)",to:"™"},oneHalf:{from:/(^|[^/a-z0-9])(1\/2)([^/a-z0-9])$/i,to:[null,"½",null]},oneThird:{from:/(^|[^/a-z0-9])(1\/3)([^/a-z0-9])$/i,to:[null,"⅓",null]},twoThirds:{from:/(^|[^/a-z0-9])(2\/3)([^/a-z0-9])$/i,to:[null,"⅔",null]},oneForth:{from:/(^|[^/a-z0-9])(1\/4)([^/a-z0-9])$/i,to:[null,"¼",null]},threeQuarters:{from:/(^|[^/a-z0-9])(3\/4)([^/a-z0-9])$/i,to:[null,"¾",null]},lessThanOrEqual:{from:"<=",to:"≤"},greaterThanOrEqual:{from:">=",to:"≥"},notEqual:{from:"!=",to:"≠"},arrowLeft:{from:"<-",to:"←"},arrowRight:{from:"->",to:"→"},horizontalEllipsis:{from:"...",to:"…"},enDash:{from:/(^| )(--)( )$/,to:[null,"–",null]},emDash:{from:/(^| )(---)( )$/,to:[null,"—",null]},quotesPrimary:{from:buildQuotesRegExp('"'),to:[null,"“",null,"”"]},quotesSecondary:{from:buildQuotesRegExp("'"),to:[null,"‘",null,"’"]},quotesPrimaryEnGb:{from:buildQuotesRegExp("'"),to:[null,"‘",null,"’"]},quotesSecondaryEnGb:{from:buildQuotesRegExp('"'),to:[null,"“",null,"”"]},quotesPrimaryPl:{from:buildQuotesRegExp('"'),to:[null,"„",null,"”"]},quotesSecondaryPl:{from:buildQuotesRegExp("'"),to:[null,"‚",null,"’"]}},TRANSFORMATION_GROUPS={symbols:["copyright","registeredTrademark","trademark"],mathematical:["oneHalf","oneThird","twoThirds","oneForth","threeQuarters","lessThanOrEqual","greaterThanOrEqual","notEqual","arrowLeft","arrowRight"],typography:["horizontalEllipsis","enDash","emDash"],quotes:["quotesPrimary","quotesSecondary"]},DEFAULT_TRANSFORMATIONS=["symbols","mathematical","typography","quotes"];class TextTransformation extends Plugin{static get requires(){return["Delete","Input"]}static get pluginName(){return"TextTransformation"}constructor(we){super(we),we.config.define("typing",{transformations:{include:DEFAULT_TRANSFORMATIONS}})}init(){const t=this.editor.model.document.selection;t.on("change:range",()=>{this.isEnabled=!t.anchor.parent.is("element","codeBlock")}),this._enableTransformationWatchers()}_enableTransformationWatchers(){const we=this.editor,t=we.model,te=we.plugins.get("Delete"),be=normalizeTransformations(we.config.get("typing.transformations")),xe=ke=>{for(const Ie of be)if(Ie.from.test(ke))return{normalizedTransformation:Ie}},ve=new TextWatcher(we.model,xe);ve.on("matched:data",(ke,Ie)=>{if(!Ie.batch.isTyping)return;const{from:Ae,to:Se}=Ie.normalizedTransformation,Oe=Ae.exec(Ie.text),Ve=Se(Oe.slice(1)),Me=Ie.range;let De=Oe.index;t.enqueueChange(Fe=>{for(let Be=1;Be<Oe.length;Be++){const $e=Oe[Be],Ue=Ve[Be-1];if(Ue==null){De+=$e.length;continue}const He=Me.start.getShiftedBy(De),ze=t.createRange(He,He.getShiftedBy($e.length)),qe=getTextAttributesAfterPosition(He);t.insertContent(Fe.createText(Ue,qe),ze),De+=Ue.length}t.enqueueChange(()=>{te.requestUndoOnBackspace()})})}),ve.bind("isEnabled").to(this)}}function normalizeFrom(Te){return typeof Te=="string"?new RegExp(`(${escapeRegExp(Te)})$`):Te}function normalizeTo(Te){return typeof Te=="string"?()=>[Te]:Te instanceof Array?()=>Te:Te}function getTextAttributesAfterPosition(Te){return(Te.textNode?Te.textNode:Te.nodeAfter).getAttributes()}function buildQuotesRegExp(Te){return new RegExp(`(^|\\s)(${Te})([^${Te}]*)(${Te})$`)}function normalizeTransformations(Te){const we=Te.extra||[],t=Te.remove||[],te=xe=>!t.includes(xe),be=Te.include.concat(we).filter(te);return expandGroupsAndRemoveDuplicates(be).filter(te).map(xe=>typeof xe=="string"&&TRANSFORMATIONS[xe]?TRANSFORMATIONS[xe]:xe).filter(xe=>typeof xe=="object").map(xe=>({from:normalizeFrom(xe.from),to:normalizeTo(xe.to)}))}function expandGroupsAndRemoveDuplicates(Te){const we=new Set;for(const t of Te)if(typeof t=="string"&&TRANSFORMATION_GROUPS[t])for(const te of TRANSFORMATION_GROUPS[t])we.add(te);else we.add(t);return Array.from(we)}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function findAttributeRange(Te,we,t,te){return te.createRange(findAttributeRangeBound(Te,we,t,!0,te),findAttributeRangeBound(Te,we,t,!1,te))}function findAttributeRangeBound(Te,we,t,te,be){let xe=Te.textNode||(te?Te.nodeBefore:Te.nodeAfter),ve=null;for(;xe&&xe.getAttribute(we)==t;)ve=xe,xe=te?xe.previousSibling:xe.nextSibling;return ve?be.createPositionAt(ve,te?"before":"after"):Te}function inlineHighlight(Te,we,t,te){const be=Te.editing.view,xe=new Set;be.document.registerPostFixer(ve=>{const ke=Te.model.document.selection;let Ie=!1;if(ke.hasAttribute(we)){const Ae=findAttributeRange(ke.getFirstPosition(),we,ke.getAttribute(we),Te.model),Se=Te.editing.mapper.toViewRange(Ae);for(const Oe of Se.getItems())Oe.is("element",t)&&!Oe.hasClass(te)&&(ve.addClass(te,Oe),xe.add(Oe),Ie=!0)}return Ie}),Te.conversion.for("editingDowncast").add(ve=>{ve.on("insert",ke,{priority:"highest"}),ve.on("remove",ke,{priority:"highest"}),ve.on("attribute",ke,{priority:"highest"}),ve.on("selection",ke,{priority:"highest"});function ke(){be.change(Ie=>{for(const Ae of xe.values())Ie.removeClass(te,Ae),xe.delete(Ae)})}})}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function blockAutoformatEditing(Te,we,t,te){let be,xe=null;typeof te=="function"?be=te:(xe=Te.commands.get(te),be=()=>{Te.execute(te)}),Te.model.document.on("change:data",(ve,ke)=>{if(xe&&!xe.isEnabled||!we.isEnabled)return;const Ie=first(Te.model.document.selection.getRanges());if(!Ie.isCollapsed||ke.isUndo||!ke.isLocal)return;const Ae=Array.from(Te.model.document.differ.getChanges()),Se=Ae[0];if(Ae.length!=1||Se.type!=="insert"||Se.name!="$text"||Se.length!=1)return;const Oe=Se.position.parent;if(Oe.is("element","codeBlock")||Oe.is("element","listItem")&&typeof te!="function"&&!["numberedList","bulletedList","todoList"].includes(te)||xe&&xe.value===!0)return;const Ve=Oe.getChild(0),Me=Te.model.createRangeOn(Ve);if(!Me.containsRange(Ie)&&!Ie.end.isEqual(Me.end))return;const De=t.exec(Ve.data.substr(0,Ie.end.offset));De&&Te.model.enqueueChange(Fe=>{const Be=Fe.createPositionAt(Oe,0),$e=Fe.createPositionAt(Oe,De[0].length),Ue=new LiveRange(Be,$e);if(be({match:De})!==!1){Fe.remove(Ue);const ze=Te.model.document.selection.getFirstRange(),qe=Fe.createRangeIn(Oe);Oe.isEmpty&&!qe.isEqual(ze)&&!qe.containsRange(ze,!0)&&Fe.remove(Oe)}Ue.detach(),Te.model.enqueueChange(()=>{Te.plugins.get("Delete").requestUndoOnBackspace()})})})}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function inlineAutoformatEditing(Te,we,t,te){let be,xe;t instanceof RegExp?be=t:xe=t,xe=xe||(ve=>{let ke;const Ie=[],Ae=[];for(;(ke=be.exec(ve))!==null&&!(ke&&ke.length<4);){let{index:Se,"1":Oe,"2":Ve,"3":Me}=ke;const De=Oe+Ve+Me;Se+=ke[0].length-De.length;const Fe=[Se,Se+Oe.length],Be=[Se+Oe.length+Ve.length,Se+Oe.length+Ve.length+Me.length];Ie.push(Fe),Ie.push(Be),Ae.push([Se+Oe.length,Se+Oe.length+Ve.length])}return{remove:Ie,format:Ae}}),Te.model.document.on("change:data",(ve,ke)=>{if(ke.isUndo||!ke.isLocal||!we.isEnabled)return;const Ie=Te.model,Ae=Ie.document.selection;if(!Ae.isCollapsed)return;const Se=Array.from(Ie.document.differ.getChanges()),Oe=Se[0];if(Se.length!=1||Oe.type!=="insert"||Oe.name!="$text"||Oe.length!=1)return;const Ve=Ae.focus,Me=Ve.parent,{text:De,range:Fe}=getTextAfterCode(Ie.createRange(Ie.createPositionAt(Me,0),Ve),Ie),Be=xe(De),$e=testOutputToRanges(Fe.start,Be.format,Ie),Ue=testOutputToRanges(Fe.start,Be.remove,Ie);$e.length&&Ue.length&&Ie.enqueueChange(He=>{if(te(He,$e)!==!1){for(const qe of Ue.reverse())He.remove(qe);Ie.enqueueChange(()=>{Te.plugins.get("Delete").requestUndoOnBackspace()})}})})}function testOutputToRanges(Te,we,t){return we.filter(te=>te[0]!==void 0&&te[1]!==void 0).map(te=>t.createRange(Te.getShiftedBy(te[0]),Te.getShiftedBy(te[1])))}function getTextAfterCode(Te,we){let t=Te.start;return{text:Array.from(Te.getItems()).reduce((be,xe)=>!(xe.is("$text")||xe.is("$textProxy"))||xe.getAttribute("code")?(t=we.createPositionAfter(xe),""):be+xe.data,""),range:we.createRange(t,Te.end)}}class Autoformat extends Plugin{static get requires(){return[Delete]}static get pluginName(){return"Autoformat"}afterInit(){const we=this.editor,t=this.editor.t;this._addListAutoformats(),this._addBasicStylesAutoformats(),this._addHeadingAutoformats(),this._addBlockQuoteAutoformats(),this._addCodeBlockAutoformats(),this._addHorizontalLineAutoformats(),we.accessibility.addKeystrokeInfos({keystrokes:[{label:t("Revert autoformatting action"),keystroke:"Backspace"}]})}_addListAutoformats(){const we=this.editor.commands;we.get("bulletedList")&&blockAutoformatEditing(this.editor,this,/^[*-]\s$/,"bulletedList"),we.get("numberedList")&&blockAutoformatEditing(this.editor,this,/^1[.|)]\s$/,"numberedList"),we.get("todoList")&&blockAutoformatEditing(this.editor,this,/^\[\s?\]\s$/,"todoList"),we.get("checkTodoList")&&blockAutoformatEditing(this.editor,this,/^\[\s?x\s?\]\s$/,()=>{this.editor.execute("todoList"),this.editor.execute("checkTodoList")})}_addBasicStylesAutoformats(){const we=this.editor.commands;if(we.get("bold")){const t=getCallbackFunctionForInlineAutoformat(this.editor,"bold");inlineAutoformatEditing(this.editor,this,/(?:^|\s)(\*\*)([^*]+)(\*\*)$/g,t),inlineAutoformatEditing(this.editor,this,/(?:^|\s)(__)([^_]+)(__)$/g,t)}if(we.get("italic")){const t=getCallbackFunctionForInlineAutoformat(this.editor,"italic");inlineAutoformatEditing(this.editor,this,/(?:^|\s)(\*)([^*_]+)(\*)$/g,t),inlineAutoformatEditing(this.editor,this,/(?:^|\s)(_)([^_]+)(_)$/g,t)}if(we.get("code")){const t=getCallbackFunctionForInlineAutoformat(this.editor,"code");inlineAutoformatEditing(this.editor,this,/(`)([^`]+)(`)$/g,t)}if(we.get("strikethrough")){const t=getCallbackFunctionForInlineAutoformat(this.editor,"strikethrough");inlineAutoformatEditing(this.editor,this,/(~~)([^~]+)(~~)$/g,t)}}_addHeadingAutoformats(){const we=this.editor.commands.get("heading");we&&we.modelElements.filter(t=>t.match(/^heading[1-6]$/)).forEach(t=>{const te=t[7],be=new RegExp(`^(#{${te}})\\s$`);blockAutoformatEditing(this.editor,this,be,()=>{if(!we.isEnabled||we.value===t)return!1;this.editor.execute("heading",{value:t})})})}_addBlockQuoteAutoformats(){this.editor.commands.get("blockQuote")&&blockAutoformatEditing(this.editor,this,/^>\s$/,"blockQuote")}_addCodeBlockAutoformats(){const we=this.editor,t=we.model.document.selection;we.commands.get("codeBlock")&&blockAutoformatEditing(we,this,/^```$/,()=>{if(t.getFirstPosition().parent.is("element","listItem"))return!1;this.editor.execute("codeBlock",{usePreviousLanguageChoice:!0})})}_addHorizontalLineAutoformats(){this.editor.commands.get("horizontalLine")&&blockAutoformatEditing(this.editor,this,/^---$/,"horizontalLine")}}function getCallbackFunctionForInlineAutoformat(Te,we){return(t,te)=>{if(!Te.commands.get(we).isEnabled)return!1;const xe=Te.model.schema.getValidRanges(te,we);for(const ve of xe)t.setAttribute(we,!0,ve);t.removeSelectionAttribute(we)}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Autosave extends Plugin{constructor(t){super(t);Re(this,"adapter");Re(this,"_debouncedSave");Re(this,"_lastDocumentVersion");Re(this,"_savePromise");Re(this,"_domEmitter");Re(this,"_config");Re(this,"_pendingActions");Re(this,"_makeImmediateSave");Re(this,"_action",null);const te=t.config.get("autosave")||{},be=te.waitingTime||1e3;this.set("state","synchronized"),this._debouncedSave=debounce(this._save.bind(this),be),this._lastDocumentVersion=t.model.document.version,this._savePromise=null,this._domEmitter=new(DomEmitterMixin()),this._config=te,this._pendingActions=t.plugins.get(PendingActions),this._makeImmediateSave=!1}static get pluginName(){return"Autosave"}static get requires(){return[PendingActions]}init(){const t=this.editor,te=t.model.document;this.listenTo(t,"ready",()=>{this.listenTo(te,"change:data",(be,xe)=>{this._saveCallbacks.length&&xe.isLocal&&(this.state==="synchronized"&&(this.state="waiting",this._setPendingAction()),this.state==="waiting"&&this._debouncedSave())})}),this.listenTo(t,"destroy",()=>this._flush(),{priority:"highest"});/* istanbul ignore next -- @preserve */this._domEmitter.listenTo(window,"beforeunload",(be,xe)=>{this._pendingActions.hasAny&&(xe.returnValue=this._pendingActions.first.message)})}destroy(){this._domEmitter.stopListening(),super.destroy()}save(){return this._debouncedSave.cancel(),this._save()}_flush(){this._debouncedSave.flush()}_save(){return this._savePromise?(this._makeImmediateSave=this.editor.model.document.version>this._lastDocumentVersion,this._savePromise):(this._setPendingAction(),this.state="saving",this._lastDocumentVersion=this.editor.model.document.version,this._savePromise=Promise.resolve().then(()=>Promise.all(this._saveCallbacks.map(t=>t(this.editor)))).finally(()=>{this._savePromise=null}).then(()=>{if(this._makeImmediateSave)return this._makeImmediateSave=!1,this._save();this.editor.model.document.version>this._lastDocumentVersion?(this.state="waiting",this._debouncedSave()):(this.state="synchronized",this._pendingActions.remove(this._action),this._action=null)}).catch(t=>{throw this.state="error",this.state="saving",this._debouncedSave(),t}),this._savePromise)}_setPendingAction(){const t=this.editor.t;this._action||(this._action=this._pendingActions.add(t("Saving changes")))}get _saveCallbacks(){const t=[];return this.adapter&&this.adapter.save&&t.push(this.adapter.save),this._config.save&&t.push(this._config.save),t}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class AttributeCommand extends Command{constructor(t,te){super(t);Re(this,"attributeKey");this.attributeKey=te}refresh(){const t=this.editor.model,te=t.document;this.value=this._getValueFromFirstAllowedNode(),this.isEnabled=t.schema.checkAttributeInSelection(te.selection,this.attributeKey)}execute(t={}){const te=this.editor.model,xe=te.document.selection,ve=t.forceValue===void 0?!this.value:t.forceValue;te.change(ke=>{if(xe.isCollapsed)ve?ke.setSelectionAttribute(this.attributeKey,!0):ke.removeSelectionAttribute(this.attributeKey);else{const Ie=te.schema.getValidRanges(xe.getRanges(),this.attributeKey);for(const Ae of Ie)ve?ke.setAttribute(this.attributeKey,ve,Ae):ke.removeAttribute(this.attributeKey,Ae)}})}_getValueFromFirstAllowedNode(){const t=this.editor.model,te=t.schema,be=t.document.selection;if(be.isCollapsed)return be.hasAttribute(this.attributeKey);for(const xe of be.getRanges())for(const ve of xe.getItems())if(te.checkAttribute(ve,this.attributeKey))return ve.hasAttribute(this.attributeKey);return!1}}const BOLD$1="bold";class BoldEditing extends Plugin{static get pluginName(){return"BoldEditing"}init(){const we=this.editor,t=this.editor.t;we.model.schema.extend("$text",{allowAttributes:BOLD$1}),we.model.schema.setAttributeProperties(BOLD$1,{isFormatting:!0,copyOnEnter:!0}),we.conversion.attributeToElement({model:BOLD$1,view:"strong",upcastAlso:["b",te=>{const be=te.getStyle("font-weight");return be&&(be=="bold"||Number(be)>=600)?{name:!0,styles:["font-weight"]}:null}]}),we.commands.add(BOLD$1,new AttributeCommand(we,BOLD$1)),we.keystrokes.set("CTRL+B",BOLD$1),we.accessibility.addKeystrokeInfos({keystrokes:[{label:t("Bold text"),keystroke:"CTRL+B"}]})}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function getButtonCreator({editor:Te,commandName:we,plugin:t,icon:te,label:be,keystroke:xe}){return ve=>{const ke=Te.commands.get(we),Ie=new ve(Te.locale);return Ie.set({label:be,icon:te,keystroke:xe,isToggleable:!0}),Ie.bind("isEnabled").to(ke,"isEnabled"),t.listenTo(Ie,"execute",()=>{Te.execute(we),Te.editing.view.focus()}),Ie}}const BOLD="bold";class BoldUI extends Plugin{static get pluginName(){return"BoldUI"}init(){const we=this.editor,t=we.locale.t,te=we.commands.get(BOLD),be=getButtonCreator({editor:we,commandName:BOLD,plugin:this,icon:icons.bold,label:t("Bold"),keystroke:"CTRL+B"});we.ui.componentFactory.add(BOLD,()=>{const xe=be(ButtonView);return xe.set({tooltip:!0}),xe.bind("isOn").to(te,"value"),xe}),we.ui.componentFactory.add("menuBar:"+BOLD,()=>be(MenuBarMenuListItemButtonView))}}class Bold extends Plugin{static get requires(){return[BoldEditing,BoldUI]}static get pluginName(){return"Bold"}}const CODE$1="code",HIGHLIGHT_CLASS$2="ck-code_selected";class CodeEditing extends Plugin{static get pluginName(){return"CodeEditing"}static get requires(){return[TwoStepCaretMovement]}init(){const we=this.editor,t=this.editor.t;we.model.schema.extend("$text",{allowAttributes:CODE$1}),we.model.schema.setAttributeProperties(CODE$1,{isFormatting:!0,copyOnEnter:!1}),we.conversion.attributeToElement({model:CODE$1,view:"code",upcastAlso:{styles:{"word-wrap":"break-word"}}}),we.commands.add(CODE$1,new AttributeCommand(we,CODE$1)),we.plugins.get(TwoStepCaretMovement).registerAttribute(CODE$1),inlineHighlight(we,CODE$1,"code",HIGHLIGHT_CLASS$2),we.accessibility.addKeystrokeInfos({keystrokes:[{label:t("Move out of an inline code style"),keystroke:[["arrowleft","arrowleft"],["arrowright","arrowright"]]}]})}}var codeIcon='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="m12.5 5.7 5.2 3.9v1.3l-5.6 4c-.1.2-.3.2-.5.2-.3-.1-.6-.7-.6-1l.3-.4 4.7-3.5L11.5 7l-.2-.2c-.1-.3-.1-.6 0-.8.2-.2.5-.4.8-.4a.8.8 0 0 1 .4.1zm-5.2 0L2 9.6v1.3l5.6 4c.1.2.3.2.5.2.3-.1.7-.7.6-1 0-.1 0-.3-.2-.4l-5-3.5L8.2 7l.2-.2c.1-.3.1-.6 0-.8-.2-.2-.5-.4-.8-.4a.8.8 0 0 0-.3.1z"/></svg>';const CODE="code";class CodeUI extends Plugin{static get pluginName(){return"CodeUI"}init(){const we=this.editor,t=we.locale.t,te=getButtonCreator({editor:we,commandName:CODE,plugin:this,icon:codeIcon,label:t("Code")});we.ui.componentFactory.add(CODE,()=>{const be=te(ButtonView),xe=we.commands.get(CODE);return be.set({tooltip:!0}),be.bind("isOn").to(xe,"value"),be}),we.ui.componentFactory.add("menuBar:"+CODE,()=>te(MenuBarMenuListItemButtonView))}}class Code extends Plugin{static get requires(){return[CodeEditing,CodeUI]}static get pluginName(){return"Code"}}const ITALIC$1="italic";class ItalicEditing extends Plugin{static get pluginName(){return"ItalicEditing"}init(){const we=this.editor,t=this.editor.t;we.model.schema.extend("$text",{allowAttributes:ITALIC$1}),we.model.schema.setAttributeProperties(ITALIC$1,{isFormatting:!0,copyOnEnter:!0}),we.conversion.attributeToElement({model:ITALIC$1,view:"i",upcastAlso:["em",{styles:{"font-style":"italic"}}]}),we.commands.add(ITALIC$1,new AttributeCommand(we,ITALIC$1)),we.keystrokes.set("CTRL+I",ITALIC$1),we.accessibility.addKeystrokeInfos({keystrokes:[{label:t("Italic text"),keystroke:"CTRL+I"}]})}}var italicIcon='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="m9.586 14.633.021.004c-.036.335.095.655.393.962.082.083.173.15.274.201h1.474a.6.6 0 1 1 0 1.2H5.304a.6.6 0 0 1 0-1.2h1.15c.474-.07.809-.182 1.005-.334.157-.122.291-.32.404-.597l2.416-9.55a1.053 1.053 0 0 0-.281-.823 1.12 1.12 0 0 0-.442-.296H8.15a.6.6 0 0 1 0-1.2h6.443a.6.6 0 1 1 0 1.2h-1.195c-.376.056-.65.155-.823.296-.215.175-.423.439-.623.79l-2.366 9.347z"/></svg>';const ITALIC="italic";class ItalicUI extends Plugin{static get pluginName(){return"ItalicUI"}init(){const we=this.editor,t=we.commands.get(ITALIC),te=we.locale.t,be=getButtonCreator({editor:we,commandName:ITALIC,plugin:this,icon:italicIcon,keystroke:"CTRL+I",label:te("Italic")});we.ui.componentFactory.add(ITALIC,()=>{const xe=be(ButtonView);return xe.set({tooltip:!0}),xe.bind("isOn").to(t,"value"),xe}),we.ui.componentFactory.add("menuBar:"+ITALIC,()=>be(MenuBarMenuListItemButtonView))}}class Italic extends Plugin{static get requires(){return[ItalicEditing,ItalicUI]}static get pluginName(){return"Italic"}}const STRIKETHROUGH$1="strikethrough";class StrikethroughEditing extends Plugin{static get pluginName(){return"StrikethroughEditing"}init(){const we=this.editor,t=this.editor.t;we.model.schema.extend("$text",{allowAttributes:STRIKETHROUGH$1}),we.model.schema.setAttributeProperties(STRIKETHROUGH$1,{isFormatting:!0,copyOnEnter:!0}),we.conversion.attributeToElement({model:STRIKETHROUGH$1,view:"s",upcastAlso:["del","strike",{styles:{"text-decoration":"line-through"}}]}),we.commands.add(STRIKETHROUGH$1,new AttributeCommand(we,STRIKETHROUGH$1)),we.keystrokes.set("CTRL+SHIFT+X","strikethrough"),we.accessibility.addKeystrokeInfos({keystrokes:[{label:t("Strikethrough text"),keystroke:"CTRL+SHIFT+X"}]})}}var strikethroughIcon='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M7 16.4c-.8-.4-1.5-.9-2.2-1.5a.6.6 0 0 1-.2-.5l.3-.6h1c1 1.2 2.1 1.7 3.7 1.7 1 0 1.8-.3 2.3-.6.6-.4.6-1.2.6-1.3.2-1.2-.9-2.1-.9-2.1h2.1c.3.7.4 1.2.4 1.7v.8l-.6 1.2c-.6.8-1.1 1-1.6 1.2a6 6 0 0 1-2.4.6c-1 0-1.8-.3-2.5-.6zM6.8 9 6 8.3c-.4-.5-.5-.8-.5-1.6 0-.7.1-1.3.5-1.8.4-.6 1-1 1.6-1.3a6.3 6.3 0 0 1 4.7 0 4 4 0 0 1 1.7 1l.3.7c0 .1.2.4-.2.7-.4.2-.9.1-1 0a3 3 0 0 0-1.2-1c-.4-.2-1-.3-2-.4-.7 0-1.4.2-2 .6-.8.6-1 .8-1 1.5 0 .8.5 1 1.2 1.5.6.4 1.1.7 1.9 1H6.8z"/><path d="M3 10.5V9h14v1.5z"/></svg>';const STRIKETHROUGH="strikethrough";class StrikethroughUI extends Plugin{static get pluginName(){return"StrikethroughUI"}init(){const we=this.editor,t=we.locale.t,te=getButtonCreator({editor:we,commandName:STRIKETHROUGH,plugin:this,icon:strikethroughIcon,keystroke:"CTRL+SHIFT+X",label:t("Strikethrough")});we.ui.componentFactory.add(STRIKETHROUGH,()=>{const be=te(ButtonView),xe=we.commands.get(STRIKETHROUGH);return be.set({tooltip:!0}),be.bind("isOn").to(xe,"value"),be}),we.ui.componentFactory.add("menuBar:"+STRIKETHROUGH,()=>te(MenuBarMenuListItemButtonView))}}class Strikethrough extends Plugin{static get requires(){return[StrikethroughEditing,StrikethroughUI]}static get pluginName(){return"Strikethrough"}}const SUBSCRIPT$1="subscript";class SubscriptEditing extends Plugin{static get pluginName(){return"SubscriptEditing"}init(){const we=this.editor;we.model.schema.extend("$text",{allowAttributes:SUBSCRIPT$1}),we.model.schema.setAttributeProperties(SUBSCRIPT$1,{isFormatting:!0,copyOnEnter:!0}),we.conversion.attributeToElement({model:SUBSCRIPT$1,view:"sub",upcastAlso:[{styles:{"vertical-align":"sub"}}]}),we.commands.add(SUBSCRIPT$1,new AttributeCommand(we,SUBSCRIPT$1))}}var subscriptIcon='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="m7.03 10.349 3.818-3.819a.8.8 0 1 1 1.132 1.132L8.16 11.48l3.819 3.818a.8.8 0 1 1-1.132 1.132L7.03 12.61l-3.818 3.82a.8.8 0 1 1-1.132-1.132L5.9 11.48 2.08 7.662A.8.8 0 1 1 3.212 6.53l3.818 3.82zm8.147 7.829h2.549c.254 0 .447.05.58.152a.49.49 0 0 1 .201.413.54.54 0 0 1-.159.393c-.105.108-.266.162-.48.162h-3.594c-.245 0-.435-.066-.572-.197a.621.621 0 0 1-.205-.463c0-.114.044-.265.132-.453a1.62 1.62 0 0 1 .288-.444c.433-.436.824-.81 1.172-1.122.348-.312.597-.517.747-.615.267-.183.49-.368.667-.553.177-.185.312-.375.405-.57.093-.194.139-.384.139-.57a1.008 1.008 0 0 0-.554-.917 1.197 1.197 0 0 0-.56-.133c-.426 0-.761.182-1.005.546a2.332 2.332 0 0 0-.164.39 1.609 1.609 0 0 1-.258.488c-.096.114-.237.17-.423.17a.558.558 0 0 1-.405-.156.568.568 0 0 1-.161-.427c0-.218.05-.446.151-.683.101-.238.252-.453.452-.646s.454-.349.762-.467a2.998 2.998 0 0 1 1.081-.178c.498 0 .923.076 1.274.228a1.916 1.916 0 0 1 1.004 1.032 1.984 1.984 0 0 1-.156 1.794c-.2.32-.405.572-.613.754-.208.182-.558.468-1.048.857-.49.39-.826.691-1.008.906a2.703 2.703 0 0 0-.24.309z"/></svg>';const SUBSCRIPT="subscript";class SubscriptUI extends Plugin{static get pluginName(){return"SubscriptUI"}init(){const we=this.editor,t=we.locale.t,te=getButtonCreator({editor:we,commandName:SUBSCRIPT,plugin:this,icon:subscriptIcon,label:t("Subscript")});we.ui.componentFactory.add(SUBSCRIPT,()=>{const be=te(ButtonView),xe=we.commands.get(SUBSCRIPT);return be.set({tooltip:!0}),be.bind("isOn").to(xe,"value"),be}),we.ui.componentFactory.add("menuBar:"+SUBSCRIPT,()=>te(MenuBarMenuListItemButtonView))}}class Subscript extends Plugin{static get requires(){return[SubscriptEditing,SubscriptUI]}static get pluginName(){return"Subscript"}}const SUPERSCRIPT$1="superscript";class SuperscriptEditing extends Plugin{static get pluginName(){return"SuperscriptEditing"}init(){const we=this.editor;we.model.schema.extend("$text",{allowAttributes:SUPERSCRIPT$1}),we.model.schema.setAttributeProperties(SUPERSCRIPT$1,{isFormatting:!0,copyOnEnter:!0}),we.conversion.attributeToElement({model:SUPERSCRIPT$1,view:"sup",upcastAlso:[{styles:{"vertical-align":"super"}}]}),we.commands.add(SUPERSCRIPT$1,new AttributeCommand(we,SUPERSCRIPT$1))}}var superscriptIcon='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M15.677 8.678h2.549c.254 0 .447.05.58.152a.49.49 0 0 1 .201.413.54.54 0 0 1-.159.393c-.105.108-.266.162-.48.162h-3.594c-.245 0-.435-.066-.572-.197a.621.621 0 0 1-.205-.463c0-.114.044-.265.132-.453a1.62 1.62 0 0 1 .288-.444c.433-.436.824-.81 1.172-1.122.348-.312.597-.517.747-.615.267-.183.49-.368.667-.553.177-.185.312-.375.405-.57.093-.194.139-.384.139-.57a1.008 1.008 0 0 0-.554-.917 1.197 1.197 0 0 0-.56-.133c-.426 0-.761.182-1.005.546a2.332 2.332 0 0 0-.164.39 1.609 1.609 0 0 1-.258.488c-.096.114-.237.17-.423.17a.558.558 0 0 1-.405-.156.568.568 0 0 1-.161-.427c0-.218.05-.446.151-.683.101-.238.252-.453.452-.646s.454-.349.762-.467a2.998 2.998 0 0 1 1.081-.178c.498 0 .923.076 1.274.228a1.916 1.916 0 0 1 1.004 1.032 1.984 1.984 0 0 1-.156 1.794c-.2.32-.405.572-.613.754-.208.182-.558.468-1.048.857-.49.39-.826.691-1.008.906a2.703 2.703 0 0 0-.24.309zM7.03 10.349l3.818-3.819a.8.8 0 1 1 1.132 1.132L8.16 11.48l3.819 3.818a.8.8 0 1 1-1.132 1.132L7.03 12.61l-3.818 3.82a.8.8 0 1 1-1.132-1.132L5.9 11.48 2.08 7.662A.8.8 0 1 1 3.212 6.53l3.818 3.82z"/></svg>';const SUPERSCRIPT="superscript";class SuperscriptUI extends Plugin{static get pluginName(){return"SuperscriptUI"}init(){const we=this.editor,t=we.locale.t,te=getButtonCreator({editor:we,commandName:SUPERSCRIPT,plugin:this,icon:superscriptIcon,label:t("Superscript")});we.ui.componentFactory.add(SUPERSCRIPT,()=>{const be=te(ButtonView),xe=we.commands.get(SUPERSCRIPT);return be.set({tooltip:!0}),be.bind("isOn").to(xe,"value"),be}),we.ui.componentFactory.add("menuBar:"+SUPERSCRIPT,()=>te(MenuBarMenuListItemButtonView))}}class Superscript extends Plugin{static get requires(){return[SuperscriptEditing,SuperscriptUI]}static get pluginName(){return"Superscript"}}const UNDERLINE$1="underline";class UnderlineEditing extends Plugin{static get pluginName(){return"UnderlineEditing"}init(){const we=this.editor,t=this.editor.t;we.model.schema.extend("$text",{allowAttributes:UNDERLINE$1}),we.model.schema.setAttributeProperties(UNDERLINE$1,{isFormatting:!0,copyOnEnter:!0}),we.conversion.attributeToElement({model:UNDERLINE$1,view:"u",upcastAlso:{styles:{"text-decoration":"underline"}}}),we.commands.add(UNDERLINE$1,new AttributeCommand(we,UNDERLINE$1)),we.keystrokes.set("CTRL+U","underline"),we.accessibility.addKeystrokeInfos({keystrokes:[{label:t("Underline text"),keystroke:"CTRL+U"}]})}}var underlineIcon='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M3 18v-1.5h14V18zm2.2-8V3.6c0-.4.4-.6.8-.6.3 0 .7.2.7.6v6.2c0 2 1.3 2.8 3.2 2.8 1.9 0 3.4-.9 3.4-2.9V3.6c0-.3.4-.5.8-.5.3 0 .7.2.7.5V10c0 2.7-2.2 4-4.9 4-2.6 0-4.7-1.2-4.7-4z"/></svg>';const UNDERLINE="underline";class UnderlineUI extends Plugin{static get pluginName(){return"UnderlineUI"}init(){const we=this.editor,t=we.commands.get(UNDERLINE),te=we.locale.t,be=getButtonCreator({editor:we,commandName:UNDERLINE,plugin:this,icon:underlineIcon,label:te("Underline"),keystroke:"CTRL+U"});we.ui.componentFactory.add(UNDERLINE,()=>{const xe=be(ButtonView);return xe.set({tooltip:!0}),xe.bind("isOn").to(t,"value"),xe}),we.ui.componentFactory.add("menuBar:"+UNDERLINE,()=>be(MenuBarMenuListItemButtonView))}}class Underline extends Plugin{static get requires(){return[UnderlineEditing,UnderlineUI]}static get pluginName(){return"Underline"}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 *//**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function*getCopyOnEnterAttributes(Te,we){for(const t of we)t&&Te.getAttributeProperties(t[0]).copyOnEnter&&(yield t)}class EnterCommand extends Command{execute(){this.editor.model.change(we=>{this.enterBlock(we),this.fire("afterExecute",{writer:we})})}enterBlock(we){const t=this.editor.model,te=t.document.selection,be=t.schema,xe=te.isCollapsed,ve=te.getFirstRange(),ke=ve.start.parent,Ie=ve.end.parent;if(be.isLimit(ke)||be.isLimit(Ie))return!xe&&ke==Ie&&t.deleteContent(te),!1;if(xe){const Ae=getCopyOnEnterAttributes(we.model.schema,te.getAttributes());return splitBlock(we,ve.start),we.setSelectionAttribute(Ae),!0}else{const Ae=!(ve.start.isAtStart&&ve.end.isAtEnd),Se=ke==Ie;if(t.deleteContent(te,{leaveUnmerged:Ae}),Ae){if(Se)return splitBlock(we,te.focus),!0;we.setSelection(Ie,0)}}return!1}}function splitBlock(Te,we){Te.split(we),Te.setSelection(we.parent.nextSibling,0)}const ENTER_EVENT_TYPES={insertParagraph:{isSoft:!1},insertLineBreak:{isSoft:!0}};class EnterObserver extends Observer{constructor(we){super(we);const t=this.document;let te=!1;t.on("keydown",(be,xe)=>{te=xe.shiftKey}),t.on("beforeinput",(be,xe)=>{if(!this.isEnabled)return;let ve=xe.inputType;env.isSafari&&te&&ve=="insertParagraph"&&(ve="insertLineBreak");const ke=xe.domEvent,Ie=ENTER_EVENT_TYPES[ve];if(!Ie)return;const Ae=new BubblingEventInfo(t,"enter",xe.targetRanges[0]);t.fire(Ae,new DomEventData(we,ke,{isSoft:Ie.isSoft})),Ae.stop.called&&be.stop()})}observe(){}stopObserving(){}}class Enter extends Plugin{static get pluginName(){return"Enter"}init(){const we=this.editor,t=we.editing.view,te=t.document,be=this.editor.t;t.addObserver(EnterObserver),we.commands.add("enter",new EnterCommand(we)),this.listenTo(te,"enter",(xe,ve)=>{te.isComposing||ve.preventDefault(),!ve.isSoft&&(we.execute("enter"),t.scrollToTheSelection())},{priority:"low"}),we.accessibility.addKeystrokeInfos({keystrokes:[{label:be("Insert a hard break (a new paragraph)"),keystroke:"Enter"}]})}}class ShiftEnterCommand extends Command{execute(){const we=this.editor.model,t=we.document;we.change(te=>{softBreakAction(we,te,t.selection),this.fire("afterExecute",{writer:te})})}refresh(){const we=this.editor.model,t=we.document;this.isEnabled=isEnabled(we.schema,t.selection)}}function isEnabled(Te,we){if(we.rangeCount>1)return!1;const t=we.anchor;if(!t||!Te.checkChild(t,"softBreak"))return!1;const te=we.getFirstRange(),be=te.start.parent,xe=te.end.parent;return!((isInsideLimitElement(be,Te)||isInsideLimitElement(xe,Te))&&be!==xe)}function softBreakAction(Te,we,t){const te=t.isCollapsed,be=t.getFirstRange(),xe=be.start.parent,ve=be.end.parent,ke=xe==ve;if(te){const Ie=getCopyOnEnterAttributes(Te.schema,t.getAttributes());insertBreak(Te,we,be.end),we.removeSelectionAttribute(t.getAttributeKeys()),we.setSelectionAttribute(Ie)}else{const Ie=!(be.start.isAtStart&&be.end.isAtEnd);Te.deleteContent(t,{leaveUnmerged:Ie}),ke?insertBreak(Te,we,t.focus):Ie&&we.setSelection(ve,0)}}function insertBreak(Te,we,t){const te=we.createElement("softBreak");Te.insertContent(te,t),we.setSelection(te,"after")}function isInsideLimitElement(Te,we){return Te.is("rootElement")?!1:we.isLimit(Te)||isInsideLimitElement(Te.parent,we)}class ShiftEnter extends Plugin{static get pluginName(){return"ShiftEnter"}init(){const we=this.editor,t=we.model.schema,te=we.conversion,be=we.editing.view,xe=be.document,ve=this.editor.t;t.register("softBreak",{allowWhere:"$text",isInline:!0}),te.for("upcast").elementToElement({model:"softBreak",view:"br"}),te.for("downcast").elementToElement({model:"softBreak",view:(ke,{writer:Ie})=>Ie.createEmptyElement("br")}),be.addObserver(EnterObserver),we.commands.add("shiftEnter",new ShiftEnterCommand(we)),this.listenTo(xe,"enter",(ke,Ie)=>{xe.isComposing||Ie.preventDefault(),Ie.isSoft&&(we.execute("shiftEnter"),be.scrollToTheSelection())},{priority:"low"}),we.accessibility.addKeystrokeInfos({keystrokes:[{label:ve("Insert a soft break (a <code>&lt;br&gt;</code> element)"),keystroke:"Shift+Enter"}]})}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class BlockQuoteCommand extends Command{refresh(){this.value=this._getValue(),this.isEnabled=this._checkEnabled()}execute(we={}){const t=this.editor.model,te=t.schema,be=t.document.selection,xe=Array.from(be.getSelectedBlocks()),ve=we.forceValue===void 0?!this.value:we.forceValue;t.change(ke=>{if(!ve)this._removeQuote(ke,xe.filter(findQuote));else{const Ie=xe.filter(Ae=>findQuote(Ae)||checkCanBeQuoted(te,Ae));this._applyQuote(ke,Ie)}})}_getValue(){const we=this.editor.model.document.selection,t=first(we.getSelectedBlocks());return!!(t&&findQuote(t))}_checkEnabled(){if(this.value)return!0;const we=this.editor.model.document.selection,t=this.editor.model.schema,te=first(we.getSelectedBlocks());return te?checkCanBeQuoted(t,te):!1}_removeQuote(we,t){getRangesOfBlockGroups(we,t).reverse().forEach(te=>{if(te.start.isAtStart&&te.end.isAtEnd){we.unwrap(te.start.parent);return}if(te.start.isAtStart){const xe=we.createPositionBefore(te.start.parent);we.move(te,xe);return}te.end.isAtEnd||we.split(te.end);const be=we.createPositionAfter(te.end.parent);we.move(te,be)})}_applyQuote(we,t){const te=[];getRangesOfBlockGroups(we,t).reverse().forEach(be=>{let xe=findQuote(be.start);xe||(xe=we.createElement("blockQuote"),we.wrap(be,xe)),te.push(xe)}),te.reverse().reduce((be,xe)=>be.nextSibling==xe?(we.merge(we.createPositionAfter(be)),be):xe)}}function findQuote(Te){return Te.parent.name=="blockQuote"?Te.parent:null}function getRangesOfBlockGroups(Te,we){let t,te=0;const be=[];for(;te<we.length;){const xe=we[te],ve=we[te+1];t||(t=Te.createPositionBefore(xe)),(!ve||xe.nextSibling!=ve)&&(be.push(Te.createRange(t,Te.createPositionAfter(xe))),t=null),te++}return be}function checkCanBeQuoted(Te,we){const t=Te.checkChild(we.parent,"blockQuote"),te=Te.checkChild(["$root","blockQuote"],we);return t&&te}class BlockQuoteEditing extends Plugin{static get pluginName(){return"BlockQuoteEditing"}static get requires(){return[Enter,Delete]}init(){const we=this.editor,t=we.model.schema;we.commands.add("blockQuote",new BlockQuoteCommand(we)),t.register("blockQuote",{inheritAllFrom:"$container"}),we.conversion.elementToElement({model:"blockQuote",view:"blockquote"}),we.model.document.registerPostFixer(ve=>{const ke=we.model.document.differ.getChanges();for(const Ie of ke)if(Ie.type=="insert"){const Ae=Ie.position.nodeAfter;if(!Ae)continue;if(Ae.is("element","blockQuote")&&Ae.isEmpty)return ve.remove(Ae),!0;if(Ae.is("element","blockQuote")&&!t.checkChild(Ie.position,Ae))return ve.unwrap(Ae),!0;if(Ae.is("element")){const Se=ve.createRangeIn(Ae);for(const Oe of Se.getItems())if(Oe.is("element","blockQuote")&&!t.checkChild(ve.createPositionBefore(Oe),Oe))return ve.unwrap(Oe),!0}}else if(Ie.type=="remove"){const Ae=Ie.position.parent;if(Ae.is("element","blockQuote")&&Ae.isEmpty)return ve.remove(Ae),!0}return!1});const te=this.editor.editing.view.document,be=we.model.document.selection,xe=we.commands.get("blockQuote");this.listenTo(te,"enter",(ve,ke)=>{if(!be.isCollapsed||!xe.value)return;be.getLastPosition().parent.isEmpty&&(we.execute("blockQuote"),we.editing.view.scrollToTheSelection(),ke.preventDefault(),ve.stop())},{context:"blockquote"}),this.listenTo(te,"delete",(ve,ke)=>{if(ke.direction!="backward"||!be.isCollapsed||!xe.value)return;const Ie=be.getLastPosition().parent;Ie.isEmpty&&!Ie.previousSibling&&(we.execute("blockQuote"),we.editing.view.scrollToTheSelection(),ke.preventDefault(),ve.stop())},{context:"blockquote"})}}class BlockQuoteUI extends Plugin{static get pluginName(){return"BlockQuoteUI"}init(){const we=this.editor,t=we.commands.get("blockQuote");we.ui.componentFactory.add("blockQuote",()=>{const te=this._createButton(ButtonView);return te.set({tooltip:!0}),te.bind("isOn").to(t,"value"),te}),we.ui.componentFactory.add("menuBar:blockQuote",()=>this._createButton(MenuBarMenuListItemButtonView))}_createButton(we){const t=this.editor,te=t.locale,be=t.commands.get("blockQuote"),xe=new we(t.locale),ve=te.t;return xe.set({label:ve("Block quote"),icon:icons.quote,isToggleable:!0}),xe.bind("isEnabled").to(be,"isEnabled"),this.listenTo(xe,"execute",()=>{t.execute("blockQuote"),t.editing.view.focus()}),xe}}class BlockQuote extends Plugin{static get requires(){return[BlockQuoteEditing,BlockQuoteUI]}static get pluginName(){return"BlockQuote"}}var q$5=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","#","$","%","*","+",",","-",".",":",";","=","?","@","[","]","^","_","{","|","}","~"],x$6=Te=>{let we=0;for(let t=0;t<Te.length;t++){let te=Te[t],be=q$5.indexOf(te);we=we*83+be}return we},f$7=Te=>{let we=Te/255;return we<=.04045?we/12.92:Math.pow((we+.055)/1.055,2.4)},h$6=Te=>{let we=Math.max(0,Math.min(1,Te));return we<=.0031308?Math.trunc(we*12.92*255+.5):Math.trunc((1.055*Math.pow(we,.4166666666666667)-.055)*255+.5)},F$6=Te=>Te<0?-1:1,M$3=(Te,we)=>F$6(Te)*Math.pow(Math.abs(Te),we),d$a=class extends Error{constructor(we){super(we),this.name="ValidationError",this.message=we}},C$3=Te=>{if(!Te||Te.length<6)throw new d$a("The blurhash string must be at least 6 characters");let we=x$6(Te[0]),t=Math.floor(we/9)+1,te=we%9+1;if(Te.length!==4+2*te*t)throw new d$a(`blurhash length mismatch: length is ${Te.length} but it should be ${4+2*te*t}`)},z$4=Te=>{let we=Te>>16,t=Te>>8&255,te=Te&255;return[f$7(we),f$7(t),f$7(te)]},L$4=(Te,we)=>{let t=Math.floor(Te/361),te=Math.floor(Te/19)%19,be=Te%19;return[M$3((t-9)/9,2)*we,M$3((te-9)/9,2)*we,M$3((be-9)/9,2)*we]},U$2=(Te,we,t,te)=>{C$3(Te),te=te|1;let be=x$6(Te[0]),xe=Math.floor(be/9)+1,ve=be%9+1,ke=(x$6(Te[1])+1)/166,Ie=new Array(ve*xe);for(let Oe=0;Oe<Ie.length;Oe++)if(Oe===0){let Ve=x$6(Te.substring(2,6));Ie[Oe]=z$4(Ve)}else{let Ve=x$6(Te.substring(4+Oe*2,6+Oe*2));Ie[Oe]=L$4(Ve,ke*te)}let Ae=we*4,Se=new Uint8ClampedArray(Ae*t);for(let Oe=0;Oe<t;Oe++)for(let Ve=0;Ve<we;Ve++){let Me=0,De=0,Fe=0;for(let He=0;He<xe;He++)for(let ze=0;ze<ve;ze++){let qe=Math.cos(Math.PI*Ve*ze/we)*Math.cos(Math.PI*Oe*He/t),Ke=Ie[ze+He*ve];Me+=Ke[0]*qe,De+=Ke[1]*qe,Fe+=Ke[2]*qe}let Be=h$6(Me),$e=h$6(De),Ue=h$6(Fe);Se[4*Ve+0+Oe*Ae]=Be,Se[4*Ve+1+Oe*Ae]=$e,Se[4*Ve+2+Oe*Ae]=Ue,Se[4*Ve+3+Oe*Ae]=255}return Se},j$5=U$2;/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class CKBoxUI extends Plugin{static get pluginName(){return"CKBoxUI"}afterInit(){const we=this.editor;we.commands.get("ckbox")&&(we.ui.componentFactory.add("ckbox",()=>this._createFileToolbarButton()),we.ui.componentFactory.add("menuBar:ckbox",()=>this._createFileMenuBarButton()),we.plugins.has("ImageInsertUI")&&we.plugins.get("ImageInsertUI").registerIntegration({name:"assetManager",observable:()=>we.commands.get("ckbox"),buttonViewCreator:()=>this._createImageToolbarButton(),formViewCreator:()=>this._createImageDropdownButton(),menuBarButtonViewCreator:t=>this._createImageMenuBarButton(t?"insertOnly":"insertNested")}))}_createButton(we){const t=this.editor,te=t.locale,be=new we(te),xe=t.commands.get("ckbox");return te.t,be.bind("isOn","isEnabled").to(xe,"value","isEnabled"),be.on("execute",()=>{t.execute("ckbox")}),be}_createFileToolbarButton(){const we=this.editor.locale.t,t=this._createButton(ButtonView);return t.icon=icons.browseFiles,t.label=we("Open file manager"),t.tooltip=!0,t}_createImageToolbarButton(){const we=this.editor.locale.t,t=this.editor.plugins.get("ImageInsertUI"),te=this._createButton(ButtonView);return te.icon=icons.imageAssetManager,te.bind("label").to(t,"isImageSelected",be=>we(be?"Replace image with file manager":"Insert image with file manager")),te.tooltip=!0,te}_createImageDropdownButton(){const we=this.editor.locale.t,t=this.editor.plugins.get("ImageInsertUI"),te=this._createButton(ButtonView);return te.icon=icons.imageAssetManager,te.withText=!0,te.bind("label").to(t,"isImageSelected",be=>we(be?"Replace with file manager":"Insert with file manager")),te.on("execute",()=>{t.dropdownView.isOpen=!1}),te}_createFileMenuBarButton(){const we=this.editor.locale.t,t=this._createButton(MenuBarMenuListItemButtonView);return t.icon=icons.browseFiles,t.withText=!0,t.label=we("File"),t}_createImageMenuBarButton(we){const t=this.editor.locale.t,te=this._createButton(MenuBarMenuListItemButtonView);switch(te.icon=icons.imageAssetManager,te.withText=!0,we){case"insertOnly":te.label=t("Image");break;case"insertNested":te.label=t("With file manager");break}return te}}function getImageUrls(Te){const we=[];let t=0;for(const be in Te){const xe=parseInt(be,10);isNaN(xe)||(xe>t&&(t=xe),we.push(`${Te[be]} ${be}w`))}const te=[{srcset:we.join(","),sizes:`(max-width: ${t}px) 100vw, ${t}px`,type:"image/webp"}];return{imageFallbackUrl:Te.default,imageSources:te}}function getWorkspaceId(Te,we){const[,t]=Te.value.split("."),te=JSON.parse(atob(t)),be=te.auth&&te.auth.ckbox&&te.auth.ckbox.workspaces||[te.aud];return we?(te.auth&&te.auth.ckbox&&te.auth.ckbox.role)=="superadmin"||be.includes(we)?we:null:be[0]}const BLUR_RESOLUTION=32;function blurHashToDataUrl(Te){if(Te)try{const we=`${BLUR_RESOLUTION}px`,t=document.createElement("canvas");t.setAttribute("width",we),t.setAttribute("height",we);const te=t.getContext("2d");/* istanbul ignore next -- @preserve */if(!te)return;const be=te.createImageData(BLUR_RESOLUTION,BLUR_RESOLUTION),xe=j$5(Te,BLUR_RESOLUTION,BLUR_RESOLUTION);return be.data.set(xe),te.putImageData(be,0,0),t.toDataURL()}catch{return}}function sendHttpRequest({url:Te,method:we="GET",data:t,onUploadProgress:te,signal:be,authorization:xe}){const ve=new XMLHttpRequest;ve.open(we,Te.toString()),ve.setRequestHeader("Authorization",xe),ve.setRequestHeader("CKBox-Version","CKEditor 5"),ve.responseType="json";const ke=()=>{ve.abort()};return new Promise((Ie,Ae)=>{be.throwIfAborted(),be.addEventListener("abort",ke),ve.addEventListener("loadstart",()=>{be.addEventListener("abort",ke)}),ve.addEventListener("loadend",()=>{be.removeEventListener("abort",ke)}),ve.addEventListener("error",()=>{Ae()}),ve.addEventListener("abort",()=>{Ae()}),ve.addEventListener("load",()=>{const Se=ve.response;if(!Se||Se.statusCode>=400)return Ae(Se&&Se.message);Ie(Se)});/* istanbul ignore else -- @preserve */te&&ve.upload.addEventListener("progress",Se=>{te(Se)}),ve.send(t)})}const MIME_TO_EXTENSION={"image/gif":"gif","image/jpeg":"jpg","image/png":"png","image/webp":"webp","image/bmp":"bmp","image/tiff":"tiff"};function convertMimeTypeToExtension(Te){return MIME_TO_EXTENSION[Te]}async function getContentTypeOfUrl(Te,we){try{const t=await fetch(Te,{method:"HEAD",cache:"force-cache",...we});return t.ok&&t.headers.get("content-type")||""}catch{return""}}function getFileExtension(Te){const we=Te.name,t=/\.(?<ext>[^.]+)$/;return we.match(t).groups.ext.toLowerCase()}const ASSET_INSERTION_WAIT_TIMEOUT=1e3;class CKBoxCommand extends Command{constructor(t){super(t);Re(this,"_chosenAssets",new Set);Re(this,"_wrapper",null);this._initListeners()}refresh(){this.value=this._getValue(),this.isEnabled=this._checkEnabled()}execute(){this.fire("ckbox:open")}_getValue(){return this._wrapper!==null}_checkEnabled(){const t=this.editor.commands.get("insertImage"),te=this.editor.commands.get("link");return!(!t.isEnabled&&!te.isEnabled)}_prepareOptions(){const te=this.editor.config.get("ckbox");return{theme:te.theme,language:te.language,tokenUrl:te.tokenUrl,serviceOrigin:te.serviceOrigin,forceDemoLabel:te.forceDemoLabel,dialog:{onClose:()=>this.fire("ckbox:close")},assets:{onChoose:be=>this.fire("ckbox:choose",be)}}}_initListeners(){const t=this.editor,te=t.model,be=!t.config.get("ckbox.ignoreDataId");this.on("ckbox",()=>{this.refresh()},{priority:"low"}),this.on("ckbox:open",()=>{!this.isEnabled||this.value||(this._wrapper=createElement(document,"div",{class:"ck ckbox-wrapper"}),document.body.appendChild(this._wrapper),window.CKBox.mount(this._wrapper,this._prepareOptions()))}),this.on("ckbox:close",()=>{this.value&&(this._wrapper.remove(),this._wrapper=null,t.editing.view.focus())}),this.on("ckbox:choose",(xe,ve)=>{if(!this.isEnabled)return;const ke=t.commands.get("insertImage"),Ie=t.commands.get("link"),Ae=prepareAssets({assets:ve,isImageAllowed:ke.isEnabled,isLinkAllowed:Ie.isEnabled}),Se=Ae.length;Se!==0&&(te.change(Oe=>{for(const Ve of Ae){const Me=Ve===Ae[Se-1],De=Se===1;this._insertAsset(Ve,Me,Oe,De),be&&(setTimeout(()=>this._chosenAssets.delete(Ve),ASSET_INSERTION_WAIT_TIMEOUT),this._chosenAssets.add(Ve))}}),t.editing.view.focus())}),this.listenTo(t,"destroy",()=>{this.fire("ckbox:close"),this._chosenAssets.clear()})}_insertAsset(t,te,be,xe){const Ie=this.editor.model.document.selection;be.removeSelectionAttribute("linkHref"),t.type==="image"?this._insertImage(t):this._insertLink(t,be,xe),te||be.setSelection(Ie.getLastPosition())}_insertImage(t){const te=this.editor,{imageFallbackUrl:be,imageSources:xe,imageTextAlternative:ve,imageWidth:ke,imageHeight:Ie,imagePlaceholder:Ae}=t.attributes;te.execute("insertImage",{source:{src:be,sources:xe,alt:ve,width:ke,height:Ie,...Ae?{placeholder:Ae}:null}})}_insertLink(t,te,be){const xe=this.editor,ve=xe.model,ke=ve.document.selection,{linkName:Ie,linkHref:Ae}=t.attributes;if(ke.isCollapsed){const Se=toMap(ke.getAttributes()),Oe=te.createText(Ie,Se);if(!be){const Me=ke.getLastPosition(),De=Me.parent;De.name==="paragraph"&&De.isEmpty||xe.execute("insertParagraph",{position:Me});const Fe=ve.insertContent(Oe);te.setSelection(Fe),xe.execute("link",Ae);return}const Ve=ve.insertContent(Oe);te.setSelection(Ve)}xe.execute("link",Ae)}}function prepareAssets({assets:Te,isImageAllowed:we,isLinkAllowed:t}){return Te.map(te=>isImage(te)?{id:te.data.id,type:"image",attributes:prepareImageAssetAttributes(te)}:{id:te.data.id,type:"link",attributes:prepareLinkAssetAttributes(te)}).filter(te=>te.type==="image"?we:t)}function prepareImageAssetAttributes(Te){const{imageFallbackUrl:we,imageSources:t}=getImageUrls(Te.data.imageUrls),{description:te,width:be,height:xe,blurHash:ve}=Te.data.metadata,ke=blurHashToDataUrl(ve);return{imageFallbackUrl:we,imageSources:t,imageTextAlternative:te||"",imageWidth:be,imageHeight:xe,...ke?{imagePlaceholder:ke}:null}}function prepareLinkAssetAttributes(Te){return{linkName:Te.data.name,linkHref:getAssetUrl(Te)}}function isImage(Te){const we=Te.data.metadata;return we?we.width&&we.height:!1}function getAssetUrl(Te){const we=new URL(Te.data.url);return we.searchParams.set("download","true"),we.toString()}const DEFAULT_CKBOX_THEME_NAME="lark";class CKBoxUtils extends Plugin{constructor(){super(...arguments);Re(this,"_token")}static get pluginName(){return"CKBoxUtils"}static get requires(){return["CloudServices"]}async init(){const t=this.editor,te=!!t.config.get("ckbox"),be=!!window.CKBox;if(!te&&!be)return;t.config.define("ckbox",{serviceOrigin:"https://api.ckbox.io",defaultUploadCategories:null,ignoreDataId:!1,language:t.locale.uiLanguage,theme:DEFAULT_CKBOX_THEME_NAME,tokenUrl:t.config.get("cloudServices.tokenUrl")});const xe=t.plugins.get("CloudServices"),ve=t.config.get("cloudServices.tokenUrl"),ke=t.config.get("ckbox.tokenUrl");if(!ke)throw new CKEditorError("ckbox-plugin-missing-token-url",this);ke==ve?this._token=xe.token:this._token=await xe.registerTokenUrl(ke)}getToken(){return this._token}getWorkspaceId(){const t=this.editor.t,te=t("Cannot access default workspace."),be=this.editor.config.get("ckbox.defaultUploadWorkspaceId"),xe=getWorkspaceId(this._token,be);if(xe==null)throw logError("ckbox-access-default-workspace-error"),te;return xe}async getCategoryIdForFile(t,te){const be=this.editor.t,xe=be("Cannot determine a category for the uploaded file."),ve=this.editor.config.get("ckbox.defaultUploadCategories"),ke=this._getAvailableCategories(te),Ie=typeof t=="string"?convertMimeTypeToExtension(await getContentTypeOfUrl(t,te)):getFileExtension(t),Ae=await ke;if(!Ae)throw xe;if(ve){const Oe=Object.keys(ve).find(Ve=>ve[Ve].find(Me=>Me.toLowerCase()==Ie));if(Oe){const Ve=Ae.find(Me=>Me.id===Oe||Me.name===Oe);if(!Ve)throw xe;return Ve.id}}const Se=Ae.find(Oe=>Oe.extensions.find(Ve=>Ve.toLowerCase()==Ie));if(!Se)throw xe;return Se.id}async _getAvailableCategories(t){const be=this.editor,xe=this._token,{signal:ve}=t,ke=be.config.get("ckbox.serviceOrigin"),Ie=this.getWorkspaceId();try{const Se=[];let Oe=0,Ve;do{const Me=await Ae(Oe);Se.push(...Me.items),Ve=Me.totalCount-(Oe+50),Oe+=50}while(Ve>0);return Se}catch{ve.throwIfAborted(),logError("ckbox-fetch-category-http-error");return}function Ae(Se){const Oe=new URL("categories",ke);return Oe.searchParams.set("limit","50"),Oe.searchParams.set("offset",Se.toString()),Oe.searchParams.set("workspaceId",Ie),sendHttpRequest({url:Oe,signal:ve,authorization:xe.value})}}}class CKBoxUploadAdapter extends Plugin{static get requires(){return["ImageUploadEditing","ImageUploadProgress",FileRepository,CKBoxEditing]}static get pluginName(){return"CKBoxUploadAdapter"}async afterInit(){const we=this.editor,t=!!we.config.get("ckbox"),te=!!window.CKBox;if(!t&&!te)return;const be=we.plugins.get(FileRepository),xe=we.plugins.get(CKBoxUtils);be.createUploadAdapter=Ie=>new Adapter(Ie,we,xe);const ve=!we.config.get("ckbox.ignoreDataId"),ke=we.plugins.get("ImageUploadEditing");ve&&ke.on("uploadComplete",(Ie,{imageElement:Ae,data:Se})=>{we.model.change(Oe=>{Oe.setAttribute("ckboxImageId",Se.ckboxImageId,Ae)})})}}class Adapter{constructor(we,t,te){Re(this,"loader");Re(this,"token");Re(this,"editor");Re(this,"controller");Re(this,"serviceOrigin");Re(this,"ckboxUtils");this.loader=we,this.token=te.getToken(),this.ckboxUtils=te,this.editor=t,this.controller=new AbortController,this.serviceOrigin=t.config.get("ckbox.serviceOrigin")}async upload(){const we=this.ckboxUtils,t=this.editor.t,te=await this.loader.file,be=await we.getCategoryIdForFile(te,{signal:this.controller.signal}),xe=new URL("assets",this.serviceOrigin),ve=new FormData;xe.searchParams.set("workspaceId",we.getWorkspaceId()),ve.append("categoryId",be),ve.append("file",te);const ke={method:"POST",url:xe,data:ve,onUploadProgress:Ie=>{/* istanbul ignore else -- @preserve */Ie.lengthComputable&&(this.loader.uploadTotal=Ie.total,this.loader.uploaded=Ie.loaded)},signal:this.controller.signal,authorization:this.token.value};return sendHttpRequest(ke).then(async Ie=>{const Ae=getImageUrls(Ie.imageUrls);return{ckboxImageId:Ie.id,default:Ae.imageFallbackUrl,sources:Ae.imageSources}}).catch(()=>{const Ie=t("Cannot upload file:")+` ${te.name}.`;return Promise.reject(Ie)})}abort(){this.controller.abort()}}class CKBoxEditing extends Plugin{constructor(){super(...arguments);Re(this,"_token")}static get pluginName(){return"CKBoxEditing"}static get requires(){return["LinkEditing","PictureEditing",CKBoxUploadAdapter,CKBoxUtils]}init(){const t=this.editor;this._shouldBeInitialised()&&(this._checkImagePlugins(),isLibraryLoaded()&&t.commands.add("ckbox",new CKBoxCommand(t)))}afterInit(){const t=this.editor;this._shouldBeInitialised()&&(t.config.get("ckbox.ignoreDataId")||(this._initSchema(),this._initConversion(),this._initFixers()))}_shouldBeInitialised(){return!!this.editor.config.get("ckbox")||isLibraryLoaded()}_checkImagePlugins(){const t=this.editor;!t.plugins.has("ImageBlockEditing")&&!t.plugins.has("ImageInlineEditing")&&logError("ckbox-plugin-image-feature-missing",t)}_initSchema(){const te=this.editor.model.schema;te.extend("$text",{allowAttributes:"ckboxLinkId"}),te.isRegistered("imageBlock")&&te.extend("imageBlock",{allowAttributes:["ckboxImageId","ckboxLinkId"]}),te.isRegistered("imageInline")&&te.extend("imageInline",{allowAttributes:["ckboxImageId","ckboxLinkId"]}),te.addAttributeCheck((be,xe)=>{if(!!!be.last.getAttribute("linkHref")&&xe==="ckboxLinkId")return!1})}_initConversion(){const t=this.editor;t.conversion.for("downcast").add(be=>{be.on("attribute:ckboxLinkId:imageBlock",(xe,ve,ke)=>{const{writer:Ie,mapper:Ae,consumable:Se}=ke;if(!Se.consume(ve.item,xe.name))return;const Ve=[...Ae.toViewElement(ve.item).getChildren()].find(Me=>Me.name==="a");Ve&&(ve.item.hasAttribute("ckboxLinkId")?Ie.setAttribute("data-ckbox-resource-id",ve.item.getAttribute("ckboxLinkId"),Ve):Ie.removeAttribute("data-ckbox-resource-id",Ve))},{priority:"low"}),be.on("attribute:ckboxLinkId",(xe,ve,ke)=>{const{writer:Ie,mapper:Ae,consumable:Se}=ke;if(Se.consume(ve.item,xe.name)){if(ve.attributeOldValue){const Oe=createLinkElement$1(Ie,ve.attributeOldValue);Ie.unwrap(Ae.toViewRange(ve.range),Oe)}if(ve.attributeNewValue){const Oe=createLinkElement$1(Ie,ve.attributeNewValue);if(ve.item.is("selection")){const Ve=Ie.document.selection;Ie.wrap(Ve.getFirstRange(),Oe)}else Ie.wrap(Ae.toViewRange(ve.range),Oe)}}},{priority:"low"})}),t.conversion.for("upcast").add(be=>{be.on("element:a",(xe,ve,ke)=>{const{writer:Ie,consumable:Ae}=ke;if(!ve.viewItem.getAttribute("href"))return;const Se={attributes:["data-ckbox-resource-id"]};if(!Ae.consume(ve.viewItem,Se))return;const Oe=ve.viewItem.getAttribute("data-ckbox-resource-id");if(Oe)if(ve.modelRange)for(let Ve of ve.modelRange.getItems())Ve.is("$textProxy")&&(Ve=Ve.textNode),shouldUpcastAttributeForNode(Ve)&&Ie.setAttribute("ckboxLinkId",Oe,Ve);else{const Ve=ve.modelCursor.nodeBefore||ve.modelCursor.parent;Ie.setAttribute("ckboxLinkId",Oe,Ve)}},{priority:"low"})}),t.conversion.for("downcast").attributeToAttribute({model:"ckboxImageId",view:"data-ckbox-resource-id"}),t.conversion.for("upcast").elementToAttribute({model:{key:"ckboxImageId",value:be=>be.getAttribute("data-ckbox-resource-id")},view:{attributes:{"data-ckbox-resource-id":/[\s\S]+/}}});const te=t.commands.get("replaceImageSource");te&&this.listenTo(te,"cleanupImage",(be,[xe,ve])=>{xe.removeAttribute("ckboxImageId",ve)})}_initFixers(){const t=this.editor,te=t.model,be=te.document.selection;te.document.registerPostFixer(syncDataIdPostFixer(t)),te.document.registerPostFixer(injectSelectionPostFixer(be))}}function syncDataIdPostFixer(Te){return we=>{let t=!1;const te=Te.model,be=Te.commands.get("ckbox");if(!be)return t;for(const xe of te.document.differ.getChanges()){if(xe.type!=="insert"&&xe.type!=="attribute")continue;const ve=xe.type==="insert"?new Range(xe.position,xe.position.getShiftedBy(xe.length)):xe.range,ke=xe.type==="attribute"&&xe.attributeKey==="linkHref"&&xe.attributeNewValue===null;for(const Ie of ve.getItems()){if(ke&&Ie.hasAttribute("ckboxLinkId")){we.removeAttribute("ckboxLinkId",Ie),t=!0;continue}const Ae=findAssetsForItem(Ie,be._chosenAssets);for(const Se of Ae){const Oe=Se.type==="image"?"ckboxImageId":"ckboxLinkId";Se.id!==Ie.getAttribute(Oe)&&(we.setAttribute(Oe,Se.id,Ie),t=!0)}}}return t}}function injectSelectionPostFixer(Te){return we=>!Te.hasAttribute("linkHref")&&Te.hasAttribute("ckboxLinkId")?(we.removeSelectionAttribute("ckboxLinkId"),!0):!1}function findAssetsForItem(Te,we){const t=Te.is("element","imageInline")||Te.is("element","imageBlock"),te=Te.hasAttribute("linkHref");return[...we].filter(be=>{if(be.type==="image"&&t)return be.attributes.imageFallbackUrl===Te.getAttribute("src");if(be.type==="link"&&te)return be.attributes.linkHref===Te.getAttribute("linkHref")})}function createLinkElement$1(Te,we){const t=Te.createAttributeElement("a",{"data-ckbox-resource-id":we},{priority:5});return Te.setCustomProperty("link",!0,t),t}function shouldUpcastAttributeForNode(Te){return!!(Te.is("$text")||Te.is("element","imageInline")||Te.is("element","imageBlock"))}function isLibraryLoaded(){return!!window.CKBox}class CKBox extends Plugin{static get pluginName(){return"CKBox"}static get requires(){return[CKBoxEditing,CKBoxUI]}}function createEditabilityChecker(Te){const we=createUrlChecker(Te);return t=>t.is("element","imageInline")||t.is("element","imageBlock")?t.hasAttribute("ckboxImageId")?!0:t.hasAttribute("src")?we(t.getAttribute("src")):!1:!1}function createUrlChecker(Te){if(Array.isArray(Te)){const we=Te.map(createUrlChecker);return t=>we.some(te=>te(t))}if(Te=="origin"){const we=global.window.location.origin;return t=>new URL(t,global.document.baseURI).origin==we}return typeof Te=="function"?Te:Te instanceof RegExp?we=>!!(we.match(Te)||we.replace(/^https?:\/\//,"").match(Te)):()=>!1}class CKBoxImageEditCommand extends Command{constructor(t){super(t);Re(this,"_wrapper",null);Re(this,"_processInProgress",new Set);Re(this,"_canEdit");Re(this,"_prepareOptions");Re(this,"_updateUiDelayed",delay(()=>this.editor.ui.update(),0));this.value=!1,this._canEdit=createEditabilityChecker(t.config.get("ckbox.allowExternalImagesEditing")),this._prepareOptions=abortableDebounce((te,be)=>this._prepareOptionsAbortable(te,be)),this._prepareListeners()}refresh(){const t=this.editor;this.value=this._getValue();const te=t.model.document.selection.getSelectedElement();this.isEnabled=!!te&&this._canEdit(te)&&!this._checkIfElementIsBeingProcessed(te)}execute(){if(this._getValue())return;const t=createElement(document,"div",{class:"ck ckbox-wrapper"});this._wrapper=t,this.value=!0,document.body.appendChild(this._wrapper);const be={element:this.editor.model.document.selection.getSelectedElement(),controller:new AbortController};this._prepareOptions(be).then(xe=>window.CKBox.mountImageEditor(t,xe),xe=>{const ve=this.editor,ke=ve.t;ve.plugins.get(Notification).showWarning(ke("Failed to determine category of edited image."),{namespace:"ckbox"}),console.error(xe),this._handleImageEditorClose()})}destroy(){this._handleImageEditorClose(),this._prepareOptions.abort(),this._updateUiDelayed.cancel();for(const t of this._processInProgress.values())t.controller.abort();super.destroy()}_getValue(){return this._wrapper!==null}async _prepareOptionsAbortable(t,te){const be=this.editor,xe=be.config.get("ckbox"),ve=be.plugins.get(CKBoxUtils),{element:ke}=te;let Ie;const Ae=ke.getAttribute("ckboxImageId");if(Ae)Ie={assetId:Ae};else{const Se=new URL(ke.getAttribute("src"),document.baseURI).href,Oe=await ve.getCategoryIdForFile(Se,{signal:t});Ie={imageUrl:Se,uploadCategoryId:Oe}}return{...Ie,imageEditing:{allowOverwrite:!1},tokenUrl:xe.tokenUrl,...xe.serviceOrigin&&{serviceOrigin:xe.serviceOrigin},onClose:()=>this._handleImageEditorClose(),onSave:Se=>this._handleImageEditorSave(te,Se)}}_prepareListeners(){this.listenTo(this.editor.model.document,"change:data",()=>{this._getProcessingStatesOfDeletedImages().forEach(te=>{te.controller.abort()})})}_getProcessingStatesOfDeletedImages(){const t=[];for(const te of this._processInProgress.values())te.element.root.rootName=="$graveyard"&&t.push(te);return t}_checkIfElementIsBeingProcessed(t){for(const{element:te}of this._processInProgress)if(isEqual(te,t))return!0;return!1}_handleImageEditorClose(){this._wrapper&&(this._wrapper.remove(),this._wrapper=null,this.editor.editing.view.focus(),this._updateUiDelayed(),this.refresh())}_handleImageEditorSave(t,te){const be=this.editor.locale.t,xe=this.editor.plugins.get(Notification),ve=this.editor.plugins.get(PendingActions),ke=ve.add(be("Processing the edited image."));this._processInProgress.add(t),this._showImageProcessingIndicator(t.element,te),this.refresh(),this._waitForAssetProcessed(te.data.id,t.controller.signal).then(Ie=>{this._replaceImage(t.element,Ie)},Ie=>{this.editor.editing.reconvertItem(t.element),!t.controller.signal.aborted&&(!Ie||Ie instanceof CKEditorError?xe.showWarning(be("Server failed to process the image."),{namespace:"ckbox"}):console.error(Ie))}).finally(()=>{this._processInProgress.delete(t),ve.remove(ke),this.refresh()})}async _getAssetStatusFromServer(t,te){const be=this.editor.plugins.get(CKBoxUtils),xe=new URL("assets/"+t,this.editor.config.get("ckbox.serviceOrigin")),ve=await sendHttpRequest({url:xe,signal:te,authorization:be.getToken().value}),ke=ve.metadata.metadataProcessingStatus;if(!ke||ke=="queued")throw new CKEditorError("ckbox-image-not-processed");return{data:{...ve}}}async _waitForAssetProcessed(t,te){const be=await retry(()=>this._getAssetStatusFromServer(t,te),{signal:te,maxAttempts:5});if(be.data.metadata.metadataProcessingStatus!="success")throw new CKEditorError("ckbox-image-processing-failed");return be}_showImageProcessingIndicator(t,te){const be=this.editor;be.editing.view.change(xe=>{const ve=be.editing.mapper.toViewElement(t),Ie=this.editor.plugins.get("ImageUtils").findViewImgElement(ve);xe.removeStyle("aspect-ratio",Ie),xe.setAttribute("width",te.data.metadata.width,Ie),xe.setAttribute("height",te.data.metadata.height,Ie),xe.setStyle("width",`${te.data.metadata.width}px`,Ie),xe.setStyle("height",`${te.data.metadata.height}px`,Ie),xe.addClass("image-processing",ve)})}_replaceImage(t,te){const be=this.editor,{imageFallbackUrl:xe,imageSources:ve,imageWidth:ke,imageHeight:Ie,imagePlaceholder:Ae}=prepareImageAssetAttributes(te),Se=Array.from(be.model.document.selection.getRanges());be.model.change(Oe=>{Oe.setSelection(t,"on"),be.execute("insertImage",{source:{src:xe,sources:ve,width:ke,height:Ie,...Ae?{placeholder:Ae}:null,...t.hasAttribute("alt")?{alt:t.getAttribute("alt")}:null}});const Ve=t.getChildren();t=be.model.document.selection.getSelectedElement();for(const Me of Ve)Oe.append(Oe.cloneElement(Me),t);Oe.setAttribute("ckboxImageId",te.data.id,t),Oe.setSelection(Se)})}}class CKBoxImageEditEditing extends Plugin{static get pluginName(){return"CKBoxImageEditEditing"}static get requires(){return[CKBoxEditing,CKBoxUtils,PendingActions,Notification,"ImageUtils","ImageEditing"]}init(){const{editor:we}=this;we.commands.add("ckboxImageEdit",new CKBoxImageEditCommand(we))}}var ckboxImageEditIcon='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M1.201 1C.538 1 0 1.47 0 2.1v14.363c0 .64.534 1.037 1.186 1.037H5.06l5.058-5.078L6.617 9.15a.696.696 0 0 0-.957-.033L1.5 13.6V2.5h15v4.354a3.478 3.478 0 0 1 1.5.049V2.1c0-.63-.547-1.1-1.2-1.1H1.202Zm11.713 2.803a2.147 2.147 0 0 0-2.049 1.992 2.14 2.14 0 0 0 1.28 2.096 2.13 2.13 0 0 0 2.642-3.11 2.129 2.129 0 0 0-1.873-.978ZM8.089 17.635v2.388h2.389l7.046-7.046-2.39-2.39-7.045 7.048Zm11.282-6.507a.637.637 0 0 0 .139-.692.603.603 0 0 0-.139-.205l-1.49-1.488a.63.63 0 0 0-.899 0l-1.166 1.163 2.39 2.39 1.165-1.168Z"/></svg>';class CKBoxImageEditUI extends Plugin{static get pluginName(){return"CKBoxImageEditUI"}init(){const we=this.editor;we.ui.componentFactory.add("ckboxImageEdit",t=>{const te=we.commands.get("ckboxImageEdit"),be=new ButtonView(t),xe=t.t;return be.set({label:xe("Edit image"),icon:ckboxImageEditIcon,tooltip:!0}),be.bind("isOn").to(te,"value",te,"isEnabled",(ve,ke)=>ve&&ke),be.bind("isEnabled").to(te),this.listenTo(be,"execute",()=>{we.execute("ckboxImageEdit"),we.editing.view.focus()}),be})}}class CKBoxImageEdit extends Plugin{static get pluginName(){return"CKBoxImageEdit"}static get requires(){return[CKBoxImageEditEditing,CKBoxImageEditUI]}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class HighlightStack extends EmitterMixin(){constructor(){super(...arguments);Re(this,"_stack",[])}add(t,te){const be=this._stack,xe=be[0];this._insertDescriptor(t);const ve=be[0];xe!==ve&&!compareDescriptors(xe,ve)&&this.fire("change:top",{oldDescriptor:xe,newDescriptor:ve,writer:te})}remove(t,te){const be=this._stack,xe=be[0];this._removeDescriptor(t);const ve=be[0];xe!==ve&&!compareDescriptors(xe,ve)&&this.fire("change:top",{oldDescriptor:xe,newDescriptor:ve,writer:te})}_insertDescriptor(t){const te=this._stack,be=te.findIndex(ve=>ve.id===t.id);if(compareDescriptors(t,te[be]))return;be>-1&&te.splice(be,1);let xe=0;for(;te[xe]&&shouldABeBeforeB(te[xe],t);)xe++;te.splice(xe,0,t)}_removeDescriptor(t){const te=this._stack,be=te.findIndex(xe=>xe.id===t);be>-1&&te.splice(be,1)}}function compareDescriptors(Te,we){return Te&&we&&Te.priority==we.priority&&classesToString(Te.classes)==classesToString(we.classes)}function shouldABeBeforeB(Te,we){return Te.priority>we.priority?!0:Te.priority<we.priority?!1:classesToString(Te.classes)>classesToString(we.classes)}function classesToString(Te){return Array.isArray(Te)?Te.sort().join(","):Te}var dragHandleIcon='<svg viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path d="M4 0v1H1v3H0V.5A.5.5 0 0 1 .5 0H4zm8 0h3.5a.5.5 0 0 1 .5.5V4h-1V1h-3V0zM4 16H.5a.5.5 0 0 1-.5-.5V12h1v3h3v1zm8 0v-1h3v-3h1v3.5a.5.5 0 0 1-.5.5H12z"/><path fill-opacity=".256" d="M1 1h14v14H1z"/><g class="ck-icon__selected-indicator"><path d="M7 0h2v1H7V0zM0 7h1v2H0V7zm15 0h1v2h-1V7zm-8 8h2v1H7v-1z"/><path fill-opacity=".254" d="M1 1h14v14H1z"/></g></svg>';const WIDGET_CLASS_NAME="ck-widget",WIDGET_SELECTED_CLASS_NAME="ck-widget_selected";function isWidget(Te){return Te.is("element")?!!Te.getCustomProperty("widget"):!1}function toWidget(Te,we,t={}){if(!Te.is("containerElement"))throw new CKEditorError("widget-to-widget-wrong-element-type",null,{element:Te});return we.setAttribute("contenteditable","false",Te),we.addClass(WIDGET_CLASS_NAME,Te),we.setCustomProperty("widget",!0,Te),Te.getFillerOffset=getFillerOffset,we.setCustomProperty("widgetLabel",[],Te),t.label&&setLabel(Te,t.label),t.hasSelectionHandle&&addSelectionHandle(Te,we),setHighlightHandling(Te,we),Te}function addHighlight(Te,we,t){if(we.classes&&t.addClass(toArray$2(we.classes),Te),we.attributes)for(const te in we.attributes)t.setAttribute(te,we.attributes[te],Te)}function removeHighlight(Te,we,t){if(we.classes&&t.removeClass(toArray$2(we.classes),Te),we.attributes)for(const te in we.attributes)t.removeAttribute(te,Te)}function setHighlightHandling(Te,we,t=addHighlight,te=removeHighlight){const be=new HighlightStack;be.on("change:top",(ke,Ie)=>{Ie.oldDescriptor&&te(Te,Ie.oldDescriptor,Ie.writer),Ie.newDescriptor&&t(Te,Ie.newDescriptor,Ie.writer)});const xe=(ke,Ie,Ae)=>be.add(Ie,Ae),ve=(ke,Ie,Ae)=>be.remove(Ie,Ae);we.setCustomProperty("addHighlight",xe,Te),we.setCustomProperty("removeHighlight",ve,Te)}function setLabel(Te,we){Te.getCustomProperty("widgetLabel").push(we)}function getLabel(Te){return Te.getCustomProperty("widgetLabel").reduce((t,te)=>typeof te=="function"?t?t+". "+te():te():t?t+". "+te:te,"")}function toWidgetEditable(Te,we,t={}){return we.addClass(["ck-editor__editable","ck-editor__nested-editable"],Te),we.setAttribute("role","textbox",Te),we.setAttribute("tabindex","-1",Te),t.label&&we.setAttribute("aria-label",t.label,Te),we.setAttribute("contenteditable",Te.isReadOnly?"false":"true",Te),Te.on("change:isReadOnly",(te,be,xe)=>{we.setAttribute("contenteditable",xe?"false":"true",Te)}),Te.on("change:isFocused",(te,be,xe)=>{xe?we.addClass("ck-editor__nested-editable_focused",Te):we.removeClass("ck-editor__nested-editable_focused",Te)}),setHighlightHandling(Te,we),Te}function findOptimalInsertionRange(Te,we){const t=Te.getSelectedElement();if(t){const te=getTypeAroundFakeCaretPosition(Te);if(te)return we.createRange(we.createPositionAt(t,te))}return we.schema.findOptimalInsertionRange(Te)}function getFillerOffset(){return null}function addSelectionHandle(Te,we){const t=we.createUIElement("div",{class:"ck ck-widget__selection-handle"},function(te){const be=this.toDomElement(te),xe=new IconView;return xe.set("content",dragHandleIcon),xe.render(),be.appendChild(xe.element),be});we.insert(we.createPositionAt(Te,0),t),we.addClass(["ck-widget_with-selection-handle"],Te)}function calculateResizeHostAncestorWidth(Te){const we=ke=>{const{width:Ie,paddingLeft:Ae,paddingRight:Se}=ke.ownerDocument.defaultView.getComputedStyle(ke);return parseFloat(Ie)-(parseFloat(Ae)||0)-(parseFloat(Se)||0)},t=Te.parentElement;if(!t)return 0;let te=we(t);const be=5;let xe=0,ve=t;for(;isNaN(te);){if(ve=ve.parentElement,++xe>be)return 0;te=we(ve)}return te}function calculateResizeHostPercentageWidth(Te,we=new Rect(Te)){const t=calculateResizeHostAncestorWidth(Te);return t?we.width/t*100:0}const TYPE_AROUND_SELECTION_ATTRIBUTE="widget-type-around";function isTypeAroundWidget(Te,we,t){return!!Te&&isWidget(Te)&&!t.isInline(we)}function getClosestTypeAroundDomButton(Te){return Te.closest(".ck-widget__type-around__button")}function getTypeAroundButtonPosition(Te){return Te.classList.contains("ck-widget__type-around__button_before")?"before":"after"}function getClosestWidgetViewElement(Te,we){const t=Te.closest(".ck-widget");return we.mapDomToView(t)}function getTypeAroundFakeCaretPosition(Te){return Te.getAttribute(TYPE_AROUND_SELECTION_ATTRIBUTE)}var returnIcon='<svg viewBox="0 0 10 8" xmlns="http://www.w3.org/2000/svg"><path d="M9.055.263v3.972h-6.77M1 4.216l2-2.038m-2 2 2 2.038"/></svg>';const POSSIBLE_INSERTION_POSITIONS=["before","after"],RETURN_ARROW_ICON_ELEMENT=new DOMParser().parseFromString(returnIcon,"image/svg+xml").firstChild,PLUGIN_DISABLED_EDITING_ROOT_CLASS="ck-widget__type-around_disabled";class WidgetTypeAround extends Plugin{constructor(){super(...arguments);Re(this,"_currentFakeCaretModelElement",null)}static get pluginName(){return"WidgetTypeAround"}static get requires(){return[Enter,Delete]}init(){const t=this.editor,te=t.editing.view;this.on("change:isEnabled",(be,xe,ve)=>{te.change(ke=>{for(const Ie of te.document.roots)ve?ke.removeClass(PLUGIN_DISABLED_EDITING_ROOT_CLASS,Ie):ke.addClass(PLUGIN_DISABLED_EDITING_ROOT_CLASS,Ie)}),ve||t.model.change(ke=>{ke.removeSelectionAttribute(TYPE_AROUND_SELECTION_ATTRIBUTE)})}),this._enableTypeAroundUIInjection(),this._enableInsertingParagraphsOnButtonClick(),this._enableInsertingParagraphsOnEnterKeypress(),this._enableInsertingParagraphsOnTypingKeystroke(),this._enableTypeAroundFakeCaretActivationUsingKeyboardArrows(),this._enableDeleteIntegration(),this._enableInsertContentIntegration(),this._enableInsertObjectIntegration(),this._enableDeleteContentIntegration()}destroy(){super.destroy(),this._currentFakeCaretModelElement=null}_insertParagraph(t,te){const be=this.editor,xe=be.editing.view,ve=be.model.schema.getAttributesWithProperty(t,"copyOnReplace",!0);be.execute("insertParagraph",{position:be.model.createPositionAt(t,te),attributes:ve}),xe.focus(),xe.scrollToTheSelection()}_listenToIfEnabled(t,te,be,xe){this.listenTo(t,te,(...ve)=>{this.isEnabled&&be(...ve)},xe)}_insertParagraphAccordingToFakeCaretPosition(){const be=this.editor.model.document.selection,xe=getTypeAroundFakeCaretPosition(be);if(!xe)return!1;const ve=be.getSelectedElement();return this._insertParagraph(ve,xe),!0}_enableTypeAroundUIInjection(){const t=this.editor,te=t.model.schema,be=t.locale.t,xe={before:be("Insert paragraph before block"),after:be("Insert paragraph after block")};t.editing.downcastDispatcher.on("insert",(ve,ke,Ie)=>{const Ae=Ie.mapper.toViewElement(ke.item);Ae&&isTypeAroundWidget(Ae,ke.item,te)&&(injectUIIntoWidget(Ie.writer,xe,Ae),Ae.getCustomProperty("widgetLabel").push(()=>this.isEnabled?be("Press Enter to type after or press Shift + Enter to type before the widget"):""))},{priority:"low"})}_enableTypeAroundFakeCaretActivationUsingKeyboardArrows(){const t=this.editor,te=t.model,be=te.document.selection,xe=te.schema,ve=t.editing.view;this._listenToIfEnabled(ve.document,"arrowKey",(Ie,Ae)=>{this._handleArrowKeyPress(Ie,Ae)},{context:[isWidget,"$text"],priority:"high"}),this._listenToIfEnabled(be,"change:range",(Ie,Ae)=>{Ae.directChange&&t.model.change(Se=>{Se.removeSelectionAttribute(TYPE_AROUND_SELECTION_ATTRIBUTE)})}),this._listenToIfEnabled(te.document,"change:data",()=>{const Ie=be.getSelectedElement();if(Ie){const Ae=t.editing.mapper.toViewElement(Ie);if(isTypeAroundWidget(Ae,Ie,xe))return}t.model.change(Ae=>{Ae.removeSelectionAttribute(TYPE_AROUND_SELECTION_ATTRIBUTE)})}),this._listenToIfEnabled(t.editing.downcastDispatcher,"selection",(Ie,Ae,Se)=>{const Oe=Se.writer;if(this._currentFakeCaretModelElement){const Fe=Se.mapper.toViewElement(this._currentFakeCaretModelElement);Fe&&(Oe.removeClass(POSSIBLE_INSERTION_POSITIONS.map(ke),Fe),this._currentFakeCaretModelElement=null)}const Ve=Ae.selection.getSelectedElement();if(!Ve)return;const Me=Se.mapper.toViewElement(Ve);if(!isTypeAroundWidget(Me,Ve,xe))return;const De=getTypeAroundFakeCaretPosition(Ae.selection);De&&(Oe.addClass(ke(De),Me),this._currentFakeCaretModelElement=Ve)}),this._listenToIfEnabled(t.ui.focusTracker,"change:isFocused",(Ie,Ae,Se)=>{Se||t.model.change(Oe=>{Oe.removeSelectionAttribute(TYPE_AROUND_SELECTION_ATTRIBUTE)})});function ke(Ie){return`ck-widget_type-around_show-fake-caret_${Ie}`}}_handleArrowKeyPress(t,te){const be=this.editor,xe=be.model,ve=xe.document.selection,ke=xe.schema,Ie=be.editing.view,Ae=te.keyCode,Se=isForwardArrowKeyCode(Ae,be.locale.contentLanguageDirection),Oe=Ie.document.selection.getSelectedElement(),Ve=be.editing.mapper.toModelElement(Oe);let Me;isTypeAroundWidget(Oe,Ve,ke)?Me=this._handleArrowKeyPressOnSelectedWidget(Se):ve.isCollapsed?Me=this._handleArrowKeyPressWhenSelectionNextToAWidget(Se):te.shiftKey||(Me=this._handleArrowKeyPressWhenNonCollapsedSelection(Se)),Me&&(te.preventDefault(),t.stop())}_handleArrowKeyPressOnSelectedWidget(t){const be=this.editor.model,xe=be.document.selection,ve=getTypeAroundFakeCaretPosition(xe);return be.change(ke=>{if(ve){if(!(ve===(t?"after":"before")))return ke.removeSelectionAttribute(TYPE_AROUND_SELECTION_ATTRIBUTE),!0}else return ke.setSelectionAttribute(TYPE_AROUND_SELECTION_ATTRIBUTE,t?"after":"before"),!0;return!1})}_handleArrowKeyPressWhenSelectionNextToAWidget(t){const te=this.editor,be=te.model,xe=be.schema,ve=te.plugins.get("Widget"),ke=ve._getObjectElementNextToSelection(t),Ie=te.editing.mapper.toViewElement(ke);return isTypeAroundWidget(Ie,ke,xe)?(be.change(Ae=>{ve._setSelectionOverElement(ke),Ae.setSelectionAttribute(TYPE_AROUND_SELECTION_ATTRIBUTE,t?"before":"after")}),!0):!1}_handleArrowKeyPressWhenNonCollapsedSelection(t){const te=this.editor,be=te.model,xe=be.schema,ve=te.editing.mapper,ke=be.document.selection,Ie=t?ke.getLastPosition().nodeBefore:ke.getFirstPosition().nodeAfter,Ae=ve.toViewElement(Ie);return isTypeAroundWidget(Ae,Ie,xe)?(be.change(Se=>{Se.setSelection(Ie,"on"),Se.setSelectionAttribute(TYPE_AROUND_SELECTION_ATTRIBUTE,t?"after":"before")}),!0):!1}_enableInsertingParagraphsOnButtonClick(){const t=this.editor,te=t.editing.view;this._listenToIfEnabled(te.document,"mousedown",(be,xe)=>{const ve=getClosestTypeAroundDomButton(xe.domTarget);if(!ve)return;const ke=getTypeAroundButtonPosition(ve),Ie=getClosestWidgetViewElement(ve,te.domConverter),Ae=t.editing.mapper.toModelElement(Ie);this._insertParagraph(Ae,ke),xe.preventDefault(),be.stop()})}_enableInsertingParagraphsOnEnterKeypress(){const t=this.editor,te=t.model.document.selection,be=t.editing.view;this._listenToIfEnabled(be.document,"enter",(xe,ve)=>{if(xe.eventPhase!="atTarget")return;const ke=te.getSelectedElement(),Ie=t.editing.mapper.toViewElement(ke),Ae=t.model.schema;let Se;this._insertParagraphAccordingToFakeCaretPosition()?Se=!0:isTypeAroundWidget(Ie,ke,Ae)&&(this._insertParagraph(ke,ve.isSoft?"before":"after"),Se=!0),Se&&(ve.preventDefault(),xe.stop())},{context:isWidget})}_enableInsertingParagraphsOnTypingKeystroke(){const te=this.editor.editing.view.document;this._listenToIfEnabled(te,"insertText",(be,xe)=>{this._insertParagraphAccordingToFakeCaretPosition()&&(xe.selection=te.selection)},{priority:"high"}),env.isAndroid?this._listenToIfEnabled(te,"keydown",(be,xe)=>{xe.keyCode==229&&this._insertParagraphAccordingToFakeCaretPosition()}):this._listenToIfEnabled(te,"compositionstart",()=>{this._insertParagraphAccordingToFakeCaretPosition()},{priority:"high"})}_enableDeleteIntegration(){const t=this.editor,te=t.editing.view,be=t.model,xe=be.schema;this._listenToIfEnabled(te.document,"delete",(ve,ke)=>{if(ve.eventPhase!="atTarget")return;const Ie=getTypeAroundFakeCaretPosition(be.document.selection);if(!Ie)return;const Ae=ke.direction,Se=be.document.selection.getSelectedElement(),Oe=Ie==="before",Ve=Ae=="forward";if(Oe===Ve)t.execute("delete",{selection:be.createSelection(Se,"on")});else{const De=xe.getNearestSelectionRange(be.createPositionAt(Se,Ie),Ae);if(De)if(!De.isCollapsed)be.change(Fe=>{Fe.setSelection(De),t.execute(Ve?"deleteForward":"delete")});else{const Fe=be.createSelection(De.start);if(be.modifySelection(Fe,{direction:Ae}),!Fe.focus.isEqual(De.start))be.change(Be=>{Be.setSelection(De),t.execute(Ve?"deleteForward":"delete")});else{const Be=getDeepestEmptyElementAncestor(xe,De.start.parent);be.deleteContent(be.createSelection(Be,"on"),{doNotAutoparagraph:!0})}}}ke.preventDefault(),ve.stop()},{context:isWidget})}_enableInsertContentIntegration(){const t=this.editor,te=this.editor.model,be=te.document.selection;this._listenToIfEnabled(t.model,"insertContent",(xe,[ve,ke])=>{if(ke&&!ke.is("documentSelection"))return;const Ie=getTypeAroundFakeCaretPosition(be);if(Ie)return xe.stop(),te.change(Ae=>{const Se=be.getSelectedElement(),Oe=te.createPositionAt(Se,Ie),Ve=Ae.createSelection(Oe),Me=te.insertContent(ve,Ve);return Ae.setSelection(Ve),Me})},{priority:"high"})}_enableInsertObjectIntegration(){const t=this.editor,be=this.editor.model.document.selection;this._listenToIfEnabled(t.model,"insertObject",(xe,ve)=>{const[,ke,Ie={}]=ve;if(ke&&!ke.is("documentSelection"))return;const Ae=getTypeAroundFakeCaretPosition(be);Ae&&(Ie.findOptimalPosition=Ae,ve[3]=Ie)},{priority:"high"})}_enableDeleteContentIntegration(){const t=this.editor,be=this.editor.model.document.selection;this._listenToIfEnabled(t.model,"deleteContent",(xe,[ve])=>{if(ve&&!ve.is("documentSelection"))return;getTypeAroundFakeCaretPosition(be)&&xe.stop()},{priority:"high"})}}function injectUIIntoWidget(Te,we,t){const te=Te.createUIElement("div",{class:"ck ck-reset_all ck-widget__type-around"},function(be){const xe=this.toDomElement(be);return injectButtons(xe,we),injectFakeCaret(xe),xe});Te.insert(Te.createPositionAt(t,"end"),te)}function injectButtons(Te,we){for(const t of POSSIBLE_INSERTION_POSITIONS){const te=new Template({tag:"div",attributes:{class:["ck","ck-widget__type-around__button",`ck-widget__type-around__button_${t}`],title:we[t],"aria-hidden":"true"},children:[Te.ownerDocument.importNode(RETURN_ARROW_ICON_ELEMENT,!0)]});Te.appendChild(te.render())}}function injectFakeCaret(Te){const we=new Template({tag:"div",attributes:{class:["ck","ck-widget__type-around__fake-caret"]}});Te.appendChild(we.render())}function getDeepestEmptyElementAncestor(Te,we){let t=we;for(const te of we.getAncestors({parentFirst:!0})){if(te.childCount>1||Te.isLimit(te))break;t=te}return t}function verticalNavigationHandler(Te){const we=Te.model;return(t,te)=>{const be=te.keyCode==keyCodes.arrowup,xe=te.keyCode==keyCodes.arrowdown,ve=te.shiftKey,ke=we.document.selection;if(!be&&!xe)return;const Ie=xe;if(ve&&selectionWillShrink(ke,Ie))return;const Ae=findTextRangeFromSelection(Te,ke,Ie);if(Ae){if(Ae.isCollapsed){if(ke.isCollapsed)return;if(ve)return}(Ae.isCollapsed||isSingleLineRange(Te,Ae,Ie))&&(we.change(Se=>{const Oe=Ie?Ae.end:Ae.start;if(ve){const Ve=we.createSelection(ke.anchor);Ve.setFocus(Oe),Se.setSelection(Ve)}else Se.setSelection(Oe)}),t.stop(),te.preventDefault(),te.stopPropagation())}}}function findTextRangeFromSelection(Te,we,t){const te=Te.model;if(t){const be=we.isCollapsed?we.focus:we.getLastPosition(),xe=getNearestNonInlineLimit(te,be,"forward");if(!xe)return null;const ve=te.createRange(be,xe),ke=getNearestTextPosition(te.schema,ve,"backward");return ke?te.createRange(be,ke):null}else{const be=we.isCollapsed?we.focus:we.getFirstPosition(),xe=getNearestNonInlineLimit(te,be,"backward");if(!xe)return null;const ve=te.createRange(xe,be),ke=getNearestTextPosition(te.schema,ve,"forward");return ke?te.createRange(ke,be):null}}function getNearestNonInlineLimit(Te,we,t){const te=Te.schema,be=Te.createRangeIn(we.root),xe=t=="forward"?"elementStart":"elementEnd";for(const{previousPosition:ve,item:ke,type:Ie}of be.getWalker({startPosition:we,direction:t})){if(te.isLimit(ke)&&!te.isInline(ke))return ve;if(Ie==xe&&te.isBlock(ke))return null}return null}function getNearestTextPosition(Te,we,t){const te=t=="backward"?we.end:we.start;if(Te.checkChild(te,"$text"))return te;for(const{nextPosition:be}of we.getWalker({direction:t}))if(Te.checkChild(be,"$text"))return be;return null}function isSingleLineRange(Te,we,t){const te=Te.model,be=Te.view.domConverter;if(t){const Ae=te.createSelection(we.start);te.modifySelection(Ae),!Ae.focus.isAtEnd&&!we.start.isEqual(Ae.focus)&&(we=te.createRange(Ae.focus,we.end))}const xe=Te.mapper.toViewRange(we),ve=be.viewRangeToDom(xe),ke=Rect.getDomRangeRects(ve);let Ie;for(const Ae of ke){if(Ie===void 0){Ie=Math.round(Ae.bottom);continue}if(Math.round(Ae.top)>=Ie)return!1;Ie=Math.max(Ie,Math.round(Ae.bottom))}return!0}function selectionWillShrink(Te,we){return!Te.isCollapsed&&Te.isBackward==we}class Widget extends Plugin{constructor(){super(...arguments);Re(this,"_previouslySelected",new Set)}static get pluginName(){return"Widget"}static get requires(){return[WidgetTypeAround,Delete]}init(){const t=this.editor,te=t.editing.view,be=te.document,xe=t.t;this.editor.editing.downcastDispatcher.on("selection",(ve,ke,Ie)=>{const Ae=Ie.writer,Se=ke.selection;if(Se.isCollapsed)return;const Oe=Se.getSelectedElement();if(!Oe)return;const Ve=t.editing.mapper.toViewElement(Oe);isWidget(Ve)&&Ie.consumable.consume(Se,"selection")&&Ae.setSelection(Ae.createRangeOn(Ve),{fake:!0,label:getLabel(Ve)})}),this.editor.editing.downcastDispatcher.on("selection",(ve,ke,Ie)=>{this._clearPreviouslySelectedWidgets(Ie.writer);const Ae=Ie.writer,Se=Ae.document.selection;let Oe=null;for(const Ve of Se.getRanges())for(const Me of Ve){const De=Me.item;isWidget(De)&&!isChild(De,Oe)&&(Ae.addClass(WIDGET_SELECTED_CLASS_NAME,De),this._previouslySelected.add(De),Oe=De)}},{priority:"low"}),te.addObserver(MouseObserver),this.listenTo(be,"mousedown",(...ve)=>this._onMousedown(...ve)),this.listenTo(be,"arrowKey",(...ve)=>{this._handleSelectionChangeOnArrowKeyPress(...ve)},{context:[isWidget,"$text"]}),this.listenTo(be,"arrowKey",(...ve)=>{this._preventDefaultOnArrowKeyPress(...ve)},{context:"$root"}),this.listenTo(be,"arrowKey",verticalNavigationHandler(this.editor.editing),{context:"$text"}),this.listenTo(be,"delete",(ve,ke)=>{this._handleDelete(ke.direction=="forward")&&(ke.preventDefault(),ve.stop())},{context:"$root"}),this.listenTo(be,"tab",(ve,ke)=>{ve.eventPhase=="atTarget"&&(ke.shiftKey||this._selectFirstNestedEditable()&&(ke.preventDefault(),ve.stop()))},{context:isWidget,priority:"low"}),this.listenTo(be,"tab",(ve,ke)=>{ke.shiftKey&&this._selectAncestorWidget()&&(ke.preventDefault(),ve.stop())},{priority:"low"}),this.listenTo(be,"keydown",(ve,ke)=>{ke.keystroke==keyCodes.esc&&this._selectAncestorWidget()&&(ke.preventDefault(),ve.stop())},{priority:"low"}),t.accessibility.addKeystrokeInfoGroup({id:"widget",label:xe("Keystrokes that can be used when a widget is selected (for example: image, table, etc.)"),keystrokes:[{label:xe("Move focus from an editable area back to the parent widget"),keystroke:"Esc"},{label:xe("Insert a new paragraph directly after a widget"),keystroke:"Enter"},{label:xe("Insert a new paragraph directly before a widget"),keystroke:"Shift+Enter"},{label:xe("Move the caret to allow typing directly before a widget"),keystroke:[["arrowup"],["arrowleft"]]},{label:xe("Move the caret to allow typing directly after a widget"),keystroke:[["arrowdown"],["arrowright"]]}]})}_onMousedown(t,te){const be=this.editor,xe=be.editing.view,ve=xe.document;let ke=te.target;if(te.domEvent.detail>=3){this._selectBlockContent(ke)&&te.preventDefault();return}if(isInsideNestedEditable(ke)||!isWidget(ke)&&(ke=ke.findAncestor(isWidget),!ke))return;env.isAndroid&&te.preventDefault(),ve.isFocused||xe.focus();const Ie=be.editing.mapper.toModelElement(ke);this._setSelectionOverElement(Ie)}_selectBlockContent(t){const te=this.editor,be=te.model,xe=te.editing.mapper,ve=be.schema,ke=xe.findMappedViewAncestor(this.editor.editing.view.createPositionAt(t,0)),Ie=findTextBlockAncestor(xe.toModelElement(ke),be.schema);return Ie?(be.change(Ae=>{const Se=ve.isLimit(Ie)?null:findNextTextBlock(Ae.createPositionAfter(Ie),ve),Oe=Ae.createPositionAt(Ie,0),Ve=Se?Ae.createPositionAt(Se,0):Ae.createPositionAt(Ie,"end");Ae.setSelection(Ae.createRange(Oe,Ve))}),!0):!1}_handleSelectionChangeOnArrowKeyPress(t,te){const be=te.keyCode,xe=this.editor.model,ve=xe.schema,ke=xe.document.selection,Ie=ke.getSelectedElement(),Ae=getLocalizedArrowKeyCodeDirection(be,this.editor.locale.contentLanguageDirection),Se=Ae=="down"||Ae=="right",Oe=Ae=="up"||Ae=="down";if(Ie&&ve.isObject(Ie)){const Me=Se?ke.getLastPosition():ke.getFirstPosition(),De=ve.getNearestSelectionRange(Me,Se?"forward":"backward");De&&(xe.change(Fe=>{Fe.setSelection(De)}),te.preventDefault(),t.stop());return}if(!ke.isCollapsed&&!te.shiftKey){const Me=ke.getFirstPosition(),De=ke.getLastPosition(),Fe=Me.nodeAfter,Be=De.nodeBefore;(Fe&&ve.isObject(Fe)||Be&&ve.isObject(Be))&&(xe.change($e=>{$e.setSelection(Se?De:Me)}),te.preventDefault(),t.stop());return}if(!ke.isCollapsed)return;const Ve=this._getObjectElementNextToSelection(Se);if(Ve&&ve.isObject(Ve)){if(ve.isInline(Ve)&&Oe)return;this._setSelectionOverElement(Ve),te.preventDefault(),t.stop()}}_preventDefaultOnArrowKeyPress(t,te){const be=this.editor.model,xe=be.schema,ve=be.document.selection.getSelectedElement();ve&&xe.isObject(ve)&&(te.preventDefault(),t.stop())}_handleDelete(t){const be=this.editor.model.document.selection;if(!this.editor.model.canEditAt(be)||!be.isCollapsed)return;const xe=this._getObjectElementNextToSelection(t);if(xe)return this.editor.model.change(ve=>{let ke=be.anchor.parent;for(;ke.isEmpty;){const Ie=ke;ke=Ie.parent,ve.remove(Ie)}this._setSelectionOverElement(xe)}),!0}_setSelectionOverElement(t){this.editor.model.change(te=>{te.setSelection(te.createRangeOn(t))})}_getObjectElementNextToSelection(t){const te=this.editor.model,be=te.schema,xe=te.document.selection,ve=te.createSelection(xe);if(te.modifySelection(ve,{direction:t?"forward":"backward"}),ve.isEqual(xe))return null;const ke=t?ve.focus.nodeBefore:ve.focus.nodeAfter;return ke&&be.isObject(ke)?ke:null}_clearPreviouslySelectedWidgets(t){for(const te of this._previouslySelected)t.removeClass(WIDGET_SELECTED_CLASS_NAME,te);this._previouslySelected.clear()}_selectFirstNestedEditable(){const t=this.editor,be=this.editor.editing.view.document;for(const xe of be.selection.getFirstRange().getItems())if(xe.is("editableElement")){const ve=t.editing.mapper.toModelElement(xe);/* istanbul ignore next -- @preserve */if(!ve)continue;const ke=t.model.createPositionAt(ve,0),Ie=t.model.schema.getNearestSelectionRange(ke,"forward");return t.model.change(Ae=>{Ae.setSelection(Ie)}),!0}return!1}_selectAncestorWidget(){const t=this.editor,te=t.editing.mapper,xe=t.editing.view.document.selection.getFirstPosition().parent,ke=(xe.is("$text")?xe.parent:xe).findAncestor(isWidget);if(!ke)return!1;const Ie=te.toModelElement(ke);/* istanbul ignore next -- @preserve */return Ie?(t.model.change(Ae=>{Ae.setSelection(Ie,"on")}),!0):!1}}function isInsideNestedEditable(Te){let we=Te;for(;we;){if(we.is("editableElement")&&!we.is("rootElement"))return!0;if(isWidget(we))return!1;we=we.parent}return!1}function isChild(Te,we){return we?Array.from(Te.getAncestors()).includes(we):!1}function findTextBlockAncestor(Te,we){for(const t of Te.getAncestors({includeSelf:!0,parentFirst:!0})){if(we.checkChild(t,"$text"))return t;if(we.isLimit(t)&&!we.isObject(t))break}return null}function findNextTextBlock(Te,we){const t=new TreeWalker({startPosition:Te});for(const{item:te}of t){if(we.isLimit(te)||!te.is("element"))return null;if(we.checkChild(te,"$text"))return te}return null}class WidgetToolbarRepository extends Plugin{constructor(){super(...arguments);Re(this,"_toolbarDefinitions",new Map);Re(this,"_balloon")}static get requires(){return[ContextualBalloon]}static get pluginName(){return"WidgetToolbarRepository"}init(){const t=this.editor;if(t.plugins.has("BalloonToolbar")){const te=t.plugins.get("BalloonToolbar");this.listenTo(te,"show",be=>{isWidgetSelected(t.editing.view.document.selection)&&be.stop()},{priority:"high"})}this._balloon=this.editor.plugins.get("ContextualBalloon"),this.on("change:isEnabled",()=>{this._updateToolbarsVisibility()}),this.listenTo(t.ui,"update",()=>{this._updateToolbarsVisibility()}),this.listenTo(t.ui.focusTracker,"change:isFocused",()=>{this._updateToolbarsVisibility()},{priority:"low"})}destroy(){super.destroy();for(const t of this._toolbarDefinitions.values())t.view.destroy()}register(t,{ariaLabel:te,items:be,getRelatedElement:xe,balloonClassName:ve="ck-toolbar-container"}){if(!be.length){logWarning("widget-toolbar-no-items",{toolbarId:t});return}const ke=this.editor,Ie=ke.t,Ae=new ToolbarView(ke.locale);if(Ae.ariaLabel=te||Ie("Widget toolbar"),this._toolbarDefinitions.has(t))throw new CKEditorError("widget-toolbar-duplicated",this,{toolbarId:t});const Se={view:Ae,getRelatedElement:xe,balloonClassName:ve,itemsConfig:be,initialized:!1};ke.ui.addToolbar(Ae,{isContextual:!0,beforeFocus:()=>{const Oe=xe(ke.editing.view.document.selection);Oe&&this._showToolbar(Se,Oe)},afterBlur:()=>{this._hideToolbar(Se)}}),this._toolbarDefinitions.set(t,Se)}_updateToolbarsVisibility(){let t=0,te=null,be=null;for(const xe of this._toolbarDefinitions.values()){const ve=xe.getRelatedElement(this.editor.editing.view.document.selection);if(!this.isEnabled||!ve)this._isToolbarInBalloon(xe)&&this._hideToolbar(xe);else if(!this.editor.ui.focusTracker.isFocused)this._isToolbarVisible(xe)&&this._hideToolbar(xe);else{const ke=ve.getAncestors().length;ke>t&&(t=ke,te=ve,be=xe)}}be&&this._showToolbar(be,te)}_hideToolbar(t){this._balloon.remove(t.view),this.stopListening(this._balloon,"change:visibleView")}_showToolbar(t,te){this._isToolbarVisible(t)?repositionContextualBalloon$2(this.editor,te):this._isToolbarInBalloon(t)||(t.initialized||(t.initialized=!0,t.view.fillFromConfig(t.itemsConfig,this.editor.ui.componentFactory)),this._balloon.add({view:t.view,position:getBalloonPositionData$1(this.editor,te),balloonClassName:t.balloonClassName}),this.listenTo(this._balloon,"change:visibleView",()=>{for(const be of this._toolbarDefinitions.values())if(this._isToolbarVisible(be)){const xe=be.getRelatedElement(this.editor.editing.view.document.selection);repositionContextualBalloon$2(this.editor,xe)}}))}_isToolbarVisible(t){return this._balloon.visibleView===t.view}_isToolbarInBalloon(t){return this._balloon.hasView(t.view)}}function repositionContextualBalloon$2(Te,we){const t=Te.plugins.get("ContextualBalloon"),te=getBalloonPositionData$1(Te,we);t.updatePosition(te)}function getBalloonPositionData$1(Te,we){const t=Te.editing.view,te=BalloonPanelView.defaultPositions;return{target:t.domConverter.mapViewToDom(we),positions:[te.northArrowSouth,te.northArrowSouthWest,te.northArrowSouthEast,te.southArrowNorth,te.southArrowNorthWest,te.southArrowNorthEast,te.viewportStickyNorth]}}function isWidgetSelected(Te){const we=Te.getSelectedElement();return!!(we&&isWidget(we))}class ResizeState extends ObservableMixin(){constructor(t){super();Re(this,"_referenceCoordinates");Re(this,"_options");Re(this,"_originalWidth");Re(this,"_originalHeight");Re(this,"_originalWidthPercents");Re(this,"_aspectRatio");this.set("activeHandlePosition",null),this.set("proposedWidthPercents",null),this.set("proposedWidth",null),this.set("proposedHeight",null),this.set("proposedHandleHostWidth",null),this.set("proposedHandleHostHeight",null),this._options=t,this._referenceCoordinates=null}get originalWidth(){return this._originalWidth}get originalHeight(){return this._originalHeight}get originalWidthPercents(){return this._originalWidthPercents}get aspectRatio(){return this._aspectRatio}begin(t,te,be){const xe=new Rect(te);this.activeHandlePosition=getHandlePosition(t),this._referenceCoordinates=getAbsoluteBoundaryPoint(te,getOppositePosition(this.activeHandlePosition)),this._originalWidth=xe.width,this._originalHeight=xe.height,this._aspectRatio=xe.width/xe.height;const ve=be.style.width;ve&&ve.match(/^\d+(\.\d*)?%$/)?this._originalWidthPercents=parseFloat(ve):this._originalWidthPercents=calculateResizeHostPercentageWidth(be,xe)}update(t){this.proposedWidth=t.width,this.proposedHeight=t.height,this.proposedWidthPercents=t.widthPercents,this.proposedHandleHostWidth=t.handleHostWidth,this.proposedHandleHostHeight=t.handleHostHeight}}function getAbsoluteBoundaryPoint(Te,we){const t=new Rect(Te),te=we.split("-"),be={x:te[1]=="right"?t.right:t.left,y:te[0]=="bottom"?t.bottom:t.top};return be.x+=Te.ownerDocument.defaultView.scrollX,be.y+=Te.ownerDocument.defaultView.scrollY,be}function getResizerHandleClass(Te){return`ck-widget__resizer__handle-${Te}`}function getHandlePosition(Te){const we=["top-left","top-right","bottom-right","bottom-left"];for(const t of we)if(Te.classList.contains(getResizerHandleClass(t)))return t}function getOppositePosition(Te){const we=Te.split("-"),t={top:"bottom",bottom:"top",left:"right",right:"left"};return`${t[we[0]]}-${t[we[1]]}`}class SizeView extends View{constructor(){super();const we=this.bindTemplate;this.setTemplate({tag:"div",attributes:{class:["ck","ck-size-view",we.to("_viewPosition",t=>t?`ck-orientation-${t}`:"")],style:{display:we.if("_isVisible","none",t=>!t)}},children:[{text:we.to("_label")}]})}_bindToState(we,t){this.bind("_isVisible").to(t,"proposedWidth",t,"proposedHeight",(te,be)=>te!==null&&be!==null),this.bind("_label").to(t,"proposedHandleHostWidth",t,"proposedHandleHostHeight",t,"proposedWidthPercents",(te,be,xe)=>we.unit==="px"?`${te}×${be}`:`${xe}%`),this.bind("_viewPosition").to(t,"activeHandlePosition",t,"proposedHandleHostWidth",t,"proposedHandleHostHeight",(te,be,xe)=>be<50||xe<50?"above-center":te)}_dismiss(){this.unbind(),this._isVisible=!1}}class Resizer extends ObservableMixin(){constructor(t){super();Re(this,"_state");Re(this,"_sizeView");Re(this,"_options");Re(this,"_viewResizerWrapper",null);Re(this,"_initialViewWidth");this._options=t,this.set("isEnabled",!0),this.set("isSelected",!1),this.bind("isVisible").to(this,"isEnabled",this,"isSelected",(te,be)=>te&&be),this.decorate("begin"),this.decorate("cancel"),this.decorate("commit"),this.decorate("updateSize"),this.on("commit",te=>{!this.state.proposedWidth&&!this.state.proposedWidthPercents&&(this._cleanup(),te.stop())},{priority:"high"})}get state(){return this._state}show(){this._options.editor.editing.view.change(te=>{te.removeClass("ck-hidden",this._viewResizerWrapper)})}hide(){this._options.editor.editing.view.change(te=>{te.addClass("ck-hidden",this._viewResizerWrapper)})}attach(){const t=this,te=this._options.viewElement;this._options.editor.editing.view.change(xe=>{const ve=xe.createUIElement("div",{class:"ck ck-reset_all ck-widget__resizer"},function(ke){const Ie=this.toDomElement(ke);return t._appendHandles(Ie),t._appendSizeUI(Ie),Ie});xe.insert(xe.createPositionAt(te,"end"),ve),xe.addClass("ck-widget_with-resizer",te),this._viewResizerWrapper=ve,this.isVisible||this.hide()}),this.on("change:isVisible",()=>{this.isVisible?(this.show(),this.redraw()):this.hide()})}begin(t){this._state=new ResizeState(this._options),this._sizeView._bindToState(this._options,this.state),this._initialViewWidth=this._options.viewElement.getStyle("width"),this.state.begin(t,this._getHandleHost(),this._getResizeHost())}updateSize(t){const te=this._proposeNewSize(t);this._options.editor.editing.view.change(Se=>{const Oe=this._options.unit||"%",Ve=(Oe==="%"?te.widthPercents:te.width)+Oe;Se.setStyle("width",Ve,this._options.viewElement)});const xe=this._getHandleHost(),ve=new Rect(xe),ke=Math.round(ve.width),Ie=Math.round(ve.height),Ae=new Rect(xe);te.width=Math.round(Ae.width),te.height=Math.round(Ae.height),this.redraw(ve),this.state.update({...te,handleHostWidth:ke,handleHostHeight:Ie})}commit(){const t=this._options.unit||"%",te=(t==="%"?this.state.proposedWidthPercents:this.state.proposedWidth)+t;this._options.editor.editing.view.change(()=>{this._cleanup(),this._options.onCommit(te)})}cancel(){this._cleanup()}destroy(){this.cancel()}redraw(t){const te=this._domResizerWrapper;if(!existsInDom(te))return;const be=te.parentElement,xe=this._getHandleHost(),ve=this._viewResizerWrapper,ke=[ve.getStyle("width"),ve.getStyle("height"),ve.getStyle("left"),ve.getStyle("top")];let Ie;if(be.isSameNode(xe)){const Ae=t||new Rect(xe);Ie=[Ae.width+"px",Ae.height+"px",void 0,void 0]}else Ie=[xe.offsetWidth+"px",xe.offsetHeight+"px",xe.offsetLeft+"px",xe.offsetTop+"px"];compareArrays(ke,Ie)!=="same"&&this._options.editor.editing.view.change(Ae=>{Ae.setStyle({width:Ie[0],height:Ie[1],left:Ie[2],top:Ie[3]},ve)})}containsHandle(t){return this._domResizerWrapper.contains(t)}static isResizeHandle(t){return t.classList.contains("ck-widget__resizer__handle")}_cleanup(){this._sizeView._dismiss(),this._options.editor.editing.view.change(te=>{te.setStyle("width",this._initialViewWidth,this._options.viewElement)})}_proposeNewSize(t){const te=this.state,be=extractCoordinates(t),xe=this._options.isCentered?this._options.isCentered(this):!0,ve={x:te._referenceCoordinates.x-(be.x+te.originalWidth),y:be.y-te.originalHeight-te._referenceCoordinates.y};xe&&te.activeHandlePosition.endsWith("-right")&&(ve.x=be.x-(te._referenceCoordinates.x+te.originalWidth)),xe&&(ve.x*=2);let ke=Math.abs(te.originalWidth+ve.x),Ie=Math.abs(te.originalHeight+ve.y);return(ke/te.aspectRatio>Ie?"width":"height")=="width"?Ie=ke/te.aspectRatio:ke=Ie*te.aspectRatio,{width:Math.round(ke),height:Math.round(Ie),widthPercents:Math.min(Math.round(te.originalWidthPercents/te.originalWidth*ke*100)/100,100)}}_getResizeHost(){const t=this._domResizerWrapper.parentElement;return this._options.getResizeHost(t)}_getHandleHost(){const t=this._domResizerWrapper.parentElement;return this._options.getHandleHost(t)}get _domResizerWrapper(){return this._options.editor.editing.view.domConverter.mapViewToDom(this._viewResizerWrapper)}_appendHandles(t){const te=["top-left","top-right","bottom-right","bottom-left"];for(const be of te)t.appendChild(new Template({tag:"div",attributes:{class:`ck-widget__resizer__handle ${getResizerClass(be)}`}}).render())}_appendSizeUI(t){this._sizeView=new SizeView,this._sizeView.render(),t.appendChild(this._sizeView.element)}}function getResizerClass(Te){return`ck-widget__resizer__handle-${Te}`}function extractCoordinates(Te){return{x:Te.pageX,y:Te.pageY}}function existsInDom(Te){return Te&&Te.ownerDocument&&Te.ownerDocument.contains(Te)}class WidgetResize extends Plugin{constructor(){super(...arguments);Re(this,"_resizers",new Map);Re(this,"_observer");Re(this,"_redrawSelectedResizerThrottled")}static get pluginName(){return"WidgetResize"}init(){const t=this.editor.editing,te=global.window.document;this.set("selectedResizer",null),this.set("_activeResizer",null),t.view.addObserver(MouseObserver),this._observer=new(DomEmitterMixin()),this.listenTo(t.view.document,"mousedown",this._mouseDownListener.bind(this),{priority:"high"}),this._observer.listenTo(te,"mousemove",this._mouseMoveListener.bind(this)),this._observer.listenTo(te,"mouseup",this._mouseUpListener.bind(this)),this._redrawSelectedResizerThrottled=throttle(()=>this.redrawSelectedResizer(),200),this.editor.ui.on("update",this._redrawSelectedResizerThrottled),this.editor.model.document.on("change",()=>{for(const[xe,ve]of this._resizers)xe.isAttached()||(this._resizers.delete(xe),ve.destroy())},{priority:"lowest"}),this._observer.listenTo(global.window,"resize",this._redrawSelectedResizerThrottled);const be=this.editor.editing.view.document.selection;be.on("change",()=>{const xe=be.getSelectedElement(),ve=this.getResizerByViewElement(xe)||null;ve?this.select(ve):this.deselect()})}redrawSelectedResizer(){this.selectedResizer&&this.selectedResizer.isVisible&&this.selectedResizer.redraw()}destroy(){super.destroy(),this._observer.stopListening();for(const t of this._resizers.values())t.destroy();this._redrawSelectedResizerThrottled.cancel()}select(t){this.deselect(),this.selectedResizer=t,this.selectedResizer.isSelected=!0}deselect(){this.selectedResizer&&(this.selectedResizer.isSelected=!1),this.selectedResizer=null}attachTo(t){const te=new Resizer(t),be=this.editor.plugins;if(te.attach(),be.has("WidgetToolbarRepository")){const ke=be.get("WidgetToolbarRepository");te.on("begin",()=>{ke.forceDisabled("resize")},{priority:"lowest"}),te.on("cancel",()=>{ke.clearForceDisabled("resize")},{priority:"highest"}),te.on("commit",()=>{ke.clearForceDisabled("resize")},{priority:"highest"})}this._resizers.set(t.viewElement,te);const ve=this.editor.editing.view.document.selection.getSelectedElement();return this.getResizerByViewElement(ve)==te&&this.select(te),te}getResizerByViewElement(t){return this._resizers.get(t)}_getResizerByHandle(t){for(const te of this._resizers.values())if(te.containsHandle(t))return te}_mouseDownListener(t,te){const be=te.domTarget;Resizer.isResizeHandle(be)&&(this._activeResizer=this._getResizerByHandle(be)||null,this._activeResizer&&(this._activeResizer.begin(be),t.stop(),te.preventDefault()))}_mouseMoveListener(t,te){this._activeResizer&&this._activeResizer.updateSize(te)}_mouseUpListener(){this._activeResizer&&(this._activeResizer.commit(),this._activeResizer=null)}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class ClipboardObserver extends DomEventObserver{constructor(t){super(t);Re(this,"domEventType",["paste","copy","cut","drop","dragover","dragstart","dragend","dragenter","dragleave"]);const te=this.document;this.listenTo(te,"paste",be("clipboardInput"),{priority:"low"}),this.listenTo(te,"drop",be("clipboardInput"),{priority:"low"}),this.listenTo(te,"dragover",be("dragging"),{priority:"low"});function be(xe){return(ve,ke)=>{ke.preventDefault();const Ie=ke.dropRange?[ke.dropRange]:null,Ae=new EventInfo(te,xe);te.fire(Ae,{dataTransfer:ke.dataTransfer,method:ve.name,targetRanges:Ie,target:ke.target,domEvent:ke.domEvent}),Ae.stop.called&&ke.stopPropagation()}}}onDomEvent(t){const te="clipboardData"in t?t.clipboardData:t.dataTransfer,be=t.type=="drop"||t.type=="paste",xe={dataTransfer:new DataTransfer$1(te,{cacheFiles:be})};(t.type=="drop"||t.type=="dragover")&&(xe.dropRange=getDropViewRange(this.view,t)),this.fire(t.type,t,xe)}}function getDropViewRange(Te,we){const t=we.target.ownerDocument,te=we.clientX,be=we.clientY;let xe;return t.caretRangeFromPoint&&t.caretRangeFromPoint(te,be)?xe=t.caretRangeFromPoint(te,be):we.rangeParent&&(xe=t.createRange(),xe.setStart(we.rangeParent,we.rangeOffset),xe.collapse(!0)),xe?Te.domConverter.domRangeToView(xe):null}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function plainTextToHtml(Te){return Te=Te.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\r?\n\r?\n/g,"</p><p>").replace(/\r?\n/g,"<br>").replace(/\t/g,"&nbsp;&nbsp;&nbsp;&nbsp;").replace(/^\s/,"&nbsp;").replace(/\s$/,"&nbsp;").replace(/\s\s/g," &nbsp;"),(Te.includes("</p><p>")||Te.includes("<br>"))&&(Te=`<p>${Te}</p>`),Te}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function normalizeClipboardData(Te){return Te.replace(/<span(?: class="Apple-converted-space"|)>(\s+)<\/span>/g,(we,t)=>t.length==1?" ":t).replace(/<!--[\s\S]*?-->/g,"")}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const smallPaddingElements=["figcaption","li"],listElements=["ol","ul"];function viewToPlainText(Te){if(Te.is("$text")||Te.is("$textProxy"))return Te.data;if(Te.is("element","img")&&Te.hasAttribute("alt"))return Te.getAttribute("alt");if(Te.is("element","br"))return`
`;let we="",t=null;for(const te of Te.getChildren())we+=newLinePadding(te,t)+viewToPlainText(te),t=te;return we}function newLinePadding(Te,we){return we?Te.is("element","li")&&!Te.isEmpty&&Te.getChild(0).is("containerElement")||listElements.includes(Te.name)&&listElements.includes(we.name)?`

`:!Te.is("containerElement")&&!we.is("containerElement")?"":smallPaddingElements.includes(Te.name)||smallPaddingElements.includes(we.name)?`
`:`

`:""}class ClipboardMarkersUtils extends Plugin{constructor(){super(...arguments);Re(this,"_markersToCopy",new Map)}static get pluginName(){return"ClipboardMarkersUtils"}_registerMarkerToCopy(t,te){this._markersToCopy.set(t,te)}_copySelectedFragmentWithMarkers(t,te,be=xe=>xe.model.getSelectedContent(xe.model.document.selection)){return this.editor.model.change(xe=>{const ve=xe.model.document.selection;xe.setSelection(te);const ke=this._insertFakeMarkersIntoSelection(xe,xe.model.document.selection,t),Ie=be(xe),Ae=this._removeFakeMarkersInsideElement(xe,Ie);for(const[Se,Oe]of Object.entries(ke)){Ae[Se]||(Ae[Se]=xe.createRangeIn(Ie));for(const Ve of Oe)xe.remove(Ve)}Ie.markers.clear();for(const[Se,Oe]of Object.entries(Ae))Ie.markers.set(Se,Oe);return xe.setSelection(ve),Ie})}_pasteMarkersIntoTransformedElement(t,te){const be=this._getPasteMarkersFromRangeMap(t);return this.editor.model.change(xe=>{const ve=this._insertFakeMarkersElements(xe,be),ke=te(xe),Ie=this._removeFakeMarkersInsideElement(xe,ke);for(const Ae of Object.values(ve).flat())xe.remove(Ae);for(const[Ae,Se]of Object.entries(Ie))xe.model.markers.has(Ae)||xe.addMarker(Ae,{usingOperation:!0,affectsData:!0,range:Se});return ke})}_pasteFragmentWithMarkers(t){const te=this._getPasteMarkersFromRangeMap(t.markers);t.markers.clear();for(const be of te)t.markers.set(be.name,be.range);return this.editor.model.insertContent(t)}_forceMarkersCopy(t,te,be={allowedActions:"all",copyPartiallySelected:!0,duplicateOnPaste:!0}){const xe=this._markersToCopy.get(t);this._markersToCopy.set(t,be),te(),xe?this._markersToCopy.set(t,xe):this._markersToCopy.delete(t)}_isMarkerCopyable(t,te){const be=this._getMarkerClipboardConfig(t);if(!be)return!1;if(!te)return!0;const{allowedActions:xe}=be;return xe==="all"||xe.includes(te)}_hasMarkerConfiguration(t){return!!this._getMarkerClipboardConfig(t)}_getMarkerClipboardConfig(t){const[te]=t.split(":");return this._markersToCopy.get(te)||null}_insertFakeMarkersIntoSelection(t,te,be){const xe=this._getCopyableMarkersFromSelection(t,te,be);return this._insertFakeMarkersElements(t,xe)}_getCopyableMarkersFromSelection(t,te,be){const xe=Array.from(te.getRanges()),ve=new Set(xe.flatMap(Ie=>Array.from(t.model.markers.getMarkersIntersectingRange(Ie)))),ke=Ie=>{if(!this._isMarkerCopyable(Ie.name,be))return!1;const{copyPartiallySelected:Se}=this._getMarkerClipboardConfig(Ie.name);if(!Se){const Oe=Ie.getRange();return xe.some(Ve=>Ve.containsRange(Oe,!0))}return!0};return Array.from(ve).filter(ke).map(Ie=>({name:be==="dragstart"?this._getUniqueMarkerName(Ie.name):Ie.name,range:Ie.getRange()}))}_getPasteMarkersFromRangeMap(t,te=null){const{model:be}=this.editor;return(t instanceof Map?Array.from(t.entries()):Object.entries(t)).flatMap(([ve,ke])=>{if(!this._hasMarkerConfiguration(ve))return[{name:ve,range:ke}];if(this._isMarkerCopyable(ve,te)){const Ie=this._getMarkerClipboardConfig(ve),Ae=be.markers.has(ve)&&be.markers.get(ve).getRange().root.rootName==="$graveyard";return(Ie.duplicateOnPaste||Ae)&&(ve=this._getUniqueMarkerName(ve)),[{name:ve,range:ke}]}return[]})}_insertFakeMarkersElements(t,te){const be={},xe=te.flatMap(ve=>{const{start:ke,end:Ie}=ve.range;return[{position:ke,marker:ve,type:"start"},{position:Ie,marker:ve,type:"end"}]}).sort(({position:ve},{position:ke})=>ve.isBefore(ke)?1:-1);for(const{position:ve,marker:ke,type:Ie}of xe){const Ae=t.createElement("$marker",{"data-name":ke.name,"data-type":Ie});be[ke.name]||(be[ke.name]=[]),be[ke.name].push(Ae),t.insert(Ae,ve)}return be}_removeFakeMarkersInsideElement(t,te){const xe=this._getAllFakeMarkersFromElement(t,te).reduce((ve,ke)=>{const Ie=ke.markerElement&&t.createPositionBefore(ke.markerElement);let Ae=ve[ke.name],Se=!1;return Ae&&Ae.start&&Ae.end&&(this._getMarkerClipboardConfig(ke.name).duplicateOnPaste?ve[this._getUniqueMarkerName(ke.name)]=ve[ke.name]:Se=!0,Ae=null),Se||(ve[ke.name]={...Ae,[ke.type]:Ie}),ke.markerElement&&t.remove(ke.markerElement),ve},{});return mapValues(xe,ve=>new Range(ve.start||t.createPositionFromPath(te,[0]),ve.end||t.createPositionAt(te,"end")))}_getAllFakeMarkersFromElement(t,te){const be=Array.from(t.createRangeIn(te)).flatMap(({item:ke})=>{if(!ke.is("element","$marker"))return[];const Ie=ke.getAttribute("data-name"),Ae=ke.getAttribute("data-type");return[{markerElement:ke,name:Ie,type:Ae}]}),xe=[],ve=[];for(const ke of be)ke.type==="end"&&(be.some(Ae=>Ae.name===ke.name&&Ae.type==="start")||xe.push({markerElement:null,name:ke.name,type:"start"})),ke.type==="start"&&(be.some(Ae=>Ae.name===ke.name&&Ae.type==="end")||ve.unshift({markerElement:null,name:ke.name,type:"end"}));return[...xe,...be,...ve]}_getUniqueMarkerName(t){const te=t.split(":"),be=uid().substring(1,6);return te.length===3?`${te.slice(0,2).join(":")}:${be}`:`${te.join(":")}:${be}`}}class ClipboardPipeline extends Plugin{static get pluginName(){return"ClipboardPipeline"}static get requires(){return[ClipboardMarkersUtils]}init(){this.editor.editing.view.addObserver(ClipboardObserver),this._setupPasteDrop(),this._setupCopyCut()}_fireOutputTransformationEvent(we,t,te){const be=this.editor.plugins.get("ClipboardMarkersUtils");this.editor.model.enqueueChange({isUndoable:te==="cut"},()=>{const xe=be._copySelectedFragmentWithMarkers(te,t);this.fire("outputTransformation",{dataTransfer:we,content:xe,method:te})})}_setupPasteDrop(){const we=this.editor,t=we.model,te=we.editing.view,be=te.document,xe=this.editor.plugins.get("ClipboardMarkersUtils");this.listenTo(be,"clipboardInput",(ve,ke)=>{ke.method=="paste"&&!we.model.canEditAt(we.model.document.selection)&&ve.stop()},{priority:"highest"}),this.listenTo(be,"clipboardInput",(ve,ke)=>{const Ie=ke.dataTransfer;let Ae;if(ke.content)Ae=ke.content;else{let Oe="";Ie.getData("text/html")?Oe=normalizeClipboardData(Ie.getData("text/html")):Ie.getData("text/plain")&&(Oe=plainTextToHtml(Ie.getData("text/plain"))),Ae=this.editor.data.htmlProcessor.toView(Oe)}const Se=new EventInfo(this,"inputTransformation");this.fire(Se,{content:Ae,dataTransfer:Ie,targetRanges:ke.targetRanges,method:ke.method}),Se.stop.called&&ve.stop(),te.scrollToTheSelection()},{priority:"low"}),this.listenTo(this,"inputTransformation",(ve,ke)=>{if(ke.content.isEmpty)return;const Ae=this.editor.data.toModel(ke.content,"$clipboardHolder");Ae.childCount!=0&&(ve.stop(),t.change(()=>{this.fire("contentInsertion",{content:Ae,method:ke.method,dataTransfer:ke.dataTransfer,targetRanges:ke.targetRanges})}))},{priority:"low"}),this.listenTo(this,"contentInsertion",(ve,ke)=>{ke.resultRange=xe._pasteFragmentWithMarkers(ke.content)},{priority:"low"})}_setupCopyCut(){const we=this.editor,t=we.model.document,be=we.editing.view.document,xe=(ve,ke)=>{const Ie=ke.dataTransfer;ke.preventDefault(),this._fireOutputTransformationEvent(Ie,t.selection,ve.name)};this.listenTo(be,"copy",xe,{priority:"low"}),this.listenTo(be,"cut",(ve,ke)=>{we.model.canEditAt(we.model.document.selection)?xe(ve,ke):ke.preventDefault()},{priority:"low"}),this.listenTo(this,"outputTransformation",(ve,ke)=>{const Ie=we.data.toView(ke.content);be.fire("clipboardOutput",{dataTransfer:ke.dataTransfer,content:Ie,method:ke.method})},{priority:"low"}),this.listenTo(be,"clipboardOutput",(ve,ke)=>{ke.content.isEmpty||(ke.dataTransfer.setData("text/html",this.editor.data.htmlProcessor.toData(ke.content)),ke.dataTransfer.setData("text/plain",viewToPlainText(ke.content))),ke.method=="cut"&&we.model.deleteContent(t.selection)},{priority:"low"})}}const toPx$1=toUnit("px");class LineView extends View{constructor(){super();const we=this.bindTemplate;this.set({isVisible:!1,left:null,top:null,width:null}),this.setTemplate({tag:"div",attributes:{class:["ck","ck-clipboard-drop-target-line",we.if("isVisible","ck-hidden",t=>!t)],style:{left:we.to("left",t=>toPx$1(t)),top:we.to("top",t=>toPx$1(t)),width:we.to("width",t=>toPx$1(t))}}})}}class DragDropTarget extends Plugin{constructor(){super(...arguments);Re(this,"removeDropMarkerDelayed",delay(()=>this.removeDropMarker(),40));Re(this,"_updateDropMarkerThrottled",throttle(t=>this._updateDropMarker(t),40));Re(this,"_reconvertMarkerThrottled",throttle(()=>{this.editor.model.markers.has("drop-target")&&this.editor.editing.reconvertMarker("drop-target")},0));Re(this,"_dropTargetLineView",new LineView);Re(this,"_domEmitter",new(DomEmitterMixin()));Re(this,"_scrollables",new Map)}static get pluginName(){return"DragDropTarget"}init(){this._setupDropMarker()}destroy(){this._domEmitter.stopListening();for(const{resizeObserver:t}of this._scrollables.values())t.destroy();return this._updateDropMarkerThrottled.cancel(),this.removeDropMarkerDelayed.cancel(),this._reconvertMarkerThrottled.cancel(),super.destroy()}updateDropMarker(t,te,be,xe,ve,ke){this.removeDropMarkerDelayed.cancel();const Ie=findDropTargetRange(this.editor,t,te,be,xe,ve,ke);/* istanbul ignore next -- @preserve */if(Ie){if(ke&&ke.containsRange(Ie))return this.removeDropMarker();this._updateDropMarkerThrottled(Ie)}}getFinalDropRange(t,te,be,xe,ve,ke){const Ie=findDropTargetRange(this.editor,t,te,be,xe,ve,ke);return this.removeDropMarker(),Ie}removeDropMarker(){const t=this.editor.model;this.removeDropMarkerDelayed.cancel(),this._updateDropMarkerThrottled.cancel(),this._dropTargetLineView.isVisible=!1,t.markers.has("drop-target")&&t.change(te=>{te.removeMarker("drop-target")})}_setupDropMarker(){const t=this.editor;t.ui.view.body.add(this._dropTargetLineView),t.conversion.for("editingDowncast").markerToHighlight({model:"drop-target",view:{classes:["ck-clipboard-drop-target-range"]}}),t.conversion.for("editingDowncast").markerToElement({model:"drop-target",view:(te,{writer:be})=>{if(t.model.schema.checkChild(te.markerRange.start,"$text"))return this._dropTargetLineView.isVisible=!1,this._createDropTargetPosition(be);te.markerRange.isCollapsed?this._updateDropTargetLine(te.markerRange):this._dropTargetLineView.isVisible=!1}})}_updateDropMarker(t){const te=this.editor,be=te.model.markers;te.model.change(xe=>{be.has("drop-target")?be.get("drop-target").getRange().isEqual(t)||xe.updateMarker("drop-target",{range:t}):xe.addMarker("drop-target",{range:t,usingOperation:!1,affectsData:!1})})}_createDropTargetPosition(t){return t.createUIElement("span",{class:"ck ck-clipboard-drop-target-position"},function(te){const be=this.toDomElement(te);return be.append("⁠",te.createElement("span"),"⁠"),be})}_updateDropTargetLine(t){const te=this.editor.editing,be=t.start.nodeBefore,xe=t.start.nodeAfter,ve=t.start.parent,ke=be?te.mapper.toViewElement(be):null,Ie=ke?te.view.domConverter.mapViewToDom(ke):null,Ae=xe?te.mapper.toViewElement(xe):null,Se=Ae?te.view.domConverter.mapViewToDom(Ae):null,Oe=te.mapper.toViewElement(ve);if(!Oe)return;const Ve=te.view.domConverter.mapViewToDom(Oe),Me=this._getScrollableRect(Oe),{scrollX:De,scrollY:Fe}=global.window,Be=Ie?new Rect(Ie):null,$e=Se?new Rect(Se):null,Ue=new Rect(Ve).excludeScrollbarsAndBorders(),He=Be?Be.bottom:Ue.top,ze=$e?$e.top:Ue.bottom,qe=global.window.getComputedStyle(Ve),Ke=He<=ze?(He+ze)/2:ze;if(Me.top<Ke&&Ke<Me.bottom){const Qe=Ue.left+parseFloat(qe.paddingLeft),je=Ue.right-parseFloat(qe.paddingRight),Ye=Math.max(Qe+De,Me.left),ht=Math.min(je+De,Me.right);this._dropTargetLineView.set({isVisible:!0,left:Ye,top:Ke+Fe,width:ht-Ye})}else this._dropTargetLineView.isVisible=!1}_getScrollableRect(t){const te=t.root.rootName;let be;if(this._scrollables.has(te))be=this._scrollables.get(te).domElement;else{const xe=this.editor.editing.view.domConverter.mapViewToDom(t);be=findScrollableElement(xe),this._domEmitter.listenTo(be,"scroll",this._reconvertMarkerThrottled,{usePassive:!0});const ve=new ResizeObserver(be,this._reconvertMarkerThrottled);this._scrollables.set(te,{domElement:be,resizeObserver:ve})}return new Rect(be).excludeScrollbarsAndBorders()}}function findDropTargetRange(Te,we,t,te,be,xe,ve){const ke=Te.model,Ie=Te.editing.mapper;let Se=getClosestMappedModelElement(Te,we);for(;Se;){if(!xe){if(ke.schema.checkChild(Se,"$text")){if(t){const Oe=t[0].start,Ve=Ie.toModelPosition(Oe);if(!ve||Array.from(ve.getItems()).every(De=>ke.schema.checkChild(Ve,De))){if(ke.schema.checkChild(Ve,"$text"))return ke.createRange(Ve);if(Oe)return findDropTargetRangeForElement(Te,getClosestMappedModelElement(Te,Oe.parent),te,be)}}}else if(ke.schema.isInline(Se))return findDropTargetRangeForElement(Te,Se,te,be)}if(ke.schema.isBlock(Se))return findDropTargetRangeForElement(Te,Se,te,be);if(ke.schema.checkChild(Se,"$block")){const Oe=Array.from(Se.getChildren()).filter(De=>De.is("element")&&!shouldIgnoreElement(Te,De));let Ve=0,Me=Oe.length;if(Me==0)return ke.createRange(ke.createPositionAt(Se,"end"));for(;Ve<Me-1;){const De=Math.floor((Ve+Me)/2);findElementSide(Te,Oe[De],te,be)=="before"?Me=De:Ve=De}return findDropTargetRangeForElement(Te,Oe[Ve],te,be)}Se=Se.parent}return null}function shouldIgnoreElement(Te,we){const t=Te.editing.mapper,te=Te.editing.view.domConverter,be=t.toViewElement(we);if(!be)return!0;const xe=te.mapViewToDom(be);return global.window.getComputedStyle(xe).float!="none"}function findDropTargetRangeForElement(Te,we,t,te){const be=Te.model;return be.createRange(be.createPositionAt(we,findElementSide(Te,we,t,te)))}function findElementSide(Te,we,t,te){const be=Te.editing.mapper,xe=Te.editing.view.domConverter,ve=be.toViewElement(we),ke=xe.mapViewToDom(ve),Ie=new Rect(ke);return Te.model.schema.isInline(we)?t<(Ie.left+Ie.right)/2?"before":"after":te<(Ie.top+Ie.bottom)/2?"before":"after"}function getClosestMappedModelElement(Te,we){const t=Te.editing.mapper,te=Te.editing.view,be=t.toModelElement(we);if(be)return be;const xe=te.createPositionBefore(we),ve=t.findMappedViewAncestor(xe);return t.toModelElement(ve)}function findScrollableElement(Te){let we=Te;do{we=we.parentElement;const t=global.window.getComputedStyle(we).overflowY;if(t=="auto"||t=="scroll")break}while(we.tagName!="BODY");return we}class DragDropBlockToolbar extends Plugin{constructor(){super(...arguments);Re(this,"_isBlockDragging",!1);Re(this,"_domEmitter",new(DomEmitterMixin()))}static get pluginName(){return"DragDropBlockToolbar"}init(){const t=this.editor;if(this.listenTo(t,"change:isReadOnly",(te,be,xe)=>{xe?(this.forceDisabled("readOnlyMode"),this._isBlockDragging=!1):this.clearForceDisabled("readOnlyMode")}),env.isAndroid&&this.forceDisabled("noAndroidSupport"),t.plugins.has("BlockToolbar")){const be=t.plugins.get("BlockToolbar").buttonView.element;this._domEmitter.listenTo(be,"dragstart",(xe,ve)=>this._handleBlockDragStart(ve)),this._domEmitter.listenTo(global.document,"dragover",(xe,ve)=>this._handleBlockDragging(ve)),this._domEmitter.listenTo(global.document,"drop",(xe,ve)=>this._handleBlockDragging(ve)),this._domEmitter.listenTo(global.document,"dragend",()=>this._handleBlockDragEnd(),{useCapture:!0}),this.isEnabled&&be.setAttribute("draggable","true"),this.on("change:isEnabled",(xe,ve,ke)=>{be.setAttribute("draggable",ke?"true":"false")})}}destroy(){return this._domEmitter.stopListening(),super.destroy()}_handleBlockDragStart(t){if(!this.isEnabled)return;const te=this.editor.model,be=te.document.selection,xe=this.editor.editing.view,ve=Array.from(be.getSelectedBlocks()),ke=te.createRange(te.createPositionBefore(ve[0]),te.createPositionAfter(ve[ve.length-1]));te.change(Ie=>Ie.setSelection(ke)),this._isBlockDragging=!0,xe.focus(),xe.getObserver(ClipboardObserver).onDomEvent(t)}_handleBlockDragging(t){if(!this.isEnabled||!this._isBlockDragging)return;const te=t.clientX+(this.editor.locale.contentLanguageDirection=="ltr"?100:-100),be=t.clientY,xe=document.elementFromPoint(te,be),ve=this.editor.editing.view;!xe||!xe.closest(".ck-editor__editable")||ve.getObserver(ClipboardObserver).onDomEvent({...t,type:t.type,dataTransfer:t.dataTransfer,target:xe,clientX:te,clientY:be,preventDefault:()=>t.preventDefault(),stopPropagation:()=>t.stopPropagation()})}_handleBlockDragEnd(){this._isBlockDragging=!1}}class DragDrop extends Plugin{constructor(){super(...arguments);Re(this,"_draggedRange");Re(this,"_draggingUid");Re(this,"_draggableElement");Re(this,"_clearDraggableAttributesDelayed",delay(()=>this._clearDraggableAttributes(),40));Re(this,"_blockMode",!1);Re(this,"_domEmitter",new(DomEmitterMixin()));Re(this,"_previewContainer")}static get pluginName(){return"DragDrop"}static get requires(){return[ClipboardPipeline,Widget,DragDropTarget,DragDropBlockToolbar]}init(){const t=this.editor,te=t.editing.view;this._draggedRange=null,this._draggingUid="",this._draggableElement=null,te.addObserver(ClipboardObserver),te.addObserver(MouseObserver),this._setupDragging(),this._setupContentInsertionIntegration(),this._setupClipboardInputIntegration(),this._setupDraggableAttributeHandling(),this.listenTo(t,"change:isReadOnly",(be,xe,ve)=>{ve?this.forceDisabled("readOnlyMode"):this.clearForceDisabled("readOnlyMode")}),this.on("change:isEnabled",(be,xe,ve)=>{ve||this._finalizeDragging(!1)}),env.isAndroid&&this.forceDisabled("noAndroidSupport")}destroy(){return this._draggedRange&&(this._draggedRange.detach(),this._draggedRange=null),this._previewContainer&&this._previewContainer.remove(),this._domEmitter.stopListening(),this._clearDraggableAttributesDelayed.cancel(),super.destroy()}_setupDragging(){const t=this.editor,te=t.model,be=t.editing.view,xe=be.document,ve=t.plugins.get(DragDropTarget);this.listenTo(xe,"dragstart",(ke,Ie)=>{if(Ie.target&&Ie.target.is("editableElement")){Ie.preventDefault();return}if(this._prepareDraggedRange(Ie.target),!this._draggedRange){Ie.preventDefault();return}this._draggingUid=uid(),Ie.dataTransfer.effectAllowed=this.isEnabled?"copyMove":"copy",Ie.dataTransfer.setData("application/ckeditor5-dragging-uid",this._draggingUid);const Ae=te.createSelection(this._draggedRange.toRange());this.editor.plugins.get("ClipboardPipeline")._fireOutputTransformationEvent(Ie.dataTransfer,Ae,"dragstart");const{dataTransfer:Oe,domTarget:Ve,domEvent:Me}=Ie,{clientX:De}=Me;this._updatePreview({dataTransfer:Oe,domTarget:Ve,clientX:De}),Ie.stopPropagation(),this.isEnabled||(this._draggedRange.detach(),this._draggedRange=null,this._draggingUid="")},{priority:"low"}),this.listenTo(xe,"dragend",(ke,Ie)=>{this._finalizeDragging(!Ie.dataTransfer.isCanceled&&Ie.dataTransfer.dropEffect=="move")},{priority:"low"}),this._domEmitter.listenTo(global.document,"dragend",()=>{this._blockMode=!1},{useCapture:!0}),this.listenTo(xe,"dragenter",()=>{this.isEnabled&&be.focus()}),this.listenTo(xe,"dragleave",()=>{ve.removeDropMarkerDelayed()}),this.listenTo(xe,"dragging",(ke,Ie)=>{if(!this.isEnabled){Ie.dataTransfer.dropEffect="none";return}const{clientX:Ae,clientY:Se}=Ie.domEvent;ve.updateDropMarker(Ie.target,Ie.targetRanges,Ae,Se,this._blockMode,this._draggedRange),this._draggedRange||(Ie.dataTransfer.dropEffect="copy"),env.isGecko||(Ie.dataTransfer.effectAllowed=="copy"?Ie.dataTransfer.dropEffect="copy":["all","copyMove"].includes(Ie.dataTransfer.effectAllowed)&&(Ie.dataTransfer.dropEffect="move")),ke.stop()},{priority:"low"})}_setupClipboardInputIntegration(){const t=this.editor,be=t.editing.view.document,xe=t.plugins.get(DragDropTarget);this.listenTo(be,"clipboardInput",(ve,ke)=>{if(ke.method!="drop")return;const{clientX:Ie,clientY:Ae}=ke.domEvent,Se=xe.getFinalDropRange(ke.target,ke.targetRanges,Ie,Ae,this._blockMode,this._draggedRange);if(!Se){this._finalizeDragging(!1),ve.stop();return}if(this._draggedRange&&this._draggingUid!=ke.dataTransfer.getData("application/ckeditor5-dragging-uid")&&(this._draggedRange.detach(),this._draggedRange=null,this._draggingUid=""),getFinalDropEffect(ke.dataTransfer)=="move"&&this._draggedRange&&this._draggedRange.containsRange(Se,!0)){this._finalizeDragging(!1),ve.stop();return}ke.targetRanges=[t.editing.mapper.toViewRange(Se)]},{priority:"high"})}_setupContentInsertionIntegration(){const t=this.editor.plugins.get(ClipboardPipeline);t.on("contentInsertion",(te,be)=>{if(!this.isEnabled||be.method!=="drop")return;const xe=be.targetRanges.map(ve=>this.editor.editing.mapper.toModelRange(ve));this.editor.model.change(ve=>ve.setSelection(xe))},{priority:"high"}),t.on("contentInsertion",(te,be)=>{if(!this.isEnabled||be.method!=="drop")return;const xe=getFinalDropEffect(be.dataTransfer)=="move",ve=!be.resultRange||!be.resultRange.isCollapsed;this._finalizeDragging(ve&&xe)},{priority:"lowest"})}_setupDraggableAttributeHandling(){const t=this.editor,te=t.editing.view,be=te.document;this.listenTo(be,"mousedown",(xe,ve)=>{if(env.isAndroid||!ve)return;this._clearDraggableAttributesDelayed.cancel();let ke=findDraggableWidget(ve.target);if(env.isBlink&&!t.isReadOnly&&!ke&&!be.selection.isCollapsed){const Ie=be.selection.getSelectedElement();(!Ie||!isWidget(Ie))&&(ke=be.selection.editableElement)}ke&&(te.change(Ie=>{Ie.setAttribute("draggable","true",ke)}),this._draggableElement=t.editing.mapper.toModelElement(ke))}),this.listenTo(be,"mouseup",()=>{env.isAndroid||this._clearDraggableAttributesDelayed()})}_clearDraggableAttributes(){const t=this.editor.editing;t.view.change(te=>{this._draggableElement&&this._draggableElement.root.rootName!="$graveyard"&&te.removeAttribute("draggable",t.mapper.toViewElement(this._draggableElement)),this._draggableElement=null})}_finalizeDragging(t){const te=this.editor,be=te.model;te.plugins.get(DragDropTarget).removeDropMarker(),this._clearDraggableAttributes(),te.plugins.has("WidgetToolbarRepository")&&te.plugins.get("WidgetToolbarRepository").clearForceDisabled("dragDrop"),this._draggingUid="",this._previewContainer&&(this._previewContainer.remove(),this._previewContainer=void 0),this._draggedRange&&(t&&this.isEnabled&&be.change(ve=>{const ke=be.createSelection(this._draggedRange);be.deleteContent(ke,{doNotAutoparagraph:!0});const Ie=ke.getFirstPosition().parent;Ie.isEmpty&&!be.schema.checkChild(Ie,"$text")&&be.schema.checkChild(Ie,"paragraph")&&ve.insertElement("paragraph",Ie,0)}),this._draggedRange.detach(),this._draggedRange=null)}_prepareDraggedRange(t){const te=this.editor,be=te.model,xe=be.document.selection,ve=t?findDraggableWidget(t):null;if(ve){const Se=te.editing.mapper.toModelElement(ve);this._draggedRange=LiveRange.fromRange(be.createRangeOn(Se)),this._blockMode=be.schema.isBlock(Se),te.plugins.has("WidgetToolbarRepository")&&te.plugins.get("WidgetToolbarRepository").forceDisabled("dragDrop");return}if(xe.isCollapsed&&!xe.getFirstPosition().parent.isEmpty)return;const ke=Array.from(xe.getSelectedBlocks()),Ie=xe.getFirstRange();if(ke.length==0){this._draggedRange=LiveRange.fromRange(Ie);return}const Ae=getRangeIncludingFullySelectedParents(be,ke);if(ke.length>1)this._draggedRange=LiveRange.fromRange(Ae),this._blockMode=!0;else if(ke.length==1){const Se=Ie.start.isTouching(Ae.start)&&Ie.end.isTouching(Ae.end);this._draggedRange=LiveRange.fromRange(Se?Ae:Ie),this._blockMode=Se}be.change(Se=>Se.setSelection(this._draggedRange.toRange()))}_updatePreview({dataTransfer:t,domTarget:te,clientX:be}){const xe=this.editor.editing.view,ve=xe.document.selection.editableElement,ke=xe.domConverter.mapViewToDom(ve),Ie=global.window.getComputedStyle(ke);this._previewContainer?this._previewContainer.firstElementChild&&this._previewContainer.removeChild(this._previewContainer.firstElementChild):(this._previewContainer=createElement(global.document,"div",{style:"position: fixed; left: -999999px;"}),global.document.body.appendChild(this._previewContainer));const Ae=new Rect(ke);if(ke.contains(te))return;const Se=parseFloat(Ie.paddingLeft),Oe=createElement(global.document,"div");Oe.className="ck ck-content",Oe.style.width=Ie.width,Oe.style.paddingLeft=`${Ae.left-be+Se}px`,env.isiOS&&(Oe.style.backgroundColor="white"),Oe.innerHTML=t.getData("text/html"),t.setDragImage(Oe,0,0),this._previewContainer.appendChild(Oe)}}function getFinalDropEffect(Te){return env.isGecko?Te.dropEffect:["all","copyMove"].includes(Te.effectAllowed)?"move":"copy"}function findDraggableWidget(Te){if(Te.is("editableElement"))return null;if(Te.hasClass("ck-widget__selection-handle"))return Te.findAncestor(isWidget);if(isWidget(Te))return Te;const we=Te.findAncestor(t=>isWidget(t)||t.is("editableElement"));return isWidget(we)?we:null}function getRangeIncludingFullySelectedParents(Te,we){const t=we[0],te=we[we.length-1],be=t.getCommonAncestor(te),xe=Te.createPositionBefore(t),ve=Te.createPositionAfter(te);if(be&&be.is("element")&&!Te.schema.isLimit(be)){const ke=Te.createRangeOn(be),Ie=xe.isTouching(ke.start),Ae=ve.isTouching(ke.end);if(Ie&&Ae)return getRangeIncludingFullySelectedParents(Te,[be])}return Te.createRange(xe,ve)}class PastePlainText extends Plugin{static get pluginName(){return"PastePlainText"}static get requires(){return[ClipboardPipeline]}init(){const we=this.editor,t=we.model,te=we.editing.view,be=te.document,xe=t.document.selection;let ve=!1;te.addObserver(ClipboardObserver),this.listenTo(be,"keydown",(ke,Ie)=>{ve=Ie.shiftKey}),we.plugins.get(ClipboardPipeline).on("contentInsertion",(ke,Ie)=>{!ve&&!isPlainTextFragment(Ie.content,t.schema)||t.change(Ae=>{const Se=Array.from(xe.getAttributes()).filter(([Ve])=>t.schema.getAttributeProperties(Ve).isFormatting);xe.isCollapsed||t.deleteContent(xe,{doNotAutoparagraph:!0}),Se.push(...xe.getAttributes());const Oe=Ae.createRangeIn(Ie.content);for(const Ve of Oe.getItems())Ve.is("$textProxy")&&Ae.setAttributes(Se,Ve)})})}}function isPlainTextFragment(Te,we){if(Te.childCount>1)return!1;const t=Te.getChild(0);return we.isObject(t)?!1:Array.from(t.getAttributeKeys()).length==0}class Clipboard extends Plugin{static get pluginName(){return"Clipboard"}static get requires(){return[ClipboardMarkersUtils,ClipboardPipeline,DragDrop,PastePlainText]}init(){const we=this.editor,t=this.editor.t;we.accessibility.addKeystrokeInfos({keystrokes:[{label:t("Copy selected content"),keystroke:"CTRL+C"},{label:t("Paste content"),keystroke:"CTRL+V"},{label:t("Paste content as plain text"),keystroke:"CTRL+SHIFT+V"}]})}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const DEFAULT_OPTIONS$1={autoRefresh:!0},DEFAULT_TOKEN_REFRESH_TIMEOUT_TIME=36e5;class Token extends ObservableMixin(){constructor(t,te={}){super();Re(this,"_refresh");Re(this,"_options");Re(this,"_tokenRefreshTimeout");if(!t)throw new CKEditorError("token-missing-token-url",this);te.initValue&&this._validateTokenValue(te.initValue),this.set("value",te.initValue),typeof t=="function"?this._refresh=t:this._refresh=()=>defaultRefreshToken(t),this._options={...DEFAULT_OPTIONS$1,...te}}init(){return new Promise((t,te)=>{if(!this.value){this.refreshToken().then(t).catch(te);return}this._options.autoRefresh&&this._registerRefreshTokenTimeout(),t(this)})}refreshToken(){return this._refresh().then(t=>(this._validateTokenValue(t),this.set("value",t),this._options.autoRefresh&&this._registerRefreshTokenTimeout(),this))}destroy(){clearTimeout(this._tokenRefreshTimeout)}_validateTokenValue(t){const te=typeof t=="string",be=!/^".*"$/.test(t),xe=te&&t.split(".").length===3;if(!(be&&xe))throw new CKEditorError("token-not-in-jwt-format",this)}_registerRefreshTokenTimeout(){const t=this._getTokenRefreshTimeoutTime();clearTimeout(this._tokenRefreshTimeout),this._tokenRefreshTimeout=setTimeout(()=>{this.refreshToken()},t)}_getTokenRefreshTimeoutTime(){try{const[,t]=this.value.split("."),{exp:te}=JSON.parse(atob(t));return te?Math.floor((te*1e3-Date.now())/2):DEFAULT_TOKEN_REFRESH_TIMEOUT_TIME}catch{return DEFAULT_TOKEN_REFRESH_TIMEOUT_TIME}}static create(t,te={}){return new Token(t,te).init()}}function defaultRefreshToken(Te){return new Promise((we,t)=>{const te=new XMLHttpRequest;te.open("GET",Te),te.addEventListener("load",()=>{const be=te.status,xe=te.response;return be<200||be>299?t(new CKEditorError("token-cannot-download-new-token",null)):we(xe)}),te.addEventListener("error",()=>t(new Error("Network Error"))),te.addEventListener("abort",()=>t(new Error("Abort"))),te.send()})}const BASE64_HEADER_REG_EXP=/^data:(\S*?);base64,/;class FileUploader extends EmitterMixin(){constructor(t,te,be){super();Re(this,"file");Re(this,"xhr");Re(this,"_token");Re(this,"_apiAddress");if(!t)throw new CKEditorError("fileuploader-missing-file",null);if(!te)throw new CKEditorError("fileuploader-missing-token",null);if(!be)throw new CKEditorError("fileuploader-missing-api-address",null);this.file=_isBase64(t)?_base64ToBlob(t):t,this._token=te,this._apiAddress=be}onProgress(t){return this.on("progress",(te,be)=>t(be)),this}onError(t){return this.once("error",(te,be)=>t(be)),this}abort(){this.xhr.abort()}send(){return this._prepareRequest(),this._attachXHRListeners(),this._sendRequest()}_prepareRequest(){const t=new XMLHttpRequest;t.open("POST",this._apiAddress),t.setRequestHeader("Authorization",this._token.value),t.responseType="json",this.xhr=t}_attachXHRListeners(){const t=this.xhr,te=be=>()=>this.fire("error",be);t.addEventListener("error",te("Network Error")),t.addEventListener("abort",te("Abort"));/* istanbul ignore else -- @preserve */t.upload&&t.upload.addEventListener("progress",be=>{be.lengthComputable&&this.fire("progress",{total:be.total,uploaded:be.loaded})}),t.addEventListener("load",()=>{const be=t.status,xe=t.response;if(be<200||be>299)return this.fire("error",xe.message||xe.error)})}_sendRequest(){const t=new FormData,te=this.xhr;return t.append("file",this.file),new Promise((be,xe)=>{te.addEventListener("load",()=>{const ve=te.status,ke=te.response;return ve<200||ve>299?ke.message?xe(new CKEditorError("fileuploader-uploading-data-failed",this,{message:ke.message})):xe(ke.error):be(ke)}),te.addEventListener("error",()=>xe(new Error("Network Error"))),te.addEventListener("abort",()=>xe(new Error("Abort"))),te.send(t)})}}function _base64ToBlob(Te,we=512){try{const t=Te.match(BASE64_HEADER_REG_EXP)[1],te=atob(Te.replace(BASE64_HEADER_REG_EXP,"")),be=[];for(let xe=0;xe<te.length;xe+=we){const ve=te.slice(xe,xe+we),ke=new Array(ve.length);for(let Ie=0;Ie<ve.length;Ie++)ke[Ie]=ve.charCodeAt(Ie);be.push(new Uint8Array(ke))}return new Blob(be,{type:t})}catch{throw new CKEditorError("fileuploader-decoding-image-data-error",null)}}function _isBase64(Te){if(typeof Te!="string")return!1;const we=Te.match(BASE64_HEADER_REG_EXP);return!!(we&&we.length)}class UploadGateway{constructor(we,t){Re(this,"_token");Re(this,"_apiAddress");if(!we)throw new CKEditorError("uploadgateway-missing-token",null);if(!t)throw new CKEditorError("uploadgateway-missing-api-address",null);this._token=we,this._apiAddress=t}upload(we){return new FileUploader(we,this._token,this._apiAddress)}}class CloudServicesCore extends ContextPlugin{static get pluginName(){return"CloudServicesCore"}createToken(we,t){return new Token(we,t)}createUploadGateway(we,t){return new UploadGateway(we,t)}}class CloudServices extends ContextPlugin{constructor(){super(...arguments);Re(this,"tokenUrl");Re(this,"uploadUrl");Re(this,"webSocketUrl");Re(this,"bundleVersion");Re(this,"token",null);Re(this,"_tokens",new Map)}static get pluginName(){return"CloudServices"}static get requires(){return[CloudServicesCore]}async init(){const te=this.context.config.get("cloudServices")||{};for(const[xe,ve]of Object.entries(te))this[xe]=ve;if(!this.tokenUrl){this.token=null;return}const be=this.context.plugins.get("CloudServicesCore");this.token=await be.createToken(this.tokenUrl).init(),this._tokens.set(this.tokenUrl,this.token)}async registerTokenUrl(t){if(this._tokens.has(t))return this.getTokenFor(t);const be=await this.context.plugins.get("CloudServicesCore").createToken(t).init();return this._tokens.set(t,be),be}getTokenFor(t){const te=this._tokens.get(t);if(!te)throw new CKEditorError("cloudservices-token-not-registered",this);return te}destroy(){super.destroy();for(const t of this._tokens.values())t.destroy()}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class DecoupledEditorUI extends EditorUI{constructor(t,te){super(t);Re(this,"view");this.view=te}init(){const t=this.editor,te=this.view,be=t.editing.view,xe=te.editable,ve=be.document.getRoot();xe.name=ve.rootName,te.render();const ke=xe.element;this.setEditableElement(xe.name,ke),te.editable.bind("isFocused").to(this.focusTracker),be.attachDomRoot(ke),this._initPlaceholder(),this._initToolbar(),_initMenuBar(t,this.view.menuBarView),this.fire("ready")}destroy(){super.destroy();const t=this.view;this.editor.editing.view.detachDomRoot(t.editable.name),t.destroy()}_initToolbar(){const t=this.editor,te=this.view;te.toolbar.fillFromConfig(t.config.get("toolbar"),this.componentFactory),this.addToolbar(te.toolbar)}_initPlaceholder(){const t=this.editor,te=t.editing.view,be=te.document.getRoot(),xe=t.config.get("placeholder");if(xe){const ve=typeof xe=="string"?xe:xe[be.rootName];ve&&(be.placeholder=ve)}enablePlaceholder({view:te,element:be,isDirectHost:!1,keepOnFocus:!0})}}class DecoupledEditorUIView extends EditorUIView{constructor(t,te,be={}){super(t);Re(this,"toolbar");Re(this,"menuBarView");Re(this,"editable");const xe=t.t;this.toolbar=new ToolbarView(t,{shouldGroupWhenFull:be.shouldToolbarGroupWhenFull}),this.menuBarView=new MenuBarView(t),this.editable=new InlineEditableUIView(t,te,be.editableElement,{label:ve=>xe("Rich Text Editor. Editing area: %0",ve.name)}),this.toolbar.extendTemplate({attributes:{class:["ck-reset_all","ck-rounded-corners"],dir:t.uiLanguageDirection}}),this.menuBarView.extendTemplate({attributes:{class:["ck-reset_all","ck-rounded-corners"],dir:t.uiLanguageDirection}})}render(){super.render(),this.registerChild([this.menuBarView,this.toolbar,this.editable])}}class DecoupledEditor extends ElementApiMixin(Editor){constructor(t,te={}){if(!isElement(t)&&te.initialData!==void 0)throw new CKEditorError("editor-create-initial-data",null);super(te);Re(this,"ui");this.config.get("initialData")===void 0&&this.config.set("initialData",getInitialData(t)),isElement(t)&&(this.sourceElement=t,secureSourceElement(this,t)),this.model.document.createRoot();const be=!this.config.get("toolbar.shouldNotGroupWhenFull"),xe=new DecoupledEditorUIView(this.locale,this.editing.view,{editableElement:this.sourceElement,shouldToolbarGroupWhenFull:be});this.ui=new DecoupledEditorUI(this,xe)}destroy(){const t=this.getData();return this.ui.destroy(),super.destroy().then(()=>{this.sourceElement&&this.updateSourceElement(t)})}static create(t,te={}){return new Promise(be=>{if(isElement(t)&&t.tagName==="TEXTAREA")throw new CKEditorError("editor-wrong-element",null);const xe=new this(t,te);be(xe.initPlugins().then(()=>xe.ui.init()).then(()=>xe.data.init(xe.config.get("initialData"))).then(()=>xe.fire("ready")).then(()=>xe))})}}function getInitialData(Te){return isElement(Te)?getDataFromElement(Te):Te}function isElement(Te){return isElement$1(Te)}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class SelectAllCommand extends Command{constructor(we){super(we),this.affectsData=!1}execute(){const we=this.editor.model,t=we.document.selection;let te=we.schema.getLimitElement(t);if(t.containsEntireContent(te)||!isSelectAllScope(we.schema,te))do if(te=te.parent,!te)return;while(!isSelectAllScope(we.schema,te));we.change(be=>{be.setSelection(te,"in")})}}function isSelectAllScope(Te,we){return Te.isLimit(we)&&(Te.checkChild(we,"$text")||Te.checkChild(we,"paragraph"))}const SELECT_ALL_KEYSTROKE=parseKeystroke("Ctrl+A");class SelectAllEditing extends Plugin{static get pluginName(){return"SelectAllEditing"}init(){const we=this.editor,t=we.t,be=we.editing.view.document;we.commands.add("selectAll",new SelectAllCommand(we)),this.listenTo(be,"keydown",(xe,ve)=>{getCode(ve)===SELECT_ALL_KEYSTROKE&&(we.execute("selectAll"),ve.preventDefault())}),we.accessibility.addKeystrokeInfos({keystrokes:[{label:t("Select all"),keystroke:"CTRL+A"}]})}}var selectAllIcon='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"><path d="M.75 15.5a.75.75 0 0 1 .75.75V18l.008.09A.5.5 0 0 0 2 18.5h1.75a.75.75 0 1 1 0 1.5H1.5l-.144-.007a1.5 1.5 0 0 1-1.35-1.349L0 18.5v-2.25a.75.75 0 0 1 .75-.75zm18.5 0a.75.75 0 0 1 .75.75v2.25l-.007.144a1.5 1.5 0 0 1-1.349 1.35L18.5 20h-2.25a.75.75 0 1 1 0-1.5H18a.5.5 0 0 0 .492-.41L18.5 18v-1.75a.75.75 0 0 1 .75-.75zm-10.45 3c.11 0 .2.09.2.2v1.1a.2.2 0 0 1-.2.2H7.2a.2.2 0 0 1-.2-.2v-1.1c0-.11.09-.2.2-.2h1.6zm4 0c.11 0 .2.09.2.2v1.1a.2.2 0 0 1-.2.2h-1.6a.2.2 0 0 1-.2-.2v-1.1c0-.11.09-.2.2-.2h1.6zm.45-5.5a.75.75 0 1 1 0 1.5h-8.5a.75.75 0 1 1 0-1.5h8.5zM1.3 11c.11 0 .2.09.2.2v1.6a.2.2 0 0 1-.2.2H.2a.2.2 0 0 1-.2-.2v-1.6c0-.11.09-.2.2-.2h1.1zm18.5 0c.11 0 .2.09.2.2v1.6a.2.2 0 0 1-.2.2h-1.1a.2.2 0 0 1-.2-.2v-1.6c0-.11.09-.2.2-.2h1.1zm-4.55-2a.75.75 0 1 1 0 1.5H4.75a.75.75 0 1 1 0-1.5h10.5zM1.3 7c.11 0 .2.09.2.2v1.6a.2.2 0 0 1-.2.2H.2a.2.2 0 0 1-.2-.2V7.2c0-.11.09-.2.2-.2h1.1zm18.5 0c.11 0 .2.09.2.2v1.6a.2.2 0 0 1-.2.2h-1.1a.2.2 0 0 1-.2-.2V7.2c0-.11.09-.2.2-.2h1.1zm-4.55-2a.75.75 0 1 1 0 1.5h-2.5a.75.75 0 1 1 0-1.5h2.5zm-5 0a.75.75 0 1 1 0 1.5h-5.5a.75.75 0 0 1 0-1.5h5.5zm-6.5-5a.75.75 0 0 1 0 1.5H2a.5.5 0 0 0-.492.41L1.5 2v1.75a.75.75 0 0 1-1.5 0V1.5l.007-.144A1.5 1.5 0 0 1 1.356.006L1.5 0h2.25zM18.5 0l.144.007a1.5 1.5 0 0 1 1.35 1.349L20 1.5v2.25a.75.75 0 1 1-1.5 0V2l-.008-.09A.5.5 0 0 0 18 1.5h-1.75a.75.75 0 1 1 0-1.5h2.25zM8.8 0c.11 0 .2.09.2.2v1.1a.2.2 0 0 1-.2.2H7.2a.2.2 0 0 1-.2-.2V.2c0-.11.09-.2.2-.2h1.6zm4 0c.11 0 .2.09.2.2v1.1a.2.2 0 0 1-.2.2h-1.6a.2.2 0 0 1-.2-.2V.2c0-.11.09-.2.2-.2h1.6z"/></svg>';class SelectAllUI extends Plugin{static get pluginName(){return"SelectAllUI"}init(){const we=this.editor;we.ui.componentFactory.add("selectAll",()=>{const t=this._createButton(ButtonView);return t.set({tooltip:!0}),t}),we.ui.componentFactory.add("menuBar:selectAll",()=>this._createButton(MenuBarMenuListItemButtonView))}_createButton(we){const t=this.editor,te=t.locale,be=t.commands.get("selectAll"),xe=new we(t.locale),ve=te.t;return xe.set({label:ve("Select all"),icon:selectAllIcon,keystroke:"Ctrl+A"}),xe.bind("isEnabled").to(be,"isEnabled"),this.listenTo(xe,"execute",()=>{t.execute("selectAll"),t.editing.view.focus()}),xe}}class SelectAll extends Plugin{static get requires(){return[SelectAllEditing,SelectAllUI]}static get pluginName(){return"SelectAll"}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class BaseCommand extends Command{constructor(t){super(t);Re(this,"_stack",[]);Re(this,"_createdBatches",new WeakSet);this.refresh(),this._isEnabledBasedOnSelection=!1,this.listenTo(t.data,"set",(te,be)=>{be[1]={...be[1]};const xe=be[1];xe.batchType||(xe.batchType={isUndoable:!1})},{priority:"high"}),this.listenTo(t.data,"set",(te,be)=>{be[1].batchType.isUndoable||this.clearStack()})}refresh(){this.isEnabled=this._stack.length>0}get createdBatches(){return this._createdBatches}addBatch(t){const te=this.editor.model.document.selection,be={ranges:te.hasOwnRange?Array.from(te.getRanges()):[],isBackward:te.isBackward};this._stack.push({batch:t,selection:be}),this.refresh()}clearStack(){this._stack=[],this.refresh()}_restoreSelection(t,te,be){const xe=this.editor.model,ve=xe.document,ke=[],Ie=t.map(Se=>Se.getTransformedByOperations(be)),Ae=Ie.flat();for(const Se of Ie){const Oe=Se.filter(Ve=>Ve.root!=ve.graveyard).filter(Ve=>!isRangeContainedByAnyOtherRange(Ve,Ae));Oe.length&&(normalizeRanges(Oe),ke.push(Oe[0]))}ke.length&&xe.change(Se=>{Se.setSelection(ke,{backward:te})})}_undo(t,te){const be=this.editor.model,xe=be.document;this._createdBatches.add(te);const ve=t.operations.slice().filter(ke=>ke.isDocumentOperation);ve.reverse();for(const ke of ve){const Ie=ke.baseVersion+1,Ae=Array.from(xe.history.getOperations(Ie)),Oe=transformSets([ke.getReversed()],Ae,{useRelations:!0,document:this.editor.model.document,padWithNoOps:!1,forceWeakRemove:!0}).operationsA;for(let Ve of Oe){const Me=Ve.affectedSelectable;Me&&!be.canEditAt(Me)&&(Ve=new NoOperation(Ve.baseVersion)),te.addOperation(Ve),be.applyOperation(Ve),xe.history.setOperationAsUndone(ke,Ve)}}}}function normalizeRanges(Te){Te.sort((we,t)=>we.start.isBefore(t.start)?-1:1);for(let we=1;we<Te.length;we++){const te=Te[we-1].getJoined(Te[we],!0);te&&(we--,Te.splice(we,2,te))}}function isRangeContainedByAnyOtherRange(Te,we){return we.some(t=>t!==Te&&t.containsRange(Te,!0))}class UndoCommand extends BaseCommand{execute(we=null){const t=we?this._stack.findIndex(xe=>xe.batch==we):this._stack.length-1,te=this._stack.splice(t,1)[0],be=this.editor.model.createBatch({isUndo:!0});this.editor.model.enqueueChange(be,()=>{this._undo(te.batch,be);const xe=this.editor.model.document.history.getOperations(te.batch.baseVersion);this._restoreSelection(te.selection.ranges,te.selection.isBackward,xe)}),this.fire("revert",te.batch,be),this.refresh()}}class RedoCommand extends BaseCommand{execute(){const we=this._stack.pop(),t=this.editor.model.createBatch({isUndo:!0});this.editor.model.enqueueChange(t,()=>{const be=we.batch.operations[we.batch.operations.length-1].baseVersion+1,xe=this.editor.model.document.history.getOperations(be);this._restoreSelection(we.selection.ranges,we.selection.isBackward,xe),this._undo(we.batch,t)}),this.refresh()}}class UndoEditing extends Plugin{constructor(){super(...arguments);Re(this,"_undoCommand");Re(this,"_redoCommand");Re(this,"_batchRegistry",new WeakSet)}static get pluginName(){return"UndoEditing"}init(){const t=this.editor,te=t.t;this._undoCommand=new UndoCommand(t),this._redoCommand=new RedoCommand(t),t.commands.add("undo",this._undoCommand),t.commands.add("redo",this._redoCommand),this.listenTo(t.model,"applyOperation",(be,xe)=>{const ve=xe[0];if(!ve.isDocumentOperation)return;const ke=ve.batch,Ie=this._redoCommand.createdBatches.has(ke),Ae=this._undoCommand.createdBatches.has(ke);this._batchRegistry.has(ke)||(this._batchRegistry.add(ke),ke.isUndoable&&(Ie?this._undoCommand.addBatch(ke):Ae||(this._undoCommand.addBatch(ke),this._redoCommand.clearStack())))},{priority:"highest"}),this.listenTo(this._undoCommand,"revert",(be,xe,ve)=>{this._redoCommand.addBatch(ve)}),t.keystrokes.set("CTRL+Z","undo"),t.keystrokes.set("CTRL+Y","redo"),t.keystrokes.set("CTRL+SHIFT+Z","redo"),t.accessibility.addKeystrokeInfos({keystrokes:[{label:te("Undo"),keystroke:"CTRL+Z"},{label:te("Redo"),keystroke:[["CTRL+Y"],["CTRL+SHIFT+Z"]]}]})}}class UndoUI extends Plugin{static get pluginName(){return"UndoUI"}init(){const we=this.editor,t=we.locale,te=we.t,be=t.uiLanguageDirection=="ltr"?icons.undo:icons.redo,xe=t.uiLanguageDirection=="ltr"?icons.redo:icons.undo;this._addButtonsToFactory("undo",te("Undo"),"CTRL+Z",be),this._addButtonsToFactory("redo",te("Redo"),"CTRL+Y",xe)}_addButtonsToFactory(we,t,te,be){const xe=this.editor;xe.ui.componentFactory.add(we,()=>{const ve=this._createButton(ButtonView,we,t,te,be);return ve.set({tooltip:!0}),ve}),xe.ui.componentFactory.add("menuBar:"+we,()=>this._createButton(MenuBarMenuListItemButtonView,we,t,te,be))}_createButton(we,t,te,be,xe){const ve=this.editor,ke=ve.locale,Ie=ve.commands.get(t),Ae=new we(ke);return Ae.set({label:te,icon:xe,keystroke:be}),Ae.bind("isEnabled").to(Ie,"isEnabled"),this.listenTo(Ae,"execute",()=>{ve.execute(t),ve.editing.view.focus()}),Ae}}class Undo extends Plugin{static get requires(){return[UndoEditing,UndoUI]}static get pluginName(){return"Undo"}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Essentials extends Plugin{static get requires(){return[AccessibilityHelp,Clipboard,Enter,SelectAll,ShiftEnter,Typing,Undo]}static get pluginName(){return"Essentials"}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class FindAndReplaceFormView extends View{constructor(t){super(t);Re(this,"children");Re(this,"_findInputView");Re(this,"_replaceInputView");Re(this,"_findButtonView");Re(this,"_findPrevButtonView");Re(this,"_findNextButtonView");Re(this,"_advancedOptionsCollapsibleView");Re(this,"_matchCaseSwitchView");Re(this,"_wholeWordsOnlySwitchView");Re(this,"_replaceButtonView");Re(this,"_replaceAllButtonView");Re(this,"_inputsDivView");Re(this,"_actionButtonsDivView");Re(this,"_focusTracker");Re(this,"_keystrokes");Re(this,"_focusables");Re(this,"focusCycler");const te=t.t;this.children=this.createCollection(),this.set("matchCount",0),this.set("highlightOffset",0),this.set("isDirty",!1),this.set("_areCommandsEnabled",{}),this.set("_resultsCounterText",""),this.set("_matchCase",!1),this.set("_wholeWordsOnly",!1),this.bind("_searchResultsFound").to(this,"matchCount",this,"isDirty",(be,xe)=>be>0&&!xe),this._findInputView=this._createInputField(te("Find in text…")),this._findPrevButtonView=this._createButton({label:te("Previous result"),class:"ck-button-prev",icon:icons.previousArrow,keystroke:"Shift+F3",tooltip:!0}),this._findNextButtonView=this._createButton({label:te("Next result"),class:"ck-button-next",icon:icons.previousArrow,keystroke:"F3",tooltip:!0}),this._replaceInputView=this._createInputField(te("Replace with…"),"ck-labeled-field-replace"),this._inputsDivView=this._createInputsDiv(),this._matchCaseSwitchView=this._createMatchCaseSwitch(),this._wholeWordsOnlySwitchView=this._createWholeWordsOnlySwitch(),this._advancedOptionsCollapsibleView=this._createAdvancedOptionsCollapsible(),this._replaceAllButtonView=this._createButton({label:te("Replace all"),class:"ck-button-replaceall",withText:!0}),this._replaceButtonView=this._createButton({label:te("Replace"),class:"ck-button-replace",withText:!0}),this._findButtonView=this._createButton({label:te("Find"),class:"ck-button-find ck-button-action",withText:!0}),this._actionButtonsDivView=this._createActionButtonsDiv(),this._focusTracker=new FocusTracker,this._keystrokes=new KeystrokeHandler,this._focusables=new ViewCollection,this.focusCycler=new FocusCycler({focusables:this._focusables,focusTracker:this._focusTracker,keystrokeHandler:this._keystrokes,actions:{focusPrevious:"shift + tab",focusNext:"tab"}}),this.children.addMany([this._inputsDivView,this._advancedOptionsCollapsibleView,this._actionButtonsDivView]),this.setTemplate({tag:"form",attributes:{class:["ck","ck-find-and-replace-form"],tabindex:"-1"},children:this.children})}render(){super.render(),submitHandler({view:this}),this._initFocusCycling(),this._initKeystrokeHandling()}destroy(){super.destroy(),this._focusTracker.destroy(),this._keystrokes.destroy()}focus(t){t===-1?this.focusCycler.focusLast():this.focusCycler.focusFirst()}reset(){this._findInputView.errorText=null,this.isDirty=!0}get _textToFind(){return this._findInputView.fieldView.element.value}get _textToReplace(){return this._replaceInputView.fieldView.element.value}_createInputsDiv(){const t=this.locale,te=t.t,be=new View(t);return this._findInputView.fieldView.on("input",()=>{this.isDirty=!0}),this._findPrevButtonView.delegate("execute").to(this,"findPrevious"),this._findNextButtonView.delegate("execute").to(this,"findNext"),this._findPrevButtonView.bind("isEnabled").to(this,"_areCommandsEnabled",({findPrevious:xe})=>xe),this._findNextButtonView.bind("isEnabled").to(this,"_areCommandsEnabled",({findNext:xe})=>xe),this._injectFindResultsCounter(),this._replaceInputView.bind("isEnabled").to(this,"_areCommandsEnabled",this,"_searchResultsFound",({replace:xe},ve)=>xe&&ve),this._replaceInputView.bind("infoText").to(this._replaceInputView,"isEnabled",this._replaceInputView,"isFocused",(xe,ve)=>xe||!ve?"":te("Tip: Find some text first in order to replace it.")),be.setTemplate({tag:"div",attributes:{class:["ck","ck-find-and-replace-form__inputs"]},children:[this._findInputView,this._findPrevButtonView,this._findNextButtonView,this._replaceInputView]}),be}_onFindButtonExecute(){if(!this._textToFind){const t=this.t;this._findInputView.errorText=t("Text to find must not be empty.");return}this.isDirty=!1,this.fire("findNext",{searchText:this._textToFind,matchCase:this._matchCase,wholeWords:this._wholeWordsOnly})}_injectFindResultsCounter(){const t=this.locale,te=t.t,be=this.bindTemplate,xe=new View(this.locale);this.bind("_resultsCounterText").to(this,"highlightOffset",this,"matchCount",(ke,Ie)=>te("%0 of %1",[ke,Ie])),xe.setTemplate({tag:"span",attributes:{class:["ck","ck-results-counter",be.if("isDirty","ck-hidden")]},children:[{text:be.to("_resultsCounterText")}]});const ve=()=>{const ke=this._findInputView.fieldView.element;if(!ke||!isVisible(ke))return;const Ie=new Rect(xe.element).width,Ae=t.uiLanguageDirection==="ltr"?"paddingRight":"paddingLeft";Ie?ke.style[Ae]=`calc( 2 * var(--ck-spacing-standard) + ${Ie}px )`:ke.style[Ae]=""};this.on("change:_resultsCounterText",ve,{priority:"low"}),this.on("change:isDirty",ve,{priority:"low"}),this._findInputView.template.children[0].children.push(xe)}_createAdvancedOptionsCollapsible(){const t=this.locale.t,te=new CollapsibleView(this.locale,[this._matchCaseSwitchView,this._wholeWordsOnlySwitchView]);return te.set({label:t("Advanced options"),isCollapsed:!0}),te}_createActionButtonsDiv(){const t=new View(this.locale);return this._replaceButtonView.bind("isEnabled").to(this,"_areCommandsEnabled",this,"_searchResultsFound",({replace:te},be)=>te&&be),this._replaceAllButtonView.bind("isEnabled").to(this,"_areCommandsEnabled",this,"_searchResultsFound",({replaceAll:te},be)=>te&&be),this._replaceButtonView.on("execute",()=>{this.fire("replace",{searchText:this._textToFind,replaceText:this._textToReplace})}),this._replaceAllButtonView.on("execute",()=>{this.fire("replaceAll",{searchText:this._textToFind,replaceText:this._textToReplace}),this.focus()}),this._findButtonView.on("execute",this._onFindButtonExecute.bind(this)),t.setTemplate({tag:"div",attributes:{class:["ck","ck-find-and-replace-form__actions"]},children:[this._replaceAllButtonView,this._replaceButtonView,this._findButtonView]}),t}_createMatchCaseSwitch(){const t=this.locale.t,te=new SwitchButtonView(this.locale);return te.set({label:t("Match case"),withText:!0}),te.bind("isOn").to(this,"_matchCase"),te.on("execute",()=>{this._matchCase=!this._matchCase,this.isDirty=!0}),te}_createWholeWordsOnlySwitch(){const t=this.locale.t,te=new SwitchButtonView(this.locale);return te.set({label:t("Whole words only"),withText:!0}),te.bind("isOn").to(this,"_wholeWordsOnly"),te.on("execute",()=>{this._wholeWordsOnly=!this._wholeWordsOnly,this.isDirty=!0}),te}_initFocusCycling(){[this._findInputView,this._findPrevButtonView,this._findNextButtonView,this._replaceInputView,this._advancedOptionsCollapsibleView.buttonView,this._matchCaseSwitchView,this._wholeWordsOnlySwitchView,this._replaceAllButtonView,this._replaceButtonView,this._findButtonView].forEach(te=>{this._focusables.add(te),this._focusTracker.add(te.element)})}_initKeystrokeHandling(){const t=be=>be.stopPropagation(),te=be=>{be.stopPropagation(),be.preventDefault()};this._keystrokes.listenTo(this.element),this._keystrokes.set("f3",be=>{te(be),this._findNextButtonView.fire("execute")}),this._keystrokes.set("shift+f3",be=>{te(be),this._findPrevButtonView.fire("execute")}),this._keystrokes.set("enter",be=>{const xe=be.target;xe===this._findInputView.fieldView.element?(this._areCommandsEnabled.findNext?this._findNextButtonView.fire("execute"):this._findButtonView.fire("execute"),te(be)):xe===this._replaceInputView.fieldView.element&&!this.isDirty&&(this._replaceButtonView.fire("execute"),te(be))}),this._keystrokes.set("shift+enter",be=>{be.target===this._findInputView.fieldView.element&&(this._areCommandsEnabled.findPrevious?this._findPrevButtonView.fire("execute"):this._findButtonView.fire("execute"),te(be))}),this._keystrokes.set("arrowright",t),this._keystrokes.set("arrowleft",t),this._keystrokes.set("arrowup",t),this._keystrokes.set("arrowdown",t)}_createButton(t){const te=new ButtonView(this.locale);return te.set(t),te}_createInputField(t,te){const be=new LabeledFieldView(this.locale,createLabeledInputText);return be.label=t,be.class=te,be}}var loupeIcon='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="m12.87 13.786 1.532-1.286 3.857 4.596a1 1 0 1 1-1.532 1.286l-3.857-4.596z"/><path d="M16.004 8.5a6.5 6.5 0 0 1-9.216 5.905c-1.154-.53-.863-1.415-.663-1.615.194-.194.564-.592 1.635-.141a4.5 4.5 0 0 0 5.89-5.904l-.104-.227 1.332-1.331c.045-.046.196-.041.224.007a6.47 6.47 0 0 1 .902 3.306zm-3.4-5.715c.562.305.742 1.106.354 1.494-.388.388-.995.414-1.476.178a4.5 4.5 0 0 0-6.086 5.882l.114.236-1.348 1.349c-.038.037-.17.022-.198-.023a6.5 6.5 0 0 1 5.54-9.9 6.469 6.469 0 0 1 3.1.784z"/><path d="M4.001 11.93.948 8.877a.2.2 0 0 1 .141-.341h6.106a.2.2 0 0 1 .141.341L4.283 11.93a.2.2 0 0 1-.282 0zm11.083-6.789 3.053 3.053a.2.2 0 0 1-.14.342H11.89a.2.2 0 0 1-.14-.342l3.052-3.053a.2.2 0 0 1 .282 0z"/></svg>';class FindAndReplaceUI extends Plugin{constructor(t){super(t);Re(this,"formView");t.config.define("findAndReplace.uiType","dialog"),this.formView=null}static get requires(){return[Dialog]}static get pluginName(){return"FindAndReplaceUI"}init(){const t=this.editor,te=t.config.get("findAndReplace.uiType")==="dropdown",be=t.commands.get("find"),xe=this.editor.t;t.ui.componentFactory.add("findAndReplace",()=>{let ve;return te?(ve=this._createDropdown(),ve.bind("isEnabled").to(be)):ve=this._createDialogButtonForToolbar(),t.keystrokes.set("Ctrl+F",(ke,Ie)=>{if(be.isEnabled){if(ve instanceof DropdownView){const Ae=ve.buttonView;Ae.isOn||Ae.fire("execute")}else ve.isOn?t.plugins.get("Dialog").view.focus():ve.fire("execute");Ie()}}),ve}),te||t.ui.componentFactory.add("menuBar:findAndReplace",()=>this._createDialogButtonForMenuBar()),t.accessibility.addKeystrokeInfos({keystrokes:[{label:xe("Find in the document"),keystroke:"CTRL+F"}]})}_createDropdown(){const t=this.editor,te=t.locale.t,be=createDropdown(t.locale);return be.once("change:isOpen",()=>{this.formView=this._createFormView(),this.formView.children.add(new FormHeaderView(t.locale,{label:te("Find and replace")}),0),be.panelView.children.add(this.formView)}),be.on("change:isOpen",(xe,ve,ke)=>{ke?this._setupFormView():this.fire("searchReseted")},{priority:"low"}),be.buttonView.set({icon:loupeIcon,label:te("Find and replace"),keystroke:"CTRL+F",tooltip:!0}),be}_createDialogButtonForToolbar(){const t=this.editor,te=this._createButton(ButtonView),be=t.plugins.get("Dialog");return te.set({tooltip:!0}),te.bind("isOn").to(be,"id",xe=>xe==="findAndReplace"),te.on("execute",()=>{te.isOn?be.hide():this._showDialog()}),te}_createDialogButtonForMenuBar(){const t=this._createButton(MenuBarMenuListItemButtonView),te=this.editor.plugins.get("Dialog");return t.on("execute",()=>{if(te.id==="findAndReplace"){te.hide();return}this._showDialog()}),t}_createButton(t){const te=this.editor,be=te.commands.get("find"),xe=new t(te.locale),ve=te.locale.t;return xe.bind("isEnabled").to(be),xe.set({icon:loupeIcon,label:ve("Find and replace"),keystroke:"CTRL+F"}),xe}_showDialog(){const t=this.editor,te=t.plugins.get("Dialog"),be=t.locale.t;this.formView||(this.formView=this._createFormView()),te.show({id:"findAndReplace",title:be("Find and replace"),content:this.formView,position:DialogViewPosition.EDITOR_TOP_SIDE,onShow:()=>{this._setupFormView()},onHide:()=>{this.fire("searchReseted")}})}_createFormView(){const t=this.editor,te=new(CssTransitionDisablerMixin(FindAndReplaceFormView))(t.locale),be=t.commands,ve=this.editor.plugins.get("FindAndReplaceEditing").state;te.bind("highlightOffset").to(ve,"highlightedOffset"),te.listenTo(ve.results,"change",()=>{te.matchCount=ve.results.length});const ke=be.get("findNext"),Ie=be.get("findPrevious"),Ae=be.get("replace"),Se=be.get("replaceAll");return te.bind("_areCommandsEnabled").to(ke,"isEnabled",Ie,"isEnabled",Ae,"isEnabled",Se,"isEnabled",(Oe,Ve,Me,De)=>({findNext:Oe,findPrevious:Ve,replace:Me,replaceAll:De})),te.delegate("findNext","findPrevious","replace","replaceAll").to(this),te.on("change:isDirty",(Oe,Ve,Me)=>{Me&&this.fire("searchReseted")}),te}_setupFormView(){this.formView.disableCssTransitions(),this.formView.reset(),this.formView._findInputView.fieldView.select(),this.formView.enableCssTransitions()}}class FindCommand extends Command{constructor(t,te){super(t);Re(this,"_state");this.isEnabled=!0,this.affectsData=!1,this._state=te}execute(t,{matchCase:te,wholeWords:be}={}){const{editor:xe}=this,{model:ve}=xe,ke=xe.plugins.get("FindAndReplaceUtils");let Ie;typeof t=="string"?(Ie=ke.findByTextCallback(t,{matchCase:te,wholeWords:be}),this._state.searchText=t):Ie=t;const Ae=ve.document.getRootNames().reduce((Se,Oe)=>ke.updateFindResultFromRange(ve.createRangeIn(ve.document.getRoot(Oe)),ve,Ie,Se),null);return this._state.clear(ve),this._state.results.addMany(Ae),this._state.highlightedResult=Ae.get(0),typeof t=="string"&&(this._state.searchText=t),Ie&&(this._state.lastSearchCallback=Ie),this._state.matchCase=!!te,this._state.matchWholeWords=!!be,{results:Ae,findCallback:Ie}}}class ReplaceCommandBase extends Command{constructor(t,te){super(t);Re(this,"_state");this.isEnabled=!0,this._state=te,this._isEnabledBasedOnSelection=!1}_replace(t,te){const{model:be}=this.editor,xe=te.marker.getRange();be.canEditAt(xe)&&be.change(ve=>{if(xe.root.rootName==="$graveyard"){this._state.results.remove(te);return}let ke={};for(const Ie of xe.getItems())if(Ie.is("$text")||Ie.is("$textProxy")){ke=Ie.getAttributes();break}be.insertContent(ve.createText(t,ke),xe),this._state.results.has(te)&&this._state.results.remove(te)})}}class ReplaceCommand extends ReplaceCommandBase{execute(we,t){this._replace(we,t)}}class ReplaceAllCommand extends ReplaceCommandBase{execute(we,t){const{editor:te}=this,{model:be}=te,xe=te.plugins.get("FindAndReplaceUtils"),ve=t instanceof Collection?t:be.document.getRootNames().reduce((ke,Ie)=>xe.updateFindResultFromRange(be.createRangeIn(be.document.getRoot(Ie)),be,xe.findByTextCallback(t,this._state),ke),null);ve.length&&be.change(()=>{[...ve].forEach(ke=>{this._replace(we,ke)})})}}class FindNextCommand extends Command{constructor(t,te){super(t);Re(this,"_state");this.affectsData=!1,this._state=te,this.isEnabled=!1,this.listenTo(this._state.results,"change",()=>{this.isEnabled=this._state.results.length>1})}refresh(){this.isEnabled=this._state.results.length>1}execute(){const t=this._state.results,te=t.getIndex(this._state.highlightedResult),be=te+1>=t.length?0:te+1;this._state.highlightedResult=this._state.results.get(be)}}class FindPreviousCommand extends FindNextCommand{execute(){const t=this._state.results.getIndex(this._state.highlightedResult),te=t-1<0?this._state.results.length-1:t-1;this._state.highlightedResult=this._state.results.get(te)}}class FindAndReplaceState extends ObservableMixin(){constructor(we){super(),this.set("results",new Collection),this.set("highlightedResult",null),this.set("highlightedOffset",0),this.set("searchText",""),this.set("replaceText",""),this.set("lastSearchCallback",null),this.set("matchCase",!1),this.set("matchWholeWords",!1),this.results.on("change",(t,{removed:te,index:be})=>{if(Array.from(te).length){let xe=!1;if(we.change(ve=>{for(const ke of te)this.highlightedResult===ke&&(xe=!0),we.markers.has(ke.marker.name)&&ve.removeMarker(ke.marker)}),xe){const ve=be>=this.results.length?0:be;this.highlightedResult=this.results.get(ve)}}}),this.on("change:highlightedResult",()=>{this.refreshHighlightOffset()})}clear(we){this.searchText="",we.change(t=>{if(this.highlightedResult){const te=this.highlightedResult.marker.name.split(":")[1],be=we.markers.get(`findResultHighlighted:${te}`);be&&t.removeMarker(be)}[...this.results].forEach(({marker:te})=>{t.removeMarker(te)})}),this.results.clear()}refreshHighlightOffset(){const{highlightedResult:we,results:t}=this,te={before:-1,same:0,after:1,different:1};we?this.highlightedOffset=Array.from(t).sort((be,xe)=>te[be.marker.getStart().compareWith(xe.marker.getStart())]).indexOf(we)+1:this.highlightedOffset=0}}class FindAndReplaceUtils extends Plugin{static get pluginName(){return"FindAndReplaceUtils"}updateFindResultFromRange(we,t,te,be){const xe=be||new Collection,ve=ke=>xe.find(Ie=>{const{marker:Ae}=Ie,Se=Ae.getRange(),Oe=ke.getRange();return Se.isEqual(Oe)});return t.change(ke=>{[...we].forEach(({type:Ie,item:Ae})=>{if(Ie==="elementStart"&&t.schema.checkChild(Ae,"$text")){const Se=te({item:Ae,text:this.rangeToText(t.createRangeIn(Ae))});if(!Se)return;Se.forEach(Oe=>{const Ve=`findResult:${uid()}`,Me=ke.addMarker(Ve,{usingOperation:!1,affectsData:!1,range:ke.createRange(ke.createPositionAt(Ae,Oe.start),ke.createPositionAt(Ae,Oe.end))}),De=findInsertIndex(xe,Me);ve(Me)||xe.add({id:Ve,label:Oe.label,marker:Me},De)})}})}),xe}rangeToText(we){return Array.from(we.getItems()).reduce((t,te)=>te.is("$text")||te.is("$textProxy")?t+te.data:`${t}
`,"")}findByTextCallback(we,t){let te="gu";t.matchCase||(te+="i");let be=`(${escapeRegExp(we)})`;if(t.wholeWords){const ke="[^a-zA-ZÀ-ɏḀ-ỿ]";new RegExp("^"+ke).test(we)||(be=`(^|${ke}|_)${be}`),new RegExp(ke+"$").test(we)||(be=`${be}(?=_|${ke}|$)`)}const xe=new RegExp(be,te);function ve({text:ke}){return[...ke.matchAll(xe)].map(regexpMatchToFindResult)}return ve}}function findInsertIndex(Te,we){const t=Te.find(({marker:te})=>we.getStart().isBefore(te.getStart()));return t?Te.getIndex(t):Te.length}function regexpMatchToFindResult(Te){const we=Te.length-1;let t=Te.index;return Te.length===3&&(t+=Te[1].length),{label:Te[we],start:t,end:t+Te[we].length}}const HIGHLIGHT_CLASS$1="ck-find-result_selected";class FindAndReplaceEditing extends Plugin{constructor(){super(...arguments);Re(this,"state");Re(this,"_onDocumentChange",()=>{const t=new Set,te=new Set,be=this.editor.model,{results:xe}=this.state,ve=be.document.differ.getChanges(),ke=be.document.differ.getChangedMarkers();ve.forEach(Se=>{Se.position&&(Se.name==="$text"||Se.position.nodeAfter&&be.schema.isInline(Se.position.nodeAfter)?(t.add(Se.position.parent),[...be.markers.getMarkersAtPosition(Se.position)].forEach(Oe=>{te.add(Oe.name)})):Se.type==="insert"&&Se.position.nodeAfter&&t.add(Se.position.nodeAfter))}),ke.forEach(({name:Se,data:{newRange:Oe}})=>{Oe&&Oe.start.root.rootName==="$graveyard"&&te.add(Se)}),t.forEach(Se=>{[...be.markers.getMarkersIntersectingRange(be.createRangeIn(Se))].forEach(Ve=>te.add(Ve.name))}),te.forEach(Se=>{xe.has(Se)&&(xe.get(Se)===this.state.highlightedResult&&(this.state.highlightedResult=null),xe.remove(Se))});const Ie=[],Ae=this.editor.plugins.get("FindAndReplaceUtils");t.forEach(Se=>{const Oe=Ae.updateFindResultFromRange(be.createRangeOn(Se),be,this.state.lastSearchCallback,xe);Ie.push(...Oe)}),ke.forEach(Se=>{if(Se.data.newRange){const Oe=Ae.updateFindResultFromRange(Se.data.newRange,be,this.state.lastSearchCallback,xe);Ie.push(...Oe)}}),!this.state.highlightedResult&&Ie.length?this.state.highlightedResult=Ie[0]:this.state.refreshHighlightOffset()})}static get requires(){return[FindAndReplaceUtils]}static get pluginName(){return"FindAndReplaceEditing"}init(){this.state=new FindAndReplaceState(this.editor.model),this.set("_isSearchActive",!1),this._defineConverters(),this._defineCommands(),this.listenTo(this.state,"change:highlightedResult",(be,xe,ve,ke)=>{const{model:Ie}=this.editor;Ie.change(Ae=>{if(ke){const Se=ke.marker.name.split(":")[1],Oe=Ie.markers.get(`findResultHighlighted:${Se}`);Oe&&Ae.removeMarker(Oe)}if(ve){const Se=ve.marker.name.split(":")[1];Ae.addMarker(`findResultHighlighted:${Se}`,{usingOperation:!1,affectsData:!1,range:ve.marker.getRange()})}})});/* istanbul ignore next -- @preserve */const te=debounce(((be,xe,ve)=>{if(ve){const ke=this.editor.editing.view.domConverter,Ie=this.editor.editing.mapper.toViewRange(ve.marker.getRange());scrollViewportToShowTarget({target:ke.viewRangeToDom(Ie),viewportOffset:40})}}).bind(this),32);this.listenTo(this.state,"change:highlightedResult",te,{priority:"low"}),this.listenTo(this.editor,"destroy",te.cancel),this.on("change:_isSearchActive",(be,xe,ve)=>{ve?this.listenTo(this.editor.model.document,"change:data",this._onDocumentChange):this.stopListening(this.editor.model.document,"change:data",this._onDocumentChange)})}find(t,te){return this._isSearchActive=!0,this.editor.execute("find",t,te),this.state.results}stop(){this.state.clear(this.editor.model),this._isSearchActive=!1}_defineCommands(){this.editor.commands.add("find",new FindCommand(this.editor,this.state)),this.editor.commands.add("findNext",new FindNextCommand(this.editor,this.state)),this.editor.commands.add("findPrevious",new FindPreviousCommand(this.editor,this.state)),this.editor.commands.add("replace",new ReplaceCommand(this.editor,this.state)),this.editor.commands.add("replaceAll",new ReplaceAllCommand(this.editor,this.state))}_defineConverters(){const{editor:t}=this;t.conversion.for("editingDowncast").markerToHighlight({model:"findResult",view:({markerName:te})=>{const[,be]=te.split(":");return{name:"span",classes:["ck-find-result"],attributes:{"data-find-result":be}}}}),t.conversion.for("editingDowncast").markerToHighlight({model:"findResultHighlighted",view:({markerName:te})=>{const[,be]=te.split(":");return{name:"span",classes:[HIGHLIGHT_CLASS$1],attributes:{"data-find-result":be}}}})}}class FindAndReplace extends Plugin{static get requires(){return[FindAndReplaceEditing,FindAndReplaceUI]}static get pluginName(){return"FindAndReplace"}init(){const we=this.editor.plugins.get("FindAndReplaceUI"),t=this.editor.plugins.get("FindAndReplaceEditing"),te=t.state;we.on("findNext",(be,xe)=>{xe?(te.searchText=xe.searchText,t.find(xe.searchText,xe)):this.editor.execute("findNext")}),we.on("findPrevious",(be,xe)=>{xe&&te.searchText!==xe.searchText?t.find(xe.searchText):this.editor.execute("findPrevious")}),we.on("replace",(be,xe)=>{te.searchText!==xe.searchText&&t.find(xe.searchText);const ve=te.highlightedResult;ve&&this.editor.execute("replace",xe.replaceText,ve)}),we.on("replaceAll",(be,xe)=>{te.searchText!==xe.searchText&&t.find(xe.searchText),this.editor.execute("replaceAll",xe.replaceText,te.results)}),we.on("searchReseted",()=>{te.clear(this.editor.model),t.stop()})}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class FontCommand extends Command{constructor(t,te){super(t);Re(this,"attributeKey");this.attributeKey=te}refresh(){const t=this.editor.model,te=t.document;this.value=te.selection.getAttribute(this.attributeKey),this.isEnabled=t.schema.checkAttributeInSelection(te.selection,this.attributeKey)}execute(t={}){const te=this.editor.model,xe=te.document.selection,ve=t.value,ke=t.batch,Ie=Ae=>{if(xe.isCollapsed)ve?Ae.setSelectionAttribute(this.attributeKey,ve):Ae.removeSelectionAttribute(this.attributeKey);else{const Se=te.schema.getValidRanges(xe.getRanges(),this.attributeKey);for(const Oe of Se)ve?Ae.setAttribute(this.attributeKey,ve,Oe):Ae.removeAttribute(this.attributeKey,Oe)}};ke?te.enqueueChange(ke,Ae=>{Ie(Ae)}):te.change(Ae=>{Ie(Ae)})}}const FONT_SIZE="fontSize",FONT_FAMILY="fontFamily",FONT_COLOR="fontColor",FONT_BACKGROUND_COLOR="fontBackgroundColor";function buildDefinition(Te,we){const t={model:{key:Te,values:[]},view:{},upcastAlso:{}};for(const te of we)t.model.values.push(te.model),t.view[te.model]=te.view,te.upcastAlso&&(t.upcastAlso[te.model]=te.upcastAlso);return t}function renderUpcastAttribute(Te){return we=>normalizeColorCode(we.getStyle(Te))}function renderDowncastElement(Te){return(we,{writer:t})=>t.createAttributeElement("span",{style:`${Te}:${we}`},{priority:7})}function addColorSelectorToDropdown({dropdownView:Te,colors:we,columns:t,removeButtonLabel:te,colorPickerLabel:be,documentColorsLabel:xe,documentColorsCount:ve,colorPickerViewConfig:ke}){const Ie=Te.locale,Ae=new ColorSelectorView(Ie,{colors:we,columns:t,removeButtonLabel:te,colorPickerLabel:be,documentColorsLabel:xe,documentColorsCount:ve,colorPickerViewConfig:ke});return Te.colorSelectorView=Ae,Te.panelView.children.add(Ae),Ae}function normalizeColorCode(Te){return Te.replace(/\s/g,"")}class FontFamilyCommand extends FontCommand{constructor(we){super(we,FONT_FAMILY)}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function normalizeOptions$1(Te){return Te.map(getOptionDefinition$1).filter(we=>we!==void 0)}function getOptionDefinition$1(Te){if(typeof Te=="object")return Te;if(Te==="default")return{title:"Default",model:void 0};if(typeof Te=="string")return generateFontPreset(Te)}function generateFontPreset(Te){const we=Te.replace(/"|'/g,"").split(","),t=we[0],te=we.map(normalizeFontNameForCSS).join(", ");return{title:t,model:te,view:{name:"span",styles:{"font-family":te},priority:7}}}function normalizeFontNameForCSS(Te){return Te=Te.trim(),Te.indexOf(" ")>0&&(Te=`'${Te}'`),Te}class FontFamilyEditing extends Plugin{static get pluginName(){return"FontFamilyEditing"}constructor(we){super(we),we.config.define(FONT_FAMILY,{options:["default","Arial, Helvetica, sans-serif","Courier New, Courier, monospace","Georgia, serif","Lucida Sans Unicode, Lucida Grande, sans-serif","Tahoma, Geneva, sans-serif","Times New Roman, Times, serif","Trebuchet MS, Helvetica, sans-serif","Verdana, Geneva, sans-serif"],supportAllValues:!1})}init(){const we=this.editor;we.model.schema.extend("$text",{allowAttributes:FONT_FAMILY}),we.model.schema.setAttributeProperties(FONT_FAMILY,{isFormatting:!0,copyOnEnter:!0});const t=normalizeOptions$1(we.config.get("fontFamily.options")).filter(be=>be.model),te=buildDefinition(FONT_FAMILY,t);we.config.get("fontFamily.supportAllValues")?(this._prepareAnyValueConverters(),this._prepareCompatibilityConverter()):we.conversion.attributeToElement(te),we.commands.add(FONT_FAMILY,new FontFamilyCommand(we))}_prepareAnyValueConverters(){const we=this.editor;we.conversion.for("downcast").attributeToElement({model:FONT_FAMILY,view:(t,{writer:te})=>te.createAttributeElement("span",{style:"font-family:"+t},{priority:7})}),we.conversion.for("upcast").elementToAttribute({model:{key:FONT_FAMILY,value:t=>t.getStyle("font-family")},view:{name:"span",styles:{"font-family":/.*/}}})}_prepareCompatibilityConverter(){this.editor.conversion.for("upcast").elementToAttribute({view:{name:"font",attributes:{face:/.*/}},model:{key:FONT_FAMILY,value:t=>t.getAttribute("face")}})}}var fontFamilyIcon='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M11.03 3h6.149a.75.75 0 1 1 0 1.5h-5.514L11.03 3zm1.27 3h4.879a.75.75 0 1 1 0 1.5h-4.244L12.3 6zm1.27 3h3.609a.75.75 0 1 1 0 1.5h-2.973L13.57 9zm-2.754 2.5L8.038 4.785 5.261 11.5h5.555zm.62 1.5H4.641l-1.666 4.028H1.312l5.789-14h1.875l5.789 14h-1.663L11.436 13z"/></svg>';class FontFamilyUI extends Plugin{static get pluginName(){return"FontFamilyUI"}init(){const we=this.editor,t=we.t,te=this._getLocalizedOptions(),be=we.commands.get(FONT_FAMILY),xe=t("Font Family"),ve=_prepareListOptions$1(te,be);we.ui.componentFactory.add(FONT_FAMILY,ke=>{const Ie=createDropdown(ke);return addListToDropdown(Ie,ve,{role:"menu",ariaLabel:xe}),Ie.buttonView.set({label:xe,icon:fontFamilyIcon,tooltip:!0}),Ie.extendTemplate({attributes:{class:"ck-font-family-dropdown"}}),Ie.bind("isEnabled").to(be),this.listenTo(Ie,"execute",Ae=>{we.execute(Ae.source.commandName,{value:Ae.source.commandParam}),we.editing.view.focus()}),Ie}),we.ui.componentFactory.add(`menuBar:${FONT_FAMILY}`,ke=>{const Ie=new MenuBarMenuView(ke);Ie.buttonView.set({label:xe,icon:fontFamilyIcon}),Ie.bind("isEnabled").to(be);const Ae=new MenuBarMenuListView(ke);for(const Se of ve){const Oe=new MenuBarMenuListItemView(ke,Ie),Ve=new MenuBarMenuListItemButtonView(ke);Ve.bind(...Object.keys(Se.model)).to(Se.model),Ve.bind("ariaChecked").to(Ve,"isOn"),Ve.delegate("execute").to(Ie),Ve.on("execute",()=>{we.execute(Se.model.commandName,{value:Se.model.commandParam}),we.editing.view.focus()}),Oe.children.add(Ve),Ae.items.add(Oe)}return Ie.panelView.children.add(Ae),Ie})}_getLocalizedOptions(){const we=this.editor,t=we.t;return normalizeOptions$1(we.config.get(FONT_FAMILY).options).map(be=>(be.title==="Default"&&(be.title=t("Default")),be))}}function _prepareListOptions$1(Te,we){const t=new Collection;for(const te of Te){const be={type:"button",model:new Model({commandName:FONT_FAMILY,commandParam:te.model,label:te.title,role:"menuitemradio",withText:!0})};be.model.bind("isOn").to(we,"value",xe=>xe===te.model?!0:!xe||!te.model?!1:xe.split(",")[0].replace(/'/g,"").toLowerCase()===te.model.toLowerCase()),te.view&&typeof te.view!="string"&&te.view.styles&&be.model.set("labelStyle",`font-family: ${te.view.styles["font-family"]}`),t.add(be)}return t}class FontFamily extends Plugin{static get requires(){return[FontFamilyEditing,FontFamilyUI]}static get pluginName(){return"FontFamily"}}class FontSizeCommand extends FontCommand{constructor(we){super(we,FONT_SIZE)}}function normalizeOptions(Te){return Te.map(we=>getOptionDefinition(we)).filter(we=>we!==void 0)}const namedPresets={get tiny(){return{title:"Tiny",model:"tiny",view:{name:"span",classes:"text-tiny",priority:7}}},get small(){return{title:"Small",model:"small",view:{name:"span",classes:"text-small",priority:7}}},get big(){return{title:"Big",model:"big",view:{name:"span",classes:"text-big",priority:7}}},get huge(){return{title:"Huge",model:"huge",view:{name:"span",classes:"text-huge",priority:7}}}};function getOptionDefinition(Te){if(typeof Te=="number"&&(Te=String(Te)),typeof Te=="object"&&isFullItemDefinition(Te))return attachPriority(Te);const we=findPreset(Te);if(we)return attachPriority(we);if(Te==="default")return{model:void 0,title:"Default"};if(!isNumericalDefinition(Te))return generatePixelPreset(Te)}function generatePixelPreset(Te){return typeof Te=="string"&&(Te={title:Te,model:`${parseFloat(Te)}px`}),Te.view={name:"span",styles:{"font-size":Te.model}},attachPriority(Te)}function attachPriority(Te){return Te.view&&typeof Te.view!="string"&&!Te.view.priority&&(Te.view.priority=7),Te}function findPreset(Te){return typeof Te=="string"?namedPresets[Te]:namedPresets[Te.model]}function isFullItemDefinition(Te){return Te.title&&Te.model&&Te.view}function isNumericalDefinition(Te){let we;if(typeof Te=="object")if(Te.model)we=parseFloat(Te.model);else throw new CKEditorError("font-size-invalid-definition",null,Te);else we=parseFloat(Te);return isNaN(we)}const styleFontSize=["x-small","x-small","small","medium","large","x-large","xx-large","xxx-large"];class FontSizeEditing extends Plugin{static get pluginName(){return"FontSizeEditing"}constructor(we){super(we),we.config.define(FONT_SIZE,{options:["tiny","small","default","big","huge"],supportAllValues:!1})}init(){const we=this.editor;we.model.schema.extend("$text",{allowAttributes:FONT_SIZE}),we.model.schema.setAttributeProperties(FONT_SIZE,{isFormatting:!0,copyOnEnter:!0});const t=we.config.get("fontSize.supportAllValues"),te=normalizeOptions(this.editor.config.get("fontSize.options")).filter(xe=>xe.model),be=buildDefinition(FONT_SIZE,te);t?(this._prepareAnyValueConverters(be),this._prepareCompatibilityConverter()):we.conversion.attributeToElement(be),we.commands.add(FONT_SIZE,new FontSizeCommand(we))}_prepareAnyValueConverters(we){const t=this.editor,te=we.model.values.filter(be=>!isLength(String(be))&&!isPercentage(String(be)));if(te.length)throw new CKEditorError("font-size-invalid-use-of-named-presets",null,{presets:te});t.conversion.for("downcast").attributeToElement({model:FONT_SIZE,view:(be,{writer:xe})=>{if(be)return xe.createAttributeElement("span",{style:"font-size:"+be},{priority:7})}}),t.conversion.for("upcast").elementToAttribute({model:{key:FONT_SIZE,value:be=>be.getStyle("font-size")},view:{name:"span",styles:{"font-size":/.*/}}})}_prepareCompatibilityConverter(){this.editor.conversion.for("upcast").elementToAttribute({view:{name:"font",attributes:{size:/^[+-]?\d{1,3}$/}},model:{key:FONT_SIZE,value:t=>{const te=t.getAttribute("size"),be=te[0]==="-"||te[0]==="+";let xe=parseInt(te,10);be&&(xe=3+xe);const ve=styleFontSize.length-1,ke=Math.min(Math.max(xe,0),ve);return styleFontSize[ke]}}})}}var fontSizeIcon='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M9.816 11.5 7.038 4.785 4.261 11.5h5.555zm.62 1.5H3.641l-1.666 4.028H.312l5.789-14h1.875l5.789 14h-1.663L10.436 13zm7.55 2.279.779-.779.707.707-2.265 2.265-2.193-2.265.707-.707.765.765V4.825c0-.042 0-.083.002-.123l-.77.77-.707-.707L17.207 2.5l2.265 2.265-.707.707-.782-.782c.002.043.003.089.003.135v10.454z"/></svg>';class FontSizeUI extends Plugin{static get pluginName(){return"FontSizeUI"}init(){const we=this.editor,t=we.t,te=this._getLocalizedOptions(),be=we.commands.get(FONT_SIZE),xe=t("Font Size"),ve=_prepareListOptions(te,be);we.ui.componentFactory.add(FONT_SIZE,ke=>{const Ie=createDropdown(ke);return addListToDropdown(Ie,ve,{role:"menu",ariaLabel:xe}),Ie.buttonView.set({label:xe,icon:fontSizeIcon,tooltip:!0}),Ie.extendTemplate({attributes:{class:["ck-font-size-dropdown"]}}),Ie.bind("isEnabled").to(be),this.listenTo(Ie,"execute",Ae=>{we.execute(Ae.source.commandName,{value:Ae.source.commandParam}),we.editing.view.focus()}),Ie}),we.ui.componentFactory.add(`menuBar:${FONT_SIZE}`,ke=>{const Ie=new MenuBarMenuView(ke);Ie.buttonView.set({label:xe,icon:fontSizeIcon}),Ie.bind("isEnabled").to(be);const Ae=new MenuBarMenuListView(ke);for(const Se of ve){const Oe=new MenuBarMenuListItemView(ke,Ie),Ve=new MenuBarMenuListItemButtonView(ke);Ve.bind(...Object.keys(Se.model)).to(Se.model),Ve.bind("ariaChecked").to(Ve,"isOn"),Ve.delegate("execute").to(Ie),Ve.on("execute",()=>{we.execute(Se.model.commandName,{value:Se.model.commandParam}),we.editing.view.focus()}),Oe.children.add(Ve),Ae.items.add(Oe)}return Ie.panelView.children.add(Ae),Ie})}_getLocalizedOptions(){const we=this.editor,t=we.t,te={Default:t("Default"),Tiny:t("Tiny"),Small:t("Small"),Big:t("Big"),Huge:t("Huge")};return normalizeOptions(we.config.get(FONT_SIZE).options).map(xe=>{const ve=te[xe.title];return ve&&ve!=xe.title&&(xe=Object.assign({},xe,{title:ve})),xe})}}function _prepareListOptions(Te,we){const t=new Collection;for(const te of Te){const be={type:"button",model:new Model({commandName:FONT_SIZE,commandParam:te.model,label:te.title,class:"ck-fontsize-option",role:"menuitemradio",withText:!0})};te.view&&typeof te.view!="string"&&(te.view.styles&&be.model.set("labelStyle",`font-size:${te.view.styles["font-size"]}`),te.view.classes&&be.model.set("class",`${be.model.class} ${te.view.classes}`)),be.model.bind("isOn").to(we,"value",xe=>xe===te.model),t.add(be)}return t}class FontSize extends Plugin{static get requires(){return[FontSizeEditing,FontSizeUI]}static get pluginName(){return"FontSize"}normalizeSizeOptions(we){return normalizeOptions(we)}}class FontColorCommand extends FontCommand{constructor(we){super(we,FONT_COLOR)}}class FontColorEditing extends Plugin{static get pluginName(){return"FontColorEditing"}constructor(we){super(we),we.config.define(FONT_COLOR,{colors:[{color:"hsl(0, 0%, 0%)",label:"Black"},{color:"hsl(0, 0%, 30%)",label:"Dim grey"},{color:"hsl(0, 0%, 60%)",label:"Grey"},{color:"hsl(0, 0%, 90%)",label:"Light grey"},{color:"hsl(0, 0%, 100%)",label:"White",hasBorder:!0},{color:"hsl(0, 75%, 60%)",label:"Red"},{color:"hsl(30, 75%, 60%)",label:"Orange"},{color:"hsl(60, 75%, 60%)",label:"Yellow"},{color:"hsl(90, 75%, 60%)",label:"Light green"},{color:"hsl(120, 75%, 60%)",label:"Green"},{color:"hsl(150, 75%, 60%)",label:"Aquamarine"},{color:"hsl(180, 75%, 60%)",label:"Turquoise"},{color:"hsl(210, 75%, 60%)",label:"Light blue"},{color:"hsl(240, 75%, 60%)",label:"Blue"},{color:"hsl(270, 75%, 60%)",label:"Purple"}],columns:5}),we.conversion.for("upcast").elementToAttribute({view:{name:"span",styles:{color:/[\s\S]+/}},model:{key:FONT_COLOR,value:renderUpcastAttribute("color")}}),we.conversion.for("upcast").elementToAttribute({view:{name:"font",attributes:{color:/^#?\w+$/}},model:{key:FONT_COLOR,value:t=>t.getAttribute("color")}}),we.conversion.for("downcast").attributeToElement({model:FONT_COLOR,view:renderDowncastElement("color")}),we.commands.add(FONT_COLOR,new FontColorCommand(we)),we.model.schema.extend("$text",{allowAttributes:FONT_COLOR}),we.model.schema.setAttributeProperties(FONT_COLOR,{isFormatting:!0,copyOnEnter:!0})}}class ColorUI extends Plugin{constructor(t,{commandName:te,componentName:be,icon:xe,dropdownLabel:ve}){super(t);Re(this,"commandName");Re(this,"componentName");Re(this,"icon");Re(this,"dropdownLabel");Re(this,"columns");this.commandName=te,this.componentName=be,this.icon=xe,this.dropdownLabel=ve,this.columns=t.config.get(`${this.componentName}.columns`)}init(){const t=this.editor,te=t.locale,be=te.t,xe=t.commands.get(this.commandName),ve=t.config.get(this.componentName),ke=normalizeColorOptions(ve.colors),Ie=getLocalizedColorOptions(te,ke),Ae=ve.documentColors,Se=ve.colorPicker!==!1;t.ui.componentFactory.add(this.componentName,Oe=>{const Ve=createDropdown(Oe);let Me=!1;const De=addColorSelectorToDropdown({dropdownView:Ve,colors:Ie.map(Fe=>({label:Fe.label,color:Fe.model,options:{hasBorder:Fe.hasBorder}})),columns:this.columns,removeButtonLabel:be("Remove color"),colorPickerLabel:be("Color picker"),documentColorsLabel:Ae!==0?be("Document colors"):"",documentColorsCount:Ae===void 0?this.columns:Ae,colorPickerViewConfig:Se?ve.colorPicker||{}:!1});return De.bind("selectedColor").to(xe,"value"),Ve.buttonView.set({label:this.dropdownLabel,icon:this.icon,tooltip:!0}),Ve.extendTemplate({attributes:{class:"ck-color-ui-dropdown"}}),Ve.bind("isEnabled").to(xe),De.on("execute",(Fe,Be)=>{Ve.isOpen&&t.execute(this.commandName,{value:Be.value,batch:this._undoStepBatch}),Be.source!=="colorPicker"&&t.editing.view.focus(),Be.source==="colorPickerSaveButton"&&(Ve.isOpen=!1)}),De.on("colorPicker:show",()=>{this._undoStepBatch=t.model.createBatch()}),De.on("colorPicker:cancel",()=>{this._undoStepBatch.operations.length&&(Ve.isOpen=!1,t.execute("undo",this._undoStepBatch)),t.editing.view.focus()}),Ve.on("change:isOpen",(Fe,Be,$e)=>{Me||(Me=!0,Ve.colorSelectorView.appendUI()),$e&&(Ae!==0&&De.updateDocumentColors(t.model,this.componentName),De.updateSelectedColors(),De.showColorGridsFragment())}),focusChildOnDropdownOpen(Ve,()=>Ve.colorSelectorView.colorGridsFragmentView.staticColorsGrid.items.find(Fe=>Fe.isOn)),Ve}),t.ui.componentFactory.add(`menuBar:${this.componentName}`,Oe=>{const Ve=new MenuBarMenuView(Oe);Ve.buttonView.set({label:this.dropdownLabel,icon:this.icon}),Ve.bind("isEnabled").to(xe);let Me=!1;const De=new ColorSelectorView(Oe,{colors:Ie.map(Fe=>({label:Fe.label,color:Fe.model,options:{hasBorder:Fe.hasBorder}})),columns:this.columns,removeButtonLabel:be("Remove color"),colorPickerLabel:be("Color picker"),documentColorsLabel:Ae!==0?be("Document colors"):"",documentColorsCount:Ae===void 0?this.columns:Ae,colorPickerViewConfig:!1});return De.bind("selectedColor").to(xe,"value"),De.delegate("execute").to(Ve),De.on("execute",(Fe,Be)=>{t.execute(this.commandName,{value:Be.value,batch:this._undoStepBatch}),t.editing.view.focus()}),Ve.on("change:isOpen",(Fe,Be,$e)=>{Me||(Me=!0,De.appendUI()),$e&&(Ae!==0&&De.updateDocumentColors(t.model,this.componentName),De.updateSelectedColors(),De.showColorGridsFragment())}),Ve.panelView.children.add(De),Ve})}}var fontColorIcon='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M12.4 10.3 10 4.5l-2.4 5.8h4.8zm.5 1.2H7.1L5.7 15H4.2l5-12h1.6l5 12h-1.5L13 11.5zm3.1 7H4a1 1 0 0 1 0-2h12a1 1 0 0 1 0 2z"/></svg>';class FontColorUI extends ColorUI{constructor(we){const t=we.locale.t;super(we,{commandName:FONT_COLOR,componentName:FONT_COLOR,icon:fontColorIcon,dropdownLabel:t("Font Color")})}static get pluginName(){return"FontColorUI"}}class FontColor extends Plugin{static get requires(){return[FontColorEditing,FontColorUI]}static get pluginName(){return"FontColor"}}class FontBackgroundColorCommand extends FontCommand{constructor(we){super(we,FONT_BACKGROUND_COLOR)}}class FontBackgroundColorEditing extends Plugin{static get pluginName(){return"FontBackgroundColorEditing"}constructor(we){super(we),we.config.define(FONT_BACKGROUND_COLOR,{colors:[{color:"hsl(0, 0%, 0%)",label:"Black"},{color:"hsl(0, 0%, 30%)",label:"Dim grey"},{color:"hsl(0, 0%, 60%)",label:"Grey"},{color:"hsl(0, 0%, 90%)",label:"Light grey"},{color:"hsl(0, 0%, 100%)",label:"White",hasBorder:!0},{color:"hsl(0, 75%, 60%)",label:"Red"},{color:"hsl(30, 75%, 60%)",label:"Orange"},{color:"hsl(60, 75%, 60%)",label:"Yellow"},{color:"hsl(90, 75%, 60%)",label:"Light green"},{color:"hsl(120, 75%, 60%)",label:"Green"},{color:"hsl(150, 75%, 60%)",label:"Aquamarine"},{color:"hsl(180, 75%, 60%)",label:"Turquoise"},{color:"hsl(210, 75%, 60%)",label:"Light blue"},{color:"hsl(240, 75%, 60%)",label:"Blue"},{color:"hsl(270, 75%, 60%)",label:"Purple"}],columns:5}),we.data.addStyleProcessorRules(addBackgroundRules),we.conversion.for("upcast").elementToAttribute({view:{name:"span",styles:{"background-color":/[\s\S]+/}},model:{key:FONT_BACKGROUND_COLOR,value:renderUpcastAttribute("background-color")}}),we.conversion.for("downcast").attributeToElement({model:FONT_BACKGROUND_COLOR,view:renderDowncastElement("background-color")}),we.commands.add(FONT_BACKGROUND_COLOR,new FontBackgroundColorCommand(we)),we.model.schema.extend("$text",{allowAttributes:FONT_BACKGROUND_COLOR}),we.model.schema.setAttributeProperties(FONT_BACKGROUND_COLOR,{isFormatting:!0,copyOnEnter:!0})}}var fontBackgroundColorIcon='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M4 2h12a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2zm8.38 9.262H7.62L10 5.506l2.38 5.756zm.532 1.285L14.34 16h1.426L10.804 4H9.196L4.234 16H5.66l1.428-3.453h5.824z"/></svg>';class FontBackgroundColorUI extends ColorUI{constructor(we){const t=we.locale.t;super(we,{commandName:FONT_BACKGROUND_COLOR,componentName:FONT_BACKGROUND_COLOR,icon:fontBackgroundColorIcon,dropdownLabel:t("Font Background Color")})}static get pluginName(){return"FontBackgroundColorUI"}}class FontBackgroundColor extends Plugin{static get requires(){return[FontBackgroundColorEditing,FontBackgroundColorUI]}static get pluginName(){return"FontBackgroundColor"}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class ParagraphCommand extends Command{constructor(we){super(we),this._isEnabledBasedOnSelection=!1}refresh(){const we=this.editor.model,t=we.document,te=first(t.selection.getSelectedBlocks());this.value=!!te&&te.is("element","paragraph"),this.isEnabled=!!te&&checkCanBecomeParagraph(te,we.schema)}execute(we={}){const t=this.editor.model,te=t.document,be=we.selection||te.selection;t.canEditAt(be)&&t.change(xe=>{const ve=be.getSelectedBlocks();for(const ke of ve)!ke.is("element","paragraph")&&checkCanBecomeParagraph(ke,t.schema)&&xe.rename(ke,"paragraph")})}}function checkCanBecomeParagraph(Te,we){return we.checkChild(Te.parent,"paragraph")&&!we.isObject(Te)}class InsertParagraphCommand extends Command{constructor(we){super(we),this._isEnabledBasedOnSelection=!1}execute(we){const t=this.editor.model,te=we.attributes;let be=we.position;t.canEditAt(be)&&t.change(xe=>{if(be=this._findPositionToInsertParagraph(be,xe),!be)return;const ve=xe.createElement("paragraph");te&&t.schema.setAllowedAttributes(ve,te,xe),t.insertContent(ve,be),xe.setSelection(ve,"in")})}_findPositionToInsertParagraph(we,t){const te=this.editor.model;if(te.schema.checkChild(we,"paragraph"))return we;const be=te.schema.findAllowedParent(we,"paragraph");if(!be)return null;const xe=we.parent,ve=te.schema.checkChild(xe,"$text");return xe.isEmpty||ve&&we.isAtEnd?te.createPositionAfter(xe):!xe.isEmpty&&ve&&we.isAtStart?te.createPositionBefore(xe):t.split(we,be).position}}const x0=class x0 extends Plugin{static get pluginName(){return"Paragraph"}init(){const we=this.editor,t=we.model;we.commands.add("paragraph",new ParagraphCommand(we)),we.commands.add("insertParagraph",new InsertParagraphCommand(we)),t.schema.register("paragraph",{inheritAllFrom:"$block"}),we.conversion.elementToElement({model:"paragraph",view:"p"}),we.conversion.for("upcast").elementToElement({model:(te,{writer:be})=>!x0.paragraphLikeElements.has(te.name)||te.isEmpty?null:be.createElement("paragraph"),view:/.+/,converterPriority:"low"})}};Re(x0,"paragraphLikeElements",new Set(["blockquote","dd","div","dt","h1","h2","h3","h4","h5","h6","li","p","td","th"]));let Paragraph=x0;/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class HeadingCommand extends Command{constructor(t,te){super(t);Re(this,"modelElements");this.modelElements=te}refresh(){const t=first(this.editor.model.document.selection.getSelectedBlocks());this.value=!!t&&this.modelElements.includes(t.name)&&t.name,this.isEnabled=!!t&&this.modelElements.some(te=>checkCanBecomeHeading(t,te,this.editor.model.schema))}execute(t){const te=this.editor.model,be=te.document,xe=t.value;te.change(ve=>{const ke=Array.from(be.selection.getSelectedBlocks()).filter(Ie=>checkCanBecomeHeading(Ie,xe,te.schema));for(const Ie of ke)Ie.is("element",xe)||ve.rename(Ie,xe)})}}function checkCanBecomeHeading(Te,we,t){return t.checkChild(Te.parent,we)&&!t.isObject(Te)}const defaultModelElement="paragraph";class HeadingEditing extends Plugin{static get pluginName(){return"HeadingEditing"}constructor(we){super(we),we.config.define("heading",{options:[{model:"paragraph",title:"Paragraph",class:"ck-heading_paragraph"},{model:"heading1",view:"h2",title:"Heading 1",class:"ck-heading_heading1"},{model:"heading2",view:"h3",title:"Heading 2",class:"ck-heading_heading2"},{model:"heading3",view:"h4",title:"Heading 3",class:"ck-heading_heading3"}]})}static get requires(){return[Paragraph]}init(){const we=this.editor,t=we.config.get("heading.options"),te=[];for(const be of t)be.model!=="paragraph"&&(we.model.schema.register(be.model,{inheritAllFrom:"$block"}),we.conversion.elementToElement(be),te.push(be.model));this._addDefaultH1Conversion(we),we.commands.add("heading",new HeadingCommand(we,te))}afterInit(){const we=this.editor,t=we.commands.get("enter"),te=we.config.get("heading.options");t&&this.listenTo(t,"afterExecute",(be,xe)=>{const ve=we.model.document.selection.getFirstPosition().parent;te.some(Ie=>ve.is("element",Ie.model))&&!ve.is("element",defaultModelElement)&&ve.childCount===0&&xe.writer.rename(ve,defaultModelElement)})}_addDefaultH1Conversion(we){we.conversion.for("upcast").elementToElement({model:"heading1",view:"h1",converterPriority:priorities.low+1})}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function getLocalizedOptions(Te){const we=Te.t,t={Paragraph:we("Paragraph"),"Heading 1":we("Heading 1"),"Heading 2":we("Heading 2"),"Heading 3":we("Heading 3"),"Heading 4":we("Heading 4"),"Heading 5":we("Heading 5"),"Heading 6":we("Heading 6")};return Te.config.get("heading.options").map(te=>{const be=t[te.title];return be&&be!=te.title&&(te.title=be),te})}class HeadingUI extends Plugin{static get pluginName(){return"HeadingUI"}init(){const we=this.editor,t=we.t,te=getLocalizedOptions(we),be=t("Choose heading"),xe=t("Heading");we.ui.componentFactory.add("heading",ve=>{const ke={},Ie=new Collection,Ae=we.commands.get("heading"),Se=we.commands.get("paragraph"),Oe=[Ae];for(const Me of te){const De={type:"button",model:new Model({label:Me.title,class:Me.class,role:"menuitemradio",withText:!0})};Me.model==="paragraph"?(De.model.bind("isOn").to(Se,"value"),De.model.set("commandName","paragraph"),Oe.push(Se)):(De.model.bind("isOn").to(Ae,"value",Fe=>Fe===Me.model),De.model.set({commandName:"heading",commandValue:Me.model})),Ie.add(De),ke[Me.model]=Me.title}const Ve=createDropdown(ve);return addListToDropdown(Ve,Ie,{ariaLabel:xe,role:"menu"}),Ve.buttonView.set({ariaLabel:xe,ariaLabelledBy:void 0,isOn:!1,withText:!0,tooltip:xe}),Ve.extendTemplate({attributes:{class:["ck-heading-dropdown"]}}),Ve.bind("isEnabled").toMany(Oe,"isEnabled",(...Me)=>Me.some(De=>De)),Ve.buttonView.bind("label").to(Ae,"value",Se,"value",(Me,De)=>{const Fe=De?"paragraph":Me;return typeof Fe=="boolean"||!ke[Fe]?be:ke[Fe]}),Ve.buttonView.bind("ariaLabel").to(Ae,"value",Se,"value",(Me,De)=>{const Fe=De?"paragraph":Me;return typeof Fe=="boolean"||!ke[Fe]?xe:`${ke[Fe]}, ${xe}`}),this.listenTo(Ve,"execute",Me=>{const{commandName:De,commandValue:Fe}=Me.source;we.execute(De,Fe?{value:Fe}:void 0),we.editing.view.focus()}),Ve}),we.ui.componentFactory.add("menuBar:heading",ve=>{const ke=new MenuBarMenuView(ve),Ie=we.commands.get("heading"),Ae=we.commands.get("paragraph"),Se=[Ie],Oe=new MenuBarMenuListView(ve);ke.set({class:"ck-heading-dropdown"}),Oe.set({ariaLabel:t("Heading"),role:"menu"}),ke.buttonView.set({label:t("Heading")}),ke.panelView.children.add(Oe);for(const Ve of te){const Me=new MenuBarMenuListItemView(ve,ke),De=new MenuBarMenuListItemButtonView(ve);Me.children.add(De),Oe.items.add(Me),De.set({label:Ve.title,role:"menuitemradio",class:Ve.class}),De.bind("ariaChecked").to(De,"isOn"),De.delegate("execute").to(ke),De.on("execute",()=>{const Fe=Ve.model==="paragraph"?"paragraph":"heading";we.execute(Fe,{value:Ve.model}),we.editing.view.focus()}),Ve.model==="paragraph"?(De.bind("isOn").to(Ae,"value"),Se.push(Ae)):De.bind("isOn").to(Ie,"value",Fe=>Fe===Ve.model)}return ke.bind("isEnabled").toMany(Se,"isEnabled",(...Ve)=>Ve.some(Me=>Me)),ke})}}class Heading extends Plugin{static get requires(){return[HeadingEditing,HeadingUI]}static get pluginName(){return"Heading"}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class HighlightCommand extends Command{refresh(){const we=this.editor.model,t=we.document;this.value=t.selection.getAttribute("highlight"),this.isEnabled=we.schema.checkAttributeInSelection(t.selection,"highlight")}execute(we={}){const t=this.editor.model,be=t.document.selection,xe=we.value;t.change(ve=>{if(be.isCollapsed){const ke=be.getFirstPosition();if(be.hasAttribute("highlight")){const Ie=Ve=>Ve.item.hasAttribute("highlight")&&Ve.item.getAttribute("highlight")===this.value,Ae=ke.getLastMatchingPosition(Ie,{direction:"backward"}),Se=ke.getLastMatchingPosition(Ie),Oe=ve.createRange(Ae,Se);!xe||this.value===xe?(ke.isEqual(Se)||ve.removeAttribute("highlight",Oe),ve.removeSelectionAttribute("highlight")):(ke.isEqual(Se)||ve.setAttribute("highlight",xe,Oe),ve.setSelectionAttribute("highlight",xe))}else xe&&ve.setSelectionAttribute("highlight",xe)}else{const ke=t.schema.getValidRanges(be.getRanges(),"highlight");for(const Ie of ke)xe?ve.setAttribute("highlight",xe,Ie):ve.removeAttribute("highlight",Ie)}})}}class HighlightEditing extends Plugin{static get pluginName(){return"HighlightEditing"}constructor(we){super(we),we.config.define("highlight",{options:[{model:"yellowMarker",class:"marker-yellow",title:"Yellow marker",color:"var(--ck-highlight-marker-yellow)",type:"marker"},{model:"greenMarker",class:"marker-green",title:"Green marker",color:"var(--ck-highlight-marker-green)",type:"marker"},{model:"pinkMarker",class:"marker-pink",title:"Pink marker",color:"var(--ck-highlight-marker-pink)",type:"marker"},{model:"blueMarker",class:"marker-blue",title:"Blue marker",color:"var(--ck-highlight-marker-blue)",type:"marker"},{model:"redPen",class:"pen-red",title:"Red pen",color:"var(--ck-highlight-pen-red)",type:"pen"},{model:"greenPen",class:"pen-green",title:"Green pen",color:"var(--ck-highlight-pen-green)",type:"pen"}]})}init(){const we=this.editor;we.model.schema.extend("$text",{allowAttributes:"highlight"});const t=we.config.get("highlight.options");we.conversion.attributeToElement(_buildDefinition(t)),we.commands.add("highlight",new HighlightCommand(we))}}function _buildDefinition(Te){const we={model:{key:"highlight",values:[]},view:{}};for(const t of Te)we.model.values.push(t.model),we.view[t.model]={name:"mark",classes:t.class};return we}var markerIcon='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path class="ck-icon__fill" d="M10.798 1.59 3.002 12.875l1.895 1.852 2.521 1.402 6.997-12.194z"/><path d="m2.556 16.727.234-.348c-.297-.151-.462-.293-.498-.426-.036-.137.002-.416.115-.837.094-.25.15-.449.169-.595a4.495 4.495 0 0 0 0-.725c-.209-.621-.303-1.041-.284-1.26.02-.218.178-.506.475-.862l6.77-9.414c.539-.91 1.605-.85 3.199.18 1.594 1.032 2.188 1.928 1.784 2.686l-5.877 10.36c-.158.412-.333.673-.526.782-.193.108-.604.179-1.232.21-.362.131-.608.237-.738.318-.13.081-.305.238-.526.47-.293.265-.504.397-.632.397-.096 0-.27-.075-.524-.226l-.31.41-1.6-1.12zm-.279.415 1.575 1.103-.392.515H1.19l1.087-1.618zm8.1-13.656-4.953 6.9L8.75 12.57l4.247-7.574c.175-.25-.188-.647-1.092-1.192-.903-.546-1.412-.652-1.528-.32zM8.244 18.5 9.59 17h9.406v1.5H8.245z"/></svg>',penIcon='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path class="ck-icon__fill" d="M10.126 2.268 2.002 13.874l1.895 1.852 2.521 1.402L14.47 5.481l-1.543-2.568-2.801-.645z"/><path d="m4.5 18.088-2.645-1.852-.04-2.95-.006-.005.006-.008v-.025l.011.008L8.73 2.97c.165-.233.356-.417.567-.557l-1.212.308L4.604 7.9l-.83-.558 3.694-5.495 2.708-.69 1.65 1.145.046.018.85-1.216 2.16 1.512-.856 1.222c.828.967 1.144 2.141.432 3.158L7.55 17.286l.006.005-3.055.797H4.5zm-.634.166-1.976.516-.026-1.918 2.002 1.402zM9.968 3.817l-.006-.004-6.123 9.184 3.277 2.294 6.108-9.162.005.003c.317-.452-.16-1.332-1.064-1.966-.891-.624-1.865-.776-2.197-.349zM8.245 18.5 9.59 17h9.406v1.5H8.245z"/></svg>';class HighlightUI extends Plugin{get localizedOptionTitles(){const we=this.editor.t;return{"Yellow marker":we("Yellow marker"),"Green marker":we("Green marker"),"Pink marker":we("Pink marker"),"Blue marker":we("Blue marker"),"Red pen":we("Red pen"),"Green pen":we("Green pen")}}static get pluginName(){return"HighlightUI"}init(){const we=this.editor.config.get("highlight.options");for(const t of we)this._addHighlighterButton(t);this._addRemoveHighlightButton(),this._addDropdown(we),this._addMenuBarButton(we)}_addRemoveHighlightButton(){const we=this.editor.t,t=this.editor.commands.get("highlight");this._addButton("removeHighlight",we("Remove highlight"),icons.eraser,null,te=>{te.bind("isEnabled").to(t,"isEnabled")})}_addHighlighterButton(we){const t=this.editor.commands.get("highlight");this._addButton("highlight:"+we.model,we.title,getIconForType(we.type),we.model,te);function te(be){be.bind("isEnabled").to(t,"isEnabled"),be.bind("isOn").to(t,"value",xe=>xe===we.model),be.iconView.fillColor=we.color,be.isToggleable=!0}}_addButton(we,t,te,be,xe){const ve=this.editor;ve.ui.componentFactory.add(we,ke=>{const Ie=new ButtonView(ke),Ae=this.localizedOptionTitles[t]?this.localizedOptionTitles[t]:t;return Ie.set({label:Ae,icon:te,tooltip:!0}),Ie.on("execute",()=>{ve.execute("highlight",{value:be}),ve.editing.view.focus()}),xe(Ie),Ie})}_addDropdown(we){const t=this.editor,te=t.t,be=t.ui.componentFactory,xe=we[0],ve=we.reduce((ke,Ie)=>(ke[Ie.model]=Ie,ke),{});be.add("highlight",ke=>{const Ie=t.commands.get("highlight"),Ae=createDropdown(ke,SplitButtonView),Se=Ae.buttonView;Se.set({label:te("Highlight"),tooltip:!0,lastExecuted:xe.model,commandValue:xe.model,isToggleable:!0}),Se.bind("icon").to(Ie,"value",Me=>getIconForType(Ve(Me,"type"))),Se.bind("color").to(Ie,"value",Me=>Ve(Me,"color")),Se.bind("commandValue").to(Ie,"value",Me=>Ve(Me,"model")),Se.bind("isOn").to(Ie,"value",Me=>!!Me),Se.delegate("execute").to(Ae);const Oe=()=>{const Me=we.map(De=>{const Fe=be.create("highlight:"+De.model);return this.listenTo(Fe,"execute",()=>{Ae.buttonView.set({lastExecuted:De.model})}),Fe});return Me.push(new ToolbarSeparatorView),Me.push(be.create("removeHighlight")),Me};Ae.bind("isEnabled").to(Ie,"isEnabled"),addToolbarToDropdown(Ae,Oe,{enableActiveItemFocusOnDropdownOpen:!0,ariaLabel:te("Text highlight toolbar")}),bindToolbarIconStyleToActiveColor(Ae),Se.on("execute",()=>{t.execute("highlight",{value:Se.commandValue})}),this.listenTo(Ae,"execute",()=>{t.editing.view.focus()});function Ve(Me,De){const Fe=!Me||Me===Se.lastExecuted?Se.lastExecuted:Me;return ve[Fe][De]}return Ae})}_addMenuBarButton(we){const t=this.editor,te=t.t;t.ui.componentFactory.add("menuBar:highlight",be=>{const xe=t.commands.get("highlight"),ve=new MenuBarMenuView(be);ve.buttonView.set({label:te("Highlight"),icon:getIconForType("marker")}),ve.bind("isEnabled").to(xe),ve.buttonView.iconView.fillColor="transparent";const ke=new MenuBarMenuListView(be);for(const Se of we){const Oe=new MenuBarMenuListItemView(be,ve),Ve=new MenuBarMenuListItemButtonView(be);Ve.set({label:Se.title,icon:getIconForType(Se.type)}),Ve.delegate("execute").to(ve),Ve.bind("isOn").to(xe,"value",Me=>Me===Se.model),Ve.bind("ariaChecked").to(Ve,"isOn"),Ve.iconView.bind("fillColor").to(Ve,"isOn",Me=>Me?"transparent":Se.color),Ve.on("execute",()=>{t.execute("highlight",{value:Se.model}),t.editing.view.focus()}),Oe.children.add(Ve),ke.items.add(Oe)}ke.items.add(new ListSeparatorView(be));const Ie=new MenuBarMenuListItemView(be,ve),Ae=new MenuBarMenuListItemButtonView(be);return Ae.set({label:te("Remove highlight"),icon:icons.eraser}),Ae.delegate("execute").to(ve),Ae.on("execute",()=>{t.execute("highlight",{value:null}),t.editing.view.focus()}),Ie.children.add(Ae),ke.items.add(Ie),ve.panelView.children.add(ke),ve})}}function bindToolbarIconStyleToActiveColor(Te){Te.buttonView.actionView.iconView.bind("fillColor").to(Te.buttonView,"color")}function getIconForType(Te){return Te==="marker"?markerIcon:penIcon}class Highlight extends Plugin{static get requires(){return[HighlightEditing,HighlightUI]}static get pluginName(){return"Highlight"}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class HorizontalLineCommand extends Command{refresh(){const we=this.editor.model,t=we.schema,te=we.document.selection;this.isEnabled=isHorizontalLineAllowedInParent(te,t,we)}execute(){const we=this.editor.model;we.change(t=>{const te=t.createElement("horizontalLine");we.insertObject(te,null,null,{setSelection:"after"})})}}function isHorizontalLineAllowedInParent(Te,we,t){const te=getInsertHorizontalLineParent(Te,t);return we.checkChild(te,"horizontalLine")}function getInsertHorizontalLineParent(Te,we){const te=findOptimalInsertionRange(Te,we).start.parent;return te.isEmpty&&!te.is("element","$root")?te.parent:te}class HorizontalLineEditing extends Plugin{static get pluginName(){return"HorizontalLineEditing"}init(){const we=this.editor,t=we.model.schema,te=we.t,be=we.conversion;t.register("horizontalLine",{inheritAllFrom:"$blockObject"}),be.for("dataDowncast").elementToElement({model:"horizontalLine",view:(xe,{writer:ve})=>ve.createEmptyElement("hr")}),be.for("editingDowncast").elementToStructure({model:"horizontalLine",view:(xe,{writer:ve})=>{const ke=te("Horizontal line"),Ie=ve.createContainerElement("div",null,ve.createEmptyElement("hr"));return ve.addClass("ck-horizontal-line",Ie),ve.setCustomProperty("hr",!0,Ie),toHorizontalLineWidget(Ie,ve,ke)}}),be.for("upcast").elementToElement({view:"hr",model:"horizontalLine"}),we.commands.add("horizontalLine",new HorizontalLineCommand(we))}}function toHorizontalLineWidget(Te,we,t){return we.setCustomProperty("horizontalLine",!0,Te),toWidget(Te,we,{label:t})}class HorizontalLineUI extends Plugin{static get pluginName(){return"HorizontalLineUI"}init(){const we=this.editor;we.ui.componentFactory.add("horizontalLine",()=>{const t=this._createButton(ButtonView);return t.set({tooltip:!0}),t}),we.ui.componentFactory.add("menuBar:horizontalLine",()=>this._createButton(MenuBarMenuListItemButtonView))}_createButton(we){const t=this.editor,te=t.locale,be=t.commands.get("horizontalLine"),xe=new we(t.locale),ve=te.t;return xe.set({label:ve("Horizontal line"),icon:icons.horizontalLine}),xe.bind("isEnabled").to(be,"isEnabled"),this.listenTo(xe,"execute",()=>{t.execute("horizontalLine"),t.editing.view.focus()}),xe}}class HorizontalLine extends Plugin{static get requires(){return[HorizontalLineEditing,HorizontalLineUI,Widget]}static get pluginName(){return"HorizontalLine"}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function createInlineImageViewElement(Te){return Te.createContainerElement("span",{class:"image-inline"},Te.createEmptyElement("img"))}function createBlockImageViewElement(Te){return Te.createContainerElement("figure",{class:"image"},[Te.createEmptyElement("img"),Te.createSlot("children")])}function getImgViewElementMatcher(Te,we){const t=Te.plugins.get("ImageUtils"),te=Te.plugins.has("ImageInlineEditing")&&Te.plugins.has("ImageBlockEditing");return xe=>t.isInlineImageView(xe)?te&&(xe.getStyle("display")=="block"||xe.findAncestor(t.isBlockImageView)?"imageBlock":"imageInline")!==we?null:be(xe):null;function be(xe){const ve={name:!0};return xe.hasAttribute("src")&&(ve.attributes=["src"]),ve}}function determineImageTypeForInsertionAtSelection(Te,we){const t=first(we.getSelectedBlocks());return!t||Te.isObject(t)||t.isEmpty&&t.name!="listItem"?"imageBlock":"imageInline"}function getSizeValueIfInPx(Te){return Te&&Te.endsWith("px")?parseInt(Te):null}function widthAndHeightStylesAreBothSet(Te){const we=getSizeValueIfInPx(Te.getStyle("width")),t=getSizeValueIfInPx(Te.getStyle("height"));return!!(we&&t)}const IMAGE_WIDGETS_CLASSES_MATCH_REGEXP=/^(image|image-inline)$/;class ImageUtils extends Plugin{constructor(){super(...arguments);Re(this,"_domEmitter",new(DomEmitterMixin()))}static get pluginName(){return"ImageUtils"}isImage(t){return this.isInlineImage(t)||this.isBlockImage(t)}isInlineImageView(t){return!!t&&t.is("element","img")}isBlockImageView(t){return!!t&&t.is("element","figure")&&t.hasClass("image")}insertImage(t={},te=null,be=null,xe={}){const ve=this.editor,ke=ve.model,Ie=ke.document.selection,Ae=determineImageTypeForInsertion(ve,te||Ie,be);t={...Object.fromEntries(Ie.getAttributes()),...t};for(const Se in t)ke.schema.checkAttribute(Ae,Se)||delete t[Se];return ke.change(Se=>{const{setImageSizes:Oe=!0}=xe,Ve=Se.createElement(Ae,t);return ke.insertObject(Ve,te,null,{setSelection:"on",findOptimalPosition:!te&&Ae!="imageInline"?"auto":void 0}),Ve.parent?(Oe&&this.setImageNaturalSizeAttributes(Ve),Ve):null})}setImageNaturalSizeAttributes(t){const te=t.getAttribute("src");te&&(t.getAttribute("width")||t.getAttribute("height")||this.editor.model.change(be=>{const xe=new global.window.Image;this._domEmitter.listenTo(xe,"load",()=>{!t.getAttribute("width")&&!t.getAttribute("height")&&this.editor.model.enqueueChange(be.batch,ve=>{ve.setAttribute("width",xe.naturalWidth,t),ve.setAttribute("height",xe.naturalHeight,t)}),this._domEmitter.stopListening(xe,"load")}),xe.src=te}))}getClosestSelectedImageWidget(t){const te=t.getFirstPosition();if(!te)return null;const be=t.getSelectedElement();if(be&&this.isImageWidget(be))return be;let xe=te.parent;for(;xe;){if(xe.is("element")&&this.isImageWidget(xe))return xe;xe=xe.parent}return null}getClosestSelectedImageElement(t){const te=t.getSelectedElement();return this.isImage(te)?te:t.getFirstPosition().findAncestor("imageBlock")}getImageWidgetFromImageView(t){return t.findAncestor({classes:IMAGE_WIDGETS_CLASSES_MATCH_REGEXP})}isImageAllowed(){const te=this.editor.model.document.selection;return isImageAllowedInParent(this.editor,te)&&isNotInsideImage(te)}toImageWidget(t,te,be){return te.setCustomProperty("image",!0,t),toWidget(t,te,{label:()=>{const ke=this.findViewImgElement(t).getAttribute("alt");return ke?`${ke} ${be}`:be}})}isImageWidget(t){return!!t.getCustomProperty("image")&&isWidget(t)}isBlockImage(t){return!!t&&t.is("element","imageBlock")}isInlineImage(t){return!!t&&t.is("element","imageInline")}findViewImgElement(t){if(this.isInlineImageView(t))return t;const te=this.editor.editing.view;for(const{item:be}of te.createRangeIn(t))if(this.isInlineImageView(be))return be}destroy(){return this._domEmitter.stopListening(),super.destroy()}}function isImageAllowedInParent(Te,we){if(determineImageTypeForInsertion(Te,we,null)=="imageBlock"){const te=getInsertImageParent(we,Te.model);if(Te.model.schema.checkChild(te,"imageBlock"))return!0}else if(Te.model.schema.checkChild(we.focus,"imageInline"))return!0;return!1}function isNotInsideImage(Te){return[...Te.focus.getAncestors()].every(we=>!we.is("element","imageBlock"))}function getInsertImageParent(Te,we){const te=findOptimalInsertionRange(Te,we).start.parent;return te.isEmpty&&!te.is("element","$root")?te.parent:te}function determineImageTypeForInsertion(Te,we,t){const te=Te.model.schema,be=Te.config.get("image.insert.type");return Te.plugins.has("ImageBlockEditing")?Te.plugins.has("ImageInlineEditing")?t||(be==="inline"?"imageInline":be!=="auto"?"imageBlock":we.is("selection")?determineImageTypeForInsertionAtSelection(te,we):te.checkChild(we,"imageInline")?"imageInline":"imageBlock"):"imageBlock":"imageInline"}const IMAGE_URL_REGEXP=new RegExp(String(/^(http(s)?:\/\/)?[\w-]+\.[\w.~:/[\]@!$&'()*+,;=%-]+/.source+/\.(jpg|jpeg|png|gif|ico|webp|JPG|JPEG|PNG|GIF|ICO|WEBP)/.source+/(\?[\w.~:/[\]@!$&'()*+,;=%-]*)?/.source+/(#[\w.~:/[\]@!$&'()*+,;=%-]*)?$/.source));class AutoImage extends Plugin{constructor(t){super(t);Re(this,"_timeoutId");Re(this,"_positionToInsert");this._timeoutId=null,this._positionToInsert=null}static get requires(){return[Clipboard,ImageUtils,Undo,Delete]}static get pluginName(){return"AutoImage"}init(){const t=this.editor,te=t.model.document,be=t.plugins.get("ClipboardPipeline");this.listenTo(be,"inputTransformation",()=>{const xe=te.selection.getFirstRange(),ve=LivePosition.fromPosition(xe.start);ve.stickiness="toPrevious";const ke=LivePosition.fromPosition(xe.end);ke.stickiness="toNext",te.once("change:data",()=>{this._embedImageBetweenPositions(ve,ke),ve.detach(),ke.detach()},{priority:"high"})}),t.commands.get("undo").on("execute",()=>{this._timeoutId&&(global.window.clearTimeout(this._timeoutId),this._positionToInsert.detach(),this._timeoutId=null,this._positionToInsert=null)},{priority:"high"})}_embedImageBetweenPositions(t,te){const be=this.editor,xe=new LiveRange(t,te),ve=xe.getWalker({ignoreElementEnd:!0}),ke=Object.fromEntries(be.model.document.selection.getAttributes()),Ie=this.editor.plugins.get("ImageUtils");let Ae="";for(const Se of ve)Se.item.is("$textProxy")&&(Ae+=Se.item.data);if(Ae=Ae.trim(),!Ae.match(IMAGE_URL_REGEXP)){xe.detach();return}this._positionToInsert=LivePosition.fromPosition(t),this._timeoutId=setTimeout(()=>{if(!be.commands.get("insertImage").isEnabled){xe.detach();return}be.model.change(Ve=>{this._timeoutId=null,Ve.remove(xe),xe.detach();let Me;this._positionToInsert.root.rootName!=="$graveyard"&&(Me=this._positionToInsert.toPosition()),Ie.insertImage({...ke,src:Ae},Me),this._positionToInsert.detach(),this._positionToInsert=null}),be.plugins.get("Delete").requestUndoOnBackspace()},100)}}class ImageTextAlternativeCommand extends Command{refresh(){const te=this.editor.plugins.get("ImageUtils").getClosestSelectedImageElement(this.editor.model.document.selection);this.isEnabled=!!te,this.isEnabled&&te.hasAttribute("alt")?this.value=te.getAttribute("alt"):this.value=!1}execute(we){const t=this.editor,te=t.plugins.get("ImageUtils"),be=t.model,xe=te.getClosestSelectedImageElement(be.document.selection);be.change(ve=>{ve.setAttribute("alt",we.newValue,xe)})}}class ImageTextAlternativeEditing extends Plugin{static get requires(){return[ImageUtils]}static get pluginName(){return"ImageTextAlternativeEditing"}init(){this.editor.commands.add("imageTextAlternative",new ImageTextAlternativeCommand(this.editor))}}class TextAlternativeFormView extends View{constructor(t){super(t);Re(this,"focusTracker");Re(this,"keystrokes");Re(this,"labeledInput");Re(this,"saveButtonView");Re(this,"cancelButtonView");Re(this,"_focusables");Re(this,"_focusCycler");const te=this.locale.t;this.focusTracker=new FocusTracker,this.keystrokes=new KeystrokeHandler,this.labeledInput=this._createLabeledInputView(),this.saveButtonView=this._createButton(te("Save"),icons.check,"ck-button-save"),this.saveButtonView.type="submit",this.cancelButtonView=this._createButton(te("Cancel"),icons.cancel,"ck-button-cancel","cancel"),this._focusables=new ViewCollection,this._focusCycler=new FocusCycler({focusables:this._focusables,focusTracker:this.focusTracker,keystrokeHandler:this.keystrokes,actions:{focusPrevious:"shift + tab",focusNext:"tab"}}),this.setTemplate({tag:"form",attributes:{class:["ck","ck-text-alternative-form","ck-responsive-form"],tabindex:"-1"},children:[this.labeledInput,this.saveButtonView,this.cancelButtonView]})}render(){super.render(),this.keystrokes.listenTo(this.element),submitHandler({view:this}),[this.labeledInput,this.saveButtonView,this.cancelButtonView].forEach(t=>{this._focusables.add(t),this.focusTracker.add(t.element)})}destroy(){super.destroy(),this.focusTracker.destroy(),this.keystrokes.destroy()}_createButton(t,te,be,xe){const ve=new ButtonView(this.locale);return ve.set({label:t,icon:te,tooltip:!0}),ve.extendTemplate({attributes:{class:be}}),xe&&ve.delegate("execute").to(this,xe),ve}_createLabeledInputView(){const t=this.locale.t,te=new LabeledFieldView(this.locale,createLabeledInputText);return te.label=t("Text alternative"),te}}function repositionContextualBalloon$1(Te){const we=Te.plugins.get("ContextualBalloon");if(Te.plugins.get("ImageUtils").getClosestSelectedImageWidget(Te.editing.view.document.selection)){const te=getBalloonPositionData(Te);we.updatePosition(te)}}function getBalloonPositionData(Te){const we=Te.editing.view,t=BalloonPanelView.defaultPositions,te=Te.plugins.get("ImageUtils");return{target:we.domConverter.mapViewToDom(te.getClosestSelectedImageWidget(we.document.selection)),positions:[t.northArrowSouth,t.northArrowSouthWest,t.northArrowSouthEast,t.southArrowNorth,t.southArrowNorthWest,t.southArrowNorthEast,t.viewportStickyNorth]}}class ImageTextAlternativeUI extends Plugin{constructor(){super(...arguments);Re(this,"_balloon");Re(this,"_form")}static get requires(){return[ContextualBalloon]}static get pluginName(){return"ImageTextAlternativeUI"}init(){this._createButton()}destroy(){super.destroy(),this._form&&this._form.destroy()}_createButton(){const t=this.editor,te=t.t;t.ui.componentFactory.add("imageTextAlternative",be=>{const xe=t.commands.get("imageTextAlternative"),ve=new ButtonView(be);return ve.set({label:te("Change image text alternative"),icon:icons.textAlternative,tooltip:!0}),ve.bind("isEnabled").to(xe,"isEnabled"),ve.bind("isOn").to(xe,"value",ke=>!!ke),this.listenTo(ve,"execute",()=>{this._showForm()}),ve})}_createForm(){const t=this.editor,be=t.editing.view.document,xe=t.plugins.get("ImageUtils");this._balloon=this.editor.plugins.get("ContextualBalloon"),this._form=new(CssTransitionDisablerMixin(TextAlternativeFormView))(t.locale),this._form.render(),this.listenTo(this._form,"submit",()=>{t.execute("imageTextAlternative",{newValue:this._form.labeledInput.fieldView.element.value}),this._hideForm(!0)}),this.listenTo(this._form,"cancel",()=>{this._hideForm(!0)}),this._form.keystrokes.set("Esc",(ve,ke)=>{this._hideForm(!0),ke()}),this.listenTo(t.ui,"update",()=>{xe.getClosestSelectedImageWidget(be.selection)?this._isVisible&&repositionContextualBalloon$1(t):this._hideForm(!0)}),clickOutsideHandler({emitter:this._form,activator:()=>this._isVisible,contextElements:()=>[this._balloon.view.element],callback:()=>this._hideForm()})}_showForm(){if(this._isVisible)return;this._form||this._createForm();const t=this.editor,te=t.commands.get("imageTextAlternative"),be=this._form.labeledInput;this._form.disableCssTransitions(),this._isInBalloon||this._balloon.add({view:this._form,position:getBalloonPositionData(t)}),be.fieldView.value=be.fieldView.element.value=te.value||"",this._form.labeledInput.fieldView.select(),this._form.enableCssTransitions()}_hideForm(t=!1){this._isInBalloon&&(this._form.focusTracker.isFocused&&this._form.saveButtonView.focus(),this._balloon.remove(this._form),t&&this.editor.editing.view.focus())}get _isVisible(){return!!this._balloon&&this._balloon.visibleView===this._form}get _isInBalloon(){return!!this._balloon&&this._balloon.hasView(this._form)}}class ImageTextAlternative extends Plugin{static get requires(){return[ImageTextAlternativeEditing,ImageTextAlternativeUI]}static get pluginName(){return"ImageTextAlternative"}}function upcastImageFigure(Te){const we=(t,te,be)=>{if(!be.consumable.test(te.viewItem,{name:!0,classes:"image"}))return;const xe=Te.findViewImgElement(te.viewItem);if(!xe||!be.consumable.test(xe,{name:!0}))return;be.consumable.consume(te.viewItem,{name:!0,classes:"image"});const ve=be.convertItem(xe,te.modelCursor),ke=first(ve.modelRange.getItems());if(!ke){be.consumable.revert(te.viewItem,{name:!0,classes:"image"});return}be.convertChildren(te.viewItem,ke),be.updateConversionResult(ke,te)};return t=>{t.on("element:figure",we)}}function upcastPicture(Te){const we=["srcset","media","type","sizes"],t=(te,be,xe)=>{const ve=be.viewItem;if(!xe.consumable.test(ve,{name:!0}))return;const ke=new Map;for(const Se of ve.getChildren())if(Se.is("element","source")){const Oe={};for(const Ve of we)Se.hasAttribute(Ve)&&xe.consumable.test(Se,{attributes:Ve})&&(Oe[Ve]=Se.getAttribute(Ve));Object.keys(Oe).length&&ke.set(Se,Oe)}const Ie=Te.findViewImgElement(ve);if(!Ie)return;let Ae=be.modelCursor.parent;if(!Ae.is("element","imageBlock")){const Se=xe.convertItem(Ie,be.modelCursor);be.modelRange=Se.modelRange,be.modelCursor=Se.modelCursor,Ae=first(Se.modelRange.getItems())}xe.consumable.consume(ve,{name:!0});for(const[Se,Oe]of ke)xe.consumable.consume(Se,{attributes:Object.keys(Oe)});ke.size&&xe.writer.setAttribute("sources",Array.from(ke.values()),Ae),xe.convertChildren(ve,Ae)};return te=>{te.on("element:picture",t)}}function downcastSrcsetAttribute(Te,we){const t=(te,be,xe)=>{if(!xe.consumable.consume(be.item,te.name))return;const ve=xe.writer,ke=xe.mapper.toViewElement(be.item),Ie=Te.findViewImgElement(ke);be.attributeNewValue===null?(ve.removeAttribute("srcset",Ie),ve.removeAttribute("sizes",Ie)):be.attributeNewValue&&(ve.setAttribute("srcset",be.attributeNewValue,Ie),ve.setAttribute("sizes","100vw",Ie))};return te=>{te.on(`attribute:srcset:${we}`,t)}}function downcastSourcesAttribute(Te){const we=(t,te,be)=>{if(!be.consumable.consume(te.item,t.name))return;const xe=be.writer,ve=be.mapper.toViewElement(te.item),ke=Te.findViewImgElement(ve),Ie=te.attributeNewValue;if(Ie&&Ie.length){const Ae=xe.createContainerElement("picture",null,Ie.map(Ve=>xe.createEmptyElement("source",Ve))),Se=[];let Oe=ke.parent;for(;Oe&&Oe.is("attributeElement");){const Ve=Oe.parent;xe.unwrap(xe.createRangeOn(ke),Oe),Se.unshift(Oe),Oe=Ve}xe.insert(xe.createPositionBefore(ke),Ae),xe.move(xe.createRangeOn(ke),xe.createPositionAt(Ae,"end"));for(const Ve of Se)xe.wrap(xe.createRangeOn(Ae),Ve)}else if(ke.parent.is("element","picture")){const Ae=ke.parent;xe.move(xe.createRangeOn(ke),xe.createPositionBefore(Ae)),xe.remove(Ae)}};return t=>{t.on("attribute:sources:imageBlock",we),t.on("attribute:sources:imageInline",we)}}function downcastImageAttribute(Te,we,t){const te=(be,xe,ve)=>{if(!ve.consumable.consume(xe.item,be.name))return;const ke=ve.writer,Ie=ve.mapper.toViewElement(xe.item),Ae=Te.findViewImgElement(Ie);ke.setAttribute(xe.attributeKey,xe.attributeNewValue||"",Ae)};return be=>{be.on(`attribute:${t}:${we}`,te)}}class ImageLoadObserver extends Observer{observe(we){this.listenTo(we,"load",(t,te)=>{const be=te.target;this.checkShouldIgnoreEventFromTarget(be)||be.tagName=="IMG"&&this._fireEvents(te)},{useCapture:!0})}stopObserving(we){this.stopListening(we)}_fireEvents(we){this.isEnabled&&(this.document.fire("layoutChanged"),this.document.fire("imageLoaded",we))}}class InsertImageCommand extends Command{constructor(we){super(we);const t=we.config.get("image.insert.type");we.plugins.has("ImageBlockEditing")||t==="block"&&logWarning("image-block-plugin-required"),we.plugins.has("ImageInlineEditing")||t==="inline"&&logWarning("image-inline-plugin-required")}refresh(){const we=this.editor.plugins.get("ImageUtils");this.isEnabled=we.isImageAllowed()}execute(we){const t=toArray$2(we.source),te=this.editor.model.document.selection,be=this.editor.plugins.get("ImageUtils"),xe=Object.fromEntries(te.getAttributes());t.forEach((ve,ke)=>{const Ie=te.getSelectedElement();if(typeof ve=="string"&&(ve={src:ve}),ke&&Ie&&be.isImage(Ie)){const Ae=this.editor.model.createPositionAfter(Ie);be.insertImage({...ve,...xe},Ae)}else be.insertImage({...ve,...xe})})}}class ReplaceImageSourceCommand extends Command{constructor(we){super(we),this.decorate("cleanupImage")}refresh(){const t=this.editor.plugins.get("ImageUtils"),te=this.editor.model.document.selection.getSelectedElement();this.isEnabled=t.isImage(te),this.value=this.isEnabled?te.getAttribute("src"):null}execute(we){const t=this.editor.model.document.selection.getSelectedElement(),te=this.editor.plugins.get("ImageUtils");this.editor.model.change(be=>{be.setAttribute("src",we.source,t),this.cleanupImage(be,t),te.setImageNaturalSizeAttributes(t)})}cleanupImage(we,t){we.removeAttribute("srcset",t),we.removeAttribute("sizes",t),we.removeAttribute("sources",t),we.removeAttribute("width",t),we.removeAttribute("height",t),we.removeAttribute("alt",t)}}class ImageEditing extends Plugin{static get requires(){return[ImageUtils]}static get pluginName(){return"ImageEditing"}init(){const we=this.editor,t=we.conversion;we.editing.view.addObserver(ImageLoadObserver),t.for("upcast").attributeToAttribute({view:{name:"img",key:"alt"},model:"alt"}).attributeToAttribute({view:{name:"img",key:"srcset"},model:"srcset"});const te=new InsertImageCommand(we),be=new ReplaceImageSourceCommand(we);we.commands.add("insertImage",te),we.commands.add("replaceImageSource",be),we.commands.add("imageInsert",te)}}class ImageSizeAttributes extends Plugin{static get requires(){return[ImageUtils]}static get pluginName(){return"ImageSizeAttributes"}afterInit(){this._registerSchema(),this._registerConverters("imageBlock"),this._registerConverters("imageInline")}_registerSchema(){this.editor.plugins.has("ImageBlockEditing")&&this.editor.model.schema.extend("imageBlock",{allowAttributes:["width","height"]}),this.editor.plugins.has("ImageInlineEditing")&&this.editor.model.schema.extend("imageInline",{allowAttributes:["width","height"]})}_registerConverters(we){const t=this.editor,te=t.plugins.get("ImageUtils"),be=we==="imageBlock"?"figure":"img";t.conversion.for("upcast").attributeToAttribute({view:{name:be,styles:{width:/.+/}},model:{key:"width",value:ve=>widthAndHeightStylesAreBothSet(ve)?getSizeValueIfInPx(ve.getStyle("width")):null}}).attributeToAttribute({view:{name:be,key:"width"},model:"width"}).attributeToAttribute({view:{name:be,styles:{height:/.+/}},model:{key:"height",value:ve=>widthAndHeightStylesAreBothSet(ve)?getSizeValueIfInPx(ve.getStyle("height")):null}}).attributeToAttribute({view:{name:be,key:"height"},model:"height"}),t.conversion.for("editingDowncast").add(ve=>{xe(ve,"width","width",!0),xe(ve,"height","height",!0)}),t.conversion.for("dataDowncast").add(ve=>{xe(ve,"width","width",!1),xe(ve,"height","height",!1)});function xe(ve,ke,Ie,Ae){ve.on(`attribute:${ke}:${we}`,(Se,Oe,Ve)=>{if(!Ve.consumable.consume(Oe.item,Se.name))return;const Me=Ve.writer,De=Ve.mapper.toViewElement(Oe.item),Fe=te.findViewImgElement(De);if(Oe.attributeNewValue!==null?Me.setAttribute(Ie,Oe.attributeNewValue,Fe):Me.removeAttribute(Ie,Fe),Oe.item.hasAttribute("sources"))return;const Be=Oe.item.hasAttribute("resizedWidth");if(we==="imageInline"&&!Be&&!Ae)return;const $e=Oe.item.getAttribute("width"),Ue=Oe.item.getAttribute("height");$e&&Ue&&Me.setStyle("aspect-ratio",`${$e}/${Ue}`,Fe)})}}}class ImageTypeCommand extends Command{constructor(t,te){super(t);Re(this,"_modelElementName");this._modelElementName=te}refresh(){const te=this.editor.plugins.get("ImageUtils"),be=te.getClosestSelectedImageElement(this.editor.model.document.selection);this._modelElementName==="imageBlock"?this.isEnabled=te.isInlineImage(be):this.isEnabled=te.isBlockImage(be)}execute(t={}){const te=this.editor,be=this.editor.model,xe=te.plugins.get("ImageUtils"),ve=xe.getClosestSelectedImageElement(be.document.selection),ke=Object.fromEntries(ve.getAttributes());return!ke.src&&!ke.uploadId?null:be.change(Ie=>{const{setImageSizes:Ae=!0}=t,Se=Array.from(be.markers).filter(Me=>Me.getRange().containsItem(ve)),Oe=xe.insertImage(ke,be.createSelection(ve,"on"),this._modelElementName,{setImageSizes:Ae});if(!Oe)return null;const Ve=Ie.createRangeOn(Oe);for(const Me of Se){const De=Me.getRange(),Fe=De.root.rootName!="$graveyard"?De.getJoined(Ve,!0):Ve;Ie.updateMarker(Me,{range:Fe})}return{oldElement:ve,newElement:Oe}})}}class ImagePlaceholder extends Plugin{static get requires(){return[ImageUtils]}static get pluginName(){return"ImagePlaceholder"}afterInit(){this._setupSchema(),this._setupConversion(),this._setupLoadListener()}_setupSchema(){const we=this.editor.model.schema;we.isRegistered("imageBlock")&&we.extend("imageBlock",{allowAttributes:["placeholder"]}),we.isRegistered("imageInline")&&we.extend("imageInline",{allowAttributes:["placeholder"]})}_setupConversion(){const we=this.editor,t=we.conversion,te=we.plugins.get("ImageUtils");t.for("editingDowncast").add(be=>{be.on("attribute:placeholder",(xe,ve,ke)=>{if(!ke.consumable.test(ve.item,xe.name)||!ve.item.is("element","imageBlock")&&!ve.item.is("element","imageInline"))return;ke.consumable.consume(ve.item,xe.name);const Ie=ke.writer,Ae=ke.mapper.toViewElement(ve.item),Se=te.findViewImgElement(Ae);ve.attributeNewValue?(Ie.addClass("image_placeholder",Se),Ie.setStyle("background-image",`url(${ve.attributeNewValue})`,Se),Ie.setCustomProperty("editingPipeline:doNotReuseOnce",!0,Se)):(Ie.removeClass("image_placeholder",Se),Ie.removeStyle("background-image",Se))})})}_setupLoadListener(){const we=this.editor,t=we.model,te=we.editing,be=te.view,xe=we.plugins.get("ImageUtils");be.addObserver(ImageLoadObserver),this.listenTo(be.document,"imageLoaded",(ve,ke)=>{const Ie=be.domConverter.mapDomToView(ke.target);if(!Ie)return;const Ae=xe.getImageWidgetFromImageView(Ie);if(!Ae)return;const Se=te.mapper.toModelElement(Ae);!Se||!Se.hasAttribute("placeholder")||t.enqueueChange({isUndoable:!1},Oe=>{Oe.removeAttribute("placeholder",Se)})})}}class ImageBlockEditing extends Plugin{static get requires(){return[ImageEditing,ImageSizeAttributes,ImageUtils,ImagePlaceholder,ClipboardPipeline]}static get pluginName(){return"ImageBlockEditing"}init(){const we=this.editor;we.model.schema.register("imageBlock",{inheritAllFrom:"$blockObject",allowAttributes:["alt","src","srcset"]}),this._setupConversion(),we.plugins.has("ImageInlineEditing")&&(we.commands.add("imageTypeBlock",new ImageTypeCommand(this.editor,"imageBlock")),this._setupClipboardIntegration())}_setupConversion(){const we=this.editor,t=we.t,te=we.conversion,be=we.plugins.get("ImageUtils");te.for("dataDowncast").elementToStructure({model:"imageBlock",view:(xe,{writer:ve})=>createBlockImageViewElement(ve)}),te.for("editingDowncast").elementToStructure({model:"imageBlock",view:(xe,{writer:ve})=>be.toImageWidget(createBlockImageViewElement(ve),ve,t("image widget"))}),te.for("downcast").add(downcastImageAttribute(be,"imageBlock","src")).add(downcastImageAttribute(be,"imageBlock","alt")).add(downcastSrcsetAttribute(be,"imageBlock")),te.for("upcast").elementToElement({view:getImgViewElementMatcher(we,"imageBlock"),model:(xe,{writer:ve})=>ve.createElement("imageBlock",xe.hasAttribute("src")?{src:xe.getAttribute("src")}:void 0)}).add(upcastImageFigure(be))}_setupClipboardIntegration(){const we=this.editor,t=we.model,te=we.editing.view,be=we.plugins.get("ImageUtils"),xe=we.plugins.get("ClipboardPipeline");this.listenTo(xe,"inputTransformation",(ve,ke)=>{const Ie=Array.from(ke.content.getChildren());let Ae;if(!Ie.every(be.isInlineImageView))return;ke.targetRanges?Ae=we.editing.mapper.toModelRange(ke.targetRanges[0]):Ae=t.document.selection.getFirstRange();const Se=t.createSelection(Ae);if(determineImageTypeForInsertionAtSelection(t.schema,Se)==="imageBlock"){const Oe=new UpcastWriter(te.document),Ve=Ie.map(Me=>Oe.createElement("figure",{class:"image"},Me));ke.content=Oe.createDocumentFragment(Ve)}}),this.listenTo(xe,"contentInsertion",(ve,ke)=>{ke.method==="paste"&&t.change(Ie=>{const Ae=Ie.createRangeIn(ke.content);for(const Se of Ae.getItems())Se.is("element","imageBlock")&&be.setImageNaturalSizeAttributes(Se)})})}}class ImageInsertFormView extends View{constructor(t,te=[]){super(t);Re(this,"focusTracker");Re(this,"keystrokes");Re(this,"_focusables");Re(this,"_focusCycler");Re(this,"children");this.focusTracker=new FocusTracker,this.keystrokes=new KeystrokeHandler,this._focusables=new ViewCollection,this.children=this.createCollection(),this._focusCycler=new FocusCycler({focusables:this._focusables,focusTracker:this.focusTracker,keystrokeHandler:this.keystrokes,actions:{focusPrevious:"shift + tab",focusNext:"tab"}});for(const be of te)this.children.add(be),this._focusables.add(be),be instanceof CollapsibleView&&this._focusables.addMany(be.children);this.setTemplate({tag:"form",attributes:{class:["ck","ck-image-insert-form"],tabindex:-1},children:this.children})}render(){super.render(),submitHandler({view:this});for(const te of this._focusables)this.focusTracker.add(te.element);this.keystrokes.listenTo(this.element);const t=te=>te.stopPropagation();this.keystrokes.set("arrowright",t),this.keystrokes.set("arrowleft",t),this.keystrokes.set("arrowup",t),this.keystrokes.set("arrowdown",t)}destroy(){super.destroy(),this.focusTracker.destroy(),this.keystrokes.destroy()}focus(){this._focusCycler.focusFirst()}}class ImageInsertUI extends Plugin{constructor(t){super(t);Re(this,"dropdownView");Re(this,"_integrations",new Map);t.config.define("image.insert.integrations",["upload","assetManager","url"])}static get pluginName(){return"ImageInsertUI"}static get requires(){return[ImageUtils]}init(){const t=this.editor,te=t.model.document.selection,be=t.plugins.get("ImageUtils");this.set("isImageSelected",!1),this.listenTo(t.model.document,"change",()=>{this.isImageSelected=be.isImage(te.getSelectedElement())});const xe=ke=>this._createToolbarComponent(ke),ve=ke=>this._createMenuBarComponent(ke);t.ui.componentFactory.add("insertImage",xe),t.ui.componentFactory.add("imageInsert",xe),t.ui.componentFactory.add("menuBar:insertImage",ve)}registerIntegration({name:t,observable:te,buttonViewCreator:be,formViewCreator:xe,menuBarButtonViewCreator:ve,requiresForm:ke=!1}){this._integrations.has(t)&&logWarning("image-insert-integration-exists",{name:t}),this._integrations.set(t,{observable:te,buttonViewCreator:be,menuBarButtonViewCreator:ve,formViewCreator:xe,requiresForm:ke})}_createToolbarComponent(t){const te=this.editor,be=t.t,xe=this._prepareIntegrations();if(!xe.length)return null;let ve;const ke=xe[0];if(xe.length==1){if(!ke.requiresForm)return ke.buttonViewCreator(!0);ve=ke.buttonViewCreator(!0)}else{const Se=ke.buttonViewCreator(!1);ve=new SplitButtonView(t,Se),ve.tooltip=!0,ve.bind("label").to(this,"isImageSelected",Oe=>be(Oe?"Replace image":"Insert image"))}const Ie=this.dropdownView=createDropdown(t,ve),Ae=xe.map(({observable:Se})=>typeof Se=="function"?Se():Se);return Ie.bind("isEnabled").toMany(Ae,"isEnabled",(...Se)=>Se.some(Oe=>Oe)),Ie.once("change:isOpen",()=>{const Se=xe.map(({formViewCreator:Ve})=>Ve(xe.length==1)),Oe=new ImageInsertFormView(te.locale,Se);Ie.panelView.children.add(Oe)}),Ie}_createMenuBarComponent(t){const te=t.t,be=this._prepareIntegrations();if(!be.length)return null;let xe;const ve=be[0];if(be.length==1)xe=ve.menuBarButtonViewCreator(!0);else{xe=new MenuBarMenuView(t);const ke=new MenuBarMenuListView(t);xe.panelView.children.add(ke),xe.buttonView.set({icon:icons.image,label:te("Image")});for(const Ie of be){const Ae=new MenuBarMenuListItemView(t,xe),Se=Ie.menuBarButtonViewCreator(!1);Ae.children.add(Se),ke.items.add(Ae)}}return xe}_prepareIntegrations(){const te=this.editor.config.get("image.insert.integrations"),be=[];if(!te.length)return logWarning("image-insert-integrations-not-specified"),be;for(const xe of te){if(!this._integrations.has(xe)){["upload","assetManager","url"].includes(xe)||logWarning("image-insert-unknown-integration",{item:xe});continue}be.push(this._integrations.get(xe))}return be.length||logWarning("image-insert-integrations-not-registered"),be}}class ImageBlock extends Plugin{static get requires(){return[ImageBlockEditing,Widget,ImageTextAlternative,ImageInsertUI]}static get pluginName(){return"ImageBlock"}}class ImageInlineEditing extends Plugin{static get requires(){return[ImageEditing,ImageSizeAttributes,ImageUtils,ImagePlaceholder,ClipboardPipeline]}static get pluginName(){return"ImageInlineEditing"}init(){const we=this.editor;we.model.schema.register("imageInline",{inheritAllFrom:"$inlineObject",allowAttributes:["alt","src","srcset"],disallowIn:["caption"]}),this._setupConversion(),we.plugins.has("ImageBlockEditing")&&(we.commands.add("imageTypeInline",new ImageTypeCommand(this.editor,"imageInline")),this._setupClipboardIntegration())}_setupConversion(){const we=this.editor,t=we.t,te=we.conversion,be=we.plugins.get("ImageUtils");te.for("dataDowncast").elementToElement({model:"imageInline",view:(xe,{writer:ve})=>ve.createEmptyElement("img")}),te.for("editingDowncast").elementToStructure({model:"imageInline",view:(xe,{writer:ve})=>be.toImageWidget(createInlineImageViewElement(ve),ve,t("image widget"))}),te.for("downcast").add(downcastImageAttribute(be,"imageInline","src")).add(downcastImageAttribute(be,"imageInline","alt")).add(downcastSrcsetAttribute(be,"imageInline")),te.for("upcast").elementToElement({view:getImgViewElementMatcher(we,"imageInline"),model:(xe,{writer:ve})=>ve.createElement("imageInline",xe.hasAttribute("src")?{src:xe.getAttribute("src")}:void 0)})}_setupClipboardIntegration(){const we=this.editor,t=we.model,te=we.editing.view,be=we.plugins.get("ImageUtils"),xe=we.plugins.get("ClipboardPipeline");this.listenTo(xe,"inputTransformation",(ve,ke)=>{const Ie=Array.from(ke.content.getChildren());let Ae;if(!Ie.every(be.isBlockImageView))return;ke.targetRanges?Ae=we.editing.mapper.toModelRange(ke.targetRanges[0]):Ae=t.document.selection.getFirstRange();const Se=t.createSelection(Ae);if(determineImageTypeForInsertionAtSelection(t.schema,Se)==="imageInline"){const Oe=new UpcastWriter(te.document),Ve=Ie.map(Me=>Me.childCount===1?(Array.from(Me.getAttributes()).forEach(De=>Oe.setAttribute(...De,be.findViewImgElement(Me))),Me.getChild(0)):Me);ke.content=Oe.createDocumentFragment(Ve)}}),this.listenTo(xe,"contentInsertion",(ve,ke)=>{ke.method==="paste"&&t.change(Ie=>{const Ae=Ie.createRangeIn(ke.content);for(const Se of Ae.getItems())Se.is("element","imageInline")&&be.setImageNaturalSizeAttributes(Se)})})}}class ImageInline extends Plugin{static get requires(){return[ImageInlineEditing,Widget,ImageTextAlternative,ImageInsertUI]}static get pluginName(){return"ImageInline"}}class ImageCaptionUtils extends Plugin{static get pluginName(){return"ImageCaptionUtils"}static get requires(){return[ImageUtils]}getCaptionFromImageModelElement(we){for(const t of we.getChildren())if(t&&t.is("element","caption"))return t;return null}getCaptionFromModelSelection(we){const t=this.editor.plugins.get("ImageUtils"),te=we.getFirstPosition().findAncestor("caption");return te&&t.isBlockImage(te.parent)?te:null}matchImageCaptionViewElement(we){const t=this.editor.plugins.get("ImageUtils");return we.name=="figcaption"&&t.isBlockImageView(we.parent)?{name:!0}:null}}class ToggleImageCaptionCommand extends Command{refresh(){const we=this.editor,t=we.plugins.get("ImageCaptionUtils"),te=we.plugins.get("ImageUtils");if(!we.plugins.has(ImageBlockEditing)){this.isEnabled=!1,this.value=!1;return}const be=we.model.document.selection,xe=be.getSelectedElement();if(!xe){const ve=t.getCaptionFromModelSelection(be);this.isEnabled=!!ve,this.value=!!ve;return}this.isEnabled=te.isImage(xe),this.isEnabled?this.value=!!t.getCaptionFromImageModelElement(xe):this.value=!1}execute(we={}){const{focusCaptionOnShow:t}=we;this.editor.model.change(te=>{this.value?this._hideImageCaption(te):this._showImageCaption(te,t)})}_showImageCaption(we,t){const be=this.editor.model.document.selection,xe=this.editor.plugins.get("ImageCaptionEditing"),ve=this.editor.plugins.get("ImageUtils");let ke=be.getSelectedElement();const Ie=xe._getSavedCaption(ke);ve.isInlineImage(ke)&&(this.editor.execute("imageTypeBlock"),ke=be.getSelectedElement());const Ae=Ie||we.createElement("caption");we.append(Ae,ke),t&&we.setSelection(Ae,"in")}_hideImageCaption(we){const t=this.editor,te=t.model.document.selection,be=t.plugins.get("ImageCaptionEditing"),xe=t.plugins.get("ImageCaptionUtils");let ve=te.getSelectedElement(),ke;ve?ke=xe.getCaptionFromImageModelElement(ve):(ke=xe.getCaptionFromModelSelection(te),ve=ke.parent),be._saveCaption(ve,ke),we.setSelection(ve,"on"),we.remove(ke)}}class ImageCaptionEditing extends Plugin{constructor(t){super(t);Re(this,"_savedCaptionsMap");this._savedCaptionsMap=new WeakMap}static get requires(){return[ImageUtils,ImageCaptionUtils]}static get pluginName(){return"ImageCaptionEditing"}init(){const t=this.editor,te=t.model.schema;te.isRegistered("caption")?te.extend("caption",{allowIn:"imageBlock"}):te.register("caption",{allowIn:"imageBlock",allowContentOf:"$block",isLimit:!0}),t.commands.add("toggleImageCaption",new ToggleImageCaptionCommand(this.editor)),this._setupConversion(),this._setupImageTypeCommandsIntegration(),this._registerCaptionReconversion()}_setupConversion(){const t=this.editor,te=t.editing.view,be=t.plugins.get("ImageUtils"),xe=t.plugins.get("ImageCaptionUtils"),ve=t.t;t.conversion.for("upcast").elementToElement({view:ke=>xe.matchImageCaptionViewElement(ke),model:"caption"}),t.conversion.for("dataDowncast").elementToElement({model:"caption",view:(ke,{writer:Ie})=>be.isBlockImage(ke.parent)?Ie.createContainerElement("figcaption"):null}),t.conversion.for("editingDowncast").elementToElement({model:"caption",view:(ke,{writer:Ie})=>{if(!be.isBlockImage(ke.parent))return null;const Ae=Ie.createEditableElement("figcaption");Ie.setCustomProperty("imageCaption",!0,Ae),Ae.placeholder=ve("Enter image caption"),enablePlaceholder({view:te,element:Ae,keepOnFocus:!0});const Se=ke.parent.getAttribute("alt"),Oe=Se?ve("Caption for image: %0",[Se]):ve("Caption for the image");return toWidgetEditable(Ae,Ie,{label:Oe})}})}_setupImageTypeCommandsIntegration(){const t=this.editor,te=t.plugins.get("ImageUtils"),be=t.plugins.get("ImageCaptionUtils"),xe=t.commands.get("imageTypeInline"),ve=t.commands.get("imageTypeBlock"),ke=Ie=>{if(!Ie.return)return;const{oldElement:Ae,newElement:Se}=Ie.return;/* istanbul ignore if: paranoid check -- @preserve */if(!Ae)return;if(te.isBlockImage(Ae)){const Ve=be.getCaptionFromImageModelElement(Ae);if(Ve){this._saveCaption(Se,Ve);return}}const Oe=this._getSavedCaption(Ae);Oe&&this._saveCaption(Se,Oe)};xe&&this.listenTo(xe,"execute",ke,{priority:"low"}),ve&&this.listenTo(ve,"execute",ke,{priority:"low"})}_getSavedCaption(t){const te=this._savedCaptionsMap.get(t);return te?Element.fromJSON(te):null}_saveCaption(t,te){this._savedCaptionsMap.set(t,te.toJSON())}_registerCaptionReconversion(){const t=this.editor,te=t.model,be=t.plugins.get("ImageUtils"),xe=t.plugins.get("ImageCaptionUtils");te.document.on("change:data",()=>{const ve=te.document.differ.getChanges();for(const ke of ve){if(ke.attributeKey!=="alt")continue;const Ie=ke.range.start.nodeAfter;if(be.isBlockImage(Ie)){const Ae=xe.getCaptionFromImageModelElement(Ie);if(!Ae)return;t.editing.reconvertItem(Ae)}}})}}class ImageCaptionUI extends Plugin{static get requires(){return[ImageCaptionUtils]}static get pluginName(){return"ImageCaptionUI"}init(){const we=this.editor,t=we.editing.view,te=we.plugins.get("ImageCaptionUtils"),be=we.t;we.ui.componentFactory.add("toggleImageCaption",xe=>{const ve=we.commands.get("toggleImageCaption"),ke=new ButtonView(xe);return ke.set({icon:icons.caption,tooltip:!0,isToggleable:!0}),ke.bind("isOn","isEnabled").to(ve,"value","isEnabled"),ke.bind("label").to(ve,"value",Ie=>be(Ie?"Toggle caption off":"Toggle caption on")),this.listenTo(ke,"execute",()=>{we.execute("toggleImageCaption",{focusCaptionOnShow:!0});const Ie=te.getCaptionFromModelSelection(we.model.document.selection);if(Ie){const Ae=we.editing.mapper.toViewElement(Ie);t.scrollToTheSelection(),t.change(Se=>{Se.addClass("image__caption_highlighted",Ae)})}we.editing.view.focus()}),ke})}}class ImageCaption extends Plugin{static get requires(){return[ImageCaptionEditing,ImageCaptionUI]}static get pluginName(){return"ImageCaption"}}function createImageTypeRegExp(Te){const we=Te.map(t=>t.replace("+","\\+"));return new RegExp(`^image\\/(${we.join("|")})$`)}function fetchLocalImage(Te){return new Promise((we,t)=>{const te=Te.getAttribute("src");fetch(te).then(be=>be.blob()).then(be=>{const xe=getImageMimeType(be,te),ke=`image.${xe.replace("image/","")}`,Ie=new File([be],ke,{type:xe});we(Ie)}).catch(be=>be&&be.name==="TypeError"?convertLocalImageOnCanvas(te).then(we).catch(t):t(be))})}function isLocalImage(Te,we){return!Te.isInlineImageView(we)||!we.getAttribute("src")?!1:!!we.getAttribute("src").match(/^data:image\/\w+;base64,/g)||!!we.getAttribute("src").match(/^blob:/g)}function getImageMimeType(Te,we){return Te.type?Te.type:we.match(/data:(image\/\w+);base64/)?we.match(/data:(image\/\w+);base64/)[1].toLowerCase():"image/jpeg"}function convertLocalImageOnCanvas(Te){return getBlobFromCanvas(Te).then(we=>{const t=getImageMimeType(we,Te),be=`image.${t.replace("image/","")}`;return new File([we],be,{type:t})})}function getBlobFromCanvas(Te){return new Promise((we,t)=>{const te=global.document.createElement("img");te.addEventListener("load",()=>{const be=global.document.createElement("canvas");be.width=te.width,be.height=te.height,be.getContext("2d").drawImage(te,0,0),be.toBlob(ve=>ve?we(ve):t())}),te.addEventListener("error",()=>t()),te.src=Te})}class ImageUploadUI extends Plugin{static get pluginName(){return"ImageUploadUI"}init(){const we=this.editor;we.ui.componentFactory.add("uploadImage",()=>this._createToolbarButton()),we.ui.componentFactory.add("imageUpload",()=>this._createToolbarButton()),we.ui.componentFactory.add("menuBar:uploadImage",()=>this._createMenuBarButton("standalone")),we.plugins.has("ImageInsertUI")&&we.plugins.get("ImageInsertUI").registerIntegration({name:"upload",observable:()=>we.commands.get("uploadImage"),buttonViewCreator:()=>this._createToolbarButton(),formViewCreator:()=>this._createDropdownButton(),menuBarButtonViewCreator:t=>this._createMenuBarButton(t?"insertOnly":"insertNested")})}_createButton(we){const t=this.editor,te=t.locale,be=t.commands.get("uploadImage"),xe=t.config.get("image.upload.types"),ve=createImageTypeRegExp(xe),ke=new we(t.locale),Ie=te.t;return ke.set({acceptedType:xe.map(Ae=>`image/${Ae}`).join(","),allowMultipleFiles:!0,label:Ie("Upload from computer"),icon:icons.imageUpload}),ke.bind("isEnabled").to(be),ke.on("done",(Ae,Se)=>{const Oe=Array.from(Se).filter(Ve=>ve.test(Ve.type));Oe.length&&(t.execute("uploadImage",{file:Oe}),t.editing.view.focus())}),ke}_createToolbarButton(){const we=this.editor.locale.t,t=this.editor.plugins.get("ImageInsertUI"),te=this._createButton(FileDialogButtonView);return te.tooltip=!0,te.bind("label").to(t,"isImageSelected",be=>we(be?"Replace image from computer":"Upload image from computer")),te}_createDropdownButton(){const we=this.editor.locale.t,t=this.editor.plugins.get("ImageInsertUI"),te=this._createButton(FileDialogButtonView);return te.withText=!0,te.bind("label").to(t,"isImageSelected",be=>we(be?"Replace from computer":"Upload from computer")),te.on("execute",()=>{t.dropdownView.isOpen=!1}),te}_createMenuBarButton(we){const t=this.editor.locale.t,te=this._createButton(MenuBarMenuListItemFileDialogButtonView);switch(te.withText=!0,we){case"standalone":te.label=t("Image from computer");break;case"insertOnly":te.label=t("Image");break;case"insertNested":te.label=t("From computer");break}return te}}class ImageUploadProgress extends Plugin{constructor(t){super(t);Re(this,"placeholder");Re(this,"uploadStatusChange",(t,te,be)=>{const xe=this.editor,ve=te.item,ke=ve.getAttribute("uploadId");if(!be.consumable.consume(te.item,t.name))return;const Ie=xe.plugins.get("ImageUtils"),Ae=xe.plugins.get(FileRepository),Se=ke?te.attributeNewValue:null,Oe=this.placeholder,Ve=xe.editing.mapper.toViewElement(ve),Me=be.writer;if(Se=="reading"){_startAppearEffect(Ve,Me),_showPlaceholder(Ie,Oe,Ve,Me);return}if(Se=="uploading"){const De=Ae.loaders.get(ke);_startAppearEffect(Ve,Me),De?(_hidePlaceholder(Ve,Me),_showProgressBar(Ve,Me,De,xe.editing.view),_displayLocalImage(Ie,Ve,Me,De)):_showPlaceholder(Ie,Oe,Ve,Me);return}Se=="complete"&&Ae.loaders.get(ke)&&_showCompleteIcon(Ve,Me,xe.editing.view),_hideProgressBar(Ve,Me),_hidePlaceholder(Ve,Me),_stopAppearEffect(Ve,Me)});this.placeholder="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="}static get pluginName(){return"ImageUploadProgress"}init(){const t=this.editor;t.plugins.has("ImageBlockEditing")&&t.editing.downcastDispatcher.on("attribute:uploadStatus:imageBlock",this.uploadStatusChange),t.plugins.has("ImageInlineEditing")&&t.editing.downcastDispatcher.on("attribute:uploadStatus:imageInline",this.uploadStatusChange)}}function _startAppearEffect(Te,we){Te.hasClass("ck-appear")||we.addClass("ck-appear",Te)}function _stopAppearEffect(Te,we){we.removeClass("ck-appear",Te)}function _showPlaceholder(Te,we,t,te){t.hasClass("ck-image-upload-placeholder")||te.addClass("ck-image-upload-placeholder",t);const be=Te.findViewImgElement(t);be.getAttribute("src")!==we&&te.setAttribute("src",we,be),_getUIElement(t,"placeholder")||te.insert(te.createPositionAfter(be),_createPlaceholder(te))}function _hidePlaceholder(Te,we){Te.hasClass("ck-image-upload-placeholder")&&we.removeClass("ck-image-upload-placeholder",Te),_removeUIElement(Te,we,"placeholder")}function _showProgressBar(Te,we,t,te){const be=_createProgressBar(we);we.insert(we.createPositionAt(Te,"end"),be),t.on("change:uploadedPercent",(xe,ve,ke)=>{te.change(Ie=>{Ie.setStyle("width",ke+"%",be)})})}function _hideProgressBar(Te,we){_removeUIElement(Te,we,"progressBar")}function _showCompleteIcon(Te,we,t){const te=we.createUIElement("div",{class:"ck-image-upload-complete-icon"});we.insert(we.createPositionAt(Te,"end"),te),setTimeout(()=>{t.change(be=>be.remove(be.createRangeOn(te)))},3e3)}function _createProgressBar(Te){const we=Te.createUIElement("div",{class:"ck-progress-bar"});return Te.setCustomProperty("progressBar",!0,we),we}function _createPlaceholder(Te){const we=Te.createUIElement("div",{class:"ck-upload-placeholder-loader"});return Te.setCustomProperty("placeholder",!0,we),we}function _getUIElement(Te,we){for(const t of Te.getChildren())if(t.getCustomProperty(we))return t}function _removeUIElement(Te,we,t){const te=_getUIElement(Te,t);te&&we.remove(we.createRangeOn(te))}function _displayLocalImage(Te,we,t,te){if(te.data){const be=Te.findViewImgElement(we);t.setAttribute("src",te.data,be)}}class UploadImageCommand extends Command{refresh(){const we=this.editor,t=we.plugins.get("ImageUtils"),te=we.model.document.selection.getSelectedElement();this.isEnabled=t.isImageAllowed()||t.isImage(te)}execute(we){const t=toArray$2(we.file),te=this.editor.model.document.selection,be=this.editor.plugins.get("ImageUtils"),xe=Object.fromEntries(te.getAttributes());t.forEach((ve,ke)=>{const Ie=te.getSelectedElement();if(ke&&Ie&&be.isImage(Ie)){const Ae=this.editor.model.createPositionAfter(Ie);this._uploadImage(ve,xe,Ae)}else this._uploadImage(ve,xe)})}_uploadImage(we,t,te){const be=this.editor,ve=be.plugins.get(FileRepository).createLoader(we),ke=be.plugins.get("ImageUtils");ve&&ke.insertImage({...t,uploadId:ve.id},te)}}class ImageUploadEditing extends Plugin{constructor(t){super(t);Re(this,"_uploadImageElements");t.config.define("image",{upload:{types:["jpeg","png","gif","bmp","webp","tiff"]}}),this._uploadImageElements=new Map}static get requires(){return[FileRepository,Notification,ClipboardPipeline,ImageUtils]}static get pluginName(){return"ImageUploadEditing"}init(){const t=this.editor,te=t.model.document,be=t.conversion,xe=t.plugins.get(FileRepository),ve=t.plugins.get("ImageUtils"),ke=t.plugins.get("ClipboardPipeline"),Ie=createImageTypeRegExp(t.config.get("image.upload.types")),Ae=new UploadImageCommand(t);t.commands.add("uploadImage",Ae),t.commands.add("imageUpload",Ae),be.for("upcast").attributeToAttribute({view:{name:"img",key:"uploadId"},model:"uploadId"}),this.listenTo(t.editing.view.document,"clipboardInput",(Se,Oe)=>{if(isHtmlIncluded(Oe.dataTransfer))return;const Ve=Array.from(Oe.dataTransfer.files).filter(Me=>Me?Ie.test(Me.type):!1);Ve.length&&(Se.stop(),t.model.change(Me=>{Oe.targetRanges&&Me.setSelection(Oe.targetRanges.map(De=>t.editing.mapper.toModelRange(De))),t.execute("uploadImage",{file:Ve})}))}),this.listenTo(ke,"inputTransformation",(Se,Oe)=>{const Ve=Array.from(t.editing.view.createRangeIn(Oe.content)).map(De=>De.item).filter(De=>isLocalImage(ve,De)&&!De.getAttribute("uploadProcessed")).map(De=>({promise:fetchLocalImage(De),imageElement:De}));if(!Ve.length)return;const Me=new UpcastWriter(t.editing.view.document);for(const De of Ve){Me.setAttribute("uploadProcessed",!0,De.imageElement);const Fe=xe.createLoader(De.promise);Fe&&(Me.setAttribute("src","",De.imageElement),Me.setAttribute("uploadId",Fe.id,De.imageElement))}}),t.editing.view.document.on("dragover",(Se,Oe)=>{Oe.preventDefault()}),te.on("change",()=>{const Se=te.differ.getChanges({includeChangesInGraveyard:!0}).reverse(),Oe=new Set;for(const Ve of Se)if(Ve.type=="insert"&&Ve.name!="$text"){const Me=Ve.position.nodeAfter,De=Ve.position.root.rootName=="$graveyard";for(const Fe of getImagesFromChangeItem(t,Me)){const Be=Fe.getAttribute("uploadId");if(!Be)continue;const $e=xe.loaders.get(Be);$e&&(De?Oe.has(Be)||$e.abort():(Oe.add(Be),this._uploadImageElements.set(Be,Fe),$e.status=="idle"&&this._readAndUpload($e)))}}}),this.on("uploadComplete",(Se,{imageElement:Oe,data:Ve})=>{const Me=Ve.urls?Ve.urls:Ve;this.editor.model.change(De=>{De.setAttribute("src",Me.default,Oe),this._parseAndSetSrcsetAttributeOnImage(Me,Oe,De),ve.setImageNaturalSizeAttributes(Oe)})},{priority:"low"})}afterInit(){const t=this.editor.model.schema;this.editor.plugins.has("ImageBlockEditing")&&t.extend("imageBlock",{allowAttributes:["uploadId","uploadStatus"]}),this.editor.plugins.has("ImageInlineEditing")&&t.extend("imageInline",{allowAttributes:["uploadId","uploadStatus"]})}_readAndUpload(t){const te=this.editor,be=te.model,xe=te.locale.t,ve=te.plugins.get(FileRepository),ke=te.plugins.get(Notification),Ie=te.plugins.get("ImageUtils"),Ae=this._uploadImageElements;return be.enqueueChange({isUndoable:!1},Oe=>{Oe.setAttribute("uploadStatus","reading",Ae.get(t.id))}),t.read().then(()=>{const Oe=t.upload(),Ve=Ae.get(t.id);/* istanbul ignore next -- @preserve */if(env.isSafari){const Me=te.editing.mapper.toViewElement(Ve),De=Ie.findViewImgElement(Me);te.editing.view.once("render",()=>{if(!De.parent)return;const Fe=te.editing.view.domConverter.mapViewToDom(De.parent);if(!Fe)return;const Be=Fe.style.display;Fe.style.display="none",Fe._ckHack=Fe.offsetHeight,Fe.style.display=Be})}return te.ui&&te.ui.ariaLiveAnnouncer.announce(xe("Uploading image")),be.enqueueChange({isUndoable:!1},Me=>{Me.setAttribute("uploadStatus","uploading",Ve)}),Oe}).then(Oe=>{be.enqueueChange({isUndoable:!1},Ve=>{const Me=Ae.get(t.id);Ve.setAttribute("uploadStatus","complete",Me),te.ui&&te.ui.ariaLiveAnnouncer.announce(xe("Image upload complete")),this.fire("uploadComplete",{data:Oe,imageElement:Me})}),Se()}).catch(Oe=>{if(te.ui&&te.ui.ariaLiveAnnouncer.announce(xe("Error during image upload")),t.status!=="error"&&t.status!=="aborted")throw Oe;t.status=="error"&&Oe&&ke.showWarning(Oe,{title:xe("Upload failed"),namespace:"upload"}),be.enqueueChange({isUndoable:!1},Ve=>{Ve.remove(Ae.get(t.id))}),Se()});function Se(){be.enqueueChange({isUndoable:!1},Oe=>{const Ve=Ae.get(t.id);Oe.removeAttribute("uploadId",Ve),Oe.removeAttribute("uploadStatus",Ve),Ae.delete(t.id)}),ve.destroyLoader(t)}}_parseAndSetSrcsetAttributeOnImage(t,te,be){let xe=0;const ve=Object.keys(t).filter(ke=>{const Ie=parseInt(ke,10);if(!isNaN(Ie))return xe=Math.max(xe,Ie),!0}).map(ke=>`${t[ke]} ${ke}w`).join(", ");if(ve!=""){const ke={srcset:ve};!te.hasAttribute("width")&&!te.hasAttribute("height")&&(ke.width=xe),be.setAttributes(ke,te)}}}function isHtmlIncluded(Te){return Array.from(Te.types).includes("text/html")&&Te.getData("text/html")!==""}function getImagesFromChangeItem(Te,we){const t=Te.plugins.get("ImageUtils");return Array.from(Te.model.createRangeOn(we)).filter(te=>t.isImage(te.item)).map(te=>te.item)}class ImageUpload extends Plugin{static get pluginName(){return"ImageUpload"}static get requires(){return[ImageUploadEditing,ImageUploadUI,ImageUploadProgress]}}class ImageInsertUrlView extends View{constructor(t){super(t);Re(this,"urlInputView");Re(this,"keystrokes");this.set("imageURLInputValue",""),this.set("isImageSelected",!1),this.set("isEnabled",!0),this.keystrokes=new KeystrokeHandler,this.urlInputView=this._createUrlInputView(),this.setTemplate({tag:"div",attributes:{class:["ck","ck-image-insert-url"]},children:[this.urlInputView,{tag:"div",attributes:{class:["ck","ck-image-insert-url__action-row"]}}]})}render(){super.render(),this.keystrokes.listenTo(this.element)}destroy(){super.destroy(),this.keystrokes.destroy()}_createUrlInputView(){const t=this.locale,te=t.t,be=new LabeledFieldView(t,createLabeledInputText);return be.bind("label").to(this,"isImageSelected",xe=>te(xe?"Update image URL":"Insert image via URL")),be.bind("isEnabled").to(this),be.fieldView.inputMode="url",be.fieldView.placeholder="https://example.com/image.png",be.fieldView.bind("value").to(this,"imageURLInputValue",xe=>xe||""),be.fieldView.on("input",()=>{this.imageURLInputValue=be.fieldView.element.value.trim()}),be}focus(){this.urlInputView.focus()}}class ImageInsertViaUrlUI extends Plugin{constructor(){super(...arguments);Re(this,"_imageInsertUI");Re(this,"_formView")}static get pluginName(){return"ImageInsertViaUrlUI"}static get requires(){return[ImageInsertUI,Dialog]}init(){this.editor.ui.componentFactory.add("insertImageViaUrl",()=>this._createToolbarButton()),this.editor.ui.componentFactory.add("menuBar:insertImageViaUrl",()=>this._createMenuBarButton("standalone"))}afterInit(){this._imageInsertUI=this.editor.plugins.get("ImageInsertUI"),this._imageInsertUI.registerIntegration({name:"url",observable:()=>this.editor.commands.get("insertImage"),buttonViewCreator:()=>this._createToolbarButton(),formViewCreator:()=>this._createDropdownButton(),menuBarButtonViewCreator:t=>this._createMenuBarButton(t?"insertOnly":"insertNested")})}_createInsertUrlButton(t){const te=new t(this.editor.locale);return te.icon=icons.imageUrl,te.on("execute",()=>{this._showModal()}),te}_createToolbarButton(){const t=this.editor.locale.t,te=this._createInsertUrlButton(ButtonView);return te.tooltip=!0,te.bind("label").to(this._imageInsertUI,"isImageSelected",be=>t(be?"Update image URL":"Insert image via URL")),te}_createDropdownButton(){const t=this.editor.locale.t,te=this._createInsertUrlButton(ButtonView);return te.withText=!0,te.bind("label").to(this._imageInsertUI,"isImageSelected",be=>t(be?"Update image URL":"Insert via URL")),te}_createMenuBarButton(t){const te=this.editor.locale.t,be=this._createInsertUrlButton(MenuBarMenuListItemButtonView);switch(be.withText=!0,t){case"standalone":be.label=te("Image via URL");break;case"insertOnly":be.label=te("Image");break;case"insertNested":be.label=te("Via URL");break}return be}_createInsertUrlView(){const t=this.editor,te=t.locale,be=t.commands.get("replaceImageSource"),xe=t.commands.get("insertImage"),ve=new ImageInsertUrlView(te);return ve.bind("isImageSelected").to(this._imageInsertUI),ve.bind("isEnabled").toMany([xe,be],"isEnabled",(...ke)=>ke.some(Ie=>Ie)),ve}_showModal(){const t=this.editor,be=t.locale.t,xe=t.plugins.get("Dialog");this._formView||(this._formView=this._createInsertUrlView(),this._formView.on("submit",()=>this._handleSave()));const ve=t.commands.get("replaceImageSource");this._formView.imageURLInputValue=ve.value||"",xe.show({id:"insertImageViaUrl",title:this._imageInsertUI.isImageSelected?be("Update image URL"):be("Insert image via URL"),isModal:!0,content:this._formView,actionButtons:[{label:be("Cancel"),withText:!0,onExecute:()=>xe.hide()},{label:be("Accept"),class:"ck-button-action",withText:!0,onExecute:()=>this._handleSave()}]})}_handleSave(){this.editor.commands.get("replaceImageSource").isEnabled?this.editor.execute("replaceImageSource",{source:this._formView.imageURLInputValue}):this.editor.execute("insertImage",{source:this._formView.imageURLInputValue}),this.editor.plugins.get("Dialog").hide()}}class ImageInsertViaUrl extends Plugin{static get pluginName(){return"ImageInsertViaUrl"}static get requires(){return[ImageInsertViaUrlUI,ImageInsertUI]}}class ImageInsert extends Plugin{static get pluginName(){return"ImageInsert"}static get requires(){return[ImageUpload,ImageInsertViaUrl,ImageInsertUI]}}class ResizeImageCommand extends Command{refresh(){const we=this.editor,te=we.plugins.get("ImageUtils").getClosestSelectedImageElement(we.model.document.selection);this.isEnabled=!!te,!te||!te.hasAttribute("resizedWidth")?this.value=null:this.value={width:te.getAttribute("resizedWidth"),height:null}}execute(we){const t=this.editor,te=t.model,be=t.plugins.get("ImageUtils"),xe=be.getClosestSelectedImageElement(te.document.selection);this.value={width:we.width,height:null},xe&&te.change(ve=>{ve.setAttribute("resizedWidth",we.width,xe),ve.removeAttribute("resizedHeight",xe),be.setImageNaturalSizeAttributes(xe)})}}class ImageResizeEditing extends Plugin{static get requires(){return[ImageUtils]}static get pluginName(){return"ImageResizeEditing"}constructor(we){super(we),we.config.define("image",{resizeUnit:"%",resizeOptions:[{name:"resizeImage:original",value:null,icon:"original"},{name:"resizeImage:custom",value:"custom",icon:"custom"},{name:"resizeImage:25",value:"25",icon:"small"},{name:"resizeImage:50",value:"50",icon:"medium"},{name:"resizeImage:75",value:"75",icon:"large"}]})}init(){const we=this.editor,t=new ResizeImageCommand(we);this._registerConverters("imageBlock"),this._registerConverters("imageInline"),we.commands.add("resizeImage",t),we.commands.add("imageResize",t)}afterInit(){this._registerSchema()}_registerSchema(){this.editor.plugins.has("ImageBlockEditing")&&this.editor.model.schema.extend("imageBlock",{allowAttributes:["resizedWidth","resizedHeight"]}),this.editor.plugins.has("ImageInlineEditing")&&this.editor.model.schema.extend("imageInline",{allowAttributes:["resizedWidth","resizedHeight"]})}_registerConverters(we){const t=this.editor,te=t.plugins.get("ImageUtils");t.conversion.for("downcast").add(be=>be.on(`attribute:resizedWidth:${we}`,(xe,ve,ke)=>{if(!ke.consumable.consume(ve.item,xe.name))return;const Ie=ke.writer,Ae=ke.mapper.toViewElement(ve.item);ve.attributeNewValue!==null?(Ie.setStyle("width",ve.attributeNewValue,Ae),Ie.addClass("image_resized",Ae)):(Ie.removeStyle("width",Ae),Ie.removeClass("image_resized",Ae))})),t.conversion.for("dataDowncast").attributeToAttribute({model:{name:we,key:"resizedHeight"},view:be=>({key:"style",value:{height:be}})}),t.conversion.for("editingDowncast").add(be=>be.on(`attribute:resizedHeight:${we}`,(xe,ve,ke)=>{if(!ke.consumable.consume(ve.item,xe.name))return;const Ie=ke.writer,Ae=ke.mapper.toViewElement(ve.item),Se=we==="imageInline"?te.findViewImgElement(Ae):Ae;ve.attributeNewValue!==null?Ie.setStyle("height",ve.attributeNewValue,Se):Ie.removeStyle("height",Se)})),t.conversion.for("upcast").attributeToAttribute({view:{name:we==="imageBlock"?"figure":"img",styles:{width:/.+/}},model:{key:"resizedWidth",value:be=>widthAndHeightStylesAreBothSet(be)?null:be.getStyle("width")}}),t.conversion.for("upcast").attributeToAttribute({view:{name:we==="imageBlock"?"figure":"img",styles:{height:/.+/}},model:{key:"resizedHeight",value:be=>widthAndHeightStylesAreBothSet(be)?null:be.getStyle("height")}})}}const RESIZE_ICONS={small:icons.objectSizeSmall,medium:icons.objectSizeMedium,large:icons.objectSizeLarge,custom:icons.objectSizeCustom,original:icons.objectSizeFull};class ImageResizeButtons extends Plugin{constructor(t){super(t);Re(this,"_resizeUnit");this._resizeUnit=t.config.get("image.resizeUnit")}static get requires(){return[ImageResizeEditing]}static get pluginName(){return"ImageResizeButtons"}init(){const t=this.editor,te=t.config.get("image.resizeOptions"),be=t.commands.get("resizeImage");this.bind("isEnabled").to(be);for(const xe of te)this._registerImageResizeButton(xe);this._registerImageResizeDropdown(te)}_registerImageResizeButton(t){const te=this.editor,{name:be,value:xe,icon:ve}=t;te.ui.componentFactory.add(be,ke=>{const Ie=new ButtonView(ke),Ae=te.commands.get("resizeImage"),Se=this._getOptionLabelValue(t,!0);if(!RESIZE_ICONS[ve])throw new CKEditorError("imageresizebuttons-missing-icon",te,t);if(Ie.set({label:Se,icon:RESIZE_ICONS[ve],tooltip:Se,isToggleable:!0}),Ie.bind("isEnabled").to(this),te.plugins.has("ImageCustomResizeUI")&&isCustomImageResizeOption(t)){const Oe=te.plugins.get("ImageCustomResizeUI");this.listenTo(Ie,"execute",()=>{Oe._showForm(this._resizeUnit)})}else{const Oe=xe?xe+this._resizeUnit:null;Ie.bind("isOn").to(Ae,"value",getIsOnButtonCallback(Oe)),this.listenTo(Ie,"execute",()=>{te.execute("resizeImage",{width:Oe})})}return Ie})}_registerImageResizeDropdown(t){const te=this.editor,be=te.t,xe=t.find(ke=>!ke.value),ve=ke=>{const Ie=te.commands.get("resizeImage"),Ae=createDropdown(ke,DropdownButtonView),Se=Ae.buttonView,Oe=be("Resize image");return Se.set({tooltip:Oe,commandValue:xe.value,icon:RESIZE_ICONS.medium,isToggleable:!0,label:this._getOptionLabelValue(xe),withText:!0,class:"ck-resize-image-button",ariaLabel:Oe,ariaLabelledBy:void 0}),Se.bind("label").to(Ie,"value",Ve=>Ve&&Ve.width?Ve.width:this._getOptionLabelValue(xe)),Ae.bind("isEnabled").to(this),addListToDropdown(Ae,()=>this._getResizeDropdownListItemDefinitions(t,Ie),{ariaLabel:be("Image resize list"),role:"menu"}),this.listenTo(Ae,"execute",Ve=>{"onClick"in Ve.source?Ve.source.onClick():(te.execute(Ve.source.commandName,{width:Ve.source.commandValue}),te.editing.view.focus())}),Ae};te.ui.componentFactory.add("resizeImage",ve),te.ui.componentFactory.add("imageResize",ve)}_getOptionLabelValue(t,te=!1){const be=this.editor.t;return t.label?t.label:te?isCustomImageResizeOption(t)?be("Custom image size"):t.value?be("Resize image to %0",t.value+this._resizeUnit):be("Resize image to the original size"):isCustomImageResizeOption(t)?be("Custom"):t.value?t.value+this._resizeUnit:be("Original")}_getResizeDropdownListItemDefinitions(t,te){const{editor:be}=this,xe=new Collection,ve=t.map(ke=>isCustomImageResizeOption(ke)?{...ke,valueWithUnits:"custom"}:ke.value?{...ke,valueWithUnits:`${ke.value}${this._resizeUnit}`}:{...ke,valueWithUnits:null});for(const ke of ve){let Ie=null;if(be.plugins.has("ImageCustomResizeUI")&&isCustomImageResizeOption(ke)){const Ae=be.plugins.get("ImageCustomResizeUI");Ie={type:"button",model:new Model({label:this._getOptionLabelValue(ke),role:"menuitemradio",withText:!0,icon:null,onClick:()=>{Ae._showForm(this._resizeUnit)}})};const Se=map$1(ve,"valueWithUnits");Ie.model.bind("isOn").to(te,"value",getIsOnCustomButtonCallback(Se))}else Ie={type:"button",model:new Model({commandName:"resizeImage",commandValue:ke.valueWithUnits,label:this._getOptionLabelValue(ke),role:"menuitemradio",withText:!0,icon:null})},Ie.model.bind("isOn").to(te,"value",getIsOnButtonCallback(ke.valueWithUnits));Ie.model.bind("isEnabled").to(te,"isEnabled"),xe.add(Ie)}return xe}}function isCustomImageResizeOption(Te){return Te.value==="custom"}function getIsOnButtonCallback(Te){return we=>{const t=we;return Te===null&&t===Te?!0:t!==null&&t.width===Te}}function getIsOnCustomButtonCallback(Te){return we=>!Te.some(t=>getIsOnButtonCallback(t)(we))}const RESIZABLE_IMAGES_CSS_SELECTOR="figure.image.ck-widget > img,figure.image.ck-widget > picture > img,figure.image.ck-widget > a > img,figure.image.ck-widget > a > picture > img,span.image-inline.ck-widget > img,span.image-inline.ck-widget > picture > img",RESIZED_IMAGE_CLASS="image_resized";class ImageResizeHandles extends Plugin{static get requires(){return[WidgetResize,ImageUtils]}static get pluginName(){return"ImageResizeHandles"}init(){const we=this.editor.commands.get("resizeImage");this.bind("isEnabled").to(we),this._setupResizerCreator()}_setupResizerCreator(){const we=this.editor,t=we.editing.view,te=we.plugins.get("ImageUtils");t.addObserver(ImageLoadObserver),this.listenTo(t.document,"imageLoaded",(be,xe)=>{if(!xe.target.matches(RESIZABLE_IMAGES_CSS_SELECTOR))return;const ve=we.editing.view.domConverter,ke=ve.domToView(xe.target),Ie=te.getImageWidgetFromImageView(ke);let Ae=this.editor.plugins.get(WidgetResize).getResizerByViewElement(Ie);if(Ae){Ae.redraw();return}const Se=we.editing.mapper,Oe=Se.toModelElement(Ie);Ae=we.plugins.get(WidgetResize).attachTo({unit:we.config.get("image.resizeUnit"),modelElement:Oe,viewElement:Ie,editor:we,getHandleHost(Ve){return Ve.querySelector("img")},getResizeHost(){return ve.mapViewToDom(Se.toViewElement(Oe))},isCentered(){return Oe.getAttribute("imageStyle")=="alignCenter"},onCommit(Ve){t.change(Me=>{Me.removeClass(RESIZED_IMAGE_CLASS,Ie)}),we.execute("resizeImage",{width:Ve})}}),Ae.on("updateSize",()=>{Ie.hasClass(RESIZED_IMAGE_CLASS)||t.change(Me=>{Me.addClass(RESIZED_IMAGE_CLASS,Ie)});const Ve=Oe.name==="imageInline"?ke:Ie;Ve.getStyle("height")&&t.change(Me=>{Me.removeStyle("height",Ve)})}),Ae.bind("isEnabled").to(this)})}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function tryParseDimensionWithUnit(Te){if(!Te)return null;const[,we,t]=Te.trim().match(/([.,\d]+)(%|px)$/)||[],te=Number.parseFloat(we);return Number.isNaN(te)?null:{value:te,unit:t}}function tryCastDimensionsToUnit(Te,we,t){return t==="px"?{value:we.value,unit:"px"}:{value:we.value/Te*100,unit:"%"}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function getSelectedImageEditorNodes(Te){const{editing:we}=Te,te=Te.plugins.get("ImageUtils").getClosestSelectedImageElement(Te.model.document.selection);if(!te)return null;const be=we.mapper.toViewElement(te),xe=we.view.domConverter.mapViewToDom(be);return{model:te,view:be,dom:xe}}function getSelectedImageWidthInUnits(Te,we){const t=getSelectedImageEditorNodes(Te);if(!t)return null;const te=tryParseDimensionWithUnit(t.model.getAttribute("resizedWidth")||null);if(!te)return null;if(te.unit===we)return te;const be=calculateResizeHostAncestorWidth(t.dom),xe={unit:"px",value:new Rect(t.dom).width};return tryCastDimensionsToUnit(be,xe,we)}class ImageCustomResizeFormView extends View{constructor(t,te,be){super(t);Re(this,"focusTracker");Re(this,"keystrokes");Re(this,"unit");Re(this,"labeledInput");Re(this,"saveButtonView");Re(this,"cancelButtonView");Re(this,"_focusables");Re(this,"_focusCycler");Re(this,"_validators");const xe=this.locale.t;this.focusTracker=new FocusTracker,this.keystrokes=new KeystrokeHandler,this.unit=te,this.labeledInput=this._createLabeledInputView(),this.saveButtonView=this._createButton(xe("Save"),icons.check,"ck-button-save"),this.saveButtonView.type="submit",this.cancelButtonView=this._createButton(xe("Cancel"),icons.cancel,"ck-button-cancel","cancel"),this._focusables=new ViewCollection,this._validators=be,this._focusCycler=new FocusCycler({focusables:this._focusables,focusTracker:this.focusTracker,keystrokeHandler:this.keystrokes,actions:{focusPrevious:"shift + tab",focusNext:"tab"}}),this.setTemplate({tag:"form",attributes:{class:["ck","ck-image-custom-resize-form","ck-responsive-form"],tabindex:"-1"},children:[this.labeledInput,this.saveButtonView,this.cancelButtonView]})}render(){super.render(),this.keystrokes.listenTo(this.element),submitHandler({view:this}),[this.labeledInput,this.saveButtonView,this.cancelButtonView].forEach(t=>{this._focusables.add(t),this.focusTracker.add(t.element)})}destroy(){super.destroy(),this.focusTracker.destroy(),this.keystrokes.destroy()}_createButton(t,te,be,xe){const ve=new ButtonView(this.locale);return ve.set({label:t,icon:te,tooltip:!0}),ve.extendTemplate({attributes:{class:be}}),xe&&ve.delegate("execute").to(this,xe),ve}_createLabeledInputView(){const t=this.locale.t,te=new LabeledFieldView(this.locale,createLabeledInputNumber);return te.label=t("Resize image (in %0)",this.unit),te.fieldView.set({step:.1}),te}isValid(){this.resetFormStatus();for(const t of this._validators){const te=t(this);if(te)return this.labeledInput.errorText=te,!1}return!0}resetFormStatus(){this.labeledInput.errorText=null}get rawSize(){const{element:t}=this.labeledInput.fieldView;return t?t.value:null}get parsedSize(){const{rawSize:t}=this;if(t===null)return null;const te=Number.parseFloat(t);return Number.isNaN(te)?null:te}get sizeWithUnits(){const{parsedSize:t,unit:te}=this;return t===null?null:`${t}${te}`}}function getSelectedImagePossibleResizeRange(Te,we){const t=getSelectedImageEditorNodes(Te);if(!t)return null;const te=calculateResizeHostAncestorWidth(t.dom),be=tryParseDimensionWithUnit(window.getComputedStyle(t.dom).minWidth)||{value:1,unit:"px"},xe=Math.max(.1,tryCastDimensionsToUnit(te,be,we).value);return{unit:we,lower:xe,upper:we==="px"?te:100}}class ImageCustomResizeUI extends Plugin{constructor(){super(...arguments);Re(this,"_balloon");Re(this,"_form")}static get requires(){return[ContextualBalloon]}static get pluginName(){return"ImageCustomResizeUI"}destroy(){super.destroy(),this._form&&this._form.destroy()}_createForm(t){const te=this.editor;this._balloon=this.editor.plugins.get("ContextualBalloon"),this._form=new(CssTransitionDisablerMixin(ImageCustomResizeFormView))(te.locale,t,getFormValidators$1(te)),this._form.render(),this.listenTo(this._form,"submit",()=>{this._form.isValid()&&(te.execute("resizeImage",{width:this._form.sizeWithUnits}),this._hideForm(!0))}),this.listenTo(this._form.labeledInput,"change:errorText",()=>{te.ui.update()}),this.listenTo(this._form,"cancel",()=>{this._hideForm(!0)}),this._form.keystrokes.set("Esc",(be,xe)=>{this._hideForm(!0),xe()}),clickOutsideHandler({emitter:this._form,activator:()=>this._isVisible,contextElements:()=>[this._balloon.view.element],callback:()=>this._hideForm()})}_showForm(t){if(this._isVisible)return;this._form||this._createForm(t);const te=this.editor,be=this._form.labeledInput;this._form.disableCssTransitions(),this._form.resetFormStatus(),this._isInBalloon||this._balloon.add({view:this._form,position:getBalloonPositionData(te)});const xe=getSelectedImageWidthInUnits(te,t),ve=xe?xe.value.toFixed(1):"",ke=getSelectedImagePossibleResizeRange(te,t);be.fieldView.value=be.fieldView.element.value=ve,ke&&Object.assign(be.fieldView,{min:ke.lower.toFixed(1),max:Math.ceil(ke.upper).toFixed(1)}),this._form.labeledInput.fieldView.select(),this._form.enableCssTransitions()}_hideForm(t=!1){this._isInBalloon&&(this._form.focusTracker.isFocused&&this._form.saveButtonView.focus(),this._balloon.remove(this._form),t&&this.editor.editing.view.focus())}get _isVisible(){return!!this._balloon&&this._balloon.visibleView===this._form}get _isInBalloon(){return!!this._balloon&&this._balloon.hasView(this._form)}}function getFormValidators$1(Te){const we=Te.t;return[t=>{if(t.rawSize.trim()==="")return we("The value must not be empty.");if(t.parsedSize===null)return we("The value should be a plain number.")}]}class ImageResize extends Plugin{static get requires(){return[ImageResizeEditing,ImageResizeHandles,ImageCustomResizeUI,ImageResizeButtons]}static get pluginName(){return"ImageResize"}}class ImageStyleCommand extends Command{constructor(t,te){super(t);Re(this,"_defaultStyles");Re(this,"_styles");this._defaultStyles={imageBlock:!1,imageInline:!1},this._styles=new Map(te.map(be=>{if(be.isDefault)for(const xe of be.modelElements)this._defaultStyles[xe]=be.name;return[be.name,be]}))}refresh(){const be=this.editor.plugins.get("ImageUtils").getClosestSelectedImageElement(this.editor.model.document.selection);this.isEnabled=!!be,this.isEnabled?be.hasAttribute("imageStyle")?this.value=be.getAttribute("imageStyle"):this.value=this._defaultStyles[be.name]:this.value=!1}execute(t={}){const te=this.editor,be=te.model,xe=te.plugins.get("ImageUtils");be.change(ve=>{const ke=t.value,{setImageSizes:Ie=!0}=t;let Ae=xe.getClosestSelectedImageElement(be.document.selection);ke&&this.shouldConvertImageType(ke,Ae)&&(this.editor.execute(xe.isBlockImage(Ae)?"imageTypeInline":"imageTypeBlock",{setImageSizes:Ie}),Ae=xe.getClosestSelectedImageElement(be.document.selection)),!ke||this._styles.get(ke).isDefault?ve.removeAttribute("imageStyle",Ae):ve.setAttribute("imageStyle",ke,Ae),Ie&&xe.setImageNaturalSizeAttributes(Ae)})}shouldConvertImageType(t,te){return!this._styles.get(t).modelElements.includes(te.name)}}const DEFAULT_OPTIONS={get inline(){return{name:"inline",title:"In line",icon:icons.objectInline,modelElements:["imageInline"],isDefault:!0}},get alignLeft(){return{name:"alignLeft",title:"Left aligned image",icon:icons.objectLeft,modelElements:["imageBlock","imageInline"],className:"image-style-align-left"}},get alignBlockLeft(){return{name:"alignBlockLeft",title:"Left aligned image",icon:icons.objectBlockLeft,modelElements:["imageBlock"],className:"image-style-block-align-left"}},get alignCenter(){return{name:"alignCenter",title:"Centered image",icon:icons.objectCenter,modelElements:["imageBlock"],className:"image-style-align-center"}},get alignRight(){return{name:"alignRight",title:"Right aligned image",icon:icons.objectRight,modelElements:["imageBlock","imageInline"],className:"image-style-align-right"}},get alignBlockRight(){return{name:"alignBlockRight",title:"Right aligned image",icon:icons.objectBlockRight,modelElements:["imageBlock"],className:"image-style-block-align-right"}},get block(){return{name:"block",title:"Centered image",icon:icons.objectCenter,modelElements:["imageBlock"],isDefault:!0}},get side(){return{name:"side",title:"Side image",icon:icons.objectRight,modelElements:["imageBlock"],className:"image-style-side"}}},DEFAULT_ICONS={full:icons.objectFullWidth,left:icons.objectBlockLeft,right:icons.objectBlockRight,center:icons.objectCenter,inlineLeft:icons.objectLeft,inlineRight:icons.objectRight,inline:icons.objectInline},DEFAULT_DROPDOWN_DEFINITIONS=[{name:"imageStyle:wrapText",title:"Wrap text",defaultItem:"imageStyle:alignLeft",items:["imageStyle:alignLeft","imageStyle:alignRight"]},{name:"imageStyle:breakText",title:"Break text",defaultItem:"imageStyle:block",items:["imageStyle:alignBlockLeft","imageStyle:block","imageStyle:alignBlockRight"]}];function normalizeStyles(Te){return(Te.configuredStyles.options||[]).map(te=>normalizeDefinition(te)).filter(te=>isValidOption(te,Te))}function getDefaultStylesConfiguration(Te,we){return Te&&we?{options:["inline","alignLeft","alignRight","alignCenter","alignBlockLeft","alignBlockRight","block","side"]}:Te?{options:["block","side"]}:we?{options:["inline","alignLeft","alignRight"]}:{}}function getDefaultDropdownDefinitions(Te){return Te.has("ImageBlockEditing")&&Te.has("ImageInlineEditing")?[...DEFAULT_DROPDOWN_DEFINITIONS]:[]}function normalizeDefinition(Te){return typeof Te=="string"?DEFAULT_OPTIONS[Te]?Te={...DEFAULT_OPTIONS[Te]}:Te={name:Te}:Te=extendStyle(DEFAULT_OPTIONS[Te.name],Te),typeof Te.icon=="string"&&(Te.icon=DEFAULT_ICONS[Te.icon]||Te.icon),Te}function isValidOption(Te,{isBlockPluginLoaded:we,isInlinePluginLoaded:t}){const{modelElements:te,name:be}=Te;if(!te||!te.length||!be)return warnInvalidStyle({style:Te}),!1;{const xe=[we?"imageBlock":null,t?"imageInline":null];if(!te.some(ve=>xe.includes(ve)))return logWarning("image-style-missing-dependency",{style:Te,missingPlugins:te.map(ve=>ve==="imageBlock"?"ImageBlockEditing":"ImageInlineEditing")}),!1}return!0}function extendStyle(Te,we){const t={...we};for(const te in Te)Object.prototype.hasOwnProperty.call(we,te)||(t[te]=Te[te]);return t}function warnInvalidStyle(Te){logWarning("image-style-configuration-definition-invalid",Te)}var utils={normalizeStyles,getDefaultStylesConfiguration,getDefaultDropdownDefinitions,warnInvalidStyle,DEFAULT_OPTIONS,DEFAULT_ICONS,DEFAULT_DROPDOWN_DEFINITIONS};function modelToViewStyleAttribute(Te){return(we,t,te)=>{if(!te.consumable.consume(t.item,we.name))return;const be=getStyleDefinitionByName(t.attributeNewValue,Te),xe=getStyleDefinitionByName(t.attributeOldValue,Te),ve=te.mapper.toViewElement(t.item),ke=te.writer;xe&&ke.removeClass(xe.className,ve),be&&ke.addClass(be.className,ve)}}function viewToModelStyleAttribute(Te){const we={imageInline:Te.filter(t=>!t.isDefault&&t.modelElements.includes("imageInline")),imageBlock:Te.filter(t=>!t.isDefault&&t.modelElements.includes("imageBlock"))};return(t,te,be)=>{if(!te.modelRange)return;const xe=te.viewItem,ve=first(te.modelRange.getItems());if(ve&&be.schema.checkAttribute(ve,"imageStyle"))for(const ke of we[ve.name])be.consumable.consume(xe,{classes:ke.className})&&be.writer.setAttribute("imageStyle",ke.name,ve)}}function getStyleDefinitionByName(Te,we){for(const t of we)if(t.name===Te)return t}class ImageStyleEditing extends Plugin{constructor(){super(...arguments);Re(this,"normalizedStyles")}static get pluginName(){return"ImageStyleEditing"}static get requires(){return[ImageUtils]}init(){const{normalizeStyles:t,getDefaultStylesConfiguration:te}=utils,be=this.editor,xe=be.plugins.has("ImageBlockEditing"),ve=be.plugins.has("ImageInlineEditing");be.config.define("image.styles",te(xe,ve)),this.normalizedStyles=t({configuredStyles:be.config.get("image.styles"),isBlockPluginLoaded:xe,isInlinePluginLoaded:ve}),this._setupConversion(xe,ve),this._setupPostFixer(),be.commands.add("imageStyle",new ImageStyleCommand(be,this.normalizedStyles))}_setupConversion(t,te){const be=this.editor,xe=be.model.schema,ve=modelToViewStyleAttribute(this.normalizedStyles),ke=viewToModelStyleAttribute(this.normalizedStyles);be.editing.downcastDispatcher.on("attribute:imageStyle",ve),be.data.downcastDispatcher.on("attribute:imageStyle",ve),t&&(xe.extend("imageBlock",{allowAttributes:"imageStyle"}),be.data.upcastDispatcher.on("element:figure",ke,{priority:"low"})),te&&(xe.extend("imageInline",{allowAttributes:"imageStyle"}),be.data.upcastDispatcher.on("element:img",ke,{priority:"low"}))}_setupPostFixer(){const t=this.editor,te=t.model.document,be=t.plugins.get(ImageUtils),xe=new Map(this.normalizedStyles.map(ve=>[ve.name,ve]));te.registerPostFixer(ve=>{let ke=!1;for(const Ie of te.differ.getChanges())if(Ie.type=="insert"||Ie.type=="attribute"&&Ie.attributeKey=="imageStyle"){let Ae=Ie.type=="insert"?Ie.position.nodeAfter:Ie.range.start.nodeAfter;if(Ae&&Ae.is("element","paragraph")&&Ae.childCount>0&&(Ae=Ae.getChild(0)),!be.isImage(Ae))continue;const Se=Ae.getAttribute("imageStyle");if(!Se)continue;const Oe=xe.get(Se);(!Oe||!Oe.modelElements.includes(Ae.name))&&(ve.removeAttribute("imageStyle",Ae),ke=!0)}return ke})}}class ImageStyleUI extends Plugin{static get requires(){return[ImageStyleEditing]}static get pluginName(){return"ImageStyleUI"}get localizedDefaultStylesTitles(){const we=this.editor.t;return{"Wrap text":we("Wrap text"),"Break text":we("Break text"),"In line":we("In line"),"Full size image":we("Full size image"),"Side image":we("Side image"),"Left aligned image":we("Left aligned image"),"Centered image":we("Centered image"),"Right aligned image":we("Right aligned image")}}init(){const we=this.editor.plugins,t=this.editor.config.get("image.toolbar")||[],te=we.get("ImageStyleEditing"),be=translateStyles(te.normalizedStyles,this.localizedDefaultStylesTitles);for(const ve of be)this._createButton(ve);const xe=translateStyles([...t.filter(isObject$2),...utils.getDefaultDropdownDefinitions(we)],this.localizedDefaultStylesTitles);for(const ve of xe)this._createDropdown(ve,be)}_createDropdown(we,t){const te=this.editor.ui.componentFactory;te.add(we.name,be=>{let xe;const{defaultItem:ve,items:ke,title:Ie}=we,Ae=ke.filter(Me=>t.find(({name:De})=>getUIComponentName(De)===Me)).map(Me=>{const De=te.create(Me);return Me===ve&&(xe=De),De});ke.length!==Ae.length&&utils.warnInvalidStyle({dropdown:we});const Se=createDropdown(be,SplitButtonView),Oe=Se.buttonView,Ve=Oe.arrowView;return addToolbarToDropdown(Se,Ae,{enableActiveItemFocusOnDropdownOpen:!0}),Oe.set({label:getDropdownButtonTitle(Ie,xe.label),class:null,tooltip:!0}),Ve.unbind("label"),Ve.set({label:Ie}),Oe.bind("icon").toMany(Ae,"isOn",(...Me)=>{const De=Me.findIndex(identity);return De<0?xe.icon:Ae[De].icon}),Oe.bind("label").toMany(Ae,"isOn",(...Me)=>{const De=Me.findIndex(identity);return getDropdownButtonTitle(Ie,De<0?xe.label:Ae[De].label)}),Oe.bind("isOn").toMany(Ae,"isOn",(...Me)=>Me.some(identity)),Oe.bind("class").toMany(Ae,"isOn",(...Me)=>Me.some(identity)?"ck-splitbutton_flatten":void 0),Oe.on("execute",()=>{Ae.some(({isOn:Me})=>Me)?Se.isOpen=!Se.isOpen:xe.fire("execute")}),Se.bind("isEnabled").toMany(Ae,"isEnabled",(...Me)=>Me.some(identity)),this.listenTo(Se,"execute",()=>{this.editor.editing.view.focus()}),Se})}_createButton(we){const t=we.name;this.editor.ui.componentFactory.add(getUIComponentName(t),te=>{const be=this.editor.commands.get("imageStyle"),xe=new ButtonView(te);return xe.set({label:we.title,icon:we.icon,tooltip:!0,isToggleable:!0}),xe.bind("isEnabled").to(be,"isEnabled"),xe.bind("isOn").to(be,"value",ve=>ve===t),xe.on("execute",this._executeCommand.bind(this,t)),xe})}_executeCommand(we){this.editor.execute("imageStyle",{value:we}),this.editor.editing.view.focus()}}function translateStyles(Te,we){for(const t of Te)we[t.title]&&(t.title=we[t.title]);return Te}function getUIComponentName(Te){return`imageStyle:${Te}`}function getDropdownButtonTitle(Te,we){return(Te?Te+": ":"")+we}class ImageStyle extends Plugin{static get requires(){return[ImageStyleEditing,ImageStyleUI]}static get pluginName(){return"ImageStyle"}}class ImageToolbar extends Plugin{static get requires(){return[WidgetToolbarRepository,ImageUtils]}static get pluginName(){return"ImageToolbar"}afterInit(){const we=this.editor,t=we.t,te=we.plugins.get(WidgetToolbarRepository),be=we.plugins.get("ImageUtils");te.register("image",{ariaLabel:t("Image toolbar"),items:normalizeDeclarativeConfig(we.config.get("image.toolbar")||[]),getRelatedElement:xe=>be.getClosestSelectedImageWidget(xe)})}}function normalizeDeclarativeConfig(Te){return Te.map(we=>isObject$2(we)?we.name:we)}class PictureEditing extends Plugin{static get requires(){return[ImageEditing,ImageUtils]}static get pluginName(){return"PictureEditing"}afterInit(){const we=this.editor;we.plugins.has("ImageBlockEditing")&&we.model.schema.extend("imageBlock",{allowAttributes:["sources"]}),we.plugins.has("ImageInlineEditing")&&we.model.schema.extend("imageInline",{allowAttributes:["sources"]}),this._setupConversion(),this._setupImageUploadEditingIntegration()}_setupConversion(){const we=this.editor,t=we.conversion,te=we.plugins.get("ImageUtils");t.for("upcast").add(upcastPicture(te)),t.for("downcast").add(downcastSourcesAttribute(te))}_setupImageUploadEditingIntegration(){const we=this.editor;if(!we.plugins.has("ImageUploadEditing"))return;const t=we.plugins.get("ImageUploadEditing");this.listenTo(t,"uploadComplete",(te,{imageElement:be,data:xe})=>{const ve=xe.sources;ve&&we.model.change(ke=>{ke.setAttributes({sources:ve},be)})})}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class IndentEditing extends Plugin{static get pluginName(){return"IndentEditing"}init(){const we=this.editor;we.commands.add("indent",new MultiCommand(we)),we.commands.add("outdent",new MultiCommand(we))}}class IndentUI extends Plugin{static get pluginName(){return"IndentUI"}init(){const we=this.editor,t=we.locale,te=we.t,be=t.uiLanguageDirection=="ltr"?icons.indent:icons.outdent,xe=t.uiLanguageDirection=="ltr"?icons.outdent:icons.indent;this._defineButton("indent",te("Increase indent"),be),this._defineButton("outdent",te("Decrease indent"),xe)}_defineButton(we,t,te){const be=this.editor;be.ui.componentFactory.add(we,()=>{const xe=this._createButton(ButtonView,we,t,te);return xe.set({tooltip:!0}),xe}),be.ui.componentFactory.add("menuBar:"+we,()=>this._createButton(MenuBarMenuListItemButtonView,we,t,te))}_createButton(we,t,te,be){const xe=this.editor,ve=xe.commands.get(t),ke=new we(xe.locale);return ke.set({label:te,icon:be}),ke.bind("isEnabled").to(ve,"isEnabled"),this.listenTo(ke,"execute",()=>{xe.execute(t),xe.editing.view.focus()}),ke}}class Indent extends Plugin{static get pluginName(){return"Indent"}static get requires(){return[IndentEditing,IndentUI]}}class IndentBlockCommand extends Command{constructor(t,te){super(t);Re(this,"_indentBehavior");this._indentBehavior=te}refresh(){const te=this.editor.model,be=first(te.document.selection.getSelectedBlocks());if(!be||!this._isIndentationChangeAllowed(be)){this.isEnabled=!1;return}this.isEnabled=this._indentBehavior.checkEnabled(be.getAttribute("blockIndent"))}execute(){const t=this.editor.model,te=this._getBlocksToChange();t.change(be=>{for(const xe of te){const ve=xe.getAttribute("blockIndent"),ke=this._indentBehavior.getNextIndent(ve);ke?be.setAttribute("blockIndent",ke,xe):be.removeAttribute("blockIndent",xe)}})}_getBlocksToChange(){const te=this.editor.model.document.selection;return Array.from(te.getSelectedBlocks()).filter(xe=>this._isIndentationChangeAllowed(xe))}_isIndentationChangeAllowed(t){const te=this.editor;return te.model.schema.checkAttribute(t,"blockIndent")?!te.plugins.has("ListUtils")||!this._indentBehavior.isForward?!0:!te.plugins.get("ListUtils").isListItemBlock(t):!1}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class IndentUsingOffset{constructor(we){Re(this,"isForward");Re(this,"offset");Re(this,"unit");this.isForward=we.direction==="forward",this.offset=we.offset,this.unit=we.unit}checkEnabled(we){const t=parseFloat(we||"0");return this.isForward||t>0}getNextIndent(we){const t=parseFloat(we||"0");if(!(!we||we.endsWith(this.unit)))return this.isForward?this.offset+this.unit:void 0;const be=this.isForward?this.offset:-this.offset,xe=t+be;return xe>0?xe+this.unit:void 0}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class IndentUsingClasses{constructor(we){Re(this,"isForward");Re(this,"classes");this.isForward=we.direction==="forward",this.classes=we.classes}checkEnabled(we){const t=this.classes.indexOf(we);return this.isForward?t<this.classes.length-1:t>=0}getNextIndent(we){const t=this.classes.indexOf(we),te=this.isForward?1:-1;return this.classes[t+te]}}const DEFAULT_ELEMENTS=["paragraph","heading1","heading2","heading3","heading4","heading5","heading6"];class IndentBlock extends Plugin{constructor(we){super(we),we.config.define("indentBlock",{offset:40,unit:"px"})}static get pluginName(){return"IndentBlock"}init(){const we=this.editor,t=we.config.get("indentBlock");t.classes&&t.classes.length?(this._setupConversionUsingClasses(t.classes),we.commands.add("indentBlock",new IndentBlockCommand(we,new IndentUsingClasses({direction:"forward",classes:t.classes}))),we.commands.add("outdentBlock",new IndentBlockCommand(we,new IndentUsingClasses({direction:"backward",classes:t.classes})))):(we.data.addStyleProcessorRules(addMarginRules),this._setupConversionUsingOffset(),we.commands.add("indentBlock",new IndentBlockCommand(we,new IndentUsingOffset({direction:"forward",offset:t.offset,unit:t.unit}))),we.commands.add("outdentBlock",new IndentBlockCommand(we,new IndentUsingOffset({direction:"backward",offset:t.offset,unit:t.unit}))))}afterInit(){const we=this.editor,t=we.model.schema,te=we.commands.get("indent"),be=we.commands.get("outdent"),xe=we.config.get("heading.options");(xe&&xe.map(Ie=>Ie.model)||DEFAULT_ELEMENTS).forEach(Ie=>{t.isRegistered(Ie)&&t.extend(Ie,{allowAttributes:"blockIndent"})}),t.setAttributeProperties("blockIndent",{isFormatting:!0}),te.registerChildCommand(we.commands.get("indentBlock")),be.registerChildCommand(we.commands.get("outdentBlock"))}_setupConversionUsingOffset(){const we=this.editor.conversion,te=this.editor.locale.contentLanguageDirection==="rtl"?"margin-right":"margin-left";we.for("upcast").attributeToAttribute({view:{styles:{[te]:/[\s\S]+/}},model:{key:"blockIndent",value:be=>{if(!be.is("element","li"))return be.getStyle(te)}}}),we.for("downcast").attributeToAttribute({model:"blockIndent",view:be=>({key:"style",value:{[te]:be}})})}_setupConversionUsingClasses(we){const t={model:{key:"blockIndent",values:[]},view:{}};for(const te of we)t.model.values.push(te),t.view[te]={key:"class",value:[te]};this.editor.conversion.attributeToAttribute(t)}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class AutomaticDecorators{constructor(){Re(this,"_definitions",new Set)}get length(){return this._definitions.size}add(we){Array.isArray(we)?we.forEach(t=>this._definitions.add(t)):this._definitions.add(we)}getDispatcher(){return we=>{we.on("attribute:linkHref",(t,te,be)=>{if(!be.consumable.test(te.item,"attribute:linkHref")||!(te.item.is("selection")||be.schema.isInline(te.item)))return;const xe=be.writer,ve=xe.document.selection;for(const ke of this._definitions){const Ie=xe.createAttributeElement("a",ke.attributes,{priority:5});ke.classes&&xe.addClass(ke.classes,Ie);for(const Ae in ke.styles)xe.setStyle(Ae,ke.styles[Ae],Ie);xe.setCustomProperty("link",!0,Ie),ke.callback(te.attributeNewValue)?te.item.is("selection")?xe.wrap(ve.getFirstRange(),Ie):xe.wrap(be.mapper.toViewRange(te.range),Ie):xe.unwrap(be.mapper.toViewRange(te.range),Ie)}},{priority:"high"})}}getDispatcherForLinkedImage(){return we=>{we.on("attribute:linkHref:imageBlock",(t,te,{writer:be,mapper:xe})=>{const ve=xe.toViewElement(te.item),ke=Array.from(ve.getChildren()).find(Ie=>Ie.is("element","a"));for(const Ie of this._definitions){const Ae=toMap(Ie.attributes);if(Ie.callback(te.attributeNewValue)){for(const[Se,Oe]of Ae)Se==="class"?be.addClass(Oe,ke):be.setAttribute(Se,Oe,ke);Ie.classes&&be.addClass(Ie.classes,ke);for(const Se in Ie.styles)be.setStyle(Se,Ie.styles[Se],ke)}else{for(const[Se,Oe]of Ae)Se==="class"?be.removeClass(Oe,ke):be.removeAttribute(Se,ke);Ie.classes&&be.removeClass(Ie.classes,ke);for(const Se in Ie.styles)be.removeStyle(Se,ke)}}})}}}const ATTRIBUTE_WHITESPACES=/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205f\u3000]/g,SAFE_URL_TEMPLATE="^(?:(?:<protocols>):|[^a-z]|[a-z+.-]+(?:[^a-z+.:-]|$))",EMAIL_REG_EXP=/^[\S]+@((?![-_])(?:[-\w\u00a1-\uffff]{0,63}[^-_]\.))+(?:[a-z\u00a1-\uffff]{2,})$/i,PROTOCOL_REG_EXP=/^((\w+:(\/{2,})?)|(\W))/i,DEFAULT_LINK_PROTOCOLS=["https?","ftps?","mailto"],LINK_KEYSTROKE="Ctrl+K";function isLinkElement(Te){return Te.is("attributeElement")&&!!Te.getCustomProperty("link")}function createLinkElement(Te,{writer:we}){const t=we.createAttributeElement("a",{href:Te},{priority:5});return we.setCustomProperty("link",!0,t),t}function ensureSafeUrl(Te,we=DEFAULT_LINK_PROTOCOLS){const t=String(Te),te=we.join("|"),be=new RegExp(`${SAFE_URL_TEMPLATE.replace("<protocols>",te)}`,"i");return isSafeUrl(t,be)?t:"#"}function isSafeUrl(Te,we){return!!Te.replace(ATTRIBUTE_WHITESPACES,"").match(we)}function getLocalizedDecorators(Te,we){const t={"Open in a new tab":Te("Open in a new tab"),Downloadable:Te("Downloadable")};return we.forEach(te=>("label"in te&&t[te.label]&&(te.label=t[te.label]),te)),we}function normalizeDecorators(Te){const we=[];if(Te)for(const[t,te]of Object.entries(Te)){const be=Object.assign({},te,{id:`link${upperFirst(t)}`});we.push(be)}return we}function isLinkableElement(Te,we){return Te?we.checkAttribute(Te.name,"linkHref"):!1}function isEmail(Te){return EMAIL_REG_EXP.test(Te)}function addLinkProtocolIfApplicable(Te,we){const t=isEmail(Te)?"mailto:":we,te=!!t&&!linkHasProtocol(Te);return Te&&te?t+Te:Te}function linkHasProtocol(Te){return PROTOCOL_REG_EXP.test(Te)}function openLink(Te){window.open(Te,"_blank","noopener")}class LinkCommand extends Command{constructor(){super(...arguments);Re(this,"manualDecorators",new Collection);Re(this,"automaticDecorators",new AutomaticDecorators)}restoreManualDecoratorStates(){for(const t of this.manualDecorators)t.value=this._getDecoratorStateFromModel(t.id)}refresh(){const t=this.editor.model,te=t.document.selection,be=te.getSelectedElement()||first(te.getSelectedBlocks());isLinkableElement(be,t.schema)?(this.value=be.getAttribute("linkHref"),this.isEnabled=t.schema.checkAttribute(be,"linkHref")):(this.value=te.getAttribute("linkHref"),this.isEnabled=t.schema.checkAttributeInSelection(te,"linkHref"));for(const xe of this.manualDecorators)xe.value=this._getDecoratorStateFromModel(xe.id)}execute(t,te={}){const be=this.editor.model,xe=be.document.selection,ve=[],ke=[];for(const Ie in te)te[Ie]?ve.push(Ie):ke.push(Ie);be.change(Ie=>{if(xe.isCollapsed){const Ae=xe.getFirstPosition();if(xe.hasAttribute("linkHref")){const Se=extractTextFromSelection(xe);let Oe=findAttributeRange(Ae,"linkHref",xe.getAttribute("linkHref"),be);xe.getAttribute("linkHref")===Se&&(Oe=this._updateLinkContent(be,Ie,Oe,t)),Ie.setAttribute("linkHref",t,Oe),ve.forEach(Ve=>{Ie.setAttribute(Ve,!0,Oe)}),ke.forEach(Ve=>{Ie.removeAttribute(Ve,Oe)}),Ie.setSelection(Ie.createPositionAfter(Oe.end.nodeBefore))}else if(t!==""){const Se=toMap(xe.getAttributes());Se.set("linkHref",t),ve.forEach(Ve=>{Se.set(Ve,!0)});const{end:Oe}=be.insertContent(Ie.createText(t,Se),Ae);Ie.setSelection(Oe)}["linkHref",...ve,...ke].forEach(Se=>{Ie.removeSelectionAttribute(Se)})}else{const Ae=be.schema.getValidRanges(xe.getRanges(),"linkHref"),Se=[];for(const Ve of xe.getSelectedBlocks())be.schema.checkAttribute(Ve,"linkHref")&&Se.push(Ie.createRangeOn(Ve));const Oe=Se.slice();for(const Ve of Ae)this._isRangeToUpdate(Ve,Se)&&Oe.push(Ve);for(const Ve of Oe){let Me=Ve;if(Oe.length===1){const De=extractTextFromSelection(xe);xe.getAttribute("linkHref")===De&&(Me=this._updateLinkContent(be,Ie,Ve,t),Ie.setSelection(Ie.createSelection(Me)))}Ie.setAttribute("linkHref",t,Me),ve.forEach(De=>{Ie.setAttribute(De,!0,Me)}),ke.forEach(De=>{Ie.removeAttribute(De,Me)})}}})}_getDecoratorStateFromModel(t){const te=this.editor.model,be=te.document.selection,xe=be.getSelectedElement();return isLinkableElement(xe,te.schema)?xe.getAttribute(t):be.getAttribute(t)}_isRangeToUpdate(t,te){for(const be of te)if(be.containsRange(t))return!1;return!0}_updateLinkContent(t,te,be,xe){const ve=te.createText(xe,{linkHref:xe});return t.insertContent(ve,be)}}function extractTextFromSelection(Te){if(Te.isCollapsed){const we=Te.getFirstPosition();return we.textNode&&we.textNode.data}else{const we=Array.from(Te.getFirstRange().getItems());if(we.length>1)return null;const t=we[0];return t.is("$text")||t.is("$textProxy")?t.data:null}}class UnlinkCommand extends Command{refresh(){const we=this.editor.model,t=we.document.selection,te=t.getSelectedElement();isLinkableElement(te,we.schema)?this.isEnabled=we.schema.checkAttribute(te,"linkHref"):this.isEnabled=we.schema.checkAttributeInSelection(t,"linkHref")}execute(){const we=this.editor,t=this.editor.model,te=t.document.selection,be=we.commands.get("link");t.change(xe=>{const ve=te.isCollapsed?[findAttributeRange(te.getFirstPosition(),"linkHref",te.getAttribute("linkHref"),t)]:t.schema.getValidRanges(te.getRanges(),"linkHref");for(const ke of ve)if(xe.removeAttribute("linkHref",ke),be)for(const Ie of be.manualDecorators)xe.removeAttribute(Ie.id,ke)})}}class ManualDecorator extends ObservableMixin(){constructor({id:t,label:te,attributes:be,classes:xe,styles:ve,defaultValue:ke}){super();Re(this,"id");Re(this,"defaultValue");Re(this,"label");Re(this,"attributes");Re(this,"classes");Re(this,"styles");this.id=t,this.set("value",void 0),this.defaultValue=ke,this.label=te,this.attributes=be,this.classes=xe,this.styles=ve}_createPattern(){return{attributes:this.attributes,classes:this.classes,styles:this.styles}}}const HIGHLIGHT_CLASS="ck-link_selected",DECORATOR_AUTOMATIC="automatic",DECORATOR_MANUAL="manual",EXTERNAL_LINKS_REGEXP=/^(https?:)?\/\//;class LinkEditing extends Plugin{static get pluginName(){return"LinkEditing"}static get requires(){return[TwoStepCaretMovement,Input,ClipboardPipeline]}constructor(we){super(we),we.config.define("link",{allowCreatingEmptyLinks:!1,addTargetToExternalLinks:!1})}init(){const we=this.editor,t=this.editor.config.get("link.allowedProtocols");we.model.schema.extend("$text",{allowAttributes:"linkHref"}),we.conversion.for("dataDowncast").attributeToElement({model:"linkHref",view:createLinkElement}),we.conversion.for("editingDowncast").attributeToElement({model:"linkHref",view:(xe,ve)=>createLinkElement(ensureSafeUrl(xe,t),ve)}),we.conversion.for("upcast").elementToAttribute({view:{name:"a",attributes:{href:!0}},model:{key:"linkHref",value:xe=>xe.getAttribute("href")}}),we.commands.add("link",new LinkCommand(we)),we.commands.add("unlink",new UnlinkCommand(we));const te=getLocalizedDecorators(we.t,normalizeDecorators(we.config.get("link.decorators")));this._enableAutomaticDecorators(te.filter(xe=>xe.mode===DECORATOR_AUTOMATIC)),this._enableManualDecorators(te.filter(xe=>xe.mode===DECORATOR_MANUAL)),we.plugins.get(TwoStepCaretMovement).registerAttribute("linkHref"),inlineHighlight(we,"linkHref","a",HIGHLIGHT_CLASS),this._enableLinkOpen(),this._enableSelectionAttributesFixer(),this._enableClipboardIntegration()}_enableAutomaticDecorators(we){const t=this.editor,be=t.commands.get("link").automaticDecorators;t.config.get("link.addTargetToExternalLinks")&&be.add({id:"linkIsExternal",mode:DECORATOR_AUTOMATIC,callback:xe=>!!xe&&EXTERNAL_LINKS_REGEXP.test(xe),attributes:{target:"_blank",rel:"noopener noreferrer"}}),be.add(we),be.length&&t.conversion.for("downcast").add(be.getDispatcher())}_enableManualDecorators(we){if(!we.length)return;const t=this.editor,be=t.commands.get("link").manualDecorators;we.forEach(xe=>{t.model.schema.extend("$text",{allowAttributes:xe.id});const ve=new ManualDecorator(xe);be.add(ve),t.conversion.for("downcast").attributeToElement({model:ve.id,view:(ke,{writer:Ie,schema:Ae},{item:Se})=>{if((Se.is("selection")||Ae.isInline(Se))&&ke){const Oe=Ie.createAttributeElement("a",ve.attributes,{priority:5});ve.classes&&Ie.addClass(ve.classes,Oe);for(const Ve in ve.styles)Ie.setStyle(Ve,ve.styles[Ve],Oe);return Ie.setCustomProperty("link",!0,Oe),Oe}}}),t.conversion.for("upcast").elementToAttribute({view:{name:"a",...ve._createPattern()},model:{key:ve.id}})})}_enableLinkOpen(){const we=this.editor,te=we.editing.view.document;this.listenTo(te,"click",(be,xe)=>{if(!(env.isMac?xe.domEvent.metaKey:xe.domEvent.ctrlKey))return;let ke=xe.domTarget;if(ke.tagName.toLowerCase()!="a"&&(ke=ke.closest("a")),!ke)return;const Ie=ke.getAttribute("href");Ie&&(be.stop(),xe.preventDefault(),openLink(Ie))},{context:"$capture"}),this.listenTo(te,"keydown",(be,xe)=>{const ke=we.commands.get("link").value;ke&&xe.keyCode===keyCodes.enter&&xe.altKey&&(be.stop(),openLink(ke))})}_enableSelectionAttributesFixer(){const t=this.editor.model,te=t.document.selection;this.listenTo(te,"change:attribute",(be,{attributeKeys:xe})=>{!xe.includes("linkHref")||te.hasAttribute("linkHref")||t.change(ve=>{removeLinkAttributesFromSelection(ve,getLinkAttributesAllowedOnText(t.schema))})})}_enableClipboardIntegration(){const we=this.editor,t=we.model,te=this.editor.config.get("link.defaultProtocol");te&&this.listenTo(we.plugins.get("ClipboardPipeline"),"contentInsertion",(be,xe)=>{t.change(ve=>{const ke=ve.createRangeIn(xe.content);for(const Ie of ke.getItems())if(Ie.hasAttribute("linkHref")){const Ae=addLinkProtocolIfApplicable(Ie.getAttribute("linkHref"),te);ve.setAttribute("linkHref",Ae,Ie)}})})}}function removeLinkAttributesFromSelection(Te,we){Te.removeSelectionAttribute("linkHref");for(const t of we)Te.removeSelectionAttribute(t)}function getLinkAttributesAllowedOnText(Te){return Te.getDefinition("$text").allowAttributes.filter(t=>t.startsWith("link"))}class LinkFormView extends View{constructor(t,te,be){super(t);Re(this,"focusTracker",new FocusTracker);Re(this,"keystrokes",new KeystrokeHandler);Re(this,"urlInputView");Re(this,"saveButtonView");Re(this,"cancelButtonView");Re(this,"_manualDecoratorSwitches");Re(this,"children");Re(this,"_validators");Re(this,"_focusables",new ViewCollection);Re(this,"_focusCycler");const xe=t.t;this._validators=be,this.urlInputView=this._createUrlInput(),this.saveButtonView=this._createButton(xe("Save"),icons.check,"ck-button-save"),this.saveButtonView.type="submit",this.cancelButtonView=this._createButton(xe("Cancel"),icons.cancel,"ck-button-cancel","cancel"),this._manualDecoratorSwitches=this._createManualDecoratorSwitches(te),this.children=this._createFormChildren(te.manualDecorators),this._focusCycler=new FocusCycler({focusables:this._focusables,focusTracker:this.focusTracker,keystrokeHandler:this.keystrokes,actions:{focusPrevious:"shift + tab",focusNext:"tab"}});const ve=["ck","ck-link-form","ck-responsive-form"];te.manualDecorators.length&&ve.push("ck-link-form_layout-vertical","ck-vertical-form"),this.setTemplate({tag:"form",attributes:{class:ve,tabindex:"-1"},children:this.children})}getDecoratorSwitchesState(){return Array.from(this._manualDecoratorSwitches).reduce((t,te)=>(t[te.name]=te.isOn,t),{})}render(){super.render(),submitHandler({view:this}),[this.urlInputView,...this._manualDecoratorSwitches,this.saveButtonView,this.cancelButtonView].forEach(te=>{this._focusables.add(te),this.focusTracker.add(te.element)}),this.keystrokes.listenTo(this.element)}destroy(){super.destroy(),this.focusTracker.destroy(),this.keystrokes.destroy()}focus(){this._focusCycler.focusFirst()}isValid(){this.resetFormStatus();for(const t of this._validators){const te=t(this);if(te)return this.urlInputView.errorText=te,!1}return!0}resetFormStatus(){this.urlInputView.errorText=null}_createUrlInput(){const t=this.locale.t,te=new LabeledFieldView(this.locale,createLabeledInputText);return te.fieldView.inputMode="url",te.label=t("Link URL"),te}_createButton(t,te,be,xe){const ve=new ButtonView(this.locale);return ve.set({label:t,icon:te,tooltip:!0}),ve.extendTemplate({attributes:{class:be}}),xe&&ve.delegate("execute").to(this,xe),ve}_createManualDecoratorSwitches(t){const te=this.createCollection();for(const be of t.manualDecorators){const xe=new SwitchButtonView(this.locale);xe.set({name:be.id,label:be.label,withText:!0}),xe.bind("isOn").toMany([be,t],"value",(ve,ke)=>ke===void 0&&ve===void 0?!!be.defaultValue:!!ve),xe.on("execute",()=>{be.set("value",!xe.isOn)}),te.add(xe)}return te}_createFormChildren(t){const te=this.createCollection();if(te.add(this.urlInputView),t.length){const be=new View;be.setTemplate({tag:"ul",children:this._manualDecoratorSwitches.map(xe=>({tag:"li",children:[xe],attributes:{class:["ck","ck-list__item"]}})),attributes:{class:["ck","ck-reset","ck-list"]}}),te.add(be)}return te.add(this.saveButtonView),te.add(this.cancelButtonView),te}get url(){const{element:t}=this.urlInputView.fieldView;return t?t.value.trim():null}}var unlinkIcon='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="m11.077 15 .991-1.416a.75.75 0 1 1 1.229.86l-1.148 1.64a.748.748 0 0 1-.217.206 5.251 5.251 0 0 1-8.503-5.955.741.741 0 0 1 .12-.274l1.147-1.639a.75.75 0 1 1 1.228.86L4.933 10.7l.006.003a3.75 3.75 0 0 0 6.132 4.294l.006.004zm5.494-5.335a.748.748 0 0 1-.12.274l-1.147 1.639a.75.75 0 1 1-1.228-.86l.86-1.23a3.75 3.75 0 0 0-6.144-4.301l-.86 1.229a.75.75 0 0 1-1.229-.86l1.148-1.64a.748.748 0 0 1 .217-.206 5.251 5.251 0 0 1 8.503 5.955zm-4.563-2.532a.75.75 0 0 1 .184 1.045l-3.155 4.505a.75.75 0 1 1-1.229-.86l3.155-4.506a.75.75 0 0 1 1.045-.184zm4.919 10.562-1.414 1.414a.75.75 0 1 1-1.06-1.06l1.414-1.415-1.415-1.414a.75.75 0 0 1 1.061-1.06l1.414 1.414 1.414-1.415a.75.75 0 0 1 1.061 1.061l-1.414 1.414 1.414 1.415a.75.75 0 0 1-1.06 1.06l-1.415-1.414z"/></svg>';class LinkActionsView extends View{constructor(t,te={}){super(t);Re(this,"focusTracker",new FocusTracker);Re(this,"keystrokes",new KeystrokeHandler);Re(this,"previewButtonView");Re(this,"unlinkButtonView");Re(this,"editButtonView");Re(this,"_focusables",new ViewCollection);Re(this,"_focusCycler");Re(this,"_linkConfig");const be=t.t;this.previewButtonView=this._createPreviewButton(),this.unlinkButtonView=this._createButton(be("Unlink"),unlinkIcon,"unlink"),this.editButtonView=this._createButton(be("Edit link"),icons.pencil,"edit"),this.set("href",void 0),this._linkConfig=te,this._focusCycler=new FocusCycler({focusables:this._focusables,focusTracker:this.focusTracker,keystrokeHandler:this.keystrokes,actions:{focusPrevious:"shift + tab",focusNext:"tab"}}),this.setTemplate({tag:"div",attributes:{class:["ck","ck-link-actions","ck-responsive-form"],tabindex:"-1"},children:[this.previewButtonView,this.editButtonView,this.unlinkButtonView]})}render(){super.render(),[this.previewButtonView,this.editButtonView,this.unlinkButtonView].forEach(te=>{this._focusables.add(te),this.focusTracker.add(te.element)}),this.keystrokes.listenTo(this.element)}destroy(){super.destroy(),this.focusTracker.destroy(),this.keystrokes.destroy()}focus(){this._focusCycler.focusFirst()}_createButton(t,te,be){const xe=new ButtonView(this.locale);return xe.set({label:t,icon:te,tooltip:!0}),xe.delegate("execute").to(this,be),xe}_createPreviewButton(){const t=new ButtonView(this.locale),te=this.bindTemplate,be=this.t;return t.set({withText:!0,tooltip:be("Open link in new tab")}),t.extendTemplate({attributes:{class:["ck","ck-link-actions__preview"],href:te.to("href",xe=>xe&&ensureSafeUrl(xe,this._linkConfig.allowedProtocols)),target:"_blank",rel:"noopener noreferrer"}}),t.bind("label").to(this,"href",xe=>xe||be("This link has no URL")),t.bind("isEnabled").to(this,"href",xe=>!!xe),t.template.tag="a",t.template.eventListeners={},t}}var linkIcon='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="m11.077 15 .991-1.416a.75.75 0 1 1 1.229.86l-1.148 1.64a.748.748 0 0 1-.217.206 5.251 5.251 0 0 1-8.503-5.955.741.741 0 0 1 .12-.274l1.147-1.639a.75.75 0 1 1 1.228.86L4.933 10.7l.006.003a3.75 3.75 0 0 0 6.132 4.294l.006.004zm5.494-5.335a.748.748 0 0 1-.12.274l-1.147 1.639a.75.75 0 1 1-1.228-.86l.86-1.23a3.75 3.75 0 0 0-6.144-4.301l-.86 1.229a.75.75 0 0 1-1.229-.86l1.148-1.64a.748.748 0 0 1 .217-.206 5.251 5.251 0 0 1 8.503 5.955zm-4.563-2.532a.75.75 0 0 1 .184 1.045l-3.155 4.505a.75.75 0 1 1-1.229-.86l3.155-4.506a.75.75 0 0 1 1.045-.184z"/></svg>';const VISUAL_SELECTION_MARKER_NAME="link-ui";class LinkUI extends Plugin{constructor(){super(...arguments);Re(this,"actionsView",null);Re(this,"formView",null);Re(this,"_balloon")}static get requires(){return[ContextualBalloon]}static get pluginName(){return"LinkUI"}init(){const t=this.editor,te=this.editor.t;t.editing.view.addObserver(ClickObserver),this._balloon=t.plugins.get(ContextualBalloon),this._createToolbarLinkButton(),this._enableBalloonActivators(),t.conversion.for("editingDowncast").markerToHighlight({model:VISUAL_SELECTION_MARKER_NAME,view:{classes:["ck-fake-link-selection"]}}),t.conversion.for("editingDowncast").markerToElement({model:VISUAL_SELECTION_MARKER_NAME,view:{name:"span",classes:["ck-fake-link-selection","ck-fake-link-selection_collapsed"]}}),t.accessibility.addKeystrokeInfos({keystrokes:[{label:te("Create link"),keystroke:LINK_KEYSTROKE},{label:te("Move out of a link"),keystroke:[["arrowleft","arrowleft"],["arrowright","arrowright"]]}]})}destroy(){super.destroy(),this.formView&&this.formView.destroy(),this.actionsView&&this.actionsView.destroy()}_createViews(){this.actionsView=this._createActionsView(),this.formView=this._createFormView(),this._enableUserBalloonInteractions()}_createActionsView(){const t=this.editor,te=new LinkActionsView(t.locale,t.config.get("link")),be=t.commands.get("link"),xe=t.commands.get("unlink");return te.bind("href").to(be,"value"),te.editButtonView.bind("isEnabled").to(be),te.unlinkButtonView.bind("isEnabled").to(xe),this.listenTo(te,"edit",()=>{this._addFormView()}),this.listenTo(te,"unlink",()=>{t.execute("unlink"),this._hideUI()}),te.keystrokes.set("Esc",(ve,ke)=>{this._hideUI(),ke()}),te.keystrokes.set(LINK_KEYSTROKE,(ve,ke)=>{this._addFormView(),ke()}),te}_createFormView(){const t=this.editor,te=t.commands.get("link"),be=t.config.get("link.defaultProtocol"),xe=new(CssTransitionDisablerMixin(LinkFormView))(t.locale,te,getFormValidators(t));return xe.urlInputView.fieldView.bind("value").to(te,"value"),xe.urlInputView.bind("isEnabled").to(te,"isEnabled"),xe.saveButtonView.bind("isEnabled").to(te,"isEnabled"),this.listenTo(xe,"submit",()=>{if(xe.isValid()){const{value:ve}=xe.urlInputView.fieldView.element,ke=addLinkProtocolIfApplicable(ve,be);t.execute("link",ke,xe.getDecoratorSwitchesState()),this._closeFormView()}}),this.listenTo(xe.urlInputView,"change:errorText",()=>{t.ui.update()}),this.listenTo(xe,"cancel",()=>{this._closeFormView()}),xe.keystrokes.set("Esc",(ve,ke)=>{this._closeFormView(),ke()}),xe}_createToolbarLinkButton(){const t=this.editor,te=t.commands.get("link");t.ui.componentFactory.add("link",()=>{const be=this._createButton(ButtonView);return be.set({tooltip:!0,isToggleable:!0}),be.bind("isOn").to(te,"value",xe=>!!xe),be}),t.ui.componentFactory.add("menuBar:link",()=>this._createButton(MenuBarMenuListItemButtonView))}_createButton(t){const te=this.editor,be=te.locale,xe=te.commands.get("link"),ve=new t(te.locale),ke=be.t;return ve.set({label:ke("Link"),icon:linkIcon,keystroke:LINK_KEYSTROKE}),ve.bind("isEnabled").to(xe,"isEnabled"),this.listenTo(ve,"execute",()=>this._showUI(!0)),ve}_enableBalloonActivators(){const t=this.editor,te=t.editing.view.document;this.listenTo(te,"click",()=>{this._getSelectedLinkElement()&&this._showUI()}),t.keystrokes.set(LINK_KEYSTROKE,(be,xe)=>{xe(),t.commands.get("link").isEnabled&&this._showUI(!0)})}_enableUserBalloonInteractions(){this.editor.keystrokes.set("Tab",(t,te)=>{this._areActionsVisible&&!this.actionsView.focusTracker.isFocused&&(this.actionsView.focus(),te())},{priority:"high"}),this.editor.keystrokes.set("Esc",(t,te)=>{this._isUIVisible&&(this._hideUI(),te())}),clickOutsideHandler({emitter:this.formView,activator:()=>this._isUIInPanel,contextElements:()=>[this._balloon.view.element],callback:()=>this._hideUI()})}_addActionsView(){this.actionsView||this._createViews(),!this._areActionsInPanel&&this._balloon.add({view:this.actionsView,position:this._getBalloonPositionData()})}_addFormView(){if(this.formView||this._createViews(),this._isFormInPanel)return;const te=this.editor.commands.get("link");this.formView.disableCssTransitions(),this.formView.resetFormStatus(),this._balloon.add({view:this.formView,position:this._getBalloonPositionData()}),this.formView.urlInputView.fieldView.value=te.value||"",this._balloon.visibleView===this.formView&&this.formView.urlInputView.fieldView.select(),this.formView.enableCssTransitions()}_closeFormView(){const t=this.editor.commands.get("link");t.restoreManualDecoratorStates(),t.value!==void 0?this._removeFormView():this._hideUI()}_removeFormView(){this._isFormInPanel&&(this.formView.saveButtonView.focus(),this.formView.urlInputView.fieldView.reset(),this._balloon.remove(this.formView),this.editor.editing.view.focus(),this._hideFakeVisualSelection())}_showUI(t=!1){this.formView||this._createViews(),this._getSelectedLinkElement()?(this._areActionsVisible?this._addFormView():this._addActionsView(),t&&this._balloon.showStack("main")):(this._showFakeVisualSelection(),this._addActionsView(),t&&this._balloon.showStack("main"),this._addFormView()),this._startUpdatingUI()}_hideUI(){if(!this._isUIInPanel)return;const t=this.editor;this.stopListening(t.ui,"update"),this.stopListening(this._balloon,"change:visibleView"),t.editing.view.focus(),this._removeFormView(),this._balloon.remove(this.actionsView),this._hideFakeVisualSelection()}_startUpdatingUI(){const t=this.editor,te=t.editing.view.document;let be=this._getSelectedLinkElement(),xe=ke();const ve=()=>{const Ie=this._getSelectedLinkElement(),Ae=ke();be&&!Ie||!be&&Ae!==xe?this._hideUI():this._isUIVisible&&this._balloon.updatePosition(this._getBalloonPositionData()),be=Ie,xe=Ae};function ke(){return te.selection.focus.getAncestors().reverse().find(Ie=>Ie.is("element"))}this.listenTo(t.ui,"update",ve),this.listenTo(this._balloon,"change:visibleView",ve)}get _isFormInPanel(){return!!this.formView&&this._balloon.hasView(this.formView)}get _areActionsInPanel(){return!!this.actionsView&&this._balloon.hasView(this.actionsView)}get _areActionsVisible(){return!!this.actionsView&&this._balloon.visibleView===this.actionsView}get _isUIInPanel(){return this._isFormInPanel||this._areActionsInPanel}get _isUIVisible(){const t=this._balloon.visibleView;return!!this.formView&&t==this.formView||this._areActionsVisible}_getBalloonPositionData(){const t=this.editor.editing.view,te=this.editor.model,be=t.document;let xe;if(te.markers.has(VISUAL_SELECTION_MARKER_NAME)){const ve=Array.from(this.editor.editing.mapper.markerNameToElements(VISUAL_SELECTION_MARKER_NAME)),ke=t.createRange(t.createPositionBefore(ve[0]),t.createPositionAfter(ve[ve.length-1]));xe=t.domConverter.viewRangeToDom(ke)}else xe=()=>{const ve=this._getSelectedLinkElement();return ve?t.domConverter.mapViewToDom(ve):t.domConverter.viewRangeToDom(be.selection.getFirstRange())};return{target:xe}}_getSelectedLinkElement(){const t=this.editor.editing.view,te=t.document.selection,be=te.getSelectedElement();if(te.isCollapsed||be&&isWidget(be))return findLinkElementAncestor(te.getFirstPosition());{const xe=te.getFirstRange().getTrimmed(),ve=findLinkElementAncestor(xe.start),ke=findLinkElementAncestor(xe.end);return!ve||ve!=ke?null:t.createRangeIn(ve).getTrimmed().isEqual(xe)?ve:null}}_showFakeVisualSelection(){const t=this.editor.model;t.change(te=>{const be=t.document.selection.getFirstRange();if(t.markers.has(VISUAL_SELECTION_MARKER_NAME))te.updateMarker(VISUAL_SELECTION_MARKER_NAME,{range:be});else if(be.start.isAtEnd){const xe=be.start.getLastMatchingPosition(({item:ve})=>!t.schema.isContent(ve),{boundaries:be});te.addMarker(VISUAL_SELECTION_MARKER_NAME,{usingOperation:!1,affectsData:!1,range:te.createRange(xe,be.end)})}else te.addMarker(VISUAL_SELECTION_MARKER_NAME,{usingOperation:!1,affectsData:!1,range:be})})}_hideFakeVisualSelection(){const t=this.editor.model;t.markers.has(VISUAL_SELECTION_MARKER_NAME)&&t.change(te=>{te.removeMarker(VISUAL_SELECTION_MARKER_NAME)})}}function findLinkElementAncestor(Te){return Te.getAncestors().find(we=>isLinkElement(we))||null}function getFormValidators(Te){const we=Te.t,t=Te.config.get("link.allowCreatingEmptyLinks");return[te=>{if(!t&&!te.url.length)return we("Link URL must not be empty.")}]}const MIN_LINK_LENGTH_WITH_SPACE_AT_END=4,URL_REG_EXP=new RegExp("(^|\\s)(((?:(?:(?:https?|ftp):)?\\/\\/)(?:\\S+(?::\\S*)?@)?(?:(?:[1-9]\\d?|1\\d\\d|2[01]\\d|22[0-3])(?:\\.(?:1?\\d{1,2}|2[0-4]\\d|25[0-5])){2}(?:\\.(?:[1-9]\\d?|1\\d\\d|2[0-4]\\d|25[0-4]))|(((?!www\\.)|(www\\.))(?![-_])(?:[-_a-z0-9\\u00a1-\\uffff]{1,63}\\.)+(?:[a-z\\u00a1-\\uffff]{2,63})))(?::\\d{2,5})?(?:[/?#]\\S*)?)|((www.|(\\S+@))((?![-_])(?:[-_a-z0-9\\u00a1-\\uffff]{1,63}\\.))+(?:[a-z\\u00a1-\\uffff]{2,63})))$","i"),URL_GROUP_IN_MATCH=2;class AutoLink extends Plugin{static get requires(){return[Delete,LinkEditing]}static get pluginName(){return"AutoLink"}init(){const t=this.editor.model.document.selection;t.on("change:range",()=>{this.isEnabled=!t.anchor.parent.is("element","codeBlock")}),this._enableTypingHandling()}afterInit(){this._enableEnterHandling(),this._enableShiftEnterHandling(),this._enablePasteLinking()}_expandLinkRange(we,t){return t.textNode&&t.textNode.hasAttribute("linkHref")?findAttributeRange(t,"linkHref",t.textNode.getAttribute("linkHref"),we):null}_selectEntireLinks(we,t){const be=this.editor.model,xe=be.document.selection,ve=xe.getFirstPosition(),ke=xe.getLastPosition();let Ie=t.getJoined(this._expandLinkRange(be,ve)||t);Ie&&(Ie=Ie.getJoined(this._expandLinkRange(be,ke)||t)),Ie&&(Ie.start.isBefore(ve)||Ie.end.isAfter(ke))&&we.setSelection(Ie)}_enablePasteLinking(){const we=this.editor,t=we.model,te=t.document.selection,be=we.plugins.get("ClipboardPipeline"),xe=we.commands.get("link");be.on("inputTransformation",(ve,ke)=>{if(!this.isEnabled||!xe.isEnabled||te.isCollapsed||ke.method!=="paste"||te.rangeCount>1)return;const Ie=te.getFirstRange(),Ae=ke.dataTransfer.getData("text/plain");if(!Ae)return;const Se=Ae.match(URL_REG_EXP);Se&&Se[2]===Ae&&(t.change(Oe=>{this._selectEntireLinks(Oe,Ie),xe.execute(Ae)}),ve.stop())},{priority:"high"})}_enableTypingHandling(){const we=this.editor,t=new TextWatcher(we.model,te=>{if(!isSingleSpaceAtTheEnd(te))return;const be=getUrlAtTextEnd(te.substr(0,te.length-1));if(be)return{url:be}});t.on("matched:data",(te,be)=>{const{batch:xe,range:ve,url:ke}=be;if(!xe.isTyping)return;const Ie=ve.end.getShiftedBy(-1),Ae=Ie.getShiftedBy(-ke.length),Se=we.model.createRange(Ae,Ie);this._applyAutoLink(ke,Se)}),t.bind("isEnabled").to(this)}_enableEnterHandling(){const we=this.editor,t=we.model,te=we.commands.get("enter");te&&te.on("execute",()=>{const be=t.document.selection.getFirstPosition();if(!be.parent.previousSibling)return;const xe=t.createRangeIn(be.parent.previousSibling);this._checkAndApplyAutoLinkOnRange(xe)})}_enableShiftEnterHandling(){const we=this.editor,t=we.model,te=we.commands.get("shiftEnter");te&&te.on("execute",()=>{const be=t.document.selection.getFirstPosition(),xe=t.createRange(t.createPositionAt(be.parent,0),be.getShiftedBy(-1));this._checkAndApplyAutoLinkOnRange(xe)})}_checkAndApplyAutoLinkOnRange(we){const t=this.editor.model,{text:te,range:be}=getLastTextLine(we,t),xe=getUrlAtTextEnd(te);if(xe){const ve=t.createRange(be.end.getShiftedBy(-xe.length),be.end);this._applyAutoLink(xe,ve)}}_applyAutoLink(we,t){const te=this.editor.model,be=this.editor.config.get("link.defaultProtocol"),xe=addLinkProtocolIfApplicable(we,be);!this.isEnabled||!isLinkAllowedOnRange(t,te)||!linkHasProtocol(xe)||linkIsAlreadySet(t)||this._persistAutoLink(xe,t)}_persistAutoLink(we,t){const te=this.editor.model,be=this.editor.plugins.get("Delete");te.enqueueChange(xe=>{xe.setAttribute("linkHref",we,t),te.enqueueChange(()=>{be.requestUndoOnBackspace()})})}}function isSingleSpaceAtTheEnd(Te){return Te.length>MIN_LINK_LENGTH_WITH_SPACE_AT_END&&Te[Te.length-1]===" "&&Te[Te.length-2]!==" "}function getUrlAtTextEnd(Te){const we=URL_REG_EXP.exec(Te);return we?we[URL_GROUP_IN_MATCH]:null}function isLinkAllowedOnRange(Te,we){return we.schema.checkAttributeInSelection(we.createSelection(Te),"linkHref")}function linkIsAlreadySet(Te){const we=Te.start.nodeAfter;return!!we&&we.hasAttribute("linkHref")}class Link extends Plugin{static get requires(){return[LinkEditing,LinkUI,AutoLink]}static get pluginName(){return"Link"}}class LinkImageEditing extends Plugin{static get requires(){return["ImageEditing","ImageUtils",LinkEditing]}static get pluginName(){return"LinkImageEditing"}afterInit(){const we=this.editor,t=we.model.schema;we.plugins.has("ImageBlockEditing")&&t.extend("imageBlock",{allowAttributes:["linkHref"]}),we.conversion.for("upcast").add(upcastLink(we)),we.conversion.for("downcast").add(downcastImageLink(we)),this._enableAutomaticDecorators(),this._enableManualDecorators()}_enableAutomaticDecorators(){const we=this.editor,te=we.commands.get("link").automaticDecorators;te.length&&we.conversion.for("downcast").add(te.getDispatcherForLinkedImage())}_enableManualDecorators(){const we=this.editor,t=we.commands.get("link");for(const te of t.manualDecorators)we.plugins.has("ImageBlockEditing")&&we.model.schema.extend("imageBlock",{allowAttributes:te.id}),we.plugins.has("ImageInlineEditing")&&we.model.schema.extend("imageInline",{allowAttributes:te.id}),we.conversion.for("downcast").add(downcastImageLinkManualDecorator(te)),we.conversion.for("upcast").add(upcastImageLinkManualDecorator(we,te))}}function upcastLink(Te){const we=Te.plugins.has("ImageInlineEditing"),t=Te.plugins.get("ImageUtils");return te=>{te.on("element:a",(be,xe,ve)=>{const ke=xe.viewItem,Ie=t.findViewImgElement(ke);if(!Ie)return;const Ae=Ie.findAncestor(Me=>t.isBlockImageView(Me));if(we&&!Ae)return;const Se={attributes:["href"]};if(!ve.consumable.consume(ke,Se))return;const Oe=ke.getAttribute("href");if(!Oe)return;let Ve=xe.modelCursor.parent;if(!Ve.is("element","imageBlock")){const Me=ve.convertItem(Ie,xe.modelCursor);xe.modelRange=Me.modelRange,xe.modelCursor=Me.modelCursor,Ve=xe.modelCursor.nodeBefore}Ve&&Ve.is("element","imageBlock")&&ve.writer.setAttribute("linkHref",Oe,Ve)},{priority:"high"})}}function downcastImageLink(Te){const we=Te.plugins.get("ImageUtils");return t=>{t.on("attribute:linkHref:imageBlock",(te,be,xe)=>{if(!xe.consumable.consume(be.item,te.name))return;const ve=xe.mapper.toViewElement(be.item),ke=xe.writer,Ie=Array.from(ve.getChildren()).find(Oe=>Oe.is("element","a")),Ae=we.findViewImgElement(ve),Se=Ae.parent.is("element","picture")?Ae.parent:Ae;if(Ie)be.attributeNewValue?ke.setAttribute("href",be.attributeNewValue,Ie):(ke.move(ke.createRangeOn(Se),ke.createPositionAt(ve,0)),ke.remove(Ie));else{const Oe=ke.createContainerElement("a",{href:be.attributeNewValue});ke.insert(ke.createPositionAt(ve,0),Oe),ke.move(ke.createRangeOn(Se),ke.createPositionAt(Oe,0))}},{priority:"high"})}}function downcastImageLinkManualDecorator(Te){return we=>{we.on(`attribute:${Te.id}:imageBlock`,(t,te,be)=>{const xe=be.mapper.toViewElement(te.item),ve=Array.from(xe.getChildren()).find(ke=>ke.is("element","a"));if(ve){for(const[ke,Ie]of toMap(Te.attributes))be.writer.setAttribute(ke,Ie,ve);Te.classes&&be.writer.addClass(Te.classes,ve);for(const ke in Te.styles)be.writer.setStyle(ke,Te.styles[ke],ve)}})}}function upcastImageLinkManualDecorator(Te,we){const t=Te.plugins.has("ImageInlineEditing"),te=Te.plugins.get("ImageUtils");return be=>{be.on("element:a",(xe,ve,ke)=>{const Ie=ve.viewItem,Ae=te.findViewImgElement(Ie);if(!Ae)return;const Se=Ae.findAncestor(De=>te.isBlockImageView(De));if(t&&!Se)return;const Ve=new Matcher(we._createPattern()).match(Ie);if(!Ve||!ke.consumable.consume(Ie,Ve.match))return;const Me=ve.modelCursor.nodeBefore||ve.modelCursor.parent;ke.writer.setAttribute(we.id,!0,Me)},{priority:"high"})}}class LinkImageUI extends Plugin{static get requires(){return[LinkEditing,LinkUI,"ImageBlockEditing"]}static get pluginName(){return"LinkImageUI"}init(){const we=this.editor,t=we.editing.view.document;this.listenTo(t,"click",(te,be)=>{this._isSelectedLinkedImage(we.model.document.selection)&&(be.preventDefault(),te.stop())},{priority:"high"}),this._createToolbarLinkImageButton()}_createToolbarLinkImageButton(){const we=this.editor,t=we.t;we.ui.componentFactory.add("linkImage",te=>{const be=new ButtonView(te),xe=we.plugins.get("LinkUI"),ve=we.commands.get("link");return be.set({isEnabled:!0,label:t("Link image"),icon:linkIcon,keystroke:LINK_KEYSTROKE,tooltip:!0,isToggleable:!0}),be.bind("isEnabled").to(ve,"isEnabled"),be.bind("isOn").to(ve,"value",ke=>!!ke),this.listenTo(be,"execute",()=>{this._isSelectedLinkedImage(we.model.document.selection)?xe._addActionsView():xe._showUI(!0)}),be})}_isSelectedLinkedImage(we){const t=we.getSelectedElement();return this.editor.plugins.get("ImageUtils").isImage(t)&&t.hasAttribute("linkHref")}}class LinkImage extends Plugin{static get requires(){return[LinkImageEditing,LinkImageUI]}static get pluginName(){return"LinkImage"}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class ListWalker{constructor(we,t){Re(this,"_startElement");Re(this,"_referenceIndent");Re(this,"_isForward");Re(this,"_includeSelf");Re(this,"_sameAttributes");Re(this,"_sameIndent");Re(this,"_lowerIndent");Re(this,"_higherIndent");this._startElement=we,this._referenceIndent=we.getAttribute("listIndent"),this._isForward=t.direction=="forward",this._includeSelf=!!t.includeSelf,this._sameAttributes=toArray$2(t.sameAttributes||[]),this._sameIndent=!!t.sameIndent,this._lowerIndent=!!t.lowerIndent,this._higherIndent=!!t.higherIndent}static first(we,t){const be=new this(we,t)[Symbol.iterator]();return first(be)}*[Symbol.iterator](){const we=[];for(const{node:t}of iterateSiblingListBlocks(this._getStartNode(),this._isForward?"forward":"backward")){const te=t.getAttribute("listIndent");if(te<this._referenceIndent){if(!this._lowerIndent)break;this._referenceIndent=te}else if(te>this._referenceIndent){if(!this._higherIndent)continue;if(!this._isForward){we.push(t);continue}}else{if(!this._sameIndent){if(this._higherIndent){we.length&&(yield*we,we.length=0);break}continue}if(this._sameAttributes.some(be=>t.getAttribute(be)!==this._startElement.getAttribute(be)))break}we.length&&(yield*we,we.length=0),yield t}}_getStartNode(){return this._includeSelf?this._startElement:this._isForward?this._startElement.nextSibling:this._startElement.previousSibling}}function*iterateSiblingListBlocks(Te,we="forward"){const t=we=="forward",te=[];let be=null;for(;isListItemBlock(Te);){let xe=null;if(be){const ve=Te.getAttribute("listIndent"),ke=be.getAttribute("listIndent");ve>ke?te[ke]=be:ve<ke?(xe=te[ve],te.length=ve):xe=be}yield{node:Te,previous:be,previousNodeInList:xe},be=Te,Te=t?Te.nextSibling:Te.previousSibling}}class ListBlocksIterable{constructor(we){Re(this,"_listHead");this._listHead=we}[Symbol.iterator](){return iterateSiblingListBlocks(this._listHead,"forward")}}class ListItemUid{static next(){return uid()}}function isListItemBlock(Te){return!!Te&&Te.is("element")&&Te.hasAttribute("listItemId")}function getAllListItemBlocks(Te,we={}){return[...getListItemBlocks(Te,{...we,direction:"backward"}),...getListItemBlocks(Te,{...we,direction:"forward"})]}function getListItemBlocks(Te,we={}){const t=we.direction=="forward",te=Array.from(new ListWalker(Te,{...we,includeSelf:t,sameIndent:!0,sameAttributes:"listItemId"}));return t?te:te.reverse()}function getNestedListBlocks(Te){return Array.from(new ListWalker(Te,{direction:"forward",higherIndent:!0}))}function getListItems(Te,we){const t=new ListWalker(Te,{sameIndent:!0,sameAttributes:"listType",...we}),te=new ListWalker(Te,{sameIndent:!0,sameAttributes:"listType",includeSelf:!0,direction:"forward",...we});return[...Array.from(t).reverse(),...te]}function isFirstBlockOfListItem(Te){return!ListWalker.first(Te,{sameIndent:!0,sameAttributes:"listItemId"})}function isLastBlockOfListItem(Te){return!ListWalker.first(Te,{direction:"forward",sameIndent:!0,sameAttributes:"listItemId"})}function expandListBlocksToCompleteItems(Te,we={}){Te=toArray$2(Te);const t=we.withNested!==!1,te=new Set;for(const be of Te)for(const xe of getAllListItemBlocks(be,{higherIndent:t}))te.add(xe);return sortBlocks(te)}function expandListBlocksToCompleteList(Te){Te=toArray$2(Te);const we=new Set;for(const t of Te)for(const te of getListItems(t))we.add(te);return sortBlocks(we)}function splitListItemBefore(Te,we){const t=getListItemBlocks(Te,{direction:"forward"}),te=ListItemUid.next();for(const be of t)we.setAttribute("listItemId",te,be);return t}function mergeListItemBefore(Te,we,t){const te={};for(const[xe,ve]of we.getAttributes())xe.startsWith("list")&&(te[xe]=ve);const be=getListItemBlocks(Te,{direction:"forward"});for(const xe of be)t.setAttributes(te,xe);return be}function indentBlocks(Te,we,{expand:t,indentBy:te=1}={}){Te=toArray$2(Te);const be=t?expandListBlocksToCompleteItems(Te):Te;for(const xe of be){const ve=xe.getAttribute("listIndent")+te;ve<0?removeListAttributes(xe,we):we.setAttribute("listIndent",ve,xe)}return be}function outdentBlocksWithMerge(Te,we){Te=toArray$2(Te);const t=expandListBlocksToCompleteItems(Te),te=new Set,be=Math.min(...t.map(ve=>ve.getAttribute("listIndent"))),xe=new Map;for(const ve of t)xe.set(ve,ListWalker.first(ve,{lowerIndent:!0}));for(const ve of t){if(te.has(ve))continue;te.add(ve);const ke=ve.getAttribute("listIndent")-1;if(ke<0){removeListAttributes(ve,we);continue}if(ve.getAttribute("listIndent")==be){const Ie=mergeListItemIfNotLast(ve,xe.get(ve),we);for(const Ae of Ie)te.add(Ae);if(Ie.length)continue}we.setAttribute("listIndent",ke,ve)}return sortBlocks(te)}function removeListAttributes(Te,we){Te=toArray$2(Te);for(const t of Te)t.is("element","listItem")&&we.rename(t,"paragraph");for(const t of Te)for(const te of t.getAttributeKeys())te.startsWith("list")&&we.removeAttribute(te,t);return Te}function isSingleListItem(Te){if(!Te.length)return!1;const we=Te[0].getAttribute("listItemId");return we?!Te.some(t=>t.getAttribute("listItemId")!=we):!1}function outdentFollowingItems(Te,we){const t=[];let te=Number.POSITIVE_INFINITY;for(const{node:be}of iterateSiblingListBlocks(Te.nextSibling,"forward")){const xe=be.getAttribute("listIndent");if(xe==0)break;xe<te&&(te=xe);const ve=xe-te;we.setAttribute("listIndent",ve,be),t.push(be)}return t}function sortBlocks(Te){return Array.from(Te).filter(we=>we.root.rootName!=="$graveyard").sort((we,t)=>we.index-t.index)}function getSelectedBlockObject(Te){const we=Te.document.selection.getSelectedElement();return we&&Te.schema.isObject(we)&&Te.schema.isBlock(we)?we:null}function canBecomeSimpleListItem(Te,we){return we.checkChild(Te.parent,"listItem")&&we.checkChild(Te,"$text")&&!we.isObject(Te)}function isNumberedListType(Te){return Te=="numbered"||Te=="customNumbered"}function mergeListItemIfNotLast(Te,we,t){return getListItemBlocks(we,{direction:"forward"}).pop().index>Te.index?mergeListItemBefore(Te,we,t):[]}class ListIndentCommand extends Command{constructor(t,te){super(t);Re(this,"_direction");this._direction=te}refresh(){this.isEnabled=this._checkEnabled()}execute(){const t=this.editor.model,te=getSelectedListBlocks(t.document.selection);t.change(be=>{const xe=[];isSingleListItem(te)&&!isFirstBlockOfListItem(te[0])?(this._direction=="forward"&&xe.push(...indentBlocks(te,be)),xe.push(...splitListItemBefore(te[0],be))):this._direction=="forward"?xe.push(...indentBlocks(te,be,{expand:!0})):xe.push(...outdentBlocksWithMerge(te,be));for(const ve of xe){if(!ve.hasAttribute("listType"))continue;const ke=ListWalker.first(ve,{sameIndent:!0});ke&&be.setAttribute("listType",ke.getAttribute("listType"),ve)}this._fireAfterExecute(xe)})}_fireAfterExecute(t){this.fire("afterExecute",sortBlocks(new Set(t)))}_checkEnabled(){let t=getSelectedListBlocks(this.editor.model.document.selection),te=t[0];if(!te)return!1;if(this._direction=="backward"||isSingleListItem(t)&&!isFirstBlockOfListItem(t[0]))return!0;t=expandListBlocksToCompleteItems(t),te=t[0];const be=ListWalker.first(te,{sameIndent:!0});return be?be.getAttribute("listType")==te.getAttribute("listType"):!1}}function getSelectedListBlocks(Te){const we=Array.from(Te.getSelectedBlocks()),t=we.findIndex(te=>!isListItemBlock(te));return t!=-1&&(we.length=t),we}class ListCommand extends Command{constructor(t,te,be={}){super(t);Re(this,"type");Re(this,"_listWalkerOptions");this.type=te,this._listWalkerOptions=be.multiLevel?{higherIndent:!0,lowerIndent:!0,sameAttributes:[]}:void 0}refresh(){this.value=this._getValue(),this.isEnabled=this._checkEnabled()}execute(t={}){const te=this.editor.model,be=te.document,xe=getSelectedBlockObject(te),ve=Array.from(be.selection.getSelectedBlocks()).filter(Ie=>te.schema.checkAttribute(Ie,"listType")||canBecomeSimpleListItem(Ie,te.schema)),ke=t.forceValue!==void 0?!t.forceValue:this.value;te.change(Ie=>{if(ke){const Ae=ve[ve.length-1],Se=getListItemBlocks(Ae,{direction:"forward"}),Oe=[];Se.length>1&&Oe.push(...splitListItemBefore(Se[1],Ie)),Oe.push(...removeListAttributes(ve,Ie)),Oe.push(...outdentFollowingItems(Ae,Ie)),this._fireAfterExecute(Oe)}else if((xe||be.selection.isCollapsed)&&isListItemBlock(ve[0])){const Ae=getListItems(xe||ve[0],this._listWalkerOptions);for(const Se of Ae)Ie.setAttributes({...t.additionalAttributes,listType:this.type},Se);this._fireAfterExecute(Ae)}else{const Ae=[];for(const Se of ve)if(!Se.hasAttribute("listType"))!Se.is("element","listItem")&&canBecomeSimpleListItem(Se,te.schema)&&Ie.rename(Se,"listItem"),Ie.setAttributes({...t.additionalAttributes,listIndent:0,listItemId:ListItemUid.next(),listType:this.type},Se),Ae.push(Se);else for(const Oe of expandListBlocksToCompleteItems(Se,{withNested:!1}))Oe.getAttribute("listType")!=this.type&&(Ie.setAttributes({...t.additionalAttributes,listType:this.type},Oe),Ae.push(Oe));this._fireAfterExecute(Ae)}})}_fireAfterExecute(t){this.fire("afterExecute",sortBlocks(new Set(t)))}_getValue(){const t=this.editor.model.document.selection,te=Array.from(t.getSelectedBlocks());if(!te.length)return!1;for(const be of te)if(be.getAttribute("listType")!=this.type)return!1;return!0}_checkEnabled(){const t=this.editor.model,te=t.schema,be=t.document.selection,xe=Array.from(be.getSelectedBlocks());if(!xe.length)return!1;if(this.value)return!0;for(const ve of xe)if(te.checkAttribute(ve,"listType")||canBecomeSimpleListItem(ve,te))return!0;return!1}}class ListMergeCommand extends Command{constructor(t,te){super(t);Re(this,"_direction");this._direction=te}refresh(){this.isEnabled=this._checkEnabled()}execute({shouldMergeOnBlocksContentLevel:t=!1}={}){const te=this.editor.model,be=te.document.selection,xe=[];te.change(ve=>{const{firstElement:ke,lastElement:Ie}=this._getMergeSubjectElements(be,t),Ae=ke.getAttribute("listIndent")||0,Se=Ie.getAttribute("listIndent"),Oe=Ie.getAttribute("listItemId");if(Ae!=Se){const Ve=getNestedListBlocks(Ie);xe.push(...indentBlocks([Ie,...Ve],ve,{indentBy:Ae-Se,expand:Ae<Se}))}if(t){let Ve=be;be.isCollapsed&&(Ve=ve.createSelection(ve.createRange(ve.createPositionAt(ke,"end"),ve.createPositionAt(Ie,0)))),te.deleteContent(Ve,{doNotResetEntireContent:be.isCollapsed});const Me=Ve.getLastPosition().parent,De=Me.nextSibling;xe.push(Me),De&&De!==Ie&&De.getAttribute("listItemId")==Oe&&xe.push(...mergeListItemBefore(De,Me,ve))}else xe.push(...mergeListItemBefore(Ie,ke,ve));this._fireAfterExecute(xe)})}_fireAfterExecute(t){this.fire("afterExecute",sortBlocks(new Set(t)))}_checkEnabled(){const t=this.editor.model,te=t.document.selection,be=getSelectedBlockObject(t);if(te.isCollapsed||be){const xe=be||te.getFirstPosition().parent;if(!isListItemBlock(xe))return!1;const ve=this._direction=="backward"?xe.previousSibling:xe.nextSibling;if(!ve||isSingleListItem([xe,ve]))return!1}else{const xe=te.getLastPosition(),ve=te.getFirstPosition();if(xe.parent===ve.parent||!isListItemBlock(xe.parent))return!1}return!0}_getMergeSubjectElements(t,te){const be=this.editor.model,xe=getSelectedBlockObject(be);let ve,ke;if(t.isCollapsed||xe){const Ie=xe||t.getFirstPosition().parent,Ae=isFirstBlockOfListItem(Ie);this._direction=="backward"?(ke=Ie,Ae&&!te?ve=ListWalker.first(Ie,{sameIndent:!0,lowerIndent:!0}):ve=Ie.previousSibling):(ve=Ie,ke=Ie.nextSibling)}else ve=t.getFirstPosition().parent,ke=t.getLastPosition().parent;return{firstElement:ve,lastElement:ke}}}class ListSplitCommand extends Command{constructor(t,te){super(t);Re(this,"_direction");this._direction=te}refresh(){this.isEnabled=this._checkEnabled()}execute(){this.editor.model.change(te=>{const be=splitListItemBefore(this._getStartBlock(),te);this._fireAfterExecute(be)})}_fireAfterExecute(t){this.fire("afterExecute",sortBlocks(new Set(t)))}_checkEnabled(){const t=this.editor.model.document.selection,te=this._getStartBlock();return t.isCollapsed&&isListItemBlock(te)&&!isFirstBlockOfListItem(te)}_getStartBlock(){const te=this.editor.model.document.selection.getFirstPosition().parent;return this._direction=="before"?te:te.nextSibling}}class ListUtils extends Plugin{static get pluginName(){return"ListUtils"}expandListBlocksToCompleteList(we){return expandListBlocksToCompleteList(we)}isFirstBlockOfListItem(we){return isFirstBlockOfListItem(we)}isListItemBlock(we){return isListItemBlock(we)}expandListBlocksToCompleteItems(we,t={}){return expandListBlocksToCompleteItems(we,t)}isNumberedListType(we){return isNumberedListType(we)}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function isListView(Te){return Te.is("element","ol")||Te.is("element","ul")}function isListItemView(Te){return Te.is("element","li")}function getIndent$1(Te){let we=0,t=Te.parent;for(;t;){if(isListItemView(t))we++;else{const te=t.previousSibling;te&&isListItemView(te)&&we++}t=t.parent}return we}function createListElement(Te,we,t,te=getViewElementIdForListType(t,we)){return Te.createAttributeElement(getViewElementNameForListType(t),null,{priority:2*we/100-100,id:te})}function createListItemElement(Te,we,t){return Te.createAttributeElement("li",null,{priority:(2*we+1)/100-100,id:t})}function getViewElementNameForListType(Te){return Te=="numbered"||Te=="customNumbered"?"ol":"ul"}function getViewElementIdForListType(Te,we){return`list-${Te}-${we}`}function findAndAddListHeadToMap(Te,we){const t=Te.nodeBefore;if(isListItemBlock(t)){let te=t;for(const{node:be}of iterateSiblingListBlocks(te,"backward"))if(te=be,we.has(te))return;we.set(t,te)}else{const te=Te.nodeAfter;isListItemBlock(te)&&we.set(te,te)}}function fixListIndents(Te,we){let t=0,te=-1,be=null,xe=!1;for(const{node:ve}of Te){const ke=ve.getAttribute("listIndent");if(ke>t){let Ie;be===null?(be=ke-t,Ie=t):(be>ke&&(be=ke),Ie=ke-be),Ie>te+1&&(Ie=te+1),we.setAttribute("listIndent",Ie,ve),xe=!0,te=Ie}else be=null,t=ke+1,te=ke}return xe}function fixListItemIds(Te,we,t){const te=new Set;let be=!1;for(const{node:xe}of Te){if(te.has(xe))continue;let ve=xe.getAttribute("listType"),ke=xe.getAttribute("listItemId");if(we.has(ke)&&(ke=ListItemUid.next()),we.add(ke),xe.is("element","listItem")){xe.getAttribute("listItemId")!=ke&&(t.setAttribute("listItemId",ke,xe),be=!0);continue}for(const Ie of getListItemBlocks(xe,{direction:"forward"}))te.add(Ie),Ie.getAttribute("listType")!=ve&&(ke=ListItemUid.next(),ve=Ie.getAttribute("listType")),Ie.getAttribute("listItemId")!=ke&&(t.setAttribute("listItemId",ke,Ie),be=!0)}return be}function listItemUpcastConverter(){return(Te,we,t)=>{const{writer:te,schema:be}=t;if(!we.modelRange)return;const xe=Array.from(we.modelRange.getItems({shallow:!0})).filter(Oe=>be.checkAttribute(Oe,"listItemId"));if(!xe.length)return;const ve=ListItemUid.next(),ke=getIndent$1(we.viewItem);let Ie=we.viewItem.parent&&we.viewItem.parent.is("element","ol")?"numbered":"bulleted";const Ae=xe[0].getAttribute("listType");Ae&&(Ie=Ae);const Se={listItemId:ve,listIndent:ke,listType:Ie};for(const Oe of xe)Oe.hasAttribute("listItemId")||te.setAttributes(Se,Oe);xe.length>1&&xe[1].getAttribute("listItemId")!=Se.listItemId&&t.keepEmptyElement(xe[0])}}function listUpcastCleanList(){return(Te,we,t)=>{if(!t.consumable.test(we.viewItem,{name:!0}))return;const te=new UpcastWriter(we.viewItem.document);for(const be of Array.from(we.viewItem.getChildren()))!isListItemView(be)&&!isListView(be)&&te.remove(be)}}function reconvertItemsOnDataChange(Te,we,t,te){return()=>{const ke=Te.document.differ.getChanges(),Ie=[],Ae=new Map,Se=new Set;for(const Oe of ke)if(Oe.type=="insert"&&Oe.name!="$text")findAndAddListHeadToMap(Oe.position,Ae),Oe.attributes.has("listItemId")?Se.add(Oe.position.nodeAfter):findAndAddListHeadToMap(Oe.position.getShiftedBy(Oe.length),Ae);else if(Oe.type=="remove"&&Oe.attributes.has("listItemId"))findAndAddListHeadToMap(Oe.position,Ae);else if(Oe.type=="attribute"){const Ve=Oe.range.start.nodeAfter;t.includes(Oe.attributeKey)?(findAndAddListHeadToMap(Oe.range.start,Ae),Oe.attributeNewValue===null?(findAndAddListHeadToMap(Oe.range.start.getShiftedBy(1),Ae),xe(Ve)&&Ie.push(Ve)):Se.add(Ve)):isListItemBlock(Ve)&&xe(Ve)&&Ie.push(Ve)}for(const Oe of Ae.values())Ie.push(...be(Oe,Se));for(const Oe of new Set(Ie))we.reconvertItem(Oe)};function be(ke,Ie){const Ae=[],Se=new Set,Oe=[];for(const{node:Ve,previous:Me}of iterateSiblingListBlocks(ke,"forward")){if(Se.has(Ve))continue;const De=Ve.getAttribute("listIndent");Me&&De<Me.getAttribute("listIndent")&&(Oe.length=De+1),Oe[De]=Object.fromEntries(Array.from(Ve.getAttributes()).filter(([Be])=>t.includes(Be)));const Fe=getListItemBlocks(Ve,{direction:"forward"});for(const Be of Fe)Se.add(Be),(xe(Be,Fe)||ve(Be,Oe,Ie))&&Ae.push(Be)}return Ae}function xe(ke,Ie){const Ae=we.mapper.toViewElement(ke);if(!Ae)return!1;if(te.fire("checkElement",{modelElement:ke,viewElement:Ae}))return!0;if(!ke.is("element","paragraph")&&!ke.is("element","listItem"))return!1;const Oe=shouldUseBogusParagraph(ke,t,Ie);return Oe&&Ae.is("element","p")?!0:!!(!Oe&&Ae.is("element","span"))}function ve(ke,Ie,Ae){if(Ae.has(ke))return!1;const Se=we.mapper.toViewElement(ke);let Oe=Ie.length-1;for(let Ve=Se.parent;!Ve.is("editableElement");Ve=Ve.parent){const Me=isListItemView(Ve),De=isListView(Ve);if(!De&&!Me)continue;const Fe=`checkAttributes:${Me?"item":"list"}`;if(te.fire(Fe,{viewElement:Ve,modelAttributes:Ie[Oe]}))break;if(De&&(Oe--,Oe<0))return!1}return!0}}function listItemDowncastConverter(Te,we,t,{dataPipeline:te}={}){const be=createAttributesConsumer(Te);return(xe,ve,ke)=>{const{writer:Ie,mapper:Ae,consumable:Se}=ke,Oe=ve.item;if(!Te.includes(ve.attributeKey)||!be(Oe,Se))return;const Ve=findMappedViewElement(Oe,Ae,t);removeCustomMarkerElements(Ve,Ie,Ae),unwrapListItemBlock(Ve,Ie);const Me=insertCustomMarkerElements(Oe,Ve,we,Ie,{dataPipeline:te});wrapListItemBlock(Oe,Me,we,Ie)}}function listItemDowncastRemoveConverter(Te){return(we,t,te)=>{const{writer:be,mapper:xe}=te,ve=we.name.split(":")[1];if(!Te.checkAttribute(ve,"listItemId"))return;const ke=xe.toViewPosition(t.position),Ie=t.position.getShiftedBy(t.length),Ae=xe.toViewPosition(Ie,{isPhantom:!0}),Oe=be.createRange(ke,Ae).getTrimmed().end.nodeBefore;/* istanbul ignore next -- @preserve */Oe&&removeCustomMarkerElements(Oe,be,xe)}}function bogusParagraphCreator(Te,{dataPipeline:we}={}){return(t,{writer:te})=>{if(!shouldUseBogusParagraph(t,Te))return null;if(!we)return te.createContainerElement("span",{class:"ck-list-bogus-paragraph"});const be=te.createContainerElement("p");return te.setCustomProperty("dataPipeline:transparentRendering",!0,be),be}}function findMappedViewElement(Te,we,t){const te=t.createRangeOn(Te);return we.toViewRange(te).getTrimmed().end.nodeBefore}function createModelToViewPositionMapper(Te,we){return(t,te)=>{if(te.modelPosition.offset>0)return;const be=te.modelPosition.parent;if(!isListItemBlock(be)||!Te.some(Ae=>Ae.scope=="itemMarker"&&Ae.canInjectMarkerIntoElement&&Ae.canInjectMarkerIntoElement(be)))return;const xe=te.mapper.toViewElement(be),ve=we.createRangeIn(xe),ke=ve.getWalker();let Ie=ve.start;for(const{item:Ae}of ke){if(Ae.is("element")&&te.mapper.toModelElement(Ae)||Ae.is("$textProxy"))break;Ae.is("element")&&Ae.getCustomProperty("listItemMarker")&&(Ie=we.createPositionAfter(Ae),ke.skip(({previousPosition:Se})=>!Se.isEqual(Ie)))}te.viewPosition=Ie}}function removeCustomMarkerElements(Te,we,t){for(;Te.parent.is("attributeElement")&&Te.parent.getCustomProperty("listItemWrapper");)we.unwrap(we.createRangeOn(Te),Te.parent);const te=[];be(we.createPositionBefore(Te).getWalker({direction:"backward"})),be(we.createRangeIn(Te).getWalker());for(const xe of te)we.remove(xe);function be(xe){for(const{item:ve}of xe){if(ve.is("element")&&t.toModelElement(ve))break;ve.is("element")&&ve.getCustomProperty("listItemMarker")&&te.push(ve)}}}function insertCustomMarkerElements(Te,we,t,te,{dataPipeline:be}){let xe=te.createRangeOn(we);if(!isFirstBlockOfListItem(Te))return xe;for(const ve of t){if(ve.scope!="itemMarker")continue;const ke=ve.createElement(te,Te,{dataPipeline:be});if(!ke||(te.setCustomProperty("listItemMarker",!0,ke),ve.canInjectMarkerIntoElement&&ve.canInjectMarkerIntoElement(Te)?te.insert(te.createPositionAt(we,0),ke):(te.insert(xe.start,ke),xe=te.createRange(te.createPositionBefore(ke),te.createPositionAfter(we))),!ve.createWrapperElement||!ve.canWrapElement))continue;const Ie=ve.createWrapperElement(te,Te,{dataPipeline:be});te.setCustomProperty("listItemWrapper",!0,Ie),ve.canWrapElement(Te)?xe=te.wrap(xe,Ie):(xe=te.wrap(te.createRangeOn(ke),Ie),xe=te.createRange(xe.start,te.createPositionAfter(we)))}return xe}function unwrapListItemBlock(Te,we){let t=Te.parent;for(;t.is("attributeElement")&&["ul","ol","li"].includes(t.name);){const te=t.parent;we.unwrap(we.createRangeOn(Te),t),t=te}}function wrapListItemBlock(Te,we,t,te){if(!Te.hasAttribute("listIndent"))return;const be=Te.getAttribute("listIndent");let xe=Te;for(let ve=be;ve>=0;ve--){const ke=createListItemElement(te,ve,xe.getAttribute("listItemId")),Ie=createListElement(te,ve,xe.getAttribute("listType"));for(const Ae of t)(Ae.scope=="list"||Ae.scope=="item")&&xe.hasAttribute(Ae.attributeName)&&Ae.setAttributeOnDowncast(te,xe.getAttribute(Ae.attributeName),Ae.scope=="list"?Ie:ke);if(we=te.wrap(we,ke),we=te.wrap(we,Ie),ve==0||(xe=ListWalker.first(xe,{lowerIndent:!0}),!xe))break}}function createAttributesConsumer(Te){return(we,t)=>{const te=[];for(const be of Te)we.hasAttribute(be)&&te.push(`attribute:${be}`);return te.every(be=>t.test(we,be)!==!1)?(te.forEach(be=>t.consume(we,be)),!0):!1}}function shouldUseBogusParagraph(Te,we,t=getAllListItemBlocks(Te)){if(!isListItemBlock(Te))return!1;for(const te of Te.getAttributeKeys())if(!te.startsWith("selection:")&&!we.includes(te))return!1;return t.length<2}const LIST_BASE_ATTRIBUTES=["listType","listIndent","listItemId"];class ListEditing extends Plugin{constructor(t){super(t);Re(this,"_downcastStrategies",[]);t.config.define("list.multiBlock",!0)}static get pluginName(){return"ListEditing"}static get requires(){return[Enter,Delete,ListUtils,ClipboardPipeline]}init(){const t=this.editor,te=t.model,be=t.config.get("list.multiBlock");if(t.plugins.has("LegacyListEditing"))throw new CKEditorError("list-feature-conflict",this,{conflictPlugin:"LegacyListEditing"});te.schema.register("$listItem",{allowAttributes:LIST_BASE_ATTRIBUTES}),be?(te.schema.extend("$container",{allowAttributesOf:"$listItem"}),te.schema.extend("$block",{allowAttributesOf:"$listItem"}),te.schema.extend("$blockObject",{allowAttributesOf:"$listItem"})):te.schema.register("listItem",{inheritAllFrom:"$block",allowAttributesOf:"$listItem"});for(const xe of LIST_BASE_ATTRIBUTES)te.schema.setAttributeProperties(xe,{copyOnReplace:!0});t.commands.add("numberedList",new ListCommand(t,"numbered")),t.commands.add("bulletedList",new ListCommand(t,"bulleted")),t.commands.add("customNumberedList",new ListCommand(t,"customNumbered",{multiLevel:!0})),t.commands.add("customBulletedList",new ListCommand(t,"customBulleted",{multiLevel:!0})),t.commands.add("indentList",new ListIndentCommand(t,"forward")),t.commands.add("outdentList",new ListIndentCommand(t,"backward")),t.commands.add("splitListItemBefore",new ListSplitCommand(t,"before")),t.commands.add("splitListItemAfter",new ListSplitCommand(t,"after")),be&&(t.commands.add("mergeListItemBackward",new ListMergeCommand(t,"backward")),t.commands.add("mergeListItemForward",new ListMergeCommand(t,"forward"))),this._setupDeleteIntegration(),this._setupEnterIntegration(),this._setupTabIntegration(),this._setupClipboardIntegration(),this._setupAccessibilityIntegration()}afterInit(){const te=this.editor.commands,be=te.get("indent"),xe=te.get("outdent");be&&be.registerChildCommand(te.get("indentList"),{priority:"high"}),xe&&xe.registerChildCommand(te.get("outdentList"),{priority:"lowest"}),this._setupModelPostFixing(),this._setupConversion()}registerDowncastStrategy(t){this._downcastStrategies.push(t)}getListAttributeNames(){return[...LIST_BASE_ATTRIBUTES,...this._downcastStrategies.map(t=>t.attributeName)]}_setupDeleteIntegration(){const t=this.editor,te=t.commands.get("mergeListItemBackward"),be=t.commands.get("mergeListItemForward");this.listenTo(t.editing.view.document,"delete",(xe,ve)=>{const ke=t.model.document.selection;getSelectedBlockObject(t.model)||t.model.change(()=>{const Ie=ke.getFirstPosition();if(ke.isCollapsed&&ve.direction=="backward"){if(!Ie.isAtStart)return;const Ae=Ie.parent;if(!isListItemBlock(Ae))return;if(!ListWalker.first(Ae,{sameAttributes:"listType",sameIndent:!0})&&Ae.getAttribute("listIndent")===0)isLastBlockOfListItem(Ae)||t.execute("splitListItemAfter"),t.execute("outdentList");else{if(!te||!te.isEnabled)return;te.execute({shouldMergeOnBlocksContentLevel:shouldMergeOnBlocksContentLevel(t.model,"backward")})}ve.preventDefault(),xe.stop()}else{if(ke.isCollapsed&&!ke.getLastPosition().isAtEnd||!be||!be.isEnabled)return;be.execute({shouldMergeOnBlocksContentLevel:shouldMergeOnBlocksContentLevel(t.model,"forward")}),ve.preventDefault(),xe.stop()}})},{context:"li"})}_setupEnterIntegration(){const t=this.editor,te=t.model,be=t.commands,xe=be.get("enter");this.listenTo(t.editing.view.document,"enter",(ve,ke)=>{const Ie=te.document,Ae=Ie.selection.getFirstPosition().parent;if(Ie.selection.isCollapsed&&isListItemBlock(Ae)&&Ae.isEmpty&&!ke.isSoft){const Se=isFirstBlockOfListItem(Ae),Oe=isLastBlockOfListItem(Ae);Se&&Oe?(t.execute("outdentList"),ke.preventDefault(),ve.stop()):Se&&!Oe?(t.execute("splitListItemAfter"),ke.preventDefault(),ve.stop()):Oe&&(t.execute("splitListItemBefore"),ke.preventDefault(),ve.stop())}},{context:"li"}),this.listenTo(xe,"afterExecute",()=>{const ve=be.get("splitListItemBefore");if(ve.refresh(),!ve.isEnabled)return;const Ie=t.model.document.selection.getLastPosition().parent;getAllListItemBlocks(Ie).length===2&&ve.execute()})}_setupTabIntegration(){const t=this.editor;this.listenTo(t.editing.view.document,"tab",(te,be)=>{const xe=be.shiftKey?"outdentList":"indentList";this.editor.commands.get(xe).isEnabled&&(t.execute(xe),be.stopPropagation(),be.preventDefault(),te.stop())},{context:"li"})}_setupConversion(){const t=this.editor,te=t.model,be=this.getListAttributeNames(),xe=t.config.get("list.multiBlock"),ve=xe?"paragraph":"listItem";t.conversion.for("upcast").elementToElement({view:"li",model:(Ie,{writer:Ae})=>Ae.createElement(ve,{listType:""})}).elementToElement({view:"p",model:(Ie,{writer:Ae})=>Ie.parent&&Ie.parent.is("element","li")?Ae.createElement(ve,{listType:""}):null,converterPriority:"high"}).add(Ie=>{Ie.on("element:li",listItemUpcastConverter()),Ie.on("element:ul",listUpcastCleanList(),{priority:"high"}),Ie.on("element:ol",listUpcastCleanList(),{priority:"high"})}),xe||t.conversion.for("downcast").elementToElement({model:"listItem",view:"p"}),t.conversion.for("editingDowncast").elementToElement({model:ve,view:bogusParagraphCreator(be),converterPriority:"high"}).add(Ie=>{Ie.on("attribute",listItemDowncastConverter(be,this._downcastStrategies,te)),Ie.on("remove",listItemDowncastRemoveConverter(te.schema))}),t.conversion.for("dataDowncast").elementToElement({model:ve,view:bogusParagraphCreator(be,{dataPipeline:!0}),converterPriority:"high"}).add(Ie=>{Ie.on("attribute",listItemDowncastConverter(be,this._downcastStrategies,te,{dataPipeline:!0}))});const ke=createModelToViewPositionMapper(this._downcastStrategies,t.editing.view);t.editing.mapper.on("modelToViewPosition",ke),t.data.mapper.on("modelToViewPosition",ke),this.listenTo(te.document,"change:data",reconvertItemsOnDataChange(te,t.editing,be,this),{priority:"high"}),this.on("checkAttributes:item",(Ie,{viewElement:Ae,modelAttributes:Se})=>{Ae.id!=Se.listItemId&&(Ie.return=!0,Ie.stop())}),this.on("checkAttributes:list",(Ie,{viewElement:Ae,modelAttributes:Se})=>{(Ae.name!=getViewElementNameForListType(Se.listType)||Ae.id!=getViewElementIdForListType(Se.listType,Se.listIndent))&&(Ie.return=!0,Ie.stop())})}_setupModelPostFixing(){const t=this.editor.model,te=this.getListAttributeNames();t.document.registerPostFixer(be=>modelChangePostFixer$1(t,be,te,this)),this.on("postFixer",(be,{listNodes:xe,writer:ve})=>{be.return=fixListIndents(xe,ve)||be.return},{priority:"high"}),this.on("postFixer",(be,{listNodes:xe,writer:ve,seenIds:ke})=>{be.return=fixListItemIds(xe,ke,ve)||be.return},{priority:"high"})}_setupClipboardIntegration(){const t=this.editor.model,te=this.editor.plugins.get("ClipboardPipeline");this.listenTo(t,"insertContent",createModelIndentPasteFixer(t),{priority:"high"}),this.listenTo(te,"outputTransformation",(be,xe)=>{t.change(ve=>{const ke=Array.from(xe.content.getChildren()),Ie=ke[ke.length-1];if(ke.length>1&&Ie.is("element")&&Ie.isEmpty&&ke.slice(0,-1).every(isListItemBlock)&&ve.remove(Ie),xe.method=="copy"||xe.method=="cut"){const Ae=Array.from(xe.content.getChildren());isSingleListItem(Ae)&&removeListAttributes(Ae,ve)}})})}_setupAccessibilityIntegration(){const t=this.editor,te=t.t;t.accessibility.addKeystrokeInfoGroup({id:"list",label:te("Keystrokes that can be used in a list"),keystrokes:[{label:te("Increase list item indent"),keystroke:"Tab"},{label:te("Decrease list item indent"),keystroke:"Shift+Tab"}]})}}function modelChangePostFixer$1(Te,we,t,te){const be=Te.document.differ.getChanges(),xe=new Map,ve=te.editor.config.get("list.multiBlock");let ke=!1;for(const Ae of be){if(Ae.type=="insert"&&Ae.name!="$text"){const Se=Ae.position.nodeAfter;if(!Te.schema.checkAttribute(Se,"listItemId"))for(const Oe of Array.from(Se.getAttributeKeys()))t.includes(Oe)&&(we.removeAttribute(Oe,Se),ke=!0);findAndAddListHeadToMap(Ae.position,xe),Ae.attributes.has("listItemId")||findAndAddListHeadToMap(Ae.position.getShiftedBy(Ae.length),xe);for(const{item:Oe,previousPosition:Ve}of Te.createRangeIn(Se))isListItemBlock(Oe)&&findAndAddListHeadToMap(Ve,xe)}else Ae.type=="remove"?findAndAddListHeadToMap(Ae.position,xe):Ae.type=="attribute"&&t.includes(Ae.attributeKey)&&(findAndAddListHeadToMap(Ae.range.start,xe),Ae.attributeNewValue===null&&findAndAddListHeadToMap(Ae.range.start.getShiftedBy(1),xe));if(!ve&&Ae.type=="attribute"&&LIST_BASE_ATTRIBUTES.includes(Ae.attributeKey)){const Se=Ae.range.start.nodeAfter;Ae.attributeNewValue===null&&Se&&Se.is("element","listItem")?(we.rename(Se,"paragraph"),ke=!0):Ae.attributeOldValue===null&&Se&&Se.is("element")&&Se.name!="listItem"&&(we.rename(Se,"listItem"),ke=!0)}}const Ie=new Set;for(const Ae of xe.values())ke=te.fire("postFixer",{listNodes:new ListBlocksIterable(Ae),listHead:Ae,writer:we,seenIds:Ie})||ke;return ke}function createModelIndentPasteFixer(Te){return(we,[t,te])=>{const be=t.is("documentFragment")?Array.from(t.getChildren()):[t];if(!be.length)return;const ve=(te?Te.createSelection(te):Te.document.selection).getFirstPosition();let ke;if(isListItemBlock(ve.parent))ke=ve.parent;else if(isListItemBlock(ve.nodeBefore))ke=ve.nodeBefore;else return;Te.change(Ie=>{const Ae=ke.getAttribute("listType"),Se=ke.getAttribute("listIndent"),Oe=be[0].getAttribute("listIndent")||0,Ve=Math.max(Se-Oe,0);for(const Me of be){const De=isListItemBlock(Me);ke.is("element","listItem")&&Me.is("element","paragraph")&&Ie.rename(Me,"listItem"),Ie.setAttributes({listIndent:(De?Me.getAttribute("listIndent"):0)+Ve,listItemId:De?Me.getAttribute("listItemId"):ListItemUid.next(),listType:Ae},Me)}})}}function shouldMergeOnBlocksContentLevel(Te,we){const t=Te.document.selection;if(!t.isCollapsed)return!getSelectedBlockObject(Te);if(we==="forward")return!0;const be=t.getFirstPosition().parent,xe=be.previousSibling;return Te.schema.isObject(xe)?!1:xe.isEmpty?!0:isSingleListItem([be,xe])}function createUIComponents(Te,we,t,te){Te.ui.componentFactory.add(we,()=>{const be=_createButton(ButtonView,Te,we,t,te);return be.set({tooltip:!0,isToggleable:!0}),be}),Te.ui.componentFactory.add(`menuBar:${we}`,()=>_createButton(MenuBarMenuListItemButtonView,Te,we,t,te))}function _createButton(Te,we,t,te,be){const xe=we.commands.get(t),ve=new Te(we.locale);return ve.set({label:te,icon:be}),ve.bind("isOn","isEnabled").to(xe,"value","isEnabled"),ve.on("execute",()=>{we.execute(t),we.editing.view.focus()}),ve}class ListUI extends Plugin{static get pluginName(){return"ListUI"}init(){const we=this.editor.t;this.editor.ui.componentFactory.has("numberedList")||createUIComponents(this.editor,"numberedList",we("Numbered List"),icons.numberedList),this.editor.ui.componentFactory.has("bulletedList")||createUIComponents(this.editor,"bulletedList",we("Bulleted List"),icons.bulletedList)}}class List extends Plugin{static get requires(){return[ListEditing,ListUI]}static get pluginName(){return"List"}}class ListStartCommand extends Command{refresh(){const we=this._getValue();this.value=we,this.isEnabled=we!=null}execute({startIndex:we=1}={}){const t=this.editor.model,te=t.document;let be=Array.from(te.selection.getSelectedBlocks()).filter(xe=>isListItemBlock(xe)&&isNumberedListType(xe.getAttribute("listType")));be=expandListBlocksToCompleteList(be),t.change(xe=>{for(const ve of be)xe.setAttribute("listStart",we>=0?we:1,ve)})}_getValue(){const t=this.editor.model.document,te=first(t.selection.getSelectedBlocks());return te&&isListItemBlock(te)&&isNumberedListType(te.getAttribute("listType"))?te.getAttribute("listStart"):null}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const LIST_STYLE_TO_LIST_TYPE={},LIST_STYLE_TO_TYPE_ATTRIBUTE={},TYPE_ATTRIBUTE_TO_LIST_STYLE={},LIST_STYLE_TYPES=[{listStyle:"disc",typeAttribute:"disc",listType:"bulleted"},{listStyle:"circle",typeAttribute:"circle",listType:"bulleted"},{listStyle:"square",typeAttribute:"square",listType:"bulleted"},{listStyle:"decimal",typeAttribute:"1",listType:"numbered"},{listStyle:"decimal-leading-zero",typeAttribute:null,listType:"numbered"},{listStyle:"lower-roman",typeAttribute:"i",listType:"numbered"},{listStyle:"upper-roman",typeAttribute:"I",listType:"numbered"},{listStyle:"lower-alpha",typeAttribute:"a",listType:"numbered"},{listStyle:"upper-alpha",typeAttribute:"A",listType:"numbered"},{listStyle:"lower-latin",typeAttribute:"a",listType:"numbered"},{listStyle:"upper-latin",typeAttribute:"A",listType:"numbered"}];for(const{listStyle:Te,typeAttribute:we,listType:t}of LIST_STYLE_TYPES)LIST_STYLE_TO_LIST_TYPE[Te]=t,LIST_STYLE_TO_TYPE_ATTRIBUTE[Te]=we,we&&(TYPE_ATTRIBUTE_TO_LIST_STYLE[we]=Te);function getAllSupportedStyleTypes(){return LIST_STYLE_TYPES.map(Te=>Te.listStyle)}function getListTypeFromListStyleType$1(Te){return LIST_STYLE_TO_LIST_TYPE[Te]||null}function getListStyleTypeFromTypeAttribute(Te){return TYPE_ATTRIBUTE_TO_LIST_STYLE[Te]||null}function getTypeAttributeFromListStyleType(Te){return LIST_STYLE_TO_TYPE_ATTRIBUTE[Te]||null}class ListStyleCommand extends Command{constructor(t,te,be){super(t);Re(this,"defaultType");Re(this,"_supportedTypes");this.defaultType=te,this._supportedTypes=be}refresh(){this.value=this._getValue(),this.isEnabled=this._checkEnabled()}execute(t={}){const te=this.editor.model,be=te.document;te.change(xe=>{this._tryToConvertItemsToList(t);let ve=Array.from(be.selection.getSelectedBlocks()).filter(ke=>ke.hasAttribute("listType"));if(ve.length){ve=expandListBlocksToCompleteList(ve);for(const ke of ve)xe.setAttribute("listStyle",t.type||this.defaultType,ke)}})}isStyleTypeSupported(t){return this._supportedTypes?this._supportedTypes.includes(t):!0}_getValue(){const t=first(this.editor.model.document.selection.getSelectedBlocks());return isListItemBlock(t)?t.getAttribute("listStyle"):null}_checkEnabled(){const t=this.editor,te=t.commands.get("numberedList"),be=t.commands.get("bulletedList");return te.isEnabled||be.isEnabled}_tryToConvertItemsToList(t){if(!t.type)return;const te=getListTypeFromListStyleType$1(t.type);if(!te)return;const be=this.editor,xe=`${te}List`;be.commands.get(xe).value||be.execute(xe)}}class ListReversedCommand extends Command{refresh(){const we=this._getValue();this.value=we,this.isEnabled=we!=null}execute(we={}){const t=this.editor.model,te=t.document;let be=Array.from(te.selection.getSelectedBlocks()).filter(xe=>isListItemBlock(xe)&&xe.getAttribute("listType")=="numbered");be=expandListBlocksToCompleteList(be),t.change(xe=>{for(const ve of be)xe.setAttribute("listReversed",!!we.reversed,ve)})}_getValue(){const t=this.editor.model.document,te=first(t.selection.getSelectedBlocks());return isListItemBlock(te)&&te.getAttribute("listType")=="numbered"?te.getAttribute("listReversed"):null}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function listPropertiesUpcastConverter(Te){return(we,t,te)=>{const{writer:be,schema:xe,consumable:ve}=te;if(ve.test(t.viewItem,Te.viewConsumables)===!1)return;t.modelRange||Object.assign(t,te.convertChildren(t.viewItem,t.modelCursor));let ke=!1;for(const Ie of t.modelRange.getItems({shallow:!0}))xe.checkAttribute(Ie,Te.attributeName)&&Te.appliesToListItem(Ie)&&(Ie.hasAttribute(Te.attributeName)||(be.setAttribute(Te.attributeName,Te.getAttributeOnUpcast(t.viewItem),Ie),ke=!0));ke&&ve.consume(t.viewItem,Te.viewConsumables)}}class ListPropertiesUtils extends Plugin{static get pluginName(){return"ListPropertiesUtils"}getAllSupportedStyleTypes(){return getAllSupportedStyleTypes()}getListTypeFromListStyleType(we){return getListTypeFromListStyleType$1(we)}getListStyleTypeFromTypeAttribute(we){return getListStyleTypeFromTypeAttribute(we)}getTypeAttributeFromListStyleType(we){return getTypeAttributeFromListStyleType(we)}}const DEFAULT_LIST_TYPE$1="default";class ListPropertiesEditing extends Plugin{static get requires(){return[ListEditing,ListPropertiesUtils]}static get pluginName(){return"ListPropertiesEditing"}constructor(we){super(we),we.config.define("list.properties",{styles:!0,startIndex:!1,reversed:!1})}init(){const we=this.editor,t=we.model,te=we.plugins.get(ListEditing),be=we.config.get("list.properties"),xe=createAttributeStrategies$1(be);for(const ve of xe)ve.addCommand(we),t.schema.extend("$listItem",{allowAttributes:ve.attributeName}),te.registerDowncastStrategy({scope:"list",attributeName:ve.attributeName,setAttributeOnDowncast(ke,Ie,Ae){ve.setAttributeOnDowncast(ke,Ie,Ae)}});we.conversion.for("upcast").add(ve=>{for(const ke of xe)ve.on("element:ol",listPropertiesUpcastConverter(ke)),ve.on("element:ul",listPropertiesUpcastConverter(ke))}),te.on("checkAttributes:list",(ve,{viewElement:ke,modelAttributes:Ie})=>{for(const Ae of xe)Ae.getAttributeOnUpcast(ke)!=Ie[Ae.attributeName]&&(ve.return=!0,ve.stop())}),this.listenTo(we.commands.get("indentList"),"afterExecute",(ve,ke)=>{t.change(Ie=>{for(const Ae of ke)for(const Se of xe)Se.appliesToListItem(Ae)&&Ie.setAttribute(Se.attributeName,Se.defaultValue,Ae)})}),te.on("postFixer",(ve,{listNodes:ke,writer:Ie})=>{for(const{node:Ae}of ke)for(const Se of xe)Se.hasValidAttribute(Ae)||(Se.appliesToListItem(Ae)?Ie.setAttribute(Se.attributeName,Se.defaultValue,Ae):Ie.removeAttribute(Se.attributeName,Ae),ve.return=!0)}),te.on("postFixer",(ve,{listNodes:ke,writer:Ie})=>{for(const{node:Ae,previousNodeInList:Se}of ke)if(Se&&Se.getAttribute("listType")==Ae.getAttribute("listType"))for(const Oe of xe){const{attributeName:Ve}=Oe;if(!Oe.appliesToListItem(Ae))continue;const Me=Se.getAttribute(Ve);Ae.getAttribute(Ve)!=Me&&(Ie.setAttribute(Ve,Me,Ae),ve.return=!0)}})}}function createAttributeStrategies$1(Te){const we=[];if(Te.styles){const t=typeof Te.styles=="object"&&Te.styles.useAttribute;we.push({attributeName:"listStyle",defaultValue:DEFAULT_LIST_TYPE$1,viewConsumables:{styles:"list-style-type"},addCommand(te){let be=getAllSupportedStyleTypes();t&&(be=be.filter(xe=>!!getTypeAttributeFromListStyleType(xe))),te.commands.add("listStyle",new ListStyleCommand(te,DEFAULT_LIST_TYPE$1,be))},appliesToListItem(te){return te.getAttribute("listType")=="numbered"||te.getAttribute("listType")=="bulleted"},hasValidAttribute(te){if(!this.appliesToListItem(te))return!te.hasAttribute("listStyle");if(!te.hasAttribute("listStyle"))return!1;const be=te.getAttribute("listStyle");return be==DEFAULT_LIST_TYPE$1?!0:getListTypeFromListStyleType$1(be)==te.getAttribute("listType")},setAttributeOnDowncast(te,be,xe){if(be&&be!==DEFAULT_LIST_TYPE$1)if(t){const ve=getTypeAttributeFromListStyleType(be);if(ve){te.setAttribute("type",ve,xe);return}}else{te.setStyle("list-style-type",be,xe);return}te.removeStyle("list-style-type",xe),te.removeAttribute("type",xe)},getAttributeOnUpcast(te){const be=te.getStyle("list-style-type");if(be)return be;const xe=te.getAttribute("type");return xe?getListStyleTypeFromTypeAttribute(xe):DEFAULT_LIST_TYPE$1}})}return Te.reversed&&we.push({attributeName:"listReversed",defaultValue:!1,viewConsumables:{attributes:"reversed"},addCommand(t){t.commands.add("listReversed",new ListReversedCommand(t))},appliesToListItem(t){return t.getAttribute("listType")=="numbered"},hasValidAttribute(t){return this.appliesToListItem(t)==t.hasAttribute("listReversed")},setAttributeOnDowncast(t,te,be){te?t.setAttribute("reversed","reversed",be):t.removeAttribute("reversed",be)},getAttributeOnUpcast(t){return t.hasAttribute("reversed")}}),Te.startIndex&&we.push({attributeName:"listStart",defaultValue:1,viewConsumables:{attributes:"start"},addCommand(t){t.commands.add("listStart",new ListStartCommand(t))},appliesToListItem(t){return isNumberedListType(t.getAttribute("listType"))},hasValidAttribute(t){return this.appliesToListItem(t)==t.hasAttribute("listStart")},setAttributeOnDowncast(t,te,be){te==0||te>1?t.setAttribute("start",te,be):t.removeAttribute("start",be)},getAttributeOnUpcast(t){const te=t.getAttribute("start");return te>=0?te:1}}),we}class ListPropertiesView extends View{constructor(t,{enabledProperties:te,styleButtonViews:be,styleGridAriaLabel:xe}){super(t);Re(this,"children");Re(this,"stylesView",null);Re(this,"additionalPropertiesCollapsibleView",null);Re(this,"startIndexFieldView",null);Re(this,"reversedSwitchButtonView",null);Re(this,"focusTracker",new FocusTracker);Re(this,"keystrokes",new KeystrokeHandler);Re(this,"focusables",new ViewCollection);Re(this,"focusCycler");const ve=["ck","ck-list-properties"];this.children=this.createCollection(),this.focusCycler=new FocusCycler({focusables:this.focusables,focusTracker:this.focusTracker,keystrokeHandler:this.keystrokes,actions:{focusPrevious:"shift + tab",focusNext:"tab"}}),te.styles?(this.stylesView=this._createStylesView(be,xe),this.children.add(this.stylesView)):ve.push("ck-list-properties_without-styles"),(te.startIndex||te.reversed)&&(this._addNumberedListPropertyViews(te),ve.push("ck-list-properties_with-numbered-properties")),this.setTemplate({tag:"div",attributes:{class:ve},children:this.children})}render(){if(super.render(),this.stylesView){this.focusables.add(this.stylesView),this.focusTracker.add(this.stylesView.element),(this.startIndexFieldView||this.reversedSwitchButtonView)&&(this.focusables.add(this.children.last.buttonView),this.focusTracker.add(this.children.last.buttonView.element));for(const t of this.stylesView.children)this.stylesView.focusTracker.add(t.element);addKeyboardHandlingForGrid({keystrokeHandler:this.stylesView.keystrokes,focusTracker:this.stylesView.focusTracker,gridItems:this.stylesView.children,numberOfColumns:()=>global.window.getComputedStyle(this.stylesView.element).getPropertyValue("grid-template-columns").split(" ").length,uiLanguageDirection:this.locale&&this.locale.uiLanguageDirection})}if(this.startIndexFieldView){this.focusables.add(this.startIndexFieldView),this.focusTracker.add(this.startIndexFieldView.element);const t=te=>te.stopPropagation();this.keystrokes.set("arrowright",t),this.keystrokes.set("arrowleft",t),this.keystrokes.set("arrowup",t),this.keystrokes.set("arrowdown",t)}this.reversedSwitchButtonView&&(this.focusables.add(this.reversedSwitchButtonView),this.focusTracker.add(this.reversedSwitchButtonView.element)),this.keystrokes.listenTo(this.element)}focus(){this.focusCycler.focusFirst()}focusLast(){this.focusCycler.focusLast()}destroy(){super.destroy(),this.focusTracker.destroy(),this.keystrokes.destroy()}_createStylesView(t,te){const be=new View(this.locale);return be.children=be.createCollection(),be.children.addMany(t),be.setTemplate({tag:"div",attributes:{"aria-label":te,class:["ck","ck-list-styles-list"]},children:be.children}),be.children.delegate("execute").to(this),be.focus=function(){this.children.first.focus()},be.focusTracker=new FocusTracker,be.keystrokes=new KeystrokeHandler,be.render(),be.keystrokes.listenTo(be.element),be}_addNumberedListPropertyViews(t){const te=this.locale.t,be=[];t.startIndex&&(this.startIndexFieldView=this._createStartIndexField(),be.push(this.startIndexFieldView)),t.reversed&&(this.reversedSwitchButtonView=this._createReversedSwitchButton(),be.push(this.reversedSwitchButtonView)),t.styles?(this.additionalPropertiesCollapsibleView=new CollapsibleView(this.locale,be),this.additionalPropertiesCollapsibleView.set({label:te("List properties"),isCollapsed:!0}),this.additionalPropertiesCollapsibleView.buttonView.bind("isEnabled").toMany(be,"isEnabled",(...xe)=>xe.some(ve=>ve)),this.additionalPropertiesCollapsibleView.buttonView.on("change:isEnabled",(xe,ve,ke)=>{ke||(this.additionalPropertiesCollapsibleView.isCollapsed=!0)}),this.children.add(this.additionalPropertiesCollapsibleView)):this.children.addMany(be)}_createStartIndexField(){const t=this.locale.t,te=new LabeledFieldView(this.locale,createLabeledInputNumber);return te.set({label:t("Start at"),class:"ck-numbered-list-properties__start-index"}),te.fieldView.set({min:0,step:1,value:1,inputMode:"numeric"}),te.fieldView.on("input",()=>{const be=te.fieldView.element,xe=be.valueAsNumber;if(Number.isNaN(xe)){te.errorText=t("Invalid start index value.");return}be.checkValidity()?this.fire("listStart",{startIndex:xe}):te.errorText=t("Start index must be greater than 0.")}),te}_createReversedSwitchButton(){const t=this.locale.t,te=new SwitchButtonView(this.locale);return te.set({withText:!0,label:t("Reversed order"),class:"ck-numbered-list-properties__reversed-order"}),te.delegate("execute").to(this,"listReversed"),te}}var listStyleDiscIcon='<svg viewBox="0 0 44 44" xmlns="http://www.w3.org/2000/svg"><path d="M35 29a1 1 0 0 1 1 1v1a1 1 0 0 1-1 1H18a1 1 0 0 1-1-1v-1a1 1 0 0 1 1-1h17zm0-9a1 1 0 0 1 1 1v1a1 1 0 0 1-1 1H18a1 1 0 0 1-1-1v-1a1 1 0 0 1 1-1h17zm0-9a1 1 0 0 1 1 1v1a1 1 0 0 1-1 1H18a1 1 0 0 1-1-1v-1a1 1 0 0 1 1-1h17z" fill-opacity=".163"/><path d="M11 27a3 3 0 1 1 0 6 3 3 0 0 1 0-6zm0-9a3 3 0 1 1 0 6 3 3 0 0 1 0-6zm0-9a3 3 0 1 1 0 6 3 3 0 0 1 0-6z"/></svg>',listStyleCircleIcon='<svg viewBox="0 0 44 44" xmlns="http://www.w3.org/2000/svg"><path d="M35 29a1 1 0 0 1 1 1v1a1 1 0 0 1-1 1H18a1 1 0 0 1-1-1v-1a1 1 0 0 1 1-1h17zm0-9a1 1 0 0 1 1 1v1a1 1 0 0 1-1 1H18a1 1 0 0 1-1-1v-1a1 1 0 0 1 1-1h17zm0-9a1 1 0 0 1 1 1v1a1 1 0 0 1-1 1H18a1 1 0 0 1-1-1v-1a1 1 0 0 1 1-1h17z" fill-opacity=".163"/><path d="M11 27a3 3 0 1 1 0 6 3 3 0 0 1 0-6zm0 1a2 2 0 1 0 0 4 2 2 0 0 0 0-4zm0-10a3 3 0 1 1 0 6 3 3 0 0 1 0-6zm0 1a2 2 0 1 0 0 4 2 2 0 0 0 0-4zm0-10a3 3 0 1 1 0 6 3 3 0 0 1 0-6zm0 1a2 2 0 1 0 0 4 2 2 0 0 0 0-4z"/></svg>',listStyleSquareIcon='<svg viewBox="0 0 44 44" xmlns="http://www.w3.org/2000/svg"><path d="M35 29a1 1 0 0 1 1 1v1a1 1 0 0 1-1 1H18a1 1 0 0 1-1-1v-1a1 1 0 0 1 1-1h17zm0-9a1 1 0 0 1 1 1v1a1 1 0 0 1-1 1H18a1 1 0 0 1-1-1v-1a1 1 0 0 1 1-1h17zm0-9a1 1 0 0 1 1 1v1a1 1 0 0 1-1 1H18a1 1 0 0 1-1-1v-1a1 1 0 0 1 1-1h17z" fill-opacity=".163"/><path d="M14 27v6H8v-6h6zm0-9v6H8v-6h6zm0-9v6H8V9h6z"/></svg>',listStyleDecimalIcon='<svg viewBox="0 0 44 44" xmlns="http://www.w3.org/2000/svg"><path d="M35 29a1 1 0 0 1 1 1v1a1 1 0 0 1-1 1H18a1 1 0 0 1-1-1v-1a1 1 0 0 1 1-1h17zm0-9a1 1 0 0 1 1 1v1a1 1 0 0 1-1 1H18a1 1 0 0 1-1-1v-1a1 1 0 0 1 1-1h17zm0-9a1 1 0 0 1 1 1v1a1 1 0 0 1-1 1H18a1 1 0 0 1-1-1v-1a1 1 0 0 1 1-1h17z" fill-opacity=".163"/><path d="M10.29 15V8.531H9.286c-.14.393-.4.736-.778 1.03-.378.295-.728.495-1.05.6v1.121a4.257 4.257 0 0 0 1.595-.936V15h1.235zm3.343 0v-1.235h-1.235V15h1.235zM11.3 24v-1.147H8.848c.064-.111.148-.226.252-.343.104-.117.351-.354.74-.712.39-.357.66-.631.81-.821.225-.288.39-.562.494-.824.104-.263.156-.539.156-.829 0-.51-.182-.936-.545-1.279-.363-.342-.863-.514-1.499-.514-.58 0-1.063.148-1.45.444-.387.296-.617.784-.69 1.463l1.23.124c.024-.36.112-.619.264-.774.153-.155.358-.233.616-.233.26 0 .465.074.613.222.148.148.222.36.222.635 0 .25-.085.501-.255.756-.126.185-.468.536-1.024 1.055-.692.641-1.155 1.156-1.389 1.544-.234.389-.375.8-.422 1.233H11.3zm2.333 0v-1.235h-1.235V24h1.235zM9.204 34.11c.615 0 1.129-.2 1.542-.598.413-.398.62-.88.62-1.446 0-.39-.11-.722-.332-.997a1.5 1.5 0 0 0-.886-.532c.619-.337.928-.788.928-1.353 0-.399-.151-.756-.453-1.073-.366-.386-.852-.58-1.459-.58a2.25 2.25 0 0 0-.96.2 1.617 1.617 0 0 0-.668.55c-.16.232-.28.544-.358.933l1.138.194c.032-.282.123-.495.272-.642.15-.146.33-.22.54-.22.215 0 .386.065.515.194s.193.302.193.518c0 .255-.087.46-.263.613-.176.154-.43.227-.765.218l-.136 1.006c.22-.061.409-.092.567-.092.24 0 .444.09.61.272.168.182.251.428.251.739 0 .328-.087.589-.261.782a.833.833 0 0 1-.644.29.841.841 0 0 1-.607-.242c-.167-.16-.27-.394-.307-.698l-1.196.145c.062.542.285.98.668 1.316.384.335.868.503 1.45.503zm4.43-.11v-1.235h-1.236V34h1.235z"/></svg>',listStyleDecimalWithLeadingZeroIcon='<svg viewBox="0 0 44 44" xmlns="http://www.w3.org/2000/svg"><path d="M35 29a1 1 0 0 1 1 1v1a1 1 0 0 1-1 1H18a1 1 0 0 1-1-1v-1a1 1 0 0 1 1-1h17zm0-9a1 1 0 0 1 1 1v1a1 1 0 0 1-1 1H18a1 1 0 0 1-1-1v-1a1 1 0 0 1 1-1h17zm0-9a1 1 0 0 1 1 1v1a1 1 0 0 1-1 1H18a1 1 0 0 1-1-1v-1a1 1 0 0 1 1-1h17z" fill-opacity=".163"/><path d="M5.714 15.11c.624 0 1.11-.22 1.46-.66.421-.533.632-1.408.632-2.627 0-1.222-.21-2.096-.629-2.624-.351-.445-.839-.668-1.463-.668-.624 0-1.11.22-1.459.66-.422.533-.633 1.406-.633 2.619 0 1.236.192 2.095.576 2.577.384.482.89.723 1.516.723zm0-1.024a.614.614 0 0 1-.398-.14c-.115-.094-.211-.283-.287-.565-.077-.283-.115-.802-.115-1.558s.043-1.294.128-1.613c.064-.246.155-.417.272-.512a.617.617 0 0 1 .4-.143.61.61 0 0 1 .398.143c.116.095.211.284.288.567.076.283.114.802.114 1.558s-.043 1.292-.128 1.608c-.064.246-.155.417-.272.512a.617.617 0 0 1-.4.143zm6.078.914V8.531H10.79c-.14.393-.4.736-.778 1.03-.378.295-.728.495-1.05.6v1.121a4.257 4.257 0 0 0 1.595-.936V15h1.235zm3.344 0v-1.235h-1.235V15h1.235zm-9.422 9.11c.624 0 1.11-.22 1.46-.66.421-.533.632-1.408.632-2.627 0-1.222-.21-2.096-.629-2.624-.351-.445-.839-.668-1.463-.668-.624 0-1.11.22-1.459.66-.422.533-.633 1.406-.633 2.619 0 1.236.192 2.095.576 2.577.384.482.89.723 1.516.723zm0-1.024a.614.614 0 0 1-.398-.14c-.115-.094-.211-.283-.287-.565-.077-.283-.115-.802-.115-1.558s.043-1.294.128-1.613c.064-.246.155-.417.272-.512a.617.617 0 0 1 .4-.143.61.61 0 0 1 .398.143c.116.095.211.284.288.567.076.283.114.802.114 1.558s-.043 1.292-.128 1.608c-.064.246-.155.417-.272.512a.617.617 0 0 1-.4.143zm7.088.914v-1.147H10.35c.065-.111.149-.226.253-.343.104-.117.35-.354.74-.712.39-.357.66-.631.81-.821.225-.288.39-.562.493-.824.104-.263.156-.539.156-.829 0-.51-.181-.936-.544-1.279-.364-.342-.863-.514-1.499-.514-.58 0-1.063.148-1.45.444-.387.296-.617.784-.69 1.463l1.23.124c.024-.36.112-.619.264-.774.152-.155.357-.233.615-.233.261 0 .465.074.613.222.148.148.222.36.222.635 0 .25-.085.501-.255.756-.126.185-.467.536-1.024 1.055-.691.641-1.154 1.156-1.388 1.544-.235.389-.375.8-.422 1.233h4.328zm2.334 0v-1.235h-1.235V24h1.235zM5.714 34.11c.624 0 1.11-.22 1.46-.66.421-.533.632-1.408.632-2.627 0-1.222-.21-2.096-.629-2.624-.351-.445-.839-.668-1.463-.668-.624 0-1.11.22-1.459.66-.422.533-.633 1.406-.633 2.619 0 1.236.192 2.095.576 2.577.384.482.89.723 1.516.723zm0-1.024a.614.614 0 0 1-.398-.14c-.115-.094-.211-.283-.287-.565-.077-.283-.115-.802-.115-1.558s.043-1.294.128-1.613c.064-.246.155-.417.272-.512a.617.617 0 0 1 .4-.143.61.61 0 0 1 .398.143c.116.095.211.284.288.567.076.283.114.802.114 1.558s-.043 1.292-.128 1.608c-.064.246-.155.417-.272.512a.617.617 0 0 1-.4.143zm4.992 1.024c.616 0 1.13-.2 1.543-.598.413-.398.62-.88.62-1.446 0-.39-.111-.722-.332-.997a1.5 1.5 0 0 0-.886-.532c.618-.337.927-.788.927-1.353 0-.399-.15-.756-.452-1.073-.366-.386-.853-.58-1.46-.58a2.25 2.25 0 0 0-.96.2 1.617 1.617 0 0 0-.667.55c-.16.232-.28.544-.359.933l1.139.194c.032-.282.123-.495.272-.642.15-.146.33-.22.54-.22.214 0 .386.065.515.194s.193.302.193.518c0 .255-.088.46-.264.613-.175.154-.43.227-.764.218l-.136 1.006c.22-.061.408-.092.566-.092.24 0 .444.09.611.272.167.182.25.428.25.739 0 .328-.086.589-.26.782a.833.833 0 0 1-.644.29.841.841 0 0 1-.607-.242c-.167-.16-.27-.394-.308-.698l-1.195.145c.062.542.284.98.668 1.316.384.335.867.503 1.45.503zm4.43-.11v-1.235h-1.235V34h1.235z"/></svg>',listStyleLowerRomanIcon='<svg viewBox="0 0 44 44" xmlns="http://www.w3.org/2000/svg"><path d="M35 29a1 1 0 0 1 1 1v1a1 1 0 0 1-1 1H18a1 1 0 0 1-1-1v-1a1 1 0 0 1 1-1h17zm0-9a1 1 0 0 1 1 1v1a1 1 0 0 1-1 1H18a1 1 0 0 1-1-1v-1a1 1 0 0 1 1-1h17zm0-9a1 1 0 0 1 1 1v1a1 1 0 0 1-1 1H18a1 1 0 0 1-1-1v-1a1 1 0 0 1 1-1h17z" fill-opacity=".163"/><path d="M11.88 8.7V7.558h-1.234V8.7h1.234zm0 5.3V9.333h-1.234V14h1.234zm2.5 0v-1.235h-1.234V14h1.235zm-4.75 4.7v-1.142H8.395V18.7H9.63zm0 5.3v-4.667H8.395V24H9.63zm2.5-5.3v-1.142h-1.234V18.7h1.235zm0 5.3v-4.667h-1.234V24h1.235zm2.501 0v-1.235h-1.235V24h1.235zM7.38 28.7v-1.142H6.145V28.7H7.38zm0 5.3v-4.667H6.145V34H7.38zm2.5-5.3v-1.142H8.646V28.7H9.88zm0 5.3v-4.667H8.646V34H9.88zm2.5-5.3v-1.142h-1.234V28.7h1.235zm0 5.3v-4.667h-1.234V34h1.235zm2.501 0v-1.235h-1.235V34h1.235z"/></svg>',listStyleUpperRomanIcon='<svg viewBox="0 0 44 44" xmlns="http://www.w3.org/2000/svg"><path d="M35 29a1 1 0 0 1 1 1v1a1 1 0 0 1-1 1H18a1 1 0 0 1-1-1v-1a1 1 0 0 1 1-1h17zm0-9a1 1 0 0 1 1 1v1a1 1 0 0 1-1 1H18a1 1 0 0 1-1-1v-1a1 1 0 0 1 1-1h17zm0-9a1 1 0 0 1 1 1v1a1 1 0 0 1-1 1H18a1 1 0 0 1-1-1v-1a1 1 0 0 1 1-1h17z" fill-opacity=".163"/><path d="M11.916 15V8.558h-1.301V15h1.3zm2.465 0v-1.235h-1.235V15h1.235zM9.665 25v-6.442h-1.3V25h1.3zm2.5 0v-6.442h-1.3V25h1.3zm2.466 0v-1.235h-1.235V25h1.235zm-7.216 9v-6.442h-1.3V34h1.3zm2.5 0v-6.442h-1.3V34h1.3zm2.501 0v-6.442h-1.3V34h1.3zm2.465 0v-1.235h-1.235V34h1.235z"/></svg>',listStyleLowerLatinIcon='<svg viewBox="0 0 44 44" xmlns="http://www.w3.org/2000/svg"><path d="M35 29a1 1 0 0 1 1 1v1a1 1 0 0 1-1 1H18a1 1 0 0 1-1-1v-1a1 1 0 0 1 1-1h17zm0-9a1 1 0 0 1 1 1v1a1 1 0 0 1-1 1H18a1 1 0 0 1-1-1v-1a1 1 0 0 1 1-1h17zm0-9a1 1 0 0 1 1 1v1a1 1 0 0 1-1 1H18a1 1 0 0 1-1-1v-1a1 1 0 0 1 1-1h17z" fill-opacity=".163"/><path d="M9.62 14.105c.272 0 .528-.05.768-.153s.466-.257.677-.462c.009.024.023.072.044.145.047.161.086.283.119.365h1.221a2.649 2.649 0 0 1-.222-.626c-.04-.195-.059-.498-.059-.908l.013-1.441c0-.536-.055-.905-.165-1.105-.11-.201-.3-.367-.569-.497-.27-.13-.68-.195-1.23-.195-.607 0-1.064.108-1.371.325-.308.217-.525.55-.65 1.002l1.12.202c.076-.217.176-.369.299-.455.123-.086.294-.13.514-.13.325 0 .546.05.663.152.118.101.176.27.176.508v.123c-.222.093-.622.194-1.2.303-.427.082-.755.178-.982.288-.227.11-.403.268-.53.474a1.327 1.327 0 0 0-.188.706c0 .398.138.728.415.988.277.261.656.391 1.136.391zm.368-.87a.675.675 0 0 1-.492-.189.606.606 0 0 1-.193-.448c0-.176.08-.32.241-.435.106-.07.33-.142.673-.215a7.19 7.19 0 0 0 .751-.19v.247c0 .296-.016.496-.048.602a.773.773 0 0 1-.295.409 1.07 1.07 0 0 1-.637.22zm4.645.765v-1.235h-1.235V14h1.235zM10.2 25.105c.542 0 1.003-.215 1.382-.646.38-.43.57-1.044.57-1.84 0-.771-.187-1.362-.559-1.774a1.82 1.82 0 0 0-1.41-.617c-.522 0-.973.216-1.354.65v-2.32H7.594V25h1.147v-.686a1.9 1.9 0 0 0 .67.592c.26.133.523.2.79.2zm-.299-.975c-.354 0-.638-.164-.852-.492-.153-.232-.229-.59-.229-1.073 0-.468.098-.818.295-1.048a.93.93 0 0 1 .738-.345c.302 0 .55.118.743.354.193.236.29.62.29 1.154 0 .5-.096.868-.288 1.1-.192.233-.424.35-.697.35zm4.478.87v-1.235h-1.234V25h1.234zm-4.017 9.105c.6 0 1.08-.142 1.437-.426.357-.284.599-.704.725-1.261l-1.213-.207c-.061.326-.167.555-.316.688a.832.832 0 0 1-.576.2.916.916 0 0 1-.75-.343c-.185-.228-.278-.62-.278-1.173 0-.498.091-.853.274-1.066.183-.212.429-.318.736-.318.232 0 .42.061.565.184.145.123.238.306.28.55l1.216-.22c-.146-.501-.387-.874-.722-1.119-.336-.244-.788-.366-1.356-.366-.695 0-1.245.214-1.653.643-.407.43-.61 1.03-.61 1.8 0 .762.202 1.358.608 1.788.406.431.95.646 1.633.646zM14.633 34v-1.235h-1.235V34h1.235z"/></svg>',listStyleUpperLatinIcon='<svg viewBox="0 0 44 44" xmlns="http://www.w3.org/2000/svg"><path d="M35 29a1 1 0 0 1 1 1v1a1 1 0 0 1-1 1H18a1 1 0 0 1-1-1v-1a1 1 0 0 1 1-1h17zm0-9a1 1 0 0 1 1 1v1a1 1 0 0 1-1 1H18a1 1 0 0 1-1-1v-1a1 1 0 0 1 1-1h17zm0-9a1 1 0 0 1 1 1v1a1 1 0 0 1-1 1H18a1 1 0 0 1-1-1v-1a1 1 0 0 1 1-1h17z" fill-opacity=".163"/><path d="m7.88 15 .532-1.463h2.575L11.549 15h1.415l-2.58-6.442H9.01L6.5 15h1.38zm2.69-2.549H8.811l.87-2.39.887 2.39zM14.88 15v-1.235h-1.234V15h1.234zM9.352 25c.83-.006 1.352-.02 1.569-.044.346-.038.636-.14.872-.305.236-.166.422-.387.558-.664.137-.277.205-.562.205-.855 0-.372-.106-.695-.317-.97-.21-.276-.512-.471-.905-.585a1.51 1.51 0 0 0 .661-.567 1.5 1.5 0 0 0 .244-.83c0-.28-.066-.53-.197-.754a1.654 1.654 0 0 0-.495-.539 1.676 1.676 0 0 0-.672-.266c-.25-.042-.63-.063-1.14-.063H7.158V25h2.193zm.142-3.88H8.46v-1.49h.747c.612 0 .983.007 1.112.022.217.026.38.102.49.226.11.125.165.287.165.486a.68.68 0 0 1-.192.503.86.86 0 0 1-.525.23 11.47 11.47 0 0 1-.944.023h.18zm.17 2.795H8.46v-1.723h1.05c.592 0 .977.03 1.154.092.177.062.313.16.406.295a.84.84 0 0 1 .14.492c0 .228-.06.41-.181.547a.806.806 0 0 1-.473.257c-.126.026-.423.04-.892.04zM14.88 25v-1.235h-1.234V25h1.234zm-5.018 9.11c.691 0 1.262-.17 1.711-.512.45-.341.772-.864.965-1.567l-1.261-.4c-.109.472-.287.818-.536 1.037-.25.22-.547.33-.892.33-.47 0-.85-.173-1.143-.519-.293-.345-.44-.925-.44-1.74 0-.767.15-1.322.447-1.665.297-.343.684-.514 1.162-.514.346 0 .64.096.881.29.242.193.4.457.477.79l1.288-.307c-.147-.516-.367-.911-.66-1.187-.492-.465-1.132-.698-1.92-.698-.902 0-1.63.296-2.184.89-.554.593-.83 1.426-.83 2.498 0 1.014.275 1.813.825 2.397.551.585 1.254.877 2.11.877zM14.88 34v-1.235h-1.234V34h1.234z"/></svg>';class ListPropertiesUI extends Plugin{static get pluginName(){return"ListPropertiesUI"}init(){const we=this.editor,t=we.locale.t,te=we.config.get("list.properties");if(te.styles){const be=[{label:t("Toggle the disc list style"),tooltip:t("Disc"),type:"disc",icon:listStyleDiscIcon},{label:t("Toggle the circle list style"),tooltip:t("Circle"),type:"circle",icon:listStyleCircleIcon},{label:t("Toggle the square list style"),tooltip:t("Square"),type:"square",icon:listStyleSquareIcon}],xe=t("Bulleted List"),ve=t("Bulleted list styles toolbar"),ke="bulletedList";we.ui.componentFactory.add(ke,getDropdownViewCreator({editor:we,propertiesConfig:te,parentCommandName:ke,buttonLabel:xe,buttonIcon:icons.bulletedList,styleGridAriaLabel:ve,styleDefinitions:be})),we.ui.componentFactory.add(`menuBar:${ke}`,getMenuBarStylesMenuCreator({editor:we,propertiesConfig:te,parentCommandName:ke,buttonLabel:xe,styleGridAriaLabel:ve,styleDefinitions:be}))}if(te.styles||te.startIndex||te.reversed){const be=[{label:t("Toggle the decimal list style"),tooltip:t("Decimal"),type:"decimal",icon:listStyleDecimalIcon},{label:t("Toggle the decimal with leading zero list style"),tooltip:t("Decimal with leading zero"),type:"decimal-leading-zero",icon:listStyleDecimalWithLeadingZeroIcon},{label:t("Toggle the lower–roman list style"),tooltip:t("Lower–roman"),type:"lower-roman",icon:listStyleLowerRomanIcon},{label:t("Toggle the upper–roman list style"),tooltip:t("Upper-roman"),type:"upper-roman",icon:listStyleUpperRomanIcon},{label:t("Toggle the lower–latin list style"),tooltip:t("Lower-latin"),type:"lower-latin",icon:listStyleLowerLatinIcon},{label:t("Toggle the upper–latin list style"),tooltip:t("Upper-latin"),type:"upper-latin",icon:listStyleUpperLatinIcon}],xe=t("Numbered List"),ve=t("Numbered list styles toolbar"),ke="numberedList";we.ui.componentFactory.add(ke,getDropdownViewCreator({editor:we,propertiesConfig:te,parentCommandName:ke,buttonLabel:xe,buttonIcon:icons.numberedList,styleGridAriaLabel:ve,styleDefinitions:be})),te.styles&&we.ui.componentFactory.add(`menuBar:${ke}`,getMenuBarStylesMenuCreator({editor:we,propertiesConfig:te,parentCommandName:ke,buttonLabel:xe,styleGridAriaLabel:ve,styleDefinitions:be}))}}}function getDropdownViewCreator({editor:Te,propertiesConfig:we,parentCommandName:t,buttonLabel:te,buttonIcon:be,styleGridAriaLabel:xe,styleDefinitions:ve}){const ke=Te.commands.get(t);return Ie=>{const Ae=createDropdown(Ie,SplitButtonView),Se=Ae.buttonView;return Ae.bind("isEnabled").to(ke),Ae.class="ck-list-styles-dropdown",Se.on("execute",()=>{Te.execute(t),Te.editing.view.focus()}),Se.set({label:te,icon:be,tooltip:!0,isToggleable:!0}),Se.bind("isOn").to(ke,"value",Oe=>!!Oe),Ae.once("change:isOpen",()=>{const Oe=createListPropertiesView({editor:Te,propertiesConfig:we,dropdownView:Ae,parentCommandName:t,styleGridAriaLabel:xe,styleDefinitions:ve});Ae.panelView.children.add(Oe)}),Ae.on("execute",()=>{Te.editing.view.focus()}),Ae}}function getStyleButtonCreator({editor:Te,listStyleCommand:we,parentCommandName:t}){const te=Te.locale,be=Te.commands.get(t);return({label:xe,type:ve,icon:ke,tooltip:Ie})=>{const Ae=new ButtonView(te);return Ae.set({label:xe,icon:ke,tooltip:Ie}),we.on("change:value",()=>{Ae.isOn=we.value===ve}),Ae.on("execute",()=>{be.value?we.value===ve?Te.execute(t):we.value!==ve&&Te.execute("listStyle",{type:ve}):Te.model.change(()=>{Te.execute("listStyle",{type:ve})})}),Ae}}function createListPropertiesView({editor:Te,propertiesConfig:we,dropdownView:t,parentCommandName:te,styleDefinitions:be,styleGridAriaLabel:xe}){const ve=Te.locale,ke={...we};te!="numberedList"&&(ke.startIndex=!1,ke.reversed=!1);let Ie=null;if(ke.styles){const Se=Te.commands.get("listStyle"),Oe=getStyleButtonCreator({editor:Te,parentCommandName:te,listStyleCommand:Se}),Ve=getStyleTypeSupportChecker(Se);Ie=be.filter(Ve).map(Oe)}const Ae=new ListPropertiesView(ve,{styleGridAriaLabel:xe,enabledProperties:ke,styleButtonViews:Ie});if(ke.styles&&focusChildOnDropdownOpen(t,()=>Ae.stylesView.children.find(Se=>Se.isOn)),ke.startIndex){const Se=Te.commands.get("listStart");Ae.startIndexFieldView.bind("isEnabled").to(Se),Ae.startIndexFieldView.fieldView.bind("value").to(Se),Ae.on("listStart",(Oe,Ve)=>Te.execute("listStart",Ve))}if(ke.reversed){const Se=Te.commands.get("listReversed");Ae.reversedSwitchButtonView.bind("isEnabled").to(Se),Ae.reversedSwitchButtonView.bind("isOn").to(Se,"value",Oe=>!!Oe),Ae.on("listReversed",()=>{const Oe=Se.value;Te.execute("listReversed",{reversed:!Oe})})}return Ae.delegate("execute").to(t),Ae}function getMenuBarStylesMenuCreator({editor:Te,propertiesConfig:we,parentCommandName:t,buttonLabel:te,styleGridAriaLabel:be,styleDefinitions:xe}){return ve=>{const ke=new MenuBarMenuView(ve),Ie=Te.commands.get(t),Ae=Te.commands.get("listStyle"),Se=getStyleTypeSupportChecker(Ae),Oe=getStyleButtonCreator({editor:Te,parentCommandName:t,listStyleCommand:Ae}),Ve=xe.filter(Se).map(Oe),Me=new ListPropertiesView(ve,{styleGridAriaLabel:be,enabledProperties:{...we,startIndex:!1,reversed:!1},styleButtonViews:Ve});return Me.delegate("execute").to(ke),ke.buttonView.set({label:te,icon:icons[t]}),ke.panelView.children.add(Me),ke.bind("isEnabled").to(Ie,"isEnabled"),ke.on("execute",()=>{Te.editing.view.focus()}),ke}}function getStyleTypeSupportChecker(Te){return typeof Te.isStyleTypeSupported=="function"?we=>Te.isStyleTypeSupported(we.type):()=>!0}class ListProperties extends Plugin{static get requires(){return[ListPropertiesEditing,ListPropertiesUI]}static get pluginName(){return"ListProperties"}}class CheckTodoListCommand extends Command{constructor(we){super(we),this.on("execute",()=>{this.refresh()},{priority:"highest"})}refresh(){const we=this._getSelectedItems();this.value=this._getValue(we),this.isEnabled=!!we.length}execute(we={}){this.editor.model.change(t=>{const te=this._getSelectedItems(),be=we.forceValue===void 0?!this._getValue(te):we.forceValue;for(const xe of te)be?t.setAttribute("todoListChecked",!0,xe):t.removeAttribute("todoListChecked",xe)})}_getValue(we){return we.every(t=>t.getAttribute("todoListChecked"))}_getSelectedItems(){const we=this.editor.model,t=we.schema,te=we.document.selection.getFirstRange(),be=te.start.parent,xe=[];t.checkAttribute(be,"todoListChecked")&&xe.push(...getAllListItemBlocks(be));for(const ve of te.getItems({shallow:!0}))t.checkAttribute(ve,"todoListChecked")&&!xe.includes(ve)&&xe.push(...getAllListItemBlocks(ve));return xe}}class TodoCheckboxChangeObserver extends DomEventObserver{constructor(){super(...arguments);Re(this,"domEventType",["change"])}onDomEvent(t){if(t.target){const te=this.view.domConverter.mapDomToView(t.target);te&&te.is("element","input")&&te.getAttribute("type")=="checkbox"&&te.findAncestor({classes:"todo-list__label"})&&this.fire("todoCheckboxChange",t)}}}const ITEM_TOGGLE_KEYSTROKE$1=parseKeystroke("Ctrl+Enter");class TodoListEditing extends Plugin{static get pluginName(){return"TodoListEditing"}static get requires(){return[ListEditing]}init(){const we=this.editor,t=we.model,te=we.editing,be=we.plugins.get(ListEditing),ve=we.config.get("list.multiBlock")?"paragraph":"listItem";we.commands.add("todoList",new ListCommand(we,"todo")),we.commands.add("checkTodoList",new CheckTodoListCommand(we)),te.view.addObserver(TodoCheckboxChangeObserver),t.schema.extend("$listItem",{allowAttributes:"todoListChecked"}),t.schema.addAttributeCheck((ke,Ie)=>{const Ae=ke.last;if(Ie=="todoListChecked"&&(!Ae.getAttribute("listItemId")||Ae.getAttribute("listType")!="todo"))return!1}),we.conversion.for("upcast").add(ke=>{ke.on("element:input",todoItemInputConverter()),ke.on("element:label",elementUpcastConsumingConverter({name:"label",classes:"todo-list__label"})),ke.on("element:label",elementUpcastConsumingConverter({name:"label",classes:["todo-list__label","todo-list__label_without-description"]})),ke.on("element:span",elementUpcastConsumingConverter({name:"span",classes:"todo-list__label__description"})),ke.on("element:ul",attributeUpcastConsumingConverter({name:"ul",classes:"todo-list"}))}),we.conversion.for("downcast").elementToElement({model:ve,view:(ke,{writer:Ie})=>{if(isDescriptionBlock(ke,be.getListAttributeNames()))return Ie.createContainerElement("span",{class:"todo-list__label__description"})},converterPriority:"highest"}),be.registerDowncastStrategy({scope:"list",attributeName:"listType",setAttributeOnDowncast(ke,Ie,Ae){Ie=="todo"?ke.addClass("todo-list",Ae):ke.removeClass("todo-list",Ae)}}),be.registerDowncastStrategy({scope:"itemMarker",attributeName:"todoListChecked",createElement(ke,Ie,{dataPipeline:Ae}){if(Ie.getAttribute("listType")!="todo")return null;const Se=ke.createUIElement("input",{type:"checkbox",...Ie.getAttribute("todoListChecked")?{checked:"checked"}:null,...Ae?{disabled:"disabled"}:{tabindex:"-1"}});if(Ae)return Se;const Oe=ke.createContainerElement("span",{contenteditable:"false"},Se);return Oe.getFillerOffset=()=>null,Oe},canWrapElement(ke){return isDescriptionBlock(ke,be.getListAttributeNames())},createWrapperElement(ke,Ie,{dataPipeline:Ae}){const Se=["todo-list__label"];return isDescriptionBlock(Ie,be.getListAttributeNames())||Se.push("todo-list__label_without-description"),ke.createAttributeElement(Ae?"label":"span",{class:Se.join(" ")})}}),be.on("checkElement",(ke,{modelElement:Ie,viewElement:Ae})=>{const Se=isDescriptionBlock(Ie,be.getListAttributeNames());Ae.hasClass("todo-list__label__description")!=Se&&(ke.return=!0,ke.stop())}),be.on("checkElement",(ke,{modelElement:Ie,viewElement:Ae})=>{const Se=Ie.getAttribute("listType")=="todo"&&isFirstBlockOfListItem(Ie);let Oe=!1;const Ve=we.editing.view.createPositionBefore(Ae).getWalker({direction:"backward"});for(const{item:Me}of Ve){if(Me.is("element")&&we.editing.mapper.toModelElement(Me))break;Me.is("element","input")&&Me.getAttribute("type")=="checkbox"&&(Oe=!0)}Oe!=Se&&(ke.return=!0,ke.stop())}),be.on("postFixer",(ke,{listNodes:Ie,writer:Ae})=>{for(const{node:Se,previousNodeInList:Oe}of Ie){if(!Oe||Oe.getAttribute("listItemId")!=Se.getAttribute("listItemId"))continue;const Ve=Oe.hasAttribute("todoListChecked"),Me=Se.hasAttribute("todoListChecked");Me&&!Ve?(Ae.removeAttribute("todoListChecked",Se),ke.return=!0):!Me&&Ve&&(Ae.setAttribute("todoListChecked",!0,Se),ke.return=!0)}}),t.document.registerPostFixer(ke=>{const Ie=t.document.differ.getChanges();let Ae=!1;for(const Se of Ie)if(Se.type=="attribute"&&Se.attributeKey=="listType"){const Oe=Se.range.start.nodeAfter;Se.attributeOldValue=="todo"&&Oe.hasAttribute("todoListChecked")&&(ke.removeAttribute("todoListChecked",Oe),Ae=!0)}else if(Se.type=="insert"&&Se.name!="$text")for(const{item:Oe}of ke.createRangeOn(Se.position.nodeAfter))Oe.is("element")&&Oe.getAttribute("listType")!="todo"&&Oe.hasAttribute("todoListChecked")&&(ke.removeAttribute("todoListChecked",Oe),Ae=!0);return Ae}),this.listenTo(te.view.document,"keydown",(ke,Ie)=>{getCode(Ie)===ITEM_TOGGLE_KEYSTROKE$1&&(we.execute("checkTodoList"),ke.stop())},{priority:"high"}),this.listenTo(te.view.document,"todoCheckboxChange",(ke,Ie)=>{const Ae=Ie.target;if(!Ae||!Ae.is("element","input"))return;const Se=te.view.createPositionAfter(Ae),Ve=te.mapper.toModelPosition(Se).parent;Ve&&isListItemBlock(Ve)&&Ve.getAttribute("listType")=="todo"&&this._handleCheckmarkChange(Ve)}),this.listenTo(te.view.document,"arrowKey",jumpOverCheckmarkOnSideArrowKeyPress$1(t,we.locale),{context:"$text"}),this.listenTo(te.mapper,"viewToModelPosition",(ke,Ie)=>{const Ae=Ie.viewPosition.parent,Se=Ae.is("attributeElement","li")&&Ie.viewPosition.offset==0,Oe=isLabelElement(Ae)&&Ie.viewPosition.offset<=1,Ve=Ae.is("element","span")&&Ae.getAttribute("contenteditable")=="false"&&isLabelElement(Ae.parent);if(!Se&&!Oe&&!Ve)return;const Me=Ie.modelPosition.nodeAfter;Me&&Me.getAttribute("listType")=="todo"&&(Ie.modelPosition=t.createPositionAt(Me,0))},{priority:"low"}),this._initAriaAnnouncements()}_handleCheckmarkChange(we){const t=this.editor,te=t.model,be=Array.from(te.document.selection.getRanges());te.change(xe=>{xe.setSelection(we,"end"),t.execute("checkTodoList"),xe.setSelection(be)})}_initAriaAnnouncements(){const{model:we,ui:t,t:te}=this.editor;let be=null;t&&we.document.selection.on("change:range",()=>{const xe=we.document.selection.focus.parent,ve=isTodoListItemElement(be),ke=isTodoListItemElement(xe);ve&&!ke?t.ariaLiveAnnouncer.announce(te("Leaving a to-do list")):!ve&&ke&&t.ariaLiveAnnouncer.announce(te("Entering a to-do list")),be=xe})}}function todoItemInputConverter(){return(Te,we,t)=>{const te=we.modelCursor,be=te.parent,xe=we.viewItem;if(!t.consumable.test(xe,{name:!0})||xe.getAttribute("type")!="checkbox"||!te.isAtStart||!be.hasAttribute("listType"))return;t.consumable.consume(xe,{name:!0});const ve=t.writer;ve.setAttribute("listType","todo",be),we.viewItem.hasAttribute("checked")&&ve.setAttribute("todoListChecked",!0,be),we.modelRange=ve.createRange(te)}}function elementUpcastConsumingConverter(Te){const we=new Matcher(Te);return(t,te,be)=>{const xe=we.match(te.viewItem);xe&&be.consumable.consume(te.viewItem,xe.match)&&Object.assign(te,be.convertChildren(te.viewItem,te.modelCursor))}}function attributeUpcastConsumingConverter(Te){const we=new Matcher(Te);return(t,te,be)=>{const xe=we.match(te.viewItem);if(!xe)return;const ve=xe.match;ve.name=!1,be.consumable.consume(te.viewItem,ve)}}function isDescriptionBlock(Te,we){return(Te.is("element","paragraph")||Te.is("element","listItem"))&&Te.getAttribute("listType")=="todo"&&isFirstBlockOfListItem(Te)&&hasOnlyListAttributes(Te,we)}function hasOnlyListAttributes(Te,we){for(const t of Te.getAttributeKeys())if(!t.startsWith("selection:")&&!we.includes(t))return!1;return!0}function jumpOverCheckmarkOnSideArrowKeyPress$1(Te,we){return(t,te)=>{const be=getLocalizedArrowKeyCodeDirection(te.keyCode,we.contentLanguageDirection),xe=Te.schema,ve=Te.document.selection;if(!ve.isCollapsed)return;const ke=ve.getFirstPosition(),Ie=ke.parent;if(be=="right"&&ke.isAtEnd){const Ae=xe.getNearestSelectionRange(Te.createPositionAfter(Ie),"forward");if(!Ae)return;const Se=Ae.start.parent;Se&&isListItemBlock(Se)&&Se.getAttribute("listType")=="todo"&&(Te.change(Oe=>Oe.setSelection(Ae)),te.preventDefault(),te.stopPropagation(),t.stop())}else if(be=="left"&&ke.isAtStart&&isListItemBlock(Ie)&&Ie.getAttribute("listType")=="todo"){const Ae=xe.getNearestSelectionRange(Te.createPositionBefore(Ie),"backward");if(!Ae)return;Te.change(Se=>Se.setSelection(Ae)),te.preventDefault(),te.stopPropagation(),t.stop()}}}function isLabelElement(Te){return!!Te&&Te.is("attributeElement")&&Te.hasClass("todo-list__label")}function isTodoListItemElement(Te){return!Te||!Te.is("element","paragraph")&&!Te.is("element","listItem")?!1:Te.getAttribute("listType")=="todo"}class TodoListUI extends Plugin{static get pluginName(){return"TodoListUI"}init(){const we=this.editor.t;createUIComponents(this.editor,"todoList",we("To-do List"),icons.todoList)}}class TodoList extends Plugin{static get requires(){return[TodoListEditing,TodoListUI]}static get pluginName(){return"TodoList"}}function getDefaults(){return{baseUrl:null,breaks:!1,extensions:null,gfm:!0,headerIds:!0,headerPrefix:"",highlight:null,langPrefix:"language-",mangle:!0,pedantic:!1,renderer:null,sanitize:!1,sanitizer:null,silent:!1,smartLists:!1,smartypants:!1,tokenizer:null,walkTokens:null,xhtml:!1}}let defaults=getDefaults();function changeDefaults(Te){defaults=Te}const escapeTest=/[&<>"']/,escapeReplace=/[&<>"']/g,escapeTestNoEncode=/[<>"']|&(?!#?\w+;)/,escapeReplaceNoEncode=/[<>"']|&(?!#?\w+;)/g,escapeReplacements={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},getEscapeReplacement=Te=>escapeReplacements[Te];function escape(Te,we){if(we){if(escapeTest.test(Te))return Te.replace(escapeReplace,getEscapeReplacement)}else if(escapeTestNoEncode.test(Te))return Te.replace(escapeReplaceNoEncode,getEscapeReplacement);return Te}const unescapeTest=/&(#(?:\d+)|(?:#x[0-9A-Fa-f]+)|(?:\w+));?/ig;function unescape$1(Te){return Te.replace(unescapeTest,(we,t)=>(t=t.toLowerCase(),t==="colon"?":":t.charAt(0)==="#"?t.charAt(1)==="x"?String.fromCharCode(parseInt(t.substring(2),16)):String.fromCharCode(+t.substring(1)):""))}const caret=/(^|[^\[])\^/g;function edit(Te,we){Te=Te.source||Te,we=we||"";const t={replace:(te,be)=>(be=be.source||be,be=be.replace(caret,"$1"),Te=Te.replace(te,be),t),getRegex:()=>new RegExp(Te,we)};return t}const nonWordAndColonTest=/[^\w:]/g,originIndependentUrl=/^$|^[a-z][a-z0-9+.-]*:|^[?#]/i;function cleanUrl(Te,we,t){if(Te){let te;try{te=decodeURIComponent(unescape$1(t)).replace(nonWordAndColonTest,"").toLowerCase()}catch{return null}if(te.indexOf("javascript:")===0||te.indexOf("vbscript:")===0||te.indexOf("data:")===0)return null}we&&!originIndependentUrl.test(t)&&(t=resolveUrl(we,t));try{t=encodeURI(t).replace(/%25/g,"%")}catch{return null}return t}const baseUrls={},justDomain=/^[^:]+:\/*[^/]*$/,protocol$2=/^([^:]+:)[\s\S]*$/,domain=/^([^:]+:\/*[^/]*)[\s\S]*$/;function resolveUrl(Te,we){baseUrls[" "+Te]||(justDomain.test(Te)?baseUrls[" "+Te]=Te+"/":baseUrls[" "+Te]=rtrim(Te,"/",!0)),Te=baseUrls[" "+Te];const t=Te.indexOf(":")===-1;return we.substring(0,2)==="//"?t?we:Te.replace(protocol$2,"$1")+we:we.charAt(0)==="/"?t?we:Te.replace(domain,"$1")+we:Te+we}const noopTest={exec:function(){}};function merge(Te){let we=1,t,te;for(;we<arguments.length;we++){t=arguments[we];for(te in t)Object.prototype.hasOwnProperty.call(t,te)&&(Te[te]=t[te])}return Te}function splitCells(Te,we){const t=Te.replace(/\|/g,(xe,ve,ke)=>{let Ie=!1,Ae=ve;for(;--Ae>=0&&ke[Ae]==="\\";)Ie=!Ie;return Ie?"|":" |"}),te=t.split(/ \|/);let be=0;if(te[0].trim()||te.shift(),te.length>0&&!te[te.length-1].trim()&&te.pop(),te.length>we)te.splice(we);else for(;te.length<we;)te.push("");for(;be<te.length;be++)te[be]=te[be].trim().replace(/\\\|/g,"|");return te}function rtrim(Te,we,t){const te=Te.length;if(te===0)return"";let be=0;for(;be<te;){const xe=Te.charAt(te-be-1);if(xe===we&&!t)be++;else if(xe!==we&&t)be++;else break}return Te.substr(0,te-be)}function findClosingBracket(Te,we){if(Te.indexOf(we[1])===-1)return-1;const t=Te.length;let te=0,be=0;for(;be<t;be++)if(Te[be]==="\\")be++;else if(Te[be]===we[0])te++;else if(Te[be]===we[1]&&(te--,te<0))return be;return-1}function checkSanitizeDeprecation(Te){Te&&Te.sanitize&&!Te.silent&&console.warn("marked(): sanitize and sanitizer parameters are deprecated since version 0.7.0, should not be used and will be removed in the future. Read more here: https://marked.js.org/#/USING_ADVANCED.md#options")}function repeatString(Te,we){if(we<1)return"";let t="";for(;we>1;)we&1&&(t+=Te),we>>=1,Te+=Te;return t+Te}function outputLink(Te,we,t,te){const be=we.href,xe=we.title?escape(we.title):null,ve=Te[1].replace(/\\([\[\]])/g,"$1");if(Te[0].charAt(0)!=="!"){te.state.inLink=!0;const ke={type:"link",raw:t,href:be,title:xe,text:ve,tokens:te.inlineTokens(ve,[])};return te.state.inLink=!1,ke}else return{type:"image",raw:t,href:be,title:xe,text:escape(ve)}}function indentCodeCompensation(Te,we){const t=Te.match(/^(\s+)(?:```)/);if(t===null)return we;const te=t[1];return we.split(`
`).map(be=>{const xe=be.match(/^\s+/);if(xe===null)return be;const[ve]=xe;return ve.length>=te.length?be.slice(te.length):be}).join(`
`)}class Tokenizer{constructor(we){this.options=we||defaults}space(we){const t=this.rules.block.newline.exec(we);if(t&&t[0].length>0)return{type:"space",raw:t[0]}}code(we){const t=this.rules.block.code.exec(we);if(t){const te=t[0].replace(/^ {1,4}/gm,"");return{type:"code",raw:t[0],codeBlockStyle:"indented",text:this.options.pedantic?te:rtrim(te,`
`)}}}fences(we){const t=this.rules.block.fences.exec(we);if(t){const te=t[0],be=indentCodeCompensation(te,t[3]||"");return{type:"code",raw:te,lang:t[2]?t[2].trim():t[2],text:be}}}heading(we){const t=this.rules.block.heading.exec(we);if(t){let te=t[2].trim();if(/#$/.test(te)){const xe=rtrim(te,"#");(this.options.pedantic||!xe||/ $/.test(xe))&&(te=xe.trim())}const be={type:"heading",raw:t[0],depth:t[1].length,text:te,tokens:[]};return this.lexer.inline(be.text,be.tokens),be}}hr(we){const t=this.rules.block.hr.exec(we);if(t)return{type:"hr",raw:t[0]}}blockquote(we){const t=this.rules.block.blockquote.exec(we);if(t){const te=t[0].replace(/^ *> ?/gm,"");return{type:"blockquote",raw:t[0],tokens:this.lexer.blockTokens(te,[]),text:te}}}list(we){let t=this.rules.block.list.exec(we);if(t){let te,be,xe,ve,ke,Ie,Ae,Se,Oe,Ve,Me,De,Fe=t[1].trim();const Be=Fe.length>1,$e={type:"list",raw:"",ordered:Be,start:Be?+Fe.slice(0,-1):"",loose:!1,items:[]};Fe=Be?`\\d{1,9}\\${Fe.slice(-1)}`:`\\${Fe}`,this.options.pedantic&&(Fe=Be?Fe:"[*+-]");const Ue=new RegExp(`^( {0,3}${Fe})((?: [^\\n]*)?(?:\\n|$))`);for(;we&&(De=!1,!(!(t=Ue.exec(we))||this.rules.block.hr.test(we)));){if(te=t[0],we=we.substring(te.length),Se=t[2].split(`
`,1)[0],Oe=we.split(`
`,1)[0],this.options.pedantic?(ve=2,Me=Se.trimLeft()):(ve=t[2].search(/[^ ]/),ve=ve>4?1:ve,Me=Se.slice(ve),ve+=t[1].length),Ie=!1,!Se&&/^ *$/.test(Oe)&&(te+=Oe+`
`,we=we.substring(Oe.length+1),De=!0),!De){const ze=new RegExp(`^ {0,${Math.min(3,ve-1)}}(?:[*+-]|\\d{1,9}[.)])`);for(;we&&(Ve=we.split(`
`,1)[0],Se=Ve,this.options.pedantic&&(Se=Se.replace(/^ {1,4}(?=( {4})*[^ ])/g,"  ")),!ze.test(Se));){if(Se.search(/[^ ]/)>=ve||!Se.trim())Me+=`
`+Se.slice(ve);else if(!Ie)Me+=`
`+Se;else break;!Ie&&!Se.trim()&&(Ie=!0),te+=Ve+`
`,we=we.substring(Ve.length+1)}}$e.loose||(Ae?$e.loose=!0:/\n *\n *$/.test(te)&&(Ae=!0)),this.options.gfm&&(be=/^\[[ xX]\] /.exec(Me),be&&(xe=be[0]!=="[ ] ",Me=Me.replace(/^\[[ xX]\] +/,""))),$e.items.push({type:"list_item",raw:te,task:!!be,checked:xe,loose:!1,text:Me}),$e.raw+=te}$e.items[$e.items.length-1].raw=te.trimRight(),$e.items[$e.items.length-1].text=Me.trimRight(),$e.raw=$e.raw.trimRight();const He=$e.items.length;for(ke=0;ke<He;ke++){this.lexer.state.top=!1,$e.items[ke].tokens=this.lexer.blockTokens($e.items[ke].text,[]);const ze=$e.items[ke].tokens.filter(Ke=>Ke.type==="space"),qe=ze.every(Ke=>{const Qe=Ke.raw.split("");let je=0;for(const Ye of Qe)if(Ye===`
`&&(je+=1),je>1)return!0;return!1});!$e.loose&&ze.length&&qe&&($e.loose=!0,$e.items[ke].loose=!0)}return $e}}html(we){const t=this.rules.block.html.exec(we);if(t){const te={type:"html",raw:t[0],pre:!this.options.sanitizer&&(t[1]==="pre"||t[1]==="script"||t[1]==="style"),text:t[0]};return this.options.sanitize&&(te.type="paragraph",te.text=this.options.sanitizer?this.options.sanitizer(t[0]):escape(t[0]),te.tokens=[],this.lexer.inline(te.text,te.tokens)),te}}def(we){const t=this.rules.block.def.exec(we);if(t)return t[3]&&(t[3]=t[3].substring(1,t[3].length-1)),{type:"def",tag:t[1].toLowerCase().replace(/\s+/g," "),raw:t[0],href:t[2],title:t[3]}}table(we){const t=this.rules.block.table.exec(we);if(t){const te={type:"table",header:splitCells(t[1]).map(be=>({text:be})),align:t[2].replace(/^ *|\| *$/g,"").split(/ *\| */),rows:t[3]&&t[3].trim()?t[3].replace(/\n[ \t]*$/,"").split(`
`):[]};if(te.header.length===te.align.length){te.raw=t[0];let be=te.align.length,xe,ve,ke,Ie;for(xe=0;xe<be;xe++)/^ *-+: *$/.test(te.align[xe])?te.align[xe]="right":/^ *:-+: *$/.test(te.align[xe])?te.align[xe]="center":/^ *:-+ *$/.test(te.align[xe])?te.align[xe]="left":te.align[xe]=null;for(be=te.rows.length,xe=0;xe<be;xe++)te.rows[xe]=splitCells(te.rows[xe],te.header.length).map(Ae=>({text:Ae}));for(be=te.header.length,ve=0;ve<be;ve++)te.header[ve].tokens=[],this.lexer.inlineTokens(te.header[ve].text,te.header[ve].tokens);for(be=te.rows.length,ve=0;ve<be;ve++)for(Ie=te.rows[ve],ke=0;ke<Ie.length;ke++)Ie[ke].tokens=[],this.lexer.inlineTokens(Ie[ke].text,Ie[ke].tokens);return te}}}lheading(we){const t=this.rules.block.lheading.exec(we);if(t){const te={type:"heading",raw:t[0],depth:t[2].charAt(0)==="="?1:2,text:t[1],tokens:[]};return this.lexer.inline(te.text,te.tokens),te}}paragraph(we){const t=this.rules.block.paragraph.exec(we);if(t){const te={type:"paragraph",raw:t[0],text:t[1].charAt(t[1].length-1)===`
`?t[1].slice(0,-1):t[1],tokens:[]};return this.lexer.inline(te.text,te.tokens),te}}text(we){const t=this.rules.block.text.exec(we);if(t){const te={type:"text",raw:t[0],text:t[0],tokens:[]};return this.lexer.inline(te.text,te.tokens),te}}escape(we){const t=this.rules.inline.escape.exec(we);if(t)return{type:"escape",raw:t[0],text:escape(t[1])}}tag(we){const t=this.rules.inline.tag.exec(we);if(t)return!this.lexer.state.inLink&&/^<a /i.test(t[0])?this.lexer.state.inLink=!0:this.lexer.state.inLink&&/^<\/a>/i.test(t[0])&&(this.lexer.state.inLink=!1),!this.lexer.state.inRawBlock&&/^<(pre|code|kbd|script)(\s|>)/i.test(t[0])?this.lexer.state.inRawBlock=!0:this.lexer.state.inRawBlock&&/^<\/(pre|code|kbd|script)(\s|>)/i.test(t[0])&&(this.lexer.state.inRawBlock=!1),{type:this.options.sanitize?"text":"html",raw:t[0],inLink:this.lexer.state.inLink,inRawBlock:this.lexer.state.inRawBlock,text:this.options.sanitize?this.options.sanitizer?this.options.sanitizer(t[0]):escape(t[0]):t[0]}}link(we){const t=this.rules.inline.link.exec(we);if(t){const te=t[2].trim();if(!this.options.pedantic&&/^</.test(te)){if(!/>$/.test(te))return;const ve=rtrim(te.slice(0,-1),"\\");if((te.length-ve.length)%2===0)return}else{const ve=findClosingBracket(t[2],"()");if(ve>-1){const Ie=(t[0].indexOf("!")===0?5:4)+t[1].length+ve;t[2]=t[2].substring(0,ve),t[0]=t[0].substring(0,Ie).trim(),t[3]=""}}let be=t[2],xe="";if(this.options.pedantic){const ve=/^([^'"]*[^\s])\s+(['"])(.*)\2/.exec(be);ve&&(be=ve[1],xe=ve[3])}else xe=t[3]?t[3].slice(1,-1):"";return be=be.trim(),/^</.test(be)&&(this.options.pedantic&&!/>$/.test(te)?be=be.slice(1):be=be.slice(1,-1)),outputLink(t,{href:be&&be.replace(this.rules.inline._escapes,"$1"),title:xe&&xe.replace(this.rules.inline._escapes,"$1")},t[0],this.lexer)}}reflink(we,t){let te;if((te=this.rules.inline.reflink.exec(we))||(te=this.rules.inline.nolink.exec(we))){let be=(te[2]||te[1]).replace(/\s+/g," ");if(be=t[be.toLowerCase()],!be||!be.href){const xe=te[0].charAt(0);return{type:"text",raw:xe,text:xe}}return outputLink(te,be,te[0],this.lexer)}}emStrong(we,t,te=""){let be=this.rules.inline.emStrong.lDelim.exec(we);if(!be||be[3]&&te.match(/[\p{L}\p{N}]/u))return;const xe=be[1]||be[2]||"";if(!xe||xe&&(te===""||this.rules.inline.punctuation.exec(te))){const ve=be[0].length-1;let ke,Ie,Ae=ve,Se=0;const Oe=be[0][0]==="*"?this.rules.inline.emStrong.rDelimAst:this.rules.inline.emStrong.rDelimUnd;for(Oe.lastIndex=0,t=t.slice(-1*we.length+ve);(be=Oe.exec(t))!=null;){if(ke=be[1]||be[2]||be[3]||be[4]||be[5]||be[6],!ke)continue;if(Ie=ke.length,be[3]||be[4]){Ae+=Ie;continue}else if((be[5]||be[6])&&ve%3&&!((ve+Ie)%3)){Se+=Ie;continue}if(Ae-=Ie,Ae>0)continue;if(Ie=Math.min(Ie,Ie+Ae+Se),Math.min(ve,Ie)%2){const Me=we.slice(1,ve+be.index+Ie);return{type:"em",raw:we.slice(0,ve+be.index+Ie+1),text:Me,tokens:this.lexer.inlineTokens(Me,[])}}const Ve=we.slice(2,ve+be.index+Ie-1);return{type:"strong",raw:we.slice(0,ve+be.index+Ie+1),text:Ve,tokens:this.lexer.inlineTokens(Ve,[])}}}}codespan(we){const t=this.rules.inline.code.exec(we);if(t){let te=t[2].replace(/\n/g," ");const be=/[^ ]/.test(te),xe=/^ /.test(te)&&/ $/.test(te);return be&&xe&&(te=te.substring(1,te.length-1)),te=escape(te,!0),{type:"codespan",raw:t[0],text:te}}}br(we){const t=this.rules.inline.br.exec(we);if(t)return{type:"br",raw:t[0]}}del(we){const t=this.rules.inline.del.exec(we);if(t)return{type:"del",raw:t[0],text:t[2],tokens:this.lexer.inlineTokens(t[2],[])}}autolink(we,t){const te=this.rules.inline.autolink.exec(we);if(te){let be,xe;return te[2]==="@"?(be=escape(this.options.mangle?t(te[1]):te[1]),xe="mailto:"+be):(be=escape(te[1]),xe=be),{type:"link",raw:te[0],text:be,href:xe,tokens:[{type:"text",raw:be,text:be}]}}}url(we,t){let te;if(te=this.rules.inline.url.exec(we)){let be,xe;if(te[2]==="@")be=escape(this.options.mangle?t(te[0]):te[0]),xe="mailto:"+be;else{let ve;do ve=te[0],te[0]=this.rules.inline._backpedal.exec(te[0])[0];while(ve!==te[0]);be=escape(te[0]),te[1]==="www."?xe="http://"+be:xe=be}return{type:"link",raw:te[0],text:be,href:xe,tokens:[{type:"text",raw:be,text:be}]}}}inlineText(we,t){const te=this.rules.inline.text.exec(we);if(te){let be;return this.lexer.state.inRawBlock?be=this.options.sanitize?this.options.sanitizer?this.options.sanitizer(te[0]):escape(te[0]):te[0]:be=escape(this.options.smartypants?t(te[0]):te[0]),{type:"text",raw:te[0],text:be}}}}const block={newline:/^(?: *(?:\n|$))+/,code:/^( {4}[^\n]+(?:\n(?: *(?:\n|$))*)?)+/,fences:/^ {0,3}(`{3,}(?=[^`\n]*\n)|~{3,})([^\n]*)\n(?:|([\s\S]*?)\n)(?: {0,3}\1[~`]* *(?=\n|$)|$)/,hr:/^ {0,3}((?:- *){3,}|(?:_ *){3,}|(?:\* *){3,})(?:\n+|$)/,heading:/^ {0,3}(#{1,6})(?=\s|$)(.*)(?:\n+|$)/,blockquote:/^( {0,3}> ?(paragraph|[^\n]*)(?:\n|$))+/,list:/^( {0,3}bull)( [^\n]+?)?(?:\n|$)/,html:"^ {0,3}(?:<(script|pre|style|textarea)[\\s>][\\s\\S]*?(?:</\\1>[^\\n]*\\n+|$)|comment[^\\n]*(\\n+|$)|<\\?[\\s\\S]*?(?:\\?>\\n*|$)|<![A-Z][\\s\\S]*?(?:>\\n*|$)|<!\\[CDATA\\[[\\s\\S]*?(?:\\]\\]>\\n*|$)|</?(tag)(?: +|\\n|/?>)[\\s\\S]*?(?:(?:\\n *)+\\n|$)|<(?!script|pre|style|textarea)([a-z][\\w-]*)(?:attribute)*? */?>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n *)+\\n|$)|</(?!script|pre|style|textarea)[a-z][\\w-]*\\s*>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n *)+\\n|$))",def:/^ {0,3}\[(label)\]: *(?:\n *)?<?([^\s>]+)>?(?:(?: +(?:\n *)?| *\n *)(title))? *(?:\n+|$)/,table:noopTest,lheading:/^([^\n]+)\n {0,3}(=+|-+) *(?:\n+|$)/,_paragraph:/^([^\n]+(?:\n(?!hr|heading|lheading|blockquote|fences|list|html|table| +\n)[^\n]+)*)/,text:/^[^\n]+/};block._label=/(?!\s*\])(?:\\.|[^\[\]\\])+/;block._title=/(?:"(?:\\"?|[^"\\])*"|'[^'\n]*(?:\n[^'\n]+)*\n?'|\([^()]*\))/;block.def=edit(block.def).replace("label",block._label).replace("title",block._title).getRegex();block.bullet=/(?:[*+-]|\d{1,9}[.)])/;block.listItemStart=edit(/^( *)(bull) */).replace("bull",block.bullet).getRegex();block.list=edit(block.list).replace(/bull/g,block.bullet).replace("hr","\\n+(?=\\1?(?:(?:- *){3,}|(?:_ *){3,}|(?:\\* *){3,})(?:\\n+|$))").replace("def","\\n+(?="+block.def.source+")").getRegex();block._tag="address|article|aside|base|basefont|blockquote|body|caption|center|col|colgroup|dd|details|dialog|dir|div|dl|dt|fieldset|figcaption|figure|footer|form|frame|frameset|h[1-6]|head|header|hr|html|iframe|legend|li|link|main|menu|menuitem|meta|nav|noframes|ol|optgroup|option|p|param|section|source|summary|table|tbody|td|tfoot|th|thead|title|tr|track|ul";block._comment=/<!--(?!-?>)[\s\S]*?(?:-->|$)/;block.html=edit(block.html,"i").replace("comment",block._comment).replace("tag",block._tag).replace("attribute",/ +[a-zA-Z:_][\w.:-]*(?: *= *"[^"\n]*"| *= *'[^'\n]*'| *= *[^\s"'=<>`]+)?/).getRegex();block.paragraph=edit(block._paragraph).replace("hr",block.hr).replace("heading"," {0,3}#{1,6} ").replace("|lheading","").replace("|table","").replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",block._tag).getRegex();block.blockquote=edit(block.blockquote).replace("paragraph",block.paragraph).getRegex();block.normal=merge({},block);block.gfm=merge({},block.normal,{table:"^ *([^\\n ].*\\|.*)\\n {0,3}(?:\\| *)?(:?-+:? *(?:\\| *:?-+:? *)*)(?:\\| *)?(?:\\n((?:(?! *\\n|hr|heading|blockquote|code|fences|list|html).*(?:\\n|$))*)\\n*|$)"});block.gfm.table=edit(block.gfm.table).replace("hr",block.hr).replace("heading"," {0,3}#{1,6} ").replace("blockquote"," {0,3}>").replace("code"," {4}[^\\n]").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",block._tag).getRegex();block.gfm.paragraph=edit(block._paragraph).replace("hr",block.hr).replace("heading"," {0,3}#{1,6} ").replace("|lheading","").replace("table",block.gfm.table).replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",block._tag).getRegex();block.pedantic=merge({},block.normal,{html:edit(`^ *(?:comment *(?:\\n|\\s*$)|<(tag)[\\s\\S]+?</\\1> *(?:\\n{2,}|\\s*$)|<tag(?:"[^"]*"|'[^']*'|\\s[^'"/>\\s]*)*?/?> *(?:\\n{2,}|\\s*$))`).replace("comment",block._comment).replace(/tag/g,"(?!(?:a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)\\b)\\w+(?!:|[^\\w\\s@]*@)\\b").getRegex(),def:/^ *\[([^\]]+)\]: *<?([^\s>]+)>?(?: +(["(][^\n]+[")]))? *(?:\n+|$)/,heading:/^(#{1,6})(.*)(?:\n+|$)/,fences:noopTest,paragraph:edit(block.normal._paragraph).replace("hr",block.hr).replace("heading",` *#{1,6} *[^
]`).replace("lheading",block.lheading).replace("blockquote"," {0,3}>").replace("|fences","").replace("|list","").replace("|html","").getRegex()});const inline={escape:/^\\([!"#$%&'()*+,\-./:;<=>?@\[\]\\^_`{|}~])/,autolink:/^<(scheme:[^\s\x00-\x1f<>]*|email)>/,url:noopTest,tag:"^comment|^</[a-zA-Z][\\w:-]*\\s*>|^<[a-zA-Z][\\w-]*(?:attribute)*?\\s*/?>|^<\\?[\\s\\S]*?\\?>|^<![a-zA-Z]+\\s[\\s\\S]*?>|^<!\\[CDATA\\[[\\s\\S]*?\\]\\]>",link:/^!?\[(label)\]\(\s*(href)(?:\s+(title))?\s*\)/,reflink:/^!?\[(label)\]\[(ref)\]/,nolink:/^!?\[(ref)\](?:\[\])?/,reflinkSearch:"reflink|nolink(?!\\()",emStrong:{lDelim:/^(?:\*+(?:([punct_])|[^\s*]))|^_+(?:([punct*])|([^\s_]))/,rDelimAst:/^[^_*]*?\_\_[^_*]*?\*[^_*]*?(?=\_\_)|[punct_](\*+)(?=[\s]|$)|[^punct*_\s](\*+)(?=[punct_\s]|$)|[punct_\s](\*+)(?=[^punct*_\s])|[\s](\*+)(?=[punct_])|[punct_](\*+)(?=[punct_])|[^punct*_\s](\*+)(?=[^punct*_\s])/,rDelimUnd:/^[^_*]*?\*\*[^_*]*?\_[^_*]*?(?=\*\*)|[punct*](\_+)(?=[\s]|$)|[^punct*_\s](\_+)(?=[punct*\s]|$)|[punct*\s](\_+)(?=[^punct*_\s])|[\s](\_+)(?=[punct*])|[punct*](\_+)(?=[punct*])/},code:/^(`+)([^`]|[^`][\s\S]*?[^`])\1(?!`)/,br:/^( {2,}|\\)\n(?!\s*$)/,del:noopTest,text:/^(`+|[^`])(?:(?= {2,}\n)|[\s\S]*?(?:(?=[\\<!\[`*_]|\b_|$)|[^ ](?= {2,}\n)))/,punctuation:/^([\spunctuation])/};inline._punctuation="!\"#$%&'()+\\-.,/:;<=>?@\\[\\]`^{|}~";inline.punctuation=edit(inline.punctuation).replace(/punctuation/g,inline._punctuation).getRegex();inline.blockSkip=/\[[^\]]*?\]\([^\)]*?\)|`[^`]*?`|<[^>]*?>/g;inline.escapedEmSt=/\\\*|\\_/g;inline._comment=edit(block._comment).replace("(?:-->|$)","-->").getRegex();inline.emStrong.lDelim=edit(inline.emStrong.lDelim).replace(/punct/g,inline._punctuation).getRegex();inline.emStrong.rDelimAst=edit(inline.emStrong.rDelimAst,"g").replace(/punct/g,inline._punctuation).getRegex();inline.emStrong.rDelimUnd=edit(inline.emStrong.rDelimUnd,"g").replace(/punct/g,inline._punctuation).getRegex();inline._escapes=/\\([!"#$%&'()*+,\-./:;<=>?@\[\]\\^_`{|}~])/g;inline._scheme=/[a-zA-Z][a-zA-Z0-9+.-]{1,31}/;inline._email=/[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+(@)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+(?![-_])/;inline.autolink=edit(inline.autolink).replace("scheme",inline._scheme).replace("email",inline._email).getRegex();inline._attribute=/\s+[a-zA-Z:_][\w.:-]*(?:\s*=\s*"[^"]*"|\s*=\s*'[^']*'|\s*=\s*[^\s"'=<>`]+)?/;inline.tag=edit(inline.tag).replace("comment",inline._comment).replace("attribute",inline._attribute).getRegex();inline._label=/(?:\[(?:\\.|[^\[\]\\])*\]|\\.|`[^`]*`|[^\[\]\\`])*?/;inline._href=/<(?:\\.|[^\n<>\\])+>|[^\s\x00-\x1f]*/;inline._title=/"(?:\\"?|[^"\\])*"|'(?:\\'?|[^'\\])*'|\((?:\\\)?|[^)\\])*\)/;inline.link=edit(inline.link).replace("label",inline._label).replace("href",inline._href).replace("title",inline._title).getRegex();inline.reflink=edit(inline.reflink).replace("label",inline._label).replace("ref",block._label).getRegex();inline.nolink=edit(inline.nolink).replace("ref",block._label).getRegex();inline.reflinkSearch=edit(inline.reflinkSearch,"g").replace("reflink",inline.reflink).replace("nolink",inline.nolink).getRegex();inline.normal=merge({},inline);inline.pedantic=merge({},inline.normal,{strong:{start:/^__|\*\*/,middle:/^__(?=\S)([\s\S]*?\S)__(?!_)|^\*\*(?=\S)([\s\S]*?\S)\*\*(?!\*)/,endAst:/\*\*(?!\*)/g,endUnd:/__(?!_)/g},em:{start:/^_|\*/,middle:/^()\*(?=\S)([\s\S]*?\S)\*(?!\*)|^_(?=\S)([\s\S]*?\S)_(?!_)/,endAst:/\*(?!\*)/g,endUnd:/_(?!_)/g},link:edit(/^!?\[(label)\]\((.*?)\)/).replace("label",inline._label).getRegex(),reflink:edit(/^!?\[(label)\]\s*\[([^\]]*)\]/).replace("label",inline._label).getRegex()});inline.gfm=merge({},inline.normal,{escape:edit(inline.escape).replace("])","~|])").getRegex(),_extended_email:/[A-Za-z0-9._+-]+(@)[a-zA-Z0-9-_]+(?:\.[a-zA-Z0-9-_]*[a-zA-Z0-9])+(?![-_])/,url:/^((?:ftp|https?):\/\/|www\.)(?:[a-zA-Z0-9\-]+\.?)+[^\s<]*|^email/,_backpedal:/(?:[^?!.,:;*_~()&]+|\([^)]*\)|&(?![a-zA-Z0-9]+;$)|[?!.,:;*_~)]+(?!$))+/,del:/^(~~?)(?=[^\s~])([\s\S]*?[^\s~])\1(?=[^~]|$)/,text:/^([`~]+|[^`~])(?:(?= {2,}\n)|(?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)|[\s\S]*?(?:(?=[\\<!\[`*~_]|\b_|https?:\/\/|ftp:\/\/|www\.|$)|[^ ](?= {2,}\n)|[^a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-](?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)))/});inline.gfm.url=edit(inline.gfm.url,"i").replace("email",inline.gfm._extended_email).getRegex();inline.breaks=merge({},inline.gfm,{br:edit(inline.br).replace("{2,}","*").getRegex(),text:edit(inline.gfm.text).replace("\\b_","\\b_| {2,}\\n").replace(/\{2,\}/g,"*").getRegex()});function smartypants(Te){return Te.replace(/---/g,"—").replace(/--/g,"–").replace(/(^|[-\u2014/(\[{"\s])'/g,"$1‘").replace(/'/g,"’").replace(/(^|[-\u2014/(\[{\u2018\s])"/g,"$1“").replace(/"/g,"”").replace(/\.{3}/g,"…")}function mangle(Te){let we="",t,te;const be=Te.length;for(t=0;t<be;t++)te=Te.charCodeAt(t),Math.random()>.5&&(te="x"+te.toString(16)),we+="&#"+te+";";return we}class Lexer{constructor(we){this.tokens=[],this.tokens.links=Object.create(null),this.options=we||defaults,this.options.tokenizer=this.options.tokenizer||new Tokenizer,this.tokenizer=this.options.tokenizer,this.tokenizer.options=this.options,this.tokenizer.lexer=this,this.inlineQueue=[],this.state={inLink:!1,inRawBlock:!1,top:!0};const t={block:block.normal,inline:inline.normal};this.options.pedantic?(t.block=block.pedantic,t.inline=inline.pedantic):this.options.gfm&&(t.block=block.gfm,this.options.breaks?t.inline=inline.breaks:t.inline=inline.gfm),this.tokenizer.rules=t}static get rules(){return{block,inline}}static lex(we,t){return new Lexer(t).lex(we)}static lexInline(we,t){return new Lexer(t).inlineTokens(we)}lex(we){we=we.replace(/\r\n|\r/g,`
`).replace(/\t/g,"    "),this.blockTokens(we,this.tokens);let t;for(;t=this.inlineQueue.shift();)this.inlineTokens(t.src,t.tokens);return this.tokens}blockTokens(we,t=[]){this.options.pedantic&&(we=we.replace(/^ +$/gm,""));let te,be,xe,ve;for(;we;)if(!(this.options.extensions&&this.options.extensions.block&&this.options.extensions.block.some(ke=>(te=ke.call({lexer:this},we,t))?(we=we.substring(te.raw.length),t.push(te),!0):!1))){if(te=this.tokenizer.space(we)){we=we.substring(te.raw.length),te.raw.length===1&&t.length>0?t[t.length-1].raw+=`
`:t.push(te);continue}if(te=this.tokenizer.code(we)){we=we.substring(te.raw.length),be=t[t.length-1],be&&(be.type==="paragraph"||be.type==="text")?(be.raw+=`
`+te.raw,be.text+=`
`+te.text,this.inlineQueue[this.inlineQueue.length-1].src=be.text):t.push(te);continue}if(te=this.tokenizer.fences(we)){we=we.substring(te.raw.length),t.push(te);continue}if(te=this.tokenizer.heading(we)){we=we.substring(te.raw.length),t.push(te);continue}if(te=this.tokenizer.hr(we)){we=we.substring(te.raw.length),t.push(te);continue}if(te=this.tokenizer.blockquote(we)){we=we.substring(te.raw.length),t.push(te);continue}if(te=this.tokenizer.list(we)){we=we.substring(te.raw.length),t.push(te);continue}if(te=this.tokenizer.html(we)){we=we.substring(te.raw.length),t.push(te);continue}if(te=this.tokenizer.def(we)){we=we.substring(te.raw.length),be=t[t.length-1],be&&(be.type==="paragraph"||be.type==="text")?(be.raw+=`
`+te.raw,be.text+=`
`+te.raw,this.inlineQueue[this.inlineQueue.length-1].src=be.text):this.tokens.links[te.tag]||(this.tokens.links[te.tag]={href:te.href,title:te.title});continue}if(te=this.tokenizer.table(we)){we=we.substring(te.raw.length),t.push(te);continue}if(te=this.tokenizer.lheading(we)){we=we.substring(te.raw.length),t.push(te);continue}if(xe=we,this.options.extensions&&this.options.extensions.startBlock){let ke=1/0;const Ie=we.slice(1);let Ae;this.options.extensions.startBlock.forEach(function(Se){Ae=Se.call({lexer:this},Ie),typeof Ae=="number"&&Ae>=0&&(ke=Math.min(ke,Ae))}),ke<1/0&&ke>=0&&(xe=we.substring(0,ke+1))}if(this.state.top&&(te=this.tokenizer.paragraph(xe))){be=t[t.length-1],ve&&be.type==="paragraph"?(be.raw+=`
`+te.raw,be.text+=`
`+te.text,this.inlineQueue.pop(),this.inlineQueue[this.inlineQueue.length-1].src=be.text):t.push(te),ve=xe.length!==we.length,we=we.substring(te.raw.length);continue}if(te=this.tokenizer.text(we)){we=we.substring(te.raw.length),be=t[t.length-1],be&&be.type==="text"?(be.raw+=`
`+te.raw,be.text+=`
`+te.text,this.inlineQueue.pop(),this.inlineQueue[this.inlineQueue.length-1].src=be.text):t.push(te);continue}if(we){const ke="Infinite loop on byte: "+we.charCodeAt(0);if(this.options.silent){console.error(ke);break}else throw new Error(ke)}}return this.state.top=!0,t}inline(we,t){this.inlineQueue.push({src:we,tokens:t})}inlineTokens(we,t=[]){let te,be,xe,ve=we,ke,Ie,Ae;if(this.tokens.links){const Se=Object.keys(this.tokens.links);if(Se.length>0)for(;(ke=this.tokenizer.rules.inline.reflinkSearch.exec(ve))!=null;)Se.includes(ke[0].slice(ke[0].lastIndexOf("[")+1,-1))&&(ve=ve.slice(0,ke.index)+"["+repeatString("a",ke[0].length-2)+"]"+ve.slice(this.tokenizer.rules.inline.reflinkSearch.lastIndex))}for(;(ke=this.tokenizer.rules.inline.blockSkip.exec(ve))!=null;)ve=ve.slice(0,ke.index)+"["+repeatString("a",ke[0].length-2)+"]"+ve.slice(this.tokenizer.rules.inline.blockSkip.lastIndex);for(;(ke=this.tokenizer.rules.inline.escapedEmSt.exec(ve))!=null;)ve=ve.slice(0,ke.index)+"++"+ve.slice(this.tokenizer.rules.inline.escapedEmSt.lastIndex);for(;we;)if(Ie||(Ae=""),Ie=!1,!(this.options.extensions&&this.options.extensions.inline&&this.options.extensions.inline.some(Se=>(te=Se.call({lexer:this},we,t))?(we=we.substring(te.raw.length),t.push(te),!0):!1))){if(te=this.tokenizer.escape(we)){we=we.substring(te.raw.length),t.push(te);continue}if(te=this.tokenizer.tag(we)){we=we.substring(te.raw.length),be=t[t.length-1],be&&te.type==="text"&&be.type==="text"?(be.raw+=te.raw,be.text+=te.text):t.push(te);continue}if(te=this.tokenizer.link(we)){we=we.substring(te.raw.length),t.push(te);continue}if(te=this.tokenizer.reflink(we,this.tokens.links)){we=we.substring(te.raw.length),be=t[t.length-1],be&&te.type==="text"&&be.type==="text"?(be.raw+=te.raw,be.text+=te.text):t.push(te);continue}if(te=this.tokenizer.emStrong(we,ve,Ae)){we=we.substring(te.raw.length),t.push(te);continue}if(te=this.tokenizer.codespan(we)){we=we.substring(te.raw.length),t.push(te);continue}if(te=this.tokenizer.br(we)){we=we.substring(te.raw.length),t.push(te);continue}if(te=this.tokenizer.del(we)){we=we.substring(te.raw.length),t.push(te);continue}if(te=this.tokenizer.autolink(we,mangle)){we=we.substring(te.raw.length),t.push(te);continue}if(!this.state.inLink&&(te=this.tokenizer.url(we,mangle))){we=we.substring(te.raw.length),t.push(te);continue}if(xe=we,this.options.extensions&&this.options.extensions.startInline){let Se=1/0;const Oe=we.slice(1);let Ve;this.options.extensions.startInline.forEach(function(Me){Ve=Me.call({lexer:this},Oe),typeof Ve=="number"&&Ve>=0&&(Se=Math.min(Se,Ve))}),Se<1/0&&Se>=0&&(xe=we.substring(0,Se+1))}if(te=this.tokenizer.inlineText(xe,smartypants)){we=we.substring(te.raw.length),te.raw.slice(-1)!=="_"&&(Ae=te.raw.slice(-1)),Ie=!0,be=t[t.length-1],be&&be.type==="text"?(be.raw+=te.raw,be.text+=te.text):t.push(te);continue}if(we){const Se="Infinite loop on byte: "+we.charCodeAt(0);if(this.options.silent){console.error(Se);break}else throw new Error(Se)}}return t}}class Renderer{constructor(we){this.options=we||defaults}code(we,t,te){const be=(t||"").match(/\S*/)[0];if(this.options.highlight){const xe=this.options.highlight(we,be);xe!=null&&xe!==we&&(te=!0,we=xe)}return we=we.replace(/\n$/,"")+`
`,be?'<pre><code class="'+this.options.langPrefix+escape(be,!0)+'">'+(te?we:escape(we,!0))+`</code></pre>
`:"<pre><code>"+(te?we:escape(we,!0))+`</code></pre>
`}blockquote(we){return`<blockquote>
`+we+`</blockquote>
`}html(we){return we}heading(we,t,te,be){return this.options.headerIds?"<h"+t+' id="'+this.options.headerPrefix+be.slug(te)+'">'+we+"</h"+t+`>
`:"<h"+t+">"+we+"</h"+t+`>
`}hr(){return this.options.xhtml?`<hr/>
`:`<hr>
`}list(we,t,te){const be=t?"ol":"ul",xe=t&&te!==1?' start="'+te+'"':"";return"<"+be+xe+`>
`+we+"</"+be+`>
`}listitem(we){return"<li>"+we+`</li>
`}checkbox(we){return"<input "+(we?'checked="" ':"")+'disabled="" type="checkbox"'+(this.options.xhtml?" /":"")+"> "}paragraph(we){return"<p>"+we+`</p>
`}table(we,t){return t&&(t="<tbody>"+t+"</tbody>"),`<table>
<thead>
`+we+`</thead>
`+t+`</table>
`}tablerow(we){return`<tr>
`+we+`</tr>
`}tablecell(we,t){const te=t.header?"th":"td";return(t.align?"<"+te+' align="'+t.align+'">':"<"+te+">")+we+"</"+te+`>
`}strong(we){return"<strong>"+we+"</strong>"}em(we){return"<em>"+we+"</em>"}codespan(we){return"<code>"+we+"</code>"}br(){return this.options.xhtml?"<br/>":"<br>"}del(we){return"<del>"+we+"</del>"}link(we,t,te){if(we=cleanUrl(this.options.sanitize,this.options.baseUrl,we),we===null)return te;let be='<a href="'+escape(we)+'"';return t&&(be+=' title="'+t+'"'),be+=">"+te+"</a>",be}image(we,t,te){if(we=cleanUrl(this.options.sanitize,this.options.baseUrl,we),we===null)return te;let be='<img src="'+we+'" alt="'+te+'"';return t&&(be+=' title="'+t+'"'),be+=this.options.xhtml?"/>":">",be}text(we){return we}}class TextRenderer{strong(we){return we}em(we){return we}codespan(we){return we}del(we){return we}html(we){return we}text(we){return we}link(we,t,te){return""+te}image(we,t,te){return""+te}br(){return""}}class Slugger{constructor(){this.seen={}}serialize(we){return we.toLowerCase().trim().replace(/<[!\/a-z].*?>/ig,"").replace(/[\u2000-\u206F\u2E00-\u2E7F\\'!"#$%&()*+,./:;<=>?@[\]^`{|}~]/g,"").replace(/\s/g,"-")}getNextSafeSlug(we,t){let te=we,be=0;if(this.seen.hasOwnProperty(te)){be=this.seen[we];do be++,te=we+"-"+be;while(this.seen.hasOwnProperty(te))}return t||(this.seen[we]=be,this.seen[te]=0),te}slug(we,t={}){const te=this.serialize(we);return this.getNextSafeSlug(te,t.dryrun)}}class Parser{constructor(we){this.options=we||defaults,this.options.renderer=this.options.renderer||new Renderer,this.renderer=this.options.renderer,this.renderer.options=this.options,this.textRenderer=new TextRenderer,this.slugger=new Slugger}static parse(we,t){return new Parser(t).parse(we)}static parseInline(we,t){return new Parser(t).parseInline(we)}parse(we,t=!0){let te="",be,xe,ve,ke,Ie,Ae,Se,Oe,Ve,Me,De,Fe,Be,$e,Ue,He,ze,qe,Ke;const Qe=we.length;for(be=0;be<Qe;be++){if(Me=we[be],this.options.extensions&&this.options.extensions.renderers&&this.options.extensions.renderers[Me.type]&&(Ke=this.options.extensions.renderers[Me.type].call({parser:this},Me),Ke!==!1||!["space","hr","heading","code","table","blockquote","list","html","paragraph","text"].includes(Me.type))){te+=Ke||"";continue}switch(Me.type){case"space":continue;case"hr":{te+=this.renderer.hr();continue}case"heading":{te+=this.renderer.heading(this.parseInline(Me.tokens),Me.depth,unescape$1(this.parseInline(Me.tokens,this.textRenderer)),this.slugger);continue}case"code":{te+=this.renderer.code(Me.text,Me.lang,Me.escaped);continue}case"table":{for(Oe="",Se="",ke=Me.header.length,xe=0;xe<ke;xe++)Se+=this.renderer.tablecell(this.parseInline(Me.header[xe].tokens),{header:!0,align:Me.align[xe]});for(Oe+=this.renderer.tablerow(Se),Ve="",ke=Me.rows.length,xe=0;xe<ke;xe++){for(Ae=Me.rows[xe],Se="",Ie=Ae.length,ve=0;ve<Ie;ve++)Se+=this.renderer.tablecell(this.parseInline(Ae[ve].tokens),{header:!1,align:Me.align[ve]});Ve+=this.renderer.tablerow(Se)}te+=this.renderer.table(Oe,Ve);continue}case"blockquote":{Ve=this.parse(Me.tokens),te+=this.renderer.blockquote(Ve);continue}case"list":{for(De=Me.ordered,Fe=Me.start,Be=Me.loose,ke=Me.items.length,Ve="",xe=0;xe<ke;xe++)Ue=Me.items[xe],He=Ue.checked,ze=Ue.task,$e="",Ue.task&&(qe=this.renderer.checkbox(He),Be?Ue.tokens.length>0&&Ue.tokens[0].type==="paragraph"?(Ue.tokens[0].text=qe+" "+Ue.tokens[0].text,Ue.tokens[0].tokens&&Ue.tokens[0].tokens.length>0&&Ue.tokens[0].tokens[0].type==="text"&&(Ue.tokens[0].tokens[0].text=qe+" "+Ue.tokens[0].tokens[0].text)):Ue.tokens.unshift({type:"text",text:qe}):$e+=qe),$e+=this.parse(Ue.tokens,Be),Ve+=this.renderer.listitem($e,ze,He);te+=this.renderer.list(Ve,De,Fe);continue}case"html":{te+=this.renderer.html(Me.text);continue}case"paragraph":{te+=this.renderer.paragraph(this.parseInline(Me.tokens));continue}case"text":{for(Ve=Me.tokens?this.parseInline(Me.tokens):Me.text;be+1<Qe&&we[be+1].type==="text";)Me=we[++be],Ve+=`
`+(Me.tokens?this.parseInline(Me.tokens):Me.text);te+=t?this.renderer.paragraph(Ve):Ve;continue}default:{const je='Token with "'+Me.type+'" type was not found.';if(this.options.silent){console.error(je);return}else throw new Error(je)}}}return te}parseInline(we,t){t=t||this.renderer;let te="",be,xe,ve;const ke=we.length;for(be=0;be<ke;be++){if(xe=we[be],this.options.extensions&&this.options.extensions.renderers&&this.options.extensions.renderers[xe.type]&&(ve=this.options.extensions.renderers[xe.type].call({parser:this},xe),ve!==!1||!["escape","html","link","image","strong","em","codespan","br","del","text"].includes(xe.type))){te+=ve||"";continue}switch(xe.type){case"escape":{te+=t.text(xe.text);break}case"html":{te+=t.html(xe.text);break}case"link":{te+=t.link(xe.href,xe.title,this.parseInline(xe.tokens,t));break}case"image":{te+=t.image(xe.href,xe.title,xe.text);break}case"strong":{te+=t.strong(this.parseInline(xe.tokens,t));break}case"em":{te+=t.em(this.parseInline(xe.tokens,t));break}case"codespan":{te+=t.codespan(xe.text);break}case"br":{te+=t.br();break}case"del":{te+=t.del(this.parseInline(xe.tokens,t));break}case"text":{te+=t.text(xe.text);break}default:{const Ie='Token with "'+xe.type+'" type was not found.';if(this.options.silent){console.error(Ie);return}else throw new Error(Ie)}}}return te}}function marked(Te,we,t){if(typeof Te>"u"||Te===null)throw new Error("marked(): input parameter is undefined or null");if(typeof Te!="string")throw new Error("marked(): input parameter is of type "+Object.prototype.toString.call(Te)+", string expected");if(typeof we=="function"&&(t=we,we=null),we=merge({},marked.defaults,we||{}),checkSanitizeDeprecation(we),t){const te=we.highlight;let be;try{be=Lexer.lex(Te,we)}catch(ke){return t(ke)}const xe=function(ke){let Ie;if(!ke)try{we.walkTokens&&marked.walkTokens(be,we.walkTokens),Ie=Parser.parse(be,we)}catch(Ae){ke=Ae}return we.highlight=te,ke?t(ke):t(null,Ie)};if(!te||te.length<3||(delete we.highlight,!be.length))return xe();let ve=0;marked.walkTokens(be,function(ke){ke.type==="code"&&(ve++,setTimeout(()=>{te(ke.text,ke.lang,function(Ie,Ae){if(Ie)return xe(Ie);Ae!=null&&Ae!==ke.text&&(ke.text=Ae,ke.escaped=!0),ve--,ve===0&&xe()})},0))}),ve===0&&xe();return}try{const te=Lexer.lex(Te,we);return we.walkTokens&&marked.walkTokens(te,we.walkTokens),Parser.parse(te,we)}catch(te){if(te.message+=`
Please report this to https://github.com/markedjs/marked.`,we.silent)return"<p>An error occurred:</p><pre>"+escape(te.message+"",!0)+"</pre>";throw te}}marked.options=marked.setOptions=function(Te){return merge(marked.defaults,Te),changeDefaults(marked.defaults),marked};marked.getDefaults=getDefaults;marked.defaults=defaults;marked.use=function(...Te){const we=merge({},...Te),t=marked.defaults.extensions||{renderers:{},childTokens:{}};let te;Te.forEach(be=>{if(be.extensions&&(te=!0,be.extensions.forEach(xe=>{if(!xe.name)throw new Error("extension name required");if(xe.renderer){const ve=t.renderers?t.renderers[xe.name]:null;ve?t.renderers[xe.name]=function(...ke){let Ie=xe.renderer.apply(this,ke);return Ie===!1&&(Ie=ve.apply(this,ke)),Ie}:t.renderers[xe.name]=xe.renderer}if(xe.tokenizer){if(!xe.level||xe.level!=="block"&&xe.level!=="inline")throw new Error("extension level must be 'block' or 'inline'");t[xe.level]?t[xe.level].unshift(xe.tokenizer):t[xe.level]=[xe.tokenizer],xe.start&&(xe.level==="block"?t.startBlock?t.startBlock.push(xe.start):t.startBlock=[xe.start]:xe.level==="inline"&&(t.startInline?t.startInline.push(xe.start):t.startInline=[xe.start]))}xe.childTokens&&(t.childTokens[xe.name]=xe.childTokens)})),be.renderer){const xe=marked.defaults.renderer||new Renderer;for(const ve in be.renderer){const ke=xe[ve];xe[ve]=(...Ie)=>{let Ae=be.renderer[ve].apply(xe,Ie);return Ae===!1&&(Ae=ke.apply(xe,Ie)),Ae}}we.renderer=xe}if(be.tokenizer){const xe=marked.defaults.tokenizer||new Tokenizer;for(const ve in be.tokenizer){const ke=xe[ve];xe[ve]=(...Ie)=>{let Ae=be.tokenizer[ve].apply(xe,Ie);return Ae===!1&&(Ae=ke.apply(xe,Ie)),Ae}}we.tokenizer=xe}if(be.walkTokens){const xe=marked.defaults.walkTokens;we.walkTokens=function(ve){be.walkTokens.call(this,ve),xe&&xe.call(this,ve)}}te&&(we.extensions=t),marked.setOptions(we)})};marked.walkTokens=function(Te,we){for(const t of Te)switch(we.call(marked,t),t.type){case"table":{for(const te of t.header)marked.walkTokens(te.tokens,we);for(const te of t.rows)for(const be of te)marked.walkTokens(be.tokens,we);break}case"list":{marked.walkTokens(t.items,we);break}default:marked.defaults.extensions&&marked.defaults.extensions.childTokens&&marked.defaults.extensions.childTokens[t.type]?marked.defaults.extensions.childTokens[t.type].forEach(function(te){marked.walkTokens(t[te],we)}):t.tokens&&marked.walkTokens(t.tokens,we)}};marked.parseInline=function(Te,we){if(typeof Te>"u"||Te===null)throw new Error("marked.parseInline(): input parameter is undefined or null");if(typeof Te!="string")throw new Error("marked.parseInline(): input parameter is of type "+Object.prototype.toString.call(Te)+", string expected");we=merge({},marked.defaults,we||{}),checkSanitizeDeprecation(we);try{const t=Lexer.lexInline(Te,we);return we.walkTokens&&marked.walkTokens(t,we.walkTokens),Parser.parseInline(t,we)}catch(t){if(t.message+=`
Please report this to https://github.com/markedjs/marked.`,we.silent)return"<p>An error occurred:</p><pre>"+escape(t.message+"",!0)+"</pre>";throw t}};marked.Parser=Parser;marked.parser=Parser.parse;marked.Renderer=Renderer;marked.TextRenderer=TextRenderer;marked.Lexer=Lexer;marked.lexer=Lexer.lex;marked.Tokenizer=Tokenizer;marked.Slugger=Slugger;marked.parse=marked;marked.options;marked.setOptions;marked.use;marked.walkTokens;marked.parseInline;Parser.parse;Lexer.lex;var root=typeof window<"u"?window:{};function canParseHTMLNatively(){var Te=root.DOMParser,we=!1;try{new Te().parseFromString("","text/html")&&(we=!0)}catch{}return we}function createHTMLParser(){var Te=function(){};return shouldUseActiveX()?Te.prototype.parseFromString=function(we){var t=new window.ActiveXObject("htmlfile");return t.designMode="on",t.open(),t.write(we),t.close(),t}:Te.prototype.parseFromString=function(we){var t=document.implementation.createHTMLDocument("");return t.open(),t.write(we),t.close(),t},Te}function shouldUseActiveX(){var Te=!1;try{document.implementation.createHTMLDocument("").open()}catch{root.ActiveXObject&&(Te=!0)}return Te}canParseHTMLNatively()?root.DOMParser:createHTMLParser();/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const BRACKET_PAIRS={"(":")","[":"]","{":"}"};class MentionCommand extends Command{constructor(we){super(we),this._isEnabledBasedOnSelection=!1}refresh(){const we=this.editor.model,t=we.document;this.isEnabled=we.schema.checkAttributeInSelection(t.selection,"mention")}execute(we){const t=this.editor.model,be=t.document.selection,xe=typeof we.mention=="string"?{id:we.mention}:we.mention,ve=xe.id,ke=we.range||be.getFirstRange();if(!t.canEditAt(ke))return;const Ie=we.text||ve,Ae=_addMentionAttributes({_text:Ie,id:ve},xe);if(we.marker.length!=1)throw new CKEditorError("mentioncommand-incorrect-marker",this);if(ve.charAt(0)!=we.marker)throw new CKEditorError("mentioncommand-incorrect-id",this);t.change(Se=>{const Oe=toMap(be.getAttributes()),Ve=new Map(Oe.entries());Ve.set("mention",Ae);const Me=t.insertContent(Se.createText(Ie,Ve),ke),De=Me.start.nodeBefore,Fe=Me.end.nodeAfter,Be=Fe&&Fe.is("$text")&&Fe.data.startsWith(" ");let $e=!1;if(De&&Fe&&De.is("$text")&&Fe.is("$text")){const Ue=De.data.slice(-1),He=Ue in BRACKET_PAIRS,ze=He&&Fe.data.startsWith(BRACKET_PAIRS[Ue]);$e=He&&ze}!$e&&!Be&&t.insertContent(Se.createText(" ",Oe),ke.start.getShiftedBy(Ie.length))})}}class MentionEditing extends Plugin{static get pluginName(){return"MentionEditing"}init(){const we=this.editor,t=we.model,te=t.document;t.schema.extend("$text",{allowAttributes:"mention"}),we.conversion.for("upcast").elementToAttribute({view:{name:"span",key:"data-mention",classes:"mention"},model:{key:"mention",value:be=>_toMentionAttribute(be)}}),we.conversion.for("downcast").attributeToElement({model:"mention",view:createViewMentionElement}),we.conversion.for("downcast").add(preventPartialMentionDowncast),te.registerPostFixer(be=>removePartialMentionPostFixer(be,te,t.schema)),te.registerPostFixer(be=>extendAttributeOnMentionPostFixer(be,te)),te.registerPostFixer(be=>selectionMentionAttributePostFixer(be,te)),we.commands.add("mention",new MentionCommand(we))}}function _addMentionAttributes(Te,we){return Object.assign({uid:uid()},Te,we||{})}function _toMentionAttribute(Te,we){const t=Te.getAttribute("data-mention"),te=Te.getChild(0);if(!te)return;const be={id:t,_text:te.data};return _addMentionAttributes(be,we)}function preventPartialMentionDowncast(Te){Te.on("attribute:mention",(we,t,te)=>{const be=t.attributeNewValue;if(!t.item.is("$textProxy")||!be)return;const xe=t.range.start;(xe.textNode||xe.nodeAfter).data!=be._text&&te.consumable.consume(t.item,we.name)},{priority:"highest"})}function createViewMentionElement(Te,{writer:we}){if(!Te)return;const t={class:"mention","data-mention":Te.id},te={id:Te.uid,priority:20};return we.createAttributeElement("span",t,te)}function selectionMentionAttributePostFixer(Te,we){const t=we.selection,te=t.focus;return t.isCollapsed&&t.hasAttribute("mention")&&shouldNotTypeWithMentionAt(te)?(Te.removeSelectionAttribute("mention"),!0):!1}function shouldNotTypeWithMentionAt(Te){const we=Te.isAtStart;return Te.nodeBefore&&Te.nodeBefore.is("$text")||we}function removePartialMentionPostFixer(Te,we,t){const te=we.differ.getChanges();let be=!1;for(const xe of te){if(xe.type=="attribute")continue;const ve=xe.position;if(xe.name=="$text"){const ke=ve.textNode&&ve.textNode.nextSibling;be=checkAndFix(ve.textNode,Te)||be,be=checkAndFix(ke,Te)||be,be=checkAndFix(ve.nodeBefore,Te)||be,be=checkAndFix(ve.nodeAfter,Te)||be}if(xe.name!="$text"&&xe.type=="insert"){const ke=ve.nodeAfter;for(const Ie of Te.createRangeIn(ke).getItems())be=checkAndFix(Ie,Te)||be}if(xe.type=="insert"&&t.isInline(xe.name)){const ke=ve.nodeAfter&&ve.nodeAfter.nextSibling;be=checkAndFix(ve.nodeBefore,Te)||be,be=checkAndFix(ke,Te)||be}}return be}function extendAttributeOnMentionPostFixer(Te,we){const t=we.differ.getChanges();let te=!1;for(const be of t)if(be.type==="attribute"&&be.attributeKey!="mention"){const xe=be.range.start.nodeBefore,ve=be.range.end.nodeAfter;for(const ke of[xe,ve])isBrokenMentionNode(ke)&&ke.getAttribute(be.attributeKey)!=be.attributeNewValue&&(Te.setAttribute(be.attributeKey,be.attributeNewValue,ke),te=!0)}return te}function isBrokenMentionNode(Te){if(!Te||!(Te.is("$text")||Te.is("$textProxy"))||!Te.hasAttribute("mention"))return!1;const we=Te.data,te=Te.getAttribute("mention")._text;return we!=te}function checkAndFix(Te,we){return isBrokenMentionNode(Te)?(we.removeAttribute("mention",Te),!0):!1}class MentionsView extends ListView{constructor(t){super(t);Re(this,"selected");Re(this,"position");this.extendTemplate({attributes:{class:["ck-mentions"],tabindex:"-1"}})}selectFirst(){this.select(0)}selectNext(){const t=this.selected,te=this.items.getIndex(t);this.select(te+1)}selectPrevious(){const t=this.selected,te=this.items.getIndex(t);this.select(te-1)}select(t){let te=0;t>0&&t<this.items.length?te=t:t<0&&(te=this.items.length-1);const be=this.items.get(te);this.selected!==be&&(this.selected&&this.selected.removeHighlight(),be.highlight(),this.selected=be,this._isItemVisibleInScrolledArea(be)||(this.element.scrollTop=be.element.offsetTop))}executeSelected(){this.selected.fire("execute")}_isItemVisibleInScrolledArea(t){return new Rect(this.element).contains(new Rect(t.element))}}class DomWrapperView extends View{constructor(t,te){super(t);Re(this,"domElement");this.template=void 0,this.domElement=te,this.domElement.classList.add("ck-button"),this.set("isOn",!1),this.on("change:isOn",(be,xe,ve)=>{ve?(this.domElement.classList.add("ck-on"),this.domElement.classList.remove("ck-off")):(this.domElement.classList.add("ck-off"),this.domElement.classList.remove("ck-on"))}),this.listenTo(this.domElement,"click",()=>{this.fire("execute")})}render(){super.render(),this.element=this.domElement}focus(){this.domElement.focus()}}class MentionListItemView extends ListItemView{constructor(){super(...arguments);Re(this,"item");Re(this,"marker")}highlight(){const t=this.children.first;t.isOn=!0}removeHighlight(){const t=this.children.first;t.isOn=!1}}const VERTICAL_SPACING=3,defaultHandledKeyCodes=[keyCodes.arrowup,keyCodes.arrowdown,keyCodes.esc],defaultCommitKeyCodes=[keyCodes.enter,keyCodes.tab];class MentionUI extends Plugin{constructor(t){super(t);Re(this,"_mentionsView");Re(this,"_mentionsConfigurations");Re(this,"_balloon");Re(this,"_items",new Collection);Re(this,"_lastRequested");Re(this,"_requestFeedDebounced");this._mentionsView=this._createMentionView(),this._mentionsConfigurations=new Map,this._requestFeedDebounced=debounce(this._requestFeed,100),t.config.define("mention",{feeds:[]})}static get pluginName(){return"MentionUI"}static get requires(){return[ContextualBalloon]}init(){const t=this.editor,te=t.config.get("mention.commitKeys")||defaultCommitKeyCodes,be=defaultHandledKeyCodes.concat(te);this._balloon=t.plugins.get(ContextualBalloon),t.editing.view.document.on("keydown",(ke,Ie)=>{ve(Ie.keyCode)&&this._isUIVisible&&(Ie.preventDefault(),ke.stop(),Ie.keyCode==keyCodes.arrowdown&&this._mentionsView.selectNext(),Ie.keyCode==keyCodes.arrowup&&this._mentionsView.selectPrevious(),te.includes(Ie.keyCode)&&this._mentionsView.executeSelected(),Ie.keyCode==keyCodes.esc&&this._hideUIAndRemoveMarker())},{priority:"highest"}),clickOutsideHandler({emitter:this._mentionsView,activator:()=>this._isUIVisible,contextElements:()=>[this._balloon.view.element],callback:()=>this._hideUIAndRemoveMarker()});const xe=t.config.get("mention.feeds");for(const ke of xe){const{feed:Ie,marker:Ae,dropdownLimit:Se}=ke;if(!isValidMentionMarker(Ae))throw new CKEditorError("mentionconfig-incorrect-marker",null,{marker:Ae});const Oe=typeof Ie=="function"?Ie.bind(this.editor):createFeedCallback(Ie),Ve=ke.itemRenderer,Me={marker:Ae,feedCallback:Oe,itemRenderer:Ve,dropdownLimit:Se};this._mentionsConfigurations.set(Ae,Me)}this._setupTextWatcher(xe),this.listenTo(t,"change:isReadOnly",()=>{this._hideUIAndRemoveMarker()}),this.on("requestFeed:response",(ke,Ie)=>this._handleFeedResponse(Ie)),this.on("requestFeed:error",()=>this._hideUIAndRemoveMarker());function ve(ke){return be.includes(ke)}}destroy(){super.destroy(),this._mentionsView.destroy()}get _isUIVisible(){return this._balloon.visibleView===this._mentionsView}_createMentionView(){const t=this.editor.locale,te=new MentionsView(t);return te.items.bindTo(this._items).using(be=>{const{item:xe,marker:ve}=be,{dropdownLimit:ke}=this._mentionsConfigurations.get(ve),Ie=ke||this.editor.config.get("mention.dropdownLimit")||10;if(te.items.length>=Ie)return null;const Ae=new MentionListItemView(t),Se=this._renderItem(xe,ve);return Se.delegate("execute").to(Ae),Ae.children.add(Se),Ae.item=xe,Ae.marker=ve,Ae.on("execute",()=>{te.fire("execute",{item:xe,marker:ve})}),Ae}),te.on("execute",(be,xe)=>{const ve=this.editor,ke=ve.model,Ie=xe.item,Ae=xe.marker,Se=ve.model.markers.get("mention"),Oe=ke.createPositionAt(ke.document.selection.focus),Ve=ke.createPositionAt(Se.getStart()),Me=ke.createRange(Ve,Oe);this._hideUIAndRemoveMarker(),ve.execute("mention",{mention:Ie,text:Ie.text,marker:Ae,range:Me}),ve.editing.view.focus()}),te}_getItemRenderer(t){const{itemRenderer:te}=this._mentionsConfigurations.get(t);return te}_requestFeed(t,te){this._lastRequested=te;const{feedCallback:be}=this._mentionsConfigurations.get(t),xe=be(te);if(!(xe instanceof Promise)){this.fire("requestFeed:response",{feed:xe,marker:t,feedText:te});return}xe.then(ke=>{this._lastRequested==te?this.fire("requestFeed:response",{feed:ke,marker:t,feedText:te}):this.fire("requestFeed:discarded",{feed:ke,marker:t,feedText:te})}).catch(ke=>{this.fire("requestFeed:error",{error:ke}),logWarning("mention-feed-callback-error",{marker:t})})}_setupTextWatcher(t){const te=this.editor,be=t.map(ke=>({...ke,pattern:createRegExp(ke.marker,ke.minimumCharacters||0)})),xe=new TextWatcher(te.model,createTestCallback(be));xe.on("matched",(ke,Ie)=>{const Ae=getLastValidMarkerInText(be,Ie.text),Oe=te.model.document.selection.focus,Ve=te.model.createPositionAt(Oe.parent,Ae.position);if(isPositionInExistingMention(Oe)||isMarkerInExistingMention(Ve)){this._hideUIAndRemoveMarker();return}const Me=requestFeedText(Ae,Ie.text),De=Ae.marker.length+Me.length,Fe=Oe.getShiftedBy(-De),Be=Oe.getShiftedBy(-Me.length),$e=te.model.createRange(Fe,Be);if(checkIfStillInCompletionMode(te)){const Ue=te.model.markers.get("mention");te.model.change(He=>{He.updateMarker(Ue,{range:$e})})}else te.model.change(Ue=>{Ue.addMarker("mention",{range:$e,usingOperation:!1,affectsData:!1})});this._requestFeedDebounced(Ae.marker,Me)}),xe.on("unmatched",()=>{this._hideUIAndRemoveMarker()});const ve=te.commands.get("mention");return xe.bind("isEnabled").to(ve),xe}_handleFeedResponse(t){const{feed:te,marker:be}=t;if(!checkIfStillInCompletionMode(this.editor))return;this._items.clear();for(const ve of te){const ke=typeof ve!="object"?{id:ve,text:ve}:ve;this._items.add({item:ke,marker:be})}const xe=this.editor.model.markers.get("mention");this._items.length?this._showOrUpdateUI(xe):this._hideUIAndRemoveMarker()}_showOrUpdateUI(t){this._isUIVisible?this._balloon.updatePosition(this._getBalloonPanelPositionData(t,this._mentionsView.position)):this._balloon.add({view:this._mentionsView,position:this._getBalloonPanelPositionData(t,this._mentionsView.position),singleViewMode:!0}),this._mentionsView.position=this._balloon.view.position,this._mentionsView.selectFirst()}_hideUIAndRemoveMarker(){this._balloon.hasView(this._mentionsView)&&this._balloon.remove(this._mentionsView),checkIfStillInCompletionMode(this.editor)&&this.editor.model.change(t=>t.removeMarker("mention")),this._mentionsView.position=void 0}_renderItem(t,te){const be=this.editor;let xe,ve=t.id;const ke=this._getItemRenderer(te);if(ke){const Ie=ke(t);typeof Ie!="string"?xe=new DomWrapperView(be.locale,Ie):ve=Ie}if(!xe){const Ie=new ButtonView(be.locale);Ie.label=ve,Ie.withText=!0,xe=Ie}return xe}_getBalloonPanelPositionData(t,te){const be=this.editor,xe=be.editing,ve=xe.view.domConverter,ke=xe.mapper,Ie=be.locale.uiLanguageDirection;return{target:()=>{let Ae=t.getRange();Ae.start.root.rootName=="$graveyard"&&(Ae=be.model.document.selection.getFirstRange());const Se=ke.toViewRange(Ae);return Rect.getDomRangeRects(ve.viewRangeToDom(Se)).pop()},limiter:()=>{const Ae=this.editor.editing.view,Oe=Ae.document.selection.editableElement;return Oe?Ae.domConverter.mapViewToDom(Oe.root):null},positions:getBalloonPanelPositions(te,Ie)}}}function getBalloonPanelPositions(Te,we){const t={caret_se:te=>({top:te.bottom+VERTICAL_SPACING,left:te.right,name:"caret_se",config:{withArrow:!1}}),caret_ne:(te,be)=>({top:te.top-be.height-VERTICAL_SPACING,left:te.right,name:"caret_ne",config:{withArrow:!1}}),caret_sw:(te,be)=>({top:te.bottom+VERTICAL_SPACING,left:te.right-be.width,name:"caret_sw",config:{withArrow:!1}}),caret_nw:(te,be)=>({top:te.top-be.height-VERTICAL_SPACING,left:te.right-be.width,name:"caret_nw",config:{withArrow:!1}})};return Object.prototype.hasOwnProperty.call(t,Te)?[t[Te]]:we!=="rtl"?[t.caret_se,t.caret_sw,t.caret_ne,t.caret_nw]:[t.caret_sw,t.caret_se,t.caret_nw,t.caret_ne]}function getLastValidMarkerInText(Te,we){let t;for(const te of Te){const be=we.lastIndexOf(te.marker);be>0&&!we.substring(be-1).match(te.pattern)||(!t||be>=t.position)&&(t={marker:te.marker,position:be,minimumCharacters:te.minimumCharacters,pattern:te.pattern})}return t}function createRegExp(Te,we){const t=we==0?"*":`{${we},}`,xe=`(?:^|[ ${env.features.isRegExpUnicodePropertySupported?`\\p{Ps}\\p{Pi}"'`:`\\(\\[{"'`}])([${Te}])(.${t})$`;return new RegExp(xe,"u")}function createTestCallback(Te){return t=>{const te=getLastValidMarkerInText(Te,t);if(!te)return!1;let be=0;te.position!==0&&(be=te.position-1);const xe=t.substring(be);return te.pattern.test(xe)}}function requestFeedText(Te,we){let t=0;Te.position!==0&&(t=Te.position-1);const te=createRegExp(Te.marker,0);return we.substring(t).match(te)[2]}function createFeedCallback(Te){return we=>Te.filter(te=>(typeof te=="string"?te:String(te.id)).toLowerCase().includes(we.toLowerCase()))}function isPositionInExistingMention(Te){const we=Te.textNode&&Te.textNode.hasAttribute("mention"),t=Te.nodeBefore;return we||t&&t.is("$text")&&t.hasAttribute("mention")}function isMarkerInExistingMention(Te){const we=Te.nodeAfter;return we&&we.is("$text")&&we.hasAttribute("mention")}function isValidMentionMarker(Te){return Te&&Te.length==1}function checkIfStillInCompletionMode(Te){return Te.model.markers.has("mention")}class Mention extends Plugin{toMentionAttribute(we,t){return _toMentionAttribute(we,t)}static get pluginName(){return"Mention"}static get requires(){return[MentionEditing,MentionUI]}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class PageBreakCommand extends Command{refresh(){const we=this.editor.model,t=we.schema,te=we.document.selection;this.isEnabled=isPageBreakAllowedInParent(te,t,we)}execute(){const we=this.editor.model;we.change(t=>{const te=t.createElement("pageBreak");we.insertObject(te,null,null,{setSelection:"after"})})}}function isPageBreakAllowedInParent(Te,we,t){const te=getInsertPageBreakParent(Te,t);return we.checkChild(te,"pageBreak")}function getInsertPageBreakParent(Te,we){const te=findOptimalInsertionRange(Te,we).start.parent;return te.isEmpty&&!te.is("element","$root")?te.parent:te}class PageBreakEditing extends Plugin{static get pluginName(){return"PageBreakEditing"}init(){const we=this.editor,t=we.model.schema,te=we.t,be=we.conversion;t.register("pageBreak",{inheritAllFrom:"$blockObject"}),be.for("dataDowncast").elementToStructure({model:"pageBreak",view:(xe,{writer:ve})=>ve.createContainerElement("div",{class:"page-break",style:"page-break-after: always"},ve.createContainerElement("span",{style:"display: none"}))}),be.for("editingDowncast").elementToStructure({model:"pageBreak",view:(xe,{writer:ve})=>{const ke=te("Page break"),Ie=ve.createContainerElement("div"),Ae=ve.createRawElement("span",{class:"page-break__label"},function(Se){Se.innerText=te("Page break")});return ve.addClass("page-break",Ie),ve.insert(ve.createPositionAt(Ie,0),Ae),toPageBreakWidget(Ie,ve,ke)}}),be.for("upcast").elementToElement({view:xe=>{const ve=xe.getStyle("page-break-before")=="always",ke=xe.getStyle("page-break-after")=="always";if(!ve&&!ke)return null;if(xe.childCount==1){const Ie=xe.getChild(0);if(!Ie.is("element","span")||Ie.getStyle("display")!="none")return null}else if(xe.childCount>1)return null;return{name:!0}},model:"pageBreak",converterPriority:"high"}),we.commands.add("pageBreak",new PageBreakCommand(we))}}function toPageBreakWidget(Te,we,t){return we.setCustomProperty("pageBreak",!0,Te),toWidget(Te,we,{label:t})}var pageBreakIcon='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M3.598.687h1.5v5h-1.5zm14.5 0h1.5v5h-1.5z"/><path d="M19.598 4.187v1.5h-16v-1.5zm-16 14.569h1.5v-5h-1.5zm14.5 0h1.5v-5h-1.5z"/><path d="M19.598 15.256v-1.5h-16v1.5zM5.081 9h6v2h-6zm8 0h6v2h-6zm-9.483 1L0 12.5v-5z"/></svg>';class PageBreakUI extends Plugin{static get pluginName(){return"PageBreakUI"}init(){const we=this.editor;we.ui.componentFactory.add("pageBreak",()=>{const t=this._createButton(ButtonView);return t.set({tooltip:!0}),t}),we.ui.componentFactory.add("menuBar:pageBreak",()=>this._createButton(MenuBarMenuListItemButtonView))}_createButton(we){const t=this.editor,te=t.locale,be=t.commands.get("pageBreak"),xe=new we(t.locale),ve=te.t;return xe.set({label:ve("Page break"),icon:pageBreakIcon}),xe.bind("isEnabled").to(be,"isEnabled"),this.listenTo(xe,"execute",()=>{t.execute("pageBreak"),t.editing.view.focus()}),xe}}class PageBreak extends Plugin{static get requires(){return[PageBreakEditing,PageBreakUI,Widget]}static get pluginName(){return"PageBreak"}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 *//**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function convertCssLengthToPx(Te){const we=parseFloat(Te);return Te.endsWith("pt")?toPx(we*96/72):Te.endsWith("pc")?toPx(we*12*96/72):Te.endsWith("in")?toPx(we*96):Te.endsWith("cm")?toPx(we*96/2.54):Te.endsWith("mm")?toPx(we/10*96/2.54):Te}function isPx(Te){return Te!==void 0&&Te.endsWith("px")}function toPx(Te){return Te.toFixed(2).replace(/\.?0+$/,"")+"px"}function transformListItemLikeElementsIntoLists(Te,we,t){if(!Te.childCount)return;const te=new UpcastWriter(Te.document),be=findAllItemLikeElements(Te,te);if(!be.length)return;const xe={},ve=[];for(const ke of be)if(ke.indent!==void 0){isListContinuation(ke)||(ve.length=0);const Ie=`${ke.id}:${ke.indent}`,Ae=Math.min(ke.indent-1,ve.length);if(Ae<ve.length&&ve[Ae].id!==ke.id&&(ve.length=Ae),Ae<ve.length-1)ve.length=Ae+1;else{const Oe=detectListStyle(ke,we);if(Ae>ve.length-1||ve[Ae].listElement.name!=Oe.type){Ae==0&&Oe.type=="ol"&&ke.id!==void 0&&xe[Ie]&&(Oe.startIndex=xe[Ie]);const Ve=createNewEmptyList(Oe,te,t);if(isPx(ke.marginLeft)&&(Ae==0||isPx(ve[Ae-1].marginLeft))){let Me=ke.marginLeft;Ae>0&&(Me=toPx(parseFloat(Me)-parseFloat(ve[Ae-1].marginLeft))),te.setStyle("padding-left",Me,Ve)}if(ve.length==0){const Me=ke.element.parent,De=Me.getChildIndex(ke.element)+1;te.insertChild(De,Ve,Me)}else{const Me=ve[Ae-1].listItemElements;te.appendChild(Ve,Me[Me.length-1])}ve[Ae]={...ke,listElement:Ve,listItemElements:[]},Ae==0&&ke.id!==void 0&&(xe[Ie]=Oe.startIndex||1)}}const Se=ke.element.name=="li"?ke.element:te.createElement("li");te.appendChild(Se,ve[Ae].listElement),ve[Ae].listItemElements.push(Se),Ae==0&&ke.id!==void 0&&xe[Ie]++,ke.element!=Se&&te.appendChild(ke.element,Se),removeBulletElement(ke.element,te),te.removeStyle("text-indent",ke.element),te.removeStyle("margin-left",ke.element)}else{const Ie=ve.find(Ae=>Ae.marginLeft==ke.marginLeft);if(Ie){const Ae=Ie.listItemElements;te.appendChild(ke.element,Ae[Ae.length-1]),te.removeStyle("margin-left",ke.element)}else ve.length=0}}function unwrapParagraphInListItem(Te,we){for(const t of we.createRangeIn(Te)){const te=t.item;if(te.is("element","li")){const be=te.getChild(0);be&&be.is("element","p")&&we.unwrapElement(be)}}}function findAllItemLikeElements(Te,we){const t=we.createRangeIn(Te),te=[],be=new Set;for(const xe of t.getItems()){if(!xe.is("element")||!xe.name.match(/^(p|h\d+|li|div)$/))continue;let ve=getMarginLeftNormalized(xe);if(ve!==void 0&&parseFloat(ve)==0&&!Array.from(xe.getClassNames()).find(ke=>ke.startsWith("MsoList"))&&(ve=void 0),xe.hasStyle("mso-list")||ve!==void 0&&be.has(ve)){const ke=getListItemData(xe);te.push({element:xe,id:ke.id,order:ke.order,indent:ke.indent,marginLeft:ve}),ve!==void 0&&be.add(ve)}else be.clear()}return te}function isListContinuation(Te){const we=Te.element.previousSibling;return isList(we||Te.element.parent)}function isList(Te){return Te.is("element","ol")||Te.is("element","ul")}function detectListStyle(Te,we){const t=new RegExp(`@list l${Te.id}:level${Te.indent}\\s*({[^}]*)`,"gi"),te=/mso-level-number-format:([^;]{0,100});/gi,be=/mso-level-start-at:\s{0,100}([0-9]{0,10})\s{0,100};/gi,xe=new RegExp(`@list\\s+l${Te.id}:level\\d\\s*{[^{]*mso-level-text:"%\\d\\\\.`,"gi"),ve=new RegExp(`@list l${Te.id}:level\\d\\s*{[^{]*mso-level-number-format:`,"gi"),ke=xe.exec(we),Ie=ve.exec(we),Ae=ke&&!Ie,Se=t.exec(we);let Oe="decimal",Ve="ol",Me=null;if(Se&&Se[1]){const De=te.exec(Se[1]);if(De&&De[1]&&(Oe=De[1].trim(),Ve=Oe!=="bullet"&&Oe!=="image"?"ol":"ul"),Oe==="bullet"){const Fe=findBulletedListStyle(Te.element);Fe&&(Oe=Fe)}else{const Fe=be.exec(Se[1]);Fe&&Fe[1]&&(Me=parseInt(Fe[1]))}Ae&&(Ve="ol")}return{type:Ve,startIndex:Me,style:mapListStyleDefinition(Oe),isLegalStyleList:Ae}}function findBulletedListStyle(Te){if(Te.name=="li"&&Te.parent.name=="ul"&&Te.parent.hasAttribute("type"))return Te.parent.getAttribute("type");const we=findListMarkerNode(Te);if(!we)return null;const t=we._data;return t==="o"?"circle":t==="·"?"disc":t==="§"?"square":null}function findListMarkerNode(Te){if(Te.getChild(0).is("$text"))return null;for(const we of Te.getChildren()){if(!we.is("element","span"))continue;const t=we.getChild(0);if(t)return t.is("$text")?t:t.getChild(0)}/* istanbul ignore next -- @preserve */return null}function mapListStyleDefinition(Te){if(Te.startsWith("arabic-leading-zero"))return"decimal-leading-zero";switch(Te){case"alpha-upper":return"upper-alpha";case"alpha-lower":return"lower-alpha";case"roman-upper":return"upper-roman";case"roman-lower":return"lower-roman";case"circle":case"disc":case"square":return Te;default:return null}}function createNewEmptyList(Te,we,t){const te=we.createElement(Te.type);return Te.style&&we.setStyle("list-style-type",Te.style,te),Te.startIndex&&Te.startIndex>1&&we.setAttribute("start",Te.startIndex,te),Te.isLegalStyleList&&t&&we.addClass("legal-list",te),te}function getListItemData(Te){const we=Te.getStyle("mso-list");if(we===void 0)return{};const t=we.match(/(^|\s{1,100})l(\d+)/i),te=we.match(/\s{0,100}lfo(\d+)/i),be=we.match(/\s{0,100}level(\d+)/i);return t&&te&&be?{id:t[2],order:te[1],indent:parseInt(be[1])}:{indent:1}}function removeBulletElement(Te,we){const t=new Matcher({name:"span",styles:{"mso-list":"Ignore"}}),te=we.createRangeIn(Te);for(const be of te)be.type==="elementStart"&&t.match(be.item)&&we.remove(be.item)}function getMarginLeftNormalized(Te){const we=Te.getStyle("margin-left");return we===void 0||we.endsWith("px")?we:convertCssLengthToPx(we)}function replaceImagesSourceWithBase64(Te,we){if(!Te.childCount)return;const t=new UpcastWriter(Te.document),te=findAllShapesIds(Te,t);removeAllImgElementsRepresentingShapes(te,Te,t),insertMissingImgs(te,Te,t),removeAllShapeElements(Te,t);const be=findAllImageElementsWithLocalSource(Te,t);be.length&&replaceImagesFileSourceWithInlineRepresentation(be,extractImageDataFromRtf(we),t)}function _convertHexToBase64(Te){return btoa(Te.match(/\w{2}/g).map(we=>String.fromCharCode(parseInt(we,16))).join(""))}function findAllShapesIds(Te,we){const t=we.createRangeIn(Te),te=new Matcher({name:/v:(.+)/}),be=[];for(const xe of t){if(xe.type!="elementStart")continue;const ve=xe.item,ke=ve.previousSibling,Ie=ke&&ke.is("element")?ke.name:null,Ae=["Chart"],Se=te.match(ve),Oe=ve.getAttribute("o:gfxdata"),Ve=Ie==="v:shapetype",Me=Oe&&Ae.some(De=>ve.getAttribute("id").includes(De));Se&&Oe&&!Ve&&!Me&&be.push(xe.item.getAttribute("id"))}return be}function removeAllImgElementsRepresentingShapes(Te,we,t){const te=t.createRangeIn(we),be=new Matcher({name:"img"}),xe=[];for(const ve of te)if(ve.item.is("element")&&be.match(ve.item)){const ke=ve.item,Ie=ke.getAttribute("v:shapes")?ke.getAttribute("v:shapes").split(" "):[];Ie.length&&Ie.every(Ae=>Te.indexOf(Ae)>-1)?xe.push(ke):ke.getAttribute("src")||xe.push(ke)}for(const ve of xe)t.remove(ve)}function removeAllShapeElements(Te,we){const t=we.createRangeIn(Te),te=new Matcher({name:/v:(.+)/}),be=[];for(const xe of t)xe.type=="elementStart"&&te.match(xe.item)&&be.push(xe.item);for(const xe of be)we.remove(xe)}function insertMissingImgs(Te,we,t){const te=t.createRangeIn(we),be=[];for(const ke of te)if(ke.type=="elementStart"&&ke.item.is("element","v:shape")){const Ie=ke.item.getAttribute("id");if(Te.includes(Ie))continue;xe(ke.item.parent.getChildren(),Ie)||be.push(ke.item)}for(const ke of be){const Ie={src:ve(ke)};ke.hasAttribute("alt")&&(Ie.alt=ke.getAttribute("alt"));const Ae=t.createElement("img",Ie);t.insertChild(ke.index+1,Ae,ke.parent)}function xe(ke,Ie){for(const Ae of ke){/* istanbul ignore else -- @preserve */if(Ae.is("element")&&(Ae.name=="img"&&Ae.getAttribute("v:shapes")==Ie||xe(Ae.getChildren(),Ie)))return!0}return!1}function ve(ke){for(const Ie of ke.getChildren()){/* istanbul ignore else -- @preserve */if(Ie.is("element")&&Ie.getAttribute("src"))return Ie.getAttribute("src")}}}function findAllImageElementsWithLocalSource(Te,we){const t=we.createRangeIn(Te),te=new Matcher({name:"img"}),be=[];for(const xe of t)xe.item.is("element")&&te.match(xe.item)&&xe.item.getAttribute("src").startsWith("file://")&&be.push(xe.item);return be}function extractImageDataFromRtf(Te){if(!Te)return[];const we=/{\\pict[\s\S]+?\\bliptag-?\d+(\\blipupi-?\d+)?({\\\*\\blipuid\s?[\da-fA-F]+)?[\s}]*?/,t=new RegExp("(?:("+we.source+"))([\\da-fA-F\\s]+)\\}","g"),te=Te.match(t),be=[];if(te)for(const xe of te){let ve=!1;xe.includes("\\pngblip")?ve="image/png":xe.includes("\\jpegblip")&&(ve="image/jpeg"),ve&&be.push({hex:xe.replace(we,"").replace(/[^\da-fA-F]/g,""),type:ve})}return be}function replaceImagesFileSourceWithInlineRepresentation(Te,we,t){if(Te.length===we.length)for(let te=0;te<Te.length;te++){const be=`data:${we[te].type};base64,${_convertHexToBase64(we[te].hex)}`;t.setAttribute("src",be,Te[te])}}function removeMSAttributes(Te){const we=[],t=new UpcastWriter(Te.document);for(const{item:te}of t.createRangeIn(Te))if(te.is("element")){for(const be of te.getClassNames())/\bmso/gi.exec(be)&&t.removeClass(be,te);for(const be of te.getStyleNames())/\bmso/gi.exec(be)&&t.removeStyle(be,te);(te.is("element","w:sdt")||te.is("element","w:sdtpr")&&te.isEmpty||te.is("element","o:p")&&te.isEmpty)&&we.push(te)}for(const te of we){const be=te.parent,xe=be.getChildIndex(te);t.insertChild(xe,te.getChildren(),be),t.remove(te)}}const msWordMatch1=/<meta\s*name="?generator"?\s*content="?microsoft\s*word\s*\d+"?\/?>/i,msWordMatch2=/xmlns:o="urn:schemas-microsoft-com/i;class MSWordNormalizer{constructor(we,t=!1){Re(this,"document");Re(this,"hasMultiLevelListPlugin");this.document=we,this.hasMultiLevelListPlugin=t}isActive(we){return msWordMatch1.test(we)||msWordMatch2.test(we)}execute(we){const{body:t,stylesString:te}=we._parsedData;transformListItemLikeElementsIntoLists(t,te,this.hasMultiLevelListPlugin),replaceImagesSourceWithBase64(t,we.dataTransfer.getData("text/rtf")),removeMSAttributes(t),we.content=t}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function removeBoldWrapper(Te,we){for(const t of Te.getChildren())if(t.is("element","b")&&t.getStyle("font-weight")==="normal"){const te=Te.getChildIndex(t);we.remove(t),we.insertChild(te,t.getChildren(),Te)}}function transformBlockBrsToParagraphs(Te,we){const t=new Document$1(we.document.stylesProcessor),te=new DomConverter(t,{renderingMode:"data"}),be=te.blockElements,xe=te.inlineObjectElements,ve=[];for(const ke of we.createRangeIn(Te)){const Ie=ke.item;if(Ie.is("element","br")){const Ae=findSibling(Ie,"forward",we,{blockElements:be,inlineObjectElements:xe}),Se=findSibling(Ie,"backward",we,{blockElements:be,inlineObjectElements:xe}),Oe=isBlockViewElement(Ae,be);(isBlockViewElement(Se,be)||Oe)&&ve.push(Ie)}}for(const ke of ve)ke.hasClass("Apple-interchange-newline")?we.remove(ke):we.replace(ke,we.createElement("p"))}function findSibling(Te,we,t,{blockElements:te,inlineObjectElements:be}){let xe=t.createPositionAt(Te,we=="forward"?"after":"before");return xe=xe.getLastMatchingPosition(({item:ve})=>ve.is("element")&&!te.includes(ve.name)&&!be.includes(ve.name),{direction:we}),we=="forward"?xe.nodeAfter:xe.nodeBefore}function isBlockViewElement(Te,we){return!!Te&&Te.is("element")&&we.includes(Te.name)}const googleDocsMatch=/id=("|')docs-internal-guid-[-0-9a-f]+("|')/i;class GoogleDocsNormalizer{constructor(we){Re(this,"document");this.document=we}isActive(we){return googleDocsMatch.test(we)}execute(we){const t=new UpcastWriter(this.document),{body:te}=we._parsedData;removeBoldWrapper(te,t),unwrapParagraphInListItem(te,t),transformBlockBrsToParagraphs(te,t),we.content=te}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function removeXmlns(Te,we){for(const t of Te.getChildren())t.is("element","table")&&t.hasAttribute("xmlns")&&we.removeAttribute("xmlns",t)}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function removeGoogleSheetsTag(Te,we){for(const t of Te.getChildren())if(t.is("element","google-sheets-html-origin")){const te=Te.getChildIndex(t);we.remove(t),we.insertChild(te,t.getChildren(),Te)}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function removeInvalidTableWidth(Te,we){for(const t of Te.getChildren())t.is("element","table")&&t.getStyle("width")==="0px"&&we.removeStyle("width",t)}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function removeStyleBlock(Te,we){for(const t of Array.from(Te.getChildren()))t.is("element","style")&&we.remove(t)}const googleSheetsMatch=/<google-sheets-html-origin/i;class GoogleSheetsNormalizer{constructor(we){Re(this,"document");this.document=we}isActive(we){return googleSheetsMatch.test(we)}execute(we){const t=new UpcastWriter(this.document),{body:te}=we._parsedData;removeGoogleSheetsTag(te,t),removeXmlns(te,t),removeInvalidTableWidth(te,t),removeStyleBlock(te,t),we.content=te}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function normalizeSpacing(Te){return normalizeSafariSpaceSpans(normalizeSafariSpaceSpans(Te)).replace(/(<span\s+style=['"]mso-spacerun:yes['"]>[^\S\r\n]*?)[\r\n]+([^\S\r\n]*<\/span>)/g,"$1$2").replace(/<span\s+style=['"]mso-spacerun:yes['"]><\/span>/g,"").replace(/(<span\s+style=['"]letter-spacing:[^'"]+?['"]>)[\r\n]+(<\/span>)/g,"$1 $2").replace(/ <\//g," </").replace(/ <o:p><\/o:p>/g," <o:p></o:p>").replace(/<o:p>(&nbsp;|\u00A0)<\/o:p>/g,"").replace(/>([^\S\r\n]*[\r\n]\s*)</g,"><")}function normalizeSpacerunSpans(Te){Te.querySelectorAll("span[style*=spacerun]").forEach(we=>{const t=we,te=t.innerText.length||0;t.innerText=Array(te+1).join("  ").substr(0,te)})}function normalizeSafariSpaceSpans(Te){return Te.replace(/<span(?: class="Apple-converted-space"|)>(\s+)<\/span>/g,(we,t)=>t.length===1?" ":Array(t.length+1).join("  ").substr(0,t.length))}function parseHtml(Te,we){const t=new DOMParser;Te=Te.replace(/<!--\[if gte vml 1]>/g,""),Te=Te.replace(/<o:SmartTagType(?:\s+[^\s>=]+(?:="[^"]*")?)*\s*\/?>/gi,"");const te=normalizeSpacing(cleanContentAfterBody(Te)),be=t.parseFromString(te,"text/html");normalizeSpacerunSpans(be);const xe=be.body.innerHTML,ve=documentToView(be,we),ke=extractStyles(be);return{body:ve,bodyString:xe,styles:ke.styles,stylesString:ke.stylesString}}function documentToView(Te,we){const t=new Document$1(we),te=new DomConverter(t,{renderingMode:"data"}),be=Te.createDocumentFragment(),xe=Te.body.childNodes;for(;xe.length>0;)be.appendChild(xe[0]);return te.domToView(be,{skipComments:!0})}function extractStyles(Te){const we=[],t=[],te=Array.from(Te.getElementsByTagName("style"));for(const be of te)be.sheet&&be.sheet.cssRules&&be.sheet.cssRules.length&&(we.push(be.sheet),t.push(be.innerHTML));return{styles:we,stylesString:t.join(" ")}}function cleanContentAfterBody(Te){const we="</body>",t="</html>",te=Te.indexOf(we);if(te<0)return Te;const be=Te.indexOf(t,te+we.length);return Te.substring(0,te+we.length)+(be>=0?Te.substring(be):"")}class PasteFromOffice extends Plugin{static get pluginName(){return"PasteFromOffice"}static get requires(){return[ClipboardPipeline]}init(){const we=this.editor,t=we.plugins.get("ClipboardPipeline"),te=we.editing.view.document,be=[],xe=this.editor.plugins.has("MultiLevelList");be.push(new MSWordNormalizer(te,xe)),be.push(new GoogleDocsNormalizer(te)),be.push(new GoogleSheetsNormalizer(te)),t.on("inputTransformation",(ve,ke)=>{if(ke._isTransformedWithPasteFromOffice||we.model.document.selection.getFirstPosition().parent.is("element","codeBlock"))return;const Ae=ke.dataTransfer.getData("text/html"),Se=be.find(Oe=>Oe.isActive(Ae));Se&&(ke._parsedData||(ke._parsedData=parseHtml(Ae,te.stylesProcessor)),Se.execute(ke),ke._isTransformedWithPasteFromOffice=!0)},{priority:"high"})}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */var removeFormatIcon='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M8.69 14.915c.053.052.173.083.36.093a.366.366 0 0 1 .345.485l-.003.01a.738.738 0 0 1-.697.497h-2.67a.374.374 0 0 1-.353-.496l.013-.038a.681.681 0 0 1 .644-.458c.197-.012.325-.043.386-.093a.28.28 0 0 0 .072-.11L9.592 4.5H6.269c-.359-.017-.609.013-.75.09-.142.078-.289.265-.442.563-.192.29-.516.464-.864.464H4.17a.43.43 0 0 1-.407-.569L4.46 3h13.08l-.62 2.043a.81.81 0 0 1-.775.574h-.114a.486.486 0 0 1-.486-.486c.001-.284-.054-.464-.167-.54-.112-.076-.367-.106-.766-.091h-3.28l-2.68 10.257c-.006.074.007.127.038.158zM3 17h8a.5.5 0 1 1 0 1H3a.5.5 0 1 1 0-1zm11.299 1.17a.75.75 0 1 1-1.06-1.06l1.414-1.415-1.415-1.414a.75.75 0 0 1 1.06-1.06l1.415 1.414 1.414-1.415a.75.75 0 1 1 1.06 1.06l-1.413 1.415 1.414 1.415a.75.75 0 0 1-1.06 1.06l-1.415-1.414-1.414 1.414z"/></svg>';const REMOVE_FORMAT="removeFormat";class RemoveFormatUI extends Plugin{static get pluginName(){return"RemoveFormatUI"}init(){const we=this.editor;we.ui.componentFactory.add(REMOVE_FORMAT,()=>{const t=this._createButton(ButtonView);return t.set({tooltip:!0}),t}),we.ui.componentFactory.add(`menuBar:${REMOVE_FORMAT}`,()=>this._createButton(MenuBarMenuListItemButtonView))}_createButton(we){const t=this.editor,te=t.locale,be=t.commands.get(REMOVE_FORMAT),xe=new we(t.locale),ve=te.t;return xe.set({label:ve("Remove Format"),icon:removeFormatIcon}),xe.bind("isEnabled").to(be,"isEnabled"),this.listenTo(xe,"execute",()=>{t.execute(REMOVE_FORMAT),t.editing.view.focus()}),xe}}class RemoveFormatCommand extends Command{refresh(){const we=this.editor.model;this.isEnabled=!!first(this._getFormattingItems(we.document.selection,we.schema))}execute(){const we=this.editor.model,t=we.schema;we.change(te=>{for(const be of this._getFormattingItems(we.document.selection,t))if(be.is("selection"))for(const xe of this._getFormattingAttributes(be,t))te.removeSelectionAttribute(xe);else{const xe=te.createRangeOn(be);for(const ve of this._getFormattingAttributes(be,t))te.removeAttribute(ve,xe)}})}*_getFormattingItems(we,t){const te=be=>!!first(this._getFormattingAttributes(be,t));for(const be of we.getRanges())for(const xe of be.getItems())!t.isBlock(xe)&&te(xe)&&(yield xe);for(const be of we.getSelectedBlocks())te(be)&&(yield be);te(we)&&(yield we)}*_getFormattingAttributes(we,t){for(const[te]of we.getAttributes()){const be=t.getAttributeProperties(te);be&&be.isFormatting&&(yield te)}}}class RemoveFormatEditing extends Plugin{static get pluginName(){return"RemoveFormatEditing"}init(){const we=this.editor;we.commands.add("removeFormat",new RemoveFormatCommand(we))}}class RemoveFormat extends Plugin{static get requires(){return[RemoveFormatEditing,RemoveFormatUI]}static get pluginName(){return"RemoveFormat"}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class SpecialCharactersNavigationView extends FormHeaderView{constructor(t,te){super(t);Re(this,"groupDropdownView");const be=t.t;this.set("class","ck-special-characters-navigation"),this.groupDropdownView=this._createGroupDropdown(te),this.groupDropdownView.panelPosition=t.uiLanguageDirection==="rtl"?"se":"sw",this.label=be("Special characters"),this.children.add(this.groupDropdownView)}get currentGroupName(){return this.groupDropdownView.value}focus(){this.groupDropdownView.focus()}_createGroupDropdown(t){const te=this.locale,be=te.t,xe=createDropdown(te),ve=this._getCharacterGroupListItemDefinitions(xe,t),ke=be("Character categories");return xe.set("value",ve.first.model.name),xe.buttonView.bind("label").to(xe,"value",Ie=>t.get(Ie)),xe.buttonView.set({isOn:!1,withText:!0,tooltip:ke,class:["ck-dropdown__button_label-width_auto"],ariaLabel:ke,ariaLabelledBy:void 0}),xe.on("execute",Ie=>{xe.value=Ie.source.name}),xe.delegate("execute").to(this),addListToDropdown(xe,ve,{ariaLabel:ke,role:"menu"}),xe}_getCharacterGroupListItemDefinitions(t,te){const be=new Collection;for(const[xe,ve]of te){const ke=new Model({name:xe,label:ve,withText:!0,role:"menuitemradio"});ke.bind("isOn").to(t,"value",Ie=>Ie===ke.name),be.add({type:"button",model:ke})}return be}}class CharacterGridView extends View{constructor(t){super(t);Re(this,"tiles");Re(this,"focusTracker");Re(this,"keystrokes");this.tiles=this.createCollection(),this.setTemplate({tag:"div",children:[{tag:"div",attributes:{class:["ck","ck-character-grid__tiles"]},children:this.tiles}],attributes:{class:["ck","ck-character-grid"]}}),this.focusTracker=new FocusTracker,this.keystrokes=new KeystrokeHandler,addKeyboardHandlingForGrid({keystrokeHandler:this.keystrokes,focusTracker:this.focusTracker,gridItems:this.tiles,numberOfColumns:()=>global.window.getComputedStyle(this.element.firstChild).getPropertyValue("grid-template-columns").split(" ").length,uiLanguageDirection:this.locale&&this.locale.uiLanguageDirection})}createTile(t,te){const be=new ButtonView(this.locale);return be.set({label:t,withText:!0,class:"ck-character-grid__tile"}),be.extendTemplate({attributes:{title:te},on:{mouseover:be.bindTemplate.to("mouseover"),focus:be.bindTemplate.to("focus")}}),be.on("mouseover",()=>{this.fire("tileHover",{name:te,character:t})}),be.on("focus",()=>{this.fire("tileFocus",{name:te,character:t})}),be.on("execute",()=>{this.fire("execute",{name:te,character:t})}),be}render(){super.render();for(const t of this.tiles)this.focusTracker.add(t.element);this.tiles.on("change",(t,{added:te,removed:be})=>{if(te.length>0)for(const xe of te)this.focusTracker.add(xe.element);if(be.length>0)for(const xe of be)this.focusTracker.remove(xe.element)}),this.keystrokes.listenTo(this.element)}destroy(){super.destroy(),this.keystrokes.destroy()}focus(){this.tiles.first.focus()}}class CharacterInfoView extends View{constructor(we){super(we);const t=this.bindTemplate;this.set("character",null),this.set("name",null),this.bind("code").to(this,"character",characterToUnicodeString),this.setTemplate({tag:"div",children:[{tag:"span",attributes:{class:["ck-character-info__name"]},children:[{text:t.to("name",te=>te||"​")}]},{tag:"span",attributes:{class:["ck-character-info__code"]},children:[{text:t.to("code")}]}],attributes:{class:["ck","ck-character-info"]}})}}function characterToUnicodeString(Te){return Te===null?"":"U+"+("0000"+Te.codePointAt(0).toString(16)).slice(-4)}class SpecialCharactersView extends View{constructor(t,te,be,xe){super(t);Re(this,"items");Re(this,"focusTracker");Re(this,"keystrokes");Re(this,"_focusCycler");Re(this,"navigationView");Re(this,"gridView");Re(this,"infoView");this.navigationView=te,this.gridView=be,this.infoView=xe,this.items=this.createCollection(),this.focusTracker=new FocusTracker,this.keystrokes=new KeystrokeHandler,this._focusCycler=new FocusCycler({focusables:this.items,focusTracker:this.focusTracker,keystrokeHandler:this.keystrokes,actions:{focusPrevious:"shift + tab",focusNext:"tab"}}),this.setTemplate({tag:"div",children:[this.navigationView,this.gridView,this.infoView],attributes:{tabindex:"-1"}}),this.items.add(this.navigationView.groupDropdownView.buttonView),this.items.add(this.gridView)}render(){super.render(),this.focusTracker.add(this.navigationView.groupDropdownView.buttonView.element),this.focusTracker.add(this.gridView.element),this.keystrokes.listenTo(this.element)}destroy(){super.destroy(),this.focusTracker.destroy(),this.keystrokes.destroy()}focus(){this.navigationView.focus()}}var specialCharactersIcon='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M10 2.5a7.47 7.47 0 0 1 4.231 1.31 7.268 7.268 0 0 1 2.703 3.454 7.128 7.128 0 0 1 .199 4.353c-.39 1.436-1.475 2.72-2.633 3.677h2.013c0-.226.092-.443.254-.603a.876.876 0 0 1 1.229 0c.163.16.254.377.254.603v.853c0 .209-.078.41-.22.567a.873.873 0 0 1-.547.28l-.101.006h-4.695a.517.517 0 0 1-.516-.518v-1.265c0-.21.128-.398.317-.489a5.601 5.601 0 0 0 2.492-2.371 5.459 5.459 0 0 0 .552-3.693 5.53 5.53 0 0 0-1.955-3.2A5.71 5.71 0 0 0 10 4.206 5.708 5.708 0 0 0 6.419 5.46 5.527 5.527 0 0 0 4.46 8.663a5.457 5.457 0 0 0 .554 3.695 5.6 5.6 0 0 0 2.497 2.37.55.55 0 0 1 .317.49v1.264c0 .286-.23.518-.516.518H2.618a.877.877 0 0 1-.614-.25.845.845 0 0 1-.254-.603v-.853c0-.226.091-.443.254-.603a.876.876 0 0 1 1.228 0c.163.16.255.377.255.603h1.925c-1.158-.958-2.155-2.241-2.545-3.678a7.128 7.128 0 0 1 .199-4.352 7.268 7.268 0 0 1 2.703-3.455A7.475 7.475 0 0 1 10 2.5z"/></svg>';const ALL_SPECIAL_CHARACTERS_GROUP="All";class SpecialCharacters extends Plugin{constructor(t){super(t);Re(this,"_characters");Re(this,"_groups");Re(this,"_allSpecialCharactersGroupLabel");const te=t.t;this._characters=new Map,this._groups=new Map,this._allSpecialCharactersGroupLabel=te("All")}static get requires(){return[Typing]}static get pluginName(){return"SpecialCharacters"}init(){const t=this.editor,te=t.t,be=t.commands.get("insertText");t.ui.componentFactory.add("specialCharacters",xe=>{const ve=createDropdown(xe);let ke;return ve.buttonView.set({label:te("Special characters"),icon:specialCharactersIcon,tooltip:!0}),ve.bind("isEnabled").to(be),ve.on("execute",(Ie,Ae)=>{t.execute("insertText",{text:Ae.character}),t.editing.view.focus()}),ve.on("change:isOpen",()=>{if(!ke){ke=this._createDropdownPanelContent(xe,ve);const Ie=new SpecialCharactersView(xe,ke.navigationView,ke.gridView,ke.infoView);ve.panelView.children.add(Ie)}ke.infoView.set({character:null,name:null})}),ve})}addItems(t,te,be={label:t}){if(t===ALL_SPECIAL_CHARACTERS_GROUP)throw new CKEditorError("special-character-invalid-group-name",null);const xe=this._getGroup(t,be.label);for(const ve of te)xe.items.add(ve.title),this._characters.set(ve.title,ve.character)}getGroups(){const t=Array.from(this._groups.keys()),te=this.editor.config.get("specialCharacters.order")||[],be=te.find(xe=>!t.includes(xe));if(be)throw new CKEditorError("special-character-invalid-order-group-name",null,{invalidGroup:be});return new Set([...te,...t])}getCharactersForGroup(t){if(t===ALL_SPECIAL_CHARACTERS_GROUP)return new Set(this._characters.keys());const te=this._groups.get(t);if(te)return te.items}getCharacter(t){return this._characters.get(t)}_getGroup(t,te){return this._groups.has(t)||this._groups.set(t,{items:new Set,label:te}),this._groups.get(t)}_updateGrid(t,te){te.tiles.clear();const be=this.getCharactersForGroup(t);for(const xe of be){const ve=this.getCharacter(xe);te.tiles.add(te.createTile(ve,xe))}}_createDropdownPanelContent(t,te){const be=Array.from(this.getGroups()).map(Ae=>[Ae,this._groups.get(Ae).label]),xe=new Map([[ALL_SPECIAL_CHARACTERS_GROUP,this._allSpecialCharactersGroupLabel],...be]),ve=new SpecialCharactersNavigationView(t,xe),ke=new CharacterGridView(t),Ie=new CharacterInfoView(t);return ke.delegate("execute").to(te),ke.on("tileHover",(Ae,Se)=>{Ie.set(Se)}),ke.on("tileFocus",(Ae,Se)=>{Ie.set(Se)}),ve.on("execute",()=>{this._updateGrid(ve.currentGroupName,ke)}),this._updateGrid(ve.currentGroupName,ke),{navigationView:ve,gridView:ke,infoView:Ie}}}class SpecialCharactersArrows extends Plugin{static get pluginName(){return"SpecialCharactersArrows"}init(){const we=this.editor,t=we.t;we.plugins.get("SpecialCharacters").addItems("Arrows",[{title:t("leftwards simple arrow"),character:"←"},{title:t("rightwards simple arrow"),character:"→"},{title:t("upwards simple arrow"),character:"↑"},{title:t("downwards simple arrow"),character:"↓"},{title:t("leftwards double arrow"),character:"⇐"},{title:t("rightwards double arrow"),character:"⇒"},{title:t("upwards double arrow"),character:"⇑"},{title:t("downwards double arrow"),character:"⇓"},{title:t("leftwards dashed arrow"),character:"⇠"},{title:t("rightwards dashed arrow"),character:"⇢"},{title:t("upwards dashed arrow"),character:"⇡"},{title:t("downwards dashed arrow"),character:"⇣"},{title:t("leftwards arrow to bar"),character:"⇤"},{title:t("rightwards arrow to bar"),character:"⇥"},{title:t("upwards arrow to bar"),character:"⤒"},{title:t("downwards arrow to bar"),character:"⤓"},{title:t("up down arrow with base"),character:"↨"},{title:t("back with leftwards arrow above"),character:"🔙"},{title:t("end with leftwards arrow above"),character:"🔚"},{title:t("on with exclamation mark with left right arrow above"),character:"🔛"},{title:t("soon with rightwards arrow above"),character:"🔜"},{title:t("top with upwards arrow above"),character:"🔝"}],{label:t("Arrows")})}}class SpecialCharactersText extends Plugin{static get pluginName(){return"SpecialCharactersText"}init(){const we=this.editor,t=we.t;we.plugins.get("SpecialCharacters").addItems("Text",[{character:"‹",title:t("Single left-pointing angle quotation mark")},{character:"›",title:t("Single right-pointing angle quotation mark")},{character:"«",title:t("Left-pointing double angle quotation mark")},{character:"»",title:t("Right-pointing double angle quotation mark")},{character:"‘",title:t("Left single quotation mark")},{character:"’",title:t("Right single quotation mark")},{character:"“",title:t("Left double quotation mark")},{character:"”",title:t("Right double quotation mark")},{character:"‚",title:t("Single low-9 quotation mark")},{character:"„",title:t("Double low-9 quotation mark")},{character:"¡",title:t("Inverted exclamation mark")},{character:"¿",title:t("Inverted question mark")},{character:"‥",title:t("Two dot leader")},{character:"…",title:t("Horizontal ellipsis")},{character:"‡",title:t("Double dagger")},{character:"‰",title:t("Per mille sign")},{character:"‱",title:t("Per ten thousand sign")},{character:"‼",title:t("Double exclamation mark")},{character:"⁈",title:t("Question exclamation mark")},{character:"⁉",title:t("Exclamation question mark")},{character:"⁇",title:t("Double question mark")},{character:"©",title:t("Copyright sign")},{character:"®",title:t("Registered sign")},{character:"™",title:t("Trade mark sign")},{character:"§",title:t("Section sign")},{character:"¶",title:t("Paragraph sign")},{character:"⁋",title:t("Reversed paragraph sign")}],{label:t("Text")})}}class SpecialCharactersMathematical extends Plugin{static get pluginName(){return"SpecialCharactersMathematical"}init(){const we=this.editor,t=we.t;we.plugins.get("SpecialCharacters").addItems("Mathematical",[{character:"<",title:t("Less-than sign")},{character:">",title:t("Greater-than sign")},{character:"≤",title:t("Less-than or equal to")},{character:"≥",title:t("Greater-than or equal to")},{character:"–",title:t("En dash")},{character:"—",title:t("Em dash")},{character:"¯",title:t("Macron")},{character:"‾",title:t("Overline")},{character:"°",title:t("Degree sign")},{character:"−",title:t("Minus sign")},{character:"±",title:t("Plus-minus sign")},{character:"÷",title:t("Division sign")},{character:"⁄",title:t("Fraction slash")},{character:"×",title:t("Multiplication sign")},{character:"ƒ",title:t("Latin small letter f with hook")},{character:"∫",title:t("Integral")},{character:"∑",title:t("N-ary summation")},{character:"∞",title:t("Infinity")},{character:"√",title:t("Square root")},{character:"∼",title:t("Tilde operator")},{character:"≅",title:t("Approximately equal to")},{character:"≈",title:t("Almost equal to")},{character:"≠",title:t("Not equal to")},{character:"≡",title:t("Identical to")},{character:"∈",title:t("Element of")},{character:"∉",title:t("Not an element of")},{character:"∋",title:t("Contains as member")},{character:"∏",title:t("N-ary product")},{character:"∧",title:t("Logical and")},{character:"∨",title:t("Logical or")},{character:"¬",title:t("Not sign")},{character:"∩",title:t("Intersection")},{character:"∪",title:t("Union")},{character:"∂",title:t("Partial differential")},{character:"∀",title:t("For all")},{character:"∃",title:t("There exists")},{character:"∅",title:t("Empty set")},{character:"∇",title:t("Nabla")},{character:"∗",title:t("Asterisk operator")},{character:"∝",title:t("Proportional to")},{character:"∠",title:t("Angle")},{character:"¼",title:t("Vulgar fraction one quarter")},{character:"½",title:t("Vulgar fraction one half")},{character:"¾",title:t("Vulgar fraction three quarters")}],{label:t("Mathematical")})}}class SpecialCharactersLatin extends Plugin{static get pluginName(){return"SpecialCharactersLatin"}init(){const we=this.editor,t=we.t;we.plugins.get("SpecialCharacters").addItems("Latin",[{character:"Ā",title:t("Latin capital letter a with macron")},{character:"ā",title:t("Latin small letter a with macron")},{character:"Ă",title:t("Latin capital letter a with breve")},{character:"ă",title:t("Latin small letter a with breve")},{character:"Ą",title:t("Latin capital letter a with ogonek")},{character:"ą",title:t("Latin small letter a with ogonek")},{character:"Ć",title:t("Latin capital letter c with acute")},{character:"ć",title:t("Latin small letter c with acute")},{character:"Ĉ",title:t("Latin capital letter c with circumflex")},{character:"ĉ",title:t("Latin small letter c with circumflex")},{character:"Ċ",title:t("Latin capital letter c with dot above")},{character:"ċ",title:t("Latin small letter c with dot above")},{character:"Č",title:t("Latin capital letter c with caron")},{character:"č",title:t("Latin small letter c with caron")},{character:"Ď",title:t("Latin capital letter d with caron")},{character:"ď",title:t("Latin small letter d with caron")},{character:"Đ",title:t("Latin capital letter d with stroke")},{character:"đ",title:t("Latin small letter d with stroke")},{character:"Ē",title:t("Latin capital letter e with macron")},{character:"ē",title:t("Latin small letter e with macron")},{character:"Ĕ",title:t("Latin capital letter e with breve")},{character:"ĕ",title:t("Latin small letter e with breve")},{character:"Ė",title:t("Latin capital letter e with dot above")},{character:"ė",title:t("Latin small letter e with dot above")},{character:"Ę",title:t("Latin capital letter e with ogonek")},{character:"ę",title:t("Latin small letter e with ogonek")},{character:"Ě",title:t("Latin capital letter e with caron")},{character:"ě",title:t("Latin small letter e with caron")},{character:"Ĝ",title:t("Latin capital letter g with circumflex")},{character:"ĝ",title:t("Latin small letter g with circumflex")},{character:"Ğ",title:t("Latin capital letter g with breve")},{character:"ğ",title:t("Latin small letter g with breve")},{character:"Ġ",title:t("Latin capital letter g with dot above")},{character:"ġ",title:t("Latin small letter g with dot above")},{character:"Ģ",title:t("Latin capital letter g with cedilla")},{character:"ģ",title:t("Latin small letter g with cedilla")},{character:"Ĥ",title:t("Latin capital letter h with circumflex")},{character:"ĥ",title:t("Latin small letter h with circumflex")},{character:"Ħ",title:t("Latin capital letter h with stroke")},{character:"ħ",title:t("Latin small letter h with stroke")},{character:"Ĩ",title:t("Latin capital letter i with tilde")},{character:"ĩ",title:t("Latin small letter i with tilde")},{character:"Ī",title:t("Latin capital letter i with macron")},{character:"ī",title:t("Latin small letter i with macron")},{character:"Ĭ",title:t("Latin capital letter i with breve")},{character:"ĭ",title:t("Latin small letter i with breve")},{character:"Į",title:t("Latin capital letter i with ogonek")},{character:"į",title:t("Latin small letter i with ogonek")},{character:"İ",title:t("Latin capital letter i with dot above")},{character:"ı",title:t("Latin small letter dotless i")},{character:"Ĳ",title:t("Latin capital ligature ij")},{character:"ĳ",title:t("Latin small ligature ij")},{character:"Ĵ",title:t("Latin capital letter j with circumflex")},{character:"ĵ",title:t("Latin small letter j with circumflex")},{character:"Ķ",title:t("Latin capital letter k with cedilla")},{character:"ķ",title:t("Latin small letter k with cedilla")},{character:"ĸ",title:t("Latin small letter kra")},{character:"Ĺ",title:t("Latin capital letter l with acute")},{character:"ĺ",title:t("Latin small letter l with acute")},{character:"Ļ",title:t("Latin capital letter l with cedilla")},{character:"ļ",title:t("Latin small letter l with cedilla")},{character:"Ľ",title:t("Latin capital letter l with caron")},{character:"ľ",title:t("Latin small letter l with caron")},{character:"Ŀ",title:t("Latin capital letter l with middle dot")},{character:"ŀ",title:t("Latin small letter l with middle dot")},{character:"Ł",title:t("Latin capital letter l with stroke")},{character:"ł",title:t("Latin small letter l with stroke")},{character:"Ń",title:t("Latin capital letter n with acute")},{character:"ń",title:t("Latin small letter n with acute")},{character:"Ņ",title:t("Latin capital letter n with cedilla")},{character:"ņ",title:t("Latin small letter n with cedilla")},{character:"Ň",title:t("Latin capital letter n with caron")},{character:"ň",title:t("Latin small letter n with caron")},{character:"ŉ",title:t("Latin small letter n preceded by apostrophe")},{character:"Ŋ",title:t("Latin capital letter eng")},{character:"ŋ",title:t("Latin small letter eng")},{character:"Ō",title:t("Latin capital letter o with macron")},{character:"ō",title:t("Latin small letter o with macron")},{character:"Ŏ",title:t("Latin capital letter o with breve")},{character:"ŏ",title:t("Latin small letter o with breve")},{character:"Ő",title:t("Latin capital letter o with double acute")},{character:"ő",title:t("Latin small letter o with double acute")},{character:"Œ",title:t("Latin capital ligature oe")},{character:"œ",title:t("Latin small ligature oe")},{character:"Ŕ",title:t("Latin capital letter r with acute")},{character:"ŕ",title:t("Latin small letter r with acute")},{character:"Ŗ",title:t("Latin capital letter r with cedilla")},{character:"ŗ",title:t("Latin small letter r with cedilla")},{character:"Ř",title:t("Latin capital letter r with caron")},{character:"ř",title:t("Latin small letter r with caron")},{character:"Ś",title:t("Latin capital letter s with acute")},{character:"ś",title:t("Latin small letter s with acute")},{character:"Ŝ",title:t("Latin capital letter s with circumflex")},{character:"ŝ",title:t("Latin small letter s with circumflex")},{character:"Ş",title:t("Latin capital letter s with cedilla")},{character:"ş",title:t("Latin small letter s with cedilla")},{character:"Š",title:t("Latin capital letter s with caron")},{character:"š",title:t("Latin small letter s with caron")},{character:"Ţ",title:t("Latin capital letter t with cedilla")},{character:"ţ",title:t("Latin small letter t with cedilla")},{character:"Ť",title:t("Latin capital letter t with caron")},{character:"ť",title:t("Latin small letter t with caron")},{character:"Ŧ",title:t("Latin capital letter t with stroke")},{character:"ŧ",title:t("Latin small letter t with stroke")},{character:"Ũ",title:t("Latin capital letter u with tilde")},{character:"ũ",title:t("Latin small letter u with tilde")},{character:"Ū",title:t("Latin capital letter u with macron")},{character:"ū",title:t("Latin small letter u with macron")},{character:"Ŭ",title:t("Latin capital letter u with breve")},{character:"ŭ",title:t("Latin small letter u with breve")},{character:"Ů",title:t("Latin capital letter u with ring above")},{character:"ů",title:t("Latin small letter u with ring above")},{character:"Ű",title:t("Latin capital letter u with double acute")},{character:"ű",title:t("Latin small letter u with double acute")},{character:"Ų",title:t("Latin capital letter u with ogonek")},{character:"ų",title:t("Latin small letter u with ogonek")},{character:"Ŵ",title:t("Latin capital letter w with circumflex")},{character:"ŵ",title:t("Latin small letter w with circumflex")},{character:"Ŷ",title:t("Latin capital letter y with circumflex")},{character:"ŷ",title:t("Latin small letter y with circumflex")},{character:"Ÿ",title:t("Latin capital letter y with diaeresis")},{character:"Ź",title:t("Latin capital letter z with acute")},{character:"ź",title:t("Latin small letter z with acute")},{character:"Ż",title:t("Latin capital letter z with dot above")},{character:"ż",title:t("Latin small letter z with dot above")},{character:"Ž",title:t("Latin capital letter z with caron")},{character:"ž",title:t("Latin small letter z with caron")},{character:"ſ",title:t("Latin small letter long s")}],{label:t("Latin")})}}class SpecialCharactersCurrency extends Plugin{static get pluginName(){return"SpecialCharactersCurrency"}init(){const we=this.editor,t=we.t;we.plugins.get("SpecialCharacters").addItems("Currency",[{character:"$",title:t("Dollar sign")},{character:"€",title:t("Euro sign")},{character:"¥",title:t("Yen sign")},{character:"£",title:t("Pound sign")},{character:"¢",title:t("Cent sign")},{character:"₠",title:t("Euro-currency sign")},{character:"₡",title:t("Colon sign")},{character:"₢",title:t("Cruzeiro sign")},{character:"₣",title:t("French franc sign")},{character:"₤",title:t("Lira sign")},{character:"¤",title:t("Currency sign")},{character:"₿",title:t("Bitcoin sign")},{character:"₥",title:t("Mill sign")},{character:"₦",title:t("Naira sign")},{character:"₧",title:t("Peseta sign")},{character:"₨",title:t("Rupee sign")},{character:"₩",title:t("Won sign")},{character:"₪",title:t("New sheqel sign")},{character:"₫",title:t("Dong sign")},{character:"₭",title:t("Kip sign")},{character:"₮",title:t("Tugrik sign")},{character:"₯",title:t("Drachma sign")},{character:"₰",title:t("German penny sign")},{character:"₱",title:t("Peso sign")},{character:"₲",title:t("Guarani sign")},{character:"₳",title:t("Austral sign")},{character:"₴",title:t("Hryvnia sign")},{character:"₵",title:t("Cedi sign")},{character:"₶",title:t("Livre tournois sign")},{character:"₷",title:t("Spesmilo sign")},{character:"₸",title:t("Tenge sign")},{character:"₹",title:t("Indian rupee sign")},{character:"₺",title:t("Turkish lira sign")},{character:"₻",title:t("Nordic mark sign")},{character:"₼",title:t("Manat sign")},{character:"₽",title:t("Ruble sign")}],{label:t("Currency")})}}class SpecialCharactersEssentials extends Plugin{static get pluginName(){return"SpecialCharactersEssentials"}static get requires(){return[SpecialCharactersCurrency,SpecialCharactersText,SpecialCharactersMathematical,SpecialCharactersArrows,SpecialCharactersLatin]}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 *//**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function upcastStyleToAttribute(Te,we){const{modelAttribute:t,styleName:te,viewElement:be,defaultValue:xe,reduceBoxSides:ve=!1,shouldUpcast:ke=()=>!0}=we;Te.for("upcast").attributeToAttribute({view:{name:be,styles:{[te]:/[\s\S]+/}},model:{key:t,value:Ie=>{if(!ke(Ie))return;const Ae=Ie.getNormalizedStyle(te),Se=ve?reduceBoxSidesValue(Ae):Ae;if(xe!==Se)return Se}}})}function upcastBorderStyles(Te,we,t,te){Te.for("upcast").add(be=>be.on("element:"+we,(xe,ve,ke)=>{if(!ve.modelRange)return;const Ie=["border-top-width","border-top-color","border-top-style","border-bottom-width","border-bottom-color","border-bottom-style","border-right-width","border-right-color","border-right-style","border-left-width","border-left-color","border-left-style"].filter(Me=>ve.viewItem.hasStyle(Me));if(!Ie.length)return;const Ae={styles:Ie};if(!ke.consumable.test(ve.viewItem,Ae))return;const Se=[...ve.modelRange.getItems({shallow:!0})].pop();ke.consumable.consume(ve.viewItem,Ae);const Oe={style:ve.viewItem.getNormalizedStyle("border-style"),color:ve.viewItem.getNormalizedStyle("border-color"),width:ve.viewItem.getNormalizedStyle("border-width")},Ve={style:reduceBoxSidesValue(Oe.style),color:reduceBoxSidesValue(Oe.color),width:reduceBoxSidesValue(Oe.width)};Ve.style!==te.style&&ke.writer.setAttribute(t.style,Ve.style,Se),Ve.color!==te.color&&ke.writer.setAttribute(t.color,Ve.color,Se),Ve.width!==te.width&&ke.writer.setAttribute(t.width,Ve.width,Se)}))}function downcastAttributeToStyle(Te,we){const{modelElement:t,modelAttribute:te,styleName:be}=we;Te.for("downcast").attributeToAttribute({model:{name:t,key:te},view:xe=>({key:"style",value:{[be]:xe}})})}function downcastTableAttribute(Te,we){const{modelAttribute:t,styleName:te}=we;Te.for("downcast").add(be=>be.on(`attribute:${t}:table`,(xe,ve,ke)=>{const{item:Ie,attributeNewValue:Ae}=ve,{mapper:Se,writer:Oe}=ke;if(!ke.consumable.consume(ve.item,xe.name))return;const Ve=[...Se.toViewElement(Ie).getChildren()].find(Me=>Me.is("element","table"));Ae?Oe.setStyle(te,Ae,Ve):Oe.removeStyle(te,Ve)}))}function reduceBoxSidesValue(Te){if(!Te)return;const we=["top","right","bottom","left"];if(!we.every(xe=>Te[xe]))return Te;const te=Te.top;return we.every(xe=>Te[xe]===te)?te:Te}function updateNumericAttribute(Te,we,t,te,be=1){we!=null&&be!==void 0&&be!==null&&we>be?te.setAttribute(Te,we,t):te.removeAttribute(Te,t)}function createEmptyTableCell(Te,we,t={}){const te=Te.createElement("tableCell",t);return Te.insertElement("paragraph",te),Te.insert(te,we),te}function isHeadingColumnCell(Te,we){const t=we.parent.parent,te=parseInt(t.getAttribute("headingColumns")||"0"),{column:be}=Te.getCellLocation(we);return!!te&&be<te}function enableProperty$1(Te,we,t){const{modelAttribute:te}=t;Te.extend("tableCell",{allowAttributes:[te]}),upcastStyleToAttribute(we,{viewElement:/^(td|th)$/,...t}),downcastAttributeToStyle(we,{modelElement:"tableCell",...t})}function getSelectionAffectedTable(Te){const we=Te.getSelectedElement();return we&&we.is("element","table")?we:Te.getFirstPosition().findAncestor("table")}function upcastTableFigure(){return Te=>{Te.on("element:figure",(we,t,te)=>{if(!te.consumable.test(t.viewItem,{name:!0,classes:"table"}))return;const be=getViewTableFromFigure(t.viewItem);if(!be||!te.consumable.test(be,{name:!0}))return;te.consumable.consume(t.viewItem,{name:!0,classes:"table"});const xe=te.convertItem(be,t.modelCursor),ve=first(xe.modelRange.getItems());if(!ve){te.consumable.revert(t.viewItem,{name:!0,classes:"table"});return}te.convertChildren(t.viewItem,te.writer.createPositionAt(ve,"end")),te.updateConversionResult(ve,t)})}}function upcastTable(){return Te=>{Te.on("element:table",(we,t,te)=>{const be=t.viewItem;if(!te.consumable.test(be,{name:!0}))return;const{rows:xe,headingRows:ve,headingColumns:ke}=scanTable(be),Ie={};ke&&(Ie.headingColumns=ke),ve&&(Ie.headingRows=ve);const Ae=te.writer.createElement("table",Ie);if(te.safeInsert(Ae,t.modelCursor)){if(te.consumable.consume(be,{name:!0}),xe.forEach(Se=>te.convertItem(Se,te.writer.createPositionAt(Ae,"end"))),te.convertChildren(be,te.writer.createPositionAt(Ae,"end")),Ae.isEmpty){const Se=te.writer.createElement("tableRow");te.writer.insert(Se,te.writer.createPositionAt(Ae,"end")),createEmptyTableCell(te.writer,te.writer.createPositionAt(Se,"end"))}te.updateConversionResult(Ae,t)}})}}function skipEmptyTableRow(){return Te=>{Te.on("element:tr",(we,t)=>{t.viewItem.isEmpty&&t.modelCursor.index==0&&we.stop()},{priority:"high"})}}function ensureParagraphInTableCell(Te){return we=>{we.on(`element:${Te}`,(t,te,{writer:be})=>{if(!te.modelRange)return;const xe=te.modelRange.start.nodeAfter,ve=be.createPositionAt(xe,0);if(te.viewItem.isEmpty){be.insertElement("paragraph",ve);return}const ke=Array.from(xe.getChildren());if(ke.every(Ie=>Ie.is("element","$marker"))){const Ie=be.createElement("paragraph");be.insert(Ie,be.createPositionAt(xe,0));for(const Ae of ke)be.move(be.createRangeOn(Ae),be.createPositionAt(Ie,"end"))}},{priority:"low"})}}function getViewTableFromFigure(Te){for(const we of Te.getChildren())if(we.is("element","table"))return we}function scanTable(Te){let we=0,t;const te=[],be=[];let xe;for(const ve of Array.from(Te.getChildren())){if(ve.name!=="tbody"&&ve.name!=="thead"&&ve.name!=="tfoot")continue;ve.name==="thead"&&!xe&&(xe=ve);const ke=Array.from(ve.getChildren()).filter(Ie=>Ie.is("element","tr"));for(const Ie of ke)if(xe&&ve===xe||ve.name==="tbody"&&Array.from(Ie.getChildren()).length&&Array.from(Ie.getChildren()).every(Ae=>Ae.is("element","th")))we++,te.push(Ie);else{be.push(Ie);const Ae=scanRowForHeadingColumns(Ie);(!t||Ae<t)&&(t=Ae)}}return{headingRows:we,headingColumns:t||0,rows:[...te,...be]}}function scanRowForHeadingColumns(Te){let we=0,t=0;const te=Array.from(Te.getChildren()).filter(be=>be.name==="th"||be.name==="td");for(;t<te.length&&te[t].name==="th";){const be=te[t],xe=parseInt(be.getAttribute("colspan")||"1");we=we+xe,t++}return we}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class TableWalker{constructor(we,t={}){Re(this,"_table");Re(this,"_startRow");Re(this,"_endRow");Re(this,"_startColumn");Re(this,"_endColumn");Re(this,"_includeAllSlots");Re(this,"_skipRows");Re(this,"_row");Re(this,"_rowIndex");Re(this,"_column");Re(this,"_cellIndex");Re(this,"_spannedCells");Re(this,"_nextCellAtColumn");Re(this,"_jumpedToStartRow",!1);this._table=we,this._startRow=t.row!==void 0?t.row:t.startRow||0,this._endRow=t.row!==void 0?t.row:t.endRow,this._startColumn=t.column!==void 0?t.column:t.startColumn||0,this._endColumn=t.column!==void 0?t.column:t.endColumn,this._includeAllSlots=!!t.includeAllSlots,this._skipRows=new Set,this._row=0,this._rowIndex=0,this._column=0,this._cellIndex=0,this._spannedCells=new Map,this._nextCellAtColumn=-1}[Symbol.iterator](){return this}next(){this._canJumpToStartRow()&&this._jumpToNonSpannedRowClosestToStartRow();const we=this._table.getChild(this._rowIndex);if(!we||this._isOverEndRow())return{done:!0,value:void 0};if(!we.is("element","tableRow"))return this._rowIndex++,this.next();if(this._isOverEndColumn())return this._advanceToNextRow();let t=null;const te=this._getSpanned();if(te)this._includeAllSlots&&!this._shouldSkipSlot()&&(t=this._formatOutValue(te.cell,te.row,te.column));else{const be=we.getChild(this._cellIndex);if(!be)return this._advanceToNextRow();const xe=parseInt(be.getAttribute("colspan")||"1"),ve=parseInt(be.getAttribute("rowspan")||"1");(xe>1||ve>1)&&this._recordSpans(be,ve,xe),this._shouldSkipSlot()||(t=this._formatOutValue(be)),this._nextCellAtColumn=this._column+xe}return this._column++,this._column==this._nextCellAtColumn&&this._cellIndex++,t||this.next()}skipRow(we){this._skipRows.add(we)}_advanceToNextRow(){return this._row++,this._rowIndex++,this._column=0,this._cellIndex=0,this._nextCellAtColumn=-1,this.next()}_isOverEndRow(){return this._endRow!==void 0&&this._row>this._endRow}_isOverEndColumn(){return this._endColumn!==void 0&&this._column>this._endColumn}_formatOutValue(we,t=this._row,te=this._column){return{done:!1,value:new TableSlot(this,we,t,te)}}_shouldSkipSlot(){const we=this._skipRows.has(this._row),t=this._row<this._startRow,te=this._column<this._startColumn,be=this._endColumn!==void 0&&this._column>this._endColumn;return we||t||te||be}_getSpanned(){const we=this._spannedCells.get(this._row);return we&&we.get(this._column)||null}_recordSpans(we,t,te){const be={cell:we,row:this._row,column:this._column};for(let xe=this._row;xe<this._row+t;xe++)for(let ve=this._column;ve<this._column+te;ve++)(xe!=this._row||ve!=this._column)&&this._markSpannedCell(xe,ve,be)}_markSpannedCell(we,t,te){this._spannedCells.has(we)||this._spannedCells.set(we,new Map),this._spannedCells.get(we).set(t,te)}_canJumpToStartRow(){return!!this._startRow&&this._startRow>0&&!this._jumpedToStartRow}_jumpToNonSpannedRowClosestToStartRow(){const we=this._getRowLength(0);for(let t=this._startRow;!this._jumpedToStartRow;t--)we===this._getRowLength(t)&&(this._row=t,this._rowIndex=t,this._jumpedToStartRow=!0)}_getRowLength(we){return[...this._table.getChild(we).getChildren()].reduce((te,be)=>te+parseInt(be.getAttribute("colspan")||"1"),0)}}class TableSlot{constructor(we,t,te,be){Re(this,"cell");Re(this,"row");Re(this,"column");Re(this,"cellAnchorRow");Re(this,"cellAnchorColumn");Re(this,"_cellIndex");Re(this,"_rowIndex");Re(this,"_table");this.cell=t,this.row=we._row,this.column=we._column,this.cellAnchorRow=te,this.cellAnchorColumn=be,this._cellIndex=we._cellIndex,this._rowIndex=we._rowIndex,this._table=we._table}get isAnchor(){return this.row===this.cellAnchorRow&&this.column===this.cellAnchorColumn}get cellWidth(){return parseInt(this.cell.getAttribute("colspan")||"1")}get cellHeight(){return parseInt(this.cell.getAttribute("rowspan")||"1")}get rowIndex(){return this._rowIndex}getPositionBefore(){return this._table.root.document.model.createPositionAt(this._table.getChild(this.row),this._cellIndex)}}function downcastTable(Te,we){return(t,{writer:te})=>{const be=t.getAttribute("headingRows")||0,xe=te.createContainerElement("table",null,[]),ve=te.createContainerElement("figure",{class:"table"},xe);be>0&&te.insert(te.createPositionAt(xe,"end"),te.createContainerElement("thead",null,te.createSlot(ke=>ke.is("element","tableRow")&&ke.index<be))),be<Te.getRows(t)&&te.insert(te.createPositionAt(xe,"end"),te.createContainerElement("tbody",null,te.createSlot(ke=>ke.is("element","tableRow")&&ke.index>=be)));for(const{positionOffset:ke,filter:Ie}of we.additionalSlots)te.insert(te.createPositionAt(xe,ke),te.createSlot(Ie));return te.insert(te.createPositionAt(xe,"after"),te.createSlot(ke=>ke.is("element","tableRow")?!1:!we.additionalSlots.some(({filter:Ie})=>Ie(ke)))),we.asWidget?toTableWidget(ve,te):ve}}function downcastRow(){return(Te,{writer:we})=>Te.isEmpty?we.createEmptyElement("tr"):we.createContainerElement("tr")}function downcastCell(Te={}){return(we,{writer:t})=>{const te=we.parent,be=te.parent,xe=be.getChildIndex(te),ve=new TableWalker(be,{row:xe}),ke=be.getAttribute("headingRows")||0,Ie=be.getAttribute("headingColumns")||0;let Ae=null;for(const Se of ve)if(Se.cell==we){const Ve=Se.row<ke||Se.column<Ie?"th":"td";Ae=Te.asWidget?toWidgetEditable(t.createEditableElement(Ve),t):t.createContainerElement(Ve);break}return Ae}}function convertParagraphInTableCell(Te={}){return(we,{writer:t})=>{if(!we.parent.is("element","tableCell")||!isSingleParagraphWithoutAttributes(we))return null;if(Te.asWidget)return t.createContainerElement("span",{class:"ck-table-bogus-paragraph"});{const te=t.createContainerElement("p");return t.setCustomProperty("dataPipeline:transparentRendering",!0,te),te}}}function isSingleParagraphWithoutAttributes(Te){return Te.parent.childCount==1&&!hasAnyAttribute(Te)}function toTableWidget(Te,we){return we.setCustomProperty("table",!0,Te),toWidget(Te,we,{hasSelectionHandle:!0})}function hasAnyAttribute(Te){return!Te.getAttributeKeys().next().done}class InsertTableCommand extends Command{refresh(){const we=this.editor.model,t=we.document.selection,te=we.schema;this.isEnabled=isAllowedInParent(t,te)}execute(we={}){const t=this.editor,te=t.model,be=t.plugins.get("TableUtils"),xe=t.config.get("table.defaultHeadings.rows"),ve=t.config.get("table.defaultHeadings.columns");we.headingRows===void 0&&xe&&(we.headingRows=xe),we.headingColumns===void 0&&ve&&(we.headingColumns=ve),te.change(ke=>{const Ie=be.createTable(ke,we);te.insertObject(Ie,null,null,{findOptimalPosition:"auto"}),ke.setSelection(ke.createPositionAt(Ie.getNodeByPath([0,0,0]),0))})}}function isAllowedInParent(Te,we){const t=Te.getFirstPosition().parent,te=t===t.root?t:t.parent;return we.checkChild(te,"table")}class InsertRowCommand extends Command{constructor(t,te={}){super(t);Re(this,"order");this.order=te.order||"below"}refresh(){const t=this.editor.model.document.selection,be=!!this.editor.plugins.get("TableUtils").getSelectionAffectedTableCells(t).length;this.isEnabled=be}execute(){const t=this.editor,te=t.model.document.selection,be=t.plugins.get("TableUtils"),xe=this.order==="above",ve=be.getSelectionAffectedTableCells(te),ke=be.getRowIndexes(ve),Ie=xe?ke.first:ke.last,Ae=ve[0].findAncestor("table");be.insertRows(Ae,{at:xe?Ie:Ie+1,copyStructureFromAbove:!xe})}}class InsertColumnCommand extends Command{constructor(t,te={}){super(t);Re(this,"order");this.order=te.order||"right"}refresh(){const t=this.editor.model.document.selection,be=!!this.editor.plugins.get("TableUtils").getSelectionAffectedTableCells(t).length;this.isEnabled=be}execute(){const t=this.editor,te=t.model.document.selection,be=t.plugins.get("TableUtils"),xe=this.order==="left",ve=be.getSelectionAffectedTableCells(te),ke=be.getColumnIndexes(ve),Ie=xe?ke.first:ke.last,Ae=ve[0].findAncestor("table");be.insertColumns(Ae,{columns:1,at:xe?Ie:Ie+1})}}class SplitCellCommand extends Command{constructor(t,te={}){super(t);Re(this,"direction");this.direction=te.direction||"horizontally"}refresh(){const te=this.editor.plugins.get("TableUtils").getSelectionAffectedTableCells(this.editor.model.document.selection);this.isEnabled=te.length===1}execute(){const t=this.editor.plugins.get("TableUtils"),te=t.getSelectionAffectedTableCells(this.editor.model.document.selection)[0];this.direction==="horizontally"?t.splitCellHorizontally(te,2):t.splitCellVertically(te,2)}}function cropTableToDimensions(Te,we,t){const{startRow:te,startColumn:be,endRow:xe,endColumn:ve}=we,ke=t.createElement("table"),Ie=xe-te+1;for(let Se=0;Se<Ie;Se++)t.insertElement("tableRow",ke,"end");const Ae=[...new TableWalker(Te,{startRow:te,endRow:xe,startColumn:be,endColumn:ve,includeAllSlots:!0})];for(const{row:Se,column:Oe,cell:Ve,isAnchor:Me,cellAnchorRow:De,cellAnchorColumn:Fe}of Ae){const Be=Se-te,$e=ke.getChild(Be);if(!Me)(De<te||Fe<be)&&createEmptyTableCell(t,t.createPositionAt($e,"end"));else{const Ue=t.cloneElement(Ve);t.append(Ue,$e),trimTableCellIfNeeded(Ue,Se,Oe,xe,ve,t)}}return addHeadingsToCroppedTable(ke,Te,te,be,t),ke}function getVerticallyOverlappingCells(Te,we,t=0){const te=[],be=new TableWalker(Te,{startRow:t,endRow:we-1});for(const xe of be){const{row:ve,cellHeight:ke}=xe,Ie=ve+ke-1;ve<we&&we<=Ie&&te.push(xe)}return te}function splitHorizontally(Te,we,t){const te=Te.parent,be=te.parent,xe=te.index,ve=parseInt(Te.getAttribute("rowspan")),ke=we-xe,Ie={},Ae=ve-ke;Ae>1&&(Ie.rowspan=Ae);const Se=parseInt(Te.getAttribute("colspan")||"1");Se>1&&(Ie.colspan=Se);const Oe=xe,Ve=Oe+ke,Me=[...new TableWalker(be,{startRow:Oe,endRow:Ve,includeAllSlots:!0})];let De=null,Fe;for(const Be of Me){const{row:$e,column:Ue,cell:He}=Be;He===Te&&Fe===void 0&&(Fe=Ue),Fe!==void 0&&Fe===Ue&&$e===Ve&&(De=createEmptyTableCell(t,Be.getPositionBefore(),Ie))}return updateNumericAttribute("rowspan",ke,Te,t),De}function getHorizontallyOverlappingCells(Te,we){const t=[],te=new TableWalker(Te);for(const be of te){const{column:xe,cellWidth:ve}=be,ke=xe+ve-1;xe<we&&we<=ke&&t.push(be)}return t}function splitVertically(Te,we,t,te){const be=parseInt(Te.getAttribute("colspan")),xe=t-we,ve={},ke=be-xe;ke>1&&(ve.colspan=ke);const Ie=parseInt(Te.getAttribute("rowspan")||"1");Ie>1&&(ve.rowspan=Ie);const Ae=createEmptyTableCell(te,te.createPositionAfter(Te),ve);return updateNumericAttribute("colspan",xe,Te,te),Ae}function trimTableCellIfNeeded(Te,we,t,te,be,xe){const ve=parseInt(Te.getAttribute("colspan")||"1"),ke=parseInt(Te.getAttribute("rowspan")||"1");if(t+ve-1>be){const Se=be-t+1;updateNumericAttribute("colspan",Se,Te,xe,1)}if(we+ke-1>te){const Se=te-we+1;updateNumericAttribute("rowspan",Se,Te,xe,1)}}function addHeadingsToCroppedTable(Te,we,t,te,be){const xe=parseInt(we.getAttribute("headingRows")||"0");if(xe>0){const ke=xe-t;updateNumericAttribute("headingRows",ke,Te,be,0)}const ve=parseInt(we.getAttribute("headingColumns")||"0");if(ve>0){const ke=ve-te;updateNumericAttribute("headingColumns",ke,Te,be,0)}}function removeEmptyColumns(Te,we){const t=we.getColumns(Te),te=new Array(t).fill(0);for(const{column:xe}of new TableWalker(Te))te[xe]++;const be=te.reduce((xe,ve,ke)=>ve?xe:[...xe,ke],[]);if(be.length>0){const xe=be[be.length-1];return we.removeColumns(Te,{at:xe}),!0}return!1}function removeEmptyRows(Te,we){const t=[],te=we.getRows(Te);for(let be=0;be<te;be++)Te.getChild(be).isEmpty&&t.push(be);if(t.length>0){const be=t[t.length-1];return we.removeRows(Te,{at:be}),!0}return!1}function removeEmptyRowsColumns(Te,we){removeEmptyColumns(Te,we)||removeEmptyRows(Te,we)}function adjustLastRowIndex(Te,we){const t=Array.from(new TableWalker(Te,{startColumn:we.firstColumn,endColumn:we.lastColumn,row:we.lastRow}));if(t.every(({cellHeight:xe})=>xe===1))return we.lastRow;const be=t[0].cellHeight-1;return we.lastRow+be}function adjustLastColumnIndex(Te,we){const t=Array.from(new TableWalker(Te,{startRow:we.firstRow,endRow:we.lastRow,column:we.lastColumn}));if(t.every(({cellWidth:xe})=>xe===1))return we.lastColumn;const be=t[0].cellWidth-1;return we.lastColumn+be}class MergeCellCommand extends Command{constructor(t,te){super(t);Re(this,"direction");Re(this,"isHorizontal");this.direction=te.direction,this.isHorizontal=this.direction=="right"||this.direction=="left"}refresh(){const t=this._getMergeableCell();this.value=t,this.isEnabled=!!t}execute(){const t=this.editor.model,te=t.document,xe=this.editor.plugins.get("TableUtils").getTableCellsContainingSelection(te.selection)[0],ve=this.value,ke=this.direction;t.change(Ie=>{const Ae=ke=="right"||ke=="down",Se=Ae?xe:ve,Oe=Ae?ve:xe,Ve=Oe.parent;mergeTableCells$1(Oe,Se,Ie);const Me=this.isHorizontal?"colspan":"rowspan",De=parseInt(xe.getAttribute(Me)||"1"),Fe=parseInt(ve.getAttribute(Me)||"1");Ie.setAttribute(Me,De+Fe,Se),Ie.setSelection(Ie.createRangeIn(Se));const Be=this.editor.plugins.get("TableUtils"),$e=Ve.findAncestor("table");removeEmptyRowsColumns($e,Be)})}_getMergeableCell(){const te=this.editor.model.document,be=this.editor.plugins.get("TableUtils"),xe=be.getTableCellsContainingSelection(te.selection)[0];if(!xe)return;const ve=this.isHorizontal?getHorizontalCell(xe,this.direction,be):getVerticalCell(xe,this.direction,be);if(!ve)return;const ke=this.isHorizontal?"rowspan":"colspan",Ie=parseInt(xe.getAttribute(ke)||"1");if(parseInt(ve.getAttribute(ke)||"1")===Ie)return ve}}function getHorizontalCell(Te,we,t){const be=Te.parent.parent,xe=we=="right"?Te.nextSibling:Te.previousSibling,ve=(be.getAttribute("headingColumns")||0)>0;if(!xe)return;const ke=we=="right"?Te:xe,Ie=we=="right"?xe:Te,{column:Ae}=t.getCellLocation(ke),{column:Se}=t.getCellLocation(Ie),Oe=parseInt(ke.getAttribute("colspan")||"1"),Ve=isHeadingColumnCell(t,ke),Me=isHeadingColumnCell(t,Ie);return ve&&Ve!=Me?void 0:Ae+Oe===Se?xe:void 0}function getVerticalCell(Te,we,t){const te=Te.parent,be=te.parent,xe=be.getChildIndex(te);if(we=="down"&&xe===t.getRows(be)-1||we=="up"&&xe===0)return null;const ve=parseInt(Te.getAttribute("rowspan")||"1"),ke=be.getAttribute("headingRows")||0,Ie=we=="down"&&xe+ve===ke,Ae=we=="up"&&xe===ke;if(ke&&(Ie||Ae))return null;const Se=parseInt(Te.getAttribute("rowspan")||"1"),Oe=we=="down"?xe+Se:xe,Ve=[...new TableWalker(be,{endRow:Oe})],De=Ve.find(Be=>Be.cell===Te).column,Fe=Ve.find(({row:Be,cellHeight:$e,column:Ue})=>Ue!==De?!1:we=="down"?Be===Oe:Oe===Be+$e);return Fe&&Fe.cell?Fe.cell:null}function mergeTableCells$1(Te,we,t){isEmpty$2(Te)||(isEmpty$2(we)&&t.remove(t.createRangeIn(we)),t.move(t.createRangeIn(Te),t.createPositionAt(we,"end"))),t.remove(Te)}function isEmpty$2(Te){const we=Te.getChild(0);return Te.childCount==1&&we.is("element","paragraph")&&we.isEmpty}class RemoveRowCommand extends Command{refresh(){const we=this.editor.plugins.get("TableUtils"),t=we.getSelectionAffectedTableCells(this.editor.model.document.selection),te=t[0];if(te){const be=te.findAncestor("table"),ve=we.getRows(be)-1,ke=we.getRowIndexes(t),Ie=ke.first===0&&ke.last===ve;this.isEnabled=!Ie}else this.isEnabled=!1}execute(){const we=this.editor.model,t=this.editor.plugins.get("TableUtils"),te=t.getSelectionAffectedTableCells(we.document.selection),be=t.getRowIndexes(te),xe=te[0],ve=xe.findAncestor("table"),ke=t.getCellLocation(xe).column;we.change(Ie=>{const Ae=be.last-be.first+1;t.removeRows(ve,{at:be.first,rows:Ae});const Se=getCellToFocus$1(ve,be.first,ke,t.getRows(ve));Ie.setSelection(Ie.createPositionAt(Se,0))})}}function getCellToFocus$1(Te,we,t,te){const be=Te.getChild(Math.min(we,te-1));let xe=be.getChild(0),ve=0;for(const ke of be.getChildren()){if(ve>t)return xe;xe=ke,ve+=parseInt(ke.getAttribute("colspan")||"1")}return xe}class RemoveColumnCommand extends Command{refresh(){const we=this.editor.plugins.get("TableUtils"),t=we.getSelectionAffectedTableCells(this.editor.model.document.selection),te=t[0];if(te){const be=te.findAncestor("table"),xe=we.getColumns(be),{first:ve,last:ke}=we.getColumnIndexes(t);this.isEnabled=ke-ve<xe-1}else this.isEnabled=!1}execute(){const we=this.editor.plugins.get("TableUtils"),[t,te]=getBoundaryCells(this.editor.model.document.selection,we),be=t.parent.parent,xe=[...new TableWalker(be)],ve={first:xe.find(Ie=>Ie.cell===t).column,last:xe.find(Ie=>Ie.cell===te).column},ke=getCellToFocus(xe,t,te,ve);this.editor.model.change(Ie=>{const Ae=ve.last-ve.first+1;we.removeColumns(be,{at:ve.first,columns:Ae}),Ie.setSelection(Ie.createPositionAt(ke,0))})}}function getCellToFocus(Te,we,t,te){return parseInt(t.getAttribute("colspan")||"1")>1?t:we.previousSibling||t.nextSibling?t.nextSibling||we.previousSibling:te.first?Te.reverse().find(({column:xe})=>xe<te.first).cell:Te.reverse().find(({column:xe})=>xe>te.last).cell}function getBoundaryCells(Te,we){const t=we.getSelectionAffectedTableCells(Te),te=t[0],be=t.pop(),xe=[te,be];return te.isBefore(be)?xe:xe.reverse()}class SetHeaderRowCommand extends Command{refresh(){const we=this.editor.plugins.get("TableUtils"),t=this.editor.model,te=we.getSelectionAffectedTableCells(t.document.selection),be=te.length>0;this.isEnabled=be,this.value=be&&te.every(xe=>this._isInHeading(xe,xe.parent.parent))}execute(we={}){if(we.forceValue===this.value)return;const t=this.editor.plugins.get("TableUtils"),te=this.editor.model,be=t.getSelectionAffectedTableCells(te.document.selection),xe=be[0].findAncestor("table"),{first:ve,last:ke}=t.getRowIndexes(be),Ie=this.value?ve:ke+1,Ae=xe.getAttribute("headingRows")||0;te.change(Se=>{if(Ie){const Oe=Ie>Ae?Ae:0,Ve=getVerticallyOverlappingCells(xe,Ie,Oe);for(const{cell:Me}of Ve)splitHorizontally(Me,Ie,Se)}updateNumericAttribute("headingRows",Ie,xe,Se,0)})}_isInHeading(we,t){const te=parseInt(t.getAttribute("headingRows")||"0");return!!te&&we.parent.index<te}}class SetHeaderColumnCommand extends Command{refresh(){const we=this.editor.model,t=this.editor.plugins.get("TableUtils"),te=t.getSelectionAffectedTableCells(we.document.selection),be=te.length>0;this.isEnabled=be,this.value=be&&te.every(xe=>isHeadingColumnCell(t,xe))}execute(we={}){if(we.forceValue===this.value)return;const t=this.editor.plugins.get("TableUtils"),te=this.editor.model,be=t.getSelectionAffectedTableCells(te.document.selection),xe=be[0].findAncestor("table"),{first:ve,last:ke}=t.getColumnIndexes(be),Ie=this.value?ve:ke+1;te.change(Ae=>{if(Ie){const Se=getHorizontallyOverlappingCells(xe,Ie);for(const{cell:Oe,column:Ve}of Se)splitVertically(Oe,Ve,Ie,Ae)}updateNumericAttribute("headingColumns",Ie,xe,Ae,0)})}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const COLUMN_MIN_WIDTH_AS_PERCENTAGE=5,COLUMN_MIN_WIDTH_IN_PIXELS=40,COLUMN_WIDTH_PRECISION=2;function getChangedResizedTables(Te){const we=new Set;for(const t of Te.document.differ.getChanges()){let te=null;switch(t.type){case"insert":te=["table","tableRow","tableCell"].includes(t.name)?t.position:null;break;case"remove":te=["tableRow","tableCell"].includes(t.name)?t.position:null;break;case"attribute":t.range.start.nodeAfter&&(te=["table","tableRow","tableCell"].includes(t.range.start.nodeAfter.name)?t.range.start:null);break}if(!te)continue;const be=te.nodeAfter&&te.nodeAfter.is("element","table")?te.nodeAfter:te.findAncestor("table");for(const xe of Te.createRangeOn(be).getItems())xe.is("element","table")&&getColumnGroupElement(xe)&&we.add(xe)}return we}function getColumnMinWidthAsPercentage(Te,we){return COLUMN_MIN_WIDTH_IN_PIXELS*100/getTableWidthInPixels(Te,we)}function getTableWidthInPixels(Te,we){const t=getChildrenViewElement(Te,"tbody",we)||getChildrenViewElement(Te,"thead",we),te=we.editing.view.domConverter.mapViewToDom(t);return getElementWidthInPixels(te)}function getChildrenViewElement(Te,we,t){return[...[...t.editing.mapper.toViewElement(Te).getChildren()].find(xe=>xe.is("element","table")).getChildren()].find(xe=>xe.is("element",we))}function getElementWidthInPixels(Te){const we=global.window.getComputedStyle(Te);return we.boxSizing==="border-box"?parseFloat(we.width)-parseFloat(we.paddingLeft)-parseFloat(we.paddingRight)-parseFloat(we.borderLeftWidth)-parseFloat(we.borderRightWidth):parseFloat(we.width)}function getColumnEdgesIndexes(Te,we){const t=we.getCellLocation(Te).column,te=Te.getAttribute("colspan")||1;return{leftEdge:t,rightEdge:t+te-1}}function toPrecision(Te){const we=Math.pow(10,COLUMN_WIDTH_PRECISION),t=typeof Te=="number"?Te:parseFloat(Te);return Math.round(t*we)/we}function clamp(Te,we,t){return Te<=we?toPrecision(we):Te>=t?toPrecision(t):toPrecision(Te)}function createFilledArray(Te,we){return Array(Te).fill(we)}function sumArray(Te){return Te.map(we=>typeof we=="number"?we:parseFloat(we)).filter(we=>!Number.isNaN(we)).reduce((we,t)=>we+t,0)}function normalizeColumnWidths(Te){const we=Te.map(be=>be==="auto"?be:parseFloat(be.replace("%","")));let t=calculateMissingColumnWidths(we);const te=sumArray(t);return te!==100&&(t=t.map(be=>toPrecision(be*100/te)).map((be,xe,ve)=>{if(!(xe===ve.length-1))return be;const Ie=sumArray(ve);return toPrecision(be+100-Ie)})),t.map(be=>be+"%")}function calculateMissingColumnWidths(Te){const we=Te.filter(be=>be==="auto").length;if(we===0)return Te.map(be=>toPrecision(be));const t=sumArray(Te),te=Math.max((100-t)/we,COLUMN_MIN_WIDTH_AS_PERCENTAGE);return Te.map(be=>be==="auto"?te:be).map(be=>toPrecision(be))}function getDomCellOuterWidth(Te){const we=global.window.getComputedStyle(Te);return we.boxSizing==="border-box"?parseInt(we.width):parseFloat(we.width)+parseFloat(we.paddingLeft)+parseFloat(we.paddingRight)+parseFloat(we.borderWidth)}function updateColumnElements(Te,we,t,te){for(let be=0;be<Math.max(t.length,Te.length);be++){const xe=Te[be],ve=t[be];ve?xe?te.setAttribute("columnWidth",ve,xe):te.appendElement("tableColumn",{columnWidth:ve},we):te.remove(xe)}}function getColumnGroupElement(Te){if(Te.is("element","tableColumnGroup"))return Te;const we=Te.getChildren();return Array.from(we).find(t=>t.is("element","tableColumnGroup"))}function getTableColumnElements(Te){const we=getColumnGroupElement(Te);return we?Array.from(we.getChildren()):[]}function getTableColumnsWidths(Te){return getTableColumnElements(Te).map(we=>we.getAttribute("columnWidth"))}function translateColSpanAttribute(Te,we){return getTableColumnElements(Te).reduce((te,be)=>{const xe=be.getAttribute("columnWidth"),ve=be.getAttribute("colSpan");if(!ve)return te.push(xe),te;for(let ke=0;ke<ve;ke++)te.push(xe);return we.removeAttribute("colSpan",be),te},[])}class TableUtils extends Plugin{static get pluginName(){return"TableUtils"}init(){this.decorate("insertColumns"),this.decorate("insertRows")}getCellLocation(we){const t=we.parent,te=t.parent,be=te.getChildIndex(t),xe=new TableWalker(te,{row:be});for(const{cell:ve,row:ke,column:Ie}of xe)if(ve===we)return{row:ke,column:Ie};/* istanbul ignore next -- @preserve */}createTable(we,t){const te=we.createElement("table"),be=t.rows||2,xe=t.columns||2;return createEmptyRows(we,te,0,be,xe),t.headingRows&&updateNumericAttribute("headingRows",Math.min(t.headingRows,be),te,we,0),t.headingColumns&&updateNumericAttribute("headingColumns",Math.min(t.headingColumns,xe),te,we,0),te}insertRows(we,t={}){const te=this.editor.model,be=t.at||0,xe=t.rows||1,ve=t.copyStructureFromAbove!==void 0,ke=t.copyStructureFromAbove?be-1:be,Ie=this.getRows(we),Ae=this.getColumns(we);if(be>Ie)throw new CKEditorError("tableutils-insertrows-insert-out-of-range",this,{options:t});te.change(Se=>{const Oe=we.getAttribute("headingRows")||0;if(Oe>be&&updateNumericAttribute("headingRows",Oe+xe,we,Se,0),!ve&&(be===0||be===Ie)){createEmptyRows(Se,we,be,xe,Ae);return}const Ve=ve?Math.max(be,ke):be,Me=new TableWalker(we,{endRow:Ve}),De=new Array(Ae).fill(1);for(const{row:Fe,column:Be,cellHeight:$e,cellWidth:Ue,cell:He}of Me){const ze=Fe+$e-1,qe=Fe<be&&be<=ze,Ke=Fe<=ke&&ke<=ze;qe?(Se.setAttribute("rowspan",$e+xe,He),De[Be]=-Ue):ve&&Ke&&(De[Be]=Ue)}for(let Fe=0;Fe<xe;Fe++){const Be=Se.createElement("tableRow");Se.insert(Be,we,be);for(let $e=0;$e<De.length;$e++){const Ue=De[$e],He=Se.createPositionAt(Be,"end");Ue>0&&createEmptyTableCell(Se,He,Ue>1?{colspan:Ue}:void 0),$e+=Math.abs(Ue)-1}}})}insertColumns(we,t={}){const te=this.editor.model,be=t.at||0,xe=t.columns||1;te.change(ve=>{const ke=we.getAttribute("headingColumns");be<ke&&ve.setAttribute("headingColumns",ke+xe,we);const Ie=this.getColumns(we);if(be===0||Ie===be){for(const Se of we.getChildren())Se.is("element","tableRow")&&createCells(xe,ve,ve.createPositionAt(Se,be?"end":0));return}const Ae=new TableWalker(we,{column:be,includeAllSlots:!0});for(const Se of Ae){const{row:Oe,cell:Ve,cellAnchorColumn:Me,cellAnchorRow:De,cellWidth:Fe,cellHeight:Be}=Se;if(Me<be){ve.setAttribute("colspan",Fe+xe,Ve);const $e=De+Be-1;for(let Ue=Oe;Ue<=$e;Ue++)Ae.skipRow(Ue)}else createCells(xe,ve,Se.getPositionBefore())}})}removeRows(we,t){const te=this.editor.model,be=t.rows||1,xe=this.getRows(we),ve=t.at,ke=ve+be-1;if(ke>xe-1)throw new CKEditorError("tableutils-removerows-row-index-out-of-range",this,{table:we,options:t});te.change(Ie=>{const Ae={first:ve,last:ke},{cellsToMove:Se,cellsToTrim:Oe}=getCellsToMoveAndTrimOnRemoveRow(we,Ae);if(Se.size){const Ve=ke+1;moveCellsToRow(we,Ve,Se,Ie)}for(let Ve=ke;Ve>=ve;Ve--)Ie.remove(we.getChild(Ve));for(const{rowspan:Ve,cell:Me}of Oe)updateNumericAttribute("rowspan",Ve,Me,Ie);updateHeadingRows(we,Ae,Ie),removeEmptyColumns(we,this)||removeEmptyRows(we,this)})}removeColumns(we,t){const te=this.editor.model,be=t.at,xe=t.columns||1,ve=t.at+xe-1;te.change(ke=>{adjustHeadingColumns(we,{first:be,last:ve},ke);const Ie=getTableColumnElements(we);for(let Ae=ve;Ae>=be;Ae--){for(const{cell:Se,column:Oe,cellWidth:Ve}of[...new TableWalker(we)])Oe<=Ae&&Ve>1&&Oe+Ve>Ae?updateNumericAttribute("colspan",Ve-1,Se,ke):Oe===Ae&&ke.remove(Se);if(Ie[Ae]){const Se=Ae===0?Ie[1]:Ie[Ae-1],Oe=parseFloat(Ie[Ae].getAttribute("columnWidth")),Ve=parseFloat(Se.getAttribute("columnWidth"));ke.remove(Ie[Ae]),ke.setAttribute("columnWidth",Oe+Ve+"%",Se)}}removeEmptyRows(we,this)||removeEmptyColumns(we,this)})}splitCellVertically(we,t=2){const te=this.editor.model,xe=we.parent.parent,ve=parseInt(we.getAttribute("rowspan")||"1"),ke=parseInt(we.getAttribute("colspan")||"1");te.change(Ie=>{if(ke>1){const{newCellsSpan:Ae,updatedSpan:Se}=breakSpanEvenly(ke,t);updateNumericAttribute("colspan",Se,we,Ie);const Oe={};Ae>1&&(Oe.colspan=Ae),ve>1&&(Oe.rowspan=ve);const Ve=ke>t?t-1:ke-1;createCells(Ve,Ie,Ie.createPositionAfter(we),Oe)}if(ke<t){const Ae=t-ke,Se=[...new TableWalker(xe)],{column:Oe}=Se.find(({cell:Fe})=>Fe===we),Ve=Se.filter(({cell:Fe,cellWidth:Be,column:$e})=>{const Ue=Fe!==we&&$e===Oe,He=$e<Oe&&$e+Be>Oe;return Ue||He});for(const{cell:Fe,cellWidth:Be}of Ve)Ie.setAttribute("colspan",Be+Ae,Fe);const Me={};ve>1&&(Me.rowspan=ve),createCells(Ae,Ie,Ie.createPositionAfter(we),Me);const De=xe.getAttribute("headingColumns")||0;De>Oe&&updateNumericAttribute("headingColumns",De+Ae,xe,Ie)}})}splitCellHorizontally(we,t=2){const te=this.editor.model,be=we.parent,xe=be.parent,ve=xe.getChildIndex(be),ke=parseInt(we.getAttribute("rowspan")||"1"),Ie=parseInt(we.getAttribute("colspan")||"1");te.change(Ae=>{if(ke>1){const Se=[...new TableWalker(xe,{startRow:ve,endRow:ve+ke-1,includeAllSlots:!0})],{newCellsSpan:Oe,updatedSpan:Ve}=breakSpanEvenly(ke,t);updateNumericAttribute("rowspan",Ve,we,Ae);const{column:Me}=Se.find(({cell:Fe})=>Fe===we),De={};Oe>1&&(De.rowspan=Oe),Ie>1&&(De.colspan=Ie);for(const Fe of Se){const{column:Be,row:$e}=Fe,Ue=$e>=ve+Ve,He=Be===Me,ze=($e+ve+Ve)%Oe===0;Ue&&He&&ze&&createCells(1,Ae,Fe.getPositionBefore(),De)}}if(ke<t){const Se=t-ke,Oe=[...new TableWalker(xe,{startRow:0,endRow:ve})];for(const{cell:De,cellHeight:Fe,row:Be}of Oe)if(De!==we&&Be+Fe>ve){const $e=Fe+Se;Ae.setAttribute("rowspan",$e,De)}const Ve={};Ie>1&&(Ve.colspan=Ie),createEmptyRows(Ae,xe,ve+1,Se,1,Ve);const Me=xe.getAttribute("headingRows")||0;Me>ve&&updateNumericAttribute("headingRows",Me+Se,xe,Ae)}})}getColumns(we){return[...we.getChild(0).getChildren()].filter(te=>te.is("element","tableCell")).reduce((te,be)=>{const xe=parseInt(be.getAttribute("colspan")||"1");return te+xe},0)}getRows(we){return Array.from(we.getChildren()).reduce((t,te)=>te.is("element","tableRow")?t+1:t,0)}createTableWalker(we,t={}){return new TableWalker(we,t)}getSelectedTableCells(we){const t=[];for(const te of this.sortRanges(we.getRanges())){const be=te.getContainedElement();be&&be.is("element","tableCell")&&t.push(be)}return t}getTableCellsContainingSelection(we){const t=[];for(const te of we.getRanges()){const be=te.start.findAncestor("tableCell");be&&t.push(be)}return t}getSelectionAffectedTableCells(we){const t=this.getSelectedTableCells(we);return t.length?t:this.getTableCellsContainingSelection(we)}getRowIndexes(we){const t=we.map(te=>te.parent.index);return this._getFirstLastIndexesObject(t)}getColumnIndexes(we){const t=we[0].findAncestor("table"),be=[...new TableWalker(t)].filter(xe=>we.includes(xe.cell)).map(xe=>xe.column);return this._getFirstLastIndexesObject(be)}isSelectionRectangular(we){if(we.length<2||!this._areCellInTheSameTableSection(we))return!1;const t=new Set,te=new Set;let be=0;for(const ve of we){const{row:ke,column:Ie}=this.getCellLocation(ve),Ae=parseInt(ve.getAttribute("rowspan"))||1,Se=parseInt(ve.getAttribute("colspan"))||1;t.add(ke),te.add(Ie),Ae>1&&t.add(ke+Ae-1),Se>1&&te.add(Ie+Se-1),be+=Ae*Se}return getBiggestRectangleArea(t,te)==be}sortRanges(we){return Array.from(we).sort(compareRangeOrder)}_getFirstLastIndexesObject(we){const t=we.sort((xe,ve)=>xe-ve),te=t[0],be=t[t.length-1];return{first:te,last:be}}_areCellInTheSameTableSection(we){const t=we[0].findAncestor("table"),te=this.getRowIndexes(we),be=parseInt(t.getAttribute("headingRows"))||0;if(!this._areIndexesInSameSection(te,be))return!1;const xe=this.getColumnIndexes(we),ve=parseInt(t.getAttribute("headingColumns"))||0;return this._areIndexesInSameSection(xe,ve)}_areIndexesInSameSection({first:we,last:t},te){const be=we<te,xe=t<te;return be===xe}}function createEmptyRows(Te,we,t,te,be,xe={}){for(let ve=0;ve<te;ve++){const ke=Te.createElement("tableRow");Te.insert(ke,we,t),createCells(be,Te,Te.createPositionAt(ke,"end"),xe)}}function createCells(Te,we,t,te={}){for(let be=0;be<Te;be++)createEmptyTableCell(we,t,te)}function breakSpanEvenly(Te,we){if(Te<we)return{newCellsSpan:1,updatedSpan:1};const t=Math.floor(Te/we),te=Te-t*we+t;return{newCellsSpan:t,updatedSpan:te}}function adjustHeadingColumns(Te,we,t){const te=Te.getAttribute("headingColumns")||0;if(te&&we.first<te){const be=Math.min(te-1,we.last)-we.first+1;t.setAttribute("headingColumns",te-be,Te)}}function updateHeadingRows(Te,{first:we,last:t},te){const be=Te.getAttribute("headingRows")||0;if(we<be){const xe=t<be?be-(t-we+1):we;updateNumericAttribute("headingRows",xe,Te,te,0)}}function getCellsToMoveAndTrimOnRemoveRow(Te,{first:we,last:t}){const te=new Map,be=[];for(const{row:xe,column:ve,cellHeight:ke,cell:Ie}of new TableWalker(Te,{endRow:t})){const Ae=xe+ke-1;if(xe>=we&&xe<=t&&Ae>t){const Ve=t-xe+1,Me=ke-Ve;te.set(ve,{cell:Ie,rowspan:Me})}if(xe<we&&Ae>=we){let Ve;Ae>=t?Ve=t-we+1:Ve=Ae-we+1,be.push({cell:Ie,rowspan:ke-Ve})}}return{cellsToMove:te,cellsToTrim:be}}function moveCellsToRow(Te,we,t,te){const xe=[...new TableWalker(Te,{includeAllSlots:!0,row:we})],ve=Te.getChild(we);let ke;for(const{column:Ie,cell:Ae,isAnchor:Se}of xe)if(t.has(Ie)){const{cell:Oe,rowspan:Ve}=t.get(Ie),Me=ke?te.createPositionAfter(ke):te.createPositionAt(ve,0);te.move(te.createRangeOn(Oe),Me),updateNumericAttribute("rowspan",Ve,Oe,te),ke=Oe}else Se&&(ke=Ae)}function compareRangeOrder(Te,we){const t=Te.start,te=we.start;return t.isBefore(te)?-1:1}function getBiggestRectangleArea(Te,we){const t=Array.from(Te.values()),te=Array.from(we.values()),be=Math.max(...t),xe=Math.min(...t),ve=Math.max(...te),ke=Math.min(...te);return(be-xe+1)*(ve-ke+1)}class MergeCellsCommand extends Command{refresh(){const we=this.editor.plugins.get(TableUtils),t=we.getSelectedTableCells(this.editor.model.document.selection);this.isEnabled=we.isSelectionRectangular(t)}execute(){const we=this.editor.model,t=this.editor.plugins.get(TableUtils);we.change(te=>{const be=t.getSelectedTableCells(we.document.selection),xe=be.shift(),{mergeWidth:ve,mergeHeight:ke}=getMergeDimensions(xe,be,t);updateNumericAttribute("colspan",ve,xe,te),updateNumericAttribute("rowspan",ke,xe,te);for(const Ae of be)mergeTableCells(Ae,xe,te);const Ie=xe.findAncestor("table");removeEmptyRowsColumns(Ie,t),te.setSelection(xe,"in")})}}function mergeTableCells(Te,we,t){isEmpty$1(Te)||(isEmpty$1(we)&&t.remove(t.createRangeIn(we)),t.move(t.createRangeIn(Te),t.createPositionAt(we,"end"))),t.remove(Te)}function isEmpty$1(Te){const we=Te.getChild(0);return Te.childCount==1&&we.is("element","paragraph")&&we.isEmpty}function getMergeDimensions(Te,we,t){let te=0,be=0;for(const Ae of we){const{row:Se,column:Oe}=t.getCellLocation(Ae);te=getMaxOffset(Ae,Oe,te,"colspan"),be=getMaxOffset(Ae,Se,be,"rowspan")}const{row:xe,column:ve}=t.getCellLocation(Te),ke=te-ve,Ie=be-xe;return{mergeWidth:ke,mergeHeight:Ie}}function getMaxOffset(Te,we,t,te){const be=parseInt(Te.getAttribute(te)||"1");return Math.max(t,we+be)}class SelectRowCommand extends Command{constructor(we){super(we),this.affectsData=!1}refresh(){const t=this.editor.plugins.get("TableUtils").getSelectionAffectedTableCells(this.editor.model.document.selection);this.isEnabled=t.length>0}execute(){const we=this.editor.model,t=this.editor.plugins.get("TableUtils"),te=t.getSelectionAffectedTableCells(we.document.selection),be=t.getRowIndexes(te),xe=te[0].findAncestor("table"),ve=[];for(let ke=be.first;ke<=be.last;ke++)for(const Ie of xe.getChild(ke).getChildren())ve.push(we.createRangeOn(Ie));we.change(ke=>{ke.setSelection(ve)})}}class SelectColumnCommand extends Command{constructor(we){super(we),this.affectsData=!1}refresh(){const t=this.editor.plugins.get("TableUtils").getSelectionAffectedTableCells(this.editor.model.document.selection);this.isEnabled=t.length>0}execute(){const we=this.editor.plugins.get("TableUtils"),t=this.editor.model,te=we.getSelectionAffectedTableCells(t.document.selection),be=te[0],xe=te.pop(),ve=be.findAncestor("table"),ke=we.getCellLocation(be),Ie=we.getCellLocation(xe),Ae=Math.min(ke.column,Ie.column),Se=Math.max(ke.column,Ie.column),Oe=[];for(const Ve of new TableWalker(ve,{startColumn:Ae,endColumn:Se}))Oe.push(t.createRangeOn(Ve.cell));t.change(Ve=>{Ve.setSelection(Oe)})}}function injectTableLayoutPostFixer(Te){Te.document.registerPostFixer(we=>tableLayoutPostFixer(we,Te))}function tableLayoutPostFixer(Te,we){const t=we.document.differ.getChanges();let te=!1;const be=new Set;for(const xe of t){let ve=null;xe.type=="insert"&&xe.name=="table"&&(ve=xe.position.nodeAfter),(xe.type=="insert"||xe.type=="remove")&&(xe.name=="tableRow"||xe.name=="tableCell")&&(ve=xe.position.findAncestor("table")),isTableAttributeEntry(xe)&&(ve=xe.range.start.findAncestor("table")),ve&&!be.has(ve)&&(te=fixTableCellsRowspan(ve,Te)||te,te=fixTableRowsSizes(ve,Te)||te,be.add(ve))}return te}function fixTableCellsRowspan(Te,we){let t=!1;const te=findCellsToTrim(Te);if(te.length){t=!0;for(const be of te)updateNumericAttribute("rowspan",be.rowspan,be.cell,we,1)}return t}function fixTableRowsSizes(Te,we){let t=!1;const te=getChildrenLengths(Te),be=[];for(const[Ie,Ae]of te.entries())!Ae&&Te.getChild(Ie).is("element","tableRow")&&be.push(Ie);if(be.length){t=!0;for(const Ie of be.reverse())we.remove(Te.getChild(Ie)),te.splice(Ie,1)}const xe=te.filter((Ie,Ae)=>Te.getChild(Ae).is("element","tableRow")),ve=xe[0];if(!xe.every(Ie=>Ie===ve)){const Ie=xe.reduce((Ae,Se)=>Se>Ae?Se:Ae,0);for(const[Ae,Se]of xe.entries()){const Oe=Ie-Se;if(Oe){for(let Ve=0;Ve<Oe;Ve++)createEmptyTableCell(we,we.createPositionAt(Te.getChild(Ae),"end"));t=!0}}}return t}function findCellsToTrim(Te){const we=parseInt(Te.getAttribute("headingRows")||"0"),t=Array.from(Te.getChildren()).reduce((be,xe)=>xe.is("element","tableRow")?be+1:be,0),te=[];for(const{row:be,cell:xe,cellHeight:ve}of new TableWalker(Te)){if(ve<2)continue;const Ie=be<we?we:t;if(be+ve>Ie){const Ae=Ie-be;te.push({cell:xe,rowspan:Ae})}}return te}function getChildrenLengths(Te){const we=new Array(Te.childCount).fill(0);for(const{rowIndex:t}of new TableWalker(Te,{includeAllSlots:!0}))we[t]++;return we}function isTableAttributeEntry(Te){if(Te.type!=="attribute")return!1;const we=Te.attributeKey;return we==="headingRows"||we==="colspan"||we==="rowspan"}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function injectTableCellParagraphPostFixer(Te){Te.document.registerPostFixer(we=>tableCellContentsPostFixer(we,Te))}function tableCellContentsPostFixer(Te,we){const t=we.document.differ.getChanges();let te=!1;for(const be of t)be.type=="insert"&&be.name=="table"&&(te=fixTable(be.position.nodeAfter,Te)||te),be.type=="insert"&&be.name=="tableRow"&&(te=fixTableRow(be.position.nodeAfter,Te)||te),be.type=="insert"&&be.name=="tableCell"&&(te=fixTableCellContent(be.position.nodeAfter,Te)||te),(be.type=="remove"||be.type=="insert")&&checkTableCellChange(be)&&(te=fixTableCellContent(be.position.parent,Te)||te);return te}function fixTable(Te,we){let t=!1;for(const te of Te.getChildren())te.is("element","tableRow")&&(t=fixTableRow(te,we)||t);return t}function fixTableRow(Te,we){let t=!1;for(const te of Te.getChildren())t=fixTableCellContent(te,we)||t;return t}function fixTableCellContent(Te,we){if(Te.childCount==0)return we.insertElement("paragraph",Te),!0;const t=Array.from(Te.getChildren()).filter(te=>te.is("$text"));for(const te of t)we.wrap(we.createRangeOn(te),"paragraph");return!!t.length}function checkTableCellChange(Te){return Te.position.parent.is("element","tableCell")?Te.type=="insert"&&Te.name=="$text"||Te.type=="remove":!1}function tableHeadingsRefreshHandler(Te,we){const t=Te.document.differ;for(const te of t.getChanges()){let be,xe=!1;if(te.type=="attribute"){const Ae=te.range.start.nodeAfter;if(!Ae||!Ae.is("element","table")||te.attributeKey!="headingRows"&&te.attributeKey!="headingColumns")continue;be=Ae,xe=te.attributeKey=="headingRows"}else(te.name=="tableRow"||te.name=="tableCell")&&(be=te.position.findAncestor("table"),xe=te.name=="tableRow");if(!be)continue;const ve=be.getAttribute("headingRows")||0,ke=be.getAttribute("headingColumns")||0,Ie=new TableWalker(be);for(const Ae of Ie){const Oe=Ae.row<ve||Ae.column<ke?"th":"td",Ve=we.mapper.toViewElement(Ae.cell);Ve&&Ve.is("element")&&Ve.name!=Oe&&we.reconvertItem(xe?Ae.cell.parent:Ae.cell)}}}function tableCellRefreshHandler(Te,we){const t=Te.document.differ,te=new Set;for(const be of t.getChanges()){const xe=be.type=="attribute"?be.range.start.parent:be.position.parent;xe.is("element","tableCell")&&te.add(xe)}for(const be of te.values()){const xe=Array.from(be.getChildren()).filter(ve=>shouldRefresh(ve,we.mapper));for(const ve of xe)we.reconvertItem(ve)}}function shouldRefresh(Te,we){if(!Te.is("element","paragraph"))return!1;const t=we.toViewElement(Te);return t?isSingleParagraphWithoutAttributes(Te)!==t.is("element","span"):!1}class TableEditing extends Plugin{constructor(t){super(t);Re(this,"_additionalSlots");this._additionalSlots=[]}static get pluginName(){return"TableEditing"}static get requires(){return[TableUtils]}init(){const t=this.editor,te=t.model,be=te.schema,xe=t.conversion,ve=t.plugins.get(TableUtils);be.register("table",{inheritAllFrom:"$blockObject",allowAttributes:["headingRows","headingColumns"]}),be.register("tableRow",{allowIn:"table",isLimit:!0}),be.register("tableCell",{allowContentOf:"$container",allowIn:"tableRow",allowAttributes:["colspan","rowspan"],isLimit:!0,isSelectable:!0}),xe.for("upcast").add(upcastTableFigure()),xe.for("upcast").add(upcastTable()),xe.for("editingDowncast").elementToStructure({model:{name:"table",attributes:["headingRows"]},view:downcastTable(ve,{asWidget:!0,additionalSlots:this._additionalSlots})}),xe.for("dataDowncast").elementToStructure({model:{name:"table",attributes:["headingRows"]},view:downcastTable(ve,{additionalSlots:this._additionalSlots})}),xe.for("upcast").elementToElement({model:"tableRow",view:"tr"}),xe.for("upcast").add(skipEmptyTableRow()),xe.for("downcast").elementToElement({model:"tableRow",view:downcastRow()}),xe.for("upcast").elementToElement({model:"tableCell",view:"td"}),xe.for("upcast").elementToElement({model:"tableCell",view:"th"}),xe.for("upcast").add(ensureParagraphInTableCell("td")),xe.for("upcast").add(ensureParagraphInTableCell("th")),xe.for("editingDowncast").elementToElement({model:"tableCell",view:downcastCell({asWidget:!0})}),xe.for("dataDowncast").elementToElement({model:"tableCell",view:downcastCell()}),xe.for("editingDowncast").elementToElement({model:"paragraph",view:convertParagraphInTableCell({asWidget:!0}),converterPriority:"high"}),xe.for("dataDowncast").elementToElement({model:"paragraph",view:convertParagraphInTableCell(),converterPriority:"high"}),xe.for("downcast").attributeToAttribute({model:"colspan",view:"colspan"}),xe.for("upcast").attributeToAttribute({model:{key:"colspan",value:upcastCellSpan("colspan")},view:"colspan"}),xe.for("downcast").attributeToAttribute({model:"rowspan",view:"rowspan"}),xe.for("upcast").attributeToAttribute({model:{key:"rowspan",value:upcastCellSpan("rowspan")},view:"rowspan"}),t.config.define("table.defaultHeadings.rows",0),t.config.define("table.defaultHeadings.columns",0),t.commands.add("insertTable",new InsertTableCommand(t)),t.commands.add("insertTableRowAbove",new InsertRowCommand(t,{order:"above"})),t.commands.add("insertTableRowBelow",new InsertRowCommand(t,{order:"below"})),t.commands.add("insertTableColumnLeft",new InsertColumnCommand(t,{order:"left"})),t.commands.add("insertTableColumnRight",new InsertColumnCommand(t,{order:"right"})),t.commands.add("removeTableRow",new RemoveRowCommand(t)),t.commands.add("removeTableColumn",new RemoveColumnCommand(t)),t.commands.add("splitTableCellVertically",new SplitCellCommand(t,{direction:"vertically"})),t.commands.add("splitTableCellHorizontally",new SplitCellCommand(t,{direction:"horizontally"})),t.commands.add("mergeTableCells",new MergeCellsCommand(t)),t.commands.add("mergeTableCellRight",new MergeCellCommand(t,{direction:"right"})),t.commands.add("mergeTableCellLeft",new MergeCellCommand(t,{direction:"left"})),t.commands.add("mergeTableCellDown",new MergeCellCommand(t,{direction:"down"})),t.commands.add("mergeTableCellUp",new MergeCellCommand(t,{direction:"up"})),t.commands.add("setTableColumnHeader",new SetHeaderColumnCommand(t)),t.commands.add("setTableRowHeader",new SetHeaderRowCommand(t)),t.commands.add("selectTableRow",new SelectRowCommand(t)),t.commands.add("selectTableColumn",new SelectColumnCommand(t)),injectTableLayoutPostFixer(te),injectTableCellParagraphPostFixer(te),this.listenTo(te.document,"change:data",()=>{tableHeadingsRefreshHandler(te,t.editing),tableCellRefreshHandler(te,t.editing)})}registerAdditionalSlot(t){this._additionalSlots.push(t)}}function upcastCellSpan(Te){return we=>{const t=parseInt(we.getAttribute(Te));return Number.isNaN(t)||t<=0?null:t}}class InsertTableView extends View{constructor(t){super(t);Re(this,"items");Re(this,"keystrokes");Re(this,"focusTracker");const te=this.bindTemplate;this.items=this._createGridCollection(),this.keystrokes=new KeystrokeHandler,this.focusTracker=new FocusTracker,this.set("rows",0),this.set("columns",0),this.bind("label").to(this,"columns",this,"rows",(be,xe)=>`${xe} × ${be}`),this.setTemplate({tag:"div",attributes:{class:["ck"]},children:[{tag:"div",attributes:{class:["ck-insert-table-dropdown__grid"]},on:{"mouseover@.ck-insert-table-dropdown-grid-box":te.to("boxover")},children:this.items},{tag:"div",attributes:{class:["ck","ck-insert-table-dropdown__label"],"aria-hidden":!0},children:[{text:te.to("label")}]}],on:{mousedown:te.to(be=>{be.preventDefault()}),click:te.to(()=>{this.fire("execute")})}}),this.on("boxover",(be,xe)=>{const{row:ve,column:ke}=xe.target.dataset;this.items.get((parseInt(ve,10)-1)*10+(parseInt(ke,10)-1)).focus()}),this.focusTracker.on("change:focusedElement",(be,xe,ve)=>{if(!ve)return;const{row:ke,column:Ie}=ve.dataset;this.set({rows:parseInt(ke),columns:parseInt(Ie)})}),this.on("change:columns",()=>this._highlightGridBoxes()),this.on("change:rows",()=>this._highlightGridBoxes())}render(){super.render(),addKeyboardHandlingForGrid({keystrokeHandler:this.keystrokes,focusTracker:this.focusTracker,gridItems:this.items,numberOfColumns:10,uiLanguageDirection:this.locale&&this.locale.uiLanguageDirection});for(const t of this.items)this.focusTracker.add(t.element);this.keystrokes.listenTo(this.element)}reset(){this.set({rows:1,columns:1})}focus(){this.items.get(0).focus()}focusLast(){this.items.get(0).focus()}_highlightGridBoxes(){const t=this.rows,te=this.columns;this.items.map((be,xe)=>{const ve=Math.floor(xe/10),ke=xe%10,Ie=ve<t&&ke<te;be.set("isOn",Ie)})}_createGridButton(t,te,be,xe){const ve=new ButtonView(t);return ve.set({label:xe,class:"ck-insert-table-dropdown-grid-box"}),ve.extendTemplate({attributes:{"data-row":te,"data-column":be}}),ve}_createGridCollection(){const t=[];for(let te=0;te<100;te++){const be=Math.floor(te/10),xe=te%10,ve=`${be+1} × ${xe+1}`;t.push(this._createGridButton(this.locale,be+1,xe+1,ve))}return this.createCollection(t)}}var tableColumnIcon='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M2.5 1h15A1.5 1.5 0 0 1 19 2.5v15a1.5 1.5 0 0 1-1.5 1.5h-15A1.5 1.5 0 0 1 1 17.5v-15A1.5 1.5 0 0 1 2.5 1zM2 2v16h16V2H2z" opacity=".6"/><path d="M18 7v1H2V7h16zm0 5v1H2v-1h16z" opacity=".6"/><path d="M14 1v18a1 1 0 0 1-1 1H7a1 1 0 0 1-1-1V1a1 1 0 0 1 1-1h6a1 1 0 0 1 1 1zm-2 1H8v4h4V2zm0 6H8v4h4V8zm0 6H8v4h4v-4z"/></svg>',tableRowIcon='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M2.5 1h15A1.5 1.5 0 0 1 19 2.5v15a1.5 1.5 0 0 1-1.5 1.5h-15A1.5 1.5 0 0 1 1 17.5v-15A1.5 1.5 0 0 1 2.5 1zM2 2v16h16V2H2z" opacity=".6"/><path d="M7 2h1v16H7V2zm5 0h1v16h-1V2z" opacity=".6"/><path d="M1 6h18a1 1 0 0 1 1 1v6a1 1 0 0 1-1 1H1a1 1 0 0 1-1-1V7a1 1 0 0 1 1-1zm1 2v4h4V8H2zm6 0v4h4V8H8zm6 0v4h4V8h-4z"/></svg>',tableMergeCellIcon='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M2.5 1h15A1.5 1.5 0 0 1 19 2.5v15a1.5 1.5 0 0 1-1.5 1.5h-15A1.5 1.5 0 0 1 1 17.5v-15A1.5 1.5 0 0 1 2.5 1zM2 2v16h16V2H2z" opacity=".6"/><path d="M7 2h1v16H7V2zm5 0h1v7h-1V2zm6 5v1H2V7h16zM8 12v1H2v-1h6z" opacity=".6"/><path d="M7 7h12a1 1 0 0 1 1 1v11a1 1 0 0 1-1 1H7a1 1 0 0 1-1-1V8a1 1 0 0 1 1-1zm1 2v9h10V9H8z"/></svg>';class TableUI extends Plugin{static get pluginName(){return"TableUI"}init(){const we=this.editor,t=this.editor.t,be=we.locale.contentLanguageDirection==="ltr";we.ui.componentFactory.add("insertTable",xe=>{const ve=we.commands.get("insertTable"),ke=createDropdown(xe);ke.bind("isEnabled").to(ve),ke.buttonView.set({icon:icons.table,label:t("Insert table"),tooltip:!0});let Ie;return ke.on("change:isOpen",()=>{Ie||(Ie=new InsertTableView(xe),ke.panelView.children.add(Ie),Ie.delegate("execute").to(ke),ke.on("execute",()=>{we.execute("insertTable",{rows:Ie.rows,columns:Ie.columns}),we.editing.view.focus()}))}),ke}),we.ui.componentFactory.add("menuBar:insertTable",xe=>{const ve=we.commands.get("insertTable"),ke=new MenuBarMenuView(xe),Ie=new InsertTableView(xe);return Ie.delegate("execute").to(ke),ke.on("change:isOpen",(Ae,Se,Oe)=>{Oe||Ie.reset()}),Ie.on("execute",()=>{we.execute("insertTable",{rows:Ie.rows,columns:Ie.columns}),we.editing.view.focus()}),ke.buttonView.set({label:t("Table"),icon:icons.table}),ke.panelView.children.add(Ie),ke.bind("isEnabled").to(ve),ke}),we.ui.componentFactory.add("tableColumn",xe=>{const ve=[{type:"switchbutton",model:{commandName:"setTableColumnHeader",label:t("Header column"),bindIsOn:!0}},{type:"separator"},{type:"button",model:{commandName:be?"insertTableColumnLeft":"insertTableColumnRight",label:t("Insert column left")}},{type:"button",model:{commandName:be?"insertTableColumnRight":"insertTableColumnLeft",label:t("Insert column right")}},{type:"button",model:{commandName:"removeTableColumn",label:t("Delete column")}},{type:"button",model:{commandName:"selectTableColumn",label:t("Select column")}}];return this._prepareDropdown(t("Column"),tableColumnIcon,ve,xe)}),we.ui.componentFactory.add("tableRow",xe=>{const ve=[{type:"switchbutton",model:{commandName:"setTableRowHeader",label:t("Header row"),bindIsOn:!0}},{type:"separator"},{type:"button",model:{commandName:"insertTableRowAbove",label:t("Insert row above")}},{type:"button",model:{commandName:"insertTableRowBelow",label:t("Insert row below")}},{type:"button",model:{commandName:"removeTableRow",label:t("Delete row")}},{type:"button",model:{commandName:"selectTableRow",label:t("Select row")}}];return this._prepareDropdown(t("Row"),tableRowIcon,ve,xe)}),we.ui.componentFactory.add("mergeTableCells",xe=>{const ve=[{type:"button",model:{commandName:"mergeTableCellUp",label:t("Merge cell up")}},{type:"button",model:{commandName:be?"mergeTableCellRight":"mergeTableCellLeft",label:t("Merge cell right")}},{type:"button",model:{commandName:"mergeTableCellDown",label:t("Merge cell down")}},{type:"button",model:{commandName:be?"mergeTableCellLeft":"mergeTableCellRight",label:t("Merge cell left")}},{type:"separator"},{type:"button",model:{commandName:"splitTableCellVertically",label:t("Split cell vertically")}},{type:"button",model:{commandName:"splitTableCellHorizontally",label:t("Split cell horizontally")}}];return this._prepareMergeSplitButtonDropdown(t("Merge cells"),tableMergeCellIcon,ve,xe)})}_prepareDropdown(we,t,te,be){const xe=this.editor,ve=createDropdown(be),ke=this._fillDropdownWithListOptions(ve,te);return ve.buttonView.set({label:we,icon:t,tooltip:!0}),ve.bind("isEnabled").toMany(ke,"isEnabled",(...Ie)=>Ie.some(Ae=>Ae)),this.listenTo(ve,"execute",Ie=>{xe.execute(Ie.source.commandName),Ie.source instanceof SwitchButtonView||xe.editing.view.focus()}),ve}_prepareMergeSplitButtonDropdown(we,t,te,be){const xe=this.editor,ve=createDropdown(be,SplitButtonView),ke="mergeTableCells",Ie=xe.commands.get(ke),Ae=this._fillDropdownWithListOptions(ve,te);return ve.buttonView.set({label:we,icon:t,tooltip:!0,isEnabled:!0}),ve.bind("isEnabled").toMany([Ie,...Ae],"isEnabled",(...Se)=>Se.some(Oe=>Oe)),this.listenTo(ve.buttonView,"execute",()=>{xe.execute(ke),xe.editing.view.focus()}),this.listenTo(ve,"execute",Se=>{xe.execute(Se.source.commandName),xe.editing.view.focus()}),ve}_fillDropdownWithListOptions(we,t){const te=this.editor,be=[],xe=new Collection;for(const ve of t)addListOption(ve,te,be,xe);return addListToDropdown(we,xe),be}}function addListOption(Te,we,t,te){if(Te.type==="button"||Te.type==="switchbutton"){const be=Te.model=new Model(Te.model),{commandName:xe,bindIsOn:ve}=Te.model,ke=we.commands.get(xe);t.push(ke),be.set({commandName:xe}),be.bind("isEnabled").to(ke),ve&&be.bind("isOn").to(ke,"value"),be.set({withText:!0})}te.add(Te)}class TableSelection extends Plugin{static get pluginName(){return"TableSelection"}static get requires(){return[TableUtils,TableUtils]}init(){const we=this.editor,t=we.model,te=we.editing.view;this.listenTo(t,"deleteContent",(be,xe)=>this._handleDeleteContent(be,xe),{priority:"high"}),this.listenTo(te.document,"insertText",(be,xe)=>this._handleInsertTextEvent(be,xe),{priority:"high"}),this._defineSelectionConverter(),this._enablePluginDisabling()}getSelectedTableCells(){const we=this.editor.plugins.get(TableUtils),t=this.editor.model.document.selection,te=we.getSelectedTableCells(t);return te.length==0?null:te}getSelectionAsFragment(){const we=this.editor.plugins.get(TableUtils),t=this.getSelectedTableCells();return t?this.editor.model.change(te=>{const be=te.createDocumentFragment(),{first:xe,last:ve}=we.getColumnIndexes(t),{first:ke,last:Ie}=we.getRowIndexes(t),Ae=t[0].findAncestor("table");let Se=Ie,Oe=ve;if(we.isSelectionRectangular(t)){const De={firstColumn:xe,lastColumn:ve,firstRow:ke,lastRow:Ie};Se=adjustLastRowIndex(Ae,De),Oe=adjustLastColumnIndex(Ae,De)}const Me=cropTableToDimensions(Ae,{startRow:ke,startColumn:xe,endRow:Se,endColumn:Oe},te);return te.insert(Me,be,0),be}):null}setCellSelection(we,t){const te=this._getCellsToSelect(we,t);this.editor.model.change(be=>{be.setSelection(te.cells.map(xe=>be.createRangeOn(xe)),{backward:te.backward})})}getFocusCell(){const te=[...this.editor.model.document.selection.getRanges()].pop().getContainedElement();return te&&te.is("element","tableCell")?te:null}getAnchorCell(){const we=this.editor.model.document.selection,te=first(we.getRanges()).getContainedElement();return te&&te.is("element","tableCell")?te:null}_defineSelectionConverter(){const we=this.editor,t=new Set;we.conversion.for("editingDowncast").add(be=>be.on("selection",(xe,ve,ke)=>{const Ie=ke.writer;te(Ie);const Ae=this.getSelectedTableCells();if(!Ae)return;for(const Oe of Ae){const Ve=ke.mapper.toViewElement(Oe);Ie.addClass("ck-editor__editable_selected",Ve),t.add(Ve)}const Se=ke.mapper.toViewElement(Ae[Ae.length-1]);Ie.setSelection(Se,0)},{priority:"lowest"}));function te(be){for(const xe of t)be.removeClass("ck-editor__editable_selected",xe);t.clear()}}_enablePluginDisabling(){const we=this.editor;this.on("change:isEnabled",()=>{if(!this.isEnabled){const t=this.getSelectedTableCells();if(!t)return;we.model.change(te=>{const be=te.createPositionAt(t[0],0),xe=we.model.schema.getNearestSelectionRange(be);te.setSelection(xe)})}})}_handleDeleteContent(we,t){const te=this.editor.plugins.get(TableUtils),be=t[0],xe=t[1],ve=this.editor.model,ke=!xe||xe.direction=="backward",Ie=te.getSelectedTableCells(be);Ie.length&&(we.stop(),ve.change(Ae=>{const Se=Ie[ke?Ie.length-1:0];ve.change(Ve=>{for(const Me of Ie)ve.deleteContent(Ve.createSelection(Me,"in"))});const Oe=ve.schema.getNearestSelectionRange(Ae.createPositionAt(Se,0));be.is("documentSelection")?Ae.setSelection(Oe):be.setTo(Oe)}))}_handleInsertTextEvent(we,t){const te=this.editor,be=this.getSelectedTableCells();if(!be)return;const xe=te.editing.view,ve=te.editing.mapper,ke=be.map(Ie=>xe.createRangeOn(ve.toViewElement(Ie)));t.selection=xe.createSelection(ke)}_getCellsToSelect(we,t){const te=this.editor.plugins.get("TableUtils"),be=te.getCellLocation(we),xe=te.getCellLocation(t),ve=Math.min(be.row,xe.row),ke=Math.max(be.row,xe.row),Ie=Math.min(be.column,xe.column),Ae=Math.max(be.column,xe.column),Se=new Array(ke-ve+1).fill(null).map(()=>[]),Oe={startRow:ve,endRow:ke,startColumn:Ie,endColumn:Ae};for(const{row:De,cell:Fe}of new TableWalker(we.findAncestor("table"),Oe))Se[De-ve].push(Fe);const Ve=xe.row<be.row,Me=xe.column<be.column;return Ve&&Se.reverse(),Me&&Se.forEach(De=>De.reverse()),{cells:Se.flat(),backward:Ve||Me}}}class TableClipboard extends Plugin{static get pluginName(){return"TableClipboard"}static get requires(){return[ClipboardMarkersUtils,ClipboardPipeline,TableSelection,TableUtils]}init(){const we=this.editor,t=we.editing.view.document;this.listenTo(t,"copy",(te,be)=>this._onCopyCut(te,be)),this.listenTo(t,"cut",(te,be)=>this._onCopyCut(te,be)),this.listenTo(we.model,"insertContent",(te,[be,xe])=>this._onInsertContent(te,be,xe),{priority:"high"}),this.decorate("_replaceTableSlotCell")}_onCopyCut(we,t){const te=this.editor.editing.view,be=this.editor.plugins.get(TableSelection),xe=this.editor.plugins.get(ClipboardMarkersUtils);be.getSelectedTableCells()&&(we.name=="cut"&&!this.editor.model.canEditAt(this.editor.model.document.selection)||(t.preventDefault(),we.stop(),this.editor.model.enqueueChange({isUndoable:we.name==="cut"},()=>{const ve=xe._copySelectedFragmentWithMarkers(we.name,this.editor.model.document.selection,()=>be.getSelectionAsFragment());te.document.fire("clipboardOutput",{dataTransfer:t.dataTransfer,content:this.editor.data.toView(ve),method:we.name})})))}_onInsertContent(we,t,te){if(te&&!te.is("documentSelection"))return;const be=this.editor.model,xe=this.editor.plugins.get(TableUtils),ve=this.editor.plugins.get(ClipboardMarkersUtils),ke=this.getTableIfOnlyTableInContent(t,be);if(!ke)return;const Ie=xe.getSelectionAffectedTableCells(be.document.selection);if(!Ie.length){removeEmptyRowsColumns(ke,xe);return}we.stop(),t.is("documentFragment")?ve._pasteMarkersIntoTransformedElement(t.markers,Ae=>this._replaceSelectedCells(ke,Ie,Ae)):this.editor.model.change(Ae=>{this._replaceSelectedCells(ke,Ie,Ae)})}_replaceSelectedCells(we,t,te){const be=this.editor.plugins.get(TableUtils),xe={width:be.getColumns(we),height:be.getRows(we)},ve=prepareTableForPasting(t,xe,te,be),ke=ve.lastRow-ve.firstRow+1,Ie=ve.lastColumn-ve.firstColumn+1,Ae={startRow:0,startColumn:0,endRow:Math.min(ke,xe.height)-1,endColumn:Math.min(Ie,xe.width)-1};we=cropTableToDimensions(we,Ae,te);const Se=t[0].findAncestor("table"),Oe=this._replaceSelectedCellsWithPasted(we,xe,Se,ve,te);if(this.editor.plugins.get("TableSelection").isEnabled){const Ve=be.sortRanges(Oe.map(Me=>te.createRangeOn(Me)));te.setSelection(Ve)}else te.setSelection(Oe[0],0);return Se}_replaceSelectedCellsWithPasted(we,t,te,be,xe){const{width:ve,height:ke}=t,Ie=createLocationMap(we,ve,ke),Ae=[...new TableWalker(te,{startRow:be.firstRow,endRow:be.lastRow,startColumn:be.firstColumn,endColumn:be.lastColumn,includeAllSlots:!0})],Se=[];let Oe;for(const Be of Ae){const{row:$e,column:Ue}=Be;Ue===be.firstColumn&&(Oe=Be.getPositionBefore());const He=$e-be.firstRow,ze=Ue-be.firstColumn,qe=Ie[He%ke][ze%ve],Ke=qe?xe.cloneElement(qe):null,Qe=this._replaceTableSlotCell(Be,Ke,Oe,xe);Qe&&(trimTableCellIfNeeded(Qe,$e,Ue,be.lastRow,be.lastColumn,xe),Se.push(Qe),Oe=xe.createPositionAfter(Qe))}const Ve=parseInt(te.getAttribute("headingRows")||"0"),Me=parseInt(te.getAttribute("headingColumns")||"0"),De=be.firstRow<Ve&&Ve<=be.lastRow,Fe=be.firstColumn<Me&&Me<=be.lastColumn;if(De){const Be={first:be.firstColumn,last:be.lastColumn},$e=doHorizontalSplit(te,Ve,Be,xe,be.firstRow);Se.push(...$e)}if(Fe){const Be={first:be.firstRow,last:be.lastRow},$e=doVerticalSplit(te,Me,Be,xe);Se.push(...$e)}return Se}_replaceTableSlotCell(we,t,te,be){const{cell:xe,isAnchor:ve}=we;return ve&&be.remove(xe),t?(be.insert(t,te),t):null}getTableIfOnlyTableInContent(we,t){if(!we.is("documentFragment")&&!we.is("element"))return null;if(we.is("element","table"))return we;if(we.childCount==1&&we.getChild(0).is("element","table"))return we.getChild(0);const te=t.createRangeIn(we);for(const be of te.getItems())if(be.is("element","table")){const xe=t.createRange(te.start,t.createPositionBefore(be));if(t.hasContent(xe,{ignoreWhitespaces:!0}))return null;const ve=t.createRange(t.createPositionAfter(be),te.end);return t.hasContent(ve,{ignoreWhitespaces:!0})?null:be}return null}}function prepareTableForPasting(Te,we,t,te){const be=Te[0].findAncestor("table"),xe=te.getColumnIndexes(Te),ve=te.getRowIndexes(Te),ke={firstColumn:xe.first,lastColumn:xe.last,firstRow:ve.first,lastRow:ve.last},Ie=Te.length===1;return Ie&&(ke.lastRow+=we.height-1,ke.lastColumn+=we.width-1,expandTableSize(be,ke.lastRow+1,ke.lastColumn+1,te)),Ie||!te.isSelectionRectangular(Te)?splitCellsToRectangularSelection(be,ke,t):(ke.lastRow=adjustLastRowIndex(be,ke),ke.lastColumn=adjustLastColumnIndex(be,ke)),ke}function expandTableSize(Te,we,t,te){const be=te.getColumns(Te),xe=te.getRows(Te);t>be&&te.insertColumns(Te,{at:be,columns:t-be}),we>xe&&te.insertRows(Te,{at:xe,rows:we-xe})}function createLocationMap(Te,we,t){const te=new Array(t).fill(null).map(()=>new Array(we).fill(null));for(const{column:be,row:xe,cell:ve}of new TableWalker(Te))te[xe][be]=ve;return te}function splitCellsToRectangularSelection(Te,we,t){const{firstRow:te,lastRow:be,firstColumn:xe,lastColumn:ve}=we,ke={first:te,last:be},Ie={first:xe,last:ve};doVerticalSplit(Te,xe,ke,t),doVerticalSplit(Te,ve+1,ke,t),doHorizontalSplit(Te,te,Ie,t),doHorizontalSplit(Te,be+1,Ie,t,te)}function doHorizontalSplit(Te,we,t,te,be=0){return we<1?void 0:getVerticallyOverlappingCells(Te,we,be).filter(({column:ke,cellWidth:Ie})=>isAffectedBySelection(ke,Ie,t)).map(({cell:ke})=>splitHorizontally(ke,we,te))}function doVerticalSplit(Te,we,t,te){return we<1?void 0:getHorizontallyOverlappingCells(Te,we).filter(({row:ve,cellHeight:ke})=>isAffectedBySelection(ve,ke,t)).map(({cell:ve,column:ke})=>splitVertically(ve,ke,we,te))}function isAffectedBySelection(Te,we,t){const te=Te+we-1,{first:be,last:xe}=t,ve=Te>=be&&Te<=xe,ke=Te<be&&te>=be;return ve||ke}class TableKeyboard extends Plugin{static get pluginName(){return"TableKeyboard"}static get requires(){return[TableSelection,TableUtils]}init(){const we=this.editor,te=we.editing.view.document,be=we.t;this.listenTo(te,"arrowKey",(...xe)=>this._onArrowKey(...xe),{context:"table"}),this.listenTo(te,"tab",(...xe)=>this._handleTabOnSelectedTable(...xe),{context:"figure"}),this.listenTo(te,"tab",(...xe)=>this._handleTab(...xe),{context:["th","td"]}),we.accessibility.addKeystrokeInfoGroup({id:"table",label:be("Keystrokes that can be used in a table cell"),keystrokes:[{label:be("Move the selection to the next cell"),keystroke:"Tab"},{label:be("Move the selection to the previous cell"),keystroke:"Shift+Tab"},{label:be("Insert a new table row (when in the last cell of a table)"),keystroke:"Tab"},{label:be("Navigate through the table"),keystroke:[["arrowup"],["arrowright"],["arrowdown"],["arrowleft"]]}]})}_handleTabOnSelectedTable(we,t){const te=this.editor,xe=te.model.document.selection.getSelectedElement();!xe||!xe.is("element","table")||(t.preventDefault(),t.stopPropagation(),we.stop(),te.model.change(ve=>{ve.setSelection(ve.createRangeIn(xe.getChild(0).getChild(0)))}))}_handleTab(we,t){const te=this.editor,be=this.editor.plugins.get(TableUtils),xe=this.editor.plugins.get("TableSelection"),ve=te.model.document.selection,ke=!t.shiftKey;let Ie=be.getTableCellsContainingSelection(ve)[0];if(Ie||(Ie=xe.getFocusCell()),!Ie)return;t.preventDefault(),t.stopPropagation(),we.stop();const Ae=Ie.parent,Se=Ae.parent,Oe=Se.getChildIndex(Ae),Ve=Ae.getChildIndex(Ie),Me=Ve===0;if(!ke&&Me&&Oe===0){te.model.change($e=>{$e.setSelection($e.createRangeOn(Se))});return}const De=Ve===Ae.childCount-1,Fe=Oe===be.getRows(Se)-1;if(ke&&Fe&&De&&(te.execute("insertTableRowBelow"),Oe===be.getRows(Se)-1)){te.model.change($e=>{$e.setSelection($e.createRangeOn(Se))});return}let Be;if(ke&&De)Be=Se.getChild(Oe+1).getChild(0);else if(!ke&&Me){const $e=Se.getChild(Oe-1);Be=$e.getChild($e.childCount-1)}else Be=Ae.getChild(Ve+(ke?1:-1));te.model.change($e=>{$e.setSelection($e.createRangeIn(Be))})}_onArrowKey(we,t){const te=this.editor,be=t.keyCode,xe=getLocalizedArrowKeyCodeDirection(be,te.locale.contentLanguageDirection);this._handleArrowKeys(xe,t.shiftKey)&&(t.preventDefault(),t.stopPropagation(),we.stop())}_handleArrowKeys(we,t){const te=this.editor.plugins.get(TableUtils),be=this.editor.plugins.get("TableSelection"),xe=this.editor.model,ve=xe.document.selection,ke=["right","down"].includes(we),Ie=te.getSelectedTableCells(ve);if(Ie.length){let Se;return t?Se=be.getFocusCell():Se=ke?Ie[Ie.length-1]:Ie[0],this._navigateFromCellInDirection(Se,we,t),!0}const Ae=ve.focus.findAncestor("tableCell");/* istanbul ignore if: paranoid check -- @preserve */if(!Ae)return!1;if(!ve.isCollapsed)if(t){if(ve.isBackward==ke&&!ve.containsEntireContent(Ae))return!1}else{const Se=ve.getSelectedElement();if(!Se||!xe.schema.isObject(Se))return!1}return this._isSelectionAtCellEdge(ve,Ae,ke)?(this._navigateFromCellInDirection(Ae,we,t),!0):!1}_isSelectionAtCellEdge(we,t,te){const be=this.editor.model,xe=this.editor.model.schema,ve=te?we.getLastPosition():we.getFirstPosition();if(!xe.getLimitElement(ve).is("element","tableCell"))return be.createPositionAt(t,te?"end":0).isTouching(ve);const ke=be.createSelection(ve);return be.modifySelection(ke,{direction:te?"forward":"backward"}),ve.isEqual(ke.focus)}_navigateFromCellInDirection(we,t,te=!1){const be=this.editor.model,xe=we.findAncestor("table"),ve=[...new TableWalker(xe,{includeAllSlots:!0})],{row:ke,column:Ie}=ve[ve.length-1],Ae=ve.find(({cell:Ue})=>Ue==we);let{row:Se,column:Oe}=Ae;switch(t){case"left":Oe--;break;case"up":Se--;break;case"right":Oe+=Ae.cellWidth;break;case"down":Se+=Ae.cellHeight;break}const Ve=Se<0||Se>ke,Me=Oe<0&&Se<=0,De=Oe>Ie&&Se>=ke;if(Ve||Me||De){be.change(Ue=>{Ue.setSelection(Ue.createRangeOn(xe))});return}Oe<0?(Oe=te?0:Ie,Se--):Oe>Ie&&(Oe=te?Ie:0,Se++);const Fe=ve.find(Ue=>Ue.row==Se&&Ue.column==Oe).cell,Be=["right","down"].includes(t),$e=this.editor.plugins.get("TableSelection");if(te&&$e.isEnabled){const Ue=$e.getAnchorCell()||we;$e.setCellSelection(Ue,Fe)}else{const Ue=be.createPositionAt(Fe,Be?0:"end");be.change(He=>{He.setSelection(Ue)})}}}class MouseEventsObserver extends DomEventObserver{constructor(){super(...arguments);Re(this,"domEventType",["mousemove","mouseleave"])}onDomEvent(t){this.fire(t.type,t)}}class TableMouse extends Plugin{static get pluginName(){return"TableMouse"}static get requires(){return[TableSelection,TableUtils]}init(){this.editor.editing.view.addObserver(MouseEventsObserver),this._enableShiftClickSelection(),this._enableMouseDragSelection()}_enableShiftClickSelection(){const we=this.editor,t=we.plugins.get(TableUtils);let te=!1;const be=we.plugins.get(TableSelection);this.listenTo(we.editing.view.document,"mousedown",(xe,ve)=>{const ke=we.model.document.selection;if(!this.isEnabled||!be.isEnabled||!ve.domEvent.shiftKey)return;const Ie=be.getAnchorCell()||t.getTableCellsContainingSelection(ke)[0];if(!Ie)return;const Ae=this._getModelTableCellFromDomEvent(ve);Ae&&haveSameTableParent(Ie,Ae)&&(te=!0,be.setCellSelection(Ie,Ae),ve.preventDefault())}),this.listenTo(we.editing.view.document,"mouseup",()=>{te=!1}),this.listenTo(we.editing.view.document,"selectionChange",xe=>{te&&xe.stop()},{priority:"highest"})}_enableMouseDragSelection(){const we=this.editor;let t,te,be=!1,xe=!1;const ve=we.plugins.get(TableSelection);this.listenTo(we.editing.view.document,"mousedown",(ke,Ie)=>{!this.isEnabled||!ve.isEnabled||Ie.domEvent.shiftKey||Ie.domEvent.ctrlKey||Ie.domEvent.altKey||(t=this._getModelTableCellFromDomEvent(Ie))}),this.listenTo(we.editing.view.document,"mousemove",(ke,Ie)=>{if(!Ie.domEvent.buttons||!t)return;const Ae=this._getModelTableCellFromDomEvent(Ie);Ae&&haveSameTableParent(t,Ae)&&(te=Ae,!be&&te!=t&&(be=!0)),be&&(xe=!0,ve.setCellSelection(t,te),Ie.preventDefault())}),this.listenTo(we.editing.view.document,"mouseup",()=>{be=!1,xe=!1,t=null,te=null}),this.listenTo(we.editing.view.document,"selectionChange",ke=>{xe&&ke.stop()},{priority:"highest"})}_getModelTableCellFromDomEvent(we){const t=we.target,te=this.editor.editing.view.createPositionAt(t,0);return this.editor.editing.mapper.toModelPosition(te).parent.findAncestor("tableCell",{includeSelf:!0})}}function haveSameTableParent(Te,we){return Te.parent.parent==we.parent.parent}class Table extends Plugin{static get requires(){return[TableEditing,TableUI,TableSelection,TableMouse,TableKeyboard,TableClipboard,Widget]}static get pluginName(){return"Table"}}function getSelectionAffectedTableWidget(Te){const we=getSelectedTableWidget(Te);return we||getTableWidgetAncestor(Te)}function getSelectedTableWidget(Te){const we=Te.getSelectedElement();return we&&isTableWidget(we)?we:null}function getTableWidgetAncestor(Te){const we=Te.getFirstPosition();if(!we)return null;let t=we.parent;for(;t;){if(t.is("element")&&isTableWidget(t))return t;t=t.parent}return null}function isTableWidget(Te){return!!Te.getCustomProperty("table")&&isWidget(Te)}class TableToolbar extends Plugin{static get requires(){return[WidgetToolbarRepository]}static get pluginName(){return"TableToolbar"}afterInit(){const we=this.editor,t=we.t,te=we.plugins.get(WidgetToolbarRepository),be=we.config.get("table.contentToolbar"),xe=we.config.get("table.tableToolbar");be&&te.register("tableContent",{ariaLabel:t("Table toolbar"),items:be,getRelatedElement:getTableWidgetAncestor}),xe&&te.register("table",{ariaLabel:t("Table toolbar"),items:xe,getRelatedElement:getSelectedTableWidget})}}class ColorInputView extends View{constructor(t,te){super(t);Re(this,"options");Re(this,"focusTracker");Re(this,"focusCycler");Re(this,"_focusables");Re(this,"dropdownView");Re(this,"inputView");Re(this,"keystrokes");Re(this,"_stillTyping");this.set("value",""),this.set("isReadOnly",!1),this.set("isFocused",!1),this.set("isEmpty",!0),this.options=te,this.focusTracker=new FocusTracker,this._focusables=new ViewCollection,this.dropdownView=this._createDropdownView(),this.inputView=this._createInputTextView(),this.keystrokes=new KeystrokeHandler,this._stillTyping=!1,this.focusCycler=new FocusCycler({focusables:this._focusables,focusTracker:this.focusTracker,keystrokeHandler:this.keystrokes,actions:{focusPrevious:"shift + tab",focusNext:"tab"}}),this.setTemplate({tag:"div",attributes:{class:["ck","ck-input-color"]},children:[this.dropdownView,this.inputView]}),this.on("change:value",(be,xe,ve)=>this._setInputValue(ve))}render(){super.render(),[this.inputView,this.dropdownView.buttonView].forEach(t=>{this.focusTracker.add(t.element),this._focusables.add(t)}),this.keystrokes.listenTo(this.element)}focus(t){t===-1?this.focusCycler.focusLast():this.focusCycler.focusFirst()}destroy(){super.destroy(),this.focusTracker.destroy(),this.keystrokes.destroy()}_createDropdownView(){const t=this.locale,te=t.t,be=this.bindTemplate,xe=this._createColorSelector(t),ve=createDropdown(t),ke=new View;return ke.setTemplate({tag:"span",attributes:{class:["ck","ck-input-color__button__preview"],style:{backgroundColor:be.to("value")}},children:[{tag:"span",attributes:{class:["ck","ck-input-color__button__preview__no-color-indicator",be.if("value","ck-hidden",Ie=>Ie!="")]}}]}),ve.buttonView.extendTemplate({attributes:{class:"ck-input-color__button"}}),ve.buttonView.children.add(ke),ve.buttonView.label=te("Color picker"),ve.buttonView.tooltip=!0,ve.panelPosition=t.uiLanguageDirection==="rtl"?"se":"sw",ve.panelView.children.add(xe),ve.bind("isEnabled").to(this,"isReadOnly",Ie=>!Ie),ve.on("change:isOpen",(Ie,Ae,Se)=>{Se&&(xe.updateSelectedColors(),xe.showColorGridsFragment())}),ve}_createInputTextView(){const t=this.locale,te=new InputTextView(t);return te.extendTemplate({on:{blur:te.bindTemplate.to("blur")}}),te.value=this.value,te.bind("isReadOnly","hasError").to(this),this.bind("isFocused","isEmpty").to(te),te.on("input",()=>{const be=te.element.value,xe=this.options.colorDefinitions.find(ve=>be===ve.label);this._stillTyping=!0,this.value=xe&&xe.color||be}),te.on("blur",()=>{this._stillTyping=!1,this._setInputValue(te.element.value)}),te.delegate("input").to(this),te}_createColorSelector(t){const te=t.t,be=this.options.defaultColorValue||"",xe=te(be?"Restore default":"Remove color"),ve=new ColorSelectorView(t,{colors:this.options.colorDefinitions,columns:this.options.columns,removeButtonLabel:xe,colorPickerLabel:te("Color picker"),colorPickerViewConfig:this.options.colorPickerConfig===!1?!1:{...this.options.colorPickerConfig,hideInput:!0}});ve.appendUI(),ve.on("execute",(Ie,Ae)=>{if(Ae.source==="colorPickerSaveButton"){this.dropdownView.isOpen=!1;return}this.value=Ae.value||be,this.fire("input"),Ae.source!=="colorPicker"&&(this.dropdownView.isOpen=!1)});let ke=this.value;return ve.on("colorPicker:cancel",()=>{this.value=ke,this.fire("input"),this.dropdownView.isOpen=!1}),ve.colorGridsFragmentView.colorPickerButtonView.on("execute",()=>{ke=this.value}),ve.bind("selectedColor").to(this,"value"),ve}_setInputValue(t){if(!this._stillTyping){const te=normalizeColor(t),be=this.options.colorDefinitions.find(xe=>te===normalizeColor(xe.color));be?this.inputView.value=be.label:this.inputView.value=t||""}}}function normalizeColor(Te){return Te.replace(/([(,])\s+/g,"$1").replace(/^\s+|\s+(?=[),\s]|$)/g,"").replace(/,|\s/g," ")}const isEmpty=Te=>Te==="";function getBorderStyleLabels(Te){return{none:Te("None"),solid:Te("Solid"),dotted:Te("Dotted"),dashed:Te("Dashed"),double:Te("Double"),groove:Te("Groove"),ridge:Te("Ridge"),inset:Te("Inset"),outset:Te("Outset")}}function getLocalizedColorErrorText(Te){return Te('The color is invalid. Try "#FF0000" or "rgb(255,0,0)" or "red".')}function getLocalizedLengthErrorText(Te){return Te('The value is invalid. Try "10px" or "2em" or simply "2".')}function colorFieldValidator(Te){return Te=Te.trim().toLowerCase(),isEmpty(Te)||isColor(Te)}function lengthFieldValidator(Te){return Te=Te.trim(),isEmpty(Te)||isNumberString(Te)||isLength(Te)||isPercentage(Te)}function lineWidthFieldValidator(Te){return Te=Te.trim(),isEmpty(Te)||isNumberString(Te)||isLength(Te)}function getBorderStyleDefinitions(Te,we){const t=new Collection,te=getBorderStyleLabels(Te.t);for(const be in te){const xe={type:"button",model:new Model({_borderStyleValue:be,label:te[be],role:"menuitemradio",withText:!0})};be==="none"?xe.model.bind("isOn").to(Te,"borderStyle",ve=>we==="none"?!ve:ve===be):xe.model.bind("isOn").to(Te,"borderStyle",ve=>ve===be),t.add(xe)}return t}function fillToolbar(Te){const{view:we,icons:t,toolbar:te,labels:be,propertyName:xe,nameToValue:ve,defaultValue:ke}=Te;for(const Ie in be){const Ae=new ButtonView(we.locale);Ae.set({label:be[Ie],icon:t[Ie],tooltip:be[Ie]});const Se=ve?ve(Ie):Ie;Ae.bind("isOn").to(we,xe,Oe=>{let Ve=Oe;return Oe===""&&ke&&(Ve=ke),Se===Ve}),Ae.on("execute",()=>{we[xe]=Se}),te.items.add(Ae)}}const defaultColors=[{color:"hsl(0, 0%, 0%)",label:"Black"},{color:"hsl(0, 0%, 30%)",label:"Dim grey"},{color:"hsl(0, 0%, 60%)",label:"Grey"},{color:"hsl(0, 0%, 90%)",label:"Light grey"},{color:"hsl(0, 0%, 100%)",label:"White",hasBorder:!0},{color:"hsl(0, 75%, 60%)",label:"Red"},{color:"hsl(30, 75%, 60%)",label:"Orange"},{color:"hsl(60, 75%, 60%)",label:"Yellow"},{color:"hsl(90, 75%, 60%)",label:"Light green"},{color:"hsl(120, 75%, 60%)",label:"Green"},{color:"hsl(150, 75%, 60%)",label:"Aquamarine"},{color:"hsl(180, 75%, 60%)",label:"Turquoise"},{color:"hsl(210, 75%, 60%)",label:"Light blue"},{color:"hsl(240, 75%, 60%)",label:"Blue"},{color:"hsl(270, 75%, 60%)",label:"Purple"}];function getLabeledColorInputCreator(Te){return(we,t,te)=>{const be=new ColorInputView(we.locale,{colorDefinitions:colorConfigToColorGridDefinitions(Te.colorConfig),columns:Te.columns,defaultColorValue:Te.defaultColorValue,colorPickerConfig:Te.colorPickerConfig});return be.inputView.set({id:t,ariaDescribedById:te}),be.bind("isReadOnly").to(we,"isEnabled",xe=>!xe),be.bind("hasError").to(we,"errorText",xe=>!!xe),be.on("input",()=>{we.errorText=null}),we.bind("isEmpty","isFocused").to(be),be}}function isNumberString(Te){const we=parseFloat(Te);return!Number.isNaN(we)&&Te===String(we)}function colorConfigToColorGridDefinitions(Te){return Te.map(we=>({color:we.model,label:we.label,options:{hasBorder:we.hasBorder}}))}class FormRowView extends View{constructor(t,te={}){super(t);Re(this,"children");const be=this.bindTemplate;this.set("class",te.class||null),this.children=this.createCollection(),te.children&&te.children.forEach(xe=>this.children.add(xe)),this.set("_role",null),this.set("_ariaLabelledBy",null),te.labelView&&this.set({_role:"group",_ariaLabelledBy:te.labelView.id}),this.setTemplate({tag:"div",attributes:{class:["ck","ck-form__row",be.to("class")],role:be.to("_role"),"aria-labelledby":be.to("_ariaLabelledBy")},children:this.children})}}class TableCellPropertiesView extends View{constructor(t,te){super(t);Re(this,"options");Re(this,"focusTracker");Re(this,"keystrokes");Re(this,"children");Re(this,"borderStyleDropdown");Re(this,"borderWidthInput");Re(this,"borderColorInput");Re(this,"backgroundInput");Re(this,"paddingInput");Re(this,"widthInput");Re(this,"heightInput");Re(this,"horizontalAlignmentToolbar");Re(this,"verticalAlignmentToolbar");Re(this,"saveButtonView");Re(this,"cancelButtonView");Re(this,"_focusables");Re(this,"_focusCycler");this.set({borderStyle:"",borderWidth:"",borderColor:"",padding:"",backgroundColor:"",width:"",height:"",horizontalAlignment:"",verticalAlignment:""}),this.options=te;const{borderStyleDropdown:be,borderWidthInput:xe,borderColorInput:ve,borderRowLabel:ke}=this._createBorderFields(),{backgroundRowLabel:Ie,backgroundInput:Ae}=this._createBackgroundFields(),{widthInput:Se,operatorLabel:Oe,heightInput:Ve,dimensionsLabel:Me}=this._createDimensionFields(),{horizontalAlignmentToolbar:De,verticalAlignmentToolbar:Fe,alignmentLabel:Be}=this._createAlignmentFields();this.focusTracker=new FocusTracker,this.keystrokes=new KeystrokeHandler,this.children=this.createCollection(),this.borderStyleDropdown=be,this.borderWidthInput=xe,this.borderColorInput=ve,this.backgroundInput=Ae,this.paddingInput=this._createPaddingField(),this.widthInput=Se,this.heightInput=Ve,this.horizontalAlignmentToolbar=De,this.verticalAlignmentToolbar=Fe;const{saveButtonView:$e,cancelButtonView:Ue}=this._createActionButtons();this.saveButtonView=$e,this.cancelButtonView=Ue,this._focusables=new ViewCollection,this._focusCycler=new FocusCycler({focusables:this._focusables,focusTracker:this.focusTracker,keystrokeHandler:this.keystrokes,actions:{focusPrevious:"shift + tab",focusNext:"tab"}}),this.children.add(new FormHeaderView(t,{label:this.t("Cell properties")})),this.children.add(new FormRowView(t,{labelView:ke,children:[ke,be,ve,xe],class:"ck-table-form__border-row"})),this.children.add(new FormRowView(t,{labelView:Ie,children:[Ie,Ae],class:"ck-table-form__background-row"})),this.children.add(new FormRowView(t,{children:[new FormRowView(t,{labelView:Me,children:[Me,Se,Oe,Ve],class:"ck-table-form__dimensions-row"}),new FormRowView(t,{children:[this.paddingInput],class:"ck-table-cell-properties-form__padding-row"})]})),this.children.add(new FormRowView(t,{labelView:Be,children:[Be,De,Fe],class:"ck-table-cell-properties-form__alignment-row"})),this.children.add(new FormRowView(t,{children:[this.saveButtonView,this.cancelButtonView],class:"ck-table-form__action-row"})),this.setTemplate({tag:"form",attributes:{class:["ck","ck-form","ck-table-form","ck-table-cell-properties-form"],tabindex:"-1"},children:this.children})}render(){super.render(),submitHandler({view:this}),[this.borderColorInput,this.backgroundInput].forEach(t=>{t.fieldView.focusCycler.on("forwardCycle",te=>{this._focusCycler.focusNext(),te.stop()}),t.fieldView.focusCycler.on("backwardCycle",te=>{this._focusCycler.focusPrevious(),te.stop()})}),[this.borderStyleDropdown,this.borderColorInput,this.borderWidthInput,this.backgroundInput,this.widthInput,this.heightInput,this.paddingInput,this.horizontalAlignmentToolbar,this.verticalAlignmentToolbar,this.saveButtonView,this.cancelButtonView].forEach(t=>{this._focusables.add(t),this.focusTracker.add(t.element)}),this.keystrokes.listenTo(this.element)}destroy(){super.destroy(),this.focusTracker.destroy(),this.keystrokes.destroy()}focus(){this._focusCycler.focusFirst()}_createBorderFields(){const t=this.options.defaultTableCellProperties,te={style:t.borderStyle,width:t.borderWidth,color:t.borderColor},be=getLabeledColorInputCreator({colorConfig:this.options.borderColors,columns:5,defaultColorValue:te.color,colorPickerConfig:this.options.colorPickerConfig}),xe=this.locale,ve=this.t,ke=ve("Style"),Ie=new LabelView(xe);Ie.text=ve("Border");const Ae=getBorderStyleLabels(ve),Se=new LabeledFieldView(xe,createLabeledDropdown);Se.set({label:ke,class:"ck-table-form__border-style"}),Se.fieldView.buttonView.set({ariaLabel:ke,ariaLabelledBy:void 0,isOn:!1,withText:!0,tooltip:ke}),Se.fieldView.buttonView.bind("label").to(this,"borderStyle",Me=>Ae[Me||"none"]),Se.fieldView.on("execute",Me=>{this.borderStyle=Me.source._borderStyleValue}),Se.bind("isEmpty").to(this,"borderStyle",Me=>!Me),addListToDropdown(Se.fieldView,getBorderStyleDefinitions(this,te.style),{role:"menu",ariaLabel:ke});const Oe=new LabeledFieldView(xe,createLabeledInputText);Oe.set({label:ve("Width"),class:"ck-table-form__border-width"}),Oe.fieldView.bind("value").to(this,"borderWidth"),Oe.bind("isEnabled").to(this,"borderStyle",isBorderStyleSet$1),Oe.fieldView.on("input",()=>{this.borderWidth=Oe.fieldView.element.value});const Ve=new LabeledFieldView(xe,be);return Ve.set({label:ve("Color"),class:"ck-table-form__border-color"}),Ve.fieldView.bind("value").to(this,"borderColor"),Ve.bind("isEnabled").to(this,"borderStyle",isBorderStyleSet$1),Ve.fieldView.on("input",()=>{this.borderColor=Ve.fieldView.value}),this.on("change:borderStyle",(Me,De,Fe,Be)=>{isBorderStyleSet$1(Fe)||(this.borderColor="",this.borderWidth=""),isBorderStyleSet$1(Be)||(this.borderColor=te.color,this.borderWidth=te.width)}),{borderRowLabel:Ie,borderStyleDropdown:Se,borderColorInput:Ve,borderWidthInput:Oe}}_createBackgroundFields(){const t=this.locale,te=this.t,be=new LabelView(t);be.text=te("Background");const xe=getLabeledColorInputCreator({colorConfig:this.options.backgroundColors,columns:5,defaultColorValue:this.options.defaultTableCellProperties.backgroundColor,colorPickerConfig:this.options.colorPickerConfig}),ve=new LabeledFieldView(t,xe);return ve.set({label:te("Color"),class:"ck-table-cell-properties-form__background"}),ve.fieldView.bind("value").to(this,"backgroundColor"),ve.fieldView.on("input",()=>{this.backgroundColor=ve.fieldView.value}),{backgroundRowLabel:be,backgroundInput:ve}}_createDimensionFields(){const t=this.locale,te=this.t,be=new LabelView(t);be.text=te("Dimensions");const xe=new LabeledFieldView(t,createLabeledInputText);xe.set({label:te("Width"),class:"ck-table-form__dimensions-row__width"}),xe.fieldView.bind("value").to(this,"width"),xe.fieldView.on("input",()=>{this.width=xe.fieldView.element.value});const ve=new View(t);ve.setTemplate({tag:"span",attributes:{class:["ck-table-form__dimension-operator"]},children:[{text:"×"}]});const ke=new LabeledFieldView(t,createLabeledInputText);return ke.set({label:te("Height"),class:"ck-table-form__dimensions-row__height"}),ke.fieldView.bind("value").to(this,"height"),ke.fieldView.on("input",()=>{this.height=ke.fieldView.element.value}),{dimensionsLabel:be,widthInput:xe,operatorLabel:ve,heightInput:ke}}_createPaddingField(){const t=this.locale,te=this.t,be=new LabeledFieldView(t,createLabeledInputText);return be.set({label:te("Padding"),class:"ck-table-cell-properties-form__padding"}),be.fieldView.bind("value").to(this,"padding"),be.fieldView.on("input",()=>{this.padding=be.fieldView.element.value}),be}_createAlignmentFields(){const t=this.locale,te=this.t,be=new LabelView(t),xe={left:icons.alignLeft,center:icons.alignCenter,right:icons.alignRight,justify:icons.alignJustify,top:icons.alignTop,middle:icons.alignMiddle,bottom:icons.alignBottom};be.text=te("Table cell text alignment");const ve=new ToolbarView(t),ke=t.contentLanguageDirection==="rtl";ve.set({isCompact:!0,ariaLabel:te("Horizontal text alignment toolbar")}),fillToolbar({view:this,icons:xe,toolbar:ve,labels:this._horizontalAlignmentLabels,propertyName:"horizontalAlignment",nameToValue:Ae=>{if(ke){if(Ae==="left")return"right";if(Ae==="right")return"left"}return Ae},defaultValue:this.options.defaultTableCellProperties.horizontalAlignment});const Ie=new ToolbarView(t);return Ie.set({isCompact:!0,ariaLabel:te("Vertical text alignment toolbar")}),fillToolbar({view:this,icons:xe,toolbar:Ie,labels:this._verticalAlignmentLabels,propertyName:"verticalAlignment",defaultValue:this.options.defaultTableCellProperties.verticalAlignment}),{horizontalAlignmentToolbar:ve,verticalAlignmentToolbar:Ie,alignmentLabel:be}}_createActionButtons(){const t=this.locale,te=this.t,be=new ButtonView(t),xe=new ButtonView(t),ve=[this.borderWidthInput,this.borderColorInput,this.backgroundInput,this.paddingInput];return be.set({label:te("Save"),icon:icons.check,class:"ck-button-save",type:"submit",withText:!0}),be.bind("isEnabled").toMany(ve,"errorText",(...ke)=>ke.every(Ie=>!Ie)),xe.set({label:te("Cancel"),icon:icons.cancel,class:"ck-button-cancel",withText:!0}),xe.delegate("execute").to(this,"cancel"),{saveButtonView:be,cancelButtonView:xe}}get _horizontalAlignmentLabels(){const t=this.locale,te=this.t,be=te("Align cell text to the left"),xe=te("Align cell text to the center"),ve=te("Align cell text to the right"),ke=te("Justify cell text");return t.uiLanguageDirection==="rtl"?{right:ve,center:xe,left:be,justify:ke}:{left:be,center:xe,right:ve,justify:ke}}get _verticalAlignmentLabels(){const t=this.t;return{top:t("Align cell text to the top"),middle:t("Align cell text to the middle"),bottom:t("Align cell text to the bottom")}}}function isBorderStyleSet$1(Te){return Te!=="none"}const BALLOON_POSITIONS=[BalloonPanelView.defaultPositions.northArrowSouth,BalloonPanelView.defaultPositions.northArrowSouthWest,BalloonPanelView.defaultPositions.northArrowSouthEast,BalloonPanelView.defaultPositions.southArrowNorth,BalloonPanelView.defaultPositions.southArrowNorthWest,BalloonPanelView.defaultPositions.southArrowNorthEast,BalloonPanelView.defaultPositions.viewportStickyNorth];function repositionContextualBalloon(Te,we){const t=Te.plugins.get("ContextualBalloon"),te=Te.editing.view.document.selection;let be;we==="cell"?getTableWidgetAncestor(te)&&(be=getBalloonCellPositionData(Te)):getSelectionAffectedTableWidget(te)&&(be=getBalloonTablePositionData(Te)),be&&t.updatePosition(be)}function getBalloonTablePositionData(Te){const we=Te.model.document.selection,t=getSelectionAffectedTable(we),te=Te.editing.mapper.toViewElement(t);return{target:Te.editing.view.domConverter.mapViewToDom(te),positions:BALLOON_POSITIONS}}function getBalloonCellPositionData(Te){const we=Te.editing.mapper,t=Te.editing.view.domConverter,te=Te.model.document.selection;if(te.rangeCount>1)return{target:()=>createBoundingRect(te.getRanges(),Te),positions:BALLOON_POSITIONS};const be=getTableCellAtPosition(te.getFirstPosition()),xe=we.toViewElement(be);return{target:t.mapViewToDom(xe),positions:BALLOON_POSITIONS}}function getTableCellAtPosition(Te){return Te.nodeAfter&&Te.nodeAfter.is("element","tableCell")?Te.nodeAfter:Te.findAncestor("tableCell")}function createBoundingRect(Te,we){const t=we.editing.mapper,te=we.editing.view.domConverter,be=Array.from(Te).map(xe=>{const ve=getTableCellAtPosition(xe.start),ke=t.toViewElement(ve);return new Rect(te.mapViewToDom(ke))});return Rect.getBoundingRect(be)}var tableCellProperties='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="m11.105 18-.17 1H2.5A1.5 1.5 0 0 1 1 17.5v-15A1.5 1.5 0 0 1 2.5 1h15A1.5 1.5 0 0 1 19 2.5v9.975l-.85-.124-.15-.302V8h-5v4h.021l-.172.351-1.916.28-.151.027c-.287.063-.54.182-.755.341L8 13v5h3.105zM2 12h5V8H2v4zm10-4H8v4h4V8zM2 2v5h5V2H2zm0 16h5v-5H2v5zM13 7h5V2h-5v5zM8 2v5h4V2H8z" opacity=".6"/><path d="m15.5 11.5 1.323 2.68 2.957.43-2.14 2.085.505 2.946L15.5 18.25l-2.645 1.39.505-2.945-2.14-2.086 2.957-.43L15.5 11.5zM13 6a1 1 0 0 1 1 1v3.172a2.047 2.047 0 0 0-.293.443l-.858 1.736-1.916.28-.151.027A1.976 1.976 0 0 0 9.315 14H7a1 1 0 0 1-1-1V7a1 1 0 0 1 1-1h6zm-1 2H8v4h4V8z"/></svg>';function getSingleValue(Te){if(!Te||!isObject$2(Te))return Te;const{top:we,right:t,bottom:te,left:be}=Te;if(we==t&&t==te&&te==be)return we}function addDefaultUnitToNumericValue(Te,we){const t=parseFloat(Te);return Number.isNaN(t)||String(t)!==String(Te)?Te:`${t}${we}`}function getNormalizedDefaultProperties(Te,we={}){const t={borderStyle:"none",borderWidth:"",borderColor:"",backgroundColor:"",width:"",height:"",...Te};return we.includeAlignmentProperty&&!t.alignment&&(t.alignment="center"),we.includePaddingProperty&&!t.padding&&(t.padding=""),we.includeVerticalAlignmentProperty&&!t.verticalAlignment&&(t.verticalAlignment="middle"),we.includeHorizontalAlignmentProperty&&!t.horizontalAlignment&&(t.horizontalAlignment=we.isRightToLeftContent?"right":"left"),t}const ERROR_TEXT_TIMEOUT$1=500,propertyToCommandMap$1={borderStyle:"tableCellBorderStyle",borderColor:"tableCellBorderColor",borderWidth:"tableCellBorderWidth",height:"tableCellHeight",width:"tableCellWidth",padding:"tableCellPadding",backgroundColor:"tableCellBackgroundColor",horizontalAlignment:"tableCellHorizontalAlignment",verticalAlignment:"tableCellVerticalAlignment"};class TableCellPropertiesUI extends Plugin{constructor(t){super(t);Re(this,"_defaultTableCellProperties");Re(this,"_balloon");Re(this,"view");Re(this,"_undoStepBatch");Re(this,"_isReady");t.config.define("table.tableCellProperties",{borderColors:defaultColors,backgroundColors:defaultColors})}static get requires(){return[ContextualBalloon]}static get pluginName(){return"TableCellPropertiesUI"}init(){const t=this.editor,te=t.t;this._defaultTableCellProperties=getNormalizedDefaultProperties(t.config.get("table.tableCellProperties.defaultProperties"),{includeVerticalAlignmentProperty:!0,includeHorizontalAlignmentProperty:!0,includePaddingProperty:!0,isRightToLeftContent:t.locale.contentLanguageDirection==="rtl"}),this._balloon=t.plugins.get(ContextualBalloon),this.view=null,this._isReady=!1,t.ui.componentFactory.add("tableCellProperties",be=>{const xe=new ButtonView(be);xe.set({label:te("Cell properties"),icon:tableCellProperties,tooltip:!0}),this.listenTo(xe,"execute",()=>this._showView());const ve=Object.values(propertyToCommandMap$1).map(ke=>t.commands.get(ke));return xe.bind("isEnabled").toMany(ve,"isEnabled",(...ke)=>ke.some(Ie=>Ie)),xe})}destroy(){super.destroy(),this.view&&this.view.destroy()}_createPropertiesView(){const t=this.editor,te=t.config.get("table.tableCellProperties"),be=normalizeColorOptions(te.borderColors),xe=getLocalizedColorOptions(t.locale,be),ve=normalizeColorOptions(te.backgroundColors),ke=getLocalizedColorOptions(t.locale,ve),Ie=te.colorPicker!==!1,Ae=new TableCellPropertiesView(t.locale,{borderColors:xe,backgroundColors:ke,defaultTableCellProperties:this._defaultTableCellProperties,colorPickerConfig:Ie?te.colorPicker||{}:!1}),Se=t.t;Ae.render(),this.listenTo(Ae,"submit",()=>{this._hideView()}),this.listenTo(Ae,"cancel",()=>{this._undoStepBatch.operations.length&&t.execute("undo",this._undoStepBatch),this._hideView()}),Ae.keystrokes.set("Esc",(Me,De)=>{this._hideView(),De()}),clickOutsideHandler({emitter:Ae,activator:()=>this._isViewInBalloon,contextElements:[this._balloon.view.element],callback:()=>this._hideView()});const Oe=getLocalizedColorErrorText(Se),Ve=getLocalizedLengthErrorText(Se);return Ae.on("change:borderStyle",this._getPropertyChangeCallback("tableCellBorderStyle")),Ae.on("change:borderColor",this._getValidatedPropertyChangeCallback({viewField:Ae.borderColorInput,commandName:"tableCellBorderColor",errorText:Oe,validator:colorFieldValidator})),Ae.on("change:borderWidth",this._getValidatedPropertyChangeCallback({viewField:Ae.borderWidthInput,commandName:"tableCellBorderWidth",errorText:Ve,validator:lineWidthFieldValidator})),Ae.on("change:padding",this._getValidatedPropertyChangeCallback({viewField:Ae.paddingInput,commandName:"tableCellPadding",errorText:Ve,validator:lengthFieldValidator})),Ae.on("change:width",this._getValidatedPropertyChangeCallback({viewField:Ae.widthInput,commandName:"tableCellWidth",errorText:Ve,validator:lengthFieldValidator})),Ae.on("change:height",this._getValidatedPropertyChangeCallback({viewField:Ae.heightInput,commandName:"tableCellHeight",errorText:Ve,validator:lengthFieldValidator})),Ae.on("change:backgroundColor",this._getValidatedPropertyChangeCallback({viewField:Ae.backgroundInput,commandName:"tableCellBackgroundColor",errorText:Oe,validator:colorFieldValidator})),Ae.on("change:horizontalAlignment",this._getPropertyChangeCallback("tableCellHorizontalAlignment")),Ae.on("change:verticalAlignment",this._getPropertyChangeCallback("tableCellVerticalAlignment")),Ae}_fillViewFormFromCommandValues(){const t=this.editor.commands,te=t.get("tableCellBorderStyle");Object.entries(propertyToCommandMap$1).map(([be,xe])=>{const ve=this._defaultTableCellProperties[be]||"";return[be,t.get(xe).value||ve]}).forEach(([be,xe])=>{(be==="borderColor"||be==="borderWidth")&&te.value==="none"||this.view.set(be,xe)}),this._isReady=!0}_showView(){const t=this.editor;this.view||(this.view=this._createPropertiesView()),this.listenTo(t.ui,"update",()=>{this._updateView()}),this._fillViewFormFromCommandValues(),this._balloon.add({view:this.view,position:getBalloonCellPositionData(t)}),this._undoStepBatch=t.model.createBatch(),this.view.focus()}_hideView(){const t=this.editor;this.stopListening(t.ui,"update"),this._isReady=!1,this.view.saveButtonView.focus(),this._balloon.remove(this.view),this.editor.editing.view.focus()}_updateView(){const t=this.editor,te=t.editing.view.document;getTableWidgetAncestor(te.selection)?this._isViewVisible&&repositionContextualBalloon(t,"cell"):this._hideView()}get _isViewVisible(){return!!this.view&&this._balloon.visibleView===this.view}get _isViewInBalloon(){return!!this.view&&this._balloon.hasView(this.view)}_getPropertyChangeCallback(t){return(te,be,xe)=>{this._isReady&&this.editor.execute(t,{value:xe,batch:this._undoStepBatch})}}_getValidatedPropertyChangeCallback(t){const{commandName:te,viewField:be,validator:xe,errorText:ve}=t,ke=debounce(()=>{be.errorText=ve},ERROR_TEXT_TIMEOUT$1);return(Ie,Ae,Se)=>{ke.cancel(),this._isReady&&(xe(Se)?(this.editor.execute(te,{value:Se,batch:this._undoStepBatch}),be.errorText=null):ke())}}}class TableCellPropertyCommand extends Command{constructor(t,te,be){super(t);Re(this,"attributeName");Re(this,"_defaultValue");this.attributeName=te,this._defaultValue=be}refresh(){const t=this.editor,be=this.editor.plugins.get("TableUtils").getSelectionAffectedTableCells(t.model.document.selection);this.isEnabled=!!be.length,this.value=this._getSingleValue(be)}execute(t={}){const{value:te,batch:be}=t,xe=this.editor.model,ke=this.editor.plugins.get("TableUtils").getSelectionAffectedTableCells(xe.document.selection),Ie=this._getValueToSet(te);xe.enqueueChange(be,Ae=>{Ie?ke.forEach(Se=>Ae.setAttribute(this.attributeName,Ie,Se)):ke.forEach(Se=>Ae.removeAttribute(this.attributeName,Se))})}_getAttribute(t){if(!t)return;const te=t.getAttribute(this.attributeName);if(te!==this._defaultValue)return te}_getValueToSet(t){if(t!==this._defaultValue)return t}_getSingleValue(t){const te=this._getAttribute(t[0]);return t.every(xe=>this._getAttribute(xe)===te)?te:void 0}}class TableCellWidthCommand extends TableCellPropertyCommand{constructor(we,t){super(we,"tableCellWidth",t)}_getValueToSet(we){if(we=addDefaultUnitToNumericValue(we,"px"),we!==this._defaultValue)return we}}class TableCellWidthEditing extends Plugin{static get pluginName(){return"TableCellWidthEditing"}static get requires(){return[TableEditing]}init(){const we=this.editor,t=getNormalizedDefaultProperties(we.config.get("table.tableCellProperties.defaultProperties"));enableProperty$1(we.model.schema,we.conversion,{modelAttribute:"tableCellWidth",styleName:"width",defaultValue:t.width}),we.commands.add("tableCellWidth",new TableCellWidthCommand(we,t.width))}}class TableCellPaddingCommand extends TableCellPropertyCommand{constructor(we,t){super(we,"tableCellPadding",t)}_getAttribute(we){if(!we)return;const t=getSingleValue(we.getAttribute(this.attributeName));if(t!==this._defaultValue)return t}_getValueToSet(we){const t=addDefaultUnitToNumericValue(we,"px");if(t!==this._defaultValue)return t}}class TableCellHeightCommand extends TableCellPropertyCommand{constructor(we,t){super(we,"tableCellHeight",t)}_getValueToSet(we){const t=addDefaultUnitToNumericValue(we,"px");if(t!==this._defaultValue)return t}}class TableCellBackgroundColorCommand extends TableCellPropertyCommand{constructor(we,t){super(we,"tableCellBackgroundColor",t)}}class TableCellVerticalAlignmentCommand extends TableCellPropertyCommand{constructor(we,t){super(we,"tableCellVerticalAlignment",t)}}class TableCellHorizontalAlignmentCommand extends TableCellPropertyCommand{constructor(we,t){super(we,"tableCellHorizontalAlignment",t)}}class TableCellBorderStyleCommand extends TableCellPropertyCommand{constructor(we,t){super(we,"tableCellBorderStyle",t)}_getAttribute(we){if(!we)return;const t=getSingleValue(we.getAttribute(this.attributeName));if(t!==this._defaultValue)return t}}class TableCellBorderColorCommand extends TableCellPropertyCommand{constructor(we,t){super(we,"tableCellBorderColor",t)}_getAttribute(we){if(!we)return;const t=getSingleValue(we.getAttribute(this.attributeName));if(t!==this._defaultValue)return t}}class TableCellBorderWidthCommand extends TableCellPropertyCommand{constructor(we,t){super(we,"tableCellBorderWidth",t)}_getAttribute(we){if(!we)return;const t=getSingleValue(we.getAttribute(this.attributeName));if(t!==this._defaultValue)return t}_getValueToSet(we){const t=addDefaultUnitToNumericValue(we,"px");if(t!==this._defaultValue)return t}}const VALIGN_VALUES_REG_EXP=/^(top|middle|bottom)$/,ALIGN_VALUES_REG_EXP$1=/^(left|center|right|justify)$/;class TableCellPropertiesEditing extends Plugin{static get pluginName(){return"TableCellPropertiesEditing"}static get requires(){return[TableEditing,TableCellWidthEditing]}init(){const we=this.editor,t=we.model.schema,te=we.conversion;we.config.define("table.tableCellProperties.defaultProperties",{});const be=getNormalizedDefaultProperties(we.config.get("table.tableCellProperties.defaultProperties"),{includeVerticalAlignmentProperty:!0,includeHorizontalAlignmentProperty:!0,includePaddingProperty:!0,isRightToLeftContent:we.locale.contentLanguageDirection==="rtl"});we.data.addStyleProcessorRules(addBorderRules),enableBorderProperties$1(t,te,{color:be.borderColor,style:be.borderStyle,width:be.borderWidth}),we.commands.add("tableCellBorderStyle",new TableCellBorderStyleCommand(we,be.borderStyle)),we.commands.add("tableCellBorderColor",new TableCellBorderColorCommand(we,be.borderColor)),we.commands.add("tableCellBorderWidth",new TableCellBorderWidthCommand(we,be.borderWidth)),enableProperty$1(t,te,{modelAttribute:"tableCellHeight",styleName:"height",defaultValue:be.height}),we.commands.add("tableCellHeight",new TableCellHeightCommand(we,be.height)),we.data.addStyleProcessorRules(addPaddingRules),enableProperty$1(t,te,{modelAttribute:"tableCellPadding",styleName:"padding",reduceBoxSides:!0,defaultValue:be.padding}),we.commands.add("tableCellPadding",new TableCellPaddingCommand(we,be.padding)),we.data.addStyleProcessorRules(addBackgroundRules),enableProperty$1(t,te,{modelAttribute:"tableCellBackgroundColor",styleName:"background-color",defaultValue:be.backgroundColor}),we.commands.add("tableCellBackgroundColor",new TableCellBackgroundColorCommand(we,be.backgroundColor)),enableHorizontalAlignmentProperty(t,te,be.horizontalAlignment),we.commands.add("tableCellHorizontalAlignment",new TableCellHorizontalAlignmentCommand(we,be.horizontalAlignment)),enableVerticalAlignmentProperty(t,te,be.verticalAlignment),we.commands.add("tableCellVerticalAlignment",new TableCellVerticalAlignmentCommand(we,be.verticalAlignment))}}function enableBorderProperties$1(Te,we,t){const te={width:"tableCellBorderWidth",color:"tableCellBorderColor",style:"tableCellBorderStyle"};Te.extend("tableCell",{allowAttributes:Object.values(te)}),upcastBorderStyles(we,"td",te,t),upcastBorderStyles(we,"th",te,t),downcastAttributeToStyle(we,{modelElement:"tableCell",modelAttribute:te.style,styleName:"border-style"}),downcastAttributeToStyle(we,{modelElement:"tableCell",modelAttribute:te.color,styleName:"border-color"}),downcastAttributeToStyle(we,{modelElement:"tableCell",modelAttribute:te.width,styleName:"border-width"})}function enableHorizontalAlignmentProperty(Te,we,t){Te.extend("tableCell",{allowAttributes:["tableCellHorizontalAlignment"]}),we.for("downcast").attributeToAttribute({model:{name:"tableCell",key:"tableCellHorizontalAlignment"},view:te=>({key:"style",value:{"text-align":te}})}),we.for("upcast").attributeToAttribute({view:{name:/^(td|th)$/,styles:{"text-align":ALIGN_VALUES_REG_EXP$1}},model:{key:"tableCellHorizontalAlignment",value:te=>{const be=te.getStyle("text-align");return be===t?null:be}}}).attributeToAttribute({view:{name:/^(td|th)$/,attributes:{align:ALIGN_VALUES_REG_EXP$1}},model:{key:"tableCellHorizontalAlignment",value:te=>{const be=te.getAttribute("align");return be===t?null:be}}})}function enableVerticalAlignmentProperty(Te,we,t){Te.extend("tableCell",{allowAttributes:["tableCellVerticalAlignment"]}),we.for("downcast").attributeToAttribute({model:{name:"tableCell",key:"tableCellVerticalAlignment"},view:te=>({key:"style",value:{"vertical-align":te}})}),we.for("upcast").attributeToAttribute({view:{name:/^(td|th)$/,styles:{"vertical-align":VALIGN_VALUES_REG_EXP}},model:{key:"tableCellVerticalAlignment",value:te=>{const be=te.getStyle("vertical-align");return be===t?null:be}}}).attributeToAttribute({view:{name:/^(td|th)$/,attributes:{valign:VALIGN_VALUES_REG_EXP}},model:{key:"tableCellVerticalAlignment",value:te=>{const be=te.getAttribute("valign");return be===t?null:be}}})}class TableCellProperties extends Plugin{static get pluginName(){return"TableCellProperties"}static get requires(){return[TableCellPropertiesEditing,TableCellPropertiesUI]}}class TablePropertyCommand extends Command{constructor(t,te,be){super(t);Re(this,"attributeName");Re(this,"_defaultValue");this.attributeName=te,this._defaultValue=be}refresh(){const te=this.editor.model.document.selection,be=getSelectionAffectedTable(te);this.isEnabled=!!be,this.value=this._getValue(be)}execute(t={}){const te=this.editor.model,be=te.document.selection,{value:xe,batch:ve}=t,ke=getSelectionAffectedTable(be),Ie=this._getValueToSet(xe);te.enqueueChange(ve,Ae=>{Ie?Ae.setAttribute(this.attributeName,Ie,ke):Ae.removeAttribute(this.attributeName,ke)})}_getValue(t){if(!t)return;const te=t.getAttribute(this.attributeName);if(te!==this._defaultValue)return te}_getValueToSet(t){if(t!==this._defaultValue)return t}}class TableBackgroundColorCommand extends TablePropertyCommand{constructor(we,t){super(we,"tableBackgroundColor",t)}}class TableBorderColorCommand extends TablePropertyCommand{constructor(we,t){super(we,"tableBorderColor",t)}_getValue(we){if(!we)return;const t=getSingleValue(we.getAttribute(this.attributeName));if(t!==this._defaultValue)return t}}class TableBorderStyleCommand extends TablePropertyCommand{constructor(we,t){super(we,"tableBorderStyle",t)}_getValue(we){if(!we)return;const t=getSingleValue(we.getAttribute(this.attributeName));if(t!==this._defaultValue)return t}}class TableBorderWidthCommand extends TablePropertyCommand{constructor(we,t){super(we,"tableBorderWidth",t)}_getValue(we){if(!we)return;const t=getSingleValue(we.getAttribute(this.attributeName));if(t!==this._defaultValue)return t}_getValueToSet(we){const t=addDefaultUnitToNumericValue(we,"px");if(t!==this._defaultValue)return t}}class TableWidthCommand extends TablePropertyCommand{constructor(we,t){super(we,"tableWidth",t)}_getValueToSet(we){if(we=addDefaultUnitToNumericValue(we,"px"),we!==this._defaultValue)return we}}class TableHeightCommand extends TablePropertyCommand{constructor(we,t){super(we,"tableHeight",t)}_getValueToSet(we){if(we=addDefaultUnitToNumericValue(we,"px"),we!==this._defaultValue)return we}}class TableAlignmentCommand extends TablePropertyCommand{constructor(we,t){super(we,"tableAlignment",t)}}const ALIGN_VALUES_REG_EXP=/^(left|center|right)$/,FLOAT_VALUES_REG_EXP=/^(left|none|right)$/;class TablePropertiesEditing extends Plugin{static get pluginName(){return"TablePropertiesEditing"}static get requires(){return[TableEditing]}init(){const we=this.editor,t=we.model.schema,te=we.conversion;we.config.define("table.tableProperties.defaultProperties",{});const be=getNormalizedDefaultProperties(we.config.get("table.tableProperties.defaultProperties"),{includeAlignmentProperty:!0});we.data.addStyleProcessorRules(addBorderRules),enableBorderProperties(t,te,{color:be.borderColor,style:be.borderStyle,width:be.borderWidth}),we.commands.add("tableBorderColor",new TableBorderColorCommand(we,be.borderColor)),we.commands.add("tableBorderStyle",new TableBorderStyleCommand(we,be.borderStyle)),we.commands.add("tableBorderWidth",new TableBorderWidthCommand(we,be.borderWidth)),enableAlignmentProperty(t,te,be.alignment),we.commands.add("tableAlignment",new TableAlignmentCommand(we,be.alignment)),enableTableToFigureProperty(t,te,{modelAttribute:"tableWidth",styleName:"width",defaultValue:be.width}),we.commands.add("tableWidth",new TableWidthCommand(we,be.width)),enableTableToFigureProperty(t,te,{modelAttribute:"tableHeight",styleName:"height",defaultValue:be.height}),we.commands.add("tableHeight",new TableHeightCommand(we,be.height)),we.data.addStyleProcessorRules(addBackgroundRules),enableProperty(t,te,{modelAttribute:"tableBackgroundColor",styleName:"background-color",defaultValue:be.backgroundColor}),we.commands.add("tableBackgroundColor",new TableBackgroundColorCommand(we,be.backgroundColor))}}function enableBorderProperties(Te,we,t){const te={width:"tableBorderWidth",color:"tableBorderColor",style:"tableBorderStyle"};Te.extend("table",{allowAttributes:Object.values(te)}),upcastBorderStyles(we,"table",te,t),downcastTableAttribute(we,{modelAttribute:te.color,styleName:"border-color"}),downcastTableAttribute(we,{modelAttribute:te.style,styleName:"border-style"}),downcastTableAttribute(we,{modelAttribute:te.width,styleName:"border-width"})}function enableAlignmentProperty(Te,we,t){Te.extend("table",{allowAttributes:["tableAlignment"]}),we.for("downcast").attributeToAttribute({model:{name:"table",key:"tableAlignment"},view:te=>({key:"style",value:{float:te==="center"?"none":te}}),converterPriority:"high"}),we.for("upcast").attributeToAttribute({view:{name:/^(table|figure)$/,styles:{float:FLOAT_VALUES_REG_EXP}},model:{key:"tableAlignment",value:te=>{let be=te.getStyle("float");return be==="none"&&(be="center"),be===t?null:be}}}).attributeToAttribute({view:{attributes:{align:ALIGN_VALUES_REG_EXP}},model:{name:"table",key:"tableAlignment",value:te=>{const be=te.getAttribute("align");return be===t?null:be}}})}function enableProperty(Te,we,t){const{modelAttribute:te}=t;Te.extend("table",{allowAttributes:[te]}),upcastStyleToAttribute(we,{viewElement:"table",...t}),downcastTableAttribute(we,t)}function enableTableToFigureProperty(Te,we,t){const{modelAttribute:te}=t;Te.extend("table",{allowAttributes:[te]}),upcastStyleToAttribute(we,{viewElement:/^(table|figure)$/,shouldUpcast:be=>!(be.name=="table"&&be.parent.name=="figure"),...t}),downcastAttributeToStyle(we,{modelElement:"table",...t})}class TablePropertiesView extends View{constructor(t,te){super(t);Re(this,"options");Re(this,"focusTracker");Re(this,"keystrokes");Re(this,"children");Re(this,"borderStyleDropdown");Re(this,"borderWidthInput");Re(this,"borderColorInput");Re(this,"backgroundInput");Re(this,"widthInput");Re(this,"heightInput");Re(this,"alignmentToolbar");Re(this,"saveButtonView");Re(this,"cancelButtonView");Re(this,"_focusables");Re(this,"_focusCycler");this.set({borderStyle:"",borderWidth:"",borderColor:"",backgroundColor:"",width:"",height:"",alignment:""}),this.options=te;const{borderStyleDropdown:be,borderWidthInput:xe,borderColorInput:ve,borderRowLabel:ke}=this._createBorderFields(),{backgroundRowLabel:Ie,backgroundInput:Ae}=this._createBackgroundFields(),{widthInput:Se,operatorLabel:Oe,heightInput:Ve,dimensionsLabel:Me}=this._createDimensionFields(),{alignmentToolbar:De,alignmentLabel:Fe}=this._createAlignmentFields();this.focusTracker=new FocusTracker,this.keystrokes=new KeystrokeHandler,this.children=this.createCollection(),this.borderStyleDropdown=be,this.borderWidthInput=xe,this.borderColorInput=ve,this.backgroundInput=Ae,this.widthInput=Se,this.heightInput=Ve,this.alignmentToolbar=De;const{saveButtonView:Be,cancelButtonView:$e}=this._createActionButtons();this.saveButtonView=Be,this.cancelButtonView=$e,this._focusables=new ViewCollection,this._focusCycler=new FocusCycler({focusables:this._focusables,focusTracker:this.focusTracker,keystrokeHandler:this.keystrokes,actions:{focusPrevious:"shift + tab",focusNext:"tab"}}),this.children.add(new FormHeaderView(t,{label:this.t("Table properties")})),this.children.add(new FormRowView(t,{labelView:ke,children:[ke,be,ve,xe],class:"ck-table-form__border-row"})),this.children.add(new FormRowView(t,{labelView:Ie,children:[Ie,Ae],class:"ck-table-form__background-row"})),this.children.add(new FormRowView(t,{children:[new FormRowView(t,{labelView:Me,children:[Me,Se,Oe,Ve],class:"ck-table-form__dimensions-row"}),new FormRowView(t,{labelView:Fe,children:[Fe,De],class:"ck-table-properties-form__alignment-row"})]})),this.children.add(new FormRowView(t,{children:[this.saveButtonView,this.cancelButtonView],class:"ck-table-form__action-row"})),this.setTemplate({tag:"form",attributes:{class:["ck","ck-form","ck-table-form","ck-table-properties-form"],tabindex:"-1"},children:this.children})}render(){super.render(),submitHandler({view:this}),[this.borderColorInput,this.backgroundInput].forEach(t=>{t.fieldView.focusCycler.on("forwardCycle",te=>{this._focusCycler.focusNext(),te.stop()}),t.fieldView.focusCycler.on("backwardCycle",te=>{this._focusCycler.focusPrevious(),te.stop()})}),[this.borderStyleDropdown,this.borderColorInput,this.borderWidthInput,this.backgroundInput,this.widthInput,this.heightInput,this.alignmentToolbar,this.saveButtonView,this.cancelButtonView].forEach(t=>{this._focusables.add(t),this.focusTracker.add(t.element)}),this.keystrokes.listenTo(this.element)}destroy(){super.destroy(),this.focusTracker.destroy(),this.keystrokes.destroy()}focus(){this._focusCycler.focusFirst()}_createBorderFields(){const t=this.options.defaultTableProperties,te={style:t.borderStyle,width:t.borderWidth,color:t.borderColor},be=getLabeledColorInputCreator({colorConfig:this.options.borderColors,columns:5,defaultColorValue:te.color,colorPickerConfig:this.options.colorPickerConfig}),xe=this.locale,ve=this.t,ke=ve("Style"),Ie=new LabelView(xe);Ie.text=ve("Border");const Ae=getBorderStyleLabels(ve),Se=new LabeledFieldView(xe,createLabeledDropdown);Se.set({label:ke,class:"ck-table-form__border-style"}),Se.fieldView.buttonView.set({ariaLabel:ke,ariaLabelledBy:void 0,isOn:!1,withText:!0,tooltip:ke}),Se.fieldView.buttonView.bind("label").to(this,"borderStyle",Me=>Ae[Me||"none"]),Se.fieldView.on("execute",Me=>{this.borderStyle=Me.source._borderStyleValue}),Se.bind("isEmpty").to(this,"borderStyle",Me=>!Me),addListToDropdown(Se.fieldView,getBorderStyleDefinitions(this,te.style),{role:"menu",ariaLabel:ke});const Oe=new LabeledFieldView(xe,createLabeledInputText);Oe.set({label:ve("Width"),class:"ck-table-form__border-width"}),Oe.fieldView.bind("value").to(this,"borderWidth"),Oe.bind("isEnabled").to(this,"borderStyle",isBorderStyleSet),Oe.fieldView.on("input",()=>{this.borderWidth=Oe.fieldView.element.value});const Ve=new LabeledFieldView(xe,be);return Ve.set({label:ve("Color"),class:"ck-table-form__border-color"}),Ve.fieldView.bind("value").to(this,"borderColor"),Ve.bind("isEnabled").to(this,"borderStyle",isBorderStyleSet),Ve.fieldView.on("input",()=>{this.borderColor=Ve.fieldView.value}),this.on("change:borderStyle",(Me,De,Fe,Be)=>{isBorderStyleSet(Fe)||(this.borderColor="",this.borderWidth=""),isBorderStyleSet(Be)||(this.borderColor=te.color,this.borderWidth=te.width)}),{borderRowLabel:Ie,borderStyleDropdown:Se,borderColorInput:Ve,borderWidthInput:Oe}}_createBackgroundFields(){const t=this.locale,te=this.t,be=new LabelView(t);be.text=te("Background");const xe=getLabeledColorInputCreator({colorConfig:this.options.backgroundColors,columns:5,defaultColorValue:this.options.defaultTableProperties.backgroundColor,colorPickerConfig:this.options.colorPickerConfig}),ve=new LabeledFieldView(t,xe);return ve.set({label:te("Color"),class:"ck-table-properties-form__background"}),ve.fieldView.bind("value").to(this,"backgroundColor"),ve.fieldView.on("input",()=>{this.backgroundColor=ve.fieldView.value}),{backgroundRowLabel:be,backgroundInput:ve}}_createDimensionFields(){const t=this.locale,te=this.t,be=new LabelView(t);be.text=te("Dimensions");const xe=new LabeledFieldView(t,createLabeledInputText);xe.set({label:te("Width"),class:"ck-table-form__dimensions-row__width"}),xe.fieldView.bind("value").to(this,"width"),xe.fieldView.on("input",()=>{this.width=xe.fieldView.element.value});const ve=new View(t);ve.setTemplate({tag:"span",attributes:{class:["ck-table-form__dimension-operator"]},children:[{text:"×"}]});const ke=new LabeledFieldView(t,createLabeledInputText);return ke.set({label:te("Height"),class:"ck-table-form__dimensions-row__height"}),ke.fieldView.bind("value").to(this,"height"),ke.fieldView.on("input",()=>{this.height=ke.fieldView.element.value}),{dimensionsLabel:be,widthInput:xe,operatorLabel:ve,heightInput:ke}}_createAlignmentFields(){const t=this.locale,te=this.t,be=new LabelView(t);be.text=te("Alignment");const xe=new ToolbarView(t);return xe.set({isCompact:!0,ariaLabel:te("Table alignment toolbar")}),fillToolbar({view:this,icons:{left:icons.objectLeft,center:icons.objectCenter,right:icons.objectRight},toolbar:xe,labels:this._alignmentLabels,propertyName:"alignment",defaultValue:this.options.defaultTableProperties.alignment}),{alignmentLabel:be,alignmentToolbar:xe}}_createActionButtons(){const t=this.locale,te=this.t,be=new ButtonView(t),xe=new ButtonView(t),ve=[this.borderWidthInput,this.borderColorInput,this.backgroundInput,this.widthInput,this.heightInput];return be.set({label:te("Save"),icon:icons.check,class:"ck-button-save",type:"submit",withText:!0}),be.bind("isEnabled").toMany(ve,"errorText",(...ke)=>ke.every(Ie=>!Ie)),xe.set({label:te("Cancel"),icon:icons.cancel,class:"ck-button-cancel",withText:!0}),xe.delegate("execute").to(this,"cancel"),{saveButtonView:be,cancelButtonView:xe}}get _alignmentLabels(){const t=this.locale,te=this.t,be=te("Align table to the left"),xe=te("Center table"),ve=te("Align table to the right");return t.uiLanguageDirection==="rtl"?{right:ve,center:xe,left:be}:{left:be,center:xe,right:ve}}}function isBorderStyleSet(Te){return Te!=="none"}var tableProperties='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M8 2v5h4V2h1v5h5v1h-5v4h.021l-.172.351-1.916.28-.151.027c-.287.063-.54.182-.755.341L8 13v5H7v-5H2v-1h5V8H2V7h5V2h1zm4 6H8v4h4V8z" opacity=".6"/><path d="m15.5 11.5 1.323 2.68 2.957.43-2.14 2.085.505 2.946L15.5 18.25l-2.645 1.39.505-2.945-2.14-2.086 2.957-.43L15.5 11.5zM17 1a2 2 0 0 1 2 2v9.475l-.85-.124-.857-1.736a2.048 2.048 0 0 0-.292-.44L17 3H3v14h7.808l.402.392L10.935 19H3a2 2 0 0 1-2-2V3a2 2 0 0 1 2-2h14z"/></svg>';const ERROR_TEXT_TIMEOUT=500,propertyToCommandMap={borderStyle:"tableBorderStyle",borderColor:"tableBorderColor",borderWidth:"tableBorderWidth",backgroundColor:"tableBackgroundColor",width:"tableWidth",height:"tableHeight",alignment:"tableAlignment"};class TablePropertiesUI extends Plugin{constructor(t){super(t);Re(this,"_defaultTableProperties");Re(this,"_balloon");Re(this,"view",null);Re(this,"_undoStepBatch");Re(this,"_isReady");t.config.define("table.tableProperties",{borderColors:defaultColors,backgroundColors:defaultColors})}static get requires(){return[ContextualBalloon]}static get pluginName(){return"TablePropertiesUI"}init(){const t=this.editor,te=t.t;this._defaultTableProperties=getNormalizedDefaultProperties(t.config.get("table.tableProperties.defaultProperties"),{includeAlignmentProperty:!0}),this._balloon=t.plugins.get(ContextualBalloon),t.ui.componentFactory.add("tableProperties",be=>{const xe=new ButtonView(be);xe.set({label:te("Table properties"),icon:tableProperties,tooltip:!0}),this.listenTo(xe,"execute",()=>this._showView());const ve=Object.values(propertyToCommandMap).map(ke=>t.commands.get(ke));return xe.bind("isEnabled").toMany(ve,"isEnabled",(...ke)=>ke.some(Ie=>Ie)),xe})}destroy(){super.destroy(),this.view&&this.view.destroy()}_createPropertiesView(){const t=this.editor,te=t.config.get("table.tableProperties"),be=normalizeColorOptions(te.borderColors),xe=getLocalizedColorOptions(t.locale,be),ve=normalizeColorOptions(te.backgroundColors),ke=getLocalizedColorOptions(t.locale,ve),Ie=te.colorPicker!==!1,Ae=new TablePropertiesView(t.locale,{borderColors:xe,backgroundColors:ke,defaultTableProperties:this._defaultTableProperties,colorPickerConfig:Ie?te.colorPicker||{}:!1}),Se=t.t;Ae.render(),this.listenTo(Ae,"submit",()=>{this._hideView()}),this.listenTo(Ae,"cancel",()=>{this._undoStepBatch.operations.length&&t.execute("undo",this._undoStepBatch),this._hideView()}),Ae.keystrokes.set("Esc",(Me,De)=>{this._hideView(),De()}),clickOutsideHandler({emitter:Ae,activator:()=>this._isViewInBalloon,contextElements:[this._balloon.view.element],callback:()=>this._hideView()});const Oe=getLocalizedColorErrorText(Se),Ve=getLocalizedLengthErrorText(Se);return Ae.on("change:borderStyle",this._getPropertyChangeCallback("tableBorderStyle")),Ae.on("change:borderColor",this._getValidatedPropertyChangeCallback({viewField:Ae.borderColorInput,commandName:"tableBorderColor",errorText:Oe,validator:colorFieldValidator})),Ae.on("change:borderWidth",this._getValidatedPropertyChangeCallback({viewField:Ae.borderWidthInput,commandName:"tableBorderWidth",errorText:Ve,validator:lineWidthFieldValidator})),Ae.on("change:backgroundColor",this._getValidatedPropertyChangeCallback({viewField:Ae.backgroundInput,commandName:"tableBackgroundColor",errorText:Oe,validator:colorFieldValidator})),Ae.on("change:width",this._getValidatedPropertyChangeCallback({viewField:Ae.widthInput,commandName:"tableWidth",errorText:Ve,validator:lengthFieldValidator})),Ae.on("change:height",this._getValidatedPropertyChangeCallback({viewField:Ae.heightInput,commandName:"tableHeight",errorText:Ve,validator:lengthFieldValidator})),Ae.on("change:alignment",this._getPropertyChangeCallback("tableAlignment")),Ae}_fillViewFormFromCommandValues(){const t=this.editor.commands,te=t.get("tableBorderStyle");Object.entries(propertyToCommandMap).map(([be,xe])=>{const ve=be,ke=this._defaultTableProperties[ve]||"";return[ve,t.get(xe).value||ke]}).forEach(([be,xe])=>{(be==="borderColor"||be==="borderWidth")&&te.value==="none"||this.view.set(be,xe)}),this._isReady=!0}_showView(){const t=this.editor;this.view||(this.view=this._createPropertiesView()),this.listenTo(t.ui,"update",()=>{this._updateView()}),this._fillViewFormFromCommandValues(),this._balloon.add({view:this.view,position:getBalloonTablePositionData(t)}),this._undoStepBatch=t.model.createBatch(),this.view.focus()}_hideView(){const t=this.editor;this.stopListening(t.ui,"update"),this._isReady=!1,this.view.saveButtonView.focus(),this._balloon.remove(this.view),this.editor.editing.view.focus()}_updateView(){const t=this.editor,te=t.editing.view.document;getSelectionAffectedTableWidget(te.selection)?this._isViewVisible&&repositionContextualBalloon(t,"table"):this._hideView()}get _isViewVisible(){return!!this.view&&this._balloon.visibleView===this.view}get _isViewInBalloon(){return!!this.view&&this._balloon.hasView(this.view)}_getPropertyChangeCallback(t){return(te,be,xe)=>{this._isReady&&this.editor.execute(t,{value:xe,batch:this._undoStepBatch})}}_getValidatedPropertyChangeCallback(t){const{commandName:te,viewField:be,validator:xe,errorText:ve}=t,ke=debounce(()=>{be.errorText=ve},ERROR_TEXT_TIMEOUT);return(Ie,Ae,Se)=>{ke.cancel(),this._isReady&&(xe(Se)?(this.editor.execute(te,{value:Se,batch:this._undoStepBatch}),be.errorText=null):ke())}}}class TableProperties extends Plugin{static get pluginName(){return"TableProperties"}static get requires(){return[TablePropertiesEditing,TablePropertiesUI]}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function injectTableCaptionPostFixer(Te){Te.document.registerPostFixer(we=>tableCaptionPostFixer(we,Te))}function tableCaptionPostFixer(Te,we){const t=we.document.differ.getChanges();let te=!1;for(const be of t){if(be.type!="insert")continue;const xe=be.position.parent;if(xe.is("element","table")||be.name=="table"){const ve=be.name=="table"?be.position.nodeAfter:xe,ke=Array.from(ve.getChildren()).filter(Ae=>Ae.is("element","caption")),Ie=ke.shift();if(!Ie)continue;for(const Ae of ke)Te.move(Te.createRangeIn(Ae),Ie,"end"),Te.remove(Ae);Ie.nextSibling&&(Te.move(Te.createRangeOn(Ie),ve,"end"),te=!0),te=!!ke.length||te}}return te}function isTable(Te){return!!Te&&Te.is("element","table")}function getCaptionFromTableModelElement(Te){for(const we of Te.getChildren())if(we.is("element","caption"))return we;return null}function getCaptionFromModelSelection(Te){const we=getSelectionAffectedTable(Te);return we?getCaptionFromTableModelElement(we):null}function matchTableCaptionViewElement(Te){const we=Te.parent;return Te.name=="figcaption"&&we&&we.is("element","figure")&&we.hasClass("table")?{name:!0}:Te.name=="caption"&&we&&we.is("element","table")?{name:!0}:null}class ToggleTableCaptionCommand extends Command{refresh(){const we=this.editor,t=getSelectionAffectedTable(we.model.document.selection);this.isEnabled=!!t,this.isEnabled?this.value=!!getCaptionFromTableModelElement(t):this.value=!1}execute({focusCaptionOnShow:we=!1}={}){this.editor.model.change(t=>{this.value?this._hideTableCaption(t):this._showTableCaption(t,we)})}_showTableCaption(we,t){const te=this.editor.model,be=getSelectionAffectedTable(te.document.selection),ke=this.editor.plugins.get("TableCaptionEditing")._getSavedCaption(be)||we.createElement("caption");te.insertContent(ke,be,"end"),t&&we.setSelection(ke,"in")}_hideTableCaption(we){const t=this.editor.model,te=getSelectionAffectedTable(t.document.selection),be=this.editor.plugins.get("TableCaptionEditing"),xe=getCaptionFromTableModelElement(te);be._saveCaption(te,xe),t.deleteContent(we.createSelection(xe,"on"))}}class TableCaptionEditing extends Plugin{constructor(t){super(t);Re(this,"_savedCaptionsMap");this._savedCaptionsMap=new WeakMap}static get pluginName(){return"TableCaptionEditing"}init(){const t=this.editor,te=t.model.schema,be=t.editing.view,xe=t.t;te.isRegistered("caption")?te.extend("caption",{allowIn:"table"}):te.register("caption",{allowIn:"table",allowContentOf:"$block",isLimit:!0}),t.commands.add("toggleTableCaption",new ToggleTableCaptionCommand(this.editor)),t.conversion.for("upcast").elementToElement({view:matchTableCaptionViewElement,model:"caption"}),t.conversion.for("dataDowncast").elementToElement({model:"caption",view:(ve,{writer:ke})=>isTable(ve.parent)?ke.createContainerElement("figcaption"):null}),t.conversion.for("editingDowncast").elementToElement({model:"caption",view:(ve,{writer:ke})=>{if(!isTable(ve.parent))return null;const Ie=ke.createEditableElement("figcaption");return ke.setCustomProperty("tableCaption",!0,Ie),Ie.placeholder=xe("Enter table caption"),enablePlaceholder({view:be,element:Ie,keepOnFocus:!0}),toWidgetEditable(Ie,ke)}}),injectTableCaptionPostFixer(t.model)}_getSavedCaption(t){const te=this._savedCaptionsMap.get(t);return te?Element.fromJSON(te):null}_saveCaption(t,te){this._savedCaptionsMap.set(t,te.toJSON())}}class TableCaptionUI extends Plugin{static get pluginName(){return"TableCaptionUI"}init(){const we=this.editor,t=we.editing.view,te=we.t;we.ui.componentFactory.add("toggleTableCaption",be=>{const xe=we.commands.get("toggleTableCaption"),ve=new ButtonView(be);return ve.set({icon:icons.caption,tooltip:!0,isToggleable:!0}),ve.bind("isOn","isEnabled").to(xe,"value","isEnabled"),ve.bind("label").to(xe,"value",ke=>te(ke?"Toggle caption off":"Toggle caption on")),this.listenTo(ve,"execute",()=>{if(we.execute("toggleTableCaption",{focusCaptionOnShow:!0}),xe.value){const ke=getCaptionFromModelSelection(we.model.document.selection),Ie=we.editing.mapper.toViewElement(ke);if(!Ie)return;t.scrollToTheSelection(),t.change(Ae=>{Ae.addClass("table__caption_highlighted",Ie)})}we.editing.view.focus()}),ve})}}class TableCaption extends Plugin{static get pluginName(){return"TableCaption"}static get requires(){return[TableCaptionEditing,TableCaptionUI]}}class TableWidthsCommand extends Command{refresh(){this.isEnabled=!0}execute(we={}){const{model:t,plugins:te}=this.editor;let{table:be=t.document.selection.getSelectedElement(),columnWidths:xe,tableWidth:ve}=we;xe&&(xe=Array.isArray(xe)?xe:xe.split(",")),t.change(ke=>{ve?ke.setAttribute("tableWidth",ve,be):ke.removeAttribute("tableWidth",be);const Ie=te.get("TableColumnResizeEditing").getColumnGroupElement(be);if(!xe&&!Ie)return;if(!xe)return ke.remove(Ie);const Ae=normalizeColumnWidths(xe);if(Ie)Array.from(Ie.getChildren()).forEach((Se,Oe)=>ke.setAttribute("columnWidth",Ae[Oe],Se));else{const Se=ke.createElement("tableColumnGroup");Ae.forEach(Oe=>ke.appendElement("tableColumn",{columnWidth:Oe},Se)),ke.append(Se,be)}})}}function upcastColgroupElement(Te){return we=>we.on("element:colgroup",(t,te,be)=>{const xe=te.modelCursor.findAncestor("table"),ve=getColumnGroupElement(xe);if(!ve)return;const ke=getTableColumnElements(ve),Ie=Te.getColumns(xe);let Ae=translateColSpanAttribute(ve,be.writer);Ae=Array.from({length:Ie},(Se,Oe)=>Ae[Oe]||"auto"),(Ae.length!=ke.length||Ae.includes("auto"))&&updateColumnElements(ke,ve,normalizeColumnWidths(Ae),be.writer)},{priority:"low"})}function downcastTableResizedClass(){return Te=>Te.on("insert:table",(we,t,te)=>{const be=te.writer,xe=t.item,ve=te.mapper.toViewElement(xe),ke=ve.is("element","table")?ve:Array.from(ve.getChildren()).find(Ae=>Ae.is("element","table"));getColumnGroupElement(xe)?be.addClass("ck-table-resized",ke):be.removeClass("ck-table-resized",ke)},{priority:"low"})}class TableColumnResizeEditing extends Plugin{constructor(t){super(t);Re(this,"_isResizingActive");Re(this,"_resizingData");Re(this,"_domEmitter");Re(this,"_tableUtilsPlugin");this._isResizingActive=!1,this.set("_isResizingAllowed",!0),this._resizingData=null,this._domEmitter=new(DomEmitterMixin()),this._tableUtilsPlugin=t.plugins.get("TableUtils"),this.on("change:_isResizingAllowed",(te,be,xe)=>{const ve=xe?"removeClass":"addClass";t.editing.view.change(ke=>{for(const Ie of t.editing.view.document.roots)ke[ve]("ck-column-resize_disabled",t.editing.view.document.getRoot(Ie.rootName))})})}static get requires(){return[TableEditing,TableUtils]}static get pluginName(){return"TableColumnResizeEditing"}init(){this._extendSchema(),this._registerPostFixer(),this._registerConverters(),this._registerResizingListeners(),this._registerResizerInserter();const t=this.editor,te=t.plugins.get("TableColumnResize");t.plugins.get("TableEditing").registerAdditionalSlot({filter:ve=>ve.is("element","tableColumnGroup"),positionOffset:0});const xe=new TableWidthsCommand(t);t.commands.add("resizeTableWidth",xe),t.commands.add("resizeColumnWidths",xe),this.bind("_isResizingAllowed").to(t,"isReadOnly",te,"isEnabled",xe,"isEnabled",(ve,ke,Ie)=>!ve&&ke&&Ie)}destroy(){this._domEmitter.stopListening(),super.destroy()}getColumnGroupElement(t){return getColumnGroupElement(t)}getTableColumnElements(t){return getTableColumnElements(t)}getTableColumnsWidths(t){return getTableColumnsWidths(t)}_extendSchema(){this.editor.model.schema.extend("table",{allowAttributes:["tableWidth"]}),this.editor.model.schema.register("tableColumnGroup",{allowIn:"table",isLimit:!0}),this.editor.model.schema.register("tableColumn",{allowIn:"tableColumnGroup",allowAttributes:["columnWidth","colSpan"],isLimit:!0})}_registerPostFixer(){const te=this.editor.model;te.document.registerPostFixer(ve=>{let ke=!1;for(const Ie of getChangedResizedTables(te)){const Ae=this.getColumnGroupElement(Ie),Se=this.getTableColumnElements(Ae),Oe=this.getTableColumnsWidths(Ae);let Ve=normalizeColumnWidths(Oe);Ve=be(Ve,Ie,this),!isEqual(Oe,Ve)&&(updateColumnElements(Se,Ae,Ve,ve),ke=!0)}return ke});function be(ve,ke,Ie){const Ae=Ie._tableUtilsPlugin.getColumns(ke);if(Ae-ve.length===0)return ve;const Oe=ve.map(Me=>Number(Me.replace("%",""))),Ve=xe(Ie.editor.model.document.differ,ke);for(const Me of Ve){const De=Ae-Oe.length;if(De===0)continue;const Fe=De>0,Be=Ie._tableUtilsPlugin.getCellLocation(Me).column;if(Fe){const $e=getColumnMinWidthAsPercentage(ke,Ie.editor),Ue=createFilledArray(De,$e);Oe.splice(Be,0,...Ue)}else{const $e=Oe.splice(Be,Math.abs(De));Oe[Be]+=sumArray($e)}}return Oe.map(Me=>Me+"%")}function xe(ve,ke){const Ie=new Set;for(const Ae of ve.getChanges())if(Ae.type=="insert"&&Ae.position.nodeAfter&&Ae.position.nodeAfter.name=="tableCell"&&Ae.position.nodeAfter.getAncestors().includes(ke))Ie.add(Ae.position.nodeAfter);else if(Ae.type=="remove"){const Se=Ae.position.nodeBefore||Ae.position.nodeAfter;Se.name=="tableCell"&&Se.getAncestors().includes(ke)&&Ie.add(Se)}return Ie}}_registerConverters(){const te=this.editor.conversion;te.for("upcast").attributeToAttribute({view:{name:"figure",key:"style",value:{width:/[\s\S]+/}},model:{name:"table",key:"tableWidth",value:be=>be.getStyle("width")}}),te.for("downcast").attributeToAttribute({model:{name:"table",key:"tableWidth"},view:be=>({name:"figure",key:"style",value:{width:be}})}),te.elementToElement({model:"tableColumnGroup",view:"colgroup"}),te.elementToElement({model:"tableColumn",view:"col"}),te.for("downcast").add(downcastTableResizedClass()),te.for("upcast").add(upcastColgroupElement(this._tableUtilsPlugin)),te.for("upcast").attributeToAttribute({view:{name:"col",styles:{width:/.*/}},model:{key:"columnWidth",value:be=>{const xe=be.getStyle("width");return!xe||!xe.endsWith("%")&&!xe.endsWith("pt")?"auto":xe}}}),te.for("upcast").attributeToAttribute({view:{name:"col",key:"span"},model:"colSpan"}),te.for("downcast").attributeToAttribute({model:{name:"tableColumn",key:"columnWidth"},view:be=>({key:"style",value:{width:be}})})}_registerResizingListeners(){const t=this.editor.editing.view;t.addObserver(MouseEventsObserver),t.document.on("mousedown",this._onMouseDownHandler.bind(this),{priority:"high"}),this._domEmitter.listenTo(global.window.document,"mousemove",throttle(this._onMouseMoveHandler.bind(this),50)),this._domEmitter.listenTo(global.window.document,"mouseup",this._onMouseUpHandler.bind(this))}_onMouseDownHandler(t,te){const be=te.target;if(!be.hasClass("ck-table-column-resizer")||!this._isResizingAllowed)return;const xe=this.editor,ve=xe.editing.mapper.toModelElement(be.findAncestor("figure"));if(!xe.model.canEditAt(ve))return;te.preventDefault(),t.stop();const ke=Se(ve,this._tableUtilsPlugin,xe),Ie=be.findAncestor("table"),Ae=xe.editing.view;Array.from(Ie.getChildren()).find(Me=>Me.is("element","colgroup"))||Ae.change(Me=>{Oe(Me,ke,Ie)}),this._isResizingActive=!0,this._resizingData=this._getResizingData(te,ke),Ae.change(Me=>Ve(Me,Ie,this._resizingData));function Se(Me,De,Fe){const Be=Array(De.getColumns(Me)),$e=new TableWalker(Me);for(const Ue of $e){const He=Fe.editing.mapper.toViewElement(Ue.cell),ze=Fe.editing.view.domConverter.mapViewToDom(He),qe=getDomCellOuterWidth(ze);(!Be[Ue.column]||qe<Be[Ue.column])&&(Be[Ue.column]=toPrecision(qe))}return Be}function Oe(Me,De,Fe){const Be=Me.createContainerElement("colgroup");for(let $e=0;$e<De.length;$e++){const Ue=Me.createEmptyElement("col"),He=`${toPrecision(De[$e]/sumArray(De)*100)}%`;Me.setStyle("width",He,Ue),Me.insert(Me.createPositionAt(Be,"end"),Ue)}Me.insert(Me.createPositionAt(Fe,0),Be)}function Ve(Me,De,Fe){const Be=Fe.widths.viewFigureWidth/Fe.widths.viewFigureParentWidth;Me.addClass("ck-table-resized",De),Me.addClass("ck-table-column-resizer__active",Fe.elements.viewResizer),Me.setStyle("width",`${toPrecision(Be*100)}%`,De.findAncestor("figure"))}}_onMouseMoveHandler(t,te){if(!this._isResizingActive)return;if(!this._isResizingAllowed){this._onMouseUpHandler();return}const{columnPosition:be,flags:{isRightEdge:xe,isTableCentered:ve,isLtrContent:ke},elements:{viewFigure:Ie,viewLeftColumn:Ae,viewRightColumn:Se},widths:{viewFigureParentWidth:Oe,tableWidth:Ve,leftColumnWidth:Me,rightColumnWidth:De}}=this._resizingData,Fe=-Me+COLUMN_MIN_WIDTH_IN_PIXELS,Be=xe?Oe-Ve:De-COLUMN_MIN_WIDTH_IN_PIXELS,$e=(ke?1:-1)*(xe&&ve?2:1),Ue=clamp((te.clientX-be)*$e,Math.min(Fe,0),Math.max(Be,0));Ue!==0&&this.editor.editing.view.change(He=>{const ze=toPrecision((Me+Ue)*100/Ve);if(He.setStyle("width",`${ze}%`,Ae),xe){const qe=toPrecision((Ve+Ue)*100/Oe);He.setStyle("width",`${qe}%`,Ie)}else{const qe=toPrecision((De-Ue)*100/Ve);He.setStyle("width",`${qe}%`,Se)}})}_onMouseUpHandler(){if(!this._isResizingActive)return;const{viewResizer:t,modelTable:te,viewFigure:be,viewColgroup:xe}=this._resizingData.elements,ve=this.editor,ke=ve.editing.view,Ie=this.getColumnGroupElement(te),Ae=Array.from(xe.getChildren()).filter(Be=>Be.is("view:element")),Se=Ie?this.getTableColumnsWidths(Ie):null,Oe=Ae.map(Be=>Be.getStyle("width")),Ve=!isEqual(Se,Oe),Me=te.getAttribute("tableWidth"),De=be.getStyle("width"),Fe=Me!==De;(Ve||Fe)&&(this._isResizingAllowed?ve.execute("resizeTableWidth",{table:te,tableWidth:`${toPrecision(De)}%`,columnWidths:Oe}):ke.change(Be=>{if(Se)for(const $e of Ae)Be.setStyle("width",Se.shift(),$e);else Be.remove(xe);Fe&&(Me?Be.setStyle("width",Me,be):Be.removeStyle("width",be)),!Se&&!Me&&Be.removeClass("ck-table-resized",[...be.getChildren()].find($e=>$e.name==="table"))})),ke.change(Be=>{Be.removeClass("ck-table-column-resizer__active",t)}),this._isResizingActive=!1,this._resizingData=null}_getResizingData(t,te){const be=this.editor,xe=t.domEvent.clientX,ve=t.target,ke=ve.findAncestor("td")||ve.findAncestor("th"),Ie=be.editing.mapper.toModelElement(ke),Ae=Ie.findAncestor("table"),Se=getColumnEdgesIndexes(Ie,this._tableUtilsPlugin).rightEdge,Oe=this._tableUtilsPlugin.getColumns(Ae)-1,Ve=Se===Oe,Me=!Ae.hasAttribute("tableAlignment"),De=be.locale.contentLanguageDirection!=="rtl",Fe=ke.findAncestor("table"),Be=Fe.findAncestor("figure"),$e=[...Fe.getChildren()].find(Ye=>Ye.is("element","colgroup")),Ue=$e.getChild(Se),He=Ve?void 0:$e.getChild(Se+1),ze=getElementWidthInPixels(be.editing.view.domConverter.mapViewToDom(Be.parent)),qe=getElementWidthInPixels(be.editing.view.domConverter.mapViewToDom(Be)),Ke=getTableWidthInPixels(Ae,be),Qe=te[Se],je=Ve?void 0:te[Se+1];return{columnPosition:xe,flags:{isRightEdge:Ve,isTableCentered:Me,isLtrContent:De},elements:{viewResizer:ve,modelTable:Ae,viewFigure:Be,viewColgroup:$e,viewLeftColumn:Ue,viewRightColumn:He},widths:{viewFigureParentWidth:ze,viewFigureWidth:qe,tableWidth:Ke,leftColumnWidth:Qe,rightColumnWidth:je}}}_registerResizerInserter(){this.editor.conversion.for("editingDowncast").add(t=>{t.on("insert:tableCell",(te,be,xe)=>{const ve=be.item,ke=xe.mapper.toViewElement(ve),Ie=xe.writer;Ie.insert(Ie.createPositionAt(ke,"end"),Ie.createUIElement("div",{class:"ck-table-column-resizer"}))},{priority:"lowest"})})}}class TableColumnResize extends Plugin{static get requires(){return[TableColumnResizeEditing,TableCellWidthEditing]}static get pluginName(){return"TableColumnResize"}}var format={exports:{}},interopRequireDefault={exports:{}};(function(Te){function we(t){return t&&t.__esModule?t:{default:t}}Te.exports=we,Te.exports.__esModule=!0,Te.exports.default=Te.exports})(interopRequireDefault);var interopRequireDefaultExports=interopRequireDefault.exports,isValid={exports:{}},isDate$1={exports:{}},_typeof={exports:{}};(function(Te){function we(t){"@babel/helpers - typeof";return Te.exports=we=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(te){return typeof te}:function(te){return te&&typeof Symbol=="function"&&te.constructor===Symbol&&te!==Symbol.prototype?"symbol":typeof te},Te.exports.__esModule=!0,Te.exports.default=Te.exports,we(t)}Te.exports=we,Te.exports.__esModule=!0,Te.exports.default=Te.exports})(_typeof);var _typeofExports=_typeof.exports,requiredArgs={exports:{}};(function(Te,we){Object.defineProperty(we,"__esModule",{value:!0}),we.default=t;function t(te,be){if(be.length<te)throw new TypeError(te+" argument"+(te>1?"s":"")+" required, but only "+be.length+" present")}Te.exports=we.default})(requiredArgs,requiredArgs.exports);var requiredArgsExports=requiredArgs.exports;(function(Te,we){var t=interopRequireDefaultExports.default;Object.defineProperty(we,"__esModule",{value:!0}),we.default=xe;var te=t(_typeofExports),be=t(requiredArgsExports);function xe(ve){return(0,be.default)(1,arguments),ve instanceof Date||(0,te.default)(ve)==="object"&&Object.prototype.toString.call(ve)==="[object Date]"}Te.exports=we.default})(isDate$1,isDate$1.exports);var isDateExports=isDate$1.exports,toDate={exports:{}};(function(Te,we){var t=interopRequireDefaultExports.default;Object.defineProperty(we,"__esModule",{value:!0}),we.default=xe;var te=t(_typeofExports),be=t(requiredArgsExports);function xe(ve){(0,be.default)(1,arguments);var ke=Object.prototype.toString.call(ve);return ve instanceof Date||(0,te.default)(ve)==="object"&&ke==="[object Date]"?new Date(ve.getTime()):typeof ve=="number"||ke==="[object Number]"?new Date(ve):((typeof ve=="string"||ke==="[object String]")&&typeof console<"u"&&(console.warn("Starting with v2.0.0-beta.1 date-fns doesn't accept strings as date arguments. Please use `parseISO` to parse strings. See: https://github.com/date-fns/date-fns/blob/master/docs/upgradeGuide.md#string-arguments"),console.warn(new Error().stack)),new Date(NaN))}Te.exports=we.default})(toDate,toDate.exports);var toDateExports=toDate.exports;(function(Te,we){var t=interopRequireDefaultExports.default;Object.defineProperty(we,"__esModule",{value:!0}),we.default=ve;var te=t(isDateExports),be=t(toDateExports),xe=t(requiredArgsExports);function ve(ke){if((0,xe.default)(1,arguments),!(0,te.default)(ke)&&typeof ke!="number")return!1;var Ie=(0,be.default)(ke);return!isNaN(Number(Ie))}Te.exports=we.default})(isValid,isValid.exports);var isValidExports=isValid.exports,subMilliseconds={exports:{}},addMilliseconds={exports:{}},toInteger={exports:{}};(function(Te,we){Object.defineProperty(we,"__esModule",{value:!0}),we.default=t;function t(te){if(te===null||te===!0||te===!1)return NaN;var be=Number(te);return isNaN(be)?be:be<0?Math.ceil(be):Math.floor(be)}Te.exports=we.default})(toInteger,toInteger.exports);var toIntegerExports=toInteger.exports;(function(Te,we){var t=interopRequireDefaultExports.default;Object.defineProperty(we,"__esModule",{value:!0}),we.default=ve;var te=t(toIntegerExports),be=t(toDateExports),xe=t(requiredArgsExports);function ve(ke,Ie){(0,xe.default)(2,arguments);var Ae=(0,be.default)(ke).getTime(),Se=(0,te.default)(Ie);return new Date(Ae+Se)}Te.exports=we.default})(addMilliseconds,addMilliseconds.exports);var addMillisecondsExports=addMilliseconds.exports;(function(Te,we){var t=interopRequireDefaultExports.default;Object.defineProperty(we,"__esModule",{value:!0}),we.default=ve;var te=t(addMillisecondsExports),be=t(requiredArgsExports),xe=t(toIntegerExports);function ve(ke,Ie){(0,be.default)(2,arguments);var Ae=(0,xe.default)(Ie);return(0,te.default)(ke,-Ae)}Te.exports=we.default})(subMilliseconds,subMilliseconds.exports);var subMillisecondsExports=subMilliseconds.exports,formatters={exports:{}},getUTCDayOfYear={exports:{}};(function(Te,we){var t=interopRequireDefaultExports.default;Object.defineProperty(we,"__esModule",{value:!0}),we.default=ve;var te=t(toDateExports),be=t(requiredArgsExports),xe=864e5;function ve(ke){(0,be.default)(1,arguments);var Ie=(0,te.default)(ke),Ae=Ie.getTime();Ie.setUTCMonth(0,1),Ie.setUTCHours(0,0,0,0);var Se=Ie.getTime(),Oe=Ae-Se;return Math.floor(Oe/xe)+1}Te.exports=we.default})(getUTCDayOfYear,getUTCDayOfYear.exports);var getUTCDayOfYearExports=getUTCDayOfYear.exports,getUTCISOWeek={exports:{}},startOfUTCISOWeek={exports:{}};(function(Te,we){var t=interopRequireDefaultExports.default;Object.defineProperty(we,"__esModule",{value:!0}),we.default=xe;var te=t(toDateExports),be=t(requiredArgsExports);function xe(ve){(0,be.default)(1,arguments);var ke=1,Ie=(0,te.default)(ve),Ae=Ie.getUTCDay(),Se=(Ae<ke?7:0)+Ae-ke;return Ie.setUTCDate(Ie.getUTCDate()-Se),Ie.setUTCHours(0,0,0,0),Ie}Te.exports=we.default})(startOfUTCISOWeek,startOfUTCISOWeek.exports);var startOfUTCISOWeekExports=startOfUTCISOWeek.exports,startOfUTCISOWeekYear={exports:{}},getUTCISOWeekYear={exports:{}};(function(Te,we){var t=interopRequireDefaultExports.default;Object.defineProperty(we,"__esModule",{value:!0}),we.default=ve;var te=t(toDateExports),be=t(requiredArgsExports),xe=t(startOfUTCISOWeekExports);function ve(ke){(0,be.default)(1,arguments);var Ie=(0,te.default)(ke),Ae=Ie.getUTCFullYear(),Se=new Date(0);Se.setUTCFullYear(Ae+1,0,4),Se.setUTCHours(0,0,0,0);var Oe=(0,xe.default)(Se),Ve=new Date(0);Ve.setUTCFullYear(Ae,0,4),Ve.setUTCHours(0,0,0,0);var Me=(0,xe.default)(Ve);return Ie.getTime()>=Oe.getTime()?Ae+1:Ie.getTime()>=Me.getTime()?Ae:Ae-1}Te.exports=we.default})(getUTCISOWeekYear,getUTCISOWeekYear.exports);var getUTCISOWeekYearExports=getUTCISOWeekYear.exports;(function(Te,we){var t=interopRequireDefaultExports.default;Object.defineProperty(we,"__esModule",{value:!0}),we.default=ve;var te=t(getUTCISOWeekYearExports),be=t(startOfUTCISOWeekExports),xe=t(requiredArgsExports);function ve(ke){(0,xe.default)(1,arguments);var Ie=(0,te.default)(ke),Ae=new Date(0);Ae.setUTCFullYear(Ie,0,4),Ae.setUTCHours(0,0,0,0);var Se=(0,be.default)(Ae);return Se}Te.exports=we.default})(startOfUTCISOWeekYear,startOfUTCISOWeekYear.exports);var startOfUTCISOWeekYearExports=startOfUTCISOWeekYear.exports;(function(Te,we){var t=interopRequireDefaultExports.default;Object.defineProperty(we,"__esModule",{value:!0}),we.default=Ie;var te=t(toDateExports),be=t(startOfUTCISOWeekExports),xe=t(startOfUTCISOWeekYearExports),ve=t(requiredArgsExports),ke=6048e5;function Ie(Ae){(0,ve.default)(1,arguments);var Se=(0,te.default)(Ae),Oe=(0,be.default)(Se).getTime()-(0,xe.default)(Se).getTime();return Math.round(Oe/ke)+1}Te.exports=we.default})(getUTCISOWeek,getUTCISOWeek.exports);var getUTCISOWeekExports=getUTCISOWeek.exports,getUTCWeek={exports:{}},startOfUTCWeek={exports:{}},defaultOptions$1={};Object.defineProperty(defaultOptions$1,"__esModule",{value:!0});defaultOptions$1.getDefaultOptions=getDefaultOptions;defaultOptions$1.setDefaultOptions=setDefaultOptions;var defaultOptions={};function getDefaultOptions(){return defaultOptions}function setDefaultOptions(Te){defaultOptions=Te}(function(Te,we){var t=interopRequireDefaultExports.default;Object.defineProperty(we,"__esModule",{value:!0}),we.default=ke;var te=t(toDateExports),be=t(requiredArgsExports),xe=t(toIntegerExports),ve=defaultOptions$1;function ke(Ie,Ae){var Se,Oe,Ve,Me,De,Fe,Be,$e;(0,be.default)(1,arguments);var Ue=(0,ve.getDefaultOptions)(),He=(0,xe.default)((Se=(Oe=(Ve=(Me=Ae==null?void 0:Ae.weekStartsOn)!==null&&Me!==void 0?Me:Ae==null||(De=Ae.locale)===null||De===void 0||(Fe=De.options)===null||Fe===void 0?void 0:Fe.weekStartsOn)!==null&&Ve!==void 0?Ve:Ue.weekStartsOn)!==null&&Oe!==void 0?Oe:(Be=Ue.locale)===null||Be===void 0||($e=Be.options)===null||$e===void 0?void 0:$e.weekStartsOn)!==null&&Se!==void 0?Se:0);if(!(He>=0&&He<=6))throw new RangeError("weekStartsOn must be between 0 and 6 inclusively");var ze=(0,te.default)(Ie),qe=ze.getUTCDay(),Ke=(qe<He?7:0)+qe-He;return ze.setUTCDate(ze.getUTCDate()-Ke),ze.setUTCHours(0,0,0,0),ze}Te.exports=we.default})(startOfUTCWeek,startOfUTCWeek.exports);var startOfUTCWeekExports=startOfUTCWeek.exports,startOfUTCWeekYear={exports:{}},getUTCWeekYear={exports:{}};(function(Te,we){var t=interopRequireDefaultExports.default;Object.defineProperty(we,"__esModule",{value:!0}),we.default=Ie;var te=t(toDateExports),be=t(requiredArgsExports),xe=t(startOfUTCWeekExports),ve=t(toIntegerExports),ke=defaultOptions$1;function Ie(Ae,Se){var Oe,Ve,Me,De,Fe,Be,$e,Ue;(0,be.default)(1,arguments);var He=(0,te.default)(Ae),ze=He.getUTCFullYear(),qe=(0,ke.getDefaultOptions)(),Ke=(0,ve.default)((Oe=(Ve=(Me=(De=Se==null?void 0:Se.firstWeekContainsDate)!==null&&De!==void 0?De:Se==null||(Fe=Se.locale)===null||Fe===void 0||(Be=Fe.options)===null||Be===void 0?void 0:Be.firstWeekContainsDate)!==null&&Me!==void 0?Me:qe.firstWeekContainsDate)!==null&&Ve!==void 0?Ve:($e=qe.locale)===null||$e===void 0||(Ue=$e.options)===null||Ue===void 0?void 0:Ue.firstWeekContainsDate)!==null&&Oe!==void 0?Oe:1);if(!(Ke>=1&&Ke<=7))throw new RangeError("firstWeekContainsDate must be between 1 and 7 inclusively");var Qe=new Date(0);Qe.setUTCFullYear(ze+1,0,Ke),Qe.setUTCHours(0,0,0,0);var je=(0,xe.default)(Qe,Se),Ye=new Date(0);Ye.setUTCFullYear(ze,0,Ke),Ye.setUTCHours(0,0,0,0);var ht=(0,xe.default)(Ye,Se);return He.getTime()>=je.getTime()?ze+1:He.getTime()>=ht.getTime()?ze:ze-1}Te.exports=we.default})(getUTCWeekYear,getUTCWeekYear.exports);var getUTCWeekYearExports=getUTCWeekYear.exports;(function(Te,we){var t=interopRequireDefaultExports.default;Object.defineProperty(we,"__esModule",{value:!0}),we.default=Ie;var te=t(getUTCWeekYearExports),be=t(requiredArgsExports),xe=t(startOfUTCWeekExports),ve=t(toIntegerExports),ke=defaultOptions$1;function Ie(Ae,Se){var Oe,Ve,Me,De,Fe,Be,$e,Ue;(0,be.default)(1,arguments);var He=(0,ke.getDefaultOptions)(),ze=(0,ve.default)((Oe=(Ve=(Me=(De=Se==null?void 0:Se.firstWeekContainsDate)!==null&&De!==void 0?De:Se==null||(Fe=Se.locale)===null||Fe===void 0||(Be=Fe.options)===null||Be===void 0?void 0:Be.firstWeekContainsDate)!==null&&Me!==void 0?Me:He.firstWeekContainsDate)!==null&&Ve!==void 0?Ve:($e=He.locale)===null||$e===void 0||(Ue=$e.options)===null||Ue===void 0?void 0:Ue.firstWeekContainsDate)!==null&&Oe!==void 0?Oe:1),qe=(0,te.default)(Ae,Se),Ke=new Date(0);Ke.setUTCFullYear(qe,0,ze),Ke.setUTCHours(0,0,0,0);var Qe=(0,xe.default)(Ke,Se);return Qe}Te.exports=we.default})(startOfUTCWeekYear,startOfUTCWeekYear.exports);var startOfUTCWeekYearExports=startOfUTCWeekYear.exports;(function(Te,we){var t=interopRequireDefaultExports.default;Object.defineProperty(we,"__esModule",{value:!0}),we.default=Ie;var te=t(toDateExports),be=t(startOfUTCWeekExports),xe=t(startOfUTCWeekYearExports),ve=t(requiredArgsExports),ke=6048e5;function Ie(Ae,Se){(0,ve.default)(1,arguments);var Oe=(0,te.default)(Ae),Ve=(0,be.default)(Oe,Se).getTime()-(0,xe.default)(Oe,Se).getTime();return Math.round(Ve/ke)+1}Te.exports=we.default})(getUTCWeek,getUTCWeek.exports);var getUTCWeekExports=getUTCWeek.exports,addLeadingZeros={exports:{}};(function(Te,we){Object.defineProperty(we,"__esModule",{value:!0}),we.default=t;function t(te,be){for(var xe=te<0?"-":"",ve=Math.abs(te).toString();ve.length<be;)ve="0"+ve;return xe+ve}Te.exports=we.default})(addLeadingZeros,addLeadingZeros.exports);var addLeadingZerosExports=addLeadingZeros.exports,lightFormatters={exports:{}};(function(Te,we){var t=interopRequireDefaultExports.default;Object.defineProperty(we,"__esModule",{value:!0}),we.default=void 0;var te=t(addLeadingZerosExports),be={y:function(ke,Ie){var Ae=ke.getUTCFullYear(),Se=Ae>0?Ae:1-Ae;return(0,te.default)(Ie==="yy"?Se%100:Se,Ie.length)},M:function(ke,Ie){var Ae=ke.getUTCMonth();return Ie==="M"?String(Ae+1):(0,te.default)(Ae+1,2)},d:function(ke,Ie){return(0,te.default)(ke.getUTCDate(),Ie.length)},a:function(ke,Ie){var Ae=ke.getUTCHours()/12>=1?"pm":"am";switch(Ie){case"a":case"aa":return Ae.toUpperCase();case"aaa":return Ae;case"aaaaa":return Ae[0];case"aaaa":default:return Ae==="am"?"a.m.":"p.m."}},h:function(ke,Ie){return(0,te.default)(ke.getUTCHours()%12||12,Ie.length)},H:function(ke,Ie){return(0,te.default)(ke.getUTCHours(),Ie.length)},m:function(ke,Ie){return(0,te.default)(ke.getUTCMinutes(),Ie.length)},s:function(ke,Ie){return(0,te.default)(ke.getUTCSeconds(),Ie.length)},S:function(ke,Ie){var Ae=Ie.length,Se=ke.getUTCMilliseconds(),Oe=Math.floor(Se*Math.pow(10,Ae-3));return(0,te.default)(Oe,Ie.length)}},xe=be;we.default=xe,Te.exports=we.default})(lightFormatters,lightFormatters.exports);var lightFormattersExports=lightFormatters.exports;(function(Te,we){var t=interopRequireDefaultExports.default;Object.defineProperty(we,"__esModule",{value:!0}),we.default=void 0;var te=t(getUTCDayOfYearExports),be=t(getUTCISOWeekExports),xe=t(getUTCISOWeekYearExports),ve=t(getUTCWeekExports),ke=t(getUTCWeekYearExports),Ie=t(addLeadingZerosExports),Ae=t(lightFormattersExports),Se={am:"am",pm:"pm",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},Oe={G:function($e,Ue,He){var ze=$e.getUTCFullYear()>0?1:0;switch(Ue){case"G":case"GG":case"GGG":return He.era(ze,{width:"abbreviated"});case"GGGGG":return He.era(ze,{width:"narrow"});case"GGGG":default:return He.era(ze,{width:"wide"})}},y:function($e,Ue,He){if(Ue==="yo"){var ze=$e.getUTCFullYear(),qe=ze>0?ze:1-ze;return He.ordinalNumber(qe,{unit:"year"})}return Ae.default.y($e,Ue)},Y:function($e,Ue,He,ze){var qe=(0,ke.default)($e,ze),Ke=qe>0?qe:1-qe;if(Ue==="YY"){var Qe=Ke%100;return(0,Ie.default)(Qe,2)}return Ue==="Yo"?He.ordinalNumber(Ke,{unit:"year"}):(0,Ie.default)(Ke,Ue.length)},R:function($e,Ue){var He=(0,xe.default)($e);return(0,Ie.default)(He,Ue.length)},u:function($e,Ue){var He=$e.getUTCFullYear();return(0,Ie.default)(He,Ue.length)},Q:function($e,Ue,He){var ze=Math.ceil(($e.getUTCMonth()+1)/3);switch(Ue){case"Q":return String(ze);case"QQ":return(0,Ie.default)(ze,2);case"Qo":return He.ordinalNumber(ze,{unit:"quarter"});case"QQQ":return He.quarter(ze,{width:"abbreviated",context:"formatting"});case"QQQQQ":return He.quarter(ze,{width:"narrow",context:"formatting"});case"QQQQ":default:return He.quarter(ze,{width:"wide",context:"formatting"})}},q:function($e,Ue,He){var ze=Math.ceil(($e.getUTCMonth()+1)/3);switch(Ue){case"q":return String(ze);case"qq":return(0,Ie.default)(ze,2);case"qo":return He.ordinalNumber(ze,{unit:"quarter"});case"qqq":return He.quarter(ze,{width:"abbreviated",context:"standalone"});case"qqqqq":return He.quarter(ze,{width:"narrow",context:"standalone"});case"qqqq":default:return He.quarter(ze,{width:"wide",context:"standalone"})}},M:function($e,Ue,He){var ze=$e.getUTCMonth();switch(Ue){case"M":case"MM":return Ae.default.M($e,Ue);case"Mo":return He.ordinalNumber(ze+1,{unit:"month"});case"MMM":return He.month(ze,{width:"abbreviated",context:"formatting"});case"MMMMM":return He.month(ze,{width:"narrow",context:"formatting"});case"MMMM":default:return He.month(ze,{width:"wide",context:"formatting"})}},L:function($e,Ue,He){var ze=$e.getUTCMonth();switch(Ue){case"L":return String(ze+1);case"LL":return(0,Ie.default)(ze+1,2);case"Lo":return He.ordinalNumber(ze+1,{unit:"month"});case"LLL":return He.month(ze,{width:"abbreviated",context:"standalone"});case"LLLLL":return He.month(ze,{width:"narrow",context:"standalone"});case"LLLL":default:return He.month(ze,{width:"wide",context:"standalone"})}},w:function($e,Ue,He,ze){var qe=(0,ve.default)($e,ze);return Ue==="wo"?He.ordinalNumber(qe,{unit:"week"}):(0,Ie.default)(qe,Ue.length)},I:function($e,Ue,He){var ze=(0,be.default)($e);return Ue==="Io"?He.ordinalNumber(ze,{unit:"week"}):(0,Ie.default)(ze,Ue.length)},d:function($e,Ue,He){return Ue==="do"?He.ordinalNumber($e.getUTCDate(),{unit:"date"}):Ae.default.d($e,Ue)},D:function($e,Ue,He){var ze=(0,te.default)($e);return Ue==="Do"?He.ordinalNumber(ze,{unit:"dayOfYear"}):(0,Ie.default)(ze,Ue.length)},E:function($e,Ue,He){var ze=$e.getUTCDay();switch(Ue){case"E":case"EE":case"EEE":return He.day(ze,{width:"abbreviated",context:"formatting"});case"EEEEE":return He.day(ze,{width:"narrow",context:"formatting"});case"EEEEEE":return He.day(ze,{width:"short",context:"formatting"});case"EEEE":default:return He.day(ze,{width:"wide",context:"formatting"})}},e:function($e,Ue,He,ze){var qe=$e.getUTCDay(),Ke=(qe-ze.weekStartsOn+8)%7||7;switch(Ue){case"e":return String(Ke);case"ee":return(0,Ie.default)(Ke,2);case"eo":return He.ordinalNumber(Ke,{unit:"day"});case"eee":return He.day(qe,{width:"abbreviated",context:"formatting"});case"eeeee":return He.day(qe,{width:"narrow",context:"formatting"});case"eeeeee":return He.day(qe,{width:"short",context:"formatting"});case"eeee":default:return He.day(qe,{width:"wide",context:"formatting"})}},c:function($e,Ue,He,ze){var qe=$e.getUTCDay(),Ke=(qe-ze.weekStartsOn+8)%7||7;switch(Ue){case"c":return String(Ke);case"cc":return(0,Ie.default)(Ke,Ue.length);case"co":return He.ordinalNumber(Ke,{unit:"day"});case"ccc":return He.day(qe,{width:"abbreviated",context:"standalone"});case"ccccc":return He.day(qe,{width:"narrow",context:"standalone"});case"cccccc":return He.day(qe,{width:"short",context:"standalone"});case"cccc":default:return He.day(qe,{width:"wide",context:"standalone"})}},i:function($e,Ue,He){var ze=$e.getUTCDay(),qe=ze===0?7:ze;switch(Ue){case"i":return String(qe);case"ii":return(0,Ie.default)(qe,Ue.length);case"io":return He.ordinalNumber(qe,{unit:"day"});case"iii":return He.day(ze,{width:"abbreviated",context:"formatting"});case"iiiii":return He.day(ze,{width:"narrow",context:"formatting"});case"iiiiii":return He.day(ze,{width:"short",context:"formatting"});case"iiii":default:return He.day(ze,{width:"wide",context:"formatting"})}},a:function($e,Ue,He){var ze=$e.getUTCHours(),qe=ze/12>=1?"pm":"am";switch(Ue){case"a":case"aa":return He.dayPeriod(qe,{width:"abbreviated",context:"formatting"});case"aaa":return He.dayPeriod(qe,{width:"abbreviated",context:"formatting"}).toLowerCase();case"aaaaa":return He.dayPeriod(qe,{width:"narrow",context:"formatting"});case"aaaa":default:return He.dayPeriod(qe,{width:"wide",context:"formatting"})}},b:function($e,Ue,He){var ze=$e.getUTCHours(),qe;switch(ze===12?qe=Se.noon:ze===0?qe=Se.midnight:qe=ze/12>=1?"pm":"am",Ue){case"b":case"bb":return He.dayPeriod(qe,{width:"abbreviated",context:"formatting"});case"bbb":return He.dayPeriod(qe,{width:"abbreviated",context:"formatting"}).toLowerCase();case"bbbbb":return He.dayPeriod(qe,{width:"narrow",context:"formatting"});case"bbbb":default:return He.dayPeriod(qe,{width:"wide",context:"formatting"})}},B:function($e,Ue,He){var ze=$e.getUTCHours(),qe;switch(ze>=17?qe=Se.evening:ze>=12?qe=Se.afternoon:ze>=4?qe=Se.morning:qe=Se.night,Ue){case"B":case"BB":case"BBB":return He.dayPeriod(qe,{width:"abbreviated",context:"formatting"});case"BBBBB":return He.dayPeriod(qe,{width:"narrow",context:"formatting"});case"BBBB":default:return He.dayPeriod(qe,{width:"wide",context:"formatting"})}},h:function($e,Ue,He){if(Ue==="ho"){var ze=$e.getUTCHours()%12;return ze===0&&(ze=12),He.ordinalNumber(ze,{unit:"hour"})}return Ae.default.h($e,Ue)},H:function($e,Ue,He){return Ue==="Ho"?He.ordinalNumber($e.getUTCHours(),{unit:"hour"}):Ae.default.H($e,Ue)},K:function($e,Ue,He){var ze=$e.getUTCHours()%12;return Ue==="Ko"?He.ordinalNumber(ze,{unit:"hour"}):(0,Ie.default)(ze,Ue.length)},k:function($e,Ue,He){var ze=$e.getUTCHours();return ze===0&&(ze=24),Ue==="ko"?He.ordinalNumber(ze,{unit:"hour"}):(0,Ie.default)(ze,Ue.length)},m:function($e,Ue,He){return Ue==="mo"?He.ordinalNumber($e.getUTCMinutes(),{unit:"minute"}):Ae.default.m($e,Ue)},s:function($e,Ue,He){return Ue==="so"?He.ordinalNumber($e.getUTCSeconds(),{unit:"second"}):Ae.default.s($e,Ue)},S:function($e,Ue){return Ae.default.S($e,Ue)},X:function($e,Ue,He,ze){var qe=ze._originalDate||$e,Ke=qe.getTimezoneOffset();if(Ke===0)return"Z";switch(Ue){case"X":return Me(Ke);case"XXXX":case"XX":return De(Ke);case"XXXXX":case"XXX":default:return De(Ke,":")}},x:function($e,Ue,He,ze){var qe=ze._originalDate||$e,Ke=qe.getTimezoneOffset();switch(Ue){case"x":return Me(Ke);case"xxxx":case"xx":return De(Ke);case"xxxxx":case"xxx":default:return De(Ke,":")}},O:function($e,Ue,He,ze){var qe=ze._originalDate||$e,Ke=qe.getTimezoneOffset();switch(Ue){case"O":case"OO":case"OOO":return"GMT"+Ve(Ke,":");case"OOOO":default:return"GMT"+De(Ke,":")}},z:function($e,Ue,He,ze){var qe=ze._originalDate||$e,Ke=qe.getTimezoneOffset();switch(Ue){case"z":case"zz":case"zzz":return"GMT"+Ve(Ke,":");case"zzzz":default:return"GMT"+De(Ke,":")}},t:function($e,Ue,He,ze){var qe=ze._originalDate||$e,Ke=Math.floor(qe.getTime()/1e3);return(0,Ie.default)(Ke,Ue.length)},T:function($e,Ue,He,ze){var qe=ze._originalDate||$e,Ke=qe.getTime();return(0,Ie.default)(Ke,Ue.length)}};function Ve(Be,$e){var Ue=Be>0?"-":"+",He=Math.abs(Be),ze=Math.floor(He/60),qe=He%60;if(qe===0)return Ue+String(ze);var Ke=$e;return Ue+String(ze)+Ke+(0,Ie.default)(qe,2)}function Me(Be,$e){if(Be%60===0){var Ue=Be>0?"-":"+";return Ue+(0,Ie.default)(Math.abs(Be)/60,2)}return De(Be,$e)}function De(Be,$e){var Ue=$e||"",He=Be>0?"-":"+",ze=Math.abs(Be),qe=(0,Ie.default)(Math.floor(ze/60),2),Ke=(0,Ie.default)(ze%60,2);return He+qe+Ue+Ke}var Fe=Oe;we.default=Fe,Te.exports=we.default})(formatters,formatters.exports);var formattersExports=formatters.exports,longFormatters={exports:{}};(function(Te,we){Object.defineProperty(we,"__esModule",{value:!0}),we.default=void 0;var t=function(Ie,Ae){switch(Ie){case"P":return Ae.date({width:"short"});case"PP":return Ae.date({width:"medium"});case"PPP":return Ae.date({width:"long"});case"PPPP":default:return Ae.date({width:"full"})}},te=function(Ie,Ae){switch(Ie){case"p":return Ae.time({width:"short"});case"pp":return Ae.time({width:"medium"});case"ppp":return Ae.time({width:"long"});case"pppp":default:return Ae.time({width:"full"})}},be=function(Ie,Ae){var Se=Ie.match(/(P+)(p+)?/)||[],Oe=Se[1],Ve=Se[2];if(!Ve)return t(Ie,Ae);var Me;switch(Oe){case"P":Me=Ae.dateTime({width:"short"});break;case"PP":Me=Ae.dateTime({width:"medium"});break;case"PPP":Me=Ae.dateTime({width:"long"});break;case"PPPP":default:Me=Ae.dateTime({width:"full"});break}return Me.replace("{{date}}",t(Oe,Ae)).replace("{{time}}",te(Ve,Ae))},xe={p:te,P:be},ve=xe;we.default=ve,Te.exports=we.default})(longFormatters,longFormatters.exports);var longFormattersExports=longFormatters.exports,getTimezoneOffsetInMilliseconds={exports:{}};(function(Te,we){Object.defineProperty(we,"__esModule",{value:!0}),we.default=t;function t(te){var be=new Date(Date.UTC(te.getFullYear(),te.getMonth(),te.getDate(),te.getHours(),te.getMinutes(),te.getSeconds(),te.getMilliseconds()));return be.setUTCFullYear(te.getFullYear()),te.getTime()-be.getTime()}Te.exports=we.default})(getTimezoneOffsetInMilliseconds,getTimezoneOffsetInMilliseconds.exports);var getTimezoneOffsetInMillisecondsExports=getTimezoneOffsetInMilliseconds.exports,protectedTokens={};Object.defineProperty(protectedTokens,"__esModule",{value:!0});protectedTokens.isProtectedDayOfYearToken=isProtectedDayOfYearToken;protectedTokens.isProtectedWeekYearToken=isProtectedWeekYearToken;protectedTokens.throwProtectedError=throwProtectedError;var protectedDayOfYearTokens=["D","DD"],protectedWeekYearTokens=["YY","YYYY"];function isProtectedDayOfYearToken(Te){return protectedDayOfYearTokens.indexOf(Te)!==-1}function isProtectedWeekYearToken(Te){return protectedWeekYearTokens.indexOf(Te)!==-1}function throwProtectedError(Te,we,t){if(Te==="YYYY")throw new RangeError("Use `yyyy` instead of `YYYY` (in `".concat(we,"`) for formatting years to the input `").concat(t,"`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md"));if(Te==="YY")throw new RangeError("Use `yy` instead of `YY` (in `".concat(we,"`) for formatting years to the input `").concat(t,"`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md"));if(Te==="D")throw new RangeError("Use `d` instead of `D` (in `".concat(we,"`) for formatting days of the month to the input `").concat(t,"`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md"));if(Te==="DD")throw new RangeError("Use `dd` instead of `DD` (in `".concat(we,"`) for formatting days of the month to the input `").concat(t,"`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md"))}var defaultLocale$1={exports:{}},enUS={exports:{}},formatDistance={exports:{}};(function(Te,we){Object.defineProperty(we,"__esModule",{value:!0}),we.default=void 0;var t={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}},te=function(ve,ke,Ie){var Ae,Se=t[ve];return typeof Se=="string"?Ae=Se:ke===1?Ae=Se.one:Ae=Se.other.replace("{{count}}",ke.toString()),Ie!=null&&Ie.addSuffix?Ie.comparison&&Ie.comparison>0?"in "+Ae:Ae+" ago":Ae},be=te;we.default=be,Te.exports=we.default})(formatDistance,formatDistance.exports);var formatDistanceExports=formatDistance.exports,formatLong={exports:{}},buildFormatLongFn={exports:{}};(function(Te,we){Object.defineProperty(we,"__esModule",{value:!0}),we.default=t;function t(te){return function(){var be=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},xe=be.width?String(be.width):te.defaultWidth,ve=te.formats[xe]||te.formats[te.defaultWidth];return ve}}Te.exports=we.default})(buildFormatLongFn,buildFormatLongFn.exports);var buildFormatLongFnExports=buildFormatLongFn.exports;(function(Te,we){var t=interopRequireDefaultExports.default;Object.defineProperty(we,"__esModule",{value:!0}),we.default=void 0;var te=t(buildFormatLongFnExports),be={full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},xe={full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},ve={full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},ke={date:(0,te.default)({formats:be,defaultWidth:"full"}),time:(0,te.default)({formats:xe,defaultWidth:"full"}),dateTime:(0,te.default)({formats:ve,defaultWidth:"full"})},Ie=ke;we.default=Ie,Te.exports=we.default})(formatLong,formatLong.exports);var formatLongExports=formatLong.exports,formatRelative={exports:{}};(function(Te,we){Object.defineProperty(we,"__esModule",{value:!0}),we.default=void 0;var t={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"},te=function(ve,ke,Ie,Ae){return t[ve]},be=te;we.default=be,Te.exports=we.default})(formatRelative,formatRelative.exports);var formatRelativeExports=formatRelative.exports,localize={exports:{}},buildLocalizeFn={exports:{}};(function(Te,we){Object.defineProperty(we,"__esModule",{value:!0}),we.default=t;function t(te){return function(be,xe){var ve=xe!=null&&xe.context?String(xe.context):"standalone",ke;if(ve==="formatting"&&te.formattingValues){var Ie=te.defaultFormattingWidth||te.defaultWidth,Ae=xe!=null&&xe.width?String(xe.width):Ie;ke=te.formattingValues[Ae]||te.formattingValues[Ie]}else{var Se=te.defaultWidth,Oe=xe!=null&&xe.width?String(xe.width):te.defaultWidth;ke=te.values[Oe]||te.values[Se]}var Ve=te.argumentCallback?te.argumentCallback(be):be;return ke[Ve]}}Te.exports=we.default})(buildLocalizeFn,buildLocalizeFn.exports);var buildLocalizeFnExports=buildLocalizeFn.exports;(function(Te,we){var t=interopRequireDefaultExports.default;Object.defineProperty(we,"__esModule",{value:!0}),we.default=void 0;var te=t(buildLocalizeFnExports),be={narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},xe={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},ve={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},ke={narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},Ie={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},Ae={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},Se=function(De,Fe){var Be=Number(De),$e=Be%100;if($e>20||$e<10)switch($e%10){case 1:return Be+"st";case 2:return Be+"nd";case 3:return Be+"rd"}return Be+"th"},Oe={ordinalNumber:Se,era:(0,te.default)({values:be,defaultWidth:"wide"}),quarter:(0,te.default)({values:xe,defaultWidth:"wide",argumentCallback:function(De){return De-1}}),month:(0,te.default)({values:ve,defaultWidth:"wide"}),day:(0,te.default)({values:ke,defaultWidth:"wide"}),dayPeriod:(0,te.default)({values:Ie,defaultWidth:"wide",formattingValues:Ae,defaultFormattingWidth:"wide"})},Ve=Oe;we.default=Ve,Te.exports=we.default})(localize,localize.exports);var localizeExports=localize.exports,match$1={exports:{}},buildMatchFn={exports:{}};(function(Te,we){Object.defineProperty(we,"__esModule",{value:!0}),we.default=t;function t(xe){return function(ve){var ke=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},Ie=ke.width,Ae=Ie&&xe.matchPatterns[Ie]||xe.matchPatterns[xe.defaultMatchWidth],Se=ve.match(Ae);if(!Se)return null;var Oe=Se[0],Ve=Ie&&xe.parsePatterns[Ie]||xe.parsePatterns[xe.defaultParseWidth],Me=Array.isArray(Ve)?be(Ve,function(Be){return Be.test(Oe)}):te(Ve,function(Be){return Be.test(Oe)}),De;De=xe.valueCallback?xe.valueCallback(Me):Me,De=ke.valueCallback?ke.valueCallback(De):De;var Fe=ve.slice(Oe.length);return{value:De,rest:Fe}}}function te(xe,ve){for(var ke in xe)if(xe.hasOwnProperty(ke)&&ve(xe[ke]))return ke}function be(xe,ve){for(var ke=0;ke<xe.length;ke++)if(ve(xe[ke]))return ke}Te.exports=we.default})(buildMatchFn,buildMatchFn.exports);var buildMatchFnExports=buildMatchFn.exports,buildMatchPatternFn={exports:{}};(function(Te,we){Object.defineProperty(we,"__esModule",{value:!0}),we.default=t;function t(te){return function(be){var xe=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},ve=be.match(te.matchPattern);if(!ve)return null;var ke=ve[0],Ie=be.match(te.parsePattern);if(!Ie)return null;var Ae=te.valueCallback?te.valueCallback(Ie[0]):Ie[0];Ae=xe.valueCallback?xe.valueCallback(Ae):Ae;var Se=be.slice(ke.length);return{value:Ae,rest:Se}}}Te.exports=we.default})(buildMatchPatternFn,buildMatchPatternFn.exports);var buildMatchPatternFnExports=buildMatchPatternFn.exports;(function(Te,we){var t=interopRequireDefaultExports.default;Object.defineProperty(we,"__esModule",{value:!0}),we.default=void 0;var te=t(buildMatchFnExports),be=t(buildMatchPatternFnExports),xe=/^(\d+)(th|st|nd|rd)?/i,ve=/\d+/i,ke={narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},Ie={any:[/^b/i,/^(a|c)/i]},Ae={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},Se={any:[/1/i,/2/i,/3/i,/4/i]},Oe={narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},Ve={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},Me={narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},De={narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},Fe={narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},Be={any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},$e={ordinalNumber:(0,be.default)({matchPattern:xe,parsePattern:ve,valueCallback:function(ze){return parseInt(ze,10)}}),era:(0,te.default)({matchPatterns:ke,defaultMatchWidth:"wide",parsePatterns:Ie,defaultParseWidth:"any"}),quarter:(0,te.default)({matchPatterns:Ae,defaultMatchWidth:"wide",parsePatterns:Se,defaultParseWidth:"any",valueCallback:function(ze){return ze+1}}),month:(0,te.default)({matchPatterns:Oe,defaultMatchWidth:"wide",parsePatterns:Ve,defaultParseWidth:"any"}),day:(0,te.default)({matchPatterns:Me,defaultMatchWidth:"wide",parsePatterns:De,defaultParseWidth:"any"}),dayPeriod:(0,te.default)({matchPatterns:Fe,defaultMatchWidth:"any",parsePatterns:Be,defaultParseWidth:"any"})},Ue=$e;we.default=Ue,Te.exports=we.default})(match$1,match$1.exports);var matchExports=match$1.exports;(function(Te,we){var t=interopRequireDefaultExports.default;Object.defineProperty(we,"__esModule",{value:!0}),we.default=void 0;var te=t(formatDistanceExports),be=t(formatLongExports),xe=t(formatRelativeExports),ve=t(localizeExports),ke=t(matchExports),Ie={code:"en-US",formatDistance:te.default,formatLong:be.default,formatRelative:xe.default,localize:ve.default,match:ke.default,options:{weekStartsOn:0,firstWeekContainsDate:1}},Ae=Ie;we.default=Ae,Te.exports=we.default})(enUS,enUS.exports);var enUSExports=enUS.exports;(function(Te,we){var t=interopRequireDefaultExports.default;Object.defineProperty(we,"__esModule",{value:!0}),we.default=void 0;var te=t(enUSExports),be=te.default;we.default=be,Te.exports=we.default})(defaultLocale$1,defaultLocale$1.exports);var defaultLocaleExports=defaultLocale$1.exports;(function(Te,we){var t=interopRequireDefaultExports.default;Object.defineProperty(we,"__esModule",{value:!0}),we.default=He;var te=t(isValidExports),be=t(subMillisecondsExports),xe=t(toDateExports),ve=t(formattersExports),ke=t(longFormattersExports),Ie=t(getTimezoneOffsetInMillisecondsExports),Ae=protectedTokens,Se=t(toIntegerExports),Oe=t(requiredArgsExports),Ve=defaultOptions$1,Me=t(defaultLocaleExports),De=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,Fe=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,Be=/^'([^]*?)'?$/,$e=/''/g,Ue=/[a-zA-Z]/;function He(qe,Ke,Qe){var je,Ye,ht,Ze,Bt,Jt,Yt,en,sn,hn,mn,bn,gn,tn,Kt,Xt,pn,Ge;(0,Oe.default)(2,arguments);var Ne=String(Ke),Le=(0,Ve.getDefaultOptions)(),We=(je=(Ye=Qe==null?void 0:Qe.locale)!==null&&Ye!==void 0?Ye:Le.locale)!==null&&je!==void 0?je:Me.default,Je=(0,Se.default)((ht=(Ze=(Bt=(Jt=Qe==null?void 0:Qe.firstWeekContainsDate)!==null&&Jt!==void 0?Jt:Qe==null||(Yt=Qe.locale)===null||Yt===void 0||(en=Yt.options)===null||en===void 0?void 0:en.firstWeekContainsDate)!==null&&Bt!==void 0?Bt:Le.firstWeekContainsDate)!==null&&Ze!==void 0?Ze:(sn=Le.locale)===null||sn===void 0||(hn=sn.options)===null||hn===void 0?void 0:hn.firstWeekContainsDate)!==null&&ht!==void 0?ht:1);if(!(Je>=1&&Je<=7))throw new RangeError("firstWeekContainsDate must be between 1 and 7 inclusively");var Wt=(0,Se.default)((mn=(bn=(gn=(tn=Qe==null?void 0:Qe.weekStartsOn)!==null&&tn!==void 0?tn:Qe==null||(Kt=Qe.locale)===null||Kt===void 0||(Xt=Kt.options)===null||Xt===void 0?void 0:Xt.weekStartsOn)!==null&&gn!==void 0?gn:Le.weekStartsOn)!==null&&bn!==void 0?bn:(pn=Le.locale)===null||pn===void 0||(Ge=pn.options)===null||Ge===void 0?void 0:Ge.weekStartsOn)!==null&&mn!==void 0?mn:0);if(!(Wt>=0&&Wt<=6))throw new RangeError("weekStartsOn must be between 0 and 6 inclusively");if(!We.localize)throw new RangeError("locale must contain localize property");if(!We.formatLong)throw new RangeError("locale must contain formatLong property");var nn=(0,xe.default)(qe);if(!(0,te.default)(nn))throw new RangeError("Invalid time value");var cn=(0,Ie.default)(nn),fn=(0,be.default)(nn,cn),un={firstWeekContainsDate:Je,weekStartsOn:Wt,locale:We,_originalDate:nn},ln=Ne.match(Fe).map(function(dn){var zt=dn[0];if(zt==="p"||zt==="P"){var Xe=ke.default[zt];return Xe(dn,We.formatLong)}return dn}).join("").match(De).map(function(dn){if(dn==="''")return"'";var zt=dn[0];if(zt==="'")return ze(dn);var Xe=ve.default[zt];if(Xe)return!(Qe!=null&&Qe.useAdditionalWeekYearTokens)&&(0,Ae.isProtectedWeekYearToken)(dn)&&(0,Ae.throwProtectedError)(dn,Ke,String(qe)),!(Qe!=null&&Qe.useAdditionalDayOfYearTokens)&&(0,Ae.isProtectedDayOfYearToken)(dn)&&(0,Ae.throwProtectedError)(dn,Ke,String(qe)),Xe(fn,dn,We.localize,un);if(zt.match(Ue))throw new RangeError("Format string contains an unescaped latin alphabet character `"+zt+"`");return dn}).join("");return ln}function ze(qe){var Ke=qe.match(Be);return Ke?Ke[1].replace($e,"'"):qe}Te.exports=we.default})(format,format.exports);var formatExports=format.exports;const _0x1ea0ca=getDefaultExportFromCjs(formatExports);var parseISO={exports:{}},constants={};Object.defineProperty(constants,"__esModule",{value:!0});constants.secondsInYear=constants.secondsInWeek=constants.secondsInQuarter=constants.secondsInMonth=constants.secondsInMinute=constants.secondsInHour=constants.secondsInDay=constants.quartersInYear=constants.monthsInYear=constants.monthsInQuarter=constants.minutesInHour=constants.minTime=constants.millisecondsInSecond=constants.millisecondsInMinute=constants.millisecondsInHour=constants.maxTime=constants.daysInYear=constants.daysInWeek=void 0;var daysInWeek=7;constants.daysInWeek=daysInWeek;var daysInYear$1=365.2425;constants.daysInYear=daysInYear$1;var maxTime=Math.pow(10,8)*24*60*60*1e3;constants.maxTime=maxTime;var millisecondsInMinute=6e4;constants.millisecondsInMinute=millisecondsInMinute;var millisecondsInHour=36e5;constants.millisecondsInHour=millisecondsInHour;var millisecondsInSecond=1e3;constants.millisecondsInSecond=millisecondsInSecond;var minTime=-maxTime;constants.minTime=minTime;var minutesInHour=60;constants.minutesInHour=minutesInHour;var monthsInQuarter=3;constants.monthsInQuarter=monthsInQuarter;var monthsInYear=12;constants.monthsInYear=monthsInYear;var quartersInYear=4;constants.quartersInYear=quartersInYear;var secondsInHour=3600;constants.secondsInHour=secondsInHour;var secondsInMinute=60;constants.secondsInMinute=secondsInMinute;var secondsInDay=secondsInHour*24;constants.secondsInDay=secondsInDay;var secondsInWeek=secondsInDay*7;constants.secondsInWeek=secondsInWeek;var secondsInYear=secondsInDay*daysInYear$1;constants.secondsInYear=secondsInYear;var secondsInMonth=secondsInYear/12;constants.secondsInMonth=secondsInMonth;var secondsInQuarter=secondsInMonth*3;constants.secondsInQuarter=secondsInQuarter;(function(Te,we){var t=interopRequireDefaultExports.default;Object.defineProperty(we,"__esModule",{value:!0}),we.default=ve;var te=constants,be=t(requiredArgsExports),xe=t(toIntegerExports);function ve(ht,Ze){var Bt;(0,be.default)(1,arguments);var Jt=(0,xe.default)((Bt=Ze==null?void 0:Ze.additionalDigits)!==null&&Bt!==void 0?Bt:2);if(Jt!==2&&Jt!==1&&Jt!==0)throw new RangeError("additionalDigits must be 0, 1 or 2");if(!(typeof ht=="string"||Object.prototype.toString.call(ht)==="[object String]"))return new Date(NaN);var Yt=Oe(ht),en;if(Yt.date){var sn=Ve(Yt.date,Jt);en=Me(sn.restDateString,sn.year)}if(!en||isNaN(en.getTime()))return new Date(NaN);var hn=en.getTime(),mn=0,bn;if(Yt.time&&(mn=Fe(Yt.time),isNaN(mn)))return new Date(NaN);if(Yt.timezone){if(bn=$e(Yt.timezone),isNaN(bn))return new Date(NaN)}else{var gn=new Date(hn+mn),tn=new Date(0);return tn.setFullYear(gn.getUTCFullYear(),gn.getUTCMonth(),gn.getUTCDate()),tn.setHours(gn.getUTCHours(),gn.getUTCMinutes(),gn.getUTCSeconds(),gn.getUTCMilliseconds()),tn}return new Date(hn+mn+bn)}var ke={dateTimeDelimiter:/[T ]/,timeZoneDelimiter:/[Z ]/i,timezone:/([Z+-].*)$/},Ie=/^-?(?:(\d{3})|(\d{2})(?:-?(\d{2}))?|W(\d{2})(?:-?(\d{1}))?|)$/,Ae=/^(\d{2}(?:[.,]\d*)?)(?::?(\d{2}(?:[.,]\d*)?))?(?::?(\d{2}(?:[.,]\d*)?))?$/,Se=/^([+-])(\d{2})(?::?(\d{2}))?$/;function Oe(ht){var Ze={},Bt=ht.split(ke.dateTimeDelimiter),Jt;if(Bt.length>2)return Ze;if(/:/.test(Bt[0])?Jt=Bt[0]:(Ze.date=Bt[0],Jt=Bt[1],ke.timeZoneDelimiter.test(Ze.date)&&(Ze.date=ht.split(ke.timeZoneDelimiter)[0],Jt=ht.substr(Ze.date.length,ht.length))),Jt){var Yt=ke.timezone.exec(Jt);Yt?(Ze.time=Jt.replace(Yt[1],""),Ze.timezone=Yt[1]):Ze.time=Jt}return Ze}function Ve(ht,Ze){var Bt=new RegExp("^(?:(\\d{4}|[+-]\\d{"+(4+Ze)+"})|(\\d{2}|[+-]\\d{"+(2+Ze)+"})$)"),Jt=ht.match(Bt);if(!Jt)return{year:NaN,restDateString:""};var Yt=Jt[1]?parseInt(Jt[1]):null,en=Jt[2]?parseInt(Jt[2]):null;return{year:en===null?Yt:en*100,restDateString:ht.slice((Jt[1]||Jt[2]).length)}}function Me(ht,Ze){if(Ze===null)return new Date(NaN);var Bt=ht.match(Ie);if(!Bt)return new Date(NaN);var Jt=!!Bt[4],Yt=De(Bt[1]),en=De(Bt[2])-1,sn=De(Bt[3]),hn=De(Bt[4]),mn=De(Bt[5])-1;if(Jt)return Qe(Ze,hn,mn)?Ue(Ze,hn,mn):new Date(NaN);var bn=new Date(0);return!qe(Ze,en,sn)||!Ke(Ze,Yt)?new Date(NaN):(bn.setUTCFullYear(Ze,en,Math.max(Yt,sn)),bn)}function De(ht){return ht?parseInt(ht):1}function Fe(ht){var Ze=ht.match(Ae);if(!Ze)return NaN;var Bt=Be(Ze[1]),Jt=Be(Ze[2]),Yt=Be(Ze[3]);return je(Bt,Jt,Yt)?Bt*te.millisecondsInHour+Jt*te.millisecondsInMinute+Yt*1e3:NaN}function Be(ht){return ht&&parseFloat(ht.replace(",","."))||0}function $e(ht){if(ht==="Z")return 0;var Ze=ht.match(Se);if(!Ze)return 0;var Bt=Ze[1]==="+"?-1:1,Jt=parseInt(Ze[2]),Yt=Ze[3]&&parseInt(Ze[3])||0;return Ye(Jt,Yt)?Bt*(Jt*te.millisecondsInHour+Yt*te.millisecondsInMinute):NaN}function Ue(ht,Ze,Bt){var Jt=new Date(0);Jt.setUTCFullYear(ht,0,4);var Yt=Jt.getUTCDay()||7,en=(Ze-1)*7+Bt+1-Yt;return Jt.setUTCDate(Jt.getUTCDate()+en),Jt}var He=[31,null,31,30,31,30,31,31,30,31,30,31];function ze(ht){return ht%400===0||ht%4===0&&ht%100!==0}function qe(ht,Ze,Bt){return Ze>=0&&Ze<=11&&Bt>=1&&Bt<=(He[Ze]||(ze(ht)?29:28))}function Ke(ht,Ze){return Ze>=1&&Ze<=(ze(ht)?366:365)}function Qe(ht,Ze,Bt){return Ze>=1&&Ze<=53&&Bt>=0&&Bt<=6}function je(ht,Ze,Bt){return ht===24?Ze===0&&Bt===0:Bt>=0&&Bt<60&&Ze>=0&&Ze<60&&ht>=0&&ht<25}function Ye(ht,Ze){return Ze>=0&&Ze<=59}Te.exports=we.default})(parseISO,parseISO.exports);var parseISOExports=parseISO.exports;const _0x56fb73=getDefaultExportFromCjs(parseISOExports);var differenceInCalendarDays={exports:{}},startOfDay={exports:{}};(function(Te,we){var t=interopRequireDefaultExports.default;Object.defineProperty(we,"__esModule",{value:!0}),we.default=xe;var te=t(toDateExports),be=t(requiredArgsExports);function xe(ve){(0,be.default)(1,arguments);var ke=(0,te.default)(ve);return ke.setHours(0,0,0,0),ke}Te.exports=we.default})(startOfDay,startOfDay.exports);var startOfDayExports=startOfDay.exports;(function(Te,we){var t=interopRequireDefaultExports.default;Object.defineProperty(we,"__esModule",{value:!0}),we.default=ke;var te=t(getTimezoneOffsetInMillisecondsExports),be=t(startOfDayExports),xe=t(requiredArgsExports),ve=864e5;function ke(Ie,Ae){(0,xe.default)(2,arguments);var Se=(0,be.default)(Ie),Oe=(0,be.default)(Ae),Ve=Se.getTime()-(0,te.default)(Se),Me=Oe.getTime()-(0,te.default)(Oe);return Math.round((Ve-Me)/ve)}Te.exports=we.default})(differenceInCalendarDays,differenceInCalendarDays.exports);var differenceInCalendarDaysExports=differenceInCalendarDays.exports;const _0x8c0fb4=getDefaultExportFromCjs(differenceInCalendarDaysExports);let n$8=class extends ContextPlugin{static get pluginName(){return"Permissions"}setPermissions(we,t){let te;if(t||(t=this.context.config.get("collaboration.channelId")),this.context.config.get("collaboration.channelId")==t?te=this.context:"editors"in this.context&&this.context.editors&&(te=this.context.editors.find(De=>De.config.get("collaboration.channelId")==t)),!te)throw new CKEditorError("permissions-set-permissions-invalid-channel-id",null);const be=te.plugins,xe=be.has("CommentsRepository")?be.get("CommentsRepository"):void 0,ve=be.has("CommentsOnly")&&be.get("CommentsOnly"),ke=we.includes("document:write"),Ie=we.includes("comment:modify_all"),Ae=we.includes("comment:admin"),Se=we.includes("comment:write"),Oe=Se||Ae,Ve=Oe||Ie,Me=ke||Oe;if(ve&&(ve.isEnabled=!ke&&Ve),te instanceof Editor&&(ke||Ve&&xe?te.disableReadOnlyMode("no-permissions"):te.enableReadOnlyMode("no-permissions")),xe){xe.setPermissions({admin:Ae,modifyAll:Ie,write:Se,resolve:Me},t);const De=te instanceof Editor&&te.commands.get("addCommentThread");De&&(Oe?De.clearForceDisabled("noPermissions"):De.forceDisabled("noPermissions"))}}};function r$c(Te,we){const t=Te.t;switch(we){case"Anonymous":return t("Anonymous");case"Yes":return t("Yes");case"No":return t("No");case"Are you sure?":return t("Are you sure?");default:return""}}let l$8=class extends ContextPlugin{constructor(t){super(t);Re(this,"users");Re(this,"_licenseKeyCheckInterval");Re(this,"_lastColor");Re(this,"_myId");Re(this,"_locale");this.context.config.define("users.anonymousUserId","anonymous-user"),this.context.config.define("users.colorsCount",8),this.users=new Collection,this._locale=t.locale,this._licenseKeyCheckInterval=null,this._lastColor=0,this._myId=null,this.decorate("getOperationAuthor")}static get pluginName(){return"Users"}static get requires(){return[n$8]}init(){const t=this.context;this.licenseKey=t.config.get("licenseKey");const te=["licenseKeyTrial","licenseKeyInvalid","licenseKeyValid","licenseKeyTrialLimit:operations","licenseKeyTrialLimit:time","licenseKeyTrialLimit:revisions"];this._licenseKeyCheckInterval=setInterval(()=>{let be;for(const xe in t){const ve=t[xe];if(te.includes(ve)){delete t[xe],be=ve;break}}if(be==="licenseKeyInvalid")throw clearInterval(this._licenseKeyCheckInterval),new CKEditorError("invalid-license-key",null);if(be==="licenseKeyTrial"&&console.info("You are using the trial version of CKEditor 5 collaboration plugin with limited usage. Make sure you will not use it in the production environment."),be==="licenseKeyTrialLimit:operations")throw clearInterval(this._licenseKeyCheckInterval),new CKEditorError("trial-license-key-reached-limit-changes",null);if(be==="licenseKeyTrialLimit:time")throw clearInterval(this._licenseKeyCheckInterval),new CKEditorError("trial-license-key-reached-limit-time",null);if(be==="licenseKeyTrialLimit:revisions")throw clearInterval(this._licenseKeyCheckInterval),new CKEditorError("trial-license-key-reached-limit-revisions",null);be==="licenseKeyValid"&&clearInterval(this._licenseKeyCheckInterval)},1e3),this._addAnonymousUser()}get me(){return this._myId==null?null:this.getUser(this._myId)}addUser({id:t,name:te,...be}){if(!t||typeof t!="string")throw new CKEditorError("users-add-invalid-id");if(this.users.has(t))throw new CKEditorError("users-add-duplicated-id",null,{id:t});const xe={...be,id:t,name:a$a(this._locale,te),color:this._getNextColor()};xe.name=a$a(this._locale,xe.name);const ve=new I$3(xe);return this.users.add(ve),ve}getUser(t){return this.users.get(t)}useAnonymousUser(){const t=this.context.config.get("users.anonymousUserId");this._myId||this.defineMe(t)}defineMe(t){if(this._myId)throw new CKEditorError("users-me-already-defined",null);const te=this.getUser(t);if(!te)throw new CKEditorError("users-me-missing-user",null);this._myId=t,te._isMe=!0}getOperationAuthor(){return this.me}destroy(){super.destroy(),clearInterval(this._licenseKeyCheckInterval)}_getNextColor(){const t=this.context.config.get("users.colorsCount");return this._lastColor>=t&&(this._lastColor=0),new u$4(this._lastColor++)}_addAnonymousUser(){const t=this.context.config.get("users.anonymousUserId");this.addUser({id:t,name:r$c(this._locale,"Anonymous")})._isAnonymous=!0}},I$3=class{constructor(we){Re(this,"id");Re(this,"color");Re(this,"name");Re(this,"avatar");Re(this,"_isMe");Re(this,"_isAnonymous");this.id=we.id,this.color=we.color,this.name=we.name,this.avatar=we.avatar,this._isAnonymous=!1,this._isMe=!1}get isAnonymous(){return this._isAnonymous}get isMe(){return this._isMe}get initials(){const we=this.name.split(" ");return we.length===1?this._getInitial(we[0]):this._getInitial(we[0])+this._getInitial(we[we.length-1])}_getInitial(we){return we.charAt(0).toUpperCase()}};function a$a(Te,we=""){return(we=we.trim())==""?r$c(Te,"Anonymous"):we}let u$4=class{constructor(we){Re(this,"_id");this._id=we}getBackgroundColorClass(){return"ck-user__bg-color--"+this._id}getSelectionClass(){return"ck-user__selection--"+this._id}getMarkerClass(){return"ck-user__marker--"+this._id}},E$4=class extends View{constructor(t,te,be){super(t);Re(this,"name");Re(this,"notificationView");this.name=te.name,this.notificationView=null;const xe=["ck","ck-user"],ve=["ck","ck-user__img"];if(te.isAnonymous&&ve.push("ck-user__anonymous"),!te.isAnonymous&&te.isMe&&xe.push("ck-user_me"),te.avatar&&ve.push("ck-user__avatar"),be){const Ie=new IconView;Ie.extendTemplate({attributes:{class:["ck-user__icon"]}}),Ie.content=`<!--

 What you're currently looking at is the source code of a legally protected, proprietary software.
 CKEditor 5 Collaboration is licensed under a commercial license and protected by copyright law. Where not otherwise indicated,
 all CKEditor 5 Collaboration content is authored by CKSource engineers and consists of CKSource-owned intellectual property.

 Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.

!-->

<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M10 0C4.48 0 0 4.48 0 10s4.48 10 10 10 10-4.48 10-10S15.52 0 10 0zm1 15H9v-2h2v2zm0-4H9V5h2v6z"/></svg>
`,this.notificationView={tag:"div",attributes:{class:["ck","ck-user__notification"],"data-cke-tooltip-position":"n","data-cke-tooltip-text":be},children:[Ie]}}const ke=[{tag:"div",attributes:{class:ve,style:{"background-image":te.avatar?"url('"+te.avatar+"')":""}}},{tag:"div",attributes:{class:te.avatar?"ck ck-user__name ck-user__name--hidden":"ck ck-user__name"},children:[{text:te.initials}]}];this.notificationView&&ke.push(this.notificationView),this.setTemplate({tag:"div",attributes:{class:xe,"data-user-id":te.id},children:ke})}};function j$4(Te={}){if(Te.dateTimeFormat!==void 0&&typeof Te.dateTimeFormat!="function")throw new CKEditorError("invalid-date-time-format");return we=>{const t=typeof we=="string"?_0x56fb73(we):we,te=new Date,be=_0x8c0fb4(te,t);return Te.dateTimeFormat?Te.dateTimeFormat(t):_0x1ea0ca(t,be===0?"'Today' hh:mma":be===1?"'Yesterday' hh:mma":be<7?"'Last' EEEE hh:mma":"MM-dd-yyyy hh:mma")}}function k$6(Te,we){const t=Te.mapper.markerNameToElements(we.name);if(!t)return null;const te=first(t.values());return Te.view.domConverter.mapViewToDom(te)||null}function K$4(Te,we){if(we.length===0)return null;const t=[],te=Te.view.domConverter;for(const xe of we){const ve=Te.mapper.markerNameToElements(xe.name);if(!ve)continue;const ke=Array.from(ve).map(Ie=>te.mapViewToDom(Ie)).filter(Ie=>!!Ie);t.push(...ke)}if(t.length===0)return null;const be=[];for(const xe of t){const ve=xe.getClientRects().item(0);ve&&be.push({x:ve.x,y:ve.y,domElement:xe})}return be.length===0?null:(be.sort((xe,ve)=>xe.y-ve.y||xe.x-ve.x),be.map(xe=>xe.domElement))}function Z$2(Te,{limit:we,suffix:t="..."}){const te=[];let be=0;const xe=Te.replace(/</g,`
<`).replace(/>/g,`>
`).replace(/^\n/g,"").replace(/\n$/g,"").split(`
`);for(let ve=0;ve<xe.length;ve++){let ke=xe[ve];const Ie=$$3(ke);if(ke.startsWith("<")){if(be>=we){const Ae=ke.match(/[a-zA-Z]+/);if(!Ae){xe[ve]="";continue}const Se=Ae[0];ke.startsWith("</")?(te.length&&(ke=""),te.pop()):(te.push(Se),ke="")}}else if(be>=we)ke="";else if(be+Ie.length>=we){let Ae=we-be;if(Ie[Ae-1]===" ")Ae--;else{const Se=Ie.slice(Ae).indexOf(" ");Se!==-1?Ae+=Se:Ae=ke.length}ke=Ie.slice(0,Ae).join("")+t,be=we}else be+=Ie.length;xe[ve]=ke}return xe.join(`
`).replace(/\n/g,"")}function $$3(Te){const we=[];for(let t=0;t<Te.length;t++){const te=Te.substring(t).match(/^&[a-z0-9#]+;/);if(te){const be=te[0];we.push(be),t+=be.length-1}else we.push(Te[t])}return we}let h$5=class extends View{constructor(t){super(t);Re(this,"submitView");Re(this,"cancelView");const te=this.bindTemplate;this.submitView=this._createButtonView(t,r$c(t,"Yes"),icons.check,"submit"),this.cancelView=this._createButtonView(t,r$c(t,"No"),icons.cancel,"cancel"),this.set("message",r$c(t,"Are you sure?")),this.setTemplate({tag:"div",attributes:{class:["ck-thread__remove-confirm"]},children:[{tag:"div",attributes:{class:"ck-thread__remove-confirm-inner"},children:[{tag:"p",children:[{text:te.to("message")}]},{tag:"div",attributes:{class:"ck-thread__remove-confirm-actions"},children:[this.submitView,this.cancelView]}]}]})}_createButtonView(t,te,be,xe){const ve=new ButtonView(t);return ve.label=te,ve.icon=be,ve.extendTemplate({attributes:{class:"ck-thread__remove-confirm-"+xe}}),ve.on("execute",()=>this.fire(xe)),ve}};function m$a(Te){return class extends Te{showConfirm(we,t){return this.confirmView=new h$5(this.locale),this.confirmView.render(),this.confirmView.message=we,this.confirmView.once("cancel",()=>{this._removeConfirm()}),this.confirmView.once("submit",()=>{this._removeConfirm()}),t.appendChild(this.confirmView.element),this.registerChild(this.confirmView),this.element.focus(),this.set("isConfirm",!0),new Promise(te=>this.confirmView.on("submit",te))}cancelConfirm(){this.isConfirm&&this.confirmView.fire("cancel")}_removeConfirm(){this.element&&this.confirmView&&this.confirmView.element&&(this.element.focus(),this.confirmView.element.remove(),this.deregisterChild(this.confirmView),this.isConfirm=!1,this.confirmView.destroy(),this.confirmView=void 0)}}}function b$4(Te){let we=0,t=0;for(const te of A$5(Te))we=(we<<5)-we+te,we|=0,[we,t]=[t,we];return q$4(we)+q$4(t)}function*g$4(Te){Te==null||Te==null?yield 314159265:Te===0||Te===!1?yield 0:Te===1||Te==1?yield 1:Array.isArray(Te)?yield*function*(we){for(const t of we)yield*g$4(t)}(Te):typeof Te=="object"?yield*A$5(Te):typeof Te=="string"?yield*M$2(Te):typeof Te=="number"&&(yield Te)}function*A$5(Te){if(yield O$4("{"),Te){const we=Object.keys(Te).sort();for(const t of we){yield*M$2(t),yield O$4(":");const te=Te[t];yield*g$4(te)}}yield O$4("}")}function*M$2(Te){yield O$4('"');for(const we of Te)yield O$4(we);yield O$4('"')}function O$4(Te){return Te.charCodeAt(0)}function q$4(Te){return(Te*=Math.sign(Te)).toString(36)}const w$3=["initialData","context","toolbar","rootsAttributes"],W$3=["WebSocketGateway","RevisionTracker","Autosave","WordCount","DocumentOutline","WProofreader"];function v$5(Te,we,t,te=[]){const be=typeof Te=="string"?t.get(Te).constructor:Te.prototype.constructor;if(we.has(be))return we.get(be);we.set(be,!0);const xe=[...W$3,...te].map(ke=>{if(t.has(ke))return t.get(ke).constructor}).filter(ke=>ke);if(be&&xe.includes(be))return we.set(be,!1),!1;if(!be.requires)return we.set(be,!0),!0;const ve=be.requires.every(ke=>v$5(ke,we,t,te));return we.set(be,ve),ve}function D$2(Te,we){const t={};for(const Ve of Te.config.names())w$3.includes(Ve)||(t[Ve]=Te.config.get(Ve));const te=t.plugins||[],be=Te.constructor.builtinPlugins||[],xe=te.length?te:be,ve=t.extraPlugins||[];delete t.extraPlugins;const ke=t.removePlugins||[];delete t.removePlugins;const Ie=Te._context.config.get("plugins")||[],Ae=xe.concat(ve).concat(Ie).map(Ve=>typeof Ve=="string"?be.find(Me=>Me.pluginName==Ve):Ve).filter(Ve=>!ke.includes(Ve)&&!ke.includes(Ve.pluginName)),Se=Array.from(new Set(Ae)),Oe=new Map;return t.plugins=Se.filter(Ve=>v$5(Ve,Oe,Te.plugins,we)),t}function z$3(Te,we){const t=[];Te.document.selection.on("change:range",()=>{const te=function(ke,Ie){const Ae=[];for(const Se of ke.markers){const Oe=Se.getRange();(Oe.containsPosition(Ie)||Oe.start.isEqual(Ie)||Oe.end.isEqual(Ie))&&Ae.push(Se)}return Ae}(Te,Te.document.selection.focus),be=[],xe=[],ve=[];for(const ke of t)te.includes(ke)||be.push(ke);for(const ke of te)t.includes(ke)||xe.push(ke),ve.push(ke);(be.length||xe.length)&&we({left:be,entered:xe}),t.length=0,t.push(...ve)})}const a$9={paintRoller:`<svg viewBox="0 0 20 20" width="20" height="20" xmlns="http://www.w3.org/2000/svg"><path d="M3 3a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v2a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V3Z"/><path d="M16 3.25a1.5 1.5 0 0 1 1.5 1.5v1.7a2.25 2.25 0 0 1-1.932 2.226l-4.424.632a.75.75 0 0 0-.644.743V11a1 1 0 0 1 1 1v5a1 1 0 0 1-1 1H9a1 1 0 0 1-1-1v-5a1 1 0 0 1 1-1v-.95a2.25 2.25 0 0 1 1.932-2.226l4.424-.632A.75.75 0 0 0 16 6.449V3.25Z"/></svg>
`,robotPencil:'<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M9.61 2.66a1.406 1.406 0 1 0-1.407 0v.891H3.28a2.11 2.11 0 0 0-2.11 2.11v10.312a2.11 2.11 0 0 0 2.11 2.109h5.684l-.054-1.157.18-.25H3.28a.703.703 0 0 1-.703-.702V5.66c0-.389.315-.704.703-.704h11.25c.388 0 .703.315.703.704v2.484l.358-.497a2.492 2.492 0 0 1 1.048-.84V5.66a2.11 2.11 0 0 0-2.11-2.11H9.61v-.89Z"/><path d="M5.625 10.817c.518 0 .937-.63.937-1.407 0-.776-.42-1.406-.937-1.406-.518 0-.938.63-.938 1.406 0 .777.42 1.407.938 1.407Z"/><path d="M13.125 9.41c0 .777-.42 1.407-.938 1.407s-.937-.63-.937-1.407c0-.776.42-1.406.937-1.406.518 0 .938.63.938 1.406Z"/><path d="M.937 8.004A.937.937 0 0 0 0 8.942v1.875c0 .517.42.937.937.937v-3.75Z"/><path d="M6.128 12.51a.782.782 0 0 1 1.085.216c.272.408.907.707 1.693.707s1.421-.3 1.693-.707a.782.782 0 0 1 1.302.868c-.666 1-1.906 1.403-2.995 1.403-1.089 0-2.329-.404-2.995-1.403a.782.782 0 0 1 .217-1.085Z"/><path d="m16.987 8.91-.622.864 2.879 2.074.622-.864a.71.71 0 0 0-.161-.99l-1.728-1.245a.71.71 0 0 0-.99.161Z"/><path d="M11.635 19.951a.355.355 0 0 1-.449-.31l-.214-2.38 4.978-6.911 2.88 2.074-4.978 6.91-2.217.617Z"/></svg>',tableOfContents:`<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M3 19a2 2 0 0 1-2-2V2a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2v8.022a6.47 6.47 0 0 0-1.5-.709V2a.5.5 0 0 0-.5-.5H3a.5.5 0 0 0-.5.5v15a.5.5 0 0 0 .5.5h6.313c.173.534.412 1.037.709 1.5H3Z"/><path d="M9.174 14a6.489 6.489 0 0 0-.155 1H6v-1h3.174Z"/><path d="M10.022 12c-.202.316-.378.65-.524 1H4v-1h6.022Z"/><path d="M12.034 10c-.448.283-.86.62-1.224 1H6v-1h6.034Z"/><path d="M12 4v1H4V4h8Z"/><path d="M14 7V6H6v1h8Z"/><path d="M15 9V8H7v1h8Z"/><path clip-rule="evenodd" d="M20 15.5a4.5 4.5 0 1 1-9 0 4.5 4.5 0 0 1 9 0ZM15.5 13a.5.5 0 0 0-.5.5V15h-1.5a.5.5 0 0 0 0 1H15v1.5a.5.5 0 0 0 1 0V16h1.5a.5.5 0 0 0 0-1H16v-1.5a.5.5 0 0 0-.5-.5Z"/></svg>
`,template:'<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path clip-rule="evenodd" d="M8 0H3a2 2 0 0 0-2 2v15a2 2 0 0 0 2 2h5a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2ZM2.5 2a.5.5 0 0 1 .5-.5h5a.5.5 0 0 1 .5.5v15a.5.5 0 0 1-.5.5H3a.5.5 0 0 1-.5-.5V2Z"/><path clip-rule="evenodd" d="M13 0h5a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-5a2 2 0 0 1-2-2V2a2 2 0 0 1 2-2Zm0 1.5a.5.5 0 0 0-.5.5v5a.5.5 0 0 0 .5.5h5a.5.5 0 0 0 .5-.5V2a.5.5 0 0 0-.5-.5h-5Z"/><path clip-rule="evenodd" d="M13 10h5a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-5a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2Zm0 1.5a.5.5 0 0 0-.5.5v5a.5.5 0 0 0 .5.5h5a.5.5 0 0 0 .5-.5v-5a.5.5 0 0 0-.5-.5h-5Z"/></svg>',caseChange:'<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M5.789 3 0 17h1.664l1.664-4.027h6.797l.227.548c.046-.172.112-.352.209-.545.217-.436.556-.609.898-.798L7.664 3H5.79Zm.938 1.758 2.777 6.715H3.949l2.778-6.715Z"/><path d="M15.956 7.5c-1.584-.02-3.226.824-3.843 2.882l1.495.106c.904-2.082 4.594-2.13 4.375.534-3.245 1.024-4.838.117-6.082 2.62-.208.418-.17 1.57.54 2.397.71.826 2.014 1.149 3.409.85 1.395-.299 2.24-1.386 2.24-1.386L18.205 17h1.493l-.059-1.72-.056-5.274C19.51 8.612 17.75 7.524 15.956 7.5Zm2.027 4.696s.641 2.453-1.528 3.27c-3.376 1.269-4.188-2.141-1.775-2.638 1.704-.352 1.873-.25 3.303-.632Z"/></svg>'},s$a="ai-ui",c$7="ai-ui-candidate";let i$9=class extends Plugin{static get pluginName(){return"AIAssistantEditing"}init(){const{editor:we}=this,t=["ck-fake-ai-selection"];we.config.get("ai.useTheme")&&t.push("ck-ai-assistant-ui_theme"),we.conversion.for("editingDowncast").markerToHighlight({model:s$a,view:{classes:t,priority:12}}),we.conversion.for("editingDowncast").markerToElement({model:s$a,view:{name:"span",classes:["ck-fake-ai-selection","ck-fake-ai-selection_collapsed"],priority:12}}),we.conversion.for("editingDowncast").markerToHighlight({model:c$7,view:{classes:["ck-fake-ai-selection-candidate"],priority:25}}),we.conversion.for("editingDowncast").markerToElement({model:c$7,view:{name:"span",classes:["ck-fake-ai-selection-candidate","ck-fake-ai-selection_collapsed"],priority:25}})}showFakeVisualSelection(we){const t=this.editor.model,te=we?c$7:s$a;t.change(be=>{const xe=t.document.selection.getFirstRange();if(t.markers.has(te))be.updateMarker(te,{range:xe});else if(xe.start.isAtEnd){const ve=xe.start.getLastMatchingPosition(({item:ke})=>!t.schema.isContent(ke),{boundaries:xe});be.addMarker(te,{usingOperation:!1,affectsData:!1,range:be.createRange(ve,xe.end)})}else be.addMarker(te,{usingOperation:!1,affectsData:!1,range:xe})})}hideFakeVisualSelection(we){const t=this.editor.model,te=we?c$7:s$a;t.markers.has(te)&&t.change(be=>{be.removeMarker(te)})}insertContent(we,t){const te=t||this.editor.model.markers.get(s$a).getRange();if(!this.editor.model.canEditAt(te))return;const be=this.editor.data.processor.toView(we),xe=this.editor.data.toModel(be);this.editor.model.change(ve=>{this.hideFakeVisualSelection();const ke=this.editor.model.insertContent(xe,te);ke&&ve.setSelection(ke)})}insertContentBelow(we){const{model:t}=this.editor,te=Array.from(t.createSelection(this.editor.model.markers.get(s$a).getRange()).getSelectedBlocks()),be=te.length?t.createPositionAfter(te.pop()):t.document.selection.getLastPosition();this.insertContent(we,be)}},y$7=class extends Plugin{static get pluginName(){return"AIAdapter"}afterInit(){if(!this.textAdapter)throw new CKEditorError("aiadapter-text-adapter-not-set",null)}},R$4=class extends Error{constructor(we){super(we),this.name="AIRequestError"}};function o$8(Te,we,t){const te=Te.t;switch(we){case"Edit or review":return te("Edit or review");case"Improve writing":return te("Improve writing");case"Make shorter":return te("Make shorter");case"Make longer":return te("Make longer");case"Simplify language":return te("Simplify language");case"Generate from selection":return te("Generate from selection");case"Summarize":return te("Summarize");case"Continue":return te("Continue");case"Change tone":return te("Change tone");case"Professional":return te("Professional");case"Casual":return te("Casual");case"Direct":return te("Direct");case"Confident":return te("Confident");case"Friendly":return te("Friendly");case"Change style":return te("Change style");case"Business":return te("Business");case"Legal":return te("Legal");case"Journalism":return te("Journalism");case"Poetic":return te("Poetic");case"Translate":return te("Translate");case"Translate to %0":return te("Translate to %0",t);case"English":return te("English");case"Spanish":return te("Spanish");case"German":return te("German");case"Portuguese":return te("Portuguese");case"French":return te("French");case"Simplified Chinese":return te("Simplified Chinese");case"Hindi":return te("Hindi");case"Arabic":return te("Arabic");case"AI Assistant":return te("AI Assistant");case"AI Commands":return te("AI Commands");case"Ask AI to edit or generate":return te("Ask AI to edit or generate");case"Ask AI to improve generated text":return te("Ask AI to improve generated text");case"Copy":return te("Copy");case"Submit":return te("Submit");case"Insert below":return te("Insert below");case"Try again":return te("Try again");case"Stop":return te("Stop");case"AI is writing...":return te("AI is writing...");case"AI is writing":return te("AI is writing");case"Generated content: %0":return te("Generated content: %0",t);case"Error during AI content generation: %0":return te("Error during AI content generation: %0",t);case"History":return te("History");case"Empty history":return te("Empty history");case"Ask AI and your prompts will be listed here for you to use later.":return te("Ask AI and your prompts will be listed here for you to use later.");case"Prompt history":return te("Prompt history");case"Search AI command":return te("Search AI command");case"No commands found":return te("No commands found");case"No commands available":return te("No commands available");case"Clear":return te("Clear");case"AI_REPLACE_CONTENT":return te({id:"AI_REPLACE_CONTENT",string:"Replace"});case"AI_INSERT_CONTENT":return te({id:"AI_INSERT_CONTENT",string:"Insert"});case"AI_ERROR_GET_HEADERS":return te({id:"AI_ERROR_GET_HEADERS",string:"Preparing request headers failed"});case"AI_ERROR_GET_PARAMETERS":return te({id:"AI_ERROR_GET_PARAMETERS",string:"Preparing request parameters failed"});case"AI_ERROR_UNSUPPORTED_MODEL":return te({id:"AI_ERROR_UNSUPPORTED_MODEL",string:'The requested AI model ("%0") is not supported'},t);case"AI_ERROR_CONTEXT_LENGTH":return te({id:"AI_ERROR_CONTEXT_LENGTH",string:"Selected content is too long"});case"AI_ERROR_MODERATION":return te({id:"AI_ERROR_MODERATION",string:"Requested query does not pass moderation rules"});case"AI_ERROR_FAILED":return te({id:"AI_ERROR_FAILED",string:"Failed to communicate with the AI service"});default:return we}}let j$3=class extends Command{constructor(t,te){super(t);Re(this,"_commandDefinitions");this._commandDefinitions=te?te.reduce((be,xe)=>be.concat(xe.commands),new Array):[],this.set("enabledCommandsIds",[]),this.on("change:_hasContext",(be,xe,ve)=>{this.isEnabled&&(this.enabledCommandsIds=K$3(this._commandDefinitions,ve))}),this.set("_hasContext",!1),this.on("change:isEnabled",(be,xe,ve)=>{this.enabledCommandsIds=ve?K$3(this._commandDefinitions,this._hasContext):[]})}refresh(){const t=this.editor.model;this._hasContext=function(xe){const ve=xe.document.selection;return ve.isCollapsed?[...ve.getSelectedBlocks()].length!==0&&![...ve.getSelectedBlocks()][0].isEmpty:!!xe.hasContent(ve.getFirstRange())}(t);const te=t.document.selection,be=this.editor.config.get("ai.aiAssistant.disabledElements");for(const xe of te.getRanges())for(const ve of xe.getItems())if(ve.is("element")&&be.includes(ve.name))return void(this.isEnabled=!1);this.isEnabled=!0}execute(t="",te="",be="custom"){this.editor.plugins.get(n$7).showUI(t,te,be)}};function K$3(Te,we){const t=new Set;for(const te of Te)(we||te.requiresContent===!1)&&t.add(te.id);return Array.from(t)}const X$3=new RegExp(/^(.*?)<[a-zA-Z][a-zA-Z0-9_\-.]*[ >]/,"is");let k$5=class extends ObservableMixin(){constructor(t,te,be){super();Re(this,"editor");Re(this,"textAdapter");Re(this,"view");Re(this,"_sanitizationContainer");Re(this,"_domParser");Re(this,"_xmlSerializer");this.editor=t,this.textAdapter=te,this._sanitizationContainer=document.createElement("div"),this._domParser=new DOMParser,this._xmlSerializer=new XMLSerializer,this.view=be,this.set({initialContext:"",currentContext:"",currentResponse:"",previousContext:void 0,previousQuery:void 0,previousLabel:void 0,isProcessing:!1}),this.on("set:currentContext",(xe,ve,ke)=>{this.view.value=this._sanitizeHTML(ke)}),this.listenTo(this.view,"submitPrompt",(xe,ve)=>{const ke=this.currentContext||this.initialContext;this._handleQuery(ve,ke,"custom")}),this.listenTo(this.view,"tryAgainEvent",()=>{this.view.prompt=this.previousLabel,this._handleQuery(this.previousQuery,this.previousContext,this.previousActionId,this.previousLabel)}),this.listenTo(this.view,"stopProcessing",()=>{this.stopProcessing()})}destroy(){this.stopListening()}async updateView({actionId:t,query:te,htmlContent:be,label:xe,mainActionLabel:ve}){this.view.prompt=xe,this.view.mainAction=ve,this.initialContext=be,te&&(this.view.isRendered?this._handleQuery(te,be,t,xe):this.view.once("render",()=>{this._handleQuery(te,be,t,xe)}))}stopProcessing(){this.isProcessing&&(this.isProcessing=!1,this.view.finishProcessing(),this.textAdapter.abort())}reset(){this.initialContext="",this.currentContext="",this.currentResponse="",this.previousContext="",this.previousQuery="",this.previousLabel="",this.previousActionId=void 0,this.view.reset(),this.stopProcessing()}async _handleQuery(t,te,be,xe){return this.isProcessing=!0,this.view.startProcessing(),this.previousContext=te,this.previousQuery=t,this.previousLabel=xe||t,this.previousActionId=be,new Promise(ve=>{this.textAdapter.makeRequest({query:t,context:te,onData:ke=>{this.currentResponse=ke,this.currentContext=this._parseAndNormalizeContent(this.currentResponse)},actionId:be}).then(()=>{!this.currentContext&&this.currentResponse&&(this.currentContext=this._parseAndNormalizeContent(this.currentResponse,!0))}).catch(ke=>{ke instanceof R$4?this.view.handleError(ke.message):this.view.handleError(),ve()}).finally(()=>{this.stopProcessing(),ve()})})}_parseAndNormalizeContent(t,te=!1){const be=X$3.exec(t);t=be?t.substring(be[1].length):t.length<100&&!te?"":this._stripMarkdownSyntax(t);const xe=this._domParser.parseFromString(t,"text/html");if(be){const ke=Array.from(xe.body.childNodes);ke.reverse();for(const Ie of ke){if(Ie.nodeType==Node.ELEMENT_NODE)break;Ie.remove()}}const ve=this.editor.data.processor.toView(this._xmlSerializer.serializeToString(xe.body));return this._isH1TagSupportEnabled()||this._normalizeResponseHeadings(ve),this.editor.data.stringify(this.editor.data.toModel(ve))}_normalizeResponseHeadings(t){const te=new UpcastWriter(this.editor.editing.view.document),be=new Matcher({name:/^h[1-5]$/}),xe=[];let ve=!1;for(const ke of t)ke.is("element")&&be.match(ke)&&(xe.push(ke),ke.name=="h1"&&(ve=!0));if(ve)for(const ke of xe)te.rename("h"+(parseInt(ke.name[1])+1),ke)}_isH1TagSupportEnabled(){const{data:t,editing:te}=this.editor,be=t.htmlProcessor.toView("<h1></h1>"),xe=t.toView(t.toModel(be));return!!te.view.domConverter.viewToDom(xe).querySelector("h1")}_sanitizeHTML(t){return this.editor.editing.view.domConverter.setContentOf(this._sanitizationContainer,t),this._sanitizationContainer.innerHTML}_stripMarkdownSyntax(t){const te=t.trim();return te.startsWith("```html")?te.endsWith("```")?te.substring(7,te.length-3):te.substring(7):t}};const E$3={REPLACE:"replace",INSERT:"insert"};let Tt$2=class extends ToolbarView{constructor(we){super(we),this.set("isVisible",!1),this.set("mainAction",E$3.REPLACE),this.replaceButton=this._createButton("","ck-button-action"),this.replaceButton.bind("label").to(this,"mainAction",te=>o$8(we,"AI_"+te.toUpperCase()+"_CONTENT")),this.insertButton=this._createButton(o$8(we,"Insert below")),this.tryAgainButton=this._createButton(o$8(we,"Try again")),this.stopButton=this._createButton(o$8(we,"Stop"));const t=this.bindTemplate;this.extendTemplate({attributes:{class:["ck-ai-form__toolbar",t.if("isVisible","ck-hidden",te=>!te)]}}),this.items.addMany([this.replaceButton,this.insertButton,this.tryAgainButton,this.stopButton])}_createButton(we,t){const te=new ButtonView(this.locale);return te.set({label:we,class:t||"",isVisible:!0,withText:!0}),te}};var ct$1='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M5 2.801a.7.7 0 0 0-.7.7v11.5a.8.8 0 0 1-1.6 0v-11.5a2.3 2.3 0 0 1 2.3-2.3h6.5a.8.8 0 0 1 0 1.6H5Zm.7 3.7a2.3 2.3 0 0 1 2.3-2.3h7a2.3 2.3 0 0 1 2.3 2.3v10a2.3 2.3 0 0 1-2.3 2.3H8a2.3 2.3 0 0 1-2.3-2.3v-10Zm2.3-.7a.7.7 0 0 0-.7.7v10a.7.7 0 0 0 .7.7h7a.7.7 0 0 0 .7-.7v-10a.7.7 0 0 0-.7-.7H8Z"/></svg>';let nt$2=class extends View{constructor(t,te=""){super(t);Re(this,"contentFieldView");Re(this,"copyButtonView");this.set({value:null,isVisible:!1,isProcessing:!1});const be=this.bindTemplate;this.contentFieldView=new gt$2(t,te),this.copyButtonView=this._createCopyButton(),this.setTemplate({tag:"div",attributes:{class:["ck","ck-ai-form__content-area-wrapper",be.if("isVisible","ck-hidden",xe=>!xe)],tabindex:"-1"},children:[{tag:"div",attributes:{class:["ck","ck-ai-form__content-area",be.if("isProcessing","ck-ai-form__content-area--processing")]},children:[this.contentFieldView,{tag:"div",attributes:{class:["ck","ck-ai-form__copy-button-wrapper"]},children:[this.copyButtonView]}]}]})}render(){super.render(),this.value&&this.contentFieldView.setContent(this.value);let t=!1;this.on("change:value",(te,be,xe)=>{const ve=!this.contentFieldView.element.querySelector(".ck-ai-form__loader");this.contentFieldView.setContent(xe),this.isProcessing&&ve&&!t&&this.element.scrollTo({top:this.element.scrollHeight,behavior:"smooth"})}),this.on("change:isProcessing",(te,be,xe)=>{t=!1,xe?(this.value=null,this.contentFieldView.appendLoader()):this.value||this.contentFieldView.setContent("")}),this.listenTo(this.element,"wheel",()=>{t=!0}),this.listenTo(this.element,"mousedown",()=>{t=!0})}focus(){this.element.focus()}_createCopyButton(){const t=this.locale,te=new ButtonView(this.locale),be="ck-ai-form__copy-button";return te.set({label:o$8(t,"Copy"),icon:ct$1,class:be,tooltip:!0}),te.bind("isVisible").to(this,"value",xe=>!!xe),te.bind("isEnabled").to(this,"isProcessing",xe=>!xe),te.on("execute",()=>{this._copyHTMLToClipboard(this.contentFieldView.element),te.icon=icons.check,te.class=be+" ck-ai-form__copy-button--copied",this.focus(),setTimeout(()=>{te.icon=ct$1,te.class=be},1e3)}),te}_copyHTMLToClipboard(t){const{window:te,document:be}=global;if(te.ClipboardItem){const{Blob:xe,ClipboardItem:ve}=te,ke=[new ve({"text/html":new xe([t.innerHTML],{type:"text/html"}),"text/plain":new xe([t.textContent||""],{type:"text/plain"})})];navigator.clipboard.write(ke)}else{const xe=be.createElement("div");xe.style.position="absolute",xe.style.left="-9999px",xe.innerHTML="<span>[</span>"+t.innerHTML+"<span>]</span>",be.body.appendChild(xe);const ve=be.createRange();ve.setStartAfter(xe.firstElementChild),ve.setEndBefore(xe.lastElementChild);const ke=te.getSelection();ke.removeAllRanges(),ke.addRange(ve),be.execCommand("copy"),xe.remove()}}},gt$2=class extends View{constructor(we,t=""){super(we),this.loaderView=this._createLoader(),this.setTemplate({tag:"div",attributes:{class:["ck","ck-content",t,"ck-reset_all-excluded","ck-ai-form__content-field"]}})}setContent(we){this.element.innerHTML=we}appendLoader(){this.element.appendChild(this.loaderView.element)}_createLoader(){const we=new View,t=this.locale,te=new SpinnerView;return te.isVisible=!0,we.setTemplate({tag:"div",attributes:{class:["ck","ck-ai-form__loader"]},children:[te,{text:o$8(t,"AI is writing...")}]}),we.render(),we}},mt$1=class extends View{constructor(we,t=""){super(we);const te=new IconView,be=this.bindTemplate;this.set("text",t),te.content=`<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path clip-rule="evenodd" d="M9.9 4.385a1.2 1.2 0 0 0-.44.44h.002l-5.284 9.15a1.2 1.2 0 0 0 1.04 1.8h10.564a1.2 1.2 0 0 0 1.04-1.8l-5.282-9.15a1.2 1.2 0 0 0-1.64-.44Zm.05 8.363a.301.301 0 0 1 .115-.023h.9a.301.301 0 0 1 .3.3v.9a.3.3 0 0 1-.3.3h-.9a.3.3 0 0 1-.3-.3v-.9a.3.3 0 0 1 .185-.277Zm-.185-4.723a.3.3 0 0 1 .3-.3h.9a.3.3 0 0 1 .3.3v3.4a.3.3 0 0 1-.3.3h-.9a.301.301 0 0 1-.3-.3v-3.4Z"/></svg>
`,this.setTemplate({tag:"div",attributes:{class:["ck","ck-ai-form__error"]},children:[te,{text:be.to("text")}]})}},pt$1=class extends AutocompleteView{constructor(t,te){super(t,te);Re(this,"submitButtonView");Re(this,"showHistoryButtonView");this.queryView.fieldView.minRows=1,this.queryView.fieldView.maxRows=3,this.submitButtonView=this._createSubmitButton(),this.showHistoryButtonView=this._createShowHistoryButton(),this.focusableChildren.add(this.showHistoryButtonView,1),this.focusableChildren.add(this.submitButtonView)}render(){super.render(),this.queryView.fieldWrapperChildren.add(this.showHistoryButtonView),this.children.add(this.submitButtonView),this.keystrokes.set("enter",(t,te)=>{t.target==this.queryView.fieldView.element&&(this.submit(),te())})}_createSubmitButton(){const t=new ButtonView(this.locale),te=this.locale;return t.set({icon:'<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M15.875 4.419a.75.75 0 0 0-1.5 0v7.25H6.818l2.33-1.955a.75.75 0 0 0-.963-1.15l-3.792 3.182a.75.75 0 0 0-.17.945c.046.11.118.208.21.284l3.788 3.18a.75.75 0 1 0 .965-1.149l-2.19-1.837h7.629c.69 0 1.25-.56 1.25-1.25v-7.5Z"/></svg>',label:o$8(te,"Submit"),isVisible:!0,tooltip:!0,class:"ck-ai-form__submit"}),t.on("execute",()=>{this.submit()}),t.bind("isEnabled").to(this.queryView.fieldView,"isEmpty",this,"isEnabled",(be,xe)=>!be&&xe),t}_createShowHistoryButton(){const t=new ButtonView(this.locale),te=this.resultsView,be=this.locale;t.set({label:o$8(be,"History"),withText:!1,icon:icons.history,tooltip:!0,tooltipPosition:"sw",class:"ck-ai-form__toggle-history"}),t.bind("isOn").to(te,"isVisible"),t.bind("isEnabled").to(this,"isEnabled"),t.on("execute",()=>{te.isVisible=!te.isVisible,te.isVisible?this.filteredView.focus():this.focus()});const xe=()=>{global.window.requestAnimationFrame(()=>{if(isVisible(this.element)){const ve=new Rect(this.queryView.fieldView.element),ke=ve.width,Ie=be.uiLanguageDirection==="rtl"?"left":"right";ve.excludeScrollbarsAndBorders(),t.element.style[Ie]=ke-ve.width+1+"px"}})};return this.queryView.fieldView.on("update",xe),this.on("render",xe),t}submit(){const t=this.queryView.fieldView.element.value;this.fire("submit",t)}focus(t){t===-1?this.focusCycler.focusLast():this.focusCycler.focusFirst()}},rs$1=class extends ListView{constructor(t){super(t);Re(this,"historyGroupView");Re(this,"clearHistoryButton");this.clearHistoryButton=this._createClearHistoryButton(),this.historyGroupView=new ListItemGroupView,this.historyGroupView.children.add(this.clearHistoryButton,1),this.historyGroupView.label=o$8(t,"Prompt history"),this.historyGroupView.items.delegate("execute").to(this),this.items.add(this.historyGroupView)}filter(){let t=0;for(const te of this.items)t+=te.items.length;return{resultsCount:t,totalItemsCount:t}}_createClearHistoryButton(){const t=this.locale,te=new ButtonView(this.locale);return te.set({label:"("+o$8(t,"Clear")+")",withText:!0}),te.on("execute",()=>this.fire("clearHistory")),te}},N$2=class extends HighlightedTextView{constructor(){super(),this.set({style:void 0,text:void 0,id:void 0});const we=this.bindTemplate;this.extendTemplate({attributes:{class:["ck-button__label"],style:we.to("style"),id:we.to("id")}})}};class hs extends ListItemView{constructor(we){super();const t=new N$2,te=new ButtonView(this.locale,t);this.children.add(te),te.set({label:we.prompt,withText:!0}),te.on("execute",()=>{this.fire("execute",{value:unescape$2(we.prompt)})})}}const cs="CKEditor/AIFormView/PromptHistory";class os extends Collection{constructor(){super(),this._loadFromSessionStorage(),this.on("add",(we,t)=>{const te=Ss(t.prompt);for(const be of this)if(be!=t&&Ss(be.prompt)===te){this.remove(be);break}this.length>20&&this.remove(this.last),this._saveToSessionStorage()}),this.on("remove",()=>{this._saveToSessionStorage()})}_loadFromSessionStorage(){const we=sessionStorage.getItem(cs)||"[]";this.addMany(JSON.parse(we))}_saveToSessionStorage(){sessionStorage.setItem(cs,JSON.stringify(this.map(we=>we)))}}function Ss(Te){return Te.toLowerCase().trim()}let x$5=class extends View{constructor(t,te,be=""){super(t);Re(this,"focusTracker");Re(this,"keystrokes");Re(this,"contentArea");Re(this,"toolbar");Re(this,"promptView");Re(this,"errorView");Re(this,"_focusables");Re(this,"focusCycler");Re(this,"_promptHistory");this.set("isEnabled",!0),this.set("isProcessing",!1),this.set("prompt",""),this.set("value",""),this.set("isError",!1),this.set("mainAction",E$3.REPLACE),this._promptHistory=new os,this.errorView=new mt$1(t),this.contentArea=new nt$2(t,be),this.contentArea.bind("isProcessing").to(this),this.contentArea.bind("value").to(this),this.toolbar=this._createToolbar(),this.toolbar.bind("mainAction").to(this),this.promptView=this._createPromptView(),this.focusTracker=new FocusTracker,this.keystrokes=new KeystrokeHandler,this._focusables=this.createCollection([this.contentArea,this.contentArea.copyButtonView,this.toolbar,this.promptView]),this.focusCycler=new FocusCycler({focusables:this._focusables,focusTracker:this.focusTracker,keystrokeHandler:this.keystrokes,actions:{focusPrevious:"shift + tab",focusNext:"tab"}}),this.promptView.focusCycler.on("forwardCycle",ve=>{this.focusCycler.focusNext(),ve.stop()}),this.promptView.focusCycler.on("backwardCycle",ve=>{this.focusCycler.focusPrevious(),ve.stop()}),this.promptView.queryView.fieldView.bind("value").to(this,"prompt");const xe=this.bindTemplate;this.setTemplate({tag:"div",attributes:{class:["ck","ck-ai-form",te],tabindex:"-1"},children:[{tag:"div",attributes:{class:["ck","ck-ai-form-content"]},children:[{tag:"div",attributes:{class:[xe.if("isError","ck-hidden",ve=>!ve)]},children:[this.errorView]},this.contentArea,this.toolbar,this.promptView]}]})}render(){super.render(),this.focusTracker.add(this.contentArea.element),this.focusTracker.add(this.contentArea.copyButtonView.element),this.focusTracker.add(this.toolbar.element),this.focusTracker.add(this.promptView.element),this.keystrokes.listenTo(this.element)}focus(t=1){t===-1?this.focusCycler.focusLast():this.focusCycler.focusFirst()}reset(){this.prompt="",this.value="",this.isError=!1,this.promptView.reset(),this.contentArea.isVisible=!1,this.toolbar.isVisible=!1}_createPromptView(){const t=this.locale,te=new pt$1(t,{queryView:{label:o$8(t,"Ask AI to edit or generate"),creator:createLabeledTextarea,showIcon:!1,showResetButton:!1},infoView:{text:{noSearchableItems:{primary:o$8(t,"Empty history"),secondary:o$8(t,"Ask AI and your prompts will be listed here for you to use later.")}}},filteredView:this._createHistoryView(),queryMinChars:1/0,resetOnBlur:!1});return te.bind("isEnabled").to(this,"isEnabled",this,"isProcessing",(be,xe)=>be&&!xe),this.listenTo(te,"submit",(be,xe)=>{this.prompt=xe;const ve=escape$1(xe);this.fire("submitPrompt",ve),xe.trim()&&this._promptHistory.add({prompt:ve},0)},{priority:"high"}),te}_createHistoryView(){const t=new rs$1(this.locale);return t.historyGroupView.items.bindTo(this._promptHistory).as(hs),t.on("clearHistory",()=>{this._promptHistory.clear(),this.promptView.search(""),this.promptView.focus()}),t}_createToolbar(){const t=new Tt$2(this.locale);return t.replaceButton.bind("isEnabled").to(this,"isEnabled",this,"isProcessing",this,"value",(te,be,xe)=>te&&!be&&!!xe),t.replaceButton.delegate("execute").to(this,"replaceContent"),t.insertButton.bind("isEnabled").to(this,"isEnabled",this,"isProcessing",this,"value",(te,be,xe)=>te&&!be&&!!xe),t.insertButton.delegate("execute").to(this,"insertContentBelow"),t.tryAgainButton.bind("isEnabled").to(this,"isEnabled",this,"isProcessing",(te,be)=>te&&!be),t.tryAgainButton.delegate("execute").to(this,"tryAgainEvent"),t.stopButton.bind("isEnabled").to(this,"isProcessing"),t.stopButton.delegate("execute").to(this,"stopProcessing"),t}startProcessing(){this.value="",this.isError=!1,this.isProcessing=!0,this.contentArea.isVisible=!0,this.toolbar.isVisible=!0,this.contentArea.focus()}finishProcessing(){const t=this.locale;this.isProcessing=!1,this.prompt="",this.promptView.reset(),this.value&&(this.promptView.queryView.label=o$8(t,"Ask AI to improve generated text"))}handleError(t){const te=this.locale;this.finishProcessing(),this.isError=!0,this.errorView.text=t||o$8(te,"AI_ERROR_FAILED"),this.value||(this.contentArea.isVisible=!1)}},U$1=class extends ListView{constructor(we){super(we),this.role="listbox",this.set("enabledCommandsIds",[]),this.on("change:enabledCommandsIds",()=>{for(const t of this.items)if(t instanceof ListItemGroupView){for(const te of t.items)if(te instanceof $$2){const be=te.children.get(0);this.enabledCommandsIds.includes(te.commandDefinition.id)?be.isEnabled=!0:be.isEnabled=!1}}})}filter(we){let t=0,te=0;for(const be of this.items){const xe=be,ve=xe.items,ke=we&&!!xe.label.match(we);xe.labelView.highlightText(ke?we:null);for(const Ae of ve){const Se=Ae.children.first,Oe=Se.labelView;if(we){const Ve=!!Se.label.match(we);Oe.highlightText(Ve?we:null),Ae.isVisible=ke||Ve}else Ae.isVisible=!0,Oe.highlightText(null)}const Ie=ve.filter(Ae=>Ae.isVisible).length;t+=xe.items.length,te+=ke?xe.items.length:Ie,xe.isVisible=ke||!!Ie}return{resultsCount:te,totalItemsCount:t}}},S$3=class extends HighlightedTextView{constructor(){super();Re(this,"id");this.set("for",void 0);const t=this.bindTemplate;this.id="ck-editor__label_"+uid(),this.extendTemplate({attributes:{class:["ck","ck-label"],id:this.id,for:t.to("for")}})}};var L$3='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M15.346 9.422a.151.151 0 0 1 .284 0l.548 1.484a.152.152 0 0 0 .09.089l1.483.549a.151.151 0 0 1 0 .284l-1.483.548a.151.151 0 0 0-.09.09l-.548 1.483a.152.152 0 0 1-.142.1.151.151 0 0 1-.142-.1l-.549-1.483a.15.15 0 0 0-.09-.09l-1.483-.548a.15.15 0 0 1 0-.284l1.484-.549a.152.152 0 0 0 .089-.09l.549-1.483Z"/><path d="M16.306 1.742a.151.151 0 0 1 .284 0l.549 1.483a.15.15 0 0 0 .089.09l1.483.548a.151.151 0 0 1 .072.229.151.151 0 0 1-.072.055l-1.483.549a.15.15 0 0 0-.09.09l-.548 1.482a.151.151 0 0 1-.284 0l-.549-1.483a.15.15 0 0 0-.09-.09l-1.483-.548a.151.151 0 0 1 0-.284l1.484-.549a.152.152 0 0 0 .09-.089l.548-1.483Z"/><path d="M7.665 1.742a.151.151 0 0 1 .284 0l.549 1.483a.151.151 0 0 0 .09.09l1.482.548a.151.151 0 0 1 .072.229.151.151 0 0 1-.072.055l-1.483.549a.151.151 0 0 0-.09.09L7.95 6.267a.151.151 0 0 1-.284 0l-.549-1.483a.151.151 0 0 0-.089-.09l-1.483-.548a.151.151 0 0 1 0-.284l1.483-.549a.151.151 0 0 0 .09-.089l.548-1.483-.001.001Z"/><path d="M14.72 7.946a.848.848 0 0 0 .25-.591.824.824 0 0 0-.241-.588l-1.943-1.938a.812.812 0 0 0-.588-.241.838.838 0 0 0-.591.25l-1.545 1.539 3.115 3.115 1.542-1.546h.001Z"/><path clip-rule="evenodd" d="M1.19 15.636a.96.96 0 0 1 .281-.679l7.835-7.834 3.121 3.12-7.834 7.835a.959.959 0 0 1-1.358 0l-1.764-1.764a.96.96 0 0 1-.28-.678Zm9.22-5.391-1.121-1.12-6.479 6.478 1.121 1.121 6.479-6.479Z"/></svg>';const T$3=globalThis.DataTransfer;let n$7=class extends Plugin{constructor(t){super(t);Re(this,"_dialog");Re(this,"_formView");Re(this,"_aiAdapter");Re(this,"_aiAssistantController");Re(this,"_uiCssClasses","");t.config.define("ai.aiAssistant.disabledElements",["media","rawHtml","tableOfContents"]),t.config.define("ai.aiAssistant.contentAreaCssClass",""),t.config.define("ai.useTheme",!0),this._uiCssClasses="ck-ai-assistant-ui"+(t.config.get("ai.useTheme")?" ck-ai-assistant-ui_theme":"")}static get pluginName(){return"AIAssistantUI"}static get requires(){return[ClipboardMarkersUtils,i$9,y$7,Dialog]}init(){const{editor:t}=this,{t:te}=t;this._aiAdapter=t.plugins.get(y$7),this._dialog=t.plugins.get(Dialog),this._formView=null,t.commands.add("showAIAssistant",new j$3(t,t.config.get("ai.aiAssistant.commands")));const be=t.commands.get("showAIAssistant"),xe=t.plugins.get(i$9),ve=(ke,Ie,Ae,Se)=>{const Oe=t.model.document.selection;if(Se&&Oe.isCollapsed){const Ve=first(Oe.getSelectedBlocks())||t.model.schema.getLimitElement(Oe);t.model.change(Me=>{Me.setSelection(Ve,"in")})}xe.showFakeVisualSelection(),be.execute(ke,Ie,"command:"+Ae)};t.ui.componentFactory.add("aiCommands",ke=>{const Ie=createDropdown(ke),Ae=_$3(t,ve),Se=new SearchTextView(ke,{filteredView:Ae,queryView:{label:o$8(ke,"Search AI command")},class:"ck-ai-commands-search",infoView:{text:{notFound:{primary:o$8(ke,"No commands found")},noSearchableItems:{primary:o$8(ke,"No commands available")}}}});return Se.on("search",(Oe,Ve)=>{Ve.query&&Ve.query.length&&t.ui.ariaLiveAnnouncer.announce(te("%0 commands found",Ve.resultsCount))}),Ie.set({class:"ck-ai-commands-dropdown "+this._uiCssClasses}),Ie.bind("isEnabled").to(Ae,"enabledCommandsIds",Oe=>Oe.length>0),Ie.panelView.children.add(Se),Ie.buttonView.set({label:o$8(ke,"AI Commands"),icon:L$3,tooltip:!0}),Ie.on("change:isOpen",(Oe,Ve,Me)=>{Me?(Se.reset(),xe.showFakeVisualSelection(!0),Ae.element.scrollTo(0,0)):xe.hideFakeVisualSelection(!0)}),Ie}),t.ui.componentFactory.add("menuBar:aiCommands",ke=>{const Ie=new MenuBarMenuView(ke),Ae=_$3(t,ve);Ie.buttonView.set({label:o$8(ke,"AI Commands"),icon:L$3}),Ie.bind("isEnabled").to(Ae,"enabledCommandsIds",Oe=>Oe.length>0);const Se=new MenuBarMenuListView(ke);return H$3(t,t.config.get("ai.aiAssistant.commands")).map(({groupId:Oe,groupLabel:Ve,commands:Me})=>{const De=new MenuBarMenuListItemView(ke,Ie),Fe=new MenuBarMenuView(ke),Be=new MenuBarMenuListView(ke),$e=H$3(t,Me).map(Ue=>{const He=new MenuBarMenuListItemView(ke,Fe),ze=new MenuBarMenuListItemButtonView(ke);return ze.set({label:Ue.label}),ze.delegate("execute").to(Fe),ze.on("execute",()=>{ve(Ue.prompt,Ue.label,Ue.id,Ue.requiresContent===void 0||Ue.requiresContent)}),He.children.add(ze),He});Fe.buttonView.set({label:Ve||Oe}),Fe.delegate("execute").to(Ie),Be.items.addMany($e),Fe.panelView.children.add(Be),De.children.add(Fe),Se.items.add(De)}),Ie.panelView.children.add(Se),Ie}),t.ui.componentFactory.add("aiAssistant",()=>{const ke=this._createAIAssistantUIButton(ButtonView);return ke.set({tooltip:!0,class:"ck-ai-assistant-button "+this._uiCssClasses}),ke}),t.ui.componentFactory.add("menuBar:aiAssistant",()=>this._createAIAssistantUIButton(MenuBarMenuListItemButtonView))}afterInit(){(function(t){function te(xe,ve,ke){const Ie={};Ie[be([110,117,109,98,101,114,79,102,82,111,117,110,100,115])]={16:10,24:12,32:14},Ie[be([114,99,111,110])]=[1,2,4,8,16,32,64,128,27,54,108,216,171,77,154,47,94,188,99,198,151,53,106,212,179,125,250,239,197,145],Ie[be([83])]=[99,124,119,123,242,107,111,197,48,1,103,43,254,215,171,118,202,130,201,125,250,89,71,240,173,212,162,175,156,164,114,192,183,253,147,38,54,63,247,204,52,165,229,241,113,216,49,21,4,199,35,195,24,150,5,154,7,18,128,226,235,39,178,117,9,131,44,26,27,110,90,160,82,59,214,179,41,227,47,132,83,209,0,237,32,252,177,91,106,203,190,57,74,76,88,207,208,239,170,251,67,77,51,133,69,249,2,127,80,60,159,168,81,163,64,143,146,157,56,245,188,182,218,33,16,255,243,210,205,12,19,236,95,151,68,23,196,167,126,61,100,93,25,115,96,129,79,220,34,42,144,136,70,238,184,20,222,94,11,219,224,50,58,10,73,6,36,92,194,211,172,98,145,149,228,121,231,200,55,109,141,213,78,169,108,86,244,234,101,122,174,8,186,120,37,46,28,166,180,198,232,221,116,31,75,189,139,138,112,62,181,102,72,3,246,14,97,53,87,185,134,193,29,158,225,248,152,17,105,217,142,148,155,30,135,233,206,85,40,223,140,161,137,13,191,230,66,104,65,153,45,15,176,84,187,22],Ie[be([84,49])]=[3328402341,4168907908,4000806809,4135287693,4294111757,3597364157,3731845041,2445657428,1613770832,33620227,3462883241,1445669757,3892248089,3050821474,1303096294,3967186586,2412431941,528646813,2311702848,4202528135,4026202645,2992200171,2387036105,4226871307,1101901292,3017069671,1604494077,1169141738,597466303,1403299063,3832705686,2613100635,1974974402,3791519004,1033081774,1277568618,1815492186,2118074177,4126668546,2211236943,1748251740,1369810420,3521504564,4193382664,3799085459,2883115123,1647391059,706024767,134480908,2512897874,1176707941,2646852446,806885416,932615841,168101135,798661301,235341577,605164086,461406363,3756188221,3454790438,1311188841,2142417613,3933566367,302582043,495158174,1479289972,874125870,907746093,3698224818,3025820398,1537253627,2756858614,1983593293,3084310113,2108928974,1378429307,3722699582,1580150641,327451799,2790478837,3117535592,0,3253595436,1075847264,3825007647,2041688520,3059440621,3563743934,2378943302,1740553945,1916352843,2487896798,2555137236,2958579944,2244988746,3151024235,3320835882,1336584933,3992714006,2252555205,2588757463,1714631509,293963156,2319795663,3925473552,67240454,4269768577,2689618160,2017213508,631218106,1269344483,2723238387,1571005438,2151694528,93294474,1066570413,563977660,1882732616,4059428100,1673313503,2008463041,2950355573,1109467491,537923632,3858759450,4260623118,3218264685,2177748300,403442708,638784309,3287084079,3193921505,899127202,2286175436,773265209,2479146071,1437050866,4236148354,2050833735,3362022572,3126681063,840505643,3866325909,3227541664,427917720,2655997905,2749160575,1143087718,1412049534,999329963,193497219,2353415882,3354324521,1807268051,672404540,2816401017,3160301282,369822493,2916866934,3688947771,1681011286,1949973070,336202270,2454276571,201721354,1210328172,3093060836,2680341085,3184776046,1135389935,3294782118,965841320,831886756,3554993207,4068047243,3588745010,2345191491,1849112409,3664604599,26054028,2983581028,2622377682,1235855840,3630984372,2891339514,4092916743,3488279077,3395642799,4101667470,1202630377,268961816,1874508501,4034427016,1243948399,1546530418,941366308,1470539505,1941222599,2546386513,3421038627,2715671932,3899946140,1042226977,2521517021,1639824860,227249030,260737669,3765465232,2084453954,1907733956,3429263018,2420656344,100860677,4160157185,470683154,3261161891,1781871967,2924959737,1773779408,394692241,2579611992,974986535,664706745,3655459128,3958962195,731420851,571543859,3530123707,2849626480,126783113,865375399,765172662,1008606754,361203602,3387549984,2278477385,2857719295,1344809080,2782912378,59542671,1503764984,160008576,437062935,1707065306,3622233649,2218934982,3496503480,2185314755,697932208,1512910199,504303377,2075177163,2824099068,1841019862,739644986],Ie[be([84,50])]=[2781242211,2230877308,2582542199,2381740923,234877682,3184946027,2984144751,1418839493,1348481072,50462977,2848876391,2102799147,434634494,1656084439,3863849899,2599188086,1167051466,2636087938,1082771913,2281340285,368048890,3954334041,3381544775,201060592,3963727277,1739838676,4250903202,3930435503,3206782108,4149453988,2531553906,1536934080,3262494647,484572669,2923271059,1783375398,1517041206,1098792767,49674231,1334037708,1550332980,4098991525,886171109,150598129,2481090929,1940642008,1398944049,1059722517,201851908,1385547719,1699095331,1587397571,674240536,2704774806,252314885,3039795866,151914247,908333586,2602270848,1038082786,651029483,1766729511,3447698098,2682942837,454166793,2652734339,1951935532,775166490,758520603,3000790638,4004797018,4217086112,4137964114,1299594043,1639438038,3464344499,2068982057,1054729187,1901997871,2534638724,4121318227,1757008337,0,750906861,1614815264,535035132,3363418545,3988151131,3201591914,1183697867,3647454910,1265776953,3734260298,3566750796,3903871064,1250283471,1807470800,717615087,3847203498,384695291,3313910595,3617213773,1432761139,2484176261,3481945413,283769337,100925954,2180939647,4037038160,1148730428,3123027871,3813386408,4087501137,4267549603,3229630528,2315620239,2906624658,3156319645,1215313976,82966005,3747855548,3245848246,1974459098,1665278241,807407632,451280895,251524083,1841287890,1283575245,337120268,891687699,801369324,3787349855,2721421207,3431482436,959321879,1469301956,4065699751,2197585534,1199193405,2898814052,3887750493,724703513,2514908019,2696962144,2551808385,3516813135,2141445340,1715741218,2119445034,2872807568,2198571144,3398190662,700968686,3547052216,1009259540,2041044702,3803995742,487983883,1991105499,1004265696,1449407026,1316239930,504629770,3683797321,168560134,1816667172,3837287516,1570751170,1857934291,4014189740,2797888098,2822345105,2754712981,936633572,2347923833,852879335,1133234376,1500395319,3084545389,2348912013,1689376213,3533459022,3762923945,3034082412,4205598294,133428468,634383082,2949277029,2398386810,3913789102,403703816,3580869306,2297460856,1867130149,1918643758,607656988,4049053350,3346248884,1368901318,600565992,2090982877,2632479860,557719327,3717614411,3697393085,2249034635,2232388234,2430627952,1115438654,3295786421,2865522278,3633334344,84280067,33027830,303828494,2747425121,1600795957,4188952407,3496589753,2434238086,1486471617,658119965,3106381470,953803233,334231800,3005978776,857870609,3151128937,1890179545,2298973838,2805175444,3056442267,574365214,2450884487,550103529,1233637070,4289353045,2018519080,2057691103,2399374476,4166623649,2148108681,387583245,3664101311,836232934,3330556482,3100665960,3280093505,2955516313,2002398509,287182607,3413881008,4238890068,3597515707,975967766],Ie[be([84,51])]=[1671808611,2089089148,2006576759,2072901243,4061003762,1807603307,1873927791,3310653893,810573872,16974337,1739181671,729634347,4263110654,3613570519,2883997099,1989864566,3393556426,2191335298,3376449993,2106063485,4195741690,1508618841,1204391495,4027317232,2917941677,3563566036,2734514082,2951366063,2629772188,2767672228,1922491506,3227229120,3082974647,4246528509,2477669779,644500518,911895606,1061256767,4144166391,3427763148,878471220,2784252325,3845444069,4043897329,1905517169,3631459288,827548209,356461077,67897348,3344078279,593839651,3277757891,405286936,2527147926,84871685,2595565466,118033927,305538066,2157648768,3795705826,3945188843,661212711,2999812018,1973414517,152769033,2208177539,745822252,439235610,455947803,1857215598,1525593178,2700827552,1391895634,994932283,3596728278,3016654259,695947817,3812548067,795958831,2224493444,1408607827,3513301457,0,3979133421,543178784,4229948412,2982705585,1542305371,1790891114,3410398667,3201918910,961245753,1256100938,1289001036,1491644504,3477767631,3496721360,4012557807,2867154858,4212583931,1137018435,1305975373,861234739,2241073541,1171229253,4178635257,33948674,2139225727,1357946960,1011120188,2679776671,2833468328,1374921297,2751356323,1086357568,2408187279,2460827538,2646352285,944271416,4110742005,3168756668,3066132406,3665145818,560153121,271589392,4279952895,4077846003,3530407890,3444343245,202643468,322250259,3962553324,1608629855,2543990167,1154254916,389623319,3294073796,2817676711,2122513534,1028094525,1689045092,1575467613,422261273,1939203699,1621147744,2174228865,1339137615,3699352540,577127458,712922154,2427141008,2290289544,1187679302,3995715566,3100863416,339486740,3732514782,1591917662,186455563,3681988059,3762019296,844522546,978220090,169743370,1239126601,101321734,611076132,1558493276,3260915650,3547250131,2901361580,1655096418,2443721105,2510565781,3828863972,2039214713,3878868455,3359869896,928607799,1840765549,2374762893,3580146133,1322425422,2850048425,1823791212,1459268694,4094161908,3928346602,1706019429,2056189050,2934523822,135794696,3134549946,2022240376,628050469,779246638,472135708,2800834470,3032970164,3327236038,3894660072,3715932637,1956440180,522272287,1272813131,3185336765,2340818315,2323976074,1888542832,1044544574,3049550261,1722469478,1222152264,50660867,4127324150,236067854,1638122081,895445557,1475980887,3117443513,2257655686,3243809217,489110045,2662934430,3778599393,4162055160,2561878936,288563729,1773916777,3648039385,2391345038,2493985684,2612407707,505560094,2274497927,3911240169,3460925390,1442818645,678973480,3749357023,2358182796,2717407649,2306869641,219617805,3218761151,3862026214,1120306242,1756942440,1103331905,2578459033,762796589,252780047,2966125488,1425844308,3151392187,372911126],Ie[be([84,52])]=[1667474886,2088535288,2004326894,2071694838,4075949567,1802223062,1869591006,3318043793,808472672,16843522,1734846926,724270422,4278065639,3621216949,2880169549,1987484396,3402253711,2189597983,3385409673,2105378810,4210693615,1499065266,1195886990,4042263547,2913856577,3570689971,2728590687,2947541573,2627518243,2762274643,1920112356,3233831835,3082273397,4261223649,2475929149,640051788,909531756,1061110142,4160160501,3435941763,875846760,2779116625,3857003729,4059105529,1903268834,3638064043,825316194,353713962,67374088,3351728789,589522246,3284360861,404236336,2526454071,84217610,2593830191,117901582,303183396,2155911963,3806477791,3958056653,656894286,2998062463,1970642922,151591698,2206440989,741110872,437923380,454765878,1852748508,1515908788,2694904667,1381168804,993742198,3604373943,3014905469,690584402,3823320797,791638366,2223281939,1398011302,3520161977,0,3991743681,538992704,4244381667,2981218425,1532751286,1785380564,3419096717,3200178535,960056178,1246420628,1280103576,1482221744,3486468741,3503319995,4025428677,2863326543,4227536621,1128514950,1296947098,859002214,2240123921,1162203018,4193849577,33687044,2139062782,1347481760,1010582648,2678045221,2829640523,1364325282,2745433693,1077985408,2408548869,2459086143,2644360225,943212656,4126475505,3166494563,3065430391,3671750063,555836226,269496352,4294908645,4092792573,3537006015,3452783745,202118168,320025894,3974901699,1600119230,2543297077,1145359496,387397934,3301201811,2812801621,2122220284,1027426170,1684319432,1566435258,421079858,1936954854,1616945344,2172753945,1330631070,3705438115,572679748,707427924,2425400123,2290647819,1179044492,4008585671,3099120491,336870440,3739122087,1583276732,185277718,3688593069,3772791771,842159716,976899700,168435220,1229577106,101059084,606366792,1549591736,3267517855,3553849021,2897014595,1650632388,2442242105,2509612081,3840161747,2038008818,3890688725,3368567691,926374254,1835907034,2374863873,3587531953,1313788572,2846482505,1819063512,1448540844,4109633523,3941213647,1701162954,2054852340,2930698567,134748176,3132806511,2021165296,623210314,774795868,471606328,2795958615,3031746419,3334885783,3907527627,3722280097,1953799400,522133822,1263263126,3183336545,2341176845,2324333839,1886425312,1044267644,3048588401,1718004428,1212733584,50529542,4143317495,235803164,1633788866,892690282,1465383342,3115962473,2256965911,3250673817,488449850,2661202215,3789633753,4177007595,2560144171,286339874,1768537042,3654906025,2391705863,2492770099,2610673197,505291324,2273808917,3924369609,3469625735,1431699370,673740880,3755965093,2358021891,2711746649,2307489801,218961690,3217021541,3873845719,1111672452,1751693520,1094828930,2576986153,757954394,252645662,2964376443,1414855848,3149649517,370555436],Ie[be([85,49])]=[0,235474187,470948374,303765277,941896748,908933415,607530554,708780849,1883793496,2118214995,1817866830,1649639237,1215061108,1181045119,1417561698,1517767529,3767586992,4003061179,4236429990,4069246893,3635733660,3602770327,3299278474,3400528769,2430122216,2664543715,2362090238,2193862645,2835123396,2801107407,3035535058,3135740889,3678124923,3576870512,3341394285,3374361702,3810496343,3977675356,4279080257,4043610186,2876494627,2776292904,3076639029,3110650942,2472011535,2640243204,2403728665,2169303058,1001089995,899835584,666464733,699432150,59727847,226906860,530400753,294930682,1273168787,1172967064,1475418501,1509430414,1942435775,2110667444,1876241833,1641816226,2910219766,2743034109,2976151520,3211623147,2505202138,2606453969,2302690252,2269728455,3711829422,3543599269,3240894392,3475313331,3843699074,3943906441,4178062228,4144047775,1306967366,1139781709,1374988112,1610459739,1975683434,2076935265,1775276924,1742315127,1034867998,866637845,566021896,800440835,92987698,193195065,429456164,395441711,1984812685,2017778566,1784663195,1683407248,1315562145,1080094634,1383856311,1551037884,101039829,135050206,437757123,337553864,1042385657,807962610,573804783,742039012,2531067453,2564033334,2328828971,2227573024,2935566865,2700099354,3001755655,3168937228,3868552805,3902563182,4203181171,4102977912,3736164937,3501741890,3265478751,3433712980,1106041591,1340463100,1576976609,1408749034,2043211483,2009195472,1708848333,1809054150,832877231,1068351396,766945465,599762354,159417987,126454664,361929877,463180190,2709260871,2943682380,3178106961,3009879386,2572697195,2538681184,2236228733,2336434550,3509871135,3745345300,3441850377,3274667266,3910161971,3877198648,4110568485,4211818798,2597806476,2497604743,2261089178,2295101073,2733856160,2902087851,3202437046,2968011453,3936291284,3835036895,4136440770,4169408201,3535486456,3702665459,3467192302,3231722213,2051518780,1951317047,1716890410,1750902305,1113818384,1282050075,1584504582,1350078989,168810852,67556463,371049330,404016761,841739592,1008918595,775550814,540080725,3969562369,3801332234,4035489047,4269907996,3569255213,3669462566,3366754619,3332740144,2631065433,2463879762,2160117071,2395588676,2767645557,2868897406,3102011747,3069049960,202008497,33778362,270040487,504459436,875451293,975658646,675039627,641025152,2084704233,1917518562,1615861247,1851332852,1147550661,1248802510,1484005843,1451044056,933301370,967311729,733156972,632953703,260388950,25965917,328671808,496906059,1206477858,1239443753,1543208500,1441952575,2144161806,1908694277,1675577880,1842759443,3610369226,3644379585,3408119516,3307916247,4011190502,3776767469,4077384432,4245618683,2809771154,2842737049,3144396420,3043140495,2673705150,2438237621,2203032232,2370213795],Ie[be([85,50])]=[0,185469197,370938394,487725847,741876788,657861945,975451694,824852259,1483753576,1400783205,1315723890,1164071807,1950903388,2135319889,1649704518,1767536459,2967507152,3152976349,2801566410,2918353863,2631447780,2547432937,2328143614,2177544179,3901806776,3818836405,4270639778,4118987695,3299409036,3483825537,3535072918,3652904859,2077965243,1893020342,1841768865,1724457132,1474502543,1559041666,1107234197,1257309336,598438867,681933534,901210569,1052338372,261314535,77422314,428819965,310463728,3409685355,3224740454,3710368113,3593056380,3875770207,3960309330,4045380933,4195456072,2471224067,2554718734,2237133081,2388260884,3212035895,3028143674,2842678573,2724322336,4138563181,4255350624,3769721975,3955191162,3667219033,3516619604,3431546947,3347532110,2933734917,2782082824,3099667487,3016697106,2196052529,2313884476,2499348523,2683765030,1179510461,1296297904,1347548327,1533017514,1786102409,1635502980,2087309459,2003294622,507358933,355706840,136428751,53458370,839224033,957055980,605657339,790073846,2373340630,2256028891,2607439820,2422494913,2706270690,2856345839,3075636216,3160175349,3573941694,3725069491,3273267108,3356761769,4181598602,4063242375,4011996048,3828103837,1033297158,915985419,730517276,545572369,296679730,446754879,129166120,213705253,1709610350,1860738147,1945798516,2029293177,1239331162,1120974935,1606591296,1422699085,4148292826,4233094615,3781033664,3931371469,3682191598,3497509347,3446004468,3328955385,2939266226,2755636671,3106780840,2988687269,2198438022,2282195339,2501218972,2652609425,1201765386,1286567175,1371368976,1521706781,1805211710,1620529459,2105887268,1988838185,533804130,350174575,164439672,46346101,870912086,954669403,636813900,788204353,2358957921,2274680428,2592523643,2441661558,2695033685,2880240216,3065962831,3182487618,3572145929,3756299780,3270937875,3388507166,4174560061,4091327024,4006521127,3854606378,1014646705,930369212,711349675,560487590,272786309,457992840,106852767,223377554,1678381017,1862534868,1914052035,2031621326,1211247597,1128014560,1580087799,1428173050,32283319,182621114,401639597,486441376,768917123,651868046,1003007129,818324884,1503449823,1385356242,1333838021,1150208456,1973745387,2125135846,1673061617,1756818940,2970356327,3120694122,2802849917,2887651696,2637442643,2520393566,2334669897,2149987652,3917234703,3799141122,4284502037,4100872472,3309594171,3460984630,3545789473,3629546796,2050466060,1899603969,1814803222,1730525723,1443857720,1560382517,1075025698,1260232239,575138148,692707433,878443390,1062597235,243256656,91341917,409198410,325965383,3403100636,3252238545,3704300486,3620022987,3874428392,3990953189,4042459122,4227665663,2460449204,2578018489,2226875310,2411029155,3198115200,3046200461,2827177882,2743944855],Ie[be([85,51])]=[0,218828297,437656594,387781147,875313188,958871085,775562294,590424639,1750626376,1699970625,1917742170,2135253587,1551124588,1367295589,1180849278,1265195639,3501252752,3720081049,3399941250,3350065803,3835484340,3919042237,4270507174,4085369519,3102249176,3051593425,2734591178,2952102595,2361698556,2177869557,2530391278,2614737639,3145456443,3060847922,2708326185,2892417312,2404901663,2187128086,2504130317,2555048196,3542330227,3727205754,3375740769,3292445032,3876557655,3926170974,4246310725,4027744588,1808481195,1723872674,1910319033,2094410160,1608975247,1391201670,1173430173,1224348052,59984867,244860394,428169201,344873464,935293895,984907214,766078933,547512796,1844882806,1627235199,2011214180,2062270317,1507497298,1423022939,1137477952,1321699145,95345982,145085239,532201772,313773861,830661914,1015671571,731183368,648017665,3175501286,2957853679,2807058932,2858115069,2305455554,2220981195,2474404304,2658625497,3575528878,3625268135,3473416636,3254988725,3778151818,3963161475,4213447064,4130281361,3599595085,3683022916,3432737375,3247465558,3802222185,4020912224,4172763771,4122762354,3201631749,3017672716,2764249623,2848461854,2331590177,2280796200,2431590963,2648976442,104699613,188127444,472615631,287343814,840019705,1058709744,671593195,621591778,1852171925,1668212892,1953757831,2037970062,1514790577,1463996600,1080017571,1297403050,3673637356,3623636965,3235995134,3454686199,4007360968,3822090177,4107101658,4190530515,2997825956,3215212461,2830708150,2779915199,2256734592,2340947849,2627016082,2443058075,172466556,122466165,273792366,492483431,1047239e3,861968209,612205898,695634755,1646252340,1863638845,2013908262,1963115311,1446242576,1530455833,1277555970,1093597963,1636604631,1820824798,2073724613,1989249228,1436590835,1487645946,1337376481,1119727848,164948639,81781910,331544205,516552836,1039717051,821288114,669961897,719700128,2973530695,3157750862,2871682645,2787207260,2232435299,2283490410,2667994737,2450346104,3647212047,3564045318,3279033885,3464042516,3980931627,3762502690,4150144569,4199882800,3070356634,3121275539,2904027272,2686254721,2200818878,2384911031,2570832044,2486224549,3747192018,3528626907,3310321856,3359936201,3950355702,3867060991,4049844452,4234721005,1739656202,1790575107,2108100632,1890328081,1402811438,1586903591,1233856572,1149249077,266959938,48394827,369057872,418672217,1002783846,919489135,567498868,752375421,209336225,24197544,376187827,459744698,945164165,895287692,574624663,793451934,1679968233,1764313568,2117360635,1933530610,1343127501,1560637892,1243112415,1192455638,3704280881,3519142200,3336358691,3419915562,3907448597,3857572124,4075877127,4294704398,3029510009,3113855344,2927934315,2744104290,2159976285,2377486676,2594734927,2544078150],Ie[be([85,52])]=[0,151849742,303699484,454499602,607398968,758720310,908999204,1059270954,1214797936,1097159550,1517440620,1400849762,1817998408,1699839814,2118541908,2001430874,2429595872,2581445614,2194319100,2345119218,3034881240,3186202582,2801699524,2951971274,3635996816,3518358430,3399679628,3283088770,4237083816,4118925222,4002861748,3885750714,1002142683,850817237,698445255,548169417,529487843,377642221,227885567,77089521,1943217067,2061379749,1640576439,1757691577,1474760595,1592394909,1174215055,1290801793,2875968315,2724642869,3111247143,2960971305,2405426947,2253581325,2638606623,2487810577,3808662347,3926825029,4044981591,4162096729,3342319475,3459953789,3576539503,3693126241,1986918061,2137062819,1685577905,1836772287,1381620373,1532285339,1078185097,1229899655,1040559837,923313619,740276417,621982671,439452389,322734571,137073913,19308535,3871163981,4021308739,4104605777,4255800159,3263785589,3414450555,3499326569,3651041127,2933202493,2815956275,3167684641,3049390895,2330014213,2213296395,2566595609,2448830231,1305906550,1155237496,1607244650,1455525988,1776460110,1626319424,2079897426,1928707164,96392454,213114376,396673818,514443284,562755902,679998e3,865136418,983426092,3708173718,3557504664,3474729866,3323011204,4180808110,4030667424,3945269170,3794078908,2507040230,2623762152,2272556026,2390325492,2975484382,3092726480,2738905026,2857194700,3973773121,3856137295,4274053469,4157467219,3371096953,3252932727,3673476453,3556361835,2763173681,2915017791,3064510765,3215307299,2156299017,2307622919,2459735317,2610011675,2081048481,1963412655,1846563261,1729977011,1480485785,1362321559,1243905413,1126790795,878845905,1030690015,645401037,796197571,274084841,425408743,38544885,188821243,3613494426,3731654548,3313212038,3430322568,4082475170,4200115116,3780097726,3896688048,2668221674,2516901860,2366882550,2216610296,3141400786,2989552604,2837966542,2687165888,1202797690,1320957812,1437280870,1554391400,1669664834,1787304780,1906247262,2022837584,265905162,114585348,499347990,349075736,736970802,585122620,972512814,821712160,2595684844,2478443234,2293045232,2174754046,3196267988,3079546586,2895723464,2777952454,3537852828,3687994002,3234156416,3385345166,4142626212,4293295786,3841024952,3992742070,174567692,57326082,410887952,292596766,777231668,660510266,1011452712,893681702,1108339068,1258480242,1343618912,1494807662,1715193156,1865862730,1948373848,2100090966,2701949495,2818666809,3004591147,3122358053,2235061775,2352307457,2535604243,2653899549,3915653703,3764988233,4219352155,4067639125,3444575871,3294430577,3746175075,3594982253,836553431,953270745,600235211,718002117,367585007,484830689,133361907,251657213,2041877159,1891211689,1806599355,1654886325,1568718495,1418573201,1335535747,1184342925];const Ae=new Uint8Array(16);for(let He=15;He>=0;--He)Ae[He]=ke%256,ke=parseInt(ke/256);let Se=null,Oe=16;const Ve=new Uint8Array(ve),Me=[],De=[];Ue();for(let He=0;He<xe[be([108,101,110,103,116,104])];He++)Oe===16&&(Se=$e(Ae),Oe=0,Be(Ae)),xe[He]^=Se[Oe++];return xe;function Fe(He){const ze=[];for(let qe=0;qe<He[be([108,101,110,103,116,104])];qe+=4)ze[be([112,117,115,104])](He[qe]<<24|He[qe+1]<<16|He[qe+2]<<8|He[qe+3]);return ze}function Be(He){for(let ze=15;ze>=0;ze--){if(He[ze]!==255){He[ze]++;break}He[ze]=0}}function $e(He){const ze=Me[be([108,101,110,103,116,104])]-1,qe=[0,0,0,0];let Ke=Fe(He);for(let Ye=0;Ye<4;Ye++)Ke[Ye]^=Me[0][Ye];for(let Ye=1;Ye<ze;Ye++){for(let ht=0;ht<4;ht++)qe[ht]=Ie[be([84,49])][Ke[ht]>>24&255]^Ie[be([84,50])][Ke[(ht+1)%4]>>16&255]^Ie[be([84,51])][Ke[(ht+2)%4]>>8&255]^Ie[be([84,52])][255&Ke[(ht+3)%4]]^Me[Ye][ht];Ke=qe[be([115,108,105,99,101])]()}const Qe=new Uint8Array(16);let je;for(let Ye=0;Ye<4;Ye++)je=Me[ze][Ye],Qe[4*Ye]=255&(Ie[be([83])][Ke[Ye]>>24&255]^je>>24),Qe[4*Ye+1]=255&(Ie[be([83])][Ke[(Ye+1)%4]>>16&255]^je>>16),Qe[4*Ye+2]=255&(Ie[be([83])][Ke[(Ye+2)%4]>>8&255]^je>>8),Qe[4*Ye+3]=255&(Ie[be([83])][255&Ke[(Ye+3)%4]]^je);return Qe}function Ue(){const He=Ie[be([110,117,109,98,101,114,79,102,82,111,117,110,100,115])][Ve[be([108,101,110,103,116,104])]];for(let Ze=0;Ze<=He;Ze++)Me[be([112,117,115,104])]([0,0,0,0]),De[be([112,117,115,104])]([0,0,0,0]);const ze=4*(He+1),qe=Ve[be([108,101,110,103,116,104])]/4,Ke=Fe(Ve);let Qe;for(let Ze=0;Ze<qe;Ze++)Qe=Ze>>2,Me[Qe][Ze%4]=Ke[Ze],De[He-Qe][Ze%4]=Ke[Ze];let je,Ye=0,ht=qe;for(;ht<ze;){je=Ke[qe-1],Ke[0]^=Ie[be([83])][je>>16&255]<<24^Ie[be([83])][je>>8&255]<<16^Ie[be([83])][255&je]<<8^Ie[be([83])][je>>24&255]^Ie[be([114,99,111,110])][Ye]<<24,Ye+=1;for(let Yt=1;Yt<qe/2;Yt++)Ke[Yt]^=Ke[Yt-1];je=Ke[qe/2-1],Ke[qe/2]^=Ie[be([83])][255&je]^Ie[be([83])][je>>8&255]<<8^Ie[be([83])][je>>16&255]<<16^Ie[be([83])][je>>24&255]<<24;for(let Yt=qe/2+1;Yt<qe;Yt++)Ke[Yt]^=Ke[Yt-1];let Ze,Bt,Jt=0;for(;Jt<qe&&ht<ze;)Ze=ht>>2,Bt=ht%4,Me[Ze][Bt]=Ke[Jt],De[He-Ze][Bt]=Ke[Jt++],ht++}for(let Ze=1;Ze<He;Ze++)for(let Bt=0;Bt<4;Bt++)je=De[Ze][Bt],De[Ze][Bt]=Ie[be([85,49])][je>>24&255]^Ie[be([85,50])][je>>16&255]^Ie[be([85,51])][je>>8&255]^Ie[be([85,52])][255&je]}}function be(xe){return xe.map(ve=>String.fromCharCode(ve)).join("")}(xe=>{function ve(){const Ne=[{[be([105,100])]:1,[be([102,101,97,116,117,114,101,78,97,109,101])]:be([67,111,109,109,101,110,116,115]),[be([112,108,117,103,105,110,78,97,109,101])]:be([67,111,109,109,101,110,116,115,82,101,112,111,115,105,116,111,114,121]),[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:be([108,105,99,101,110,115,101,75,101,121]),[be([104,97,110,100,108,101,114])]:be([99,104,101,99,107,76,105,99,101,110,115,101]),[be([99,104,101,99,107,65,108,115,111])]:[{[be([105,100])]:2,[be([102,101,97,116,117,114,101,78,97,109,101])]:be([84,114,97,99,107,32,67,104,97,110,103,101,115]),[be([112,108,117,103,105,110,78,97,109,101])]:be([84,114,97,99,107,67,104,97,110,103,101,115,69,100,105,116,105,110,103]),[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:be([108,105,99,101,110,115,101,75,101,121]),[be([104,97,110,100,108,101,114])]:be([99,104,101,99,107,76,105,99,101,110,115,101,70,111,114,84,114,97,99,107,67,104,97,110,103,101,115]),[be([111,112,116,105,111,110,115])]:{[be([97,105,119,115,103,105,99])]:!0,[be([97,105,116,99,100,103,105,108])]:!0,[be([97,105,114,118,105,105,108])]:!0}}],[be([111,112,116,105,111,110,115])]:{[be([97,105,119,115,103,105,99])]:!0,[be([97,105,116,99,100,103,105,108])]:!0,[be([97,105,114,118,105,105,108])]:!0}},{[be([105,100])]:3,[be([102,101,97,116,117,114,101,78,97,109,101])]:be([80,97,103,105,110,97,116,105,111,110]),[be([112,108,117,103,105,110,78,97,109,101])]:be([80,97,103,105,110,97,116,105,111,110,76,111,111,107,117,112]),[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:be([112,97,103,105,110,97,116,105,111,110,76,105,99,101,110,115,101,75,101,121]),[be([104,97,110,100,108,101,114])]:be([99,104,101,99,107,76,105,99,101,110,115,101])},{[be([105,100])]:4,[be([102,101,97,116,117,114,101,78,97,109,101])]:be([82,101,118,105,115,105,111,110,32,72,105,115,116,111,114,121]),[be([112,108,117,103,105,110,78,97,109,101])]:be([82,101,118,105,115,105,111,110,115,82,101,112,111,115,105,116,111,114,121]),[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:be([108,105,99,101,110,115,101,75,101,121]),[be([104,97,110,100,108,101,114])]:be([99,104,101,99,107,76,105,99,101,110,115,101,70,111,114,82,101,118,105,115,105,111,110,72,105,115,116,111,114,121]),[be([111,112,116,105,111,110,115])]:{[be([97,105,119,115,103,105,99])]:!0,[be([97,105,116,99,100,103,105,108])]:!0,[be([97,105,114,118,105,105,108])]:!0}},{[be([105,100])]:5,[be([102,101,97,116,117,114,101,78,97,109,101])]:be([68,111,99,117,109,101,110,116,32,79,117,116,108,105,110,101]),[be([112,108,117,103,105,110,78,97,109,101])]:be([68,111,99,117,109,101,110,116,79,117,116,108,105,110,101,85,73]),[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:be([100,111,99,117,109,101,110,116,79,117,116,108,105,110,101,76,105,99,101,110,115,101,75,101,121]),[be([104,97,110,100,108,101,114])]:be([99,104,101,99,107,76,105,99,101,110,115,101]),[be([111,112,116,105,111,110,115])]:{[be([102,103,105])]:[12]}},{[be([105,100])]:6,[be([102,101,97,116,117,114,101,78,97,109,101])]:be([70,111,114,109,97,116,32,80,97,105,110,116,101,114]),[be([112,108,117,103,105,110,78,97,109,101])]:be([70,111,114,109,97,116,80,97,105,110,116,101,114,85,73]),[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:be([102,111,114,109,97,116,80,97,105,110,116,101,114,76,105,99,101,110,115,101,75,101,121]),[be([104,97,110,100,108,101,114])]:be([99,104,101,99,107,76,105,99,101,110,115,101]),[be([111,112,116,105,111,110,115])]:{[be([102,103,105])]:[12]}},{[be([105,100])]:7,[be([102,101,97,116,117,114,101,78,97,109,101])]:be([83,108,97,115,104,32,67,111,109,109,97,110,100]),[be([112,108,117,103,105,110,78,97,109,101])]:be([83,108,97,115,104,67,111,109,109,97,110,100,85,73]),[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:be([115,108,97,115,104,67,111,109,109,97,110,100,76,105,99,101,110,115,101,75,101,121]),[be([104,97,110,100,108,101,114])]:be([99,104,101,99,107,76,105,99,101,110,115,101]),[be([111,112,116,105,111,110,115])]:{[be([102,103,105])]:[12]}},{[be([105,100])]:8,[be([102,101,97,116,117,114,101,78,97,109,101])]:be([84,97,98,108,101,32,111,102,32,67,111,110,116,101,110,116,115]),[be([112,108,117,103,105,110,78,97,109,101])]:be([84,97,98,108,101,79,102,67,111,110,116,101,110,116,115,69,100,105,116,105,110,103]),[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:be([116,97,98,108,101,79,102,67,111,110,116,101,110,116,115,76,105,99,101,110,115,101,75,101,121]),[be([104,97,110,100,108,101,114])]:be([99,104,101,99,107,76,105,99,101,110,115,101]),[be([111,112,116,105,111,110,115])]:{[be([102,103,105])]:[12]}},{[be([105,100])]:9,[be([102,101,97,116,117,114,101,78,97,109,101])]:be([84,101,109,112,108,97,116,101]),[be([112,108,117,103,105,110,78,97,109,101])]:be([84,101,109,112,108,97,116,101,85,73]),[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:be([116,101,109,112,108,97,116,101,76,105,99,101,110,115,101,75,101,121]),[be([104,97,110,100,108,101,114])]:be([99,104,101,99,107,76,105,99,101,110,115,101]),[be([111,112,116,105,111,110,115])]:{[be([102,103,105])]:[12,14]}},{[be([105,100])]:10,[be([102,101,97,116,117,114,101,78,97,109,101])]:be([80,97,115,116,101,32,102,114,111,109,32,79,102,102,105,99,101,32,69,110,104,97,110,99,101,100]),[be([112,108,117,103,105,110,78,97,109,101])]:be([80,97,115,116,101,70,114,111,109,79,102,102,105,99,101,69,110,104,97,110,99,101,100,73,110,108,105,110,101,114]),[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:be([112,97,115,116,101,70,114,111,109,79,102,102,105,99,101,69,110,104,97,110,99,101,100,76,105,99,101,110,115,101,75,101,121]),[be([104,97,110,100,108,101,114])]:be([99,104,101,99,107,76,105,99,101,110,115,101]),[be([111,112,116,105,111,110,115])]:{[be([102,103,105])]:[12]}},{[be([105,100])]:11,[be([102,101,97,116,117,114,101,78,97,109,101])]:be([65,73,32,65,115,115,105,115,116,97,110,116]),[be([112,108,117,103,105,110,78,97,109,101])]:be([65,73,65,115,115,105,115,116,97,110,116,85,73]),[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:be([97,105,76,105,99,101,110,115,101,75,101,121]),[be([104,97,110,100,108,101,114])]:be([99,104,101,99,107,76,105,99,101,110,115,101])},{[be([105,100])]:12,[be([102,101,97,116,117,114,101,78,97,109,101])]:be([80,114,111,100,117,99,116,105,118,105,116,121,32,112,97,99,107])},{[be([105,100])]:13,[be([102,101,97,116,117,114,101,78,97,109,101])]:be([67,97,115,101,32,67,104,97,110,103,101]),[be([112,108,117,103,105,110,78,97,109,101])]:be([67,97,115,101,67,104,97,110,103,101,85,73]),[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:be([99,97,115,101,67,104,97,110,103,101,76,105,99,101,110,115,101,75,101,121]),[be([104,97,110,100,108,101,114])]:be([99,104,101,99,107,76,105,99,101,110,115,101]),[be([111,112,116,105,111,110,115])]:{[be([102,103,105])]:[12]}},{[be([105,100])]:14,[be([102,101,97,116,117,114,101,78,97,109,101])]:be([68,114,117,112,97,108,32,112,97,99,107]),[be([102,111,114,98,105,100,100,101,110,72,97,110,100,108,101,114])]:be([102,111,114,98,105,100,100,101,110,72,97,110,100,108,101,114,70,111,114,68,114,117,112,97,108])},{[be([105,100])]:15,[be([102,101,97,116,117,114,101,78,97,109,101])]:be([77,117,108,116,105,32,76,101,118,101,108,32,76,105,115,116]),[be([112,108,117,103,105,110,78,97,109,101])]:be([77,117,108,116,105,76,101,118,101,108,76,105,115,116,69,100,105,116,105,110,103]),[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:be([109,117,108,116,105,76,101,118,101,108,76,105,115,116,76,105,99,101,110,115,101,75,101,121]),[be([104,97,110,100,108,101,114])]:be([99,104,101,99,107,76,105,99,101,110,115,101])},{[be([105,100])]:16,[be([102,101,97,116,117,114,101,78,97,109,101])]:be([77,101,114,103,101,32,70,105,101,108,100,115]),[be([112,108,117,103,105,110,78,97,109,101])]:be([77,101,114,103,101,70,105,101,108,100,115,85,73]),[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:be([109,101,114,103,101,70,105,101,108,100,115,76,105,99,101,110,115,101,75,101,121]),[be([104,97,110,100,108,101,114])]:be([99,104,101,99,107,76,105,99,101,110,115,101]),[be([111,112,116,105,111,110,115])]:{[be([102,103,105])]:[12]}}];return We(Ne),Ne;function Le(Je){return 1<<Je-1}function We(Je){Je[be([102,111,114,69,97,99,104])](Wt=>{Wt[be([112,101,114,109,105,115,115,105,111,110,77,97,115,107])]=Le(Wt[be([105,100])]),ke(Wt)&&Wt[be([99,104,101,99,107,65,108,115,111])]&&We(Wt[be([99,104,101,99,107,65,108,115,111])])})}}function ke(Ne){return be([112,108,117,103,105,110,78,97,109,101])in Ne}const Ie=[1,85,78,115,198,255,50,112,83,87,161],Ae=[127,34,6,211,167,86,146,199,132,160,18];function Se(Ne){const Le=[29,221,175,90,231,133,239,240,75,180];return Oe(Ne,new Uint8Array([...Ie,...Le,...Ae]))}function Oe(Ne,Le){const We=Ve(Ne),Je=Array[be([102,114,111,109])](Ge(We)),Wt=Je[be([112,111,112])](),nn=Je[be([112,111,112])]();return pn(te(Je,Le,nn+256*Wt))}function Ve(Ne){const Le=atob(Ne),[We,Je]=Le[be([115,112,108,105,116])](be([45]));try{if(atob(Je))return atob(We)}catch{}return Le}function Me(Ne){try{const Le=Se(Ne),We=JSON[be([112,97,114,115,101])](Le),Je=parseInt(We[be([49])]),Wt=We[be([50])]||"",nn=parseInt(We[be([51])]),cn=parseInt(We[be([52])])||0,fn=parseInt(We[be([53])])||0;return{[be([112,114,111,100,117,99,116,78,97,109,101])]:Wt,[be([97,108,108,111,119,101,100,80,108,117,103,105,110,115])]:cn,[be([101,120,112,105,114,97,116,105,111,110,68,97,116,101])]:Je,[be([105,115,84,114,105,97,108])]:nn,[be([105,115,73,110,116,101,114,110,97,108])]:fn}}catch{return null}}const De=ve(),Fe={[be([99,104,101,99,107,76,105,99,101,110,115,101])]:Qe,[be([99,104,101,99,107,76,105,99,101,110,115,101,70,111,114,84,114,97,99,107,67,104,97,110,103,101,115])]:je,[be([99,104,101,99,107,76,105,99,101,110,115,101,70,111,114,82,101,118,105,115,105,111,110,72,105,115,116,111,114,121])]:Ye},Be=xe[be([99,111,110,115,116,114,117,99,116,111,114])][be([112,108,117,103,105,110,78,97,109,101])],$e=be([99,111,110,116,101,120,116])in xe?xe.context:xe.editor,Ue=be([52,48,52,56,49,52,50,50]),He=be([65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,48,49,50,51,52,53,54,55,56,57]),ze=$e.config.get(be([108,105,99,101,110,115,101,75,101,121])),qe=De[be([102,105,108,116,101,114])](ke)[be([102,105,110,100])](Ne=>Ne[be([112,108,117,103,105,110,78,97,109,101])]===Be);function Ke(Ne,Le){Fe[Le[be([104,97,110,100,108,101,114])]](Ne,Le),Le[be([99,104,101,99,107,65,108,115,111])]&&Le[be([99,104,101,99,107,65,108,115,111])][be([102,105,108,116,101,114])](We=>Kt($e,We[be([112,108,117,103,105,110,78,97,109,101])]))[be([102,111,114,69,97,99,104])](We=>Ke(Ne,We))}function Qe(Ne,Le){Ze(ht(Ne,Le),Le)}function je(Ne,Le){function We(Je,Wt){try{if(Kt($e,be([84,114,97,99,107,67,104,97,110,103,101,115,69,100,105,116,105,110,103]))&&Je){const nn=Xt($e,be([84,114,97,99,107,67,104,97,110,103,101,115,69,100,105,116,105,110,103]))[be([95,101,120,101,99,117,116,101,83,117,103,103,101,115,116,105,111,110])];if(parseInt(nn)/2>Je[be([101,120,112,105,114,97,116,105,111,110,68,97,116,101])])return Bt(Wt[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+be([73,110,118,97,108,105,100]))}return ht(Je,Wt)}catch{return Bt(Wt[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+be([73,110,118,97,108,105,100]))}}Ze(We(Ne,Le),Le)}function Ye(Ne,Le){const We=Ae[0]*Ie[1],Je=Ae[0]*Ie[2],Wt=Ae[2]*Ie[2];Kt($e,be([87,101,98,83,111,99,107,101,116,71,97,116,101,119,97,121]))&&Xt($e,be([87,101,98,83,111,99,107,101,116,71,97,116,101,119,97,121]))[be([115,116,97,116,101])]==be([99,111,110,110,101,99,116,101,100])&&(window[Jt()]=Wt);function nn(Xe,Qt){try{return un()?Bt(Qt[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+be([86,97,108,105,100])):ht(Xe,Qt)}catch{return Bt(Qt[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+be([73,110,118,97,108,105,100]))}}function cn(Xe,Qt){if(Xe==Qt[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+be([73,110,118,97,108,105,100]))zt();else if(Xe==Qt[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+be([84,114,105,97,108])){const rn=fn();rn&&ln(rn,Qt[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]);const xn=dn();window[be([115,101,116,84,105,109,101,111,117,116])](()=>{ln(be([116,105,109,101]),Qt[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])])},xn);const wn=Xt($e,be([82,101,118,105,115,105,111,110,115,82,101,112,111,115,105,116,111,114,121]))[be([95,114,101,118,105,115,105,111,110,115])];wn[be([108,101,110,103,116,104])]>=7?ln(be([114,101,118,105,115,105,111,110,115]),Qt[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]):wn.on(be([97,100,100]),()=>{wn[be([108,101,110,103,116,104])]>=7&&ln(be([114,101,118,105,115,105,111,110,115]),Qt[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])])})}}function fn(){if(!Kt($e,be([82,101,118,105,115,105,111,110,86,105,101,119,101,114])))return!1;for(const Xe in window)if(Number.isNaN(Number(Xe))){if(window[Xe]===We)return be([116,105,109,101]);if(window[Xe]===Je)return be([114,101,118,105,115,105,111,110,115])}return!1}function un(){if(!Kt($e,be([82,101,118,105,115,105,111,110,86,105,101,119,101,114])))return!1;for(const Xe in window)if(Number.isNaN(Number(Xe))&&window[Xe]===Wt)return!0;return!1}function ln(Xe,Qt){zt(),Bt(Qt+be([84,114,105,97,108,76,105,109,105,116,58])+Xe),window[Jt()]=Xe===be([116,105,109,101])?We:Je}function dn(){let Xe=Ae[6]*Ie[8]*Ie[6];return Kt($e,be([82,101,118,105,115,105,111,110,86,105,101,119,101,114]))&&(Xe/=10),Xe}function zt(){const Xe=$e;function Qt(){Kt(Xe,be([82,101,118,105,115,105,111,110,84,114,97,99,107,101,114]))&&(Xt(Xe,be([82,101,118,105,115,105,111,110,84,114,97,99,107,101,114]))[be([117,110,98,105,110,100])](be([105,115,69,110,97,98,108,101,100])),Xt(Xe,be([82,101,118,105,115,105,111,110,84,114,97,99,107,101,114]))[be([105,115,69,110,97,98,108,101,100])]=!1,Xt(Xe,be([82,101,118,105,115,105,111,110,84,114,97,99,107,101,114]))[be([117,112,100,97,116,101])]=sn,Xt(Xe,be([82,101,118,105,115,105,111,110,84,114,97,99,107,101,114]))[be([115,97,118,101,82,101,118,105,115,105,111,110])]=sn,Xe[be([109,111,100,101,108])][be([99,104,97,110,103,101])]=sn,Xe[be([109,111,100,101,108])][be([101,110,113,117,101,117,101,67,104,97,110,103,101])]=sn,Xe[be([101,110,97,98,108,101,82,101,97,100,79,110,108,121,77,111,100,101])](be([109,111,100,101,108]))),Kt(Xe,be([82,101,118,105,115,105,111,110,86,105,101,119,101,114]))&&(Xt(Xe,be([82,101,118,105,115,105,111,110,86,105,101,119,101,114]))[be([117,110,98,105,110,100])](be([105,115,69,110,97,98,108,101,100])),Xt(Xe,be([82,101,118,105,115,105,111,110,86,105,101,119,101,114]))[be([105,115,69,110,97,98,108,101,100])]=!1,Xt(Xe,be([82,101,118,105,115,105,111,110,86,105,101,119,101,114]))[be([99,111,109,112,97,114,101])]=sn,Xt(Xe,be([82,101,118,105,115,105,111,110,86,105,101,119,101,114]))[be([95,103,101,116,68,105,102,102])]=sn)}Xe[be([115,116,97,116,101])]==be([114,101,97,100,121])?Qt():Xe[be([111,110,99,101])](be([114,101,97,100,121]),()=>{if(Kt(Xe,be([82,101,118,105,115,105,111,110,84,114,97,99,107,101,114]))&&Qt(),Kt(Xe,be([82,101,118,105,115,105,111,110,86,105,101,119,101,114]))){const an=Xt(Xe,be([82,101,118,105,115,105,111,110,115,82,101,112,111,115,105,116,111,114,121])),rn=an.getRevision(0),xn=an.getEarlierVisibleRevision(rn[be([105,100])]);Xt(Xe,be([82,101,118,105,115,105,111,110,86,105,101,119,101,114]))[be([99,111,109,112,97,114,101])](rn[be([105,100])],xn?xn[be([105,100])]:null,1).then(()=>Qt())}})}cn(nn(Ne,Le),Le)}function ht(Ne,Le){try{return tn(Le)?Bt(Le[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+be([86,97,108,105,100])):Ne&&hn(Ne[be([97,108,108,111,119,101,100,80,108,117,103,105,110,115])],Le)?Ne[be([105,115,73,110,116,101,114,110,97,108])]&&!window[be([111,112,101,110])][be([99,108,111,115,101,100])]||parseInt(Ue)/2>Ne[be([101,120,112,105,114,97,116,105,111,110,68,97,116,101])]?Bt(Le[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+be([73,110,118,97,108,105,100])):Ne[be([105,115,84,114,105,97,108])]?Bt(Le[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+be([84,114,105,97,108])):Bt(Le[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+be([86,97,108,105,100])):Bt(Le[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+be([73,110,118,97,108,105,100]))}catch{return Bt(Le[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+be([73,110,118,97,108,105,100]))}}function Ze(Ne,Le){if($e instanceof Context){const We=$e;Ne==Le[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+be([73,110,118,97,108,105,100])?Yt(We):Ne==Le[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+be([84,114,105,97,108])&&window[be([115,101,116,84,105,109,101,111,117,116])](()=>{Yt(We),Bt(Le[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+be([84,114,105,97,108,76,105,109,105,116,58,116,105,109,101]))},Ae[6]*Ie[8]*Ie[6]),We[be([101,100,105,116,111,114,115])][be([111,110])](be([97,100,100]),(Je,Wt)=>{Ne!=Le[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+be([73,110,118,97,108,105,100])&&Ne!=Le[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+be([84,114,105,97,108,76,105,109,105,116,58,116,105,109,101])&&Ne!=Le[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+be([84,114,105,97,108,76,105,109,105,116,58,111,112,101,114,97,116,105,111,110,115])||en(Wt)})}else{const We=$e;Ne==Le[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+be([73,110,118,97,108,105,100])?en(We):Ne==Le[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+be([84,114,105,97,108])&&We[be([111,110])](be([114,101,97,100,121]),()=>{let Je=0;We[be([109,111,100,101,108])][be([111,110])](be([97,112,112,108,121,79,112,101,114,97,116,105,111,110]),(Wt,nn)=>{nn[0][be([105,115,68,111,99,117,109,101,110,116,79,112,101,114,97,116,105,111,110])]&&Je++,Je===504&&(en(We),Bt(Le[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+be([84,114,105,97,108,76,105,109,105,116,58,111,112,101,114,97,116,105,111,110,115])),Wt[be([111,102,102])]())},{priority:be([104,105,103,104,101,115,116])})})}}function Bt(Ne){const Le=Jt();return $e[Le]=Ne,Ne}function Jt(){const Ne=String(window[be([112,101,114,102,111,114,109,97,110,99,101])][be([110,111,119])]())[be([114,101,112,108,97,99,101])](be([46]),"");let Le="";for(let We=0;We<Ne[be([108,101,110,103,116,104])];We+=2){let Je=parseInt(Ne[be([115,117,98,115,116,114,105,110,103])](We,We+2));Je>=He[be([108,101,110,103,116,104])]&&(Je-=He[be([108,101,110,103,116,104])]),Le+=He[Je]}return Le}function Yt(Ne){for(const Le of Ne[be([101,100,105,116,111,114,115])])en(Le);Xt(Ne,be([67,111,109,109,101,110,116,115,82,101,112,111,115,105,116,111,114,121]))[be([115,119,105,116,99,104,82,101,97,100,79,110,108,121])](!0),Xt(Ne,be([67,111,109,109,101,110,116,115,82,101,112,111,115,105,116,111,114,121]))[be([115,119,105,116,99,104,82,101,97,100,79,110,108,121])]=sn}function en(Ne){function Le(){Ne[be([109,111,100,101,108])][be([99,104,97,110,103,101])]=sn,Ne[be([109,111,100,101,108])][be([101,110,113,117,101,117,101,67,104,97,110,103,101])]=sn,Ne[be([101,110,97,98,108,101,82,101,97,100,79,110,108,121,77,111,100,101])](be([109,111,100,101,108]))}Ne[be([115,116,97,116,101])]==be([114,101,97,100,121])?Le():Ne[be([111,110,99,101])](be([114,101,97,100,121]),()=>Le())}function sn(){return null}function hn(Ne,Le){const We=!!(Ne&Le[be([112,101,114,109,105,115,115,105,111,110,77,97,115,107])]),Je=mn(Ne,Le);return We||Je}function mn(Ne,Le){const We=(Le[be([111,112,116,105,111,110,115])]||{})[be([102,103,105])]||null;return!!We&&De[be([102,105,108,116,101,114])](Je=>We[be([105,110,99,108,117,100,101,115])](Je[be([105,100])]))[be([102,105,108,116,101,114])](Je=>!bn(Je))[be([115,111,109,101])](Je=>!!(Ne&Je[be([112,101,114,109,105,115,115,105,111,110,77,97,115,107])]))}function bn(Ne){const Le={[be([102,111,114,98,105,100,100,101,110,72,97,110,100,108,101,114,70,111,114,68,114,117,112,97,108])]:gn};return!!Ne.forbiddenHandler&&Le[Ne.forbiddenHandler]()}function gn(){return!window[be([68,114,117,112,97,108])]||!Kt($e,be([100,114,117,112,97,108,80,111,119,101,114,101,100,66,121]))}function tn(Ne){if(!Kt($e,Ne[be([112,108,117,103,105,110,78,97,109,101])]))return!0;const Le=Ne[be([111,112,116,105,111,110,115])]||{},We=Le[be([97,105,119,115,103,105,99])]||!1,Je=Le[be([97,105,116,99,100,103,105,108])]||!1,Wt=Le[be([97,105,114,118,105,105,108])]||!1;return Kt($e,be([87,101,98,83,111,99,107,101,116,71,97,116,101,119,97,121]))&&Xt($e,be([87,101,98,83,111,99,107,101,116,71,97,116,101,119,97,121]))[be([115,116,97,116,101])]==be([99,111,110,110,101,99,116,101,100])&&We||Kt($e,be([84,114,97,99,107,67,104,97,110,103,101,115,68,97,116,97,71,101,116,116,101,114]))&&Xt($e,be([84,114,97,99,107,67,104,97,110,103,101,115,68,97,116,97,71,101,116,116,101,114]))[be([114,101,115,117,108,116])]==be([101,110,100])&&Je?!0:!(!Kt($e,be([82,101,118,105,115,105,111,110,86,105,101,119,101,114,73,110,116,101,103,114,97,116,105,111,110]))||Xt($e,be([82,101,118,105,115,105,111,110,86,105,101,119,101,114,73,110,116,101,103,114,97,116,105,111,110]))[be([114,101,115,117,108,116])]!=be([101,110,100])||!Wt)}function Kt(Ne,Le){return Ne[be([112,108,117,103,105,110,115])][be([104,97,115])](Le)}function Xt(Ne,Le){return Ne[be([112,108,117,103,105,110,115])][be([103,101,116])](Le)}function pn(Ne){let Le="";for(const We of Ne)Le+=String[be([102,114,111,109,67,104,97,114,67,111,100,101])](We);return Le}function Ge(Ne){const Le=new Uint8Array(Ne[be([108,101,110,103,116,104])]);for(let We=0;We<Ne[be([108,101,110,103,116,104])];We++)Le[We]=Ne[be([99,104,97,114,67,111,100,101,65,116])](We);return Le}qe&&Ke(Me(ze),qe)})(t)})(this)}showUI(t="",te="",be="custom"){const xe=this.editor,ve=xe.editing.view,ke=xe.plugins.get(i$9),Ie=xe.plugins.get(ClipboardMarkersUtils);ke.showFakeVisualSelection();const Ae=new T$3,Se=new ClipboardEvent("copy",{clipboardData:Ae}),Oe=new DataTransfer$1(Ae),Ve=new DomEventData(ve,Se,{dataTransfer:Oe});Ie._forceMarkersCopy("comment",()=>{ve.document.fire("copy",Ve)}),this._formView||(this._initView(),this._aiAssistantController=new k$5(xe,this._aiAdapter.textAdapter,this._formView));let Me=Oe.getData("text/html");const De=xe.model.document.selection,Fe=Array.from(De.getRanges());Fe.length===1&&Fe[0].isFlat&&!De.getSelectedElement()&&Me.replace(/&nbsp;/g,"").trim()!==""&&(Me="<p>"+Me+"</p>"),this._aiAssistantController.updateView({actionId:be,query:t,htmlContent:Me,label:te,mainActionLabel:E$3[xe.model.document.selection.isCollapsed?"INSERT":"REPLACE"]}),this._dialog.id!=="aiAssistant"?this._dialog.show({id:"aiAssistant",icon:a$9.robotPencil,title:o$8(this.editor.locale,"AI Assistant"),content:this._formView,position:DialogViewPosition.EDITOR_TOP_SIDE,onShow:()=>{this._formView.focus()},onHide:()=>{this._aiAssistantController.reset(),ke.hideFakeVisualSelection()}}):this._dialog.view.wasMoved||this._dialog.view.updatePosition()}hideUI(){this._dialog.hide()}_createAIAssistantUIButton(t){const te=this.editor,be=te.commands.get("showAIAssistant"),xe=new t(te.locale);return xe.set({label:o$8(te.locale,"AI Assistant"),icon:a$9.robotPencil}),xe.bind("isEnabled").to(be),xe.bind("isOn").to(this._dialog,"id",ve=>ve==="aiAssistant"),this.listenTo(xe,"execute",()=>{xe.isOn?this.hideUI():be.execute()}),xe}_initView(){const t=this.editor.plugins.get(i$9);this._formView=new x$5(this.editor.locale,this._uiCssClasses,this.editor.config.get("ai.aiAssistant.contentAreaCssClass")),this._formView.on("change:value",()=>{this._dialog.view.wasMoved||this._dialog.view.updatePosition()}),this._formView.promptView.queryView.fieldView.on("update",()=>{this._dialog.view.wasMoved||this._dialog.view.updatePosition()}),this.listenTo(this._formView,"replaceContent",()=>{t.insertContent(this._aiAssistantController.currentContext),this.hideUI()}),this.listenTo(this._formView,"insertContentBelow",()=>{t.insertContentBelow(this._aiAssistantController.currentContext),this.hideUI()}),this._initAriaAiStatusChangeAnnouncements()}_initAriaAiStatusChangeAnnouncements(){const{locale:t,ui:{ariaLiveAnnouncer:te}}=this.editor;this._formView.contentArea.on("change:isProcessing",(be,xe,ve)=>{const ke=this._aiAssistantController.currentContext;ve?te.announce(o$8(t,"AI is writing")):ke&&te.announce(o$8(t,"Generated content: %0",ke),{politeness:"polite",isUnsafeHTML:!0})}),this._formView.on("change:isError",(be,xe,ve)=>{if(ve){const ke=this._formView.errorView.text;te.announce(o$8(t,"Error during AI content generation: %0",ke))}})}};function _$3(Te,we){const t=new U$1(Te.locale),te=H$3(Te,Te.config.get("ai.aiAssistant.commands")).map(({groupId:be,groupLabel:xe,commands:ve})=>{const ke=H$3(Te,ve).map(Ie=>function(Ae,Se,Oe){const Ve=new $$2(Ae,Oe),Me=new N$2,De=new ButtonView(Ae,Me);return Ve.children.add(De),De.set({label:Oe.label,withText:!0,role:"option"}),De.on("execute",()=>{Se(Oe.prompt,Oe.label,Oe.id,Oe.requiresContent===void 0||Oe.requiresContent)}),Ve}(Te.locale,we,Ie));return function(Ie,Ae,Se){const Oe=new ListItemGroupView(Ie,new S$3);return Oe.label=Ae,Oe.items.addMany(Se),Oe}(Te.locale,xe||be,ke)});return t.items.addMany(te),t.bind("enabledCommandsIds").to(Te.commands.get("showAIAssistant"),"enabledCommandsIds"),t}let $$2=class extends ListItemView{constructor(t,te){super(t);Re(this,"commandDefinition");this.commandDefinition=te}};function q$3(Te,we){return Te.order!==void 0&&we.order===void 0?1:Te.order===void 0&&we.order!==void 0?-1:Te.order!==void 0&&we.order!==void 0?Te.order-we.order:0}function H$3(Te,we){we.sort(q$3);const t={},te=[];for(const be of we)if(be.order!==void 0){if(be.order in t)throw new CKEditorError("ai-commands-config-order-collision",Te,{conflictingDefinitions:[be,t[be.order]]});t[be.order]=be,te.splice(be.order,0,be)}else te.push(be);return te}let r$b=class extends Plugin{static get requires(){return[n$7,i$9]}static get pluginName(){return"AIAssistant"}constructor(we){super(we);const t=we.config;var te;t.define("ai.aiAssistant.commands",[{groupId:"editOrReview",groupLabel:o$8(te=we.locale,"Edit or review"),commands:[{id:"improveWriting",label:o$8(te,"Improve writing"),prompt:"Fix spelling mistakes, use proper grammar and apply good writing practices. Do not lose the original meaning."},{id:"makeShorter",label:o$8(te,"Make shorter"),prompt:"Remove any repetitive, redundant, or non-essential writing in this content without changing the meaning or losing any key information."},{id:"makeLonger",label:o$8(te,"Make longer"),prompt:"Improve this content by using descriptive language and inserting more information and more detailed explanations."},{id:"simplifyLanguage",label:o$8(te,"Simplify language"),prompt:"Simplify the writing style of this content and reduce the complexity, so that the content is easy to understand."}]},{groupId:"generate",groupLabel:o$8(te,"Generate from selection"),commands:[{id:"summarize",label:o$8(te,"Summarize"),prompt:"Summarize this content into one paragraph of text. Include only the key ideas and conclusions. Keep it short. Do not keep original text formatting."},{id:"continue",label:o$8(te,"Continue"),prompt:"Start with the provided content and write at the end of it continuing this topic. Keep the added part short."}]},{groupId:"changeTone",groupLabel:o$8(te,"Change tone"),commands:[{id:"professional",label:o$8(te,"Professional"),prompt:"Improve using polished, formal, and respectful language to convey professional expertise and competence."},{id:"casual",label:o$8(te,"Casual"),prompt:"Improve using casual, informal language to convey a casual conversation with a real person."},{id:"direct",label:o$8(te,"Direct"),prompt:"Improve using direct language, using only the essential information."},{id:"confident",label:o$8(te,"Confident"),prompt:"Improve using compelling, optimistic language to convey confidence in the writing."},{id:"friendly",label:o$8(te,"Friendly"),prompt:"Improve using friendly, comforting language, to convey understanding and empathy."}]},{groupId:"changeStyle",groupLabel:o$8(te,"Change style"),commands:[{id:"business",label:o$8(te,"Business"),prompt:"Rewrite this content as a business professional with formal language."},{id:"legal",label:o$8(te,"Legal"),prompt:"Rewrite this content as a legal professional using valid legal terminology."},{id:"journalism",label:o$8(te,"Journalism"),prompt:"Rewrite this content as a journalist using engaging language to convey the importance of the information."},{id:"poetic",label:o$8(te,"Poetic"),prompt:"Rewrite this content as a poem using poetic techniques without losing the original meaning."}]},{groupId:"translate",groupLabel:o$8(te,"Translate"),commands:[{id:"translateEnglish",label:o$8(te,"Translate to %0",[o$8(te,"English")]),prompt:"Translate the content to English language."},{id:"translateSpanish",label:o$8(te,"Translate to %0",[o$8(te,"Spanish")]),prompt:"Translate the content to Spanish language."},{id:"translatePortuguese",label:o$8(te,"Translate to %0",[o$8(te,"Portuguese")]),prompt:"Translate the content to Portuguese language."},{id:"translateGerman",label:o$8(te,"Translate to %0",[o$8(te,"German")]),prompt:"Translate the content to German language."},{id:"translateFrench",label:o$8(te,"Translate to %0",[o$8(te,"French")]),prompt:"Translate the content to French language."},{id:"translateChinese",label:o$8(te,"Translate to %0",[o$8(te,"Simplified Chinese")]),prompt:"Translate the content to Simplified Chinese language."},{id:"translateHindi",label:o$8(te,"Translate to %0",[o$8(te,"Hindi")]),prompt:"Translate the content to Hindi language."},{id:"translateArabic",label:o$8(te,"Translate to %0",[o$8(te,"Arabic")]),prompt:"Translate the content to Arabic language."}]}]),t.define("ai.aiAssistant.extraCommandGroups",[]),t.define("ai.aiAssistant.removeCommands",[]);const be=t.get("ai.aiAssistant.commands"),xe=t.get("ai.aiAssistant.extraCommandGroups"),ve=t.get("ai.aiAssistant.removeCommands");xe.forEach(ke=>{const Ie=be.find(Ae=>Ae.groupId===ke.groupId);Ie?Ie.commands=Ie.commands.concat(ke.commands):be.push(ke)}),be.forEach(ke=>{ke.commands=ke.commands.filter(Ie=>!ve.includes(Ie.id))}),t.set("ai.aiAssistant.commands",be)}init(){const we=this.editor;this.licenseKey=we.config.get("licenseKey"),this._licenseKeyCheckInterval=setInterval(()=>{let t;for(const te in we){const be=te,xe=we[be];if(xe==="aiLicenseKeyTrial"||xe==="aiLicenseKeyInvalid"||xe==="aiLicenseKeyValid"||xe==="aiLicenseKeyTrialLimit:operations"){delete we[be],t=xe;break}}if(t==="aiLicenseKeyInvalid")throw clearInterval(this._licenseKeyCheckInterval),new CKEditorError("ai-invalid-license-key",null);if(t==="aiLicenseKeyTrial"&&console.info("You are using the trial version of CKEditor 5 ai plugin with limited usage. Make sure you will not use it in the production environment."),t==="aiLicenseKeyTrialLimit:operations")throw clearInterval(this._licenseKeyCheckInterval),new CKEditorError("ai-trial-license-key-reached-limit-changes",null);t==="aiLicenseKeyValid"&&clearInterval(this._licenseKeyCheckInterval)},1e3)}destroy(){this._licenseKeyCheckInterval&&clearInterval(this._licenseKeyCheckInterval)}},P$3=class extends Plugin{constructor(t){super(t);Re(this,"abortController");this.abortController=new AbortController}static get requires(){return[y$7]}init(){this.editor.plugins.get(y$7).textAdapter=this}abort(){this.abortController.signal.aborted||(this.abortController.abort(),this.abortController=new AbortController)}async makeRequest(t){return this.sendRequest(t).catch(te=>{if(te instanceof R$4)return Promise.reject(te);if(te.name=="AbortError")return Promise.resolve();throw console.error(te),new CKEditorError("aitextadapter-send-request-failed",null)})}async _prepareRequestHeaders(t,te){const be=this.editor.locale,xe={"Content-Type":"application/json"};if(typeof t=="object")Object.assign(xe,t);else if(t)try{const ve=await t(te);Object.assign(xe,ve)}catch{return Promise.reject(new R$4(o$8(be,"AI_ERROR_GET_HEADERS")))}return xe}async _prepareRequestParameters(t,te){const be=this.editor.locale;if(typeof t=="object")return t;try{return await t(te)}catch{return Promise.reject(new R$4(o$8(be,"AI_ERROR_GET_PARAMETERS")))}}},F$5=class extends P$3{constructor(t){super(t);Re(this,"_apiUrl");Re(this,"_requestHeaders");Re(this,"_requestParameters");t.config.define("ai.openAI.apiUrl","https://api.openai.com/v1/chat/completions"),t.config.get("ai.openAI.requestParameters")||t.config.define("ai.openAI.requestParameters",{model:"gpt-3.5-turbo",max_tokens:2e3,temperature:1,top_p:1,stream:!0}),this._apiUrl=t.config.get("ai.openAI.apiUrl"),this._requestHeaders=t.config.get("ai.openAI.requestHeaders")||{},this._requestParameters=t.config.get("ai.openAI.requestParameters")}static get pluginName(){return"OpenAITextAdapter"}async sendRequest({query:t,context:te,onData:be,actionId:xe}){const ve=this.editor.locale,ke=await this.prepareMessages(t,te,xe),Ie=await this._prepareRequestHeaders(this._requestHeaders,xe),Ae=await this._prepareRequestParameters(this._requestParameters,xe),Se={messages:ke,...Ae},Oe={method:"POST",headers:Ie,body:JSON.stringify(Se),signal:this.abortController.signal},Ve=await fetch(this._apiUrl,Oe);if(Ve.ok)return Ae.stream?await this._readStreamableResponse(Ve,be):await this._readStaticResponse(Ve,be),Promise.resolve();{const Me=await Ve.text();return Me.includes("context_length_exceeded")?Promise.reject(new R$4(o$8(ve,"AI_ERROR_CONTEXT_LENGTH"))):Me.includes("Moderation")?Promise.reject(new R$4(o$8(ve,"AI_ERROR_MODERATION"))):Promise.reject(new Error(Me))}}async prepareMessages(t,te,be){let xe,ve;return te?(xe="Your task is to execute the instruction using the provided HTML content. Follow the instruction closely. Your answer must be a properly formatted HTML code. Do not add any additional remarks or notes. Do not act like a chatbot or a real person.",ve=`Instruction:
`+t+`
You must keep the text formatting.

Content:
`+te):(xe="Your task is to generate HTML content accordingly to the given instruction. Never include <img> tag in your response even if asked for. Your answer must be a well-structured and properly formatted HTML code. Answer only with the generated HTML content. Do not add any additional remarks or notes. Do not act like a chatbot or a real person.",ve=t),[{role:"system",content:xe},{role:"user",content:ve}]}async _readStreamableResponse(t,te){const be=t.body.getReader(),xe=new TextDecoder;let ve="",ke="",Ie="",Ae=!1;for(;!Ae;){const{done:Se,value:Oe}=await be.read(),Ve=ve+xe.decode(Oe);let Me="";Ae=Se;try{Me=this._cleanUpData(Ve),ve=""}catch{ve=Ve;continue}ke+=Me,!Ae&&this._isBufferIncomplete(ke)||ke&&(Ie+=ke,ke="",te(Ie))}return Promise.resolve()}async _readStaticResponse(t,te){return te((await t.json()).choices[0].message.content),Promise.resolve()}_isBufferIncomplete(t){const te=t.split("<").length!==t.split(">").length,be=t.length<30;return te&&be}_cleanUpData(t){return t.split(/\n(?![^{]*\})/g).map(te=>te.replace("data: ","")).filter(te=>te&&te.length>0&&te!=="[DONE]").map(te=>{const{choices:be}=JSON.parse(te);if(be[0]&&be[0].delta&&be[0].delta.content)return be[0].delta.content}).filter(te=>te).join("")}},r$a=class extends Command{constructor(t,te){super(t);Re(this,"_transformCallback");this._transformCallback=te}execute(){const t=this.editor.model,te=Array.from(this._getAffectedRanges()),be=Array.from(t.document.selection.getRanges());t.change(xe=>{for(const ve of te)this._modifyContent(ve,xe);xe.setSelection(be)})}refresh(){for(const t of this._getAffectedRanges())for(const te of t)if(te.item.is("$textProxy"))return void(this.isEnabled=!0);this.isEnabled=!1}_getAffectedRanges(){const t=this.editor.model,te=t.document.selection;if(te.isCollapsed){const be=this._findAncestorTextBlock(te.getFirstPosition().parent);return be?[t.createRangeIn(be)]:[]}return te.getRanges()}_modifyContent(t,te){for(const be of this._getElementsAllowingText(t)){const xe=this._getElementTextContent(be),ve=this._transformCallback(xe);for(const ke of this._getTextNodesRangeLimited(be,t))this._replaceTextNodeData(ke,ve,te)}}_findAncestorTextBlock(t){const te=this.editor.model.schema;if(t.is("element")&&te.checkChild(t,"$text"))return t;const be=t.parent;return!be||te.isLimit(t)?null:this._findAncestorTextBlock(be)}*_getElementsAllowingText(t){const te=new Set;for(const{item:be}of t.getWalker()){const xe=this._findAncestorTextBlock(be);xe&&!te.has(xe)&&(te.add(xe),yield xe)}}_getElementTextContent(t){return Array.from(t.getChildren()).reduce((te,be)=>te+(be.is("$text")?be.data:" "),"")}*_getTextNodesRangeLimited(t,te){const be=te.getIntersection(this.editor.model.createRangeIn(t));if(be)for(const xe of be.getItems())xe.is("$textProxy")&&xe.parent==t&&(yield xe)}_replaceTextNodeData(t,te,be){const xe=te.substring(t.startOffset,t.endOffset);if(xe===t.data)return;const ve=t.getAttributes();this.editor.model.insertContent(be.createText(xe,ve),be.createSelection(be.createRangeOn(t)))}},s$9=class extends Plugin{constructor(){super(...arguments);Re(this,"_currentCommandIndex",0)}static get pluginName(){return"CaseChangeEditing"}init(){const t=this.editor,te=t.locale.contentLanguage,be=function(ve=[]){return typeof ve=="function"?ve:(ke,{wordIndex:Ie})=>Ie>0&&ve.includes(ke)}(t.config.get("caseChange.titleCase.excludeWords")),xe={changeCaseUpper:new r$a(t,ve=>ve.toLocaleUpperCase(te)),changeCaseLower:new r$a(t,ve=>ve.toLocaleLowerCase(te)),changeCaseTitle:new r$a(t,ve=>function(ke,Ie,Ae){return function(Se,Oe){let Ve="",Me=0,De=0;for(const Be of Se.matchAll(/ +/g)){const $e=Be.index,Ue=Se.substring(Me,$e);Ue.length&&(Ve+=Oe(Ue,Me,De++)),Ve+=Be[0],Me=$e+Be[0].length}const Fe=Se.substring(Me);return Fe.length&&(Ve+=Oe(Fe,Me,De)),Ve}(ke,(Se,Oe,Ve)=>{const Me=Se.toLocaleLowerCase(Ae);return Ie(Me,{charOffset:Oe,wordIndex:Ve,blockText:ke})?Me:Me.replace(new RegExp("(?:^|[^\\p{L}\\d'])\\p{L}","gu"),De=>De.toLocaleUpperCase(Ae))})}(ve,be,te))};for(const[ve,ke]of Object.entries(xe))t.commands.add(ve,ke),ke.on("execute",()=>{this._announceCaseChangeOperation(ve)});this.listenTo(t.editing.view.document,"selectionChange",()=>{this._currentCommandIndex=0}),t.keystrokes.set("shift+f3",(ve,ke)=>{const Ie=g$3(this.editor.t),Ae=Ie[this._currentCommandIndex%Ie.length].commandName;t.execute(Ae),this._currentCommandIndex++,ke()})}_announceCaseChangeOperation(t){const{t:te,ui:be}=this.editor,xe=g$3(te).find(ve=>ve.commandName===t).label.toLowerCase();be.ariaLiveAnnouncer.announce(te("Changed case to %0",xe))}};function g$3(Te){return[{label:Te("UPPERCASE"),commandName:"changeCaseUpper"},{label:Te("lowercase"),commandName:"changeCaseLower"},{label:Te("Title Case"),commandName:"changeCaseTitle"}]}let n$6=class extends Plugin{static get pluginName(){return"CaseChangeUI"}init(){const we=this.editor,t=we.t;this._registerComponents(),we.accessibility.addKeystrokeInfos({keystrokes:[{label:t("Change text case"),keystroke:"Shift+f3",mayRequireFn:!0}]})}afterInit(){(function(we){function t(be,xe,ve){const ke={};ke[te([110,117,109,98,101,114,79,102,82,111,117,110,100,115])]={16:10,24:12,32:14},ke[te([114,99,111,110])]=[1,2,4,8,16,32,64,128,27,54,108,216,171,77,154,47,94,188,99,198,151,53,106,212,179,125,250,239,197,145],ke[te([83])]=[99,124,119,123,242,107,111,197,48,1,103,43,254,215,171,118,202,130,201,125,250,89,71,240,173,212,162,175,156,164,114,192,183,253,147,38,54,63,247,204,52,165,229,241,113,216,49,21,4,199,35,195,24,150,5,154,7,18,128,226,235,39,178,117,9,131,44,26,27,110,90,160,82,59,214,179,41,227,47,132,83,209,0,237,32,252,177,91,106,203,190,57,74,76,88,207,208,239,170,251,67,77,51,133,69,249,2,127,80,60,159,168,81,163,64,143,146,157,56,245,188,182,218,33,16,255,243,210,205,12,19,236,95,151,68,23,196,167,126,61,100,93,25,115,96,129,79,220,34,42,144,136,70,238,184,20,222,94,11,219,224,50,58,10,73,6,36,92,194,211,172,98,145,149,228,121,231,200,55,109,141,213,78,169,108,86,244,234,101,122,174,8,186,120,37,46,28,166,180,198,232,221,116,31,75,189,139,138,112,62,181,102,72,3,246,14,97,53,87,185,134,193,29,158,225,248,152,17,105,217,142,148,155,30,135,233,206,85,40,223,140,161,137,13,191,230,66,104,65,153,45,15,176,84,187,22],ke[te([84,49])]=[3328402341,4168907908,4000806809,4135287693,4294111757,3597364157,3731845041,2445657428,1613770832,33620227,3462883241,1445669757,3892248089,3050821474,1303096294,3967186586,2412431941,528646813,2311702848,4202528135,4026202645,2992200171,2387036105,4226871307,1101901292,3017069671,1604494077,1169141738,597466303,1403299063,3832705686,2613100635,1974974402,3791519004,1033081774,1277568618,1815492186,2118074177,4126668546,2211236943,1748251740,1369810420,3521504564,4193382664,3799085459,2883115123,1647391059,706024767,134480908,2512897874,1176707941,2646852446,806885416,932615841,168101135,798661301,235341577,605164086,461406363,3756188221,3454790438,1311188841,2142417613,3933566367,302582043,495158174,1479289972,874125870,907746093,3698224818,3025820398,1537253627,2756858614,1983593293,3084310113,2108928974,1378429307,3722699582,1580150641,327451799,2790478837,3117535592,0,3253595436,1075847264,3825007647,2041688520,3059440621,3563743934,2378943302,1740553945,1916352843,2487896798,2555137236,2958579944,2244988746,3151024235,3320835882,1336584933,3992714006,2252555205,2588757463,1714631509,293963156,2319795663,3925473552,67240454,4269768577,2689618160,2017213508,631218106,1269344483,2723238387,1571005438,2151694528,93294474,1066570413,563977660,1882732616,4059428100,1673313503,2008463041,2950355573,1109467491,537923632,3858759450,4260623118,3218264685,2177748300,403442708,638784309,3287084079,3193921505,899127202,2286175436,773265209,2479146071,1437050866,4236148354,2050833735,3362022572,3126681063,840505643,3866325909,3227541664,427917720,2655997905,2749160575,1143087718,1412049534,999329963,193497219,2353415882,3354324521,1807268051,672404540,2816401017,3160301282,369822493,2916866934,3688947771,1681011286,1949973070,336202270,2454276571,201721354,1210328172,3093060836,2680341085,3184776046,1135389935,3294782118,965841320,831886756,3554993207,4068047243,3588745010,2345191491,1849112409,3664604599,26054028,2983581028,2622377682,1235855840,3630984372,2891339514,4092916743,3488279077,3395642799,4101667470,1202630377,268961816,1874508501,4034427016,1243948399,1546530418,941366308,1470539505,1941222599,2546386513,3421038627,2715671932,3899946140,1042226977,2521517021,1639824860,227249030,260737669,3765465232,2084453954,1907733956,3429263018,2420656344,100860677,4160157185,470683154,3261161891,1781871967,2924959737,1773779408,394692241,2579611992,974986535,664706745,3655459128,3958962195,731420851,571543859,3530123707,2849626480,126783113,865375399,765172662,1008606754,361203602,3387549984,2278477385,2857719295,1344809080,2782912378,59542671,1503764984,160008576,437062935,1707065306,3622233649,2218934982,3496503480,2185314755,697932208,1512910199,504303377,2075177163,2824099068,1841019862,739644986],ke[te([84,50])]=[2781242211,2230877308,2582542199,2381740923,234877682,3184946027,2984144751,1418839493,1348481072,50462977,2848876391,2102799147,434634494,1656084439,3863849899,2599188086,1167051466,2636087938,1082771913,2281340285,368048890,3954334041,3381544775,201060592,3963727277,1739838676,4250903202,3930435503,3206782108,4149453988,2531553906,1536934080,3262494647,484572669,2923271059,1783375398,1517041206,1098792767,49674231,1334037708,1550332980,4098991525,886171109,150598129,2481090929,1940642008,1398944049,1059722517,201851908,1385547719,1699095331,1587397571,674240536,2704774806,252314885,3039795866,151914247,908333586,2602270848,1038082786,651029483,1766729511,3447698098,2682942837,454166793,2652734339,1951935532,775166490,758520603,3000790638,4004797018,4217086112,4137964114,1299594043,1639438038,3464344499,2068982057,1054729187,1901997871,2534638724,4121318227,1757008337,0,750906861,1614815264,535035132,3363418545,3988151131,3201591914,1183697867,3647454910,1265776953,3734260298,3566750796,3903871064,1250283471,1807470800,717615087,3847203498,384695291,3313910595,3617213773,1432761139,2484176261,3481945413,283769337,100925954,2180939647,4037038160,1148730428,3123027871,3813386408,4087501137,4267549603,3229630528,2315620239,2906624658,3156319645,1215313976,82966005,3747855548,3245848246,1974459098,1665278241,807407632,451280895,251524083,1841287890,1283575245,337120268,891687699,801369324,3787349855,2721421207,3431482436,959321879,1469301956,4065699751,2197585534,1199193405,2898814052,3887750493,724703513,2514908019,2696962144,2551808385,3516813135,2141445340,1715741218,2119445034,2872807568,2198571144,3398190662,700968686,3547052216,1009259540,2041044702,3803995742,487983883,1991105499,1004265696,1449407026,1316239930,504629770,3683797321,168560134,1816667172,3837287516,1570751170,1857934291,4014189740,2797888098,2822345105,2754712981,936633572,2347923833,852879335,1133234376,1500395319,3084545389,2348912013,1689376213,3533459022,3762923945,3034082412,4205598294,133428468,634383082,2949277029,2398386810,3913789102,403703816,3580869306,2297460856,1867130149,1918643758,607656988,4049053350,3346248884,1368901318,600565992,2090982877,2632479860,557719327,3717614411,3697393085,2249034635,2232388234,2430627952,1115438654,3295786421,2865522278,3633334344,84280067,33027830,303828494,2747425121,1600795957,4188952407,3496589753,2434238086,1486471617,658119965,3106381470,953803233,334231800,3005978776,857870609,3151128937,1890179545,2298973838,2805175444,3056442267,574365214,2450884487,550103529,1233637070,4289353045,2018519080,2057691103,2399374476,4166623649,2148108681,387583245,3664101311,836232934,3330556482,3100665960,3280093505,2955516313,2002398509,287182607,3413881008,4238890068,3597515707,975967766],ke[te([84,51])]=[1671808611,2089089148,2006576759,2072901243,4061003762,1807603307,1873927791,3310653893,810573872,16974337,1739181671,729634347,4263110654,3613570519,2883997099,1989864566,3393556426,2191335298,3376449993,2106063485,4195741690,1508618841,1204391495,4027317232,2917941677,3563566036,2734514082,2951366063,2629772188,2767672228,1922491506,3227229120,3082974647,4246528509,2477669779,644500518,911895606,1061256767,4144166391,3427763148,878471220,2784252325,3845444069,4043897329,1905517169,3631459288,827548209,356461077,67897348,3344078279,593839651,3277757891,405286936,2527147926,84871685,2595565466,118033927,305538066,2157648768,3795705826,3945188843,661212711,2999812018,1973414517,152769033,2208177539,745822252,439235610,455947803,1857215598,1525593178,2700827552,1391895634,994932283,3596728278,3016654259,695947817,3812548067,795958831,2224493444,1408607827,3513301457,0,3979133421,543178784,4229948412,2982705585,1542305371,1790891114,3410398667,3201918910,961245753,1256100938,1289001036,1491644504,3477767631,3496721360,4012557807,2867154858,4212583931,1137018435,1305975373,861234739,2241073541,1171229253,4178635257,33948674,2139225727,1357946960,1011120188,2679776671,2833468328,1374921297,2751356323,1086357568,2408187279,2460827538,2646352285,944271416,4110742005,3168756668,3066132406,3665145818,560153121,271589392,4279952895,4077846003,3530407890,3444343245,202643468,322250259,3962553324,1608629855,2543990167,1154254916,389623319,3294073796,2817676711,2122513534,1028094525,1689045092,1575467613,422261273,1939203699,1621147744,2174228865,1339137615,3699352540,577127458,712922154,2427141008,2290289544,1187679302,3995715566,3100863416,339486740,3732514782,1591917662,186455563,3681988059,3762019296,844522546,978220090,169743370,1239126601,101321734,611076132,1558493276,3260915650,3547250131,2901361580,1655096418,2443721105,2510565781,3828863972,2039214713,3878868455,3359869896,928607799,1840765549,2374762893,3580146133,1322425422,2850048425,1823791212,1459268694,4094161908,3928346602,1706019429,2056189050,2934523822,135794696,3134549946,2022240376,628050469,779246638,472135708,2800834470,3032970164,3327236038,3894660072,3715932637,1956440180,522272287,1272813131,3185336765,2340818315,2323976074,1888542832,1044544574,3049550261,1722469478,1222152264,50660867,4127324150,236067854,1638122081,895445557,1475980887,3117443513,2257655686,3243809217,489110045,2662934430,3778599393,4162055160,2561878936,288563729,1773916777,3648039385,2391345038,2493985684,2612407707,505560094,2274497927,3911240169,3460925390,1442818645,678973480,3749357023,2358182796,2717407649,2306869641,219617805,3218761151,3862026214,1120306242,1756942440,1103331905,2578459033,762796589,252780047,2966125488,1425844308,3151392187,372911126],ke[te([84,52])]=[1667474886,2088535288,2004326894,2071694838,4075949567,1802223062,1869591006,3318043793,808472672,16843522,1734846926,724270422,4278065639,3621216949,2880169549,1987484396,3402253711,2189597983,3385409673,2105378810,4210693615,1499065266,1195886990,4042263547,2913856577,3570689971,2728590687,2947541573,2627518243,2762274643,1920112356,3233831835,3082273397,4261223649,2475929149,640051788,909531756,1061110142,4160160501,3435941763,875846760,2779116625,3857003729,4059105529,1903268834,3638064043,825316194,353713962,67374088,3351728789,589522246,3284360861,404236336,2526454071,84217610,2593830191,117901582,303183396,2155911963,3806477791,3958056653,656894286,2998062463,1970642922,151591698,2206440989,741110872,437923380,454765878,1852748508,1515908788,2694904667,1381168804,993742198,3604373943,3014905469,690584402,3823320797,791638366,2223281939,1398011302,3520161977,0,3991743681,538992704,4244381667,2981218425,1532751286,1785380564,3419096717,3200178535,960056178,1246420628,1280103576,1482221744,3486468741,3503319995,4025428677,2863326543,4227536621,1128514950,1296947098,859002214,2240123921,1162203018,4193849577,33687044,2139062782,1347481760,1010582648,2678045221,2829640523,1364325282,2745433693,1077985408,2408548869,2459086143,2644360225,943212656,4126475505,3166494563,3065430391,3671750063,555836226,269496352,4294908645,4092792573,3537006015,3452783745,202118168,320025894,3974901699,1600119230,2543297077,1145359496,387397934,3301201811,2812801621,2122220284,1027426170,1684319432,1566435258,421079858,1936954854,1616945344,2172753945,1330631070,3705438115,572679748,707427924,2425400123,2290647819,1179044492,4008585671,3099120491,336870440,3739122087,1583276732,185277718,3688593069,3772791771,842159716,976899700,168435220,1229577106,101059084,606366792,1549591736,3267517855,3553849021,2897014595,1650632388,2442242105,2509612081,3840161747,2038008818,3890688725,3368567691,926374254,1835907034,2374863873,3587531953,1313788572,2846482505,1819063512,1448540844,4109633523,3941213647,1701162954,2054852340,2930698567,134748176,3132806511,2021165296,623210314,774795868,471606328,2795958615,3031746419,3334885783,3907527627,3722280097,1953799400,522133822,1263263126,3183336545,2341176845,2324333839,1886425312,1044267644,3048588401,1718004428,1212733584,50529542,4143317495,235803164,1633788866,892690282,1465383342,3115962473,2256965911,3250673817,488449850,2661202215,3789633753,4177007595,2560144171,286339874,1768537042,3654906025,2391705863,2492770099,2610673197,505291324,2273808917,3924369609,3469625735,1431699370,673740880,3755965093,2358021891,2711746649,2307489801,218961690,3217021541,3873845719,1111672452,1751693520,1094828930,2576986153,757954394,252645662,2964376443,1414855848,3149649517,370555436],ke[te([85,49])]=[0,235474187,470948374,303765277,941896748,908933415,607530554,708780849,1883793496,2118214995,1817866830,1649639237,1215061108,1181045119,1417561698,1517767529,3767586992,4003061179,4236429990,4069246893,3635733660,3602770327,3299278474,3400528769,2430122216,2664543715,2362090238,2193862645,2835123396,2801107407,3035535058,3135740889,3678124923,3576870512,3341394285,3374361702,3810496343,3977675356,4279080257,4043610186,2876494627,2776292904,3076639029,3110650942,2472011535,2640243204,2403728665,2169303058,1001089995,899835584,666464733,699432150,59727847,226906860,530400753,294930682,1273168787,1172967064,1475418501,1509430414,1942435775,2110667444,1876241833,1641816226,2910219766,2743034109,2976151520,3211623147,2505202138,2606453969,2302690252,2269728455,3711829422,3543599269,3240894392,3475313331,3843699074,3943906441,4178062228,4144047775,1306967366,1139781709,1374988112,1610459739,1975683434,2076935265,1775276924,1742315127,1034867998,866637845,566021896,800440835,92987698,193195065,429456164,395441711,1984812685,2017778566,1784663195,1683407248,1315562145,1080094634,1383856311,1551037884,101039829,135050206,437757123,337553864,1042385657,807962610,573804783,742039012,2531067453,2564033334,2328828971,2227573024,2935566865,2700099354,3001755655,3168937228,3868552805,3902563182,4203181171,4102977912,3736164937,3501741890,3265478751,3433712980,1106041591,1340463100,1576976609,1408749034,2043211483,2009195472,1708848333,1809054150,832877231,1068351396,766945465,599762354,159417987,126454664,361929877,463180190,2709260871,2943682380,3178106961,3009879386,2572697195,2538681184,2236228733,2336434550,3509871135,3745345300,3441850377,3274667266,3910161971,3877198648,4110568485,4211818798,2597806476,2497604743,2261089178,2295101073,2733856160,2902087851,3202437046,2968011453,3936291284,3835036895,4136440770,4169408201,3535486456,3702665459,3467192302,3231722213,2051518780,1951317047,1716890410,1750902305,1113818384,1282050075,1584504582,1350078989,168810852,67556463,371049330,404016761,841739592,1008918595,775550814,540080725,3969562369,3801332234,4035489047,4269907996,3569255213,3669462566,3366754619,3332740144,2631065433,2463879762,2160117071,2395588676,2767645557,2868897406,3102011747,3069049960,202008497,33778362,270040487,504459436,875451293,975658646,675039627,641025152,2084704233,1917518562,1615861247,1851332852,1147550661,1248802510,1484005843,1451044056,933301370,967311729,733156972,632953703,260388950,25965917,328671808,496906059,1206477858,1239443753,1543208500,1441952575,2144161806,1908694277,1675577880,1842759443,3610369226,3644379585,3408119516,3307916247,4011190502,3776767469,4077384432,4245618683,2809771154,2842737049,3144396420,3043140495,2673705150,2438237621,2203032232,2370213795],ke[te([85,50])]=[0,185469197,370938394,487725847,741876788,657861945,975451694,824852259,1483753576,1400783205,1315723890,1164071807,1950903388,2135319889,1649704518,1767536459,2967507152,3152976349,2801566410,2918353863,2631447780,2547432937,2328143614,2177544179,3901806776,3818836405,4270639778,4118987695,3299409036,3483825537,3535072918,3652904859,2077965243,1893020342,1841768865,1724457132,1474502543,1559041666,1107234197,1257309336,598438867,681933534,901210569,1052338372,261314535,77422314,428819965,310463728,3409685355,3224740454,3710368113,3593056380,3875770207,3960309330,4045380933,4195456072,2471224067,2554718734,2237133081,2388260884,3212035895,3028143674,2842678573,2724322336,4138563181,4255350624,3769721975,3955191162,3667219033,3516619604,3431546947,3347532110,2933734917,2782082824,3099667487,3016697106,2196052529,2313884476,2499348523,2683765030,1179510461,1296297904,1347548327,1533017514,1786102409,1635502980,2087309459,2003294622,507358933,355706840,136428751,53458370,839224033,957055980,605657339,790073846,2373340630,2256028891,2607439820,2422494913,2706270690,2856345839,3075636216,3160175349,3573941694,3725069491,3273267108,3356761769,4181598602,4063242375,4011996048,3828103837,1033297158,915985419,730517276,545572369,296679730,446754879,129166120,213705253,1709610350,1860738147,1945798516,2029293177,1239331162,1120974935,1606591296,1422699085,4148292826,4233094615,3781033664,3931371469,3682191598,3497509347,3446004468,3328955385,2939266226,2755636671,3106780840,2988687269,2198438022,2282195339,2501218972,2652609425,1201765386,1286567175,1371368976,1521706781,1805211710,1620529459,2105887268,1988838185,533804130,350174575,164439672,46346101,870912086,954669403,636813900,788204353,2358957921,2274680428,2592523643,2441661558,2695033685,2880240216,3065962831,3182487618,3572145929,3756299780,3270937875,3388507166,4174560061,4091327024,4006521127,3854606378,1014646705,930369212,711349675,560487590,272786309,457992840,106852767,223377554,1678381017,1862534868,1914052035,2031621326,1211247597,1128014560,1580087799,1428173050,32283319,182621114,401639597,486441376,768917123,651868046,1003007129,818324884,1503449823,1385356242,1333838021,1150208456,1973745387,2125135846,1673061617,1756818940,2970356327,3120694122,2802849917,2887651696,2637442643,2520393566,2334669897,2149987652,3917234703,3799141122,4284502037,4100872472,3309594171,3460984630,3545789473,3629546796,2050466060,1899603969,1814803222,1730525723,1443857720,1560382517,1075025698,1260232239,575138148,692707433,878443390,1062597235,243256656,91341917,409198410,325965383,3403100636,3252238545,3704300486,3620022987,3874428392,3990953189,4042459122,4227665663,2460449204,2578018489,2226875310,2411029155,3198115200,3046200461,2827177882,2743944855],ke[te([85,51])]=[0,218828297,437656594,387781147,875313188,958871085,775562294,590424639,1750626376,1699970625,1917742170,2135253587,1551124588,1367295589,1180849278,1265195639,3501252752,3720081049,3399941250,3350065803,3835484340,3919042237,4270507174,4085369519,3102249176,3051593425,2734591178,2952102595,2361698556,2177869557,2530391278,2614737639,3145456443,3060847922,2708326185,2892417312,2404901663,2187128086,2504130317,2555048196,3542330227,3727205754,3375740769,3292445032,3876557655,3926170974,4246310725,4027744588,1808481195,1723872674,1910319033,2094410160,1608975247,1391201670,1173430173,1224348052,59984867,244860394,428169201,344873464,935293895,984907214,766078933,547512796,1844882806,1627235199,2011214180,2062270317,1507497298,1423022939,1137477952,1321699145,95345982,145085239,532201772,313773861,830661914,1015671571,731183368,648017665,3175501286,2957853679,2807058932,2858115069,2305455554,2220981195,2474404304,2658625497,3575528878,3625268135,3473416636,3254988725,3778151818,3963161475,4213447064,4130281361,3599595085,3683022916,3432737375,3247465558,3802222185,4020912224,4172763771,4122762354,3201631749,3017672716,2764249623,2848461854,2331590177,2280796200,2431590963,2648976442,104699613,188127444,472615631,287343814,840019705,1058709744,671593195,621591778,1852171925,1668212892,1953757831,2037970062,1514790577,1463996600,1080017571,1297403050,3673637356,3623636965,3235995134,3454686199,4007360968,3822090177,4107101658,4190530515,2997825956,3215212461,2830708150,2779915199,2256734592,2340947849,2627016082,2443058075,172466556,122466165,273792366,492483431,1047239e3,861968209,612205898,695634755,1646252340,1863638845,2013908262,1963115311,1446242576,1530455833,1277555970,1093597963,1636604631,1820824798,2073724613,1989249228,1436590835,1487645946,1337376481,1119727848,164948639,81781910,331544205,516552836,1039717051,821288114,669961897,719700128,2973530695,3157750862,2871682645,2787207260,2232435299,2283490410,2667994737,2450346104,3647212047,3564045318,3279033885,3464042516,3980931627,3762502690,4150144569,4199882800,3070356634,3121275539,2904027272,2686254721,2200818878,2384911031,2570832044,2486224549,3747192018,3528626907,3310321856,3359936201,3950355702,3867060991,4049844452,4234721005,1739656202,1790575107,2108100632,1890328081,1402811438,1586903591,1233856572,1149249077,266959938,48394827,369057872,418672217,1002783846,919489135,567498868,752375421,209336225,24197544,376187827,459744698,945164165,895287692,574624663,793451934,1679968233,1764313568,2117360635,1933530610,1343127501,1560637892,1243112415,1192455638,3704280881,3519142200,3336358691,3419915562,3907448597,3857572124,4075877127,4294704398,3029510009,3113855344,2927934315,2744104290,2159976285,2377486676,2594734927,2544078150],ke[te([85,52])]=[0,151849742,303699484,454499602,607398968,758720310,908999204,1059270954,1214797936,1097159550,1517440620,1400849762,1817998408,1699839814,2118541908,2001430874,2429595872,2581445614,2194319100,2345119218,3034881240,3186202582,2801699524,2951971274,3635996816,3518358430,3399679628,3283088770,4237083816,4118925222,4002861748,3885750714,1002142683,850817237,698445255,548169417,529487843,377642221,227885567,77089521,1943217067,2061379749,1640576439,1757691577,1474760595,1592394909,1174215055,1290801793,2875968315,2724642869,3111247143,2960971305,2405426947,2253581325,2638606623,2487810577,3808662347,3926825029,4044981591,4162096729,3342319475,3459953789,3576539503,3693126241,1986918061,2137062819,1685577905,1836772287,1381620373,1532285339,1078185097,1229899655,1040559837,923313619,740276417,621982671,439452389,322734571,137073913,19308535,3871163981,4021308739,4104605777,4255800159,3263785589,3414450555,3499326569,3651041127,2933202493,2815956275,3167684641,3049390895,2330014213,2213296395,2566595609,2448830231,1305906550,1155237496,1607244650,1455525988,1776460110,1626319424,2079897426,1928707164,96392454,213114376,396673818,514443284,562755902,679998e3,865136418,983426092,3708173718,3557504664,3474729866,3323011204,4180808110,4030667424,3945269170,3794078908,2507040230,2623762152,2272556026,2390325492,2975484382,3092726480,2738905026,2857194700,3973773121,3856137295,4274053469,4157467219,3371096953,3252932727,3673476453,3556361835,2763173681,2915017791,3064510765,3215307299,2156299017,2307622919,2459735317,2610011675,2081048481,1963412655,1846563261,1729977011,1480485785,1362321559,1243905413,1126790795,878845905,1030690015,645401037,796197571,274084841,425408743,38544885,188821243,3613494426,3731654548,3313212038,3430322568,4082475170,4200115116,3780097726,3896688048,2668221674,2516901860,2366882550,2216610296,3141400786,2989552604,2837966542,2687165888,1202797690,1320957812,1437280870,1554391400,1669664834,1787304780,1906247262,2022837584,265905162,114585348,499347990,349075736,736970802,585122620,972512814,821712160,2595684844,2478443234,2293045232,2174754046,3196267988,3079546586,2895723464,2777952454,3537852828,3687994002,3234156416,3385345166,4142626212,4293295786,3841024952,3992742070,174567692,57326082,410887952,292596766,777231668,660510266,1011452712,893681702,1108339068,1258480242,1343618912,1494807662,1715193156,1865862730,1948373848,2100090966,2701949495,2818666809,3004591147,3122358053,2235061775,2352307457,2535604243,2653899549,3915653703,3764988233,4219352155,4067639125,3444575871,3294430577,3746175075,3594982253,836553431,953270745,600235211,718002117,367585007,484830689,133361907,251657213,2041877159,1891211689,1806599355,1654886325,1568718495,1418573201,1335535747,1184342925];const Ie=new Uint8Array(16);for(let Ue=15;Ue>=0;--Ue)Ie[Ue]=ve%256,ve=parseInt(ve/256);let Ae=null,Se=16;const Oe=new Uint8Array(xe),Ve=[],Me=[];$e();for(let Ue=0;Ue<be[te([108,101,110,103,116,104])];Ue++)Se===16&&(Ae=Be(Ie),Se=0,Fe(Ie)),be[Ue]^=Ae[Se++];return be;function De(Ue){const He=[];for(let ze=0;ze<Ue[te([108,101,110,103,116,104])];ze+=4)He[te([112,117,115,104])](Ue[ze]<<24|Ue[ze+1]<<16|Ue[ze+2]<<8|Ue[ze+3]);return He}function Fe(Ue){for(let He=15;He>=0;He--){if(Ue[He]!==255){Ue[He]++;break}Ue[He]=0}}function Be(Ue){const He=Ve[te([108,101,110,103,116,104])]-1,ze=[0,0,0,0];let qe=De(Ue);for(let je=0;je<4;je++)qe[je]^=Ve[0][je];for(let je=1;je<He;je++){for(let Ye=0;Ye<4;Ye++)ze[Ye]=ke[te([84,49])][qe[Ye]>>24&255]^ke[te([84,50])][qe[(Ye+1)%4]>>16&255]^ke[te([84,51])][qe[(Ye+2)%4]>>8&255]^ke[te([84,52])][255&qe[(Ye+3)%4]]^Ve[je][Ye];qe=ze[te([115,108,105,99,101])]()}const Ke=new Uint8Array(16);let Qe;for(let je=0;je<4;je++)Qe=Ve[He][je],Ke[4*je]=255&(ke[te([83])][qe[je]>>24&255]^Qe>>24),Ke[4*je+1]=255&(ke[te([83])][qe[(je+1)%4]>>16&255]^Qe>>16),Ke[4*je+2]=255&(ke[te([83])][qe[(je+2)%4]>>8&255]^Qe>>8),Ke[4*je+3]=255&(ke[te([83])][255&qe[(je+3)%4]]^Qe);return Ke}function $e(){const Ue=ke[te([110,117,109,98,101,114,79,102,82,111,117,110,100,115])][Oe[te([108,101,110,103,116,104])]];for(let ht=0;ht<=Ue;ht++)Ve[te([112,117,115,104])]([0,0,0,0]),Me[te([112,117,115,104])]([0,0,0,0]);const He=4*(Ue+1),ze=Oe[te([108,101,110,103,116,104])]/4,qe=De(Oe);let Ke;for(let ht=0;ht<ze;ht++)Ke=ht>>2,Ve[Ke][ht%4]=qe[ht],Me[Ue-Ke][ht%4]=qe[ht];let Qe,je=0,Ye=ze;for(;Ye<He;){Qe=qe[ze-1],qe[0]^=ke[te([83])][Qe>>16&255]<<24^ke[te([83])][Qe>>8&255]<<16^ke[te([83])][255&Qe]<<8^ke[te([83])][Qe>>24&255]^ke[te([114,99,111,110])][je]<<24,je+=1;for(let Jt=1;Jt<ze/2;Jt++)qe[Jt]^=qe[Jt-1];Qe=qe[ze/2-1],qe[ze/2]^=ke[te([83])][255&Qe]^ke[te([83])][Qe>>8&255]<<8^ke[te([83])][Qe>>16&255]<<16^ke[te([83])][Qe>>24&255]<<24;for(let Jt=ze/2+1;Jt<ze;Jt++)qe[Jt]^=qe[Jt-1];let ht,Ze,Bt=0;for(;Bt<ze&&Ye<He;)ht=Ye>>2,Ze=Ye%4,Ve[ht][Ze]=qe[Bt],Me[Ue-ht][Ze]=qe[Bt++],Ye++}for(let ht=1;ht<Ue;ht++)for(let Ze=0;Ze<4;Ze++)Qe=Me[ht][Ze],Me[ht][Ze]=ke[te([85,49])][Qe>>24&255]^ke[te([85,50])][Qe>>16&255]^ke[te([85,51])][Qe>>8&255]^ke[te([85,52])][255&Qe]}}function te(be){return be.map(xe=>String.fromCharCode(xe)).join("")}(be=>{function xe(){const Ge=[{[te([105,100])]:1,[te([102,101,97,116,117,114,101,78,97,109,101])]:te([67,111,109,109,101,110,116,115]),[te([112,108,117,103,105,110,78,97,109,101])]:te([67,111,109,109,101,110,116,115,82,101,112,111,115,105,116,111,114,121]),[te([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:te([108,105,99,101,110,115,101,75,101,121]),[te([104,97,110,100,108,101,114])]:te([99,104,101,99,107,76,105,99,101,110,115,101]),[te([99,104,101,99,107,65,108,115,111])]:[{[te([105,100])]:2,[te([102,101,97,116,117,114,101,78,97,109,101])]:te([84,114,97,99,107,32,67,104,97,110,103,101,115]),[te([112,108,117,103,105,110,78,97,109,101])]:te([84,114,97,99,107,67,104,97,110,103,101,115,69,100,105,116,105,110,103]),[te([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:te([108,105,99,101,110,115,101,75,101,121]),[te([104,97,110,100,108,101,114])]:te([99,104,101,99,107,76,105,99,101,110,115,101,70,111,114,84,114,97,99,107,67,104,97,110,103,101,115]),[te([111,112,116,105,111,110,115])]:{[te([97,105,119,115,103,105,99])]:!0,[te([97,105,116,99,100,103,105,108])]:!0,[te([97,105,114,118,105,105,108])]:!0}}],[te([111,112,116,105,111,110,115])]:{[te([97,105,119,115,103,105,99])]:!0,[te([97,105,116,99,100,103,105,108])]:!0,[te([97,105,114,118,105,105,108])]:!0}},{[te([105,100])]:3,[te([102,101,97,116,117,114,101,78,97,109,101])]:te([80,97,103,105,110,97,116,105,111,110]),[te([112,108,117,103,105,110,78,97,109,101])]:te([80,97,103,105,110,97,116,105,111,110,76,111,111,107,117,112]),[te([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:te([112,97,103,105,110,97,116,105,111,110,76,105,99,101,110,115,101,75,101,121]),[te([104,97,110,100,108,101,114])]:te([99,104,101,99,107,76,105,99,101,110,115,101])},{[te([105,100])]:4,[te([102,101,97,116,117,114,101,78,97,109,101])]:te([82,101,118,105,115,105,111,110,32,72,105,115,116,111,114,121]),[te([112,108,117,103,105,110,78,97,109,101])]:te([82,101,118,105,115,105,111,110,115,82,101,112,111,115,105,116,111,114,121]),[te([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:te([108,105,99,101,110,115,101,75,101,121]),[te([104,97,110,100,108,101,114])]:te([99,104,101,99,107,76,105,99,101,110,115,101,70,111,114,82,101,118,105,115,105,111,110,72,105,115,116,111,114,121]),[te([111,112,116,105,111,110,115])]:{[te([97,105,119,115,103,105,99])]:!0,[te([97,105,116,99,100,103,105,108])]:!0,[te([97,105,114,118,105,105,108])]:!0}},{[te([105,100])]:5,[te([102,101,97,116,117,114,101,78,97,109,101])]:te([68,111,99,117,109,101,110,116,32,79,117,116,108,105,110,101]),[te([112,108,117,103,105,110,78,97,109,101])]:te([68,111,99,117,109,101,110,116,79,117,116,108,105,110,101,85,73]),[te([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:te([100,111,99,117,109,101,110,116,79,117,116,108,105,110,101,76,105,99,101,110,115,101,75,101,121]),[te([104,97,110,100,108,101,114])]:te([99,104,101,99,107,76,105,99,101,110,115,101]),[te([111,112,116,105,111,110,115])]:{[te([102,103,105])]:[12]}},{[te([105,100])]:6,[te([102,101,97,116,117,114,101,78,97,109,101])]:te([70,111,114,109,97,116,32,80,97,105,110,116,101,114]),[te([112,108,117,103,105,110,78,97,109,101])]:te([70,111,114,109,97,116,80,97,105,110,116,101,114,85,73]),[te([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:te([102,111,114,109,97,116,80,97,105,110,116,101,114,76,105,99,101,110,115,101,75,101,121]),[te([104,97,110,100,108,101,114])]:te([99,104,101,99,107,76,105,99,101,110,115,101]),[te([111,112,116,105,111,110,115])]:{[te([102,103,105])]:[12]}},{[te([105,100])]:7,[te([102,101,97,116,117,114,101,78,97,109,101])]:te([83,108,97,115,104,32,67,111,109,109,97,110,100]),[te([112,108,117,103,105,110,78,97,109,101])]:te([83,108,97,115,104,67,111,109,109,97,110,100,85,73]),[te([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:te([115,108,97,115,104,67,111,109,109,97,110,100,76,105,99,101,110,115,101,75,101,121]),[te([104,97,110,100,108,101,114])]:te([99,104,101,99,107,76,105,99,101,110,115,101]),[te([111,112,116,105,111,110,115])]:{[te([102,103,105])]:[12]}},{[te([105,100])]:8,[te([102,101,97,116,117,114,101,78,97,109,101])]:te([84,97,98,108,101,32,111,102,32,67,111,110,116,101,110,116,115]),[te([112,108,117,103,105,110,78,97,109,101])]:te([84,97,98,108,101,79,102,67,111,110,116,101,110,116,115,69,100,105,116,105,110,103]),[te([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:te([116,97,98,108,101,79,102,67,111,110,116,101,110,116,115,76,105,99,101,110,115,101,75,101,121]),[te([104,97,110,100,108,101,114])]:te([99,104,101,99,107,76,105,99,101,110,115,101]),[te([111,112,116,105,111,110,115])]:{[te([102,103,105])]:[12]}},{[te([105,100])]:9,[te([102,101,97,116,117,114,101,78,97,109,101])]:te([84,101,109,112,108,97,116,101]),[te([112,108,117,103,105,110,78,97,109,101])]:te([84,101,109,112,108,97,116,101,85,73]),[te([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:te([116,101,109,112,108,97,116,101,76,105,99,101,110,115,101,75,101,121]),[te([104,97,110,100,108,101,114])]:te([99,104,101,99,107,76,105,99,101,110,115,101]),[te([111,112,116,105,111,110,115])]:{[te([102,103,105])]:[12,14]}},{[te([105,100])]:10,[te([102,101,97,116,117,114,101,78,97,109,101])]:te([80,97,115,116,101,32,102,114,111,109,32,79,102,102,105,99,101,32,69,110,104,97,110,99,101,100]),[te([112,108,117,103,105,110,78,97,109,101])]:te([80,97,115,116,101,70,114,111,109,79,102,102,105,99,101,69,110,104,97,110,99,101,100,73,110,108,105,110,101,114]),[te([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:te([112,97,115,116,101,70,114,111,109,79,102,102,105,99,101,69,110,104,97,110,99,101,100,76,105,99,101,110,115,101,75,101,121]),[te([104,97,110,100,108,101,114])]:te([99,104,101,99,107,76,105,99,101,110,115,101]),[te([111,112,116,105,111,110,115])]:{[te([102,103,105])]:[12]}},{[te([105,100])]:11,[te([102,101,97,116,117,114,101,78,97,109,101])]:te([65,73,32,65,115,115,105,115,116,97,110,116]),[te([112,108,117,103,105,110,78,97,109,101])]:te([65,73,65,115,115,105,115,116,97,110,116,85,73]),[te([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:te([97,105,76,105,99,101,110,115,101,75,101,121]),[te([104,97,110,100,108,101,114])]:te([99,104,101,99,107,76,105,99,101,110,115,101])},{[te([105,100])]:12,[te([102,101,97,116,117,114,101,78,97,109,101])]:te([80,114,111,100,117,99,116,105,118,105,116,121,32,112,97,99,107])},{[te([105,100])]:13,[te([102,101,97,116,117,114,101,78,97,109,101])]:te([67,97,115,101,32,67,104,97,110,103,101]),[te([112,108,117,103,105,110,78,97,109,101])]:te([67,97,115,101,67,104,97,110,103,101,85,73]),[te([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:te([99,97,115,101,67,104,97,110,103,101,76,105,99,101,110,115,101,75,101,121]),[te([104,97,110,100,108,101,114])]:te([99,104,101,99,107,76,105,99,101,110,115,101]),[te([111,112,116,105,111,110,115])]:{[te([102,103,105])]:[12]}},{[te([105,100])]:14,[te([102,101,97,116,117,114,101,78,97,109,101])]:te([68,114,117,112,97,108,32,112,97,99,107]),[te([102,111,114,98,105,100,100,101,110,72,97,110,100,108,101,114])]:te([102,111,114,98,105,100,100,101,110,72,97,110,100,108,101,114,70,111,114,68,114,117,112,97,108])},{[te([105,100])]:15,[te([102,101,97,116,117,114,101,78,97,109,101])]:te([77,117,108,116,105,32,76,101,118,101,108,32,76,105,115,116]),[te([112,108,117,103,105,110,78,97,109,101])]:te([77,117,108,116,105,76,101,118,101,108,76,105,115,116,69,100,105,116,105,110,103]),[te([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:te([109,117,108,116,105,76,101,118,101,108,76,105,115,116,76,105,99,101,110,115,101,75,101,121]),[te([104,97,110,100,108,101,114])]:te([99,104,101,99,107,76,105,99,101,110,115,101])},{[te([105,100])]:16,[te([102,101,97,116,117,114,101,78,97,109,101])]:te([77,101,114,103,101,32,70,105,101,108,100,115]),[te([112,108,117,103,105,110,78,97,109,101])]:te([77,101,114,103,101,70,105,101,108,100,115,85,73]),[te([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:te([109,101,114,103,101,70,105,101,108,100,115,76,105,99,101,110,115,101,75,101,121]),[te([104,97,110,100,108,101,114])]:te([99,104,101,99,107,76,105,99,101,110,115,101]),[te([111,112,116,105,111,110,115])]:{[te([102,103,105])]:[12]}}];return Le(Ge),Ge;function Ne(We){return 1<<We-1}function Le(We){We[te([102,111,114,69,97,99,104])](Je=>{Je[te([112,101,114,109,105,115,115,105,111,110,77,97,115,107])]=Ne(Je[te([105,100])]),ve(Je)&&Je[te([99,104,101,99,107,65,108,115,111])]&&Le(Je[te([99,104,101,99,107,65,108,115,111])])})}}function ve(Ge){return te([112,108,117,103,105,110,78,97,109,101])in Ge}const ke=[1,85,78,115,198,255,50,112,83,87,161],Ie=[127,34,6,211,167,86,146,199,132,160,18];function Ae(Ge){const Ne=[29,221,175,90,231,133,239,240,75,180];return Se(Ge,new Uint8Array([...ke,...Ne,...Ie]))}function Se(Ge,Ne){const Le=Oe(Ge),We=Array[te([102,114,111,109])](pn(Le)),Je=We[te([112,111,112])](),Wt=We[te([112,111,112])]();return Xt(t(We,Ne,Wt+256*Je))}function Oe(Ge){const Ne=atob(Ge),[Le,We]=Ne[te([115,112,108,105,116])](te([45]));try{if(atob(We))return atob(Le)}catch{}return Ne}function Ve(Ge){try{const Ne=Ae(Ge),Le=JSON[te([112,97,114,115,101])](Ne),We=parseInt(Le[te([49])]),Je=Le[te([50])]||"",Wt=parseInt(Le[te([51])]),nn=parseInt(Le[te([52])])||0,cn=parseInt(Le[te([53])])||0;return{[te([112,114,111,100,117,99,116,78,97,109,101])]:Je,[te([97,108,108,111,119,101,100,80,108,117,103,105,110,115])]:nn,[te([101,120,112,105,114,97,116,105,111,110,68,97,116,101])]:We,[te([105,115,84,114,105,97,108])]:Wt,[te([105,115,73,110,116,101,114,110,97,108])]:cn}}catch{return null}}const Me=xe(),De={[te([99,104,101,99,107,76,105,99,101,110,115,101])]:Ke,[te([99,104,101,99,107,76,105,99,101,110,115,101,70,111,114,84,114,97,99,107,67,104,97,110,103,101,115])]:Qe,[te([99,104,101,99,107,76,105,99,101,110,115,101,70,111,114,82,101,118,105,115,105,111,110,72,105,115,116,111,114,121])]:je},Fe=be[te([99,111,110,115,116,114,117,99,116,111,114])][te([112,108,117,103,105,110,78,97,109,101])],Be=te([99,111,110,116,101,120,116])in be?be.context:be.editor,$e=te([52,48,52,56,49,52,50,50]),Ue=te([65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,48,49,50,51,52,53,54,55,56,57]),He=Be.config.get(te([108,105,99,101,110,115,101,75,101,121])),ze=Me[te([102,105,108,116,101,114])](ve)[te([102,105,110,100])](Ge=>Ge[te([112,108,117,103,105,110,78,97,109,101])]===Fe);function qe(Ge,Ne){De[Ne[te([104,97,110,100,108,101,114])]](Ge,Ne),Ne[te([99,104,101,99,107,65,108,115,111])]&&Ne[te([99,104,101,99,107,65,108,115,111])][te([102,105,108,116,101,114])](Le=>tn(Be,Le[te([112,108,117,103,105,110,78,97,109,101])]))[te([102,111,114,69,97,99,104])](Le=>qe(Ge,Le))}function Ke(Ge,Ne){ht(Ye(Ge,Ne),Ne)}function Qe(Ge,Ne){function Le(We,Je){try{if(tn(Be,te([84,114,97,99,107,67,104,97,110,103,101,115,69,100,105,116,105,110,103]))&&We){const Wt=Kt(Be,te([84,114,97,99,107,67,104,97,110,103,101,115,69,100,105,116,105,110,103]))[te([95,101,120,101,99,117,116,101,83,117,103,103,101,115,116,105,111,110])];if(parseInt(Wt)/2>We[te([101,120,112,105,114,97,116,105,111,110,68,97,116,101])])return Ze(Je[te([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+te([73,110,118,97,108,105,100]))}return Ye(We,Je)}catch{return Ze(Je[te([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+te([73,110,118,97,108,105,100]))}}ht(Le(Ge,Ne),Ne)}function je(Ge,Ne){const Le=Ie[0]*ke[1],We=Ie[0]*ke[2],Je=Ie[2]*ke[2];tn(Be,te([87,101,98,83,111,99,107,101,116,71,97,116,101,119,97,121]))&&Kt(Be,te([87,101,98,83,111,99,107,101,116,71,97,116,101,119,97,121]))[te([115,116,97,116,101])]==te([99,111,110,110,101,99,116,101,100])&&(window[Bt()]=Je);function Wt(zt,Xe){try{return fn()?Ze(Xe[te([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+te([86,97,108,105,100])):Ye(zt,Xe)}catch{return Ze(Xe[te([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+te([73,110,118,97,108,105,100]))}}function nn(zt,Xe){if(zt==Xe[te([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+te([73,110,118,97,108,105,100]))dn();else if(zt==Xe[te([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+te([84,114,105,97,108])){const an=cn();an&&un(an,Xe[te([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]);const rn=ln();window[te([115,101,116,84,105,109,101,111,117,116])](()=>{un(te([116,105,109,101]),Xe[te([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])])},rn);const xn=Kt(Be,te([82,101,118,105,115,105,111,110,115,82,101,112,111,115,105,116,111,114,121]))[te([95,114,101,118,105,115,105,111,110,115])];xn[te([108,101,110,103,116,104])]>=7?un(te([114,101,118,105,115,105,111,110,115]),Xe[te([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]):xn.on(te([97,100,100]),()=>{xn[te([108,101,110,103,116,104])]>=7&&un(te([114,101,118,105,115,105,111,110,115]),Xe[te([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])])})}}function cn(){if(!tn(Be,te([82,101,118,105,115,105,111,110,86,105,101,119,101,114])))return!1;for(const zt in window)if(Number.isNaN(Number(zt))){if(window[zt]===Le)return te([116,105,109,101]);if(window[zt]===We)return te([114,101,118,105,115,105,111,110,115])}return!1}function fn(){if(!tn(Be,te([82,101,118,105,115,105,111,110,86,105,101,119,101,114])))return!1;for(const zt in window)if(Number.isNaN(Number(zt))&&window[zt]===Je)return!0;return!1}function un(zt,Xe){dn(),Ze(Xe+te([84,114,105,97,108,76,105,109,105,116,58])+zt),window[Bt()]=zt===te([116,105,109,101])?Le:We}function ln(){let zt=Ie[6]*ke[8]*ke[6];return tn(Be,te([82,101,118,105,115,105,111,110,86,105,101,119,101,114]))&&(zt/=10),zt}function dn(){const zt=Be;function Xe(){tn(zt,te([82,101,118,105,115,105,111,110,84,114,97,99,107,101,114]))&&(Kt(zt,te([82,101,118,105,115,105,111,110,84,114,97,99,107,101,114]))[te([117,110,98,105,110,100])](te([105,115,69,110,97,98,108,101,100])),Kt(zt,te([82,101,118,105,115,105,111,110,84,114,97,99,107,101,114]))[te([105,115,69,110,97,98,108,101,100])]=!1,Kt(zt,te([82,101,118,105,115,105,111,110,84,114,97,99,107,101,114]))[te([117,112,100,97,116,101])]=en,Kt(zt,te([82,101,118,105,115,105,111,110,84,114,97,99,107,101,114]))[te([115,97,118,101,82,101,118,105,115,105,111,110])]=en,zt[te([109,111,100,101,108])][te([99,104,97,110,103,101])]=en,zt[te([109,111,100,101,108])][te([101,110,113,117,101,117,101,67,104,97,110,103,101])]=en,zt[te([101,110,97,98,108,101,82,101,97,100,79,110,108,121,77,111,100,101])](te([109,111,100,101,108]))),tn(zt,te([82,101,118,105,115,105,111,110,86,105,101,119,101,114]))&&(Kt(zt,te([82,101,118,105,115,105,111,110,86,105,101,119,101,114]))[te([117,110,98,105,110,100])](te([105,115,69,110,97,98,108,101,100])),Kt(zt,te([82,101,118,105,115,105,111,110,86,105,101,119,101,114]))[te([105,115,69,110,97,98,108,101,100])]=!1,Kt(zt,te([82,101,118,105,115,105,111,110,86,105,101,119,101,114]))[te([99,111,109,112,97,114,101])]=en,Kt(zt,te([82,101,118,105,115,105,111,110,86,105,101,119,101,114]))[te([95,103,101,116,68,105,102,102])]=en)}zt[te([115,116,97,116,101])]==te([114,101,97,100,121])?Xe():zt[te([111,110,99,101])](te([114,101,97,100,121]),()=>{if(tn(zt,te([82,101,118,105,115,105,111,110,84,114,97,99,107,101,114]))&&Xe(),tn(zt,te([82,101,118,105,115,105,111,110,86,105,101,119,101,114]))){const Qt=Kt(zt,te([82,101,118,105,115,105,111,110,115,82,101,112,111,115,105,116,111,114,121])),an=Qt.getRevision(0),rn=Qt.getEarlierVisibleRevision(an[te([105,100])]);Kt(zt,te([82,101,118,105,115,105,111,110,86,105,101,119,101,114]))[te([99,111,109,112,97,114,101])](an[te([105,100])],rn?rn[te([105,100])]:null,1).then(()=>Xe())}})}nn(Wt(Ge,Ne),Ne)}function Ye(Ge,Ne){try{return gn(Ne)?Ze(Ne[te([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+te([86,97,108,105,100])):Ge&&sn(Ge[te([97,108,108,111,119,101,100,80,108,117,103,105,110,115])],Ne)?Ge[te([105,115,73,110,116,101,114,110,97,108])]&&!window[te([111,112,101,110])][te([99,108,111,115,101,100])]||parseInt($e)/2>Ge[te([101,120,112,105,114,97,116,105,111,110,68,97,116,101])]?Ze(Ne[te([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+te([73,110,118,97,108,105,100])):Ge[te([105,115,84,114,105,97,108])]?Ze(Ne[te([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+te([84,114,105,97,108])):Ze(Ne[te([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+te([86,97,108,105,100])):Ze(Ne[te([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+te([73,110,118,97,108,105,100]))}catch{return Ze(Ne[te([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+te([73,110,118,97,108,105,100]))}}function ht(Ge,Ne){if(Be instanceof Context){const Le=Be;Ge==Ne[te([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+te([73,110,118,97,108,105,100])?Jt(Le):Ge==Ne[te([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+te([84,114,105,97,108])&&window[te([115,101,116,84,105,109,101,111,117,116])](()=>{Jt(Le),Ze(Ne[te([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+te([84,114,105,97,108,76,105,109,105,116,58,116,105,109,101]))},Ie[6]*ke[8]*ke[6]),Le[te([101,100,105,116,111,114,115])][te([111,110])](te([97,100,100]),(We,Je)=>{Ge!=Ne[te([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+te([73,110,118,97,108,105,100])&&Ge!=Ne[te([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+te([84,114,105,97,108,76,105,109,105,116,58,116,105,109,101])&&Ge!=Ne[te([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+te([84,114,105,97,108,76,105,109,105,116,58,111,112,101,114,97,116,105,111,110,115])||Yt(Je)})}else{const Le=Be;Ge==Ne[te([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+te([73,110,118,97,108,105,100])?Yt(Le):Ge==Ne[te([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+te([84,114,105,97,108])&&Le[te([111,110])](te([114,101,97,100,121]),()=>{let We=0;Le[te([109,111,100,101,108])][te([111,110])](te([97,112,112,108,121,79,112,101,114,97,116,105,111,110]),(Je,Wt)=>{Wt[0][te([105,115,68,111,99,117,109,101,110,116,79,112,101,114,97,116,105,111,110])]&&We++,We===504&&(Yt(Le),Ze(Ne[te([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+te([84,114,105,97,108,76,105,109,105,116,58,111,112,101,114,97,116,105,111,110,115])),Je[te([111,102,102])]())},{priority:te([104,105,103,104,101,115,116])})})}}function Ze(Ge){const Ne=Bt();return Be[Ne]=Ge,Ge}function Bt(){const Ge=String(window[te([112,101,114,102,111,114,109,97,110,99,101])][te([110,111,119])]())[te([114,101,112,108,97,99,101])](te([46]),"");let Ne="";for(let Le=0;Le<Ge[te([108,101,110,103,116,104])];Le+=2){let We=parseInt(Ge[te([115,117,98,115,116,114,105,110,103])](Le,Le+2));We>=Ue[te([108,101,110,103,116,104])]&&(We-=Ue[te([108,101,110,103,116,104])]),Ne+=Ue[We]}return Ne}function Jt(Ge){for(const Ne of Ge[te([101,100,105,116,111,114,115])])Yt(Ne);Kt(Ge,te([67,111,109,109,101,110,116,115,82,101,112,111,115,105,116,111,114,121]))[te([115,119,105,116,99,104,82,101,97,100,79,110,108,121])](!0),Kt(Ge,te([67,111,109,109,101,110,116,115,82,101,112,111,115,105,116,111,114,121]))[te([115,119,105,116,99,104,82,101,97,100,79,110,108,121])]=en}function Yt(Ge){function Ne(){Ge[te([109,111,100,101,108])][te([99,104,97,110,103,101])]=en,Ge[te([109,111,100,101,108])][te([101,110,113,117,101,117,101,67,104,97,110,103,101])]=en,Ge[te([101,110,97,98,108,101,82,101,97,100,79,110,108,121,77,111,100,101])](te([109,111,100,101,108]))}Ge[te([115,116,97,116,101])]==te([114,101,97,100,121])?Ne():Ge[te([111,110,99,101])](te([114,101,97,100,121]),()=>Ne())}function en(){return null}function sn(Ge,Ne){const Le=!!(Ge&Ne[te([112,101,114,109,105,115,115,105,111,110,77,97,115,107])]),We=hn(Ge,Ne);return Le||We}function hn(Ge,Ne){const Le=(Ne[te([111,112,116,105,111,110,115])]||{})[te([102,103,105])]||null;return!!Le&&Me[te([102,105,108,116,101,114])](We=>Le[te([105,110,99,108,117,100,101,115])](We[te([105,100])]))[te([102,105,108,116,101,114])](We=>!mn(We))[te([115,111,109,101])](We=>!!(Ge&We[te([112,101,114,109,105,115,115,105,111,110,77,97,115,107])]))}function mn(Ge){const Ne={[te([102,111,114,98,105,100,100,101,110,72,97,110,100,108,101,114,70,111,114,68,114,117,112,97,108])]:bn};return!!Ge.forbiddenHandler&&Ne[Ge.forbiddenHandler]()}function bn(){return!window[te([68,114,117,112,97,108])]||!tn(Be,te([100,114,117,112,97,108,80,111,119,101,114,101,100,66,121]))}function gn(Ge){if(!tn(Be,Ge[te([112,108,117,103,105,110,78,97,109,101])]))return!0;const Ne=Ge[te([111,112,116,105,111,110,115])]||{},Le=Ne[te([97,105,119,115,103,105,99])]||!1,We=Ne[te([97,105,116,99,100,103,105,108])]||!1,Je=Ne[te([97,105,114,118,105,105,108])]||!1;return tn(Be,te([87,101,98,83,111,99,107,101,116,71,97,116,101,119,97,121]))&&Kt(Be,te([87,101,98,83,111,99,107,101,116,71,97,116,101,119,97,121]))[te([115,116,97,116,101])]==te([99,111,110,110,101,99,116,101,100])&&Le||tn(Be,te([84,114,97,99,107,67,104,97,110,103,101,115,68,97,116,97,71,101,116,116,101,114]))&&Kt(Be,te([84,114,97,99,107,67,104,97,110,103,101,115,68,97,116,97,71,101,116,116,101,114]))[te([114,101,115,117,108,116])]==te([101,110,100])&&We?!0:!(!tn(Be,te([82,101,118,105,115,105,111,110,86,105,101,119,101,114,73,110,116,101,103,114,97,116,105,111,110]))||Kt(Be,te([82,101,118,105,115,105,111,110,86,105,101,119,101,114,73,110,116,101,103,114,97,116,105,111,110]))[te([114,101,115,117,108,116])]!=te([101,110,100])||!Je)}function tn(Ge,Ne){return Ge[te([112,108,117,103,105,110,115])][te([104,97,115])](Ne)}function Kt(Ge,Ne){return Ge[te([112,108,117,103,105,110,115])][te([103,101,116])](Ne)}function Xt(Ge){let Ne="";for(const Le of Ge)Ne+=String[te([102,114,111,109,67,104,97,114,67,111,100,101])](Le);return Ne}function pn(Ge){const Ne=new Uint8Array(Ge[te([108,101,110,103,116,104])]);for(let Le=0;Le<Ge[te([108,101,110,103,116,104])];Le++)Ne[Le]=Ge[te([99,104,97,114,67,111,100,101,65,116])](Le);return Ne}ze&&qe(Ve(He),ze)})(we)})(this)}_registerComponents(){const we=this.editor,{itemDefinitions:t,commands:te}=this._getListItemDefinitionsAndCommands();we.ui.componentFactory.add("caseChange",()=>this._createDropdownView(t,te)),we.ui.componentFactory.add("menuBar:caseChange",()=>this._createMenuBarMenuView(t,te))}_createMenuBarMenuView(we,t){const te=this.editor,be=te.locale,xe=be.t,ve=new MenuBarMenuView(be),ke=new MenuBarMenuListView(be);ke.set({ariaLabel:xe("Case change"),role:"menu"}),this._setButtonProperties(ve.buttonView),ve.bind("isEnabled").toMany(t,"isEnabled",(...Ie)=>Ie.some(Ae=>Ae));for(const Ie of we){const Ae=new MenuBarMenuListItemView(be,ve),Se=new MenuBarMenuListItemButtonView(be);Se.delegate("execute").to(ve),Se.bind(...Object.keys(Ie.model)).to(Ie.model),Se.bind("ariaChecked").to(Se,"isOn"),Se.on("execute",()=>{te.execute(Ie.model.commandName),te.editing.view.focus()}),Ae.children.add(Se),ke.items.add(Ae)}return ve.panelView.children.add(ke),ve}_createDropdownView(we,t){const te=this.editor,be=te.t,xe=createDropdown(te.locale);return this._setButtonProperties(xe.buttonView),xe.buttonView.set({tooltip:!0}),xe.extendTemplate({attributes:{class:["ck-case-change-dropdown"]}}),addListToDropdown(xe,we,{ariaLabel:be("Case change"),role:"menu"}),xe.bind("isEnabled").toMany(t,"isEnabled",(...ve)=>ve.some(ke=>ke)),this.listenTo(xe,"execute",ve=>{te.execute(ve.source.commandName),te.editing.view.focus()}),xe}_setButtonProperties(we){const t=(0,this.editor.locale.t)("Case change");we.set({label:t,icon:a$9.caseChange,keystroke:"Shift+F3"})}_getListItemDefinitionsAndCommands(){const we=new Collection,t=[];for(const te of g$3(this.editor.t)){const be=this.editor.commands.get(te.commandName),xe=new Model({commandName:te.commandName,label:te.label,role:"menuitemradio",withText:!0});xe.bind("isEnabled").to(be,"isEnabled"),we.add({type:"button",model:xe}),t.push(be)}return{itemDefinitions:we,commands:t}}},a$8=class extends Plugin{constructor(t){super(t);Re(this,"_licenseKeyCheckInterval");this._licenseKeyCheckInterval=null}static get requires(){return[s$9,n$6]}static get pluginName(){return"CaseChange"}init(){const t=this.editor;this.licenseKey=t.config.get("licenseKey");const te=this.editor;this._licenseKeyCheckInterval=setInterval(()=>{let be;for(const xe in te){const ve=xe,ke=te[ve];if(ke==="caseChangeLicenseKeyTrial"||ke==="caseChangeLicenseKeyInvalid"||ke==="caseChangeLicenseKeyValid"||ke==="caseChangeLicenseKeyTrialLimit:operations"){delete te[ve],be=ke;break}}if(be==="caseChangeLicenseKeyInvalid")throw clearInterval(this._licenseKeyCheckInterval),new CKEditorError("case-change-invalid-license-key",null);if(be==="caseChangeLicenseKeyTrial"&&console.info("You are using the trial version of CKEditor 5 case change plugin with limited usage. Make sure you will not use it in the production environment."),be==="caseChangeLicenseKeyTrialLimit:operations")throw clearInterval(this._licenseKeyCheckInterval),new CKEditorError("case-change-trial-license-key-reached-limit-changes",null);be==="caseChangeLicenseKeyValid"&&clearInterval(this._licenseKeyCheckInterval)},1e3)}destroy(){this._licenseKeyCheckInterval&&clearInterval(this._licenseKeyCheckInterval)}},wt$1=class extends ObservableMixin(){constructor(t,te){super();Re(this,"model");Re(this,"view");this.model=t,this.model._isAttached=!0,this.view=te,this.listenTo(te,"submitCommentThread",()=>this.submit()),this.listenTo(te,"removeCommentThread",()=>this.remove()),this.listenTo(te,"resolveCommentThread",()=>this.resolve()),this.listenTo(te,"reopenCommentThread",()=>this.reopen()),this.listenTo(te,"addComment",(be,xe)=>this.addComment(xe)),this.listenTo(te,"updateComment",(be,xe,ve)=>this.updateComment(xe,ve)),this.listenTo(te,"removeComment",(be,xe)=>this.removeComment(xe))}submit(){this.model.submit()}remove(){this.model.remove()}resolve(){this.model.isResolved||this.model.resolve()}reopen(){this.model.isResolved&&this.model.reopen()}addComment(t){this.model.addComment({content:t,authorId:this.view._localUser.id})}updateComment(t,te){this.model.getComment(t).update({content:te})}removeComment(t){this.model.getComment(t).remove()}destroy(){this.stopListening(),this.model._isAttached=!1}};function W$2(Te,we,t){const te=Te.t;switch(we){case"PENDING_ACTION_COMMENT_THREAD":return te({string:"Unsaved change in comment thread.",id:"PENDING_ACTION_COMMENT_THREAD"});case"Comment":return te("Comment");case"Reply...":return te("Reply...");case"Reply to reopen discussion...":return te("Reply to reopen discussion...");case"Write a comment...":return te("Write a comment...");case"Comment was made on an element":return te("Comment was made on an element");case"Comment editor":return te("Comment editor");case"Delete comment thread?":return te("Delete comment thread?");case"Delete comment?":return te("Delete comment?");case"Marked as resolved":return te("Marked as resolved");case"Show more items":return te("Show more items");case"Cancel":return te("Cancel");case"Edit":return te("Edit");case"Resolve":return te("Resolve");case"Reopen":return te("Reopen");case"Remove":return te("Remove");case"Reply":return te("Reply");case"Save":return te("Save");case"LEAVE_COMMENT_ANNOUNCEMENT":return te({string:"Leaving a comment.",id:"LEAVE_COMMENT_ANNOUNCEMENT"});case"ENTER_COMMENT_ANNOUNCEMENT":return te({string:"Entering a comment.",id:"ENTER_COMMENT_ANNOUNCEMENT"});case"NUMBER_OF_COMMENTS":return te({string:"%0 Comment",plural:"%0 Comments",id:"NUMBER_OF_COMMENTS"},t);case"TOO_LONG_COMMENT_ALERT":return te({string:"Comment content is too long. Your comment has %0 characters but the limit is %1 characters.",id:"TOO_LONG_COMMENT_ALERT"},t);case"EXTERNAL_COMMENT":return te({string:"This comment comes from an external source.",id:"EXTERNAL_COMMENT"});case"EXTERNAL_IMPORT_WORD_COMMENT":return te({string:"This comment comes from an imported Word file.",id:"EXTERNAL_IMPORT_WORD_COMMENT"});case"EXTERNAL_AVATAR":return te({string:"Displayed author name comes from external source (added by %0)",id:"EXTERNAL_AVATAR"},t);case"EXTERNAL_IMPORT_WORD_AVATAR":return te({string:"Displayed author name comes from a Word document imported by %0",id:"EXTERNAL_IMPORT_WORD_AVATAR"},t);case"COMMENTS_ARCHIVE":return te({string:"Comments archive",id:"COMMENTS_ARCHIVE"});case"EMPTY_COMMENTS_ARCHIVE":return te({string:"There are no archived comment threads.",id:"EMPTY_COMMENTS_ARCHIVE"});default:return""}}let Vt$1=class extends EditorUIView{constructor(t,te){super(t);Re(this,"main");Re(this,"_voiceLabelView");Re(this,"editable");const be=uid();this.main=this.createCollection(),this.editable=new InlineEditableUIView(t,te),this._voiceLabelView=this._createVoiceLabel(be,t),this.setTemplate({tag:"div",attributes:{class:["ck-reset","ck-editor","ck-rounded-corners","ck-comment__input"],role:"comment",dir:t.uiLanguageDirection,lang:t.uiLanguage,"aria-labelledby":"cke-editor__aria-label_"+be},children:[this._voiceLabelView,{tag:"div",attributes:{class:"ck-editor__main",role:"presentation"},children:this.main}]})}render(){super.render(),this.main.add(this.editable)}focus(){this.editable.element.focus()}_createVoiceLabel(t,te){const be=new LabelView;return be.text=W$2(te,"Comment editor"),be.extendTemplate({attributes:{id:"ck-editor__aria-label_"+t,class:"ck-voice-label"}}),be}},Ot$1=class extends EditorUI{constructor(t){super(t);Re(this,"view");this.view=new Vt$1(t.locale,t.editing.view)}get element(){return this.view.element}init(){const t=this.editor.editing.view,te=this.view.editable,be=t.document.getRoot();te.name=be.rootName,this.view.render();const xe=te.element;this.setEditableElement(te.name,xe),this.view.editable.bind("isFocused").to(this.focusTracker),t.attachDomRoot(xe),this.fire("ready")}destroy(){super.destroy(),this.view.destroy()}};const Rt$2=[Clipboard,Enter,ShiftEnter,SelectAll,Typing,Undo,Paragraph];var Bi;let St$1=(Bi=class extends ObservableMixin(Editor){constructor(we={}){(we=Object.assign({},we)).plugins||(we.plugins=Bi.defaultPlugins),super(we),this.ui=new Ot$1(this),this.set("placeholder",""),this.model.document.on("change",()=>this._updatePlaceholder(),{priority:"low"}),this.on("change:placeholder",()=>this._updatePlaceholder()),this.model.document.createRoot()}create(){const we=this.config.get("initialData")||"";return this.initPlugins().then(()=>this.ui.init()).then(()=>this.data.init(we)).then(()=>this.fire("ready"))}destroy(){return super.destroy().then(()=>this.ui.destroy())}focus(){this.model.change(we=>{const t=this.model.document.getRoot(),te=t&&t.getChild(t.childCount-1);we.setSelection(te,"end"),this.editing.view.focus()})}_updatePlaceholder(){const we=this.editing.view,t=we.document.getRoot(),te=t.getChild(0);t.childCount>1||!te||te.name!="p"?this.placeholderElement&&this.placeholderElement.placeholder&&(disablePlaceholder(we,this.placeholderElement),this.placeholderElement=void 0):(this.placeholder&&(te.placeholder=this.placeholder),enablePlaceholder({view:we,element:te,keepOnFocus:!0}),this.placeholderElement=te)}},Re(Bi,"defaultPlugins",Rt$2),Bi);class ei extends View{constructor(t,te={}){super(t);Re(this,"keystrokes");Re(this,"focusTracker");Re(this,"submitButtonView");Re(this,"cancelButtonView");Re(this,"_editorConfig");this.editor=null,this._editorConfig=te,this.keystrokes=new KeystrokeHandler,this.focusTracker=new FocusTracker,this.set("value",te.initialData||""),this.set("disabledSubmit",!1),this.set("showButtons",!0),this.set("placeholder",W$2(t,"Reply...")),this.set("submitLabel",W$2(t,"Reply")),this.submitButtonView=this._createSubmitButton(),this.cancelButtonView=this._createCancelButton(),this.setTemplate({tag:"div",attributes:{class:["ck-comment__input-wrapper"]},children:[{tag:"div",attributes:{class:["ck-comment__input-actions",this.bindTemplate.if("showButtons","ck-comment__input-actions--active")]},children:[this.submitButtonView,this.cancelButtonView]}]}),this.keystrokes.set("Esc",(be,xe)=>{this.cancelButtonView.fire("execute"),xe()}),this.on("submit",(be,xe)=>{xe.length>65e3?(alert(W$2(t,"TOO_LONG_COMMENT_ALERT",[xe.length,65e3])),be.stop()):this.editor.setData("")},{priority:"high"})}render(){super.render(),this.keystrokes.listenTo(this.element),this.focusTracker.add(this.element)}createEditor(){return this.editor||(this.editor=new St$1(this._editorConfig),this._editorCreationPromise=this.editor.create().then(()=>{if(this._isDestroyed)return;const t=this.editor;this.element.insertBefore(t.ui.element,this.element.firstChild),t.model.document.on("change",()=>this.value=t.getData()),t.bind("placeholder").to(this),this._initializeFocusCycling(this.editor),this.fire("editorReady",this.editor)})),this._editorCreationPromise}focus(){this.editor&&this.editor.focus()}async destroy(){this._isDestroyed||(this._isDestroyed=!0,this.editor&&(await this._editorCreationPromise,await this.editor.destroy(),this.fire("editorDestroyed",this.editor)),await super.destroy())}_createSubmitButton(){const{locale:t}=this,te=new ButtonView(t);return te.extendTemplate({attributes:{class:["ck-comment__input-actions--submit"]}}),te.withText=!0,te.bind("label").to(this,"submitLabel"),te.on("execute",()=>{this.fire("submit",this.value)}),te.bind("isEnabled").to(this,"value",this,"disabledSubmit",(be,xe)=>!xe&&!!be.trim()),te}_createCancelButton(){const{locale:t}=this,te=new ButtonView(t);return te.extendTemplate({attributes:{class:["ck-comment__input-actions--cancel"]}}),te.label=W$2(t,"Cancel"),te.withText=!0,te.on("execute",()=>{this.editor.setData(""),this.fire("cancel")}),te}_initializeFocusCycling(t){const te=this.focusTracker,be=new ViewCollection;[t.ui.view,this.submitButtonView,this.cancelButtonView].forEach(ve=>{be.add(ve),te.add(ve.element)});const xe=new FocusCycler({focusables:be,focusTracker:te});this.keystrokes.set("tab",(ve,ke)=>{xe.focusNext(),ke()},{priority:"low"}),this.keystrokes.set("shift + tab",(ve,ke)=>{xe.focusPrevious(),ke()},{priority:"low"})}}let Tt$1=class extends View{constructor(we,t,te){super(we),this.commentInputView=new ei(we,te),this.commentInputView.bind("showButtons").to(this.commentInputView.focusTracker,"isFocused",this.commentInputView,"value",(be,xe)=>be||!!xe),this.set("showInput",!1),this.on("change:showInput",()=>{this.showInput&&!this.commentInputView.editor&&this.commentInputView.createEditor()}),this.commentInputView.delegate("editorReady").to(this),this.commentInputView.delegate("editorDestroyed").to(this),this.userView=new E$4(we,t),this.userView.extendTemplate({attributes:{class:"ck-thread__user"}}),this.commentInputView.extendTemplate({attributes:{class:"ck-thread__input"}}),this.setTemplate({tag:"div",attributes:{class:["ck-comment__input-container",this.bindTemplate.if("showInput","ck-comment__input-container--active")]},children:[this.userView,this.commentInputView]})}destroy(){return this.commentInputView.destroy().then(()=>super.destroy())}},ts$1=class extends View{constructor(we){super(we);const t=this.bindTemplate;this.set("count",void 0),this.setTemplate({tag:"li",attributes:{class:"ck-thread__comment-count"},children:[{text:t.to("count",te=>W$2(we,"NUMBER_OF_COMMENTS",te))}]})}},xt$1=class extends View{constructor(t,te,be){super(t);Re(this,"commentViews");Re(this,"resolvedCommentView");Re(this,"_model");Re(this,"_config");Re(this,"_collapsedCommentsView");this.set("hasDirtyComment",!1),this.set("length",te.comments.length),this.set("isActive",!1),this._model=te,this._config=be,this.commentViews=this.createCollection(),this.visibleViews=this.createCollection(),this.resolvedCommentView=null,this._collapsedCommentsView=new ts$1(t),this._collapsedCommentsView.bind("count").to(this,"length",xe=>xe-this._config.maxCommentsWhenCollapsed);for(const xe of te.comments)this._handleNewCommentModel(xe);this._handleInfoComment(),this.listenTo(te.comments,"add",(xe,ve)=>{const ke=this._calculatePosition(ve);this.length++,this._handleNewCommentModel(ve,ke),this.refreshVisibleViews()}),this.listenTo(te.comments,"remove",(xe,ve)=>{this.length--,this._handleRemoveCommentModel(ve),this.refreshVisibleViews()}),this.listenTo(te,"commentUpdated",()=>this.refreshVisibleViews()),this.listenTo(te,"change:isResolved",()=>this._handleInfoComment()),this.on("change:isActive",()=>this.refreshVisibleViews()),this.on("change:hasDirtyComment",()=>this.refreshVisibleViews()),this.setTemplate({tag:"ul",attributes:{class:["ck-thread__comments"]},children:this.visibleViews})}get _shouldCollapse(){return this._model.weight>this._config.maxThreadTotalWeight&&!this.isActive&&!this.hasDirtyComment}render(){super.render(),this.refreshVisibleViews()}focus(){this.element.focus()}destroy(){this._collapsedCommentsView.destroy();for(const t of this.commentViews)t.destroy();super.destroy()}refreshVisibleViews(){this._shouldCollapse?this._rearrangeCollapse():this._rearrangeExpand()}_handleNewCommentModel(t,te){const be=new this._config.CommentView(this.locale,t,{maxCommentCharsWhenCollapsed:this._config.maxCommentCharsWhenCollapsed,formatDateTime:this._config.formatDateTime,editorConfig:this._config.editorConfig});be.viewUid=t.id,be.delegate("removeComment").to(this),be.delegate("updateComment").to(this),be.delegate("resolveCommentThread").to(this),be.delegate("editorReady").to(this),be.delegate("editorDestroyed").to(this),this.listenTo(be,"change:isEditMode",()=>this._updateHasDirtyComment()),this.commentViews.add(be,te)}_calculatePosition(t){const te=this._model._findOptimalIndex(t);return this.resolvedCommentView?this.resolvedCommentView.authoredAt>t.authoredAt?te-1:te:te-1}_handleInfoComment(){if(this._model.resolvedBy&&this._model.resolvedAt){const t={id:"resolved",author:this._model.resolvedBy,authoredAt:this._model.resolvedAt,content:W$2(this.locale,"Marked as resolved"),attributes:{}};this.resolvedCommentView=new this._config.CommentView(this.locale,t,{maxCommentCharsWhenCollapsed:this._config.maxCommentCharsWhenCollapsed,formatDateTime:this._config.formatDateTime,editorConfig:this._config.editorConfig,isSystemComment:!0}),this.commentViews.add(this.resolvedCommentView,this._model._findOptimalIndex(t))}else this.resolvedCommentView&&(this.commentViews.remove(this.resolvedCommentView),this.resolvedCommentView.destroy(),this.resolvedCommentView=null);this.refreshVisibleViews()}_handleRemoveCommentModel(t){const te=this.commentViews.remove(t.id);this.stopListening(te),te.isEditMode&&this._updateHasDirtyComment(),te.destroy()}_updateHasDirtyComment(){this.hasDirtyComment=Array.from(this.commentViews).some(t=>t.isEditMode)}_rearrangeCollapse(){const t=function(be){const xe=new Collection;for(const ve of be)xe.add(ve);return xe}(this.commentViews),te=this._collapsedCommentsView.count;for(let be=1;be<=te;be++)t.remove(1);for(const be of t)be.collapse();te>0&&t.add(this._collapsedCommentsView,1),is(diff$1(Array.from(this.visibleViews),Array.from(t)),this.visibleViews,t)}_rearrangeExpand(){is(diff$1(Array.from(this.visibleViews),Array.from(this.commentViews)),this.visibleViews,this.commentViews);for(const t of this.visibleViews)t.expand()}};function is(Te,we,t){let te=0;for(const be of Te)switch(be){case"insert":we.add(t.get(te),te),te++;break;case"delete":we.remove(te);break;case"equal":te++}}class Zt extends View{constructor(t,te){super(t);Re(this,"_model");Re(this,"reopenButtonView");const be=this.bindTemplate;this._model=te,this.reopenButtonView=this._createReopenButton(),this.bind("hasContext").to(this._model,"context",xe=>!!xe),this.bind("contextValue").to(this._model,"context",xe=>xe&&xe.value?this._trimContextValue(xe.value):W$2(this.locale,"Comment was made on an element")),this.setTemplate({tag:"div",attributes:{class:["ck-thread__header"]},children:[{tag:"div",attributes:{class:["ck-context-wrapper"]},children:[{tag:"div",attributes:{class:["ck-context",be.if("hasContext","ck-context--quotes")]},children:[{tag:"span",attributes:{class:["ck-context__value"]},children:[{text:be.to("contextValue")}]}]}]},{tag:"div",attributes:{class:["ck-annotation__actions"]},children:[this.reopenButtonView]}]})}render(){super.render(),this._attachContextActions()}_createReopenButton(){const t=new ButtonView(this.locale);return t.label=W$2(this.locale,"Reopen"),t.tooltip=W$2(this.locale,"Reopen"),t.icon='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="m5.042 9.367 2.189 1.837a.75.75 0 0 1-.965 1.149l-3.788-3.18a.747.747 0 0 1-.21-.284.75.75 0 0 1 .17-.945L6.23 4.762a.75.75 0 1 1 .964 1.15L4.863 7.866h8.917A.75.75 0 0 1 14 7.9a4 4 0 1 1-1.477 7.718l.344-1.489a2.5 2.5 0 1 0 1.094-4.73l.008-.032H5.042z"/></svg>',t.bind("isEnabled").to(this._model,"isReadOnly",te=>!te),t.bind("isVisible").to(this._model,"isResolvable",this._model,"isResolved",(te,be)=>te&&be),t.on("execute",()=>{this.fire("reopenCommentThread",this._model.id)}),t}_trimContextValue(t){if(t.length<150)return t;const te=t.lastIndexOf(" ",147);return t.substring(0,te>-1?te:147)+"..."}_attachContextActions(){const t=this.element.querySelector(".ck-context"),te=t.querySelector(".ck-context__value");this.listenTo(t,"mouseenter",()=>{te.offsetWidth<te.scrollWidth&&t.classList.add("overlay")}),this.listenTo(t,"mouseleave",()=>{t.classList.remove("overlay")})}}let ti$2=class extends View{constructor(t,te,be,xe){super(t);Re(this,"_model");Re(this,"_config");Re(this,"commentThreadHeaderView");Re(this,"commentThreadInputView");this.set("isActive",!1),this.set("isDirty",!1),this._model=te,this._localUser=be,this._config=xe,this.commentThreadHeaderView=new Zt(t,te),this.commentThreadHeaderView.delegate("reopenCommentThread").to(this),this.listenTo(this,"reopenCommentThread",()=>{this.focus()}),this.commentsListView=new xt$1(t,te,Object.assign({CommentView:this._config.CommentView},xe)),this.commentsListView.delegate("removeComment").to(this),this.commentsListView.delegate("updateComment").to(this),this.commentsListView.delegate("resolveCommentThread").to(this),this.commentsListView.delegate("editorReady").to(this),this.commentsListView.delegate("editorDestroyed").to(this),this.commentsListView.bind("isActive").to(this),this.listenTo(this,"resolveCommentThread",()=>{this.focus()}),this.set("length",this.commentsListView.length),this.bind("length").to(this.commentsListView,"length"),this.commentThreadInputView=this._createCommentThreadInputView(),this.commentThreadInputView.delegate("editorReady").to(this),this.commentThreadInputView.delegate("editorDestroyed").to(this),this.on("removeComment",()=>this.focus()),this.bind("isDirty").to(this.commentsListView,"hasDirtyComment",this.commentThreadInputView.commentInputView,"value",(ve,ke)=>ve||!!ke),this.bind("isUnlinked").to(te,"unlinkedAt",ve=>!!ve)}focus(){this.element.focus()}async destroy(){this.isDirty=!1,this.commentsListView.destroy(),await this.commentThreadInputView.destroy(),super.destroy()}_createCommentThreadInputView(){const t=new Tt$1(this.locale,this._localUser,this._config.editorConfig),te=t.commentInputView;return t.bind("showInput").to(this,"isActive",this._model,"isReadOnly",this._model,"canComment",this._model,"archivedAt",te,"value",(be,xe,ve,ke,Ie)=>!!Ie||!!ke&&ve&&!xe||be&&ve&&!xe),te.bind("placeholder").to(this,"length",this._model,"isResolvable",this._model,"isResolved",(be,xe,ve)=>{let ke;return ke=ve&&xe?"Reply to reopen discussion...":be?"Reply...":"Write a comment...",W$2(this.locale,ke)}),te.bind("submitLabel").to(this,"length",be=>W$2(this.locale,be?"Reply":"Comment")),te.on("submit",(be,xe)=>{this.fire("addComment",xe),this._model.isResolved&&this._model.isResolvable&&this.fire("reopenCommentThread",this._model.id),this._model.isSubmitted||this.fire("submitCommentThread")}),te.on("cancel",()=>{this.focus()}),te.bind("disabledSubmit").to(this._model,"isReadOnly"),te.on("cancel",be=>{this.length==0&&(this.fire("removeCommentThread"),be.stop())}),this.on("change:isActive",(be,xe,ve)=>{ve||this.length||te.value||this.fire("removeCommentThread")}),t}},yt$2=class extends m$a(ti$2){constructor(t,te,be,xe){super(t,te,be,xe);Re(this,"commentThreadChildren");Re(this,"containerElement");Re(this,"resolveButton");Re(this,"_boundFirstCommentView");this.commentThreadChildren=this.createCollection(),this.commentThreadChildren.addMany([this.commentsListView,this.commentThreadInputView]),this._model.archivedAt&&this.commentThreadChildren.add(this.commentThreadHeaderView,0),this._model.on("change:archivedAt",(ve,ke,Ie)=>{Ie?this.commentThreadChildren.has(this.commentThreadHeaderView)||this.commentThreadChildren.add(this.commentThreadHeaderView,0):this.commentThreadChildren.remove(this.commentThreadHeaderView)}),this.set("actionIndicator",null),this.containerElement=null,this._boundFirstCommentView=null,this.locale=t,this.resolveButton=this._createResolveButton(),this.setTemplate(this.getTemplate()),this.on("change:isActive",(ve,ke,Ie)=>{Ie||this._cancelAllConfirms()}),this.listenTo(this._model,"change:isReadOnly",(ve,ke,Ie)=>{Ie&&this._cancelAllConfirms()}),this.length>0&&this._bindFirstCommentView(),this.listenTo(this.commentsListView.commentViews,"add",()=>{this._bindFirstCommentView()})}getTemplate(){const t=this.bindTemplate;return{tag:"div",attributes:{class:["ck-thread","ck-reset_all-excluded",t.if("isActive","ck-thread--active"),t.if("isUnlinked","ck-thread--unlinked"),t.if("isConfirm","ck-thread--remove-confirmation"),t.to("actionIndicator",te=>te?"ck-thread--"+te:"")],"data-thread-id":this._model.id,tabindex:-1},children:[{tag:"div",attributes:{class:"ck-thread__container"},children:this.commentThreadChildren}]}}render(){super.render(),this.containerElement=this.element.querySelector(".ck-thread__container")}_cancelAllConfirms(){this.cancelConfirm();for(const t of this.commentsListView.commentViews)t.cancelConfirm()}_bindFirstCommentView(){const{locale:t}=this,te=this.commentsListView.commentViews.get(0);te===this._boundFirstCommentView||te.isSystemComment||(this._boundFirstCommentView=te,this.unbind("actionIndicator"),this.bind("actionIndicator").to(te,"actionIndicator",be=>be==="remove"?"remove":null),te.placeholder=W$2(t,"Write a comment..."),te.removeButton.on("execute",be=>{be.stop(),this.showConfirm(W$2(t,"Delete comment thread?"),this.containerElement).then(()=>{this.fire("removeCommentThread")})},{priority:"high"}),te.actionBar.add(this.resolveButton,0))}_createResolveButton(){const t=new ButtonView(this.locale);return t.label=W$2(this.locale,"Resolve"),t.tooltip=W$2(this.locale,"Resolve"),t.icon=icons.check,t.extendTemplate({attributes:{class:"ck-comment--resolve"}}),t.bind("isEnabled").to(this._model,"isReadOnly",te=>!te),t.bind("isVisible").to(this._model,"isResolvable",this._model,"isResolved",(te,be)=>te&&!be),t.on("execute",()=>{this.fire("resolveCommentThread",this._model.id)}),t}};class si extends View{constructor(we){super(we),this.set("content",""),this.setTemplate({tag:"div",attributes:{class:["ck-content","ck-comment__content","ck-annotation__content"]}})}render(){super.render(),this.on("change:content",(we,t,te)=>{this.element.innerHTML=te}),this.element.innerHTML=this.content}}class oi extends View{constructor(t,te,be){super(t);Re(this,"visibleView");Re(this,"_model");Re(this,"_config");this._model=te,this._config=be,this.isSystemComment=!!this._config.isSystemComment,this.set("isEditMode",!1),this.set("isCollapsed",!0),this.visibleView=this.createCollection(),this.visibleView.add(this._createCommentContentView())}expand(){this.isCollapsed=!1}collapse(){this.isEditMode||(this.isCollapsed=!0)}focus(){this.element.focus()}async destroy(){await this.visibleView.get(0).destroy(),super.destroy()}switchToEditMode(){this.isEditMode||(this.isEditMode=!0,this.visibleView.remove(0).destroy(),this.visibleView.add(this._createCommentInputView()))}switchToDisplayMode(){this.isEditMode&&(this.isEditMode=!1,this.visibleView.remove(0).destroy(),this.visibleView.add(this._createCommentContentView()))}_createCommentContentView(){const t=new si(this.locale);return t.bind("content").to(this._model,"content",this,"isCollapsed",(te,be)=>be?Z$2(te,{limit:this._config.maxCommentCharsWhenCollapsed}):te),t}_createCommentInputView(){this._config.editorConfig||(this._config.editorConfig={}),this._config.editorConfig.initialData=this._model.content;const t=new ei(this.locale,this._config.editorConfig);return t.value=this._model.content,t.bind("disabledSubmit").to(this._model,"isReadOnly"),t.submitLabel=W$2(this.locale,"Save"),t.on("submit",(te,be)=>{this.fire("updateComment",this._model.id,be),this.switchToDisplayMode(),this.focus()}),t.on("cancel",()=>{this.switchToDisplayMode(),this.focus()}),t.once("editorReady",()=>{t.focus()}),t.createEditor(),t.delegate("editorReady").to(this),t.delegate("editorDestroyed").to(this),t}}let At$1=class extends m$a(oi){constructor(t,te,be){super(t,te,be);Re(this,"actionBar");Re(this,"userView");this.set("actionIndicator",null),this.set("placeholder",W$2(t,"Reply...")),this.bind("authoredAt").to(te),this.bind("resolvedAt").to(te),this.actionBar=this.createCollection(),this.isSystemComment||(this.editButton=this._createEditButton(),this.removeButton=this._createRemoveButton(),this.items=this.createCollection(),this.items.addMany([this.editButton,this.removeButton]),this.dropdown=this._createDropdown(),this.actionBar.add(this.dropdown)),this.userView=new E$4(t,te.author,this.getUserViewNotificationText()),this.userView.extendTemplate({attributes:{class:["ck-comment__user","ck-annotation__user"]}}),this.listenTo(te,"change:isRemovable",()=>this.cancelConfirm()),this.setTemplate(this.getTemplate())}getTemplate(){const t=this.bindTemplate,te=[{tag:"div",attributes:{class:["ck-comment__info","ck-annotation__info"]},children:[{tag:"span",children:[{text:this.userView.name}],attributes:{class:["ck-comment__info-name","ck-annotation__info-name"]}},{tag:"time",attributes:{datetime:t.to("authoredAt"),class:["ck-comment__info-time","ck-annotation__info-time"]},children:[{text:t.to("authoredAt",be=>this._config.formatDateTime(be))}]}]},{tag:"div",attributes:{class:["ck-comment__actions","ck-annotation__actions",t.if("isEditMode","ck-comment__actions--hidden"),t.if("isEditMode","ck-annotation__actions--hidden")]},children:this.actionBar},{tag:"div",attributes:{class:["ck-annotation__content-wrapper"]},children:this.visibleView}];return this._model.isExternal&&te.push({tag:"div",attributes:{class:["ck-comment__external"]},children:[{text:this.getExternalCommentNote()}]}),{tag:"li",attributes:{class:["ck-comment__wrapper",t.if("isConfirm","ck-comment--remove-confirmation")],tabindex:-1},children:[{tag:"div",attributes:{class:["ck-comment","ck-annotation",t.if("isEditMode","ck-comment--edit"),t.if("isSystemComment","ck-comment--info"),t.to("actionIndicator",be=>be?"ck-comment--"+be:"")],"data-author-id":this._model.author.id,"data-comment-id":this._model.id},children:[this.userView,{tag:"div",attributes:{class:["ck-comment__main","ck-annotation__main"]},children:te}]}]}}_createEditButton(){const t=new ButtonView(this.locale);return t.label=W$2(this.locale,"Edit"),t.icon=icons.pencil,t.withText=!0,t.extendTemplate({attributes:{class:"ck-comment--edit"}}),t.bind("isEnabled").to(this._model,"isReadOnly",te=>!te),t.bind("isVisible").to(this._model,"isEditable"),t.on("execute",()=>this.switchToEditMode()),t}_createRemoveButton(){const t=new ButtonView(this.locale);return t.label=W$2(this.locale,"Remove"),t.icon=`<!--

 What you're currently looking at is the source code of a legally protected, proprietary software.
 CKEditor 5 Collaboration is licensed under a commercial license and protected by copyright law. Where not otherwise indicated,
 all CKEditor 5 Collaboration content is authored by CKSource engineers and consists of CKSource-owned intellectual property.

 Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.

!-->

<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M5.2 7h9.2c.6 0 1 .4 1 1v9.9c0 .5-.4 1-1 1H5.2a1 1 0 0 1-1-1V8c0-.6.4-1 1-1zm1 1.5c-.3 0-.5.2-.5.5v8c0 .3.2.5.5.5h.5c.2 0 .5-.2.5-.5V9c0-.3-.3-.5-.5-.5h-.5zm3.2 0c-.2 0-.5.2-.5.5v8c0 .3.3.5.5.5h.5c.3 0 .5-.2.5-.5V9c0-.3-.2-.5-.5-.5h-.4zm3.5 0c-.2 0-.5.2-.5.5v8c0 .3.3.5.5.5h.5c.3 0 .5-.2.5-.5V9c0-.3-.2-.5-.5-.5h-.5zm-1.4-7.1H8.3L6.5 3.6H3.8c-.5 0-.7.3-.7.8s.2.7.7.7h12c.6 0 .9-.2.9-.7 0-.5-.3-.8-1-.8h-2.4l-1.8-2.2z"/></svg>
`,t.withText=!0,t.extendTemplate({attributes:{class:"ck-comment--remove"}}),t.bind("isEnabled").to(this._model,"isReadOnly",te=>!te),t.bind("isVisible").to(this._model,"isRemovable"),t.on("execute",()=>{this.showConfirm(W$2(this.locale,"Delete comment?"),this.element).then(()=>{this.fire("removeComment",this._model.id)})}),t}_createDropdown(){const t=createDropdown(this.locale),te=t.panelView.children,be=new ListView(this.locale),xe=(ve,ke=-1)=>{const Ie=new ListItemView(this.locale);Ie.children.add(ve);const Ae=ke>-1?ke:be.items.length;be.items.add(Ie,Ae),t.listenTo(ve,"change:isEnabled",()=>{t.isEnabled=[...this.items].some(Se=>Se.isEnabled)}),t.listenTo(ve,"change:isVisible",()=>{t.buttonView.isVisible=[...this.items].some(Se=>Se.isVisible)})};t.panelPosition="sw",t.buttonView.set({label:W$2(this.locale,"Show more items"),icon:icons.threeVerticalDots}),t.isEnabled=[...this.items].some(ve=>ve.isEnabled),t.buttonView.isVisible=[...this.items].some(ve=>ve.isVisible);for(const ve of this.items)xe(ve);return te.add(be),t.listenTo(this.items,"add",(ve,ke,Ie)=>{xe(ke,Ie)}),t.listenTo(this.items,"remove",(ve,ke,Ie)=>{be.items.remove(Ie)}),t}_attachActions(t,te){const be=t&&t.element;be&&(this.listenTo(be,"mouseenter",()=>this.actionIndicator=te),this.listenTo(be,"focus",()=>this.actionIndicator=te),this.listenTo(be,"mouseleave",()=>this.actionIndicator=null),this.listenTo(be,"blur",()=>this.actionIndicator=null))}_createCommentInputView(){const t=super._createCommentInputView();return t.bind("placeholder").to(this),t}getExternalCommentNote(){return this._model.attributes["@external"].source==="importWord"?W$2(this.locale,"EXTERNAL_IMPORT_WORD_COMMENT"):W$2(this.locale,"EXTERNAL_COMMENT")}getUserViewNotificationText(){return this._model.isExternal?this._model.attributes["@external"].source==="importWord"?W$2(this.locale,"EXTERNAL_IMPORT_WORD_AVATAR",this._model.creator.name):W$2(this.locale,"EXTERNAL_AVATAR",this._model.creator.name):null}render(){super.render(),this._attachActions(this.editButton,"edit"),this._attachActions(this.removeButton,"remove")}};function Dt$1(Te){const we=throttle(Te,30),t=new MutationObserver(te=>{for(const be of te)(be.type=="attributes"&&be.attributeName=="class"||be.type=="childList"||be.type=="characterData")&&we()});return{attach(te){t.observe(te,{attributes:!0,childList:!0,subtree:!0,characterData:!0})},detach(){t.disconnect(),we.cancel()}}}let V$1=class extends View{constructor(t,te){super(t);Re(this,"focusTracker");Re(this,"id");Re(this,"keystrokes");Re(this,"content");Re(this,"mainView");Re(this,"_mutationObserver");this.id=uid(),this.focusTracker=new FocusTracker,this.keystrokes=new KeystrokeHandler,this.keystrokes.set("Esc",(xe,ve)=>this.fire("Esc",ve)),this.set("targetRect",{top:0,right:0,bottom:0,left:0}),this.set("height",0),this.set("isActive",!1),this.set("isDirty",!1),this.set("length",0),this.set("type",""),this._mutationObserver=Dt$1(()=>this._updateHeight()),this.content=this.createCollection(),this.content.add(te),this.mainView=te;const be=this.bindTemplate;this.setTemplate({tag:"div",attributes:{class:["ck","ck-annotation-wrapper","ck-rounded-corners",be.if("isActive","ck-annotation-wrapper--active")],tabindex:-1},children:this.content})}render(){super.render(),this.focusTracker.add(this.element),this.keystrokes.listenTo(this.element),this._mutationObserver.attach(this.element)}destroy(){this.content.clear(),this.keystrokes.destroy(),this.focusTracker.destroy(),this._mutationObserver.detach(),super.destroy()}focus(){this.element.focus()}_updateHeight(){const t=this.element.clientHeight;t&&(this.height=t)}},d$9=class m0 extends ObservableMixin(){constructor({view:t,target:te,type:be,isVisible:xe=!0}){super();Re(this,"view");Re(this,"focusableElements");Re(this,"_type");Re(this,"_target");this.view=t,this.view.element||this.view.render(),this._type=be,this._target=te,m0._assertCorrectTarget(this._getNormalizedTarget()),this.focusableElements=new Collection([this.view.element],{idProperty:"_id"}),this.focusableElements.on("add",(ve,ke)=>{this.view.focusTracker.add(ke)}),this.focusableElements.on("remove",(ve,ke)=>{this.view.focusTracker.remove(ke)}),this.set("isVisible",xe)}get type(){return typeof this._type=="function"?this._type():this._type}get innerView(){return this.view.mainView}get target(){const t=this._getNormalizedTarget();return m0._assertCorrectTarget(t),t}get targetRect(){const t=this.target;if(t===null)return null;if(t instanceof Rect)return t;const te=t.filter(be=>function(xe){return xe.offsetParent?!0:!!xe.getClientRects().item(0)}(be));return te.length===0?null:new Rect(te[0].getClientRects().item(0))}get isActive(){return this.view.isActive}set isActive(t){this.view.isActive=t,this.view.mainView.isActive=t}updateTargetRect(){this.view.targetRect=this.targetRect}destroy(){this.focusableElements.stopListening(),this.focusableElements.clear(),this.stopListening()}refreshVisibility(){this.isVisible=!!this.targetRect}static _assertCorrectTarget(t){if(!(t===null||t instanceof Rect||Array.isArray(t)&&t.every(te=>ee(te))))throw new CKEditorError("annotation-invalid-target",null,{target:t})}_getNormalizedTarget(){const t=typeof this._target=="function"?this._target():this._target;return ee(t)?[t]:t}};function ee(Te){return Te!==null&&typeof Te=="object"&&"nodeType"in Te&&Te.nodeType===1}let x$4=class extends Collection{constructor(t=[]){super();Re(this,"_innerViewToAnnotation");Re(this,"_viewToAnnotation");Re(this,"_focusTracker");this._innerViewToAnnotation=new Map,this._viewToAnnotation=new Map,this._focusTracker=new FocusTracker,this._focusTracker.on("change:isFocused",(te,be,xe)=>{xe||this.fire("blur")});for(const te of t)this.add(te)}get isFocused(){return this._focusTracker.isFocused}add(t){if(this.has(t))throw new CKEditorError("annotationcollection-duplicated-item",null);this._innerViewToAnnotation.set(t.innerView,t),this._viewToAnnotation.set(t.view,t);for(const be of t.focusableElements)this._focusTracker.add(be);this.listenTo(t.focusableElements,"add",(be,xe)=>{this._focusTracker.add(xe)}),this.listenTo(t.focusableElements,"remove",(be,xe)=>{this._focusTracker.remove(xe)}),this.listenTo(t.view.focusTracker,"change:isFocused",(be,xe,ve)=>{ve&&this.fire("focus",t)}),t.updateTargetRect();const te=this._getOrderInContent(t.view.targetRect);return super.add(t,te)}remove(t){if(!this.has(t))throw new CKEditorError("annotationcollection-not-existing-item",null);this.stopListening(t.view.focusTracker),this.stopListening(t.focusableElements);for(const te of t.focusableElements)this._focusTracker.remove(te);return this._viewToAnnotation.delete(t.view),this._innerViewToAnnotation.delete(t.innerView),super.remove(t)}getByInnerView(t){return this._innerViewToAnnotation.get(t)}getByView(t){return this._viewToAnnotation.get(t)}destroy(){super.clear(),this.stopListening(),this._innerViewToAnnotation.clear(),this._viewToAnnotation.clear(),this._focusTracker.destroy()}refreshPositioning(){for(const t of this)t.updateTargetRect();this._sort()}_sort(){const t=Array.from(this).sort((te,be)=>v$4(te.view.targetRect,be.view.targetRect));for(let te=t.length-1;te>0;te--){const be=t[te];te!==this.getIndex(be)&&(this.remove(be),this.add(be))}}_getOrderInContent(t){let te=0;if(!t)return this.length;for(const be of this){const xe=be.view.targetRect;if(xe){if(v$4(t,xe)<0)return te;te++}}return te}};function v$4(Te,we){if(Te===null&&we===null)return 0;if(Te===null)return-1;if(we===null)return 1;const t=Te.top-we.top;return t==0?Te.left-we.left:t}let b$3=class extends ContextPlugin{constructor(t){super(t);Re(this,"collection");Re(this,"_visibleAnnotations");this.collection=new x$4,this._visibleAnnotations=new x$4,this.set("activeAnnotations",new Set),this._bindAnnotationsToVisibleAnnotations()}static get pluginName(){return"Annotations"}add(t){this.collection.add(t)}remove(t){this.collection.remove(t),t.destroy()}refreshVisibility(){for(const t of this.collection)t.refreshVisibility()}refreshPositioning(){this._visibleAnnotations.refreshPositioning()}getByInnerView(t){return this.collection.getByInnerView(t)}deactivateAll(){this.fire("_deactivateAllAnnotations")}destroy(){for(const t of this.collection)t.destroy();this._visibleAnnotations.destroy(),this.collection.destroy(),super.destroy()}activate(t){this.fire("_activateAnnotation",t)}createAnnotation(t){return new d$9(t)}createAnnotationView(t,te){return new V$1(t,te)}_addActiveAnnotation(t){const te=new Set(this.activeAnnotations);te.add(t),this.activeAnnotations=te}_removeActiveAnnotation(t){const te=new Set(this.activeAnnotations);te.delete(t),this.activeAnnotations=te}_bindAnnotationsToVisibleAnnotations(){const t=this.collection,te=this._visibleAnnotations;function be(xe){const ve=xe.source;ve.isVisible&&!te.has(ve)?te.add(ve):!ve.isVisible&&te.has(ve)&&te.remove(ve),ve.view.focusTracker.remove(ve.view.element),ve.view.focusTracker.add(ve.view.element)}this.listenTo(t,"add",(xe,ve)=>{ve.isVisible&&te.add(ve),this.listenTo(ve,"change:isVisible",be)}),this.listenTo(t,"remove",(xe,ve)=>{te.has(ve)&&te.remove(ve),this.stopListening(ve,"change:isVisible",be)})}};const Ct$1=Symbol("noChannel"),vt$1={admin:!0,modifyAll:!1,write:!0,resolve:!0};let m$9=class extends ContextPlugin{constructor(t){super(t);Re(this,"licenseKey");Re(this,"_threads");Re(this,"_threadToController");Re(this,"_viewToController");this._threads=new Map,this._threadToController=new Map,this._viewToController=new Map,this.set("_readOnlyChannels",new Set),this.set("_permissions",new Map),this.licenseKey=this.context.config.get("licenseKey");const te=this.context.config;te.define("comments.maxCommentsWhenCollapsed",2),te.define("comments.maxThreadTotalWeight",500),te.define("comments.maxCommentCharsWhenCollapsed",140),te.define("comments.CommentThreadView",yt$2),te.define("comments.CommentView",At$1),te.get("comments.editorConfig")||console.warn("Missing comments editor configuration (`comments.editorConfig`). Default configuration will be used instead.")}static get requires(){return[b$3,PendingActions,l$8]}static get pluginName(){return"CommentsRepository"}init(){const t=this.context.plugins.get(b$3);this.set("activeCommentThread",null),this.on("addCommentThread",(te,be)=>this._addCommentThread(be)),this.on("submitCommentThread",(te,be)=>this._submitCommentThread(be)),this.on("resolveCommentThread",(te,be)=>this._resolveCommentThread(be)),this.on("resolveCommentThread",(te,be)=>this._updateActiveAnnotation(be),{priority:"lowest"}),this.on("reopenCommentThread",(te,be)=>this._reopenCommentThread(be)),this.on("reopenCommentThread",(te,be)=>this._updateActiveAnnotation(be),{priority:"lowest"}),this.on("removeCommentThread",(te,be)=>this._removeCommentThread(be)),this.on("updateCommentThread",(te,be)=>this._updateCommentThread(be)),this.on("updateCommentThread",(te,be)=>this._updateActiveAnnotation(be),{priority:"lowest"}),this.on("addComment",(te,be)=>this._addComment(be)),this.on("updateComment",(te,be)=>this._updateComment(be)),this.on("removeComment",(te,be)=>this._removeComment(be)),this.on("addComment",(te,{threadId:be,isFromAdapter:xe})=>{if(xe)return;const ve=this.getCommentThread(be),ke=ve&&this._threadToController.get(ve);ke&&ke.view.focus()},{priority:"lowest"}),this.listenTo(t,"change:activeAnnotations",(te,be,xe)=>{const ve=Array.from(xe).map(ke=>this._viewToController.get(ke.innerView)).filter(Boolean)[0];this.activeCommentThread=ve?ve.model:null})}afterInit(){(function(t){function te(xe,ve,ke){const Ie={};Ie[be([110,117,109,98,101,114,79,102,82,111,117,110,100,115])]={16:10,24:12,32:14},Ie[be([114,99,111,110])]=[1,2,4,8,16,32,64,128,27,54,108,216,171,77,154,47,94,188,99,198,151,53,106,212,179,125,250,239,197,145],Ie[be([83])]=[99,124,119,123,242,107,111,197,48,1,103,43,254,215,171,118,202,130,201,125,250,89,71,240,173,212,162,175,156,164,114,192,183,253,147,38,54,63,247,204,52,165,229,241,113,216,49,21,4,199,35,195,24,150,5,154,7,18,128,226,235,39,178,117,9,131,44,26,27,110,90,160,82,59,214,179,41,227,47,132,83,209,0,237,32,252,177,91,106,203,190,57,74,76,88,207,208,239,170,251,67,77,51,133,69,249,2,127,80,60,159,168,81,163,64,143,146,157,56,245,188,182,218,33,16,255,243,210,205,12,19,236,95,151,68,23,196,167,126,61,100,93,25,115,96,129,79,220,34,42,144,136,70,238,184,20,222,94,11,219,224,50,58,10,73,6,36,92,194,211,172,98,145,149,228,121,231,200,55,109,141,213,78,169,108,86,244,234,101,122,174,8,186,120,37,46,28,166,180,198,232,221,116,31,75,189,139,138,112,62,181,102,72,3,246,14,97,53,87,185,134,193,29,158,225,248,152,17,105,217,142,148,155,30,135,233,206,85,40,223,140,161,137,13,191,230,66,104,65,153,45,15,176,84,187,22],Ie[be([84,49])]=[3328402341,4168907908,4000806809,4135287693,4294111757,3597364157,3731845041,2445657428,1613770832,33620227,3462883241,1445669757,3892248089,3050821474,1303096294,3967186586,2412431941,528646813,2311702848,4202528135,4026202645,2992200171,2387036105,4226871307,1101901292,3017069671,1604494077,1169141738,597466303,1403299063,3832705686,2613100635,1974974402,3791519004,1033081774,1277568618,1815492186,2118074177,4126668546,2211236943,1748251740,1369810420,3521504564,4193382664,3799085459,2883115123,1647391059,706024767,134480908,2512897874,1176707941,2646852446,806885416,932615841,168101135,798661301,235341577,605164086,461406363,3756188221,3454790438,1311188841,2142417613,3933566367,302582043,495158174,1479289972,874125870,907746093,3698224818,3025820398,1537253627,2756858614,1983593293,3084310113,2108928974,1378429307,3722699582,1580150641,327451799,2790478837,3117535592,0,3253595436,1075847264,3825007647,2041688520,3059440621,3563743934,2378943302,1740553945,1916352843,2487896798,2555137236,2958579944,2244988746,3151024235,3320835882,1336584933,3992714006,2252555205,2588757463,1714631509,293963156,2319795663,3925473552,67240454,4269768577,2689618160,2017213508,631218106,1269344483,2723238387,1571005438,2151694528,93294474,1066570413,563977660,1882732616,4059428100,1673313503,2008463041,2950355573,1109467491,537923632,3858759450,4260623118,3218264685,2177748300,403442708,638784309,3287084079,3193921505,899127202,2286175436,773265209,2479146071,1437050866,4236148354,2050833735,3362022572,3126681063,840505643,3866325909,3227541664,427917720,2655997905,2749160575,1143087718,1412049534,999329963,193497219,2353415882,3354324521,1807268051,672404540,2816401017,3160301282,369822493,2916866934,3688947771,1681011286,1949973070,336202270,2454276571,201721354,1210328172,3093060836,2680341085,3184776046,1135389935,3294782118,965841320,831886756,3554993207,4068047243,3588745010,2345191491,1849112409,3664604599,26054028,2983581028,2622377682,1235855840,3630984372,2891339514,4092916743,3488279077,3395642799,4101667470,1202630377,268961816,1874508501,4034427016,1243948399,1546530418,941366308,1470539505,1941222599,2546386513,3421038627,2715671932,3899946140,1042226977,2521517021,1639824860,227249030,260737669,3765465232,2084453954,1907733956,3429263018,2420656344,100860677,4160157185,470683154,3261161891,1781871967,2924959737,1773779408,394692241,2579611992,974986535,664706745,3655459128,3958962195,731420851,571543859,3530123707,2849626480,126783113,865375399,765172662,1008606754,361203602,3387549984,2278477385,2857719295,1344809080,2782912378,59542671,1503764984,160008576,437062935,1707065306,3622233649,2218934982,3496503480,2185314755,697932208,1512910199,504303377,2075177163,2824099068,1841019862,739644986],Ie[be([84,50])]=[2781242211,2230877308,2582542199,2381740923,234877682,3184946027,2984144751,1418839493,1348481072,50462977,2848876391,2102799147,434634494,1656084439,3863849899,2599188086,1167051466,2636087938,1082771913,2281340285,368048890,3954334041,3381544775,201060592,3963727277,1739838676,4250903202,3930435503,3206782108,4149453988,2531553906,1536934080,3262494647,484572669,2923271059,1783375398,1517041206,1098792767,49674231,1334037708,1550332980,4098991525,886171109,150598129,2481090929,1940642008,1398944049,1059722517,201851908,1385547719,1699095331,1587397571,674240536,2704774806,252314885,3039795866,151914247,908333586,2602270848,1038082786,651029483,1766729511,3447698098,2682942837,454166793,2652734339,1951935532,775166490,758520603,3000790638,4004797018,4217086112,4137964114,1299594043,1639438038,3464344499,2068982057,1054729187,1901997871,2534638724,4121318227,1757008337,0,750906861,1614815264,535035132,3363418545,3988151131,3201591914,1183697867,3647454910,1265776953,3734260298,3566750796,3903871064,1250283471,1807470800,717615087,3847203498,384695291,3313910595,3617213773,1432761139,2484176261,3481945413,283769337,100925954,2180939647,4037038160,1148730428,3123027871,3813386408,4087501137,4267549603,3229630528,2315620239,2906624658,3156319645,1215313976,82966005,3747855548,3245848246,1974459098,1665278241,807407632,451280895,251524083,1841287890,1283575245,337120268,891687699,801369324,3787349855,2721421207,3431482436,959321879,1469301956,4065699751,2197585534,1199193405,2898814052,3887750493,724703513,2514908019,2696962144,2551808385,3516813135,2141445340,1715741218,2119445034,2872807568,2198571144,3398190662,700968686,3547052216,1009259540,2041044702,3803995742,487983883,1991105499,1004265696,1449407026,1316239930,504629770,3683797321,168560134,1816667172,3837287516,1570751170,1857934291,4014189740,2797888098,2822345105,2754712981,936633572,2347923833,852879335,1133234376,1500395319,3084545389,2348912013,1689376213,3533459022,3762923945,3034082412,4205598294,133428468,634383082,2949277029,2398386810,3913789102,403703816,3580869306,2297460856,1867130149,1918643758,607656988,4049053350,3346248884,1368901318,600565992,2090982877,2632479860,557719327,3717614411,3697393085,2249034635,2232388234,2430627952,1115438654,3295786421,2865522278,3633334344,84280067,33027830,303828494,2747425121,1600795957,4188952407,3496589753,2434238086,1486471617,658119965,3106381470,953803233,334231800,3005978776,857870609,3151128937,1890179545,2298973838,2805175444,3056442267,574365214,2450884487,550103529,1233637070,4289353045,2018519080,2057691103,2399374476,4166623649,2148108681,387583245,3664101311,836232934,3330556482,3100665960,3280093505,2955516313,2002398509,287182607,3413881008,4238890068,3597515707,975967766],Ie[be([84,51])]=[1671808611,2089089148,2006576759,2072901243,4061003762,1807603307,1873927791,3310653893,810573872,16974337,1739181671,729634347,4263110654,3613570519,2883997099,1989864566,3393556426,2191335298,3376449993,2106063485,4195741690,1508618841,1204391495,4027317232,2917941677,3563566036,2734514082,2951366063,2629772188,2767672228,1922491506,3227229120,3082974647,4246528509,2477669779,644500518,911895606,1061256767,4144166391,3427763148,878471220,2784252325,3845444069,4043897329,1905517169,3631459288,827548209,356461077,67897348,3344078279,593839651,3277757891,405286936,2527147926,84871685,2595565466,118033927,305538066,2157648768,3795705826,3945188843,661212711,2999812018,1973414517,152769033,2208177539,745822252,439235610,455947803,1857215598,1525593178,2700827552,1391895634,994932283,3596728278,3016654259,695947817,3812548067,795958831,2224493444,1408607827,3513301457,0,3979133421,543178784,4229948412,2982705585,1542305371,1790891114,3410398667,3201918910,961245753,1256100938,1289001036,1491644504,3477767631,3496721360,4012557807,2867154858,4212583931,1137018435,1305975373,861234739,2241073541,1171229253,4178635257,33948674,2139225727,1357946960,1011120188,2679776671,2833468328,1374921297,2751356323,1086357568,2408187279,2460827538,2646352285,944271416,4110742005,3168756668,3066132406,3665145818,560153121,271589392,4279952895,4077846003,3530407890,3444343245,202643468,322250259,3962553324,1608629855,2543990167,1154254916,389623319,3294073796,2817676711,2122513534,1028094525,1689045092,1575467613,422261273,1939203699,1621147744,2174228865,1339137615,3699352540,577127458,712922154,2427141008,2290289544,1187679302,3995715566,3100863416,339486740,3732514782,1591917662,186455563,3681988059,3762019296,844522546,978220090,169743370,1239126601,101321734,611076132,1558493276,3260915650,3547250131,2901361580,1655096418,2443721105,2510565781,3828863972,2039214713,3878868455,3359869896,928607799,1840765549,2374762893,3580146133,1322425422,2850048425,1823791212,1459268694,4094161908,3928346602,1706019429,2056189050,2934523822,135794696,3134549946,2022240376,628050469,779246638,472135708,2800834470,3032970164,3327236038,3894660072,3715932637,1956440180,522272287,1272813131,3185336765,2340818315,2323976074,1888542832,1044544574,3049550261,1722469478,1222152264,50660867,4127324150,236067854,1638122081,895445557,1475980887,3117443513,2257655686,3243809217,489110045,2662934430,3778599393,4162055160,2561878936,288563729,1773916777,3648039385,2391345038,2493985684,2612407707,505560094,2274497927,3911240169,3460925390,1442818645,678973480,3749357023,2358182796,2717407649,2306869641,219617805,3218761151,3862026214,1120306242,1756942440,1103331905,2578459033,762796589,252780047,2966125488,1425844308,3151392187,372911126],Ie[be([84,52])]=[1667474886,2088535288,2004326894,2071694838,4075949567,1802223062,1869591006,3318043793,808472672,16843522,1734846926,724270422,4278065639,3621216949,2880169549,1987484396,3402253711,2189597983,3385409673,2105378810,4210693615,1499065266,1195886990,4042263547,2913856577,3570689971,2728590687,2947541573,2627518243,2762274643,1920112356,3233831835,3082273397,4261223649,2475929149,640051788,909531756,1061110142,4160160501,3435941763,875846760,2779116625,3857003729,4059105529,1903268834,3638064043,825316194,353713962,67374088,3351728789,589522246,3284360861,404236336,2526454071,84217610,2593830191,117901582,303183396,2155911963,3806477791,3958056653,656894286,2998062463,1970642922,151591698,2206440989,741110872,437923380,454765878,1852748508,1515908788,2694904667,1381168804,993742198,3604373943,3014905469,690584402,3823320797,791638366,2223281939,1398011302,3520161977,0,3991743681,538992704,4244381667,2981218425,1532751286,1785380564,3419096717,3200178535,960056178,1246420628,1280103576,1482221744,3486468741,3503319995,4025428677,2863326543,4227536621,1128514950,1296947098,859002214,2240123921,1162203018,4193849577,33687044,2139062782,1347481760,1010582648,2678045221,2829640523,1364325282,2745433693,1077985408,2408548869,2459086143,2644360225,943212656,4126475505,3166494563,3065430391,3671750063,555836226,269496352,4294908645,4092792573,3537006015,3452783745,202118168,320025894,3974901699,1600119230,2543297077,1145359496,387397934,3301201811,2812801621,2122220284,1027426170,1684319432,1566435258,421079858,1936954854,1616945344,2172753945,1330631070,3705438115,572679748,707427924,2425400123,2290647819,1179044492,4008585671,3099120491,336870440,3739122087,1583276732,185277718,3688593069,3772791771,842159716,976899700,168435220,1229577106,101059084,606366792,1549591736,3267517855,3553849021,2897014595,1650632388,2442242105,2509612081,3840161747,2038008818,3890688725,3368567691,926374254,1835907034,2374863873,3587531953,1313788572,2846482505,1819063512,1448540844,4109633523,3941213647,1701162954,2054852340,2930698567,134748176,3132806511,2021165296,623210314,774795868,471606328,2795958615,3031746419,3334885783,3907527627,3722280097,1953799400,522133822,1263263126,3183336545,2341176845,2324333839,1886425312,1044267644,3048588401,1718004428,1212733584,50529542,4143317495,235803164,1633788866,892690282,1465383342,3115962473,2256965911,3250673817,488449850,2661202215,3789633753,4177007595,2560144171,286339874,1768537042,3654906025,2391705863,2492770099,2610673197,505291324,2273808917,3924369609,3469625735,1431699370,673740880,3755965093,2358021891,2711746649,2307489801,218961690,3217021541,3873845719,1111672452,1751693520,1094828930,2576986153,757954394,252645662,2964376443,1414855848,3149649517,370555436],Ie[be([85,49])]=[0,235474187,470948374,303765277,941896748,908933415,607530554,708780849,1883793496,2118214995,1817866830,1649639237,1215061108,1181045119,1417561698,1517767529,3767586992,4003061179,4236429990,4069246893,3635733660,3602770327,3299278474,3400528769,2430122216,2664543715,2362090238,2193862645,2835123396,2801107407,3035535058,3135740889,3678124923,3576870512,3341394285,3374361702,3810496343,3977675356,4279080257,4043610186,2876494627,2776292904,3076639029,3110650942,2472011535,2640243204,2403728665,2169303058,1001089995,899835584,666464733,699432150,59727847,226906860,530400753,294930682,1273168787,1172967064,1475418501,1509430414,1942435775,2110667444,1876241833,1641816226,2910219766,2743034109,2976151520,3211623147,2505202138,2606453969,2302690252,2269728455,3711829422,3543599269,3240894392,3475313331,3843699074,3943906441,4178062228,4144047775,1306967366,1139781709,1374988112,1610459739,1975683434,2076935265,1775276924,1742315127,1034867998,866637845,566021896,800440835,92987698,193195065,429456164,395441711,1984812685,2017778566,1784663195,1683407248,1315562145,1080094634,1383856311,1551037884,101039829,135050206,437757123,337553864,1042385657,807962610,573804783,742039012,2531067453,2564033334,2328828971,2227573024,2935566865,2700099354,3001755655,3168937228,3868552805,3902563182,4203181171,4102977912,3736164937,3501741890,3265478751,3433712980,1106041591,1340463100,1576976609,1408749034,2043211483,2009195472,1708848333,1809054150,832877231,1068351396,766945465,599762354,159417987,126454664,361929877,463180190,2709260871,2943682380,3178106961,3009879386,2572697195,2538681184,2236228733,2336434550,3509871135,3745345300,3441850377,3274667266,3910161971,3877198648,4110568485,4211818798,2597806476,2497604743,2261089178,2295101073,2733856160,2902087851,3202437046,2968011453,3936291284,3835036895,4136440770,4169408201,3535486456,3702665459,3467192302,3231722213,2051518780,1951317047,1716890410,1750902305,1113818384,1282050075,1584504582,1350078989,168810852,67556463,371049330,404016761,841739592,1008918595,775550814,540080725,3969562369,3801332234,4035489047,4269907996,3569255213,3669462566,3366754619,3332740144,2631065433,2463879762,2160117071,2395588676,2767645557,2868897406,3102011747,3069049960,202008497,33778362,270040487,504459436,875451293,975658646,675039627,641025152,2084704233,1917518562,1615861247,1851332852,1147550661,1248802510,1484005843,1451044056,933301370,967311729,733156972,632953703,260388950,25965917,328671808,496906059,1206477858,1239443753,1543208500,1441952575,2144161806,1908694277,1675577880,1842759443,3610369226,3644379585,3408119516,3307916247,4011190502,3776767469,4077384432,4245618683,2809771154,2842737049,3144396420,3043140495,2673705150,2438237621,2203032232,2370213795],Ie[be([85,50])]=[0,185469197,370938394,487725847,741876788,657861945,975451694,824852259,1483753576,1400783205,1315723890,1164071807,1950903388,2135319889,1649704518,1767536459,2967507152,3152976349,2801566410,2918353863,2631447780,2547432937,2328143614,2177544179,3901806776,3818836405,4270639778,4118987695,3299409036,3483825537,3535072918,3652904859,2077965243,1893020342,1841768865,1724457132,1474502543,1559041666,1107234197,1257309336,598438867,681933534,901210569,1052338372,261314535,77422314,428819965,310463728,3409685355,3224740454,3710368113,3593056380,3875770207,3960309330,4045380933,4195456072,2471224067,2554718734,2237133081,2388260884,3212035895,3028143674,2842678573,2724322336,4138563181,4255350624,3769721975,3955191162,3667219033,3516619604,3431546947,3347532110,2933734917,2782082824,3099667487,3016697106,2196052529,2313884476,2499348523,2683765030,1179510461,1296297904,1347548327,1533017514,1786102409,1635502980,2087309459,2003294622,507358933,355706840,136428751,53458370,839224033,957055980,605657339,790073846,2373340630,2256028891,2607439820,2422494913,2706270690,2856345839,3075636216,3160175349,3573941694,3725069491,3273267108,3356761769,4181598602,4063242375,4011996048,3828103837,1033297158,915985419,730517276,545572369,296679730,446754879,129166120,213705253,1709610350,1860738147,1945798516,2029293177,1239331162,1120974935,1606591296,1422699085,4148292826,4233094615,3781033664,3931371469,3682191598,3497509347,3446004468,3328955385,2939266226,2755636671,3106780840,2988687269,2198438022,2282195339,2501218972,2652609425,1201765386,1286567175,1371368976,1521706781,1805211710,1620529459,2105887268,1988838185,533804130,350174575,164439672,46346101,870912086,954669403,636813900,788204353,2358957921,2274680428,2592523643,2441661558,2695033685,2880240216,3065962831,3182487618,3572145929,3756299780,3270937875,3388507166,4174560061,4091327024,4006521127,3854606378,1014646705,930369212,711349675,560487590,272786309,457992840,106852767,223377554,1678381017,1862534868,1914052035,2031621326,1211247597,1128014560,1580087799,1428173050,32283319,182621114,401639597,486441376,768917123,651868046,1003007129,818324884,1503449823,1385356242,1333838021,1150208456,1973745387,2125135846,1673061617,1756818940,2970356327,3120694122,2802849917,2887651696,2637442643,2520393566,2334669897,2149987652,3917234703,3799141122,4284502037,4100872472,3309594171,3460984630,3545789473,3629546796,2050466060,1899603969,1814803222,1730525723,1443857720,1560382517,1075025698,1260232239,575138148,692707433,878443390,1062597235,243256656,91341917,409198410,325965383,3403100636,3252238545,3704300486,3620022987,3874428392,3990953189,4042459122,4227665663,2460449204,2578018489,2226875310,2411029155,3198115200,3046200461,2827177882,2743944855],Ie[be([85,51])]=[0,218828297,437656594,387781147,875313188,958871085,775562294,590424639,1750626376,1699970625,1917742170,2135253587,1551124588,1367295589,1180849278,1265195639,3501252752,3720081049,3399941250,3350065803,3835484340,3919042237,4270507174,4085369519,3102249176,3051593425,2734591178,2952102595,2361698556,2177869557,2530391278,2614737639,3145456443,3060847922,2708326185,2892417312,2404901663,2187128086,2504130317,2555048196,3542330227,3727205754,3375740769,3292445032,3876557655,3926170974,4246310725,4027744588,1808481195,1723872674,1910319033,2094410160,1608975247,1391201670,1173430173,1224348052,59984867,244860394,428169201,344873464,935293895,984907214,766078933,547512796,1844882806,1627235199,2011214180,2062270317,1507497298,1423022939,1137477952,1321699145,95345982,145085239,532201772,313773861,830661914,1015671571,731183368,648017665,3175501286,2957853679,2807058932,2858115069,2305455554,2220981195,2474404304,2658625497,3575528878,3625268135,3473416636,3254988725,3778151818,3963161475,4213447064,4130281361,3599595085,3683022916,3432737375,3247465558,3802222185,4020912224,4172763771,4122762354,3201631749,3017672716,2764249623,2848461854,2331590177,2280796200,2431590963,2648976442,104699613,188127444,472615631,287343814,840019705,1058709744,671593195,621591778,1852171925,1668212892,1953757831,2037970062,1514790577,1463996600,1080017571,1297403050,3673637356,3623636965,3235995134,3454686199,4007360968,3822090177,4107101658,4190530515,2997825956,3215212461,2830708150,2779915199,2256734592,2340947849,2627016082,2443058075,172466556,122466165,273792366,492483431,1047239e3,861968209,612205898,695634755,1646252340,1863638845,2013908262,1963115311,1446242576,1530455833,1277555970,1093597963,1636604631,1820824798,2073724613,1989249228,1436590835,1487645946,1337376481,1119727848,164948639,81781910,331544205,516552836,1039717051,821288114,669961897,719700128,2973530695,3157750862,2871682645,2787207260,2232435299,2283490410,2667994737,2450346104,3647212047,3564045318,3279033885,3464042516,3980931627,3762502690,4150144569,4199882800,3070356634,3121275539,2904027272,2686254721,2200818878,2384911031,2570832044,2486224549,3747192018,3528626907,3310321856,3359936201,3950355702,3867060991,4049844452,4234721005,1739656202,1790575107,2108100632,1890328081,1402811438,1586903591,1233856572,1149249077,266959938,48394827,369057872,418672217,1002783846,919489135,567498868,752375421,209336225,24197544,376187827,459744698,945164165,895287692,574624663,793451934,1679968233,1764313568,2117360635,1933530610,1343127501,1560637892,1243112415,1192455638,3704280881,3519142200,3336358691,3419915562,3907448597,3857572124,4075877127,4294704398,3029510009,3113855344,2927934315,2744104290,2159976285,2377486676,2594734927,2544078150],Ie[be([85,52])]=[0,151849742,303699484,454499602,607398968,758720310,908999204,1059270954,1214797936,1097159550,1517440620,1400849762,1817998408,1699839814,2118541908,2001430874,2429595872,2581445614,2194319100,2345119218,3034881240,3186202582,2801699524,2951971274,3635996816,3518358430,3399679628,3283088770,4237083816,4118925222,4002861748,3885750714,1002142683,850817237,698445255,548169417,529487843,377642221,227885567,77089521,1943217067,2061379749,1640576439,1757691577,1474760595,1592394909,1174215055,1290801793,2875968315,2724642869,3111247143,2960971305,2405426947,2253581325,2638606623,2487810577,3808662347,3926825029,4044981591,4162096729,3342319475,3459953789,3576539503,3693126241,1986918061,2137062819,1685577905,1836772287,1381620373,1532285339,1078185097,1229899655,1040559837,923313619,740276417,621982671,439452389,322734571,137073913,19308535,3871163981,4021308739,4104605777,4255800159,3263785589,3414450555,3499326569,3651041127,2933202493,2815956275,3167684641,3049390895,2330014213,2213296395,2566595609,2448830231,1305906550,1155237496,1607244650,1455525988,1776460110,1626319424,2079897426,1928707164,96392454,213114376,396673818,514443284,562755902,679998e3,865136418,983426092,3708173718,3557504664,3474729866,3323011204,4180808110,4030667424,3945269170,3794078908,2507040230,2623762152,2272556026,2390325492,2975484382,3092726480,2738905026,2857194700,3973773121,3856137295,4274053469,4157467219,3371096953,3252932727,3673476453,3556361835,2763173681,2915017791,3064510765,3215307299,2156299017,2307622919,2459735317,2610011675,2081048481,1963412655,1846563261,1729977011,1480485785,1362321559,1243905413,1126790795,878845905,1030690015,645401037,796197571,274084841,425408743,38544885,188821243,3613494426,3731654548,3313212038,3430322568,4082475170,4200115116,3780097726,3896688048,2668221674,2516901860,2366882550,2216610296,3141400786,2989552604,2837966542,2687165888,1202797690,1320957812,1437280870,1554391400,1669664834,1787304780,1906247262,2022837584,265905162,114585348,499347990,349075736,736970802,585122620,972512814,821712160,2595684844,2478443234,2293045232,2174754046,3196267988,3079546586,2895723464,2777952454,3537852828,3687994002,3234156416,3385345166,4142626212,4293295786,3841024952,3992742070,174567692,57326082,410887952,292596766,777231668,660510266,1011452712,893681702,1108339068,1258480242,1343618912,1494807662,1715193156,1865862730,1948373848,2100090966,2701949495,2818666809,3004591147,3122358053,2235061775,2352307457,2535604243,2653899549,3915653703,3764988233,4219352155,4067639125,3444575871,3294430577,3746175075,3594982253,836553431,953270745,600235211,718002117,367585007,484830689,133361907,251657213,2041877159,1891211689,1806599355,1654886325,1568718495,1418573201,1335535747,1184342925];const Ae=new Uint8Array(16);for(let He=15;He>=0;--He)Ae[He]=ke%256,ke=parseInt(ke/256);let Se=null,Oe=16;const Ve=new Uint8Array(ve),Me=[],De=[];Ue();for(let He=0;He<xe[be([108,101,110,103,116,104])];He++)Oe===16&&(Se=$e(Ae),Oe=0,Be(Ae)),xe[He]^=Se[Oe++];return xe;function Fe(He){const ze=[];for(let qe=0;qe<He[be([108,101,110,103,116,104])];qe+=4)ze[be([112,117,115,104])](He[qe]<<24|He[qe+1]<<16|He[qe+2]<<8|He[qe+3]);return ze}function Be(He){for(let ze=15;ze>=0;ze--){if(He[ze]!==255){He[ze]++;break}He[ze]=0}}function $e(He){const ze=Me[be([108,101,110,103,116,104])]-1,qe=[0,0,0,0];let Ke=Fe(He);for(let Ye=0;Ye<4;Ye++)Ke[Ye]^=Me[0][Ye];for(let Ye=1;Ye<ze;Ye++){for(let ht=0;ht<4;ht++)qe[ht]=Ie[be([84,49])][Ke[ht]>>24&255]^Ie[be([84,50])][Ke[(ht+1)%4]>>16&255]^Ie[be([84,51])][Ke[(ht+2)%4]>>8&255]^Ie[be([84,52])][255&Ke[(ht+3)%4]]^Me[Ye][ht];Ke=qe[be([115,108,105,99,101])]()}const Qe=new Uint8Array(16);let je;for(let Ye=0;Ye<4;Ye++)je=Me[ze][Ye],Qe[4*Ye]=255&(Ie[be([83])][Ke[Ye]>>24&255]^je>>24),Qe[4*Ye+1]=255&(Ie[be([83])][Ke[(Ye+1)%4]>>16&255]^je>>16),Qe[4*Ye+2]=255&(Ie[be([83])][Ke[(Ye+2)%4]>>8&255]^je>>8),Qe[4*Ye+3]=255&(Ie[be([83])][255&Ke[(Ye+3)%4]]^je);return Qe}function Ue(){const He=Ie[be([110,117,109,98,101,114,79,102,82,111,117,110,100,115])][Ve[be([108,101,110,103,116,104])]];for(let Ze=0;Ze<=He;Ze++)Me[be([112,117,115,104])]([0,0,0,0]),De[be([112,117,115,104])]([0,0,0,0]);const ze=4*(He+1),qe=Ve[be([108,101,110,103,116,104])]/4,Ke=Fe(Ve);let Qe;for(let Ze=0;Ze<qe;Ze++)Qe=Ze>>2,Me[Qe][Ze%4]=Ke[Ze],De[He-Qe][Ze%4]=Ke[Ze];let je,Ye=0,ht=qe;for(;ht<ze;){je=Ke[qe-1],Ke[0]^=Ie[be([83])][je>>16&255]<<24^Ie[be([83])][je>>8&255]<<16^Ie[be([83])][255&je]<<8^Ie[be([83])][je>>24&255]^Ie[be([114,99,111,110])][Ye]<<24,Ye+=1;for(let Yt=1;Yt<qe/2;Yt++)Ke[Yt]^=Ke[Yt-1];je=Ke[qe/2-1],Ke[qe/2]^=Ie[be([83])][255&je]^Ie[be([83])][je>>8&255]<<8^Ie[be([83])][je>>16&255]<<16^Ie[be([83])][je>>24&255]<<24;for(let Yt=qe/2+1;Yt<qe;Yt++)Ke[Yt]^=Ke[Yt-1];let Ze,Bt,Jt=0;for(;Jt<qe&&ht<ze;)Ze=ht>>2,Bt=ht%4,Me[Ze][Bt]=Ke[Jt],De[He-Ze][Bt]=Ke[Jt++],ht++}for(let Ze=1;Ze<He;Ze++)for(let Bt=0;Bt<4;Bt++)je=De[Ze][Bt],De[Ze][Bt]=Ie[be([85,49])][je>>24&255]^Ie[be([85,50])][je>>16&255]^Ie[be([85,51])][je>>8&255]^Ie[be([85,52])][255&je]}}function be(xe){return xe.map(ve=>String.fromCharCode(ve)).join("")}(xe=>{function ve(){const Ne=[{[be([105,100])]:1,[be([102,101,97,116,117,114,101,78,97,109,101])]:be([67,111,109,109,101,110,116,115]),[be([112,108,117,103,105,110,78,97,109,101])]:be([67,111,109,109,101,110,116,115,82,101,112,111,115,105,116,111,114,121]),[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:be([108,105,99,101,110,115,101,75,101,121]),[be([104,97,110,100,108,101,114])]:be([99,104,101,99,107,76,105,99,101,110,115,101]),[be([99,104,101,99,107,65,108,115,111])]:[{[be([105,100])]:2,[be([102,101,97,116,117,114,101,78,97,109,101])]:be([84,114,97,99,107,32,67,104,97,110,103,101,115]),[be([112,108,117,103,105,110,78,97,109,101])]:be([84,114,97,99,107,67,104,97,110,103,101,115,69,100,105,116,105,110,103]),[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:be([108,105,99,101,110,115,101,75,101,121]),[be([104,97,110,100,108,101,114])]:be([99,104,101,99,107,76,105,99,101,110,115,101,70,111,114,84,114,97,99,107,67,104,97,110,103,101,115]),[be([111,112,116,105,111,110,115])]:{[be([97,105,119,115,103,105,99])]:!0,[be([97,105,116,99,100,103,105,108])]:!0,[be([97,105,114,118,105,105,108])]:!0}}],[be([111,112,116,105,111,110,115])]:{[be([97,105,119,115,103,105,99])]:!0,[be([97,105,116,99,100,103,105,108])]:!0,[be([97,105,114,118,105,105,108])]:!0}},{[be([105,100])]:3,[be([102,101,97,116,117,114,101,78,97,109,101])]:be([80,97,103,105,110,97,116,105,111,110]),[be([112,108,117,103,105,110,78,97,109,101])]:be([80,97,103,105,110,97,116,105,111,110,76,111,111,107,117,112]),[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:be([112,97,103,105,110,97,116,105,111,110,76,105,99,101,110,115,101,75,101,121]),[be([104,97,110,100,108,101,114])]:be([99,104,101,99,107,76,105,99,101,110,115,101])},{[be([105,100])]:4,[be([102,101,97,116,117,114,101,78,97,109,101])]:be([82,101,118,105,115,105,111,110,32,72,105,115,116,111,114,121]),[be([112,108,117,103,105,110,78,97,109,101])]:be([82,101,118,105,115,105,111,110,115,82,101,112,111,115,105,116,111,114,121]),[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:be([108,105,99,101,110,115,101,75,101,121]),[be([104,97,110,100,108,101,114])]:be([99,104,101,99,107,76,105,99,101,110,115,101,70,111,114,82,101,118,105,115,105,111,110,72,105,115,116,111,114,121]),[be([111,112,116,105,111,110,115])]:{[be([97,105,119,115,103,105,99])]:!0,[be([97,105,116,99,100,103,105,108])]:!0,[be([97,105,114,118,105,105,108])]:!0}},{[be([105,100])]:5,[be([102,101,97,116,117,114,101,78,97,109,101])]:be([68,111,99,117,109,101,110,116,32,79,117,116,108,105,110,101]),[be([112,108,117,103,105,110,78,97,109,101])]:be([68,111,99,117,109,101,110,116,79,117,116,108,105,110,101,85,73]),[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:be([100,111,99,117,109,101,110,116,79,117,116,108,105,110,101,76,105,99,101,110,115,101,75,101,121]),[be([104,97,110,100,108,101,114])]:be([99,104,101,99,107,76,105,99,101,110,115,101]),[be([111,112,116,105,111,110,115])]:{[be([102,103,105])]:[12]}},{[be([105,100])]:6,[be([102,101,97,116,117,114,101,78,97,109,101])]:be([70,111,114,109,97,116,32,80,97,105,110,116,101,114]),[be([112,108,117,103,105,110,78,97,109,101])]:be([70,111,114,109,97,116,80,97,105,110,116,101,114,85,73]),[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:be([102,111,114,109,97,116,80,97,105,110,116,101,114,76,105,99,101,110,115,101,75,101,121]),[be([104,97,110,100,108,101,114])]:be([99,104,101,99,107,76,105,99,101,110,115,101]),[be([111,112,116,105,111,110,115])]:{[be([102,103,105])]:[12]}},{[be([105,100])]:7,[be([102,101,97,116,117,114,101,78,97,109,101])]:be([83,108,97,115,104,32,67,111,109,109,97,110,100]),[be([112,108,117,103,105,110,78,97,109,101])]:be([83,108,97,115,104,67,111,109,109,97,110,100,85,73]),[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:be([115,108,97,115,104,67,111,109,109,97,110,100,76,105,99,101,110,115,101,75,101,121]),[be([104,97,110,100,108,101,114])]:be([99,104,101,99,107,76,105,99,101,110,115,101]),[be([111,112,116,105,111,110,115])]:{[be([102,103,105])]:[12]}},{[be([105,100])]:8,[be([102,101,97,116,117,114,101,78,97,109,101])]:be([84,97,98,108,101,32,111,102,32,67,111,110,116,101,110,116,115]),[be([112,108,117,103,105,110,78,97,109,101])]:be([84,97,98,108,101,79,102,67,111,110,116,101,110,116,115,69,100,105,116,105,110,103]),[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:be([116,97,98,108,101,79,102,67,111,110,116,101,110,116,115,76,105,99,101,110,115,101,75,101,121]),[be([104,97,110,100,108,101,114])]:be([99,104,101,99,107,76,105,99,101,110,115,101]),[be([111,112,116,105,111,110,115])]:{[be([102,103,105])]:[12]}},{[be([105,100])]:9,[be([102,101,97,116,117,114,101,78,97,109,101])]:be([84,101,109,112,108,97,116,101]),[be([112,108,117,103,105,110,78,97,109,101])]:be([84,101,109,112,108,97,116,101,85,73]),[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:be([116,101,109,112,108,97,116,101,76,105,99,101,110,115,101,75,101,121]),[be([104,97,110,100,108,101,114])]:be([99,104,101,99,107,76,105,99,101,110,115,101]),[be([111,112,116,105,111,110,115])]:{[be([102,103,105])]:[12,14]}},{[be([105,100])]:10,[be([102,101,97,116,117,114,101,78,97,109,101])]:be([80,97,115,116,101,32,102,114,111,109,32,79,102,102,105,99,101,32,69,110,104,97,110,99,101,100]),[be([112,108,117,103,105,110,78,97,109,101])]:be([80,97,115,116,101,70,114,111,109,79,102,102,105,99,101,69,110,104,97,110,99,101,100,73,110,108,105,110,101,114]),[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:be([112,97,115,116,101,70,114,111,109,79,102,102,105,99,101,69,110,104,97,110,99,101,100,76,105,99,101,110,115,101,75,101,121]),[be([104,97,110,100,108,101,114])]:be([99,104,101,99,107,76,105,99,101,110,115,101]),[be([111,112,116,105,111,110,115])]:{[be([102,103,105])]:[12]}},{[be([105,100])]:11,[be([102,101,97,116,117,114,101,78,97,109,101])]:be([65,73,32,65,115,115,105,115,116,97,110,116]),[be([112,108,117,103,105,110,78,97,109,101])]:be([65,73,65,115,115,105,115,116,97,110,116,85,73]),[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:be([97,105,76,105,99,101,110,115,101,75,101,121]),[be([104,97,110,100,108,101,114])]:be([99,104,101,99,107,76,105,99,101,110,115,101])},{[be([105,100])]:12,[be([102,101,97,116,117,114,101,78,97,109,101])]:be([80,114,111,100,117,99,116,105,118,105,116,121,32,112,97,99,107])},{[be([105,100])]:13,[be([102,101,97,116,117,114,101,78,97,109,101])]:be([67,97,115,101,32,67,104,97,110,103,101]),[be([112,108,117,103,105,110,78,97,109,101])]:be([67,97,115,101,67,104,97,110,103,101,85,73]),[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:be([99,97,115,101,67,104,97,110,103,101,76,105,99,101,110,115,101,75,101,121]),[be([104,97,110,100,108,101,114])]:be([99,104,101,99,107,76,105,99,101,110,115,101]),[be([111,112,116,105,111,110,115])]:{[be([102,103,105])]:[12]}},{[be([105,100])]:14,[be([102,101,97,116,117,114,101,78,97,109,101])]:be([68,114,117,112,97,108,32,112,97,99,107]),[be([102,111,114,98,105,100,100,101,110,72,97,110,100,108,101,114])]:be([102,111,114,98,105,100,100,101,110,72,97,110,100,108,101,114,70,111,114,68,114,117,112,97,108])},{[be([105,100])]:15,[be([102,101,97,116,117,114,101,78,97,109,101])]:be([77,117,108,116,105,32,76,101,118,101,108,32,76,105,115,116]),[be([112,108,117,103,105,110,78,97,109,101])]:be([77,117,108,116,105,76,101,118,101,108,76,105,115,116,69,100,105,116,105,110,103]),[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:be([109,117,108,116,105,76,101,118,101,108,76,105,115,116,76,105,99,101,110,115,101,75,101,121]),[be([104,97,110,100,108,101,114])]:be([99,104,101,99,107,76,105,99,101,110,115,101])},{[be([105,100])]:16,[be([102,101,97,116,117,114,101,78,97,109,101])]:be([77,101,114,103,101,32,70,105,101,108,100,115]),[be([112,108,117,103,105,110,78,97,109,101])]:be([77,101,114,103,101,70,105,101,108,100,115,85,73]),[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:be([109,101,114,103,101,70,105,101,108,100,115,76,105,99,101,110,115,101,75,101,121]),[be([104,97,110,100,108,101,114])]:be([99,104,101,99,107,76,105,99,101,110,115,101]),[be([111,112,116,105,111,110,115])]:{[be([102,103,105])]:[12]}}];return We(Ne),Ne;function Le(Je){return 1<<Je-1}function We(Je){Je[be([102,111,114,69,97,99,104])](Wt=>{Wt[be([112,101,114,109,105,115,115,105,111,110,77,97,115,107])]=Le(Wt[be([105,100])]),ke(Wt)&&Wt[be([99,104,101,99,107,65,108,115,111])]&&We(Wt[be([99,104,101,99,107,65,108,115,111])])})}}function ke(Ne){return be([112,108,117,103,105,110,78,97,109,101])in Ne}const Ie=[1,85,78,115,198,255,50,112,83,87,161],Ae=[127,34,6,211,167,86,146,199,132,160,18];function Se(Ne){const Le=[29,221,175,90,231,133,239,240,75,180];return Oe(Ne,new Uint8Array([...Ie,...Le,...Ae]))}function Oe(Ne,Le){const We=Ve(Ne),Je=Array[be([102,114,111,109])](Ge(We)),Wt=Je[be([112,111,112])](),nn=Je[be([112,111,112])]();return pn(te(Je,Le,nn+256*Wt))}function Ve(Ne){const Le=atob(Ne),[We,Je]=Le[be([115,112,108,105,116])](be([45]));try{if(atob(Je))return atob(We)}catch{}return Le}function Me(Ne){try{const Le=Se(Ne),We=JSON[be([112,97,114,115,101])](Le),Je=parseInt(We[be([49])]),Wt=We[be([50])]||"",nn=parseInt(We[be([51])]),cn=parseInt(We[be([52])])||0,fn=parseInt(We[be([53])])||0;return{[be([112,114,111,100,117,99,116,78,97,109,101])]:Wt,[be([97,108,108,111,119,101,100,80,108,117,103,105,110,115])]:cn,[be([101,120,112,105,114,97,116,105,111,110,68,97,116,101])]:Je,[be([105,115,84,114,105,97,108])]:nn,[be([105,115,73,110,116,101,114,110,97,108])]:fn}}catch{return null}}const De=ve(),Fe={[be([99,104,101,99,107,76,105,99,101,110,115,101])]:Qe,[be([99,104,101,99,107,76,105,99,101,110,115,101,70,111,114,84,114,97,99,107,67,104,97,110,103,101,115])]:je,[be([99,104,101,99,107,76,105,99,101,110,115,101,70,111,114,82,101,118,105,115,105,111,110,72,105,115,116,111,114,121])]:Ye},Be=xe[be([99,111,110,115,116,114,117,99,116,111,114])][be([112,108,117,103,105,110,78,97,109,101])],$e=be([99,111,110,116,101,120,116])in xe?xe.context:xe.editor,Ue=be([52,48,52,56,49,52,50,50]),He=be([65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,48,49,50,51,52,53,54,55,56,57]),ze=$e.config.get(be([108,105,99,101,110,115,101,75,101,121])),qe=De[be([102,105,108,116,101,114])](ke)[be([102,105,110,100])](Ne=>Ne[be([112,108,117,103,105,110,78,97,109,101])]===Be);function Ke(Ne,Le){Fe[Le[be([104,97,110,100,108,101,114])]](Ne,Le),Le[be([99,104,101,99,107,65,108,115,111])]&&Le[be([99,104,101,99,107,65,108,115,111])][be([102,105,108,116,101,114])](We=>Kt($e,We[be([112,108,117,103,105,110,78,97,109,101])]))[be([102,111,114,69,97,99,104])](We=>Ke(Ne,We))}function Qe(Ne,Le){Ze(ht(Ne,Le),Le)}function je(Ne,Le){function We(Je,Wt){try{if(Kt($e,be([84,114,97,99,107,67,104,97,110,103,101,115,69,100,105,116,105,110,103]))&&Je){const nn=Xt($e,be([84,114,97,99,107,67,104,97,110,103,101,115,69,100,105,116,105,110,103]))[be([95,101,120,101,99,117,116,101,83,117,103,103,101,115,116,105,111,110])];if(parseInt(nn)/2>Je[be([101,120,112,105,114,97,116,105,111,110,68,97,116,101])])return Bt(Wt[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+be([73,110,118,97,108,105,100]))}return ht(Je,Wt)}catch{return Bt(Wt[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+be([73,110,118,97,108,105,100]))}}Ze(We(Ne,Le),Le)}function Ye(Ne,Le){const We=Ae[0]*Ie[1],Je=Ae[0]*Ie[2],Wt=Ae[2]*Ie[2];Kt($e,be([87,101,98,83,111,99,107,101,116,71,97,116,101,119,97,121]))&&Xt($e,be([87,101,98,83,111,99,107,101,116,71,97,116,101,119,97,121]))[be([115,116,97,116,101])]==be([99,111,110,110,101,99,116,101,100])&&(window[Jt()]=Wt);function nn(Xe,Qt){try{return un()?Bt(Qt[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+be([86,97,108,105,100])):ht(Xe,Qt)}catch{return Bt(Qt[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+be([73,110,118,97,108,105,100]))}}function cn(Xe,Qt){if(Xe==Qt[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+be([73,110,118,97,108,105,100]))zt();else if(Xe==Qt[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+be([84,114,105,97,108])){const rn=fn();rn&&ln(rn,Qt[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]);const xn=dn();window[be([115,101,116,84,105,109,101,111,117,116])](()=>{ln(be([116,105,109,101]),Qt[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])])},xn);const wn=Xt($e,be([82,101,118,105,115,105,111,110,115,82,101,112,111,115,105,116,111,114,121]))[be([95,114,101,118,105,115,105,111,110,115])];wn[be([108,101,110,103,116,104])]>=7?ln(be([114,101,118,105,115,105,111,110,115]),Qt[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]):wn.on(be([97,100,100]),()=>{wn[be([108,101,110,103,116,104])]>=7&&ln(be([114,101,118,105,115,105,111,110,115]),Qt[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])])})}}function fn(){if(!Kt($e,be([82,101,118,105,115,105,111,110,86,105,101,119,101,114])))return!1;for(const Xe in window)if(Number.isNaN(Number(Xe))){if(window[Xe]===We)return be([116,105,109,101]);if(window[Xe]===Je)return be([114,101,118,105,115,105,111,110,115])}return!1}function un(){if(!Kt($e,be([82,101,118,105,115,105,111,110,86,105,101,119,101,114])))return!1;for(const Xe in window)if(Number.isNaN(Number(Xe))&&window[Xe]===Wt)return!0;return!1}function ln(Xe,Qt){zt(),Bt(Qt+be([84,114,105,97,108,76,105,109,105,116,58])+Xe),window[Jt()]=Xe===be([116,105,109,101])?We:Je}function dn(){let Xe=Ae[6]*Ie[8]*Ie[6];return Kt($e,be([82,101,118,105,115,105,111,110,86,105,101,119,101,114]))&&(Xe/=10),Xe}function zt(){const Xe=$e;function Qt(){Kt(Xe,be([82,101,118,105,115,105,111,110,84,114,97,99,107,101,114]))&&(Xt(Xe,be([82,101,118,105,115,105,111,110,84,114,97,99,107,101,114]))[be([117,110,98,105,110,100])](be([105,115,69,110,97,98,108,101,100])),Xt(Xe,be([82,101,118,105,115,105,111,110,84,114,97,99,107,101,114]))[be([105,115,69,110,97,98,108,101,100])]=!1,Xt(Xe,be([82,101,118,105,115,105,111,110,84,114,97,99,107,101,114]))[be([117,112,100,97,116,101])]=sn,Xt(Xe,be([82,101,118,105,115,105,111,110,84,114,97,99,107,101,114]))[be([115,97,118,101,82,101,118,105,115,105,111,110])]=sn,Xe[be([109,111,100,101,108])][be([99,104,97,110,103,101])]=sn,Xe[be([109,111,100,101,108])][be([101,110,113,117,101,117,101,67,104,97,110,103,101])]=sn,Xe[be([101,110,97,98,108,101,82,101,97,100,79,110,108,121,77,111,100,101])](be([109,111,100,101,108]))),Kt(Xe,be([82,101,118,105,115,105,111,110,86,105,101,119,101,114]))&&(Xt(Xe,be([82,101,118,105,115,105,111,110,86,105,101,119,101,114]))[be([117,110,98,105,110,100])](be([105,115,69,110,97,98,108,101,100])),Xt(Xe,be([82,101,118,105,115,105,111,110,86,105,101,119,101,114]))[be([105,115,69,110,97,98,108,101,100])]=!1,Xt(Xe,be([82,101,118,105,115,105,111,110,86,105,101,119,101,114]))[be([99,111,109,112,97,114,101])]=sn,Xt(Xe,be([82,101,118,105,115,105,111,110,86,105,101,119,101,114]))[be([95,103,101,116,68,105,102,102])]=sn)}Xe[be([115,116,97,116,101])]==be([114,101,97,100,121])?Qt():Xe[be([111,110,99,101])](be([114,101,97,100,121]),()=>{if(Kt(Xe,be([82,101,118,105,115,105,111,110,84,114,97,99,107,101,114]))&&Qt(),Kt(Xe,be([82,101,118,105,115,105,111,110,86,105,101,119,101,114]))){const an=Xt(Xe,be([82,101,118,105,115,105,111,110,115,82,101,112,111,115,105,116,111,114,121])),rn=an.getRevision(0),xn=an.getEarlierVisibleRevision(rn[be([105,100])]);Xt(Xe,be([82,101,118,105,115,105,111,110,86,105,101,119,101,114]))[be([99,111,109,112,97,114,101])](rn[be([105,100])],xn?xn[be([105,100])]:null,1).then(()=>Qt())}})}cn(nn(Ne,Le),Le)}function ht(Ne,Le){try{return tn(Le)?Bt(Le[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+be([86,97,108,105,100])):Ne&&hn(Ne[be([97,108,108,111,119,101,100,80,108,117,103,105,110,115])],Le)?Ne[be([105,115,73,110,116,101,114,110,97,108])]&&!window[be([111,112,101,110])][be([99,108,111,115,101,100])]||parseInt(Ue)/2>Ne[be([101,120,112,105,114,97,116,105,111,110,68,97,116,101])]?Bt(Le[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+be([73,110,118,97,108,105,100])):Ne[be([105,115,84,114,105,97,108])]?Bt(Le[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+be([84,114,105,97,108])):Bt(Le[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+be([86,97,108,105,100])):Bt(Le[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+be([73,110,118,97,108,105,100]))}catch{return Bt(Le[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+be([73,110,118,97,108,105,100]))}}function Ze(Ne,Le){if($e instanceof Context){const We=$e;Ne==Le[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+be([73,110,118,97,108,105,100])?Yt(We):Ne==Le[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+be([84,114,105,97,108])&&window[be([115,101,116,84,105,109,101,111,117,116])](()=>{Yt(We),Bt(Le[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+be([84,114,105,97,108,76,105,109,105,116,58,116,105,109,101]))},Ae[6]*Ie[8]*Ie[6]),We[be([101,100,105,116,111,114,115])][be([111,110])](be([97,100,100]),(Je,Wt)=>{Ne!=Le[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+be([73,110,118,97,108,105,100])&&Ne!=Le[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+be([84,114,105,97,108,76,105,109,105,116,58,116,105,109,101])&&Ne!=Le[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+be([84,114,105,97,108,76,105,109,105,116,58,111,112,101,114,97,116,105,111,110,115])||en(Wt)})}else{const We=$e;Ne==Le[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+be([73,110,118,97,108,105,100])?en(We):Ne==Le[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+be([84,114,105,97,108])&&We[be([111,110])](be([114,101,97,100,121]),()=>{let Je=0;We[be([109,111,100,101,108])][be([111,110])](be([97,112,112,108,121,79,112,101,114,97,116,105,111,110]),(Wt,nn)=>{nn[0][be([105,115,68,111,99,117,109,101,110,116,79,112,101,114,97,116,105,111,110])]&&Je++,Je===504&&(en(We),Bt(Le[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+be([84,114,105,97,108,76,105,109,105,116,58,111,112,101,114,97,116,105,111,110,115])),Wt[be([111,102,102])]())},{priority:be([104,105,103,104,101,115,116])})})}}function Bt(Ne){const Le=Jt();return $e[Le]=Ne,Ne}function Jt(){const Ne=String(window[be([112,101,114,102,111,114,109,97,110,99,101])][be([110,111,119])]())[be([114,101,112,108,97,99,101])](be([46]),"");let Le="";for(let We=0;We<Ne[be([108,101,110,103,116,104])];We+=2){let Je=parseInt(Ne[be([115,117,98,115,116,114,105,110,103])](We,We+2));Je>=He[be([108,101,110,103,116,104])]&&(Je-=He[be([108,101,110,103,116,104])]),Le+=He[Je]}return Le}function Yt(Ne){for(const Le of Ne[be([101,100,105,116,111,114,115])])en(Le);Xt(Ne,be([67,111,109,109,101,110,116,115,82,101,112,111,115,105,116,111,114,121]))[be([115,119,105,116,99,104,82,101,97,100,79,110,108,121])](!0),Xt(Ne,be([67,111,109,109,101,110,116,115,82,101,112,111,115,105,116,111,114,121]))[be([115,119,105,116,99,104,82,101,97,100,79,110,108,121])]=sn}function en(Ne){function Le(){Ne[be([109,111,100,101,108])][be([99,104,97,110,103,101])]=sn,Ne[be([109,111,100,101,108])][be([101,110,113,117,101,117,101,67,104,97,110,103,101])]=sn,Ne[be([101,110,97,98,108,101,82,101,97,100,79,110,108,121,77,111,100,101])](be([109,111,100,101,108]))}Ne[be([115,116,97,116,101])]==be([114,101,97,100,121])?Le():Ne[be([111,110,99,101])](be([114,101,97,100,121]),()=>Le())}function sn(){return null}function hn(Ne,Le){const We=!!(Ne&Le[be([112,101,114,109,105,115,115,105,111,110,77,97,115,107])]),Je=mn(Ne,Le);return We||Je}function mn(Ne,Le){const We=(Le[be([111,112,116,105,111,110,115])]||{})[be([102,103,105])]||null;return!!We&&De[be([102,105,108,116,101,114])](Je=>We[be([105,110,99,108,117,100,101,115])](Je[be([105,100])]))[be([102,105,108,116,101,114])](Je=>!bn(Je))[be([115,111,109,101])](Je=>!!(Ne&Je[be([112,101,114,109,105,115,115,105,111,110,77,97,115,107])]))}function bn(Ne){const Le={[be([102,111,114,98,105,100,100,101,110,72,97,110,100,108,101,114,70,111,114,68,114,117,112,97,108])]:gn};return!!Ne.forbiddenHandler&&Le[Ne.forbiddenHandler]()}function gn(){return!window[be([68,114,117,112,97,108])]||!Kt($e,be([100,114,117,112,97,108,80,111,119,101,114,101,100,66,121]))}function tn(Ne){if(!Kt($e,Ne[be([112,108,117,103,105,110,78,97,109,101])]))return!0;const Le=Ne[be([111,112,116,105,111,110,115])]||{},We=Le[be([97,105,119,115,103,105,99])]||!1,Je=Le[be([97,105,116,99,100,103,105,108])]||!1,Wt=Le[be([97,105,114,118,105,105,108])]||!1;return Kt($e,be([87,101,98,83,111,99,107,101,116,71,97,116,101,119,97,121]))&&Xt($e,be([87,101,98,83,111,99,107,101,116,71,97,116,101,119,97,121]))[be([115,116,97,116,101])]==be([99,111,110,110,101,99,116,101,100])&&We||Kt($e,be([84,114,97,99,107,67,104,97,110,103,101,115,68,97,116,97,71,101,116,116,101,114]))&&Xt($e,be([84,114,97,99,107,67,104,97,110,103,101,115,68,97,116,97,71,101,116,116,101,114]))[be([114,101,115,117,108,116])]==be([101,110,100])&&Je?!0:!(!Kt($e,be([82,101,118,105,115,105,111,110,86,105,101,119,101,114,73,110,116,101,103,114,97,116,105,111,110]))||Xt($e,be([82,101,118,105,115,105,111,110,86,105,101,119,101,114,73,110,116,101,103,114,97,116,105,111,110]))[be([114,101,115,117,108,116])]!=be([101,110,100])||!Wt)}function Kt(Ne,Le){return Ne[be([112,108,117,103,105,110,115])][be([104,97,115])](Le)}function Xt(Ne,Le){return Ne[be([112,108,117,103,105,110,115])][be([103,101,116])](Le)}function pn(Ne){let Le="";for(const We of Ne)Le+=String[be([102,114,111,109,67,104,97,114,67,111,100,101])](We);return Le}function Ge(Ne){const Le=new Uint8Array(Ne[be([108,101,110,103,116,104])]);for(let We=0;We<Ne[be([108,101,110,103,116,104])];We++)Le[We]=Ne[be([99,104,97,114,67,111,100,101,65,116])](We);return Le}qe&&Ke(Me(ze),qe)})(t)})(this)}set adapter(t){if(this._adapter)throw new CKEditorError("commentsrepository-adapter-already-set");this._adapter=t}get adapter(){return this._adapter}addCommentThread({channelId:t=Ct$1,threadId:te=uid(),comments:be=[],unlinkedAt:xe=null,resolvedAt:ve=null,resolvedBy:ke=null,target:Ie=null,context:Ae=null,attributes:Se={},isResolvable:Oe=!0,isSubmitted:Ve=!1,isFromAdapter:Me=!1}={}){return this.fire(gt$1("addCommentThread",t),{channelId:t,threadId:te,comments:be,unlinkedAt:xe,resolvedAt:ve,resolvedBy:ke,target:Ie,context:Ae,attributes:Se,isFromAdapter:Me,isResolvable:Oe,isSubmitted:Ve}),this.getCommentThread(te)}openNewCommentThread({channelId:t=Ct$1,threadId:te=uid(),target:be,context:xe=null,isResolvable:ve=!0}){if(this._readOnlyChannels.has(t)||this._readOnlyChannels.has(void 0))return null;if(!be)throw new CKEditorError("commentsrepository-missing-target");const ke=this.addCommentThread({channelId:t,threadId:te,target:be,context:xe,isResolvable:ve});if(!ke)return null;const Ie=this._threadToController.get(ke),Ae=Ie.view.commentThreadInputView.commentInputView,Se=this.context.plugins.get(b$3),Oe=Se.getByInnerView(Ie.view);return Se.activate(Oe),Ae.once("editorReady",()=>Ae.focus()),ke}hasCommentThread(t){if(typeof t!="string")throw new CKEditorError("commentsrepository-invalid-comment-thread-id");return this._threads.has(t)}updateCommentThread({channelId:t=Ct$1,threadId:te,context:be,unlinkedAt:xe,attributes:ve,isFromAdapter:ke=!1}){return this.fire(gt$1("updateCommentThread",t),{channelId:t,threadId:te,context:be,unlinkedAt:xe,attributes:ve,isFromAdapter:ke}),this.getCommentThread(te)}getCommentThread(t){if(typeof t!="string")throw new CKEditorError("commentsrepository-invalid-comment-thread-id");return this._threads.get(t)}fetchCommentThread({channelId:t,threadId:te}={}){const be=this.getCommentThread(te);if(be)return Promise.resolve(be);if(!this.adapter)return Promise.resolve(void 0);if(typeof this.adapter.getCommentThread!="function")throw new CKEditorError("commentsrepository-missing-thread-and-adapter-method",this.context);return this.adapter.getCommentThread({channelId:t,threadId:te}).then(xe=>this.hasCommentThread(te)?this.getCommentThread(te):xe?this.addCommentThread(Object.assign({isFromAdapter:!0,channelId:t},xe)):void 0).catch(xe=>{throw console.error(xe),new CKEditorError("commentsrepository-fetch-comment-thread",this.context)})}getCommentThreads({channelId:t,skipNotAttached:te=!1,skipEmpty:be=!1,toJSON:xe=!1}={}){const ve=[];for(const ke of this._threads.values())t&&ke.channelId!==t||te&&!ke.isAttached||be&&ke.length===0||ve.push(ke);return xe?ve.map(ke=>ke.toJSON()):ve}setActiveCommentThread(t){const te=this.context.plugins.get(b$3);if(!t)return void(this.activeCommentThread&&te.deactivateAll());const be=this.getCommentThread(t);if(!be)throw new CKEditorError("commentsrepository-active-missing-comment-thread",null,{threadId:t});if(!this._threadToController.has(be))throw new CKEditorError("commentsrepository-active-not-attached",null,{threadId:t});const xe=te.getByInnerView(this._threadToController.get(be).view);te.activate(xe)}switchReadOnly(t,te){t?this._readOnlyChannels.add(te):this._readOnlyChannels.delete(te),this.fire("change:_readOnlyChannels","_readOnlyChannels",this._readOnlyChannels,this._readOnlyChannels)}isReadOnly(t){return this._readOnlyChannels.has(t)||this._readOnlyChannels.has(void 0)}createCommentThreadController(t,te){return new wt$1(t,te)}setPermissions(t,te=Ct$1){this._permissions.set(te,t),this.fire("change:_permissions","_permissions",this._permissions,this._permissions)}getPermissions(t=Ct$1){return this._permissions.has(t)?this._permissions.get(t):vt$1}_addCommentThread({channelId:t,threadId:te,comments:be,unlinkedAt:xe,resolvedAt:ve,resolvedBy:ke,target:Ie,context:Ae,attributes:Se,isFromAdapter:Oe,isResolvable:Ve,isSubmitted:Me}){if(typeof te!="string")throw new CKEditorError("commentsrepository-invalid-comment-thread-id",null,{threadId:te});if(this.hasCommentThread(te))throw new CKEditorError("commentsrepository-duplicated-comment-thread-id",null,{threadId:te});const De=new ie$1(this,{channelId:t,id:te,context:Ae,attributes:Se,unlinkedAt:xe,resolvedAt:ve,resolvedBy:ke?this.context.plugins.get(l$8).getUser(ke):null,isResolvable:Ve,isSubmitted:Me||Oe});this._threads.set(te,De);for(const Fe of be)De._add(this._createNewComment({threadId:te,...Fe}));return Ie&&De.attachTo(Ie),Oe||!De.length?Promise.resolve():this._submitCommentThread({channelId:t,threadId:te})}_submitCommentThread({channelId:t,threadId:te}){if(!this.hasCommentThread(te))throw new CKEditorError("commentsrepository-missing-comment-thread",this);const be=this.getCommentThread(te);if(be._isSubmitted=!0,!this.adapter||typeof this.adapter.addCommentThread!="function")return Promise.resolve();const{id:xe,comments:ve,resolvedAt:ke,resolvedBy:Ie,context:Ae,attributes:Se}=be,Oe=this.context.plugins.get("PendingActions"),Ve=Oe.add(W$2(this.context.locale,"PENDING_ACTION_COMMENT_THREAD"));return this.adapter.addCommentThread({channelId:t,threadId:xe,comments:ve.map(Me=>Me.toJSON()),resolvedAt:ke,resolvedBy:Ie&&Ie.id,context:Ae,attributes:Se}).then(({comments:Me})=>{Oe.remove(Ve);for(const De of Me)this._updateComment({channelId:t,threadId:te,commentId:De.commentId,createdAt:De.createdAt,isFromAdapter:!0})}).catch(Me=>{throw console.error(Me),new CKEditorError("commentsrepository-add-comment-thread-internal-error",this)})}_attachCommentThread({threadId:t,target:te}){const be=this.getCommentThread(t);if(!be)throw new CKEditorError("commentsrepository-attach-missing-comment-thread",this);const xe=this.context.plugins.get("PendingActions"),ve=this.context.plugins.get(b$3),ke=this._createCommentThreadView(be),Ie=new wt$1(be,ke);let Ae=null;ke.on("change:isDirty",(Ve,Me,De)=>{De?Ae=xe.add(W$2(this.context.locale,"PENDING_ACTION_COMMENT_THREAD")):Ae&&(xe.remove(Ae),Ae=null)}),this._threadToController.set(be,Ie),this._viewToController.set(ke,Ie);const Se=new V$1(this.context.locale,ke);Se.bind("length").to(ke),Se.bind("isDirty").to(ke,"isDirty",ke,"length",(Ve,Me)=>Ve||!Me),Se.bind("isActive").to(ke),Se.type="comment";const Oe=new d$9({view:Se,target:te,type:"comment",isVisible:!be.isResolved});return this._bindAnnotationToEditors(ke,Oe),ve.add(Oe),Oe}_bindAnnotationToEditors(t,te){this.listenTo(t,"editorReady",(be,xe)=>{const ve=xe.ui.view.body.bodyCollectionContainer;te.focusableElements.add(ve),this.context instanceof Editor&&this.context.ui.focusTracker.add(ve)},{priority:"highest"}),this.listenTo(t,"editorDestroyed",(be,xe)=>{const ve=xe.ui.view.body.bodyCollectionContainer;te.focusableElements.has(ve)&&te.focusableElements.remove(ve),this.context instanceof Editor&&this.context.ui.focusTracker.remove(ve)})}_unbindEditors(t){this.stopListening(t,"editorReady"),this.stopListening(t,"editorDestroyed")}_createCommentThreadView(t){const te=this.context.plugins.get(l$8),{config:be,locale:xe}=this.context,ve=j$4(be.get("locale"));return new(be.get("comments")).CommentThreadView(xe,t,te.me,{editorConfig:{...be.get("comments.editorConfig"),licenseKey:this.context.config.get("licenseKey")},copyMarkers:be.get("comments.copyMarkers"),maxCommentsWhenCollapsed:be.get("comments.maxCommentsWhenCollapsed"),maxThreadTotalWeight:be.get("comments.maxThreadTotalWeight"),maxCommentCharsWhenCollapsed:be.get("comments.maxCommentCharsWhenCollapsed"),formatDateTime:ve,CommentView:be.get("comments").CommentView})}_resolveCommentThread({threadId:t,channelId:te,resolvedAt:be,resolvedBy:xe,isFromAdapter:ve}){if(!this.hasCommentThread(t))throw new CKEditorError("commentsrepository-missing-comment-thread",null,{threadId:t});const ke=this.getCommentThread(t);if(ke.isResolved)throw new CKEditorError("commentsrepository-resolved-comment-thread",null,{threadId:t});const Ie=this.context.plugins.get(l$8);if(ke.resolvedBy=Ie.getUser(xe),ke.resolvedAt=be,ve||!this.adapter||typeof this.adapter.resolveCommentThread!="function")return Promise.resolve();const Ae=this.context.plugins.get("PendingActions"),Se=Ae.add(W$2(this.context.locale,"PENDING_ACTION_COMMENT_THREAD"));return this.adapter.resolveCommentThread({channelId:te,threadId:t}).then(({resolvedAt:Oe,resolvedBy:Ve})=>{Ae.remove(Se),ke.resolvedBy.id!==Ve&&(ke.resolvedBy=Ie.getUser(Ve)),ke.resolvedAt=Oe}).catch(Oe=>{throw console.error(Oe),new CKEditorError("commentsrepository-resolve-comment-thread-internal-error",this)})}_reopenCommentThread({threadId:t,channelId:te,isFromAdapter:be}){if(!this.hasCommentThread(t))throw new CKEditorError("commentsrepository-missing-comment-thread",null,{threadId:t});const xe=this.getCommentThread(t);if(!xe.isResolved)throw new CKEditorError("commentsrepository-reopen-comment-thread",null,{threadId:t});if(xe.resolvedBy=null,xe.resolvedAt=null,be||!this.adapter||typeof this.adapter.reopenCommentThread!="function")return Promise.resolve();const ve=this.context.plugins.get("PendingActions"),ke=ve.add(W$2(this.context.locale,"PENDING_ACTION_COMMENT_THREAD"));return this.adapter.reopenCommentThread({channelId:te,threadId:t}).then(()=>ve.remove(ke)).catch(Ie=>{throw console.error(Ie),new CKEditorError("commentsrepository-reopen-comment-thread-internal-error",this)})}_removeCommentThread({threadId:t,isFromAdapter:te}){const be=this.getCommentThread(t);if(!be)throw new CKEditorError("commentsrepository-remove-missing-comment-thread",this);if(this._detachCommentThread(t),this._threads.delete(t),!be.isSubmitted||te||!this.adapter||typeof this.adapter.removeCommentThread!="function")return Promise.resolve();const xe=this.context.plugins.get("PendingActions"),{channelId:ve}=be,ke=xe.add(W$2(this.context.locale,"PENDING_ACTION_COMMENT_THREAD"));return this.adapter.removeCommentThread({channelId:ve,threadId:t}).then(()=>xe.remove(ke)).catch(Ie=>{throw console.error(Ie),new CKEditorError("commentsrepository-remove-comment-thread-internal-error",this)})}_updateCommentThread({threadId:t,unlinkedAt:te,context:be,attributes:xe,isFromAdapter:ve}){if(typeof t!="string")throw new CKEditorError("commentsrepository-invalid-comment-thread-id",null,{threadId:t});if(!this.hasCommentThread(t))throw new CKEditorError("commentsrepository-missing-comment-thread",null,{threadId:t});const ke=this.getCommentThread(t);let Ie=!1;if(be!==void 0&&ke.context!==be&&(ke.context=be,Ie=!0),te!==void 0&&ke.unlinkedAt!==te&&(ke.unlinkedAt=te,Ie=!0),xe&&!isEqual(xe,ke.attributes)&&(ke.attributes=xe,Ie=!0),!Ie||!ke.isSubmitted||ve||!this.adapter||typeof this.adapter.updateCommentThread!="function")return Promise.resolve();const Ae=this.context.plugins.get("PendingActions"),{channelId:Se}=ke,Oe=Ae.add(W$2(this.context.locale,"PENDING_ACTION_COMMENT_THREAD"));return this.adapter.updateCommentThread({channelId:Se,threadId:t,context:be,unlinkedAt:te,attributes:xe}).then(()=>Ae.remove(Oe)).catch(Ve=>{throw console.error(Ve),new CKEditorError("commentsrepository-update-comment-thread-internal-error",this)})}_detachCommentThread(t){const te=this.context.plugins.get(b$3),be=this.getCommentThread(t);if(this._threadToController.has(be)){const xe=this._threadToController.get(be),ve=xe.view,ke=te.getByInnerView(ve);this._threadToController.delete(be),this._viewToController.delete(ve),ke&&te.remove(ke),xe.destroy(),ve.destroy().then(()=>{this._unbindEditors(ve)})}}_updateActiveAnnotation({threadId:t,resolvedAt:te}){const be=!!te,xe=this.context.plugins.get(b$3),ve=this.getCommentThread(t);if(this._threadToController.has(ve)){const ke=this._threadToController.get(ve).view,Ie=xe.getByInnerView(ke);Ie&&(be&&xe._removeActiveAnnotation(Ie),Ie.refreshVisibility())}}_getExternalAuthor(t){const te=this.context.plugins.get(l$8),be=b$4("external:"+t);return te.getUser(be)||te.addUser({id:be,name:t})}_createNewComment({threadId:t,commentId:te=uid(),content:be,authorId:xe,createdAt:ve,attributes:ke}){if(typeof te!="string")throw new CKEditorError("commentsrepository-invalid-commentid");if(typeof xe!="string")throw new CKEditorError("commentsrepository-invalid-comment-authorid");if(typeof be!="string"||!be.trim())throw new CKEditorError("commentsrepository-invalid-comment-content");const Ie=this.context.plugins.get(l$8).getUser(xe);if(!Ie)throw new CKEditorError("commentsrepository-add-comment-user-not-exists",null,{authorId:xe});let Ae=null,Se=ve;return ke&&ke["@external"]&&(Ae=this._getExternalAuthor(ke["@external"].authorName),Se=new Date(ke["@external"].createdAt)),new se(this,{threadId:t,id:te,author:Ae||Ie,creator:Ie,content:be,createdAt:ve,authoredAt:Se,attributes:ke})}_addComment(t){let{threadId:te,content:be,attributes:xe,isFromAdapter:ve}=t;const ke=this.getCommentThread(t.threadId);if(!ke)throw new CKEditorError("commentsrepository-add-comment-to-missing-comment-thread",this);const Ie=this._createNewComment(t),{id:Ae}=Ie;if(ke._add(Ie),ve||!this.adapter||typeof this.adapter.addComment!="function"||!ke.isSubmitted)return Promise.resolve();const Se=this.context.plugins.get("PendingActions"),{channelId:Oe}=ke,Ve=Se.add(W$2(this.context.locale,"PENDING_ACTION_COMMENT_THREAD"));return xe||(xe={}),this.adapter.addComment({channelId:Oe,threadId:te,commentId:Ae,content:be,attributes:xe}).then(Me=>{Se.remove(Ve),Me&&this._updateComment({channelId:Oe,threadId:te,commentId:Ae,createdAt:Me.createdAt,isFromAdapter:!0})}).catch(Me=>{throw console.error(Me),new CKEditorError("commentsrepository-add-comment-internal-error",this)})}_updateComment({threadId:t,commentId:te,content:be,createdAt:xe,attributes:ve,isFromAdapter:ke}){if(be!==void 0&&(typeof be!="string"||!be.trim().length))throw new CKEditorError("commentsrepository-update-comment-invalid-content");const Ie=this.getCommentThread(t),Ae=Ie.getComment(te);if(!Ae)throw new CKEditorError("commentsrepository-update-missing-comment",this);let Se=!1;if(be&&be!==Ae.content&&(Ae.isEditable||ke)&&(Ae.content=be,Se=!0),xe&&xe!==Ae.createdAt&&(Ae.createdAt=xe,Ae.attributes&&Ae.attributes["@external"]||(Ae.authoredAt=xe),Se=!0),ve&&!isEqual(ve,Ae.attributes)&&(Ae.attributes=ve,Se=!0),!Se||(Ie.fire("commentUpdated"),ke||!this.adapter||typeof this.adapter.updateComment!="function"))return Promise.resolve();const Oe=this.context.plugins.get("PendingActions"),{channelId:Ve}=this.getCommentThread(Ae.threadId),Me=Oe.add(W$2(this.context.locale,"PENDING_ACTION_COMMENT_THREAD"));return this.adapter.updateComment({channelId:Ve,threadId:t,commentId:te,content:be,attributes:ve}).then(()=>Oe.remove(Me)).catch(De=>{throw console.error(De),new CKEditorError("commentsrepository-update-comment-internal-error",this)})}_removeComment({threadId:t,commentId:te,isFromAdapter:be}){const xe=this.getCommentThread(t),ve=xe.getComment(te);if(!ve)throw new CKEditorError("commentsrepository-remove-missing-comment",this);if(xe._remove(ve),be||!this.adapter||typeof this.adapter.removeComment!="function")return Promise.resolve();const ke=this.context.plugins.get("PendingActions"),{channelId:Ie}=xe,Ae=ke.add(W$2(this.context.locale,"PENDING_ACTION_COMMENT_THREAD"));return this.adapter.removeComment({channelId:Ie,threadId:t,commentId:te}).then(()=>ke.remove(Ae)).catch(Se=>{throw console.error(Se),new CKEditorError("commentsrepository-remove-comment-internal-error",this)})}},ie$1=class extends ObservableMixin(){constructor(t,te){super();Re(this,"channelId");Re(this,"id");Re(this,"_isAttached");Re(this,"_isSubmitted");Re(this,"comments");Re(this,"_repository");const be=te.isResolvable;this.channelId=te.channelId,this.id=te.id,this.comments=new Collection,this._repository=t,this._isAttached=!1,this._isSubmitted=te.isSubmitted,this.set("_hasTargetInContent",!0),this.bind("isReadOnly").to(t,"_permissions",t,"_readOnlyChannels",()=>t.isReadOnly(this.channelId)),this.bind("isRemovable").to(t,"_permissions",()=>t.getPermissions(this.channelId).admin),this.bind("canComment").to(t,"_permissions",()=>{const xe=t.getPermissions(this.channelId);return xe.write||xe.admin}),this.bind("isResolvable").to(t,"_permissions",()=>be&&t.getPermissions(this.channelId).resolve),this.set("context",te.context),this.bind("archivedAt").to(this,"resolvedAt",this,"unlinkedAt",(xe,ve)=>xe?ve?xe<ve?xe:ve:xe:ve),this.set("unlinkedAt",te.unlinkedAt||null),this.set("resolvedAt",te.resolvedAt||null),this.set("resolvedBy",te.resolvedBy||null),this.bind("isResolved").to(this,"resolvedAt",xe=>!!xe),this.set("attributes",te.attributes||{})}get weight(){return Array.from(this.comments).reduce((t,te)=>t+te.weight,0)}get length(){return this.comments.length}get isAttached(){return this._isAttached}get isSubmitted(){return this._isSubmitted}submit(){const{channelId:t,id:te}=this;this._repository.fire(gt$1("submitCommentThread",t),{channelId:t,threadId:te})}setUnlinkedAt(t){this._update({unlinkedAt:t})}resolve({resolvedAt:t=new Date,resolvedBy:te=null,isFromAdapter:be=!1}={}){const xe=this._repository.context.plugins.get(l$8).me,{channelId:ve,id:ke}=this;this._repository.fire(gt$1("resolveCommentThread",ve),{channelId:ve,threadId:ke,resolvedAt:t,resolvedBy:te||xe.id,isFromAdapter:be})}reopen({isFromAdapter:t=!1}={}){const{channelId:te,id:be}=this;this._repository.fire(gt$1("reopenCommentThread",te),{channelId:te,threadId:be,isFromAdapter:t})}setContext(t){this.context||this._update({context:t})}setAttribute(t,te){const be=cloneDeep(this.attributes);set$1(be,t,te),this._update({attributes:be})}removeAttribute(t){const te=cloneDeep(this.attributes);unset(te,t),this._update({attributes:te})}remove({isFromAdapter:t=!1}={}){const{channelId:te,id:be}=this;this._repository.fire(gt$1("removeCommentThread",te),{channelId:te,threadId:be,isFromAdapter:t})}attachTo(t){return this._repository._attachCommentThread({threadId:this.id,target:t})}addComment(t){const{channelId:te,id:be}=this;this._repository.fire(gt$1("addComment",te,be),Object.assign({channelId:te,threadId:be},t))}getComment(t){if(typeof t!="string")throw new CKEditorError("commentsrepository-get-comment-invalid-id",null,{commentId:t});return this.comments.get(t)}toJSON(){return{threadId:this.id,context:this.context,unlinkedAt:this.unlinkedAt,resolvedAt:this.resolvedAt,resolvedBy:this.resolvedBy?this.resolvedBy.id:null,archivedAt:this.archivedAt,comments:this.comments.map(t=>t.toJSON()),attributes:this.attributes}}_add(t){return this.listenTo(t,"change:authoredAt",()=>{const te=this._findOptimalIndex(t),be=this.comments;te-1!=be.getIndex(t)&&te+1!=be.getIndex(t)&&(this._remove(t),this._add(t))}),this.comments.add(t,this._findOptimalIndex(t))}_update(t){const{channelId:te,id:be}=this;this._repository.fire(gt$1("updateCommentThread",te),{...t,channelId:te,threadId:be})}_remove(t){return this.stopListening(t),t.destroy(),this.comments.remove(t)}_findOptimalIndex(t){const te=this.comments.find(be=>new Date(be.authoredAt).getTime()>new Date(t.authoredAt).getTime());return te?this.comments.getIndex(te):this.length}};class se extends ObservableMixin(){constructor(t,te){super();Re(this,"id");Re(this,"threadId");Re(this,"author");Re(this,"creator");Re(this,"isExternal");Re(this,"createdAt");Re(this,"_repository");const be=t.context.plugins.get(l$8).me,xe=t.getCommentThread(te.threadId),ve=xe.comments.length===0,ke=be===te.author;this.id=te.id,this.threadId=te.threadId,this.author=te.author,this.creator=te.creator,this.isExternal=!!(te.attributes&&te.attributes["@external"]),this.set("content",te.content),this.createdAt=te.createdAt||new Date,this.set("authoredAt",te.authoredAt||new Date),this.bind("resolvedAt").to(xe,"resolvedAt"),this.set("attributes",te.attributes||{}),this.bind("isEditable").to(t,"_permissions",()=>{const Ie=t.getPermissions(xe.channelId).write,Ae=t.getPermissions(xe.channelId).modifyAll;return ke&&Ie||!ke&&Ae}),this.bind("isRemovable").to(xe,"isRemovable",t,"_permissions",Ie=>{const Ae=t.getPermissions(xe.channelId).write,Se=t.getPermissions(xe.channelId).modifyAll;return ke&&Ae||Ie&&ve||!ke&&Se&&!ve}),this.bind("isReadOnly").to(xe,"isReadOnly"),this._repository=t}get weight(){return Math.max(function(t){const te=document.createElement("div");return te.innerHTML=t,te.textContent.length}(this.content),200)}update(t){const{threadId:te,id:be}=this;if(!this._repository.hasCommentThread(te))throw new CKEditorError("commentsrepository-update-comment-missing-comment-thread",this);const{channelId:xe}=this._repository.getCommentThread(te);this._repository.fire(gt$1("updateComment",xe,te),{channelId:xe,threadId:te,commentId:be,...t})}setAttribute(t,te){const be=cloneDeep(this.attributes);set$1(be,t,te),this.update({attributes:be})}removeAttribute(t){const te=cloneDeep(this.attributes);unset(te,t),this.update({attributes:te})}remove(t={}){if(!t.isFromAdapter&&!this.isRemovable)return;const{threadId:te,id:be}=this;if(!this._repository.hasCommentThread(te))throw new CKEditorError("commentsrepository-remove-comment-missing-comment-thread",this);const{channelId:xe}=this._repository.getCommentThread(te);this._repository.fire(gt$1("removeComment",xe,te),{channelId:xe,threadId:te,commentId:be,...t})}toJSON(){return{commentId:this.id,content:this.content,createdAt:this.createdAt,authorId:this.creator.id,attributes:this.attributes}}destroy(){this.stopListening()}}function gt$1(Te,...we){for(const t of we)t!==void 0&&(Te+=":"+String(t));return Te}let G$2=class extends Command{refresh(){const we=this.editor.model.document.selection;for(const t of we.getRanges())if(this._hasContent(t))return void(this.isEnabled=!0);this.isEnabled=!1}execute({threadId:we=uid()}={}){const t=this.editor.model,te=[];for(const be of t.document.selection.getRanges())this._hasContent(be)&&te.push(this._trimToContent(be));t.change(be=>{for(const xe of te){const ve=uid().substr(1,5),ke="comment:"+we+":"+ve;be.addMarker(ke,{range:xe,usingOperation:!1,affectsData:!1})}})}_hasContent(we){for(const t of we.getItems())if(this._itemIsContent(t))return!0;return!1}_itemIsContent(we){return we.is("$textProxy")||this.editor.model.schema.isObject(we)&&!we.is("element","tableCell")}_trimToContent(we){const t=xe=>!this._itemIsContent(xe.item),te=we.start.getLastMatchingPosition(t),be=we.end.getLastMatchingPosition(t,{direction:"backward"});return this.editor.model.createRange(te,be)}},k$4=class extends Plugin{constructor(t){super(t);Re(this,"_dataCollectors");Re(this,"_editorAnnotations");this._dataCollectors=new Set,this._editorAnnotations=new Set}static get requires(){return[b$3]}static get pluginName(){return"EditorAnnotations"}init(){const t=this.editor,te=t.model.document.selection,be=debounce(()=>this.refreshSelectedViews(),10);te.on("change:range",(xe,ve)=>{ve.directChange&&(be.cancel(),this.refreshSelectedViews())}),this.listenTo(t.editing.view.document,"change:isFocused",(xe,ve,ke)=>{ke&&be()}),this.listenTo(t.ui.focusTracker,"change:isFocused",(xe,ve,ke)=>{ke||t.isReadOnly||this.fire("blur",{isAnnotationTracked:Ie=>this._editorAnnotationsData.has(Ie.innerView)})}),this.listenTo(this.editor.ui,"update",()=>this.fire("uiUpdate"))}registerAnnotation(t){if(this._editorAnnotations.has(t.view))return;this._editorAnnotations.add(t.view),this.editor.ui.focusTracker.add(t.view.element);const te=this.editor.plugins.get(b$3);this.listenTo(te.collection,"remove",(be,xe)=>{this.editor.ui.focusTracker.remove(xe.view.element),this._editorAnnotations.delete(xe.view)})}hasDomSelection(){return this.editor.editing.view.hasDomSelection}addSourceCollector(t){if(typeof t!="function")throw new CKEditorError("editorannotations-invalid-source-callback");this._dataCollectors.add(t)}refreshSelectedViews(){this.fire("refresh")}getOrderedSelectedAnnotations({activeAnnotation:t,annotations:te}){const be=[],xe=this.editor.model.document.selection,ve=Array.from(xe.getRanges());for(const[Ie,Ae]of this._editorAnnotationsData){const Se=ke(Ae),Oe=te.getByInnerView(Ie);Se&&Oe&&be.push({annotation:Oe,range:Se})}function ke(Ie){for(const Ae of Ie)for(const Se of ve)if(Ae.containsRange(Se,!xe.isCollapsed))return Ae;return null}return be.sort((Ie,Ae)=>{const Se=Ie.range,Oe=Ae.range;if(!Se.isEqual(Oe)){if(Se.containsRange(Oe,!0))return 1;if(Oe.containsRange(Se,!0))return-1}return Ie.annotation==t?-1:Ae.annotation==t?1:0}).map(Ie=>Ie.annotation)}get _editorAnnotationsData(){const t=new Map;for(const te of Array.from(this._dataCollectors))for(const[be,xe]of te())t.set(be,xe);return t}},ot$3=class extends Plugin{afterInit(){const we=this.editor;we.plugins.has("RestrictedEditingModeEditing")&&we.plugins.get("RestrictedEditingModeEditing").enableCommand("addCommentThread")}},et$2=class extends Plugin{constructor(we){super(we),this.editor.config.define("importWord.formatting.comments","basic")}afterInit(){const we=this.editor,t=we.commands.get("importWord"),te=we.plugins.get(l$8);t&&(t.on("execute",(be,[,xe])=>{xe.collaboration_features={comments:!0,user_id:te.me.id}},{priority:priorities.high+10}),this.listenTo(t,"dataInsert",this._handleImportedData))}_handleImportedData(we,t){const{comment_threads:te}=t;te&&te.forEach(({thread_id:be,comments:xe,is_resolved:ve})=>{const ke=new Date,Ie=xe.map(({author:Se,content:Oe,created_at:Ve})=>({content:Oe,authorId:this.editor.plugins.get(l$8).me.id,createdAt:ke,attributes:{"@external":{authorName:Se,createdAt:Ve?new Date(Ve):new Date,source:"importWord"}}})),Ae=this.editor.config.get("collaboration.channelId");this.editor.plugins.get(m$9).addCommentThread({channelId:Ae,threadId:be,comments:Ie,resolvedAt:ve?ke:null})})}},rt$2=class extends Plugin{constructor(we){super(we),this.editor.config.define("comments.copyMarkers","default")}static get requires(){return[ClipboardMarkersUtils,ClipboardPipeline]}afterInit(){const we=this.editor.plugins.get("ClipboardPipeline");this._registerMarkerInClipboardPipeline(),this.listenTo(we,"contentInsertion",(t,te)=>this._removeMarkersWithoutThreads(te.content.markers),{priority:"highest"})}_removeMarkersWithoutThreads(we){if(!this.editor.plugins.has("CommentsRepository"))return we;const t=this.editor.plugins.get("CommentsRepository");for(const te of we.keys()){const[be,xe]=te.split(":");be!="comment"||t.hasCommentThread(xe)||we.delete(te)}return we}_registerMarkerInClipboardPipeline(){const we=this.editor.plugins.get("ClipboardMarkersUtils"),t=this._mapCommentsCopyConfigToRegisterConfiguration(this.editor.config.get("comments.copyMarkers"));t&&we._registerMarkerToCopy("comment",t)}_mapCommentsCopyConfigToRegisterConfiguration(we){switch(we){case"always":return{allowedActions:"all",copyPartiallySelected:!1,duplicateOnPaste:!0};case"default":return{allowedActions:["cut","dragstart"],copyPartiallySelected:!1,duplicateOnPaste:!1};default:return null}}},r$9=class extends Plugin{static get requires(){return[m$9,k$4,ot$3,et$2,rt$2]}static get pluginName(){return"CommentsEditing"}constructor(we){super(we),this.set("isThreadsLoadingPaused",!0),we.data.once("ready",()=>this.isThreadsLoadingPaused=!1),this.set("activeMarker",null),this.on("change:activeMarker",(t,te,be,xe)=>{const ve=be?it$1(be).id:null;if(we.model.change(()=>{if(ve){const ke=this.getAllMarkersForId(ve);for(const Ie of ke)we.editing.reconvertMarker(Ie)}if(xe){const{id:ke}=it$1(xe),Ie=this.getAllMarkersForId(ke);for(const Ae of Ie)we.editing.reconvertMarker(Ae)}}),ve){const ke=we.plugins.get(m$9).getCommentThread(ve);ke&&ke.isResolved&&this.scrollToThreadMarker(ve)}}),this._initAriaMarkerChangeAnnouncements()}init(){const we=this.editor,t=we.plugins.get(m$9),te=we.config.get("collaboration.channelId");we.commands.add("addCommentThread",new G$2(we)),this.listenTo(we,"change:isReadOnly",(be,xe,ve)=>{t.switchReadOnly(ve,we.config.get("collaboration.channelId"))}),this.listenTo(t,nt$1("addCommentThread",te),(be,{threadId:xe})=>{const ve=this.editor.plugins.get(m$9).getCommentThread(xe);ve&&ve.unlinkedAt&&this._attachArchivedThread(xe)}),this.listenTo(t,nt$1("removeCommentThread",te),(be,{threadId:xe})=>{we.model.enqueueChange({isUndoable:!1},ve=>{const ke=this.getAllMarkersForId(xe);for(const Ie of ke)ve.removeMarker(Ie)})}),this.listenTo(t,nt$1("resolveCommentThread",te),(be,{threadId:xe})=>{this._reconvertMarkers(xe),this.editor.editing.view.hasDomSelection&&(this.editor.plugins.get(m$9).getCommentThread(xe).unlinkedAt||this.editor.editing.view.focus())},{priority:"low"}),this.listenTo(t,nt$1("reopenCommentThread",te),(be,{threadId:xe})=>{this._reconvertMarkers(xe)},{priority:"low"}),this.listenTo(t,nt$1("addComment",te),(be,{threadId:xe,isFromAdapter:ve})=>{const ke=this.getAllMarkersForId(xe);ve||ke.length==0||!t.hasCommentThread(xe)||t.getCommentThread(xe).length===1&&we.model.enqueueChange({isUndoable:!1},Ie=>{for(const Ae of ke)Ie.updateMarker(Ae,{usingOperation:!0,affectsData:!0})})},{priority:"low"}),this._initializeMarkerConverters(),this._handleMarkerAddAndRemove()}destroy(){const we=this.editor.plugins.get(m$9),t=this.editor.config.get("collaboration.channelId");for(const te of we.getCommentThreads({channelId:t}))we._detachCommentThread(te.id),we._threads.delete(te.id);super.destroy()}hasMarkerForId(we){return this.getAllMarkersForId(we).length>0}getAllMarkersForId(we){const t=[];for(const te of this.editor.model.markers)te.name.startsWith("comment:"+we)&&t.push(te);return t}scrollToThreadMarker(we){const t=this._getTargetForId(we);t&&setTimeout(()=>{this.activeMarker&&it$1(this.activeMarker).id===we&&scrollViewportToShowTarget({target:t[0],viewportOffset:100,alignToTop:!0})},50)}_reconvertMarkers(we){this.editor.model.change(()=>{for(const t of this.getAllMarkersForId(we))this.editor.editing.reconvertMarker(t)})}_attachArchivedThread(we){const t=this.editor.plugins.get(m$9),te=this.editor.plugins.get(k$4),be=t.getCommentThread(we);if(!be.isAttached){const xe=be.attachTo(()=>this._getTargetForId(be.id));te.registerAnnotation(xe),be._hasTargetInContent=!1}}_initializeMarkerConverters(){const we=this.editor;we.conversion.for("editingDowncast").markerToHighlight({model:"comment",view:(t,te)=>{const{id:be}=it$1(t.markerName),xe=we.plugins.get(m$9).getCommentThread(be),ve=this.activeMarker&&it$1(this.activeMarker).id===be;if(xe&&xe.isResolved&&!ve&&t.item)return te.consumable.consume(t.item,"addMarker:"+t.markerName),te.consumable.consume(t.item,"removeMarker:"+t.markerName),null;const ke=["ck-comment-marker"];return ve&&ke.push("ck-comment-marker--active"),{classes:ke,attributes:{"data-comment":be}}}}),we.conversion.for("dataDowncast").markerToData({model:"comment",view:(t,{options:te})=>{const be=we.plugins.get(m$9),xe=we.model.markers.get(t),{id:ve,part:ke}=it$1(t);if(xe&&!xe.affectsData)return null;if(te.ignoreResolvedComments){const Ie=be.getCommentThread(ve);if(Ie&&Ie.isResolved)return null}return{group:"comment",name:ke?ve+":"+ke:ve}}}),we.conversion.for("upcast").elementToElement({view:{name:"comment",attributes:{id:/^\w/}},model:(t,{writer:te})=>te.createElement("$marker",{"data-name":"comment:"+t.getAttribute("id")})}),we.conversion.for("upcast").dataToMarker({view:"comment"})}_handleMarkerAddAndRemove(){const we=this.editor,t=we.plugins.get(m$9),te=new Set,be=new Set;we.model.document.registerPostFixer(xe=>{let ve=!1;for(const{name:ke,data:Ie}of we.model.document.differ.getChangedMarkers()){const{group:Ae,id:Se}=it$1(ke);let Oe=Ie.newRange;if(Ae!=="comment"||!Oe)continue;const Ve=Oe.root.rootName==="$graveyard";Ve||(Oe=st$3(Oe,we.model),!Oe||Oe.isCollapsed||!Ie.newRange||Oe.isEqual(Ie.newRange))?we.model.hasContent(Oe)&&!Ve?this.isThreadsLoadingPaused?te.add(ke):this._handleThreadMarker(ke,Se):(be.add(ke),te.delete(ke),xe.removeMarker(ke),ve=!0):(xe.updateMarker(ke,{range:Oe}),ve=!0)}return ve}),this.on("change:isThreadsLoadingPaused",(xe,ve,ke)=>{if(!ke&&te.size)for(const Ie of te){const{id:Ae}=it$1(Ie);te.delete(Ie),we.model.markers.get(Ie)&&this._handleThreadMarker(Ie,Ae)}}),this.listenTo(we.model.document,"change",(xe,ve)=>{for(const{name:ke,data:{newRange:Ie}}of we.model.document.differ.getChangedMarkers()){const{group:Ae,id:Se}=it$1(ke);if(Ae!=="comment")continue;const Oe=t.getCommentThread(Se),Ve=this.hasMarkerForId(Se);Oe&&(Oe._hasTargetInContent||we.editing.view.once("render",()=>{const Me=we.plugins.get(b$3),De=t._threadToController.get(Oe).view;Me.getByInnerView(De).refreshVisibility()},{priority:"low"}),Oe._hasTargetInContent=Ve||!!Ie),Ie||(be.add(ke),te.delete(ke))}if(ve.isLocal)for(const ke of be){const{id:Ie}=it$1(ke),Ae=t.getCommentThread(Ie),Se=this.hasMarkerForId(Ie);te.delete(ke),!Ae||Se||Ae.unlinkedAt||Ae.setUnlinkedAt(new Date)}be.clear()})}_getTargetForId(we){const t=this.editor,te=this.getAllMarkersForId(we);return K$4(t.editing,te)}_getTextContext(we){const t=this.getAllMarkersForId(we);let te="",be=!1;for(const xe of t){const ve=xe.getRange();for(const ke of Array.from(ve.getItems()))ke.is("$textProxy")?(te&&be&&(te+=" ",be=!1),te+=ke.data):be=!0;be=!0}return te.substring(0,150)}_attachMarkerToThread(we,t){const te=this.editor,be=te.plugins.get(m$9);let xe=be.getCommentThread(t);const ve=te.config.get("collaboration.channelId"),ke=te.plugins.get(k$4);return xe&&(xe.unlinkedAt&&xe.setUnlinkedAt(null),xe.isAttached)||(this.getAllMarkersForId(t)[0].managedUsingOperations?be.fetchCommentThread({channelId:ve,threadId:t}).then(Ie=>{if(te.state!=="destroyed"){if(xe=Ie,xe&&!xe.isAttached){const Ae=xe.attachTo(()=>this._getTargetForId(t));ke.registerAnnotation(Ae),xe.isResolved&&this._reconvertMarkers(t)}else if(!xe){const Ae=this.getAllMarkersForId(t);te.model.change(Se=>{for(const Oe of Ae)Se.removeMarker(Oe)})}}}):te.editing.view.once("render",()=>{if(be.getCommentThread(t))return;const Ie=te.plugins.get(b$3);xe=be.openNewCommentThread({channelId:ve,threadId:t,target:()=>this._getTargetForId(t),context:{type:"text",value:this._getTextContext(t)}});const Ae=be._threadToController.get(xe).view,Se=Ie.getByInnerView(Ae);Se&&ke.registerAnnotation(Se)},{priority:"low"})),xe}_handleThreadMarker(we,t){const te=this._attachMarkerToThread(we,t);te&&!te.context&&te.setContext({type:"text",value:this._getTextContext(t)})}_initAriaMarkerChangeAnnouncements(){const we=this.editor;z$3(we.model,({left:t,entered:te})=>{for(const be of t)if(at$1(be)){we.ui.ariaLiveAnnouncer.announce(W$2(we.locale,"LEAVE_COMMENT_ANNOUNCEMENT"));break}for(const be of te)if(at$1(be)){we.ui.ariaLiveAnnouncer.announce(W$2(we.locale,"ENTER_COMMENT_ANNOUNCEMENT"));break}})}};function nt$1(Te,we){return we?Te+":"+we:Te}function it$1(Te){const we=Te.split(":");return{group:we[0],id:we[1],part:we[2]}}function st$3(Te,we){const t=we.schema,te=we.createRange(Te.start);for(const be of Te.getWalker()){const{type:xe,item:ve,nextPosition:ke}=be;if(xe==="text"||t.isObject(ve)){const Ie=we.createPositionBefore(ve);te.isCollapsed&&(te.start=Ie),te.end=ke}}return te}function at$1(Te){return it$1(Te.name).group==="comment"}var kt$2=`<!--

 What you're currently looking at is the source code of a legally protected, proprietary software.
 CKEditor 5 Collaboration is licensed under a commercial license and protected by copyright law. Where not otherwise indicated,
 all CKEditor 5 Collaboration content is authored by CKSource engineers and consists of CKSource-owned intellectual property.

 Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.

!-->

<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M4 1.5h12A3.5 3.5 0 0 1 19.5 5v8l-.005.192a3.5 3.5 0 0 1-2.927 3.262l-.062.008v1.813a1.5 1.5 0 0 1-2.193 1.33l-.371-.193-.38-.212a13.452 13.452 0 0 1-3.271-2.63l-.062-.07H4A3.5 3.5 0 0 1 .5 13V5A3.5 3.5 0 0 1 4 1.5ZM4 3a2 2 0 0 0-2 2v8a2 2 0 0 0 2 2h6.924a11.917 11.917 0 0 0 3.71 3.081l.372.194v-3.268L14.962 15H16a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2H4Z"/><path d="M9.75 5a.75.75 0 0 0-.75.75v2.5H6.5a.75.75 0 0 0 0 1.5H9v2.5a.75.75 0 0 0 1.5 0v-2.5H13a.75.75 0 0 0 0-1.5h-2.5v-2.5A.75.75 0 0 0 9.75 5Z"/></svg>
`;let s$8=class extends Plugin{static get pluginName(){return"CommentsUI"}static get requires(){return[m$9,r$9,k$4,b$3]}get CommentsListView(){return xt$1}get CommentThreadInputView(){return Tt$1}init(){const we=this.editor,t=we.plugins.get(m$9),te=we.plugins.get(r$9),be=we.plugins.get(b$3),xe=we.plugins.get(k$4);we.ui.componentFactory.add("comment",()=>{const ve=this._createUIButton(ButtonView);return ve.tooltip=!0,ve}),we.ui.componentFactory.add("menuBar:comment",()=>this._createUIButton(MenuBarMenuListItemButtonView)),xe.addSourceCollector(()=>{const ve=[];for(const[ke,Ie]of t._threadToController){const Ae=te.getAllMarkersForId(ke.id),Se=Ae.map(Oe=>Oe.getRange());Ae.length>0&&ve.push([Ie.view,Se])}return ve}),this.listenTo(be,"change:activeAnnotations",(ve,ke,Ie)=>{const Ae=Array.from(Ie).map(Ve=>Ve.innerView).find(Ve=>t._viewToController.has(Ve));if(!Ae)return void(te.activeMarker=null);const Se=t._viewToController.get(Ae).model.id,Oe="comment:"+Se;Se&&te.hasMarkerForId(Se)?te.activeMarker=Oe:te.activeMarker&&(te.activeMarker=null)}),this.listenTo(t,"removeCommentThread",(ve,{threadId:ke,isFromAdapter:Ie})=>{!Ie&&we.ui.focusTracker.isFocused&&te.hasMarkerForId(ke)&&we.editing.view.focus()},{priority:"highest"}),this.listenTo(t,"addComment",(ve,{threadId:ke,isFromAdapter:Ie})=>{Ie||!te.hasMarkerForId(ke)||!t.hasCommentThread(ke)||t.getCommentThread(ke).length===1&&(we.editing.view.focus(),ve.stop())},{priority:"low"})}_createUIButton(we){const t=this.editor,te=new we(t.locale),be=t.commands.get("addCommentThread");return te.set({label:W$2(t.locale,"Comment"),icon:kt$2}),te.bind("isEnabled").to(be),this.listenTo(te,"execute",()=>be.execute()),te}},e$5=class extends Plugin{static get pluginName(){return"CommentsOnly"}static get requires(){return[r$9]}constructor(we){super(we),this.set("isEnabled",!1),this.on("change:isEnabled",(t,te,be)=>{be?this._enableCommentsOnlyMode():this._disableCommentsOnlyMode()})}afterInit(){!this.isEnabled&&this.editor.config.get("commentsOnly")&&(this.isEnabled=!0)}_enableCommentsOnlyMode(){for(const[t,te]of this.editor.commands)te.affectsData&&t!=="addCommentThread"&&te.forceDisabled("commentsOnlyMode");this.editor.plugins.has("DragDrop")&&this.editor.plugins.get("DragDrop").forceDisabled("commentsOnlyMode");const we=this.editor.editing.view.document;this.listenTo(we,"cut",t=>t.stop(),{priority:"highest"}),this.listenTo(we,"clipboardInput",t=>t.stop(),{priority:"highest"}),this.listenTo(we,"delete",t=>t.stop(),{priority:"highest"})}_disableCommentsOnlyMode(){for(const[we,t]of this.editor.commands)t.affectsData&&we!=="addCommentThread"&&t.clearForceDisabled("commentsOnlyMode");this.stopListening(this.editor.editing.view.document)}},j$2=class extends ContextPlugin{constructor(t){super(t);Re(this,"activeUIs");Re(this,"_uis");Re(this,"_uisData");this.activeUIs=new Set,this._uis=new Map,this._uisData=new Map}static get requires(){return[b$3]}static get pluginName(){return"AnnotationsUIs"}init(){const t=this.context.plugins.get(b$3);this.listenTo(t,"_activateAnnotation",(te,be)=>{for(const xe of this.activeUIs){const ve=this._uis.get(xe);(0,this._uisData.get(xe).filter)(be)&&ve.setActiveAnnotation(be)}}),this.listenTo(t,"_deactivateAllAnnotations",()=>{for(const te of this.activeUIs)this._uis.get(te).setActiveAnnotation(null)}),this.listenTo(t._visibleAnnotations,"add",(te,be)=>{this._assertAnnotationDoesNotBelongToMultipleUIs(be)})}hasActive(){return this.activeUIs.size>0}isActive(t){return this.activeUIs.has(t)}activate(t,te=()=>!0){const be=this.context.plugins.get(b$3);if(!this._uis.has(t))throw new CKEditorError("annotationsuis-missing-ui",this,{uiName:t});this.isActive(t)&&this.deactivate(t),this.activeUIs.add(t);const xe=new x$4;(function({source:ke,target:Ie,filter:Ae}){for(const Se of ke)Ae(Se)&&Ie.add(Se);Ie.listenTo(ke,"add",(Se,Oe)=>{Ae(Oe)&&Ie.add(Oe)}),Ie.listenTo(ke,"remove",(Se,Oe)=>{Ie.has(Oe)&&Ie.remove(Oe)})})({source:be._visibleAnnotations,target:xe,filter:te}),this._uisData.set(t,{collection:xe,filter:te});const ve=this._uis.get(t);ve.attach(xe),this.listenTo(ve,"change:activeAnnotation",(ke,Ie,Ae,Se)=>{Se&&be._removeActiveAnnotation(Se),Ae&&be._addActiveAnnotation(Ae)})}deactivate(t){if(this.activeUIs.delete(t),!this._uis.has(t))throw new CKEditorError("annotationsuis-missing-ui",this,{uiName:t});const te=this._uis.get(t);te.detach(),this.stopListening(te),this._uisData.get(t).collection.destroy(),this._uisData.delete(t)}switchTo(t){if(!this._uis.has(t))throw new CKEditorError("annotationsuis-missing-ui",this,{uiName:t});const te=this.context.plugins.get(b$3),be=Array.from(te.activeAnnotations)[0]||null;this.deactivateAll(),this.activate(t);const xe=this._uis.get(t);xe.setActiveAnnotation(be),xe._setSelectedAnnotations&&be&&xe._setSelectedAnnotations([be])}deactivateAll(){for(const t of this.activeUIs)this.deactivate(t)}register(t,te){if(this._uis.has(t))throw new CKEditorError("annotationsuis-register-already-registered");if(typeof te.attach!="function"||typeof te.detach!="function"||typeof te.setActiveAnnotation!="function")throw new CKEditorError("annotationsuis-register-invalid-interface",null);this._uis.set(t,te)}refilterAnnotations(){const t=this.context.plugins.get(b$3).collection,te=new Map,be=Array.from(this.activeUIs);for(const xe of this.activeUIs){const ve=this._uisData.get(xe).collection;for(const ke of ve)te.set(ke,xe)}for(const xe of t){const ve=te.get(xe);this._assertAnnotationDoesNotBelongToMultipleUIs(xe);const ke=be.find(Ie=>this._uisData.get(Ie).filter(xe));ve!==ke&&(ve&&this._uisData.get(ve).collection.remove(xe),ke&&this._uisData.get(ke).collection.add(xe))}}destroy(){this.deactivateAll(),super.destroy()}_assertAnnotationDoesNotBelongToMultipleUIs(t){const te=[];for(const be of this.activeUIs)(0,this._uisData.get(be).filter)(t)&&te.push(be);if(te.length>1)throw new CKEditorError("annotationsuis-annotation-mismatch",null,{matchedUIs:te,annotationType:t.type})}};const ne$1=toUnit("px");let T$2=class extends View{constructor(t){super(t);Re(this,"list");const te=this.bindTemplate;this.set("minHeight",0),this.set("class",""),this.list=this.createCollection(),this.setTemplate({tag:"div",attributes:{class:["ck","ck-sidebar","ck-reset",te.to("class")],style:{minHeight:te.to("minHeight",be=>typeof be=="number"?ne$1(be+10):null)}},children:this.list})}};const qt=toUnit("px");let C$2=class extends View{constructor(t){super(t);Re(this,"content");Re(this,"_targetTop");Re(this,"_mutationObserver");this.set("top",0),this.set("height",0),this.bind("bottom").to(this,"top",this,"height",(be,xe)=>be+xe),this.set("isAnimationDisabled",!1),this._mutationObserver=Dt$1(()=>this.updateHeight()),this._targetTop=null,this.content=this.createCollection();const te=this.bindTemplate;this.setTemplate({tag:"div",attributes:{class:["ck-sidebar-item",te.to("isAnimationDisabled",be=>be?"ck-sidebar-item--no-animation":"")],style:{top:te.to("top",be=>qt(be))}},children:this.content})}render(){super.render(),this._mutationObserver.attach(this.element)}updateHeight(){const t=this.element.clientHeight;t&&(this.height=t)}destroy(){this.content.clear(),this._mutationObserver.detach(),super.destroy()}},z$2=class extends ContextPlugin{constructor(t){super(t);Re(this,"view");Re(this,"_activeAnnotation");Re(this,"_annotations");Re(this,"_spaceBetweenItems");Re(this,"_sidebarItemViewToAnnotation");Re(this,"_annotationToSidebarItemView");Re(this,"_recalculateBuffer");this.set("_lastItem",void 0),this.view=this._createSidebarView(),this.set("container",null),this._spaceBetweenItems=25,this._sidebarItemViewToAnnotation=new Map,this._annotationToSidebarItemView=new Map,this.context.config.define("sidebar.preventScrollOutOfView",!1),this._annotations=null,this._activeAnnotation=null,this._recalculateBuffer=[]}static get pluginName(){return"Sidebar"}init(){const t=this.context.config.get("sidebar.container");t&&this.setContainer(t)}setContainer(t){if(!y$6(t))throw new CKEditorError("sidebar-setcontainer-invalid-element");this.container=t}_attachToContainer({viewClass:t="",spaceBetweenItems:te=25}={}){if(!y$6(this.container))throw new CKEditorError("sidebar-attachtocontainer-missing-container",this);this.container.appendChild(this.view.element),this.view.class=t,this._spaceBetweenItems=te}rearrange({removedAnnotation:t,previousAnnotation:te,nextAnnotation:be}){const xe=this.getSidebarItemView(t);this.view.list.remove(xe),this._destroySidebarItemView(t),te&&this._alignToTargetRect(this.getSidebarItemView(te)),be&&this._alignToTargetRect(this.getSidebarItemView(be)),this._updateLastItem()}refresh({blurredAnnotation:t,activatedAnnotation:te,disableAnimationOnActivatedAnnotation:be}){if(this._activeAnnotation=te,t){t.isActive=!1;const xe=this.getSidebarItemView(t);xe&&be&&(xe.isAnimationDisabled=!1)}if(te){const xe=this.getSidebarItemView(te);xe&&(te.isActive=!0,be&&(xe.isAnimationDisabled=!0,xe.top+=1),this._alignToTargetRect(xe))}}_detachFromContainer(t){if(this.view.element.remove(),t)for(const te of t)this._destroySidebarItemView(te);this.view.list.clear(),this.view.class="",this._lastItem=null}addAnnotation(t,te){te||(te=t.view);const be=new C$2(this.context.locale);this._sidebarItemViewToAnnotation.set(be,t),this._annotationToSidebarItemView.set(t,be),be.content.add(te),this.listenTo(t.view,"change:targetRect",(ve,ke,Ie)=>{const Ae=this._getTargetTop(t,Ie);be._targetTop!=Ae&&(be._targetTop=Ae,this._setItemTop(be,Ae))}),this.listenTo(be,"change:top",()=>{this._recalculate(be,"top")}),this.listenTo(be,"change:bottom",()=>{this._recalculate(be,"bottom")}),this._alignToTargetRect(be);const xe=this._getItemBefore(be);return xe?this._alignAfterItem(xe,be)||this._alignToTargetRect(be):this._alignToTargetRect(be),this._updateLastItem(),this.view.list.add(be),be}_alignForTopChange(t){if(!t.content.length)return;const te=this._getItemBefore(t);if(!te)return;const be=this._sidebarItemViewToAnnotation.get(te),xe=this._activeAnnotation;xe&&xe===be?this._alignAfterItem(te,t):this._alignBeforeItem(t,te)}_alignForBottomChange(t){if(!t.content.length)return;const te=this._getItemAfter(t);if(!te)return;const be=this._sidebarItemViewToAnnotation.get(te),xe=this.context.config.get("sidebar.preventScrollOutOfView"),ve=this._activeAnnotation;ve&&ve===be&&xe?(this._alignBeforeItem(te,t),this._alignAfterItem(t,te)):ve&&ve===be?this._alignBeforeItem(te,t):this._alignAfterItem(t,te)}_recalculate(t,te){this._recalculateBuffer.length===0&&setTimeout(()=>{for(const{sidebarItemView:be,changedProp:xe}of this._recalculateBuffer)xe==="top"?this._alignForTopChange(be):this._alignForBottomChange(be);this._recalculateBuffer=[]},10),this._recalculateBuffer.push({sidebarItemView:t,changedProp:te})}getSidebarItemView(t){return this._annotationToSidebarItemView.get(t)}destroy(){this.stopListening(),this.view.destroy()}_destroySidebarItemView(t){const te=this.getSidebarItemView(t);this.stopListening(te),this.stopListening(t.view),te.destroy(),this._annotationToSidebarItemView.delete(t),this._sidebarItemViewToAnnotation.delete(te)}_createSidebarView(){const t=new T$2(this.context.locale);return t.render(),this.on("change:_lastItem",(te,be,xe,ve)=>{ve&&t.unbind("minHeight"),xe?t.bind("minHeight").to(xe,"bottom"):t.minHeight=null}),t}_updateLastItem(){var t;this._lastItem=(t=this._annotations)!=null&&t.last?this.getSidebarItemView(this._annotations.last):null}_getItemBefore(t){var xe;const te=this._sidebarItemViewToAnnotation.get(t),be=te&&((xe=this._annotations)==null?void 0:xe.get(this._annotations.getIndex(te)-1));return be&&this.getSidebarItemView(be)||null}_getItemAfter(t){var xe;const te=this._sidebarItemViewToAnnotation.get(t),be=te&&((xe=this._annotations)==null?void 0:xe.get(this._annotations.getIndex(te)+1));return be&&this.getSidebarItemView(be)||null}_alignBeforeItem(t,te){t.updateHeight();const be=M$1(te.bottom+this._spaceBetweenItems,t.top);return!!be&&(this._setItemTop(te,te.top-be),!0)}_alignAfterItem(t,te){t.updateHeight();const be=M$1(t.bottom+this._spaceBetweenItems,te.top);return!!be&&(this._setItemTop(te,te.top+be,!1),!0)}_alignToTargetRect(t){const te=this._sidebarItemViewToAnnotation.get(t);if(!te||!te.target||!te.targetRect)return;const be=this._getTargetTop(te,te.targetRect);this._setItemTop(t,be)}_getTargetTop(t,te){if(te===null)return 0;if(t.target instanceof Rect)return te.top;{const be=new Rect(this.view.element).top;return te.top-be}}_setItemTop(t,te,be=this.context.config.get("sidebar.preventScrollOutOfView")){be&&(te=Math.max(te,this._getMaxAvailableTop(t))),t.top=te}_getMaxAvailableTop(t){let te=this._getItemBefore(t),be=0;for(;te;)te.updateHeight(),be+=this._spaceBetweenItems+te.height,te=this._getItemBefore(te);return be}};function M$1(Te,we){return Math.max(Te-we,0)}function y$6(Te){return Te!==null&&typeof Te=="object"&&Te.nodeType===1}let n$5=class extends ContextPlugin{constructor(t){super(t);Re(this,"isAttached");Re(this,"annotations");Re(this,"_editorAnnotations");Re(this,"_refreshPositioningDebounced");this.isAttached=!1,this.set("activeAnnotation",null),this.annotations=null,this._editorAnnotations=new Collection,this._refreshPositioningDebounced=debounce(()=>{this.annotations.refreshPositioning()},250,{leading:!1})}static get requires(){return[z$2,j$2]}static get pluginName(){return"WideSidebar"}init(){const t=this.context.plugins.get(j$2),te=this.context.plugins.get(z$2);t.register("wideSidebar",this),te.container&&t.switchTo("wideSidebar")}setActiveAnnotation(t){if(t===this.activeAnnotation)return;const te=this.context.plugins.get(z$2);te._activeAnnotation=t;const be=this.activeAnnotation;this.activeAnnotation=t,te.refresh({blurredAnnotation:be,activatedAnnotation:this.activeAnnotation})}attach(t){this.annotations=t;const te=this.context.plugins.get(z$2);if(te._annotations=t,this.isAttached)throw new CKEditorError("widesidebar-attach-already-attached",this);this.isAttached=!0,this.listenTo(te,"set:container",()=>{this.detach(),this.listenTo(te,"change:container",ve=>{ve.off(),this.attach(t)})}),te._attachToContainer({viewClass:"ck-sidebar--wide"});const be=ve=>{ve.updateTargetRect(),te.addAnnotation(ve)};for(const ve of t)be(ve);this.listenTo(t,"add",(ve,ke)=>{be(ke)}),this.listenTo(t,"remove",(ve,ke,Ie)=>{te.rearrange({removedAnnotation:ke,previousAnnotation:t.get(Ie-1),nextAnnotation:t.get(Ie+1)}),ke===this.activeAnnotation&&this.setActiveAnnotation(null)},{priority:"high"}),this.listenTo(t,"focus",(ve,ke)=>{this.setActiveAnnotation(ke)}),this.listenTo(t,"blur",()=>{this.setActiveAnnotation(null)});const xe=this.context instanceof Context?this.context.editors:new Collection([this.context]);for(const ve of xe)this._integrateWithEditorAnnotations(ve);this.listenTo(xe,"add",(ve,ke)=>{this.listenTo(ke,"ready",()=>{this._integrateWithEditorAnnotations(ke)})}),this.listenTo(xe,"remove",(ve,ke)=>{ke.plugins.has("EditorAnnotations")&&this._destroyEditorAnnotationsIntegration(ke.plugins.get("EditorAnnotations"))}),window.addEventListener("resize",this._refreshPositioningDebounced),this.annotations.refreshPositioning()}detach(){if(!this.isAttached)throw new CKEditorError("widesidebar-detach-not-attached",this);this.setActiveAnnotation(null);const t=this.context.plugins.get(z$2);t._detachFromContainer(this.annotations),this.stopListening(t),this.stopListening(this.annotations),this.context instanceof Context&&this.stopListening(this.context.editors);for(const te of Array.from(this._editorAnnotations))this._destroyEditorAnnotationsIntegration(te);window.removeEventListener("resize",this._refreshPositioningDebounced),this._refreshPositioningDebounced.cancel(),this.activeAnnotation=null,this.isAttached=!1,this.annotations=null}destroy(){this.isAttached&&this.detach()}_integrateWithEditorAnnotations(t){if(!t.plugins.has("EditorAnnotations"))return;const te=t.plugins.get("EditorAnnotations"),be=()=>{const xe=te.getOrderedSelectedAnnotations({annotations:this.annotations,activeAnnotation:this.activeAnnotation});this.setActiveAnnotation(xe[0]||null)};this.listenTo(te,"refresh",be),this.listenTo(te,"blur",(xe,{isAnnotationTracked:ve})=>{this.activeAnnotation&&ve(this.activeAnnotation)&&this.setActiveAnnotation(null)}),this.listenTo(te,"uiUpdate",()=>{this._refreshPositioningDebounced()}),this.listenTo(this.annotations,"blur",xe=>{te.hasDomSelection()&&(be(),xe.stop())},{priority:"high"}),this._editorAnnotations.add(te)}_destroyEditorAnnotationsIntegration(t){this.stopListening(t),this._editorAnnotations.remove(t)}},D$1=class extends ButtonView{constructor(t){super(t);Re(this,"counterView");const te=this.bindTemplate;this.set("isDirty",!1),this.set("number",0),this.bind("_badge").to(this,"isDirty",this,"number",(be,xe)=>be?"...":xe.toString()),this.set("annotationType",""),this.icon=kt$2,this.extendTemplate({attributes:{class:["ck-annotation-counter"]}}),this.counterView=new View,this.counterView.setTemplate({tag:"span",attributes:{class:["ck-annotation-counter__badge",te.to("annotationType",be=>"ck-annotation-counter__badge--"+be),te.if("isDirty","ck-annotation-counter__badge--edit-mode")]},children:[{text:te.to("_badge")}]}),this.children.add(this.counterView)}},i$8=class extends ContextPlugin{constructor(t){super(t);Re(this,"isAttached");Re(this,"annotations");Re(this,"_manuallyClosedAnnotationViews");Re(this,"_domEmitter");Re(this,"_annotationToNarrowView");Re(this,"_selectedAnnotations");Re(this,"_editorAnnotations");Re(this,"_refreshPositioningDebounced");this.isAttached=!1,this._manuallyClosedAnnotationViews=new Set,this._domEmitter=Object.create(DomEmitterMixin),this._annotationToNarrowView=new Map,this.set("activeAnnotation",null),this.annotations=null,this._selectedAnnotations=[],this._editorAnnotations=new Collection,this._refreshPositioningDebounced=debounce(()=>{this._refreshPositioning()},250,{leading:!1})}static get requires(){return[z$2,j$2]}static get pluginName(){return"NarrowSidebar"}init(){this.context.plugins.get(j$2).register("narrowSidebar",this),this.bodyCollection=new BodyCollection(this.context.locale),this.balloonPanelView=new BalloonPanelView(this.context.locale),this.bodyCollection.attachToDom(),this.bodyCollection.add(this.balloonPanelView)}attach(t){this.annotations=t;const te=this.context.plugins.get(z$2),be=this.balloonPanelView;if(te._annotations=t,this.isAttached)throw new CKEditorError("narrowsidebar-attach-already-attached",this);this.isAttached=!0,this.listenTo(te,"set:container",()=>{this.detach(),this.listenTo(te,"change:container",ke=>{ke.off(),this.attach(t)})}),te._attachToContainer({viewClass:"ck-sidebar--narrow",spaceBetweenItems:5});const xe=ke=>{const Ie=new D$1(this.context.locale);te.addAnnotation(ke,Ie),this._annotationToNarrowView.set(ke,Ie),Ie.bind("isDirty","annotationType","number").to(ke.view,"isDirty","type","length"),Ie.on("execute",()=>{this._manuallyClosedAnnotationViews.clear(),be.content.first!==ke.view?(this._showBalloon(ke),ke.view.element.focus(),this.setActiveAnnotation(ke)):this.setActiveAnnotation(null)})};for(const ke of t)xe(ke);this.listenTo(t,"add",(ke,Ie)=>{xe(Ie)}),this.listenTo(t,"remove",(ke,Ie,Ae)=>{this._annotationToNarrowView.get(Ie).destroy(),this._annotationToNarrowView.delete(Ie),te.rearrange({removedAnnotation:Ie,previousAnnotation:t.get(Ae-1),nextAnnotation:t.get(Ae+1)}),Ie===this.activeAnnotation&&this.setActiveAnnotation(null)},{priority:"low"}),this.listenTo(t,"focus",(ke,Ie)=>{this.setActiveAnnotation(Ie)}),this.listenTo(t,"blur",()=>{this.setActiveAnnotation(null)}),this._domEmitter.listenTo(document,"keydown",(ke,Ie)=>{Ie.keyCode===keyCodes.esc&&be.isVisible&&(this._manuallyClosedAnnotationViews.add(be.content.first),this._hideBalloon(),Ie.stopPropagation(),Ie.preventDefault())}),this._domEmitter.listenTo(document,"mousedown",(ke,Ie)=>{const Ae=Ie.target;be.isVisible&&be.element.contains(Ae)||te.view.element.contains(Ae)||ke.preventClosingBalloon||this.activeAnnotation&&this.activeAnnotation.focusableElements.find(Se=>Se.contains(Ae))||(this._manuallyClosedAnnotationViews.clear(),this._hideBalloon(),this.setActiveAnnotation(null))});const ve=this.context instanceof Context?this.context.editors:new Collection([this.context]);for(const ke of ve)this._integrateWithEditorAnnotations(ke);this.listenTo(ve,"add",(ke,Ie)=>{this.listenTo(Ie,"ready",()=>{this._integrateWithEditorAnnotations(Ie)})}),this.listenTo(ve,"remove",(ke,Ie)=>{Ie.plugins.has("EditorAnnotations")&&this._destroyEditorAnnotationsIntegration(Ie.plugins.get("EditorAnnotations"))}),window.addEventListener("resize",this._refreshPositioningDebounced),this._refreshPositioning()}setActiveAnnotation(t){if(t===this.activeAnnotation)return;const te=this.context.plugins.get(z$2);te.refresh({blurredAnnotation:this.activeAnnotation,activatedAnnotation:t,disableAnimationOnActivatedAnnotation:!0}),t?te.getSidebarItemView(t)?this._showBalloon(t):this._hideBalloon():this._hideBalloon(),this.activeAnnotation=t}detach(){if(!this.isAttached)throw new CKEditorError("narrowsidebar-detach-not-attached",this);this.setActiveAnnotation(null);const t=this.context.plugins.get(z$2);this._hideBalloon(),Array.from(this._annotationToNarrowView.values(),te=>te.destroy()),this._annotationToNarrowView.clear(),t._detachFromContainer(this.annotations),this.stopListening(),this._domEmitter.stopListening(),this.context instanceof Context&&this.stopListening(this.context.editors);for(const te of Array.from(this._editorAnnotations))this._destroyEditorAnnotationsIntegration(te);window.removeEventListener("resize",this._refreshPositioningDebounced),this._refreshPositioningDebounced.cancel(),this._selectedAnnotations=[],this.isAttached=!1,this.annotations=null}destroy(){this.isAttached&&this.detach(),this.bodyCollection.detachFromDom()}_integrateWithEditorAnnotations(t){if(!t.plugins.has("EditorAnnotations"))return;const te=t.plugins.get("EditorAnnotations"),be=this.context.plugins.get(z$2),xe=this.annotations,ve=this.balloonPanelView,ke=()=>{const Ie=te.getOrderedSelectedAnnotations({annotations:this.annotations,activeAnnotation:this.activeAnnotation});this._setSelectedAnnotations(Ie),this.setActiveAnnotation(Ie[0]||null)};this.listenTo(te,"refresh",ke),this.listenTo(te,"blur",(Ie,{isAnnotationTracked:Ae})=>{this.activeAnnotation&&Ae(this.activeAnnotation)&&(this._setSelectedAnnotations([]),this.setActiveAnnotation(null))}),this.listenTo(te,"uiUpdate",()=>{this._refreshPositioningDebounced()}),this.listenTo(xe,"blur",Ie=>{te.hasDomSelection()&&Ie.stop()},{priority:"high"}),this.listenTo(this._domEmitter,"mousedown",(Ie,Ae)=>{const Se=Ae.target;ve.isVisible&&ve.element.contains(Se)||be.view.element.contains(Se)||this.activeAnnotation&&te.hasDomSelection()&&(ke(),Ie.preventClosingBalloon=!0)},{priority:"high"}),this._editorAnnotations.add(te)}_destroyEditorAnnotationsIntegration(t){t&&(this.stopListening(t),this._editorAnnotations.remove(t))}_setSelectedAnnotations(t){for(const te of this._selectedAnnotations)t.includes(te)||this._manuallyClosedAnnotationViews.delete(te.view);this._selectedAnnotations=t}_refreshPositioning(){const t=this.balloonPanelView;this.annotations.refreshPositioning(),t.isVisible&&this._updateBalloonPosition()}_showBalloon(t){if(this._manuallyClosedAnnotationViews.has(t.view))return;const te=this.balloonPanelView.content.first;te!==t.view?(te&&this._detachListeners(te),this._attachListeners(t.view),this.balloonPanelView.content.clear(),this.balloonPanelView.content.add(t.view),this._updateBalloonPosition()):this._updateBalloonPosition()}_updateBalloonPosition(){const t=this.balloonPanelView.content.first,te=t&&this.annotations.getByView(t);if(!te||!this._annotationToNarrowView.has(te))return;const be=this._annotationToNarrowView.get(te).element,xe=function(){const ve=BalloonPanelView.defaultPositions;return[ve.southArrowNorthEast,ve.northArrowSouthEast,ve.southArrowNorth,ve.northArrowSouth,ve.southArrowNorthWest,ve.northArrowSouthWest]}();this.balloonPanelView.pin({target:be,positions:xe})}_hideBalloon(){const t=this.balloonPanelView,te=t.content.first;te&&(this._detachListeners(te),t.unpin(),t.content.clear())}_attachListeners(t){this.listenTo(t,"change:height",()=>this._updateBalloonPosition()),this.listenTo(t,"Esc",(te,be)=>{this._manuallyClosedAnnotationViews.add(t),this._hideBalloon(),be()})}_detachListeners(t){this.stopListening(t)}},c$6=class extends Plugin{constructor(t){super(t);Re(this,"isAttached");Re(this,"annotations");Re(this,"_manuallyClosed");Re(this,"_balloon");Re(this,"_addedAnnotations");Re(this,"_selectedAnnotations");Re(this,"_forceRefresh");t.editing.view.addObserver(MouseObserver),this.isAttached=!1,this.set("activeAnnotation",null),this.annotations=null,this._manuallyClosed=new Set,this._balloon=t.plugins.get(ContextualBalloon),this._addedAnnotations=new Set,this._selectedAnnotations=[],this._forceRefresh=!1}static get requires(){return[k$4,ContextualBalloon,j$2]}static get pluginName(){return"InlineAnnotations"}init(){const t=this.editor.plugins.get(j$2);t.context===this.editor&&(t.register("inline",this),this.editor.keystrokes.set("Esc",(te,be)=>{const xe=this._balloon;if(this.isAttached&&xe.visibleView){const ve=this.annotations.getByView(xe.visibleView);ve&&this._closeAnnotation(ve),be()}}))}afterInit(){const t=this.editor.plugins.get(j$2);t.context===this.editor&&(t.hasActive()||t.switchTo("inline"))}setActiveAnnotation(t){t!==this.activeAnnotation&&(this.activeAnnotation&&(this.activeAnnotation.isActive=!1),t&&this.editor.ui.focusTracker.isFocused&&(this.annotations.has(t)&&this._addAnnotationToBalloon(t,!0),t.isActive=!0),t||this._setSelectedAnnotations([]),this.activeAnnotation=t)}attach(t){this.annotations=t;const te=this.editor.plugins.get(j$2),be=this._balloon;if(this.isAttached)throw new CKEditorError("inlineannotations-attach-already-attached",this);if(te.context!==this.editor)throw new CKEditorError("inlineannotations-not-allowed-with-context",this);const xe=this.editor.plugins.get(k$4);this.listenTo(xe,"refresh",()=>{const ve=xe.getOrderedSelectedAnnotations({annotations:this.annotations,activeAnnotation:this.activeAnnotation});var ke,Ie;!this._forceRefresh&&(ke=ve,Ie=this._selectedAnnotations,ke.length===Ie.length&&ke.every(Ae=>Ie.includes(Ae)))||(this._forceRefresh=!1,this._setSelectedAnnotations(ve),this.setActiveAnnotation(ve[0]||null))}),this.listenTo(xe,"blur",(ve,{isAnnotationTracked:ke})=>{this.activeAnnotation&&ke(this.activeAnnotation)&&(this._setSelectedAnnotations([]),this.setActiveAnnotation(null))}),this.listenTo(this.editor.ui.focusTracker,"change:isFocused",(ve,ke,Ie)=>{Ie||this.setActiveAnnotation(null)}),this.listenTo(t,"remove",(ve,ke)=>{this._removeAnnotationFromBalloon(ke),ke===this.activeAnnotation&&this.setActiveAnnotation(null)}),this.listenTo(be,"change:visibleView",(ve,ke,Ie,Ae)=>{Ae&&this.stopListening(Ae);const Se=t.getByView(Ie);Ie&&Se&&(this.listenTo(Ie,"change:height",()=>{be.updatePosition()}),this.listenTo(Ie,"Esc",()=>{this._closeAnnotation(Se),this.editor.editing.view.focus()}),this.activeAnnotation!==Se&&this.setActiveAnnotation(Se))}),this.listenTo(this.editor.ui,"update",()=>{be.visibleView&&t.getByView(be.visibleView)&&be.updatePosition()}),this.listenTo(this.editor.editing.view.document,"mousedown",()=>{this._forceRefresh=!0,this._manuallyClosed.clear()}),this.editor.editing.view.document.selection.editableElement&&this.editor.editing.view.focus(),this.isAttached=!0}detach(){if(!this.isAttached)throw new CKEditorError("inlineannotations-detach-not-attached",this);this.setActiveAnnotation(null);for(const t of this._addedAnnotations)this._removeAnnotationFromBalloon(t);this.stopListening(),this.isAttached=!1,this.annotations=null}destroy(){this.isAttached&&this.detach()}_setSelectedAnnotations(t){for(const te of this._selectedAnnotations)t.includes(te)||this._manuallyClosed.delete(te);for(const te of this.annotations)t.includes(te)||this._removeAnnotationFromBalloon(te);if(this.editor.ui.focusTracker.isFocused)for(const te of t)this._addAnnotationToBalloon(te);this._selectedAnnotations=t}_addAnnotationToBalloon(t,te=!1){this._manuallyClosed.has(t)||(this._addedAnnotations.has(t)||this._balloon.hasView(t.view)||(this._addedAnnotations.add(t),this._balloon.add({stackId:t.view.id,view:t.view,position:{target:()=>this._getBalloonTargetForAnnotation(t)}})),te&&this._balloon.showStack(t.view.id))}_getBalloonTargetForAnnotation(t){const te=t.target,be=this.editor.editing.view,xe=be.document.selection.getFirstRange(),ve=be.domConverter.viewRangeToDom(xe);if(ve.collapse(!0),te){if(te instanceof Rect)return te;let Ie=[];for(const Se of te)Ie.push(...(ke=Se.getClientRects(),Array.from(ke).map(DOMRect.fromRect)));Ie=function(Se){const Oe=[];let Ve=Se[0];for(let Me=1;Me<Se.length;Me++)F$4(Ve,Se[Me])?Ve.width+=Se[Me].width:(Oe.push(Ve),Ve=Se[Me]);return Oe.push(Ve),Oe}(Ie);const Ae=ve.getBoundingClientRect();return Ie.find(Se=>Se.top<=Ae.top&&Se.bottom>=Ae.bottom&&Se.left<=Ae.left&&Se.right>=Ae.right)||Ie[0]}var ke;return t.targetRect||ve}_removeAnnotationFromBalloon(t){this._addedAnnotations.has(t)&&this._balloon.hasView(t.view)&&(this._addedAnnotations.delete(t),this._balloon.remove(t.view))}_closeAnnotation(t){this._manuallyClosed.add(t),this._removeAnnotationFromBalloon(t)}};function F$4(Te,we){return Te.top===we.top&&Te.bottom===we.bottom&&Te.right===we.left}var Q$2=`<!--

 What you're currently looking at is the source code of a legally protected, proprietary software.
 CKEditor 5 Collaboration is licensed under a commercial license and protected by copyright law. Where not otherwise indicated,
 all CKEditor 5 Collaboration content is authored by CKSource engineers and consists of CKSource-owned intellectual property.

 Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.

!-->

<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path clip-rule="evenodd" d="M14 3.5A3.5 3.5 0 0 1 17.5 7v6l-.005.192a3.501 3.501 0 0 1-2.927 3.262l-.062.008v1.813a1.5 1.5 0 0 1-2.193 1.33l-.37-.193-.38-.212a13.452 13.452 0 0 1-3.272-2.63l-.062-.07-4.729-.046a3.5 3.5 0 0 1-3.5-3.5v-6a3.5 3.5 0 0 1 3.5-3.5L14 3.5ZM3.5 4.954a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2L8.924 15a11.917 11.917 0 0 0 3.71 3.081l.372.194v-3.268L12.962 15H14a2 2 0 0 0 2-2V7a2 2 0 0 0-2-2L3.5 4.954Z"/><path d="M16.5.5h-10a3.5 3.5 0 0 0-3.162 2h1.84A2 2 0 0 1 6.5 2h10a2 2 0 0 1 2 2v8.873a3.502 3.502 0 0 0 1.495-2.681L20 10V4A3.5 3.5 0 0 0 16.5.5Z"/><path clip-rule="evenodd" d="M12.013 7.453a.75.75 0 0 1 .034 1.06l-3.75 4a.75.75 0 0 1-1.045.048l-2.25-2a.75.75 0 0 1 .996-1.122l1.704 1.515 3.25-3.467a.75.75 0 0 1 1.061-.034Z"/></svg>
`;let X$2=class extends View{constructor(t,te){super(t);Re(this,"_focusTracker");Re(this,"_keystrokes");Re(this,"_focusables");Re(this,"_focusCycler");this.set("isEmpty",!te.length),this._focusTracker=new FocusTracker,this._keystrokes=new KeystrokeHandler,this._focusables=te,this._focusCycler=new FocusCycler({focusables:this._focusables,focusTracker:this._focusTracker,keystrokeHandler:this._keystrokes,actions:{focusPrevious:"shift + tab",focusNext:"tab"}}),this.listenTo(te,"add",()=>{this.isEmpty=!1}),this.listenTo(te,"remove",(xe,ve)=>{ve.isActive&&this.focus(),te.length||(this.isEmpty=!0)});const be=this.bindTemplate;this.setTemplate({tag:"div",attributes:{dir:"auto",class:["ck","ck-comments-archive"],tabindex:-1},children:[{tag:"div",attributes:{class:["ck-comments-archive__content"]},children:[{tag:"div",children:te},{tag:"p",attributes:{class:["ck-comments-archive__info",be.if("isEmpty","ck-hidden",xe=>!xe)]},children:[{text:W$2(t,"EMPTY_COMMENTS_ARCHIVE")}]}]}]})}render(){super.render(),this._keystrokes.listenTo(this.element);const t=te=>te.stopPropagation();this._keystrokes.set("arrowright",t),this._keystrokes.set("arrowleft",t),this._keystrokes.set("arrowup",t),this._keystrokes.set("arrowdown",t),this.listenTo(this.element,"selectstart",(te,be)=>{be.stopPropagation()},{priority:"high"})}destroy(){super.destroy(),this._focusTracker.destroy(),this._keystrokes.destroy()}focus(){this.element.focus()}},p$6=class extends ContextPlugin{static get pluginName(){return"CommentsArchive"}static get requires(){return[m$9,b$3]}constructor(we){super(we),this.archivedThreads=new Collection}init(){const we=this.context,t=we.plugins.get(m$9),te=we.plugins.get(b$3);this.listenTo(t,"addCommentThread",(be,{threadId:xe})=>{const ve=t.getCommentThread(xe);ve.archivedAt&&this.archivedThreads.add(ve,this._calculatePosition(ve.archivedAt)),this.listenTo(ve,"change:archivedAt",(ke,Ie,Ae)=>{Ae?this.archivedThreads.has(ve)||this.archivedThreads.add(ve,this._calculatePosition(ve.archivedAt)):this.archivedThreads.has(ve)&&this.archivedThreads.remove(ve)})}),this.listenTo(t,"removeCommentThread",(be,{threadId:xe})=>{const ve=t.getCommentThread(xe);this.stopListening(ve),this.archivedThreads.has(ve)&&this.archivedThreads.remove(ve)},{priority:"highest"}),this.listenTo(te.collection,"focus",(be,xe)=>{xe.isActive=!0,te.activate(xe)})}_calculatePosition(we){const t=[...this.archivedThreads].findIndex(te=>te.archivedAt<we);return t>-1?t:this.archivedThreads.length}},a$7=class extends Plugin{constructor(t){super(t);Re(this,"commentsArchiveView");Re(this,"annotationViews");Re(this,"_pendingThreads");this.annotationViews=new ViewCollection,this._pendingThreads=[]}static get pluginName(){return"CommentsArchiveUI"}static get requires(){return[p$6,Dialog]}init(){this.editor.ui.componentFactory.add("commentsArchive",()=>this._createCommentsArchiveButton(ButtonView,!0)),this.editor.ui.componentFactory.add("menuBar:commentsArchive",()=>this._createCommentsArchiveButton(MenuBarMenuListItemButtonView));const t=this.editor.plugins.get(p$6),te=this.editor.plugins.get("Annotations"),be=this.editor.plugins.get("CommentsRepository");this.listenTo(t.archivedThreads,"add",(xe,ve)=>{const ke=this.editor.config.get("collaboration.channelId");if(!ke||ve.channelId===ke){const Ie=be._threadToController.get(ve);if(!Ie)return void this._pendingThreads.push(ve);const Ae=this._calculatePosition(ve.archivedAt),Se=te.getByInnerView(Ie.view);Se.isVisible&&te._visibleAnnotations.remove(Se),this.annotationViews.add(Se.view,Ae)}}),this.listenTo(te.collection,"add",(xe,ve)=>{const ke=this._pendingThreads.find(Ie=>{const Ae=be._threadToController.get(Ie);return Ae&&ve.innerView===Ae.view});if(ke){const Ie=this._calculatePosition(ke.archivedAt);this.annotationViews.add(ve.view,Ie),this._pendingThreads.splice(this._pendingThreads.indexOf(ke),1)}}),this.listenTo(t.archivedThreads,"remove",(xe,ve)=>{const ke=this.editor.config.get("collaboration.channelId");if(!ke||ve.channelId===ke){const Ie=be._threadToController.get(ve),Ae=te.getByInnerView(Ie.view);this.annotationViews.remove(Ae.view),this.stopListening(Ae.focusableElements)}})}_calculatePosition(t){const te=this.editor.config.get("collaboration.channelId"),be=[...this.editor.plugins.get(p$6).archivedThreads].filter(xe=>xe.channelId===te).findIndex(xe=>xe.archivedAt<t);return be<0||be>this.annotationViews.length?this.annotationViews.length:be-1}_toggleDialog(){const t=this.editor,te=t.plugins.get("Dialog");this.commentsArchiveView||(this.commentsArchiveView=new X$2(t.locale,this.annotationViews)),te.id==="commentsArchive"?te.hide():te.show({id:"commentsArchive",title:W$2(t.locale,"COMMENTS_ARCHIVE"),icon:Q$2,hasCloseButton:!0,content:this.commentsArchiveView,position:DialogViewPosition.EDITOR_TOP_SIDE})}_createCommentsArchiveButton(t,te=!1){const be=this.editor.locale,xe=new t(be);return xe.bind("isEnabled").to(this,"isEnabled"),xe.set({label:W$2(be,"COMMENTS_ARCHIVE"),icon:Q$2}),te&&(xe.tooltip=!0),this.listenTo(xe,"execute",()=>this._toggleDialog()),xe}},f$6=class extends Plugin{static get requires(){return[m$9,r$9,s$8,p$6,a$7,e$5,n$5,i$8,c$6]}static get pluginName(){return"Comments"}};function p$5(Te){let we="";for(const t of Te.getChildren())t instanceof Text&&(we+=t.data);return we}let n$4=class extends Plugin{constructor(){super(...arguments);Re(this,"_headingNames",[])}static get pluginName(){return"DocumentOutlineUtils"}init(){const t=this.editor;this._headingNames=this._getHeadingNames();let te=[];t.model.document.on("change",debounce(()=>{const be=te;te=this._getOutlineDefinitions();const xe=diff$1(be,te,(Ae,Se)=>Ae.level===Se.level&&Ae.text===Se.text&&Ae.modelElement===Se.modelElement),ve=diffToChanges(xe,te),ke=this._getActiveHeading(),Ie=te.findIndex(Ae=>Ae.modelElement===ke);ve.length&&this.fire("change",{outlineDefinitions:te,activeItemIndex:Ie,outlineChanges:ve}),this.fire("activeItemIndex",{index:Ie})},250,{leading:!0,trailing:!0}))}afterInit(){this._headingNames.length||this._deriveHeadingElementsFromConversion()}_getOutlineDefinitions(){const t=this.editor,te=[],be=this._headingNames;for(const ve of t.model.document.getRootNames())xe(t.model.document.getRoot(ve));function xe(ve){for(const ke of ve.getChildren())ke.is("element")&&(be.includes(ke.name)&&te.push({level:be.indexOf(ke.name)+1,text:p$5(ke),modelElement:ke}),xe(ke))}return te}_getActiveHeading(){const t=this.editor.model.document.selection.getFirstPosition(),te=new TreeWalker({direction:"backward",startPosition:t});for(const be of te)if(be.item.is("element")&&this._headingNames.includes(be.item.name))return be.item}_getHeadingNames(){return this.editor.config.get("documentOutline.headings")||function(te){const be=te.config.get("heading.options");return be?be.reduce((xe,ve)=>(ve.model!=="paragraph"&&xe.push(ve.model),xe),[]):te.plugins.has("GeneralHtmlSupport")?["htmlH1","htmlH2","htmlH3","htmlH4","htmlH5","htmlH6"]:[]}(this.editor)}_deriveHeadingElementsFromConversion(){const t=this.editor,te=["h1","h2","h3","h4","h5","h6"],be=[];for(const xe of te){const ve=t.editing.view.domConverter.domToView(document.createElement(xe)),ke=t.data.toModel(ve).getChild(0);ke!=null&&ke.is("element")&&be.push(ke.name)}this._headingNames=be}},j$1=class extends View{constructor(we,t=!1){super(we);const te=we.t,be=this.bindTemplate,xe=t?"["+te("Empty heading")+"]":"";this.set("text",""),this.set("level",1),this.set("isActive",!1),this.bind("isEmpty").to(this,"text",ve=>!ve),this.setTemplate({tag:"div",attributes:{class:["ck","ck-reset","ck-document-outline__item",be.to("level",ve=>"ck-document-outline__item_level-"+ve),be.if("isActive","ck-document-outline__item_active"),be.if("isEmpty","ck-document-outline__item_empty")],title:be.to("text")},children:[{text:be.to("text",ve=>ve||xe)}],on:{click:be.to("click")}})}},h$4=class extends View{constructor(t,te=!1,be){super(t);Re(this,"items");Re(this,"showEmptyHeadingText");Re(this,"_documentOutlineContainer");const xe=t.t;this.showEmptyHeadingText=te,this.set("activeItemIndex",-1),this._documentOutlineContainer=be,this.items=this.createCollection(),this.items.delegate("click").to(this),this.on("click",this._handleItemClick.bind(this)),this.on("change:activeItemIndex",(ve,ke,Ie,Ae)=>{this._setActiveItem(Ae,Ie)}),this.setTemplate({tag:"div",attributes:{class:["ck","ck-reset","ck-document-outline"],dir:t.contentLanguageDirection,"data-document-outline-empty-placeholder":xe("Editor headings will appear here as you type."),tabindex:-1},children:this.items})}sync(t){t.forEach(te=>{te.type=="insert"?this._insertItem(te.index,...te.values):te.type=="delete"&&this._deleteItem(te.index,te.howMany)})}_setActiveItem(t,te){if(t!==-1){const be=this.items.get(t);be&&(be.isActive=!1)}te!==-1&&(this.items.get(te).isActive=!0,this._scrollToItem(te))}_insertItem(t,...te){const be=te.map((xe,ve)=>{const ke=new j$1(this.locale,this.showEmptyHeadingText);return ke.text=xe.text,ke.level=xe.level,t+ve===this.activeItemIndex&&(ke.isActive=!0),ke});this.items.addMany(be,t)}_deleteItem(t,te){do this.items.remove(t);while(--te)}_handleItemClick(t){const te=this.items.getIndex(t.source);this.fire("itemSelected",te)}_scrollToItem(t){scrollAncestorsToShowTarget(this.items.get(t).element,20,this._documentOutlineContainer)}destroy(){super.destroy(),this.element.remove()}},o$7=class extends Plugin{constructor(t){super(t);Re(this,"view");Re(this,"_currentOutlineDefinitions");Re(this,"_updateActiveDefinitionFromViewportThrottled");this.view=new h$4(t.locale,this.editor.config.get("documentOutline.showEmptyHeadings"),this.editor.config.get("documentOutline.container")),this._currentOutlineDefinitions=[],this._updateActiveDefinitionFromViewportThrottled=throttle(this._updateActiveDefinitionOnViewportChange.bind(this),100)}static get pluginName(){return"DocumentOutlineUI"}init(){const t=this.editor,te=t.plugins.get("DocumentOutlineUtils");let be=!1;if(this.view.render(),this.editor.ui.focusTracker.add(this.view.element),!t.config.get("documentOutline.container"))throw new CKEditorError("document-outline-container-not-provided",{editor:t});t.config.get("documentOutline.container").appendChild(this.view.element),te.on("change",this._handleOutlineChange.bind(this)),te.on("activeItemIndex",(xe,{index:ve})=>this._setActiveViewItem(ve)),this.view.on("itemSelected",(xe,ve)=>{be=!0,this._handleItemSelected(ve)}),this.view.listenTo(global.document,"scroll",()=>{be?be=!1:this._updateActiveDefinitionFromViewportThrottled()},{useCapture:!0}),this.view.listenTo(global.window,"resize",this._updateActiveDefinitionFromViewportThrottled,{useCapture:!0})}afterInit(){(function(t){function te(xe,ve,ke){const Ie={};Ie[be([110,117,109,98,101,114,79,102,82,111,117,110,100,115])]={16:10,24:12,32:14},Ie[be([114,99,111,110])]=[1,2,4,8,16,32,64,128,27,54,108,216,171,77,154,47,94,188,99,198,151,53,106,212,179,125,250,239,197,145],Ie[be([83])]=[99,124,119,123,242,107,111,197,48,1,103,43,254,215,171,118,202,130,201,125,250,89,71,240,173,212,162,175,156,164,114,192,183,253,147,38,54,63,247,204,52,165,229,241,113,216,49,21,4,199,35,195,24,150,5,154,7,18,128,226,235,39,178,117,9,131,44,26,27,110,90,160,82,59,214,179,41,227,47,132,83,209,0,237,32,252,177,91,106,203,190,57,74,76,88,207,208,239,170,251,67,77,51,133,69,249,2,127,80,60,159,168,81,163,64,143,146,157,56,245,188,182,218,33,16,255,243,210,205,12,19,236,95,151,68,23,196,167,126,61,100,93,25,115,96,129,79,220,34,42,144,136,70,238,184,20,222,94,11,219,224,50,58,10,73,6,36,92,194,211,172,98,145,149,228,121,231,200,55,109,141,213,78,169,108,86,244,234,101,122,174,8,186,120,37,46,28,166,180,198,232,221,116,31,75,189,139,138,112,62,181,102,72,3,246,14,97,53,87,185,134,193,29,158,225,248,152,17,105,217,142,148,155,30,135,233,206,85,40,223,140,161,137,13,191,230,66,104,65,153,45,15,176,84,187,22],Ie[be([84,49])]=[3328402341,4168907908,4000806809,4135287693,4294111757,3597364157,3731845041,2445657428,1613770832,33620227,3462883241,1445669757,3892248089,3050821474,1303096294,3967186586,2412431941,528646813,2311702848,4202528135,4026202645,2992200171,2387036105,4226871307,1101901292,3017069671,1604494077,1169141738,597466303,1403299063,3832705686,2613100635,1974974402,3791519004,1033081774,1277568618,1815492186,2118074177,4126668546,2211236943,1748251740,1369810420,3521504564,4193382664,3799085459,2883115123,1647391059,706024767,134480908,2512897874,1176707941,2646852446,806885416,932615841,168101135,798661301,235341577,605164086,461406363,3756188221,3454790438,1311188841,2142417613,3933566367,302582043,495158174,1479289972,874125870,907746093,3698224818,3025820398,1537253627,2756858614,1983593293,3084310113,2108928974,1378429307,3722699582,1580150641,327451799,2790478837,3117535592,0,3253595436,1075847264,3825007647,2041688520,3059440621,3563743934,2378943302,1740553945,1916352843,2487896798,2555137236,2958579944,2244988746,3151024235,3320835882,1336584933,3992714006,2252555205,2588757463,1714631509,293963156,2319795663,3925473552,67240454,4269768577,2689618160,2017213508,631218106,1269344483,2723238387,1571005438,2151694528,93294474,1066570413,563977660,1882732616,4059428100,1673313503,2008463041,2950355573,1109467491,537923632,3858759450,4260623118,3218264685,2177748300,403442708,638784309,3287084079,3193921505,899127202,2286175436,773265209,2479146071,1437050866,4236148354,2050833735,3362022572,3126681063,840505643,3866325909,3227541664,427917720,2655997905,2749160575,1143087718,1412049534,999329963,193497219,2353415882,3354324521,1807268051,672404540,2816401017,3160301282,369822493,2916866934,3688947771,1681011286,1949973070,336202270,2454276571,201721354,1210328172,3093060836,2680341085,3184776046,1135389935,3294782118,965841320,831886756,3554993207,4068047243,3588745010,2345191491,1849112409,3664604599,26054028,2983581028,2622377682,1235855840,3630984372,2891339514,4092916743,3488279077,3395642799,4101667470,1202630377,268961816,1874508501,4034427016,1243948399,1546530418,941366308,1470539505,1941222599,2546386513,3421038627,2715671932,3899946140,1042226977,2521517021,1639824860,227249030,260737669,3765465232,2084453954,1907733956,3429263018,2420656344,100860677,4160157185,470683154,3261161891,1781871967,2924959737,1773779408,394692241,2579611992,974986535,664706745,3655459128,3958962195,731420851,571543859,3530123707,2849626480,126783113,865375399,765172662,1008606754,361203602,3387549984,2278477385,2857719295,1344809080,2782912378,59542671,1503764984,160008576,437062935,1707065306,3622233649,2218934982,3496503480,2185314755,697932208,1512910199,504303377,2075177163,2824099068,1841019862,739644986],Ie[be([84,50])]=[2781242211,2230877308,2582542199,2381740923,234877682,3184946027,2984144751,1418839493,1348481072,50462977,2848876391,2102799147,434634494,1656084439,3863849899,2599188086,1167051466,2636087938,1082771913,2281340285,368048890,3954334041,3381544775,201060592,3963727277,1739838676,4250903202,3930435503,3206782108,4149453988,2531553906,1536934080,3262494647,484572669,2923271059,1783375398,1517041206,1098792767,49674231,1334037708,1550332980,4098991525,886171109,150598129,2481090929,1940642008,1398944049,1059722517,201851908,1385547719,1699095331,1587397571,674240536,2704774806,252314885,3039795866,151914247,908333586,2602270848,1038082786,651029483,1766729511,3447698098,2682942837,454166793,2652734339,1951935532,775166490,758520603,3000790638,4004797018,4217086112,4137964114,1299594043,1639438038,3464344499,2068982057,1054729187,1901997871,2534638724,4121318227,1757008337,0,750906861,1614815264,535035132,3363418545,3988151131,3201591914,1183697867,3647454910,1265776953,3734260298,3566750796,3903871064,1250283471,1807470800,717615087,3847203498,384695291,3313910595,3617213773,1432761139,2484176261,3481945413,283769337,100925954,2180939647,4037038160,1148730428,3123027871,3813386408,4087501137,4267549603,3229630528,2315620239,2906624658,3156319645,1215313976,82966005,3747855548,3245848246,1974459098,1665278241,807407632,451280895,251524083,1841287890,1283575245,337120268,891687699,801369324,3787349855,2721421207,3431482436,959321879,1469301956,4065699751,2197585534,1199193405,2898814052,3887750493,724703513,2514908019,2696962144,2551808385,3516813135,2141445340,1715741218,2119445034,2872807568,2198571144,3398190662,700968686,3547052216,1009259540,2041044702,3803995742,487983883,1991105499,1004265696,1449407026,1316239930,504629770,3683797321,168560134,1816667172,3837287516,1570751170,1857934291,4014189740,2797888098,2822345105,2754712981,936633572,2347923833,852879335,1133234376,1500395319,3084545389,2348912013,1689376213,3533459022,3762923945,3034082412,4205598294,133428468,634383082,2949277029,2398386810,3913789102,403703816,3580869306,2297460856,1867130149,1918643758,607656988,4049053350,3346248884,1368901318,600565992,2090982877,2632479860,557719327,3717614411,3697393085,2249034635,2232388234,2430627952,1115438654,3295786421,2865522278,3633334344,84280067,33027830,303828494,2747425121,1600795957,4188952407,3496589753,2434238086,1486471617,658119965,3106381470,953803233,334231800,3005978776,857870609,3151128937,1890179545,2298973838,2805175444,3056442267,574365214,2450884487,550103529,1233637070,4289353045,2018519080,2057691103,2399374476,4166623649,2148108681,387583245,3664101311,836232934,3330556482,3100665960,3280093505,2955516313,2002398509,287182607,3413881008,4238890068,3597515707,975967766],Ie[be([84,51])]=[1671808611,2089089148,2006576759,2072901243,4061003762,1807603307,1873927791,3310653893,810573872,16974337,1739181671,729634347,4263110654,3613570519,2883997099,1989864566,3393556426,2191335298,3376449993,2106063485,4195741690,1508618841,1204391495,4027317232,2917941677,3563566036,2734514082,2951366063,2629772188,2767672228,1922491506,3227229120,3082974647,4246528509,2477669779,644500518,911895606,1061256767,4144166391,3427763148,878471220,2784252325,3845444069,4043897329,1905517169,3631459288,827548209,356461077,67897348,3344078279,593839651,3277757891,405286936,2527147926,84871685,2595565466,118033927,305538066,2157648768,3795705826,3945188843,661212711,2999812018,1973414517,152769033,2208177539,745822252,439235610,455947803,1857215598,1525593178,2700827552,1391895634,994932283,3596728278,3016654259,695947817,3812548067,795958831,2224493444,1408607827,3513301457,0,3979133421,543178784,4229948412,2982705585,1542305371,1790891114,3410398667,3201918910,961245753,1256100938,1289001036,1491644504,3477767631,3496721360,4012557807,2867154858,4212583931,1137018435,1305975373,861234739,2241073541,1171229253,4178635257,33948674,2139225727,1357946960,1011120188,2679776671,2833468328,1374921297,2751356323,1086357568,2408187279,2460827538,2646352285,944271416,4110742005,3168756668,3066132406,3665145818,560153121,271589392,4279952895,4077846003,3530407890,3444343245,202643468,322250259,3962553324,1608629855,2543990167,1154254916,389623319,3294073796,2817676711,2122513534,1028094525,1689045092,1575467613,422261273,1939203699,1621147744,2174228865,1339137615,3699352540,577127458,712922154,2427141008,2290289544,1187679302,3995715566,3100863416,339486740,3732514782,1591917662,186455563,3681988059,3762019296,844522546,978220090,169743370,1239126601,101321734,611076132,1558493276,3260915650,3547250131,2901361580,1655096418,2443721105,2510565781,3828863972,2039214713,3878868455,3359869896,928607799,1840765549,2374762893,3580146133,1322425422,2850048425,1823791212,1459268694,4094161908,3928346602,1706019429,2056189050,2934523822,135794696,3134549946,2022240376,628050469,779246638,472135708,2800834470,3032970164,3327236038,3894660072,3715932637,1956440180,522272287,1272813131,3185336765,2340818315,2323976074,1888542832,1044544574,3049550261,1722469478,1222152264,50660867,4127324150,236067854,1638122081,895445557,1475980887,3117443513,2257655686,3243809217,489110045,2662934430,3778599393,4162055160,2561878936,288563729,1773916777,3648039385,2391345038,2493985684,2612407707,505560094,2274497927,3911240169,3460925390,1442818645,678973480,3749357023,2358182796,2717407649,2306869641,219617805,3218761151,3862026214,1120306242,1756942440,1103331905,2578459033,762796589,252780047,2966125488,1425844308,3151392187,372911126],Ie[be([84,52])]=[1667474886,2088535288,2004326894,2071694838,4075949567,1802223062,1869591006,3318043793,808472672,16843522,1734846926,724270422,4278065639,3621216949,2880169549,1987484396,3402253711,2189597983,3385409673,2105378810,4210693615,1499065266,1195886990,4042263547,2913856577,3570689971,2728590687,2947541573,2627518243,2762274643,1920112356,3233831835,3082273397,4261223649,2475929149,640051788,909531756,1061110142,4160160501,3435941763,875846760,2779116625,3857003729,4059105529,1903268834,3638064043,825316194,353713962,67374088,3351728789,589522246,3284360861,404236336,2526454071,84217610,2593830191,117901582,303183396,2155911963,3806477791,3958056653,656894286,2998062463,1970642922,151591698,2206440989,741110872,437923380,454765878,1852748508,1515908788,2694904667,1381168804,993742198,3604373943,3014905469,690584402,3823320797,791638366,2223281939,1398011302,3520161977,0,3991743681,538992704,4244381667,2981218425,1532751286,1785380564,3419096717,3200178535,960056178,1246420628,1280103576,1482221744,3486468741,3503319995,4025428677,2863326543,4227536621,1128514950,1296947098,859002214,2240123921,1162203018,4193849577,33687044,2139062782,1347481760,1010582648,2678045221,2829640523,1364325282,2745433693,1077985408,2408548869,2459086143,2644360225,943212656,4126475505,3166494563,3065430391,3671750063,555836226,269496352,4294908645,4092792573,3537006015,3452783745,202118168,320025894,3974901699,1600119230,2543297077,1145359496,387397934,3301201811,2812801621,2122220284,1027426170,1684319432,1566435258,421079858,1936954854,1616945344,2172753945,1330631070,3705438115,572679748,707427924,2425400123,2290647819,1179044492,4008585671,3099120491,336870440,3739122087,1583276732,185277718,3688593069,3772791771,842159716,976899700,168435220,1229577106,101059084,606366792,1549591736,3267517855,3553849021,2897014595,1650632388,2442242105,2509612081,3840161747,2038008818,3890688725,3368567691,926374254,1835907034,2374863873,3587531953,1313788572,2846482505,1819063512,1448540844,4109633523,3941213647,1701162954,2054852340,2930698567,134748176,3132806511,2021165296,623210314,774795868,471606328,2795958615,3031746419,3334885783,3907527627,3722280097,1953799400,522133822,1263263126,3183336545,2341176845,2324333839,1886425312,1044267644,3048588401,1718004428,1212733584,50529542,4143317495,235803164,1633788866,892690282,1465383342,3115962473,2256965911,3250673817,488449850,2661202215,3789633753,4177007595,2560144171,286339874,1768537042,3654906025,2391705863,2492770099,2610673197,505291324,2273808917,3924369609,3469625735,1431699370,673740880,3755965093,2358021891,2711746649,2307489801,218961690,3217021541,3873845719,1111672452,1751693520,1094828930,2576986153,757954394,252645662,2964376443,1414855848,3149649517,370555436],Ie[be([85,49])]=[0,235474187,470948374,303765277,941896748,908933415,607530554,708780849,1883793496,2118214995,1817866830,1649639237,1215061108,1181045119,1417561698,1517767529,3767586992,4003061179,4236429990,4069246893,3635733660,3602770327,3299278474,3400528769,2430122216,2664543715,2362090238,2193862645,2835123396,2801107407,3035535058,3135740889,3678124923,3576870512,3341394285,3374361702,3810496343,3977675356,4279080257,4043610186,2876494627,2776292904,3076639029,3110650942,2472011535,2640243204,2403728665,2169303058,1001089995,899835584,666464733,699432150,59727847,226906860,530400753,294930682,1273168787,1172967064,1475418501,1509430414,1942435775,2110667444,1876241833,1641816226,2910219766,2743034109,2976151520,3211623147,2505202138,2606453969,2302690252,2269728455,3711829422,3543599269,3240894392,3475313331,3843699074,3943906441,4178062228,4144047775,1306967366,1139781709,1374988112,1610459739,1975683434,2076935265,1775276924,1742315127,1034867998,866637845,566021896,800440835,92987698,193195065,429456164,395441711,1984812685,2017778566,1784663195,1683407248,1315562145,1080094634,1383856311,1551037884,101039829,135050206,437757123,337553864,1042385657,807962610,573804783,742039012,2531067453,2564033334,2328828971,2227573024,2935566865,2700099354,3001755655,3168937228,3868552805,3902563182,4203181171,4102977912,3736164937,3501741890,3265478751,3433712980,1106041591,1340463100,1576976609,1408749034,2043211483,2009195472,1708848333,1809054150,832877231,1068351396,766945465,599762354,159417987,126454664,361929877,463180190,2709260871,2943682380,3178106961,3009879386,2572697195,2538681184,2236228733,2336434550,3509871135,3745345300,3441850377,3274667266,3910161971,3877198648,4110568485,4211818798,2597806476,2497604743,2261089178,2295101073,2733856160,2902087851,3202437046,2968011453,3936291284,3835036895,4136440770,4169408201,3535486456,3702665459,3467192302,3231722213,2051518780,1951317047,1716890410,1750902305,1113818384,1282050075,1584504582,1350078989,168810852,67556463,371049330,404016761,841739592,1008918595,775550814,540080725,3969562369,3801332234,4035489047,4269907996,3569255213,3669462566,3366754619,3332740144,2631065433,2463879762,2160117071,2395588676,2767645557,2868897406,3102011747,3069049960,202008497,33778362,270040487,504459436,875451293,975658646,675039627,641025152,2084704233,1917518562,1615861247,1851332852,1147550661,1248802510,1484005843,1451044056,933301370,967311729,733156972,632953703,260388950,25965917,328671808,496906059,1206477858,1239443753,1543208500,1441952575,2144161806,1908694277,1675577880,1842759443,3610369226,3644379585,3408119516,3307916247,4011190502,3776767469,4077384432,4245618683,2809771154,2842737049,3144396420,3043140495,2673705150,2438237621,2203032232,2370213795],Ie[be([85,50])]=[0,185469197,370938394,487725847,741876788,657861945,975451694,824852259,1483753576,1400783205,1315723890,1164071807,1950903388,2135319889,1649704518,1767536459,2967507152,3152976349,2801566410,2918353863,2631447780,2547432937,2328143614,2177544179,3901806776,3818836405,4270639778,4118987695,3299409036,3483825537,3535072918,3652904859,2077965243,1893020342,1841768865,1724457132,1474502543,1559041666,1107234197,1257309336,598438867,681933534,901210569,1052338372,261314535,77422314,428819965,310463728,3409685355,3224740454,3710368113,3593056380,3875770207,3960309330,4045380933,4195456072,2471224067,2554718734,2237133081,2388260884,3212035895,3028143674,2842678573,2724322336,4138563181,4255350624,3769721975,3955191162,3667219033,3516619604,3431546947,3347532110,2933734917,2782082824,3099667487,3016697106,2196052529,2313884476,2499348523,2683765030,1179510461,1296297904,1347548327,1533017514,1786102409,1635502980,2087309459,2003294622,507358933,355706840,136428751,53458370,839224033,957055980,605657339,790073846,2373340630,2256028891,2607439820,2422494913,2706270690,2856345839,3075636216,3160175349,3573941694,3725069491,3273267108,3356761769,4181598602,4063242375,4011996048,3828103837,1033297158,915985419,730517276,545572369,296679730,446754879,129166120,213705253,1709610350,1860738147,1945798516,2029293177,1239331162,1120974935,1606591296,1422699085,4148292826,4233094615,3781033664,3931371469,3682191598,3497509347,3446004468,3328955385,2939266226,2755636671,3106780840,2988687269,2198438022,2282195339,2501218972,2652609425,1201765386,1286567175,1371368976,1521706781,1805211710,1620529459,2105887268,1988838185,533804130,350174575,164439672,46346101,870912086,954669403,636813900,788204353,2358957921,2274680428,2592523643,2441661558,2695033685,2880240216,3065962831,3182487618,3572145929,3756299780,3270937875,3388507166,4174560061,4091327024,4006521127,3854606378,1014646705,930369212,711349675,560487590,272786309,457992840,106852767,223377554,1678381017,1862534868,1914052035,2031621326,1211247597,1128014560,1580087799,1428173050,32283319,182621114,401639597,486441376,768917123,651868046,1003007129,818324884,1503449823,1385356242,1333838021,1150208456,1973745387,2125135846,1673061617,1756818940,2970356327,3120694122,2802849917,2887651696,2637442643,2520393566,2334669897,2149987652,3917234703,3799141122,4284502037,4100872472,3309594171,3460984630,3545789473,3629546796,2050466060,1899603969,1814803222,1730525723,1443857720,1560382517,1075025698,1260232239,575138148,692707433,878443390,1062597235,243256656,91341917,409198410,325965383,3403100636,3252238545,3704300486,3620022987,3874428392,3990953189,4042459122,4227665663,2460449204,2578018489,2226875310,2411029155,3198115200,3046200461,2827177882,2743944855],Ie[be([85,51])]=[0,218828297,437656594,387781147,875313188,958871085,775562294,590424639,1750626376,1699970625,1917742170,2135253587,1551124588,1367295589,1180849278,1265195639,3501252752,3720081049,3399941250,3350065803,3835484340,3919042237,4270507174,4085369519,3102249176,3051593425,2734591178,2952102595,2361698556,2177869557,2530391278,2614737639,3145456443,3060847922,2708326185,2892417312,2404901663,2187128086,2504130317,2555048196,3542330227,3727205754,3375740769,3292445032,3876557655,3926170974,4246310725,4027744588,1808481195,1723872674,1910319033,2094410160,1608975247,1391201670,1173430173,1224348052,59984867,244860394,428169201,344873464,935293895,984907214,766078933,547512796,1844882806,1627235199,2011214180,2062270317,1507497298,1423022939,1137477952,1321699145,95345982,145085239,532201772,313773861,830661914,1015671571,731183368,648017665,3175501286,2957853679,2807058932,2858115069,2305455554,2220981195,2474404304,2658625497,3575528878,3625268135,3473416636,3254988725,3778151818,3963161475,4213447064,4130281361,3599595085,3683022916,3432737375,3247465558,3802222185,4020912224,4172763771,4122762354,3201631749,3017672716,2764249623,2848461854,2331590177,2280796200,2431590963,2648976442,104699613,188127444,472615631,287343814,840019705,1058709744,671593195,621591778,1852171925,1668212892,1953757831,2037970062,1514790577,1463996600,1080017571,1297403050,3673637356,3623636965,3235995134,3454686199,4007360968,3822090177,4107101658,4190530515,2997825956,3215212461,2830708150,2779915199,2256734592,2340947849,2627016082,2443058075,172466556,122466165,273792366,492483431,1047239e3,861968209,612205898,695634755,1646252340,1863638845,2013908262,1963115311,1446242576,1530455833,1277555970,1093597963,1636604631,1820824798,2073724613,1989249228,1436590835,1487645946,1337376481,1119727848,164948639,81781910,331544205,516552836,1039717051,821288114,669961897,719700128,2973530695,3157750862,2871682645,2787207260,2232435299,2283490410,2667994737,2450346104,3647212047,3564045318,3279033885,3464042516,3980931627,3762502690,4150144569,4199882800,3070356634,3121275539,2904027272,2686254721,2200818878,2384911031,2570832044,2486224549,3747192018,3528626907,3310321856,3359936201,3950355702,3867060991,4049844452,4234721005,1739656202,1790575107,2108100632,1890328081,1402811438,1586903591,1233856572,1149249077,266959938,48394827,369057872,418672217,1002783846,919489135,567498868,752375421,209336225,24197544,376187827,459744698,945164165,895287692,574624663,793451934,1679968233,1764313568,2117360635,1933530610,1343127501,1560637892,1243112415,1192455638,3704280881,3519142200,3336358691,3419915562,3907448597,3857572124,4075877127,4294704398,3029510009,3113855344,2927934315,2744104290,2159976285,2377486676,2594734927,2544078150],Ie[be([85,52])]=[0,151849742,303699484,454499602,607398968,758720310,908999204,1059270954,1214797936,1097159550,1517440620,1400849762,1817998408,1699839814,2118541908,2001430874,2429595872,2581445614,2194319100,2345119218,3034881240,3186202582,2801699524,2951971274,3635996816,3518358430,3399679628,3283088770,4237083816,4118925222,4002861748,3885750714,1002142683,850817237,698445255,548169417,529487843,377642221,227885567,77089521,1943217067,2061379749,1640576439,1757691577,1474760595,1592394909,1174215055,1290801793,2875968315,2724642869,3111247143,2960971305,2405426947,2253581325,2638606623,2487810577,3808662347,3926825029,4044981591,4162096729,3342319475,3459953789,3576539503,3693126241,1986918061,2137062819,1685577905,1836772287,1381620373,1532285339,1078185097,1229899655,1040559837,923313619,740276417,621982671,439452389,322734571,137073913,19308535,3871163981,4021308739,4104605777,4255800159,3263785589,3414450555,3499326569,3651041127,2933202493,2815956275,3167684641,3049390895,2330014213,2213296395,2566595609,2448830231,1305906550,1155237496,1607244650,1455525988,1776460110,1626319424,2079897426,1928707164,96392454,213114376,396673818,514443284,562755902,679998e3,865136418,983426092,3708173718,3557504664,3474729866,3323011204,4180808110,4030667424,3945269170,3794078908,2507040230,2623762152,2272556026,2390325492,2975484382,3092726480,2738905026,2857194700,3973773121,3856137295,4274053469,4157467219,3371096953,3252932727,3673476453,3556361835,2763173681,2915017791,3064510765,3215307299,2156299017,2307622919,2459735317,2610011675,2081048481,1963412655,1846563261,1729977011,1480485785,1362321559,1243905413,1126790795,878845905,1030690015,645401037,796197571,274084841,425408743,38544885,188821243,3613494426,3731654548,3313212038,3430322568,4082475170,4200115116,3780097726,3896688048,2668221674,2516901860,2366882550,2216610296,3141400786,2989552604,2837966542,2687165888,1202797690,1320957812,1437280870,1554391400,1669664834,1787304780,1906247262,2022837584,265905162,114585348,499347990,349075736,736970802,585122620,972512814,821712160,2595684844,2478443234,2293045232,2174754046,3196267988,3079546586,2895723464,2777952454,3537852828,3687994002,3234156416,3385345166,4142626212,4293295786,3841024952,3992742070,174567692,57326082,410887952,292596766,777231668,660510266,1011452712,893681702,1108339068,1258480242,1343618912,1494807662,1715193156,1865862730,1948373848,2100090966,2701949495,2818666809,3004591147,3122358053,2235061775,2352307457,2535604243,2653899549,3915653703,3764988233,4219352155,4067639125,3444575871,3294430577,3746175075,3594982253,836553431,953270745,600235211,718002117,367585007,484830689,133361907,251657213,2041877159,1891211689,1806599355,1654886325,1568718495,1418573201,1335535747,1184342925];const Ae=new Uint8Array(16);for(let He=15;He>=0;--He)Ae[He]=ke%256,ke=parseInt(ke/256);let Se=null,Oe=16;const Ve=new Uint8Array(ve),Me=[],De=[];Ue();for(let He=0;He<xe[be([108,101,110,103,116,104])];He++)Oe===16&&(Se=$e(Ae),Oe=0,Be(Ae)),xe[He]^=Se[Oe++];return xe;function Fe(He){const ze=[];for(let qe=0;qe<He[be([108,101,110,103,116,104])];qe+=4)ze[be([112,117,115,104])](He[qe]<<24|He[qe+1]<<16|He[qe+2]<<8|He[qe+3]);return ze}function Be(He){for(let ze=15;ze>=0;ze--){if(He[ze]!==255){He[ze]++;break}He[ze]=0}}function $e(He){const ze=Me[be([108,101,110,103,116,104])]-1,qe=[0,0,0,0];let Ke=Fe(He);for(let Ye=0;Ye<4;Ye++)Ke[Ye]^=Me[0][Ye];for(let Ye=1;Ye<ze;Ye++){for(let ht=0;ht<4;ht++)qe[ht]=Ie[be([84,49])][Ke[ht]>>24&255]^Ie[be([84,50])][Ke[(ht+1)%4]>>16&255]^Ie[be([84,51])][Ke[(ht+2)%4]>>8&255]^Ie[be([84,52])][255&Ke[(ht+3)%4]]^Me[Ye][ht];Ke=qe[be([115,108,105,99,101])]()}const Qe=new Uint8Array(16);let je;for(let Ye=0;Ye<4;Ye++)je=Me[ze][Ye],Qe[4*Ye]=255&(Ie[be([83])][Ke[Ye]>>24&255]^je>>24),Qe[4*Ye+1]=255&(Ie[be([83])][Ke[(Ye+1)%4]>>16&255]^je>>16),Qe[4*Ye+2]=255&(Ie[be([83])][Ke[(Ye+2)%4]>>8&255]^je>>8),Qe[4*Ye+3]=255&(Ie[be([83])][255&Ke[(Ye+3)%4]]^je);return Qe}function Ue(){const He=Ie[be([110,117,109,98,101,114,79,102,82,111,117,110,100,115])][Ve[be([108,101,110,103,116,104])]];for(let Ze=0;Ze<=He;Ze++)Me[be([112,117,115,104])]([0,0,0,0]),De[be([112,117,115,104])]([0,0,0,0]);const ze=4*(He+1),qe=Ve[be([108,101,110,103,116,104])]/4,Ke=Fe(Ve);let Qe;for(let Ze=0;Ze<qe;Ze++)Qe=Ze>>2,Me[Qe][Ze%4]=Ke[Ze],De[He-Qe][Ze%4]=Ke[Ze];let je,Ye=0,ht=qe;for(;ht<ze;){je=Ke[qe-1],Ke[0]^=Ie[be([83])][je>>16&255]<<24^Ie[be([83])][je>>8&255]<<16^Ie[be([83])][255&je]<<8^Ie[be([83])][je>>24&255]^Ie[be([114,99,111,110])][Ye]<<24,Ye+=1;for(let Yt=1;Yt<qe/2;Yt++)Ke[Yt]^=Ke[Yt-1];je=Ke[qe/2-1],Ke[qe/2]^=Ie[be([83])][255&je]^Ie[be([83])][je>>8&255]<<8^Ie[be([83])][je>>16&255]<<16^Ie[be([83])][je>>24&255]<<24;for(let Yt=qe/2+1;Yt<qe;Yt++)Ke[Yt]^=Ke[Yt-1];let Ze,Bt,Jt=0;for(;Jt<qe&&ht<ze;)Ze=ht>>2,Bt=ht%4,Me[Ze][Bt]=Ke[Jt],De[He-Ze][Bt]=Ke[Jt++],ht++}for(let Ze=1;Ze<He;Ze++)for(let Bt=0;Bt<4;Bt++)je=De[Ze][Bt],De[Ze][Bt]=Ie[be([85,49])][je>>24&255]^Ie[be([85,50])][je>>16&255]^Ie[be([85,51])][je>>8&255]^Ie[be([85,52])][255&je]}}function be(xe){return xe.map(ve=>String.fromCharCode(ve)).join("")}(xe=>{function ve(){const Ne=[{[be([105,100])]:1,[be([102,101,97,116,117,114,101,78,97,109,101])]:be([67,111,109,109,101,110,116,115]),[be([112,108,117,103,105,110,78,97,109,101])]:be([67,111,109,109,101,110,116,115,82,101,112,111,115,105,116,111,114,121]),[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:be([108,105,99,101,110,115,101,75,101,121]),[be([104,97,110,100,108,101,114])]:be([99,104,101,99,107,76,105,99,101,110,115,101]),[be([99,104,101,99,107,65,108,115,111])]:[{[be([105,100])]:2,[be([102,101,97,116,117,114,101,78,97,109,101])]:be([84,114,97,99,107,32,67,104,97,110,103,101,115]),[be([112,108,117,103,105,110,78,97,109,101])]:be([84,114,97,99,107,67,104,97,110,103,101,115,69,100,105,116,105,110,103]),[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:be([108,105,99,101,110,115,101,75,101,121]),[be([104,97,110,100,108,101,114])]:be([99,104,101,99,107,76,105,99,101,110,115,101,70,111,114,84,114,97,99,107,67,104,97,110,103,101,115]),[be([111,112,116,105,111,110,115])]:{[be([97,105,119,115,103,105,99])]:!0,[be([97,105,116,99,100,103,105,108])]:!0,[be([97,105,114,118,105,105,108])]:!0}}],[be([111,112,116,105,111,110,115])]:{[be([97,105,119,115,103,105,99])]:!0,[be([97,105,116,99,100,103,105,108])]:!0,[be([97,105,114,118,105,105,108])]:!0}},{[be([105,100])]:3,[be([102,101,97,116,117,114,101,78,97,109,101])]:be([80,97,103,105,110,97,116,105,111,110]),[be([112,108,117,103,105,110,78,97,109,101])]:be([80,97,103,105,110,97,116,105,111,110,76,111,111,107,117,112]),[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:be([112,97,103,105,110,97,116,105,111,110,76,105,99,101,110,115,101,75,101,121]),[be([104,97,110,100,108,101,114])]:be([99,104,101,99,107,76,105,99,101,110,115,101])},{[be([105,100])]:4,[be([102,101,97,116,117,114,101,78,97,109,101])]:be([82,101,118,105,115,105,111,110,32,72,105,115,116,111,114,121]),[be([112,108,117,103,105,110,78,97,109,101])]:be([82,101,118,105,115,105,111,110,115,82,101,112,111,115,105,116,111,114,121]),[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:be([108,105,99,101,110,115,101,75,101,121]),[be([104,97,110,100,108,101,114])]:be([99,104,101,99,107,76,105,99,101,110,115,101,70,111,114,82,101,118,105,115,105,111,110,72,105,115,116,111,114,121]),[be([111,112,116,105,111,110,115])]:{[be([97,105,119,115,103,105,99])]:!0,[be([97,105,116,99,100,103,105,108])]:!0,[be([97,105,114,118,105,105,108])]:!0}},{[be([105,100])]:5,[be([102,101,97,116,117,114,101,78,97,109,101])]:be([68,111,99,117,109,101,110,116,32,79,117,116,108,105,110,101]),[be([112,108,117,103,105,110,78,97,109,101])]:be([68,111,99,117,109,101,110,116,79,117,116,108,105,110,101,85,73]),[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:be([100,111,99,117,109,101,110,116,79,117,116,108,105,110,101,76,105,99,101,110,115,101,75,101,121]),[be([104,97,110,100,108,101,114])]:be([99,104,101,99,107,76,105,99,101,110,115,101]),[be([111,112,116,105,111,110,115])]:{[be([102,103,105])]:[12]}},{[be([105,100])]:6,[be([102,101,97,116,117,114,101,78,97,109,101])]:be([70,111,114,109,97,116,32,80,97,105,110,116,101,114]),[be([112,108,117,103,105,110,78,97,109,101])]:be([70,111,114,109,97,116,80,97,105,110,116,101,114,85,73]),[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:be([102,111,114,109,97,116,80,97,105,110,116,101,114,76,105,99,101,110,115,101,75,101,121]),[be([104,97,110,100,108,101,114])]:be([99,104,101,99,107,76,105,99,101,110,115,101]),[be([111,112,116,105,111,110,115])]:{[be([102,103,105])]:[12]}},{[be([105,100])]:7,[be([102,101,97,116,117,114,101,78,97,109,101])]:be([83,108,97,115,104,32,67,111,109,109,97,110,100]),[be([112,108,117,103,105,110,78,97,109,101])]:be([83,108,97,115,104,67,111,109,109,97,110,100,85,73]),[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:be([115,108,97,115,104,67,111,109,109,97,110,100,76,105,99,101,110,115,101,75,101,121]),[be([104,97,110,100,108,101,114])]:be([99,104,101,99,107,76,105,99,101,110,115,101]),[be([111,112,116,105,111,110,115])]:{[be([102,103,105])]:[12]}},{[be([105,100])]:8,[be([102,101,97,116,117,114,101,78,97,109,101])]:be([84,97,98,108,101,32,111,102,32,67,111,110,116,101,110,116,115]),[be([112,108,117,103,105,110,78,97,109,101])]:be([84,97,98,108,101,79,102,67,111,110,116,101,110,116,115,69,100,105,116,105,110,103]),[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:be([116,97,98,108,101,79,102,67,111,110,116,101,110,116,115,76,105,99,101,110,115,101,75,101,121]),[be([104,97,110,100,108,101,114])]:be([99,104,101,99,107,76,105,99,101,110,115,101]),[be([111,112,116,105,111,110,115])]:{[be([102,103,105])]:[12]}},{[be([105,100])]:9,[be([102,101,97,116,117,114,101,78,97,109,101])]:be([84,101,109,112,108,97,116,101]),[be([112,108,117,103,105,110,78,97,109,101])]:be([84,101,109,112,108,97,116,101,85,73]),[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:be([116,101,109,112,108,97,116,101,76,105,99,101,110,115,101,75,101,121]),[be([104,97,110,100,108,101,114])]:be([99,104,101,99,107,76,105,99,101,110,115,101]),[be([111,112,116,105,111,110,115])]:{[be([102,103,105])]:[12,14]}},{[be([105,100])]:10,[be([102,101,97,116,117,114,101,78,97,109,101])]:be([80,97,115,116,101,32,102,114,111,109,32,79,102,102,105,99,101,32,69,110,104,97,110,99,101,100]),[be([112,108,117,103,105,110,78,97,109,101])]:be([80,97,115,116,101,70,114,111,109,79,102,102,105,99,101,69,110,104,97,110,99,101,100,73,110,108,105,110,101,114]),[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:be([112,97,115,116,101,70,114,111,109,79,102,102,105,99,101,69,110,104,97,110,99,101,100,76,105,99,101,110,115,101,75,101,121]),[be([104,97,110,100,108,101,114])]:be([99,104,101,99,107,76,105,99,101,110,115,101]),[be([111,112,116,105,111,110,115])]:{[be([102,103,105])]:[12]}},{[be([105,100])]:11,[be([102,101,97,116,117,114,101,78,97,109,101])]:be([65,73,32,65,115,115,105,115,116,97,110,116]),[be([112,108,117,103,105,110,78,97,109,101])]:be([65,73,65,115,115,105,115,116,97,110,116,85,73]),[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:be([97,105,76,105,99,101,110,115,101,75,101,121]),[be([104,97,110,100,108,101,114])]:be([99,104,101,99,107,76,105,99,101,110,115,101])},{[be([105,100])]:12,[be([102,101,97,116,117,114,101,78,97,109,101])]:be([80,114,111,100,117,99,116,105,118,105,116,121,32,112,97,99,107])},{[be([105,100])]:13,[be([102,101,97,116,117,114,101,78,97,109,101])]:be([67,97,115,101,32,67,104,97,110,103,101]),[be([112,108,117,103,105,110,78,97,109,101])]:be([67,97,115,101,67,104,97,110,103,101,85,73]),[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:be([99,97,115,101,67,104,97,110,103,101,76,105,99,101,110,115,101,75,101,121]),[be([104,97,110,100,108,101,114])]:be([99,104,101,99,107,76,105,99,101,110,115,101]),[be([111,112,116,105,111,110,115])]:{[be([102,103,105])]:[12]}},{[be([105,100])]:14,[be([102,101,97,116,117,114,101,78,97,109,101])]:be([68,114,117,112,97,108,32,112,97,99,107]),[be([102,111,114,98,105,100,100,101,110,72,97,110,100,108,101,114])]:be([102,111,114,98,105,100,100,101,110,72,97,110,100,108,101,114,70,111,114,68,114,117,112,97,108])},{[be([105,100])]:15,[be([102,101,97,116,117,114,101,78,97,109,101])]:be([77,117,108,116,105,32,76,101,118,101,108,32,76,105,115,116]),[be([112,108,117,103,105,110,78,97,109,101])]:be([77,117,108,116,105,76,101,118,101,108,76,105,115,116,69,100,105,116,105,110,103]),[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:be([109,117,108,116,105,76,101,118,101,108,76,105,115,116,76,105,99,101,110,115,101,75,101,121]),[be([104,97,110,100,108,101,114])]:be([99,104,101,99,107,76,105,99,101,110,115,101])},{[be([105,100])]:16,[be([102,101,97,116,117,114,101,78,97,109,101])]:be([77,101,114,103,101,32,70,105,101,108,100,115]),[be([112,108,117,103,105,110,78,97,109,101])]:be([77,101,114,103,101,70,105,101,108,100,115,85,73]),[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:be([109,101,114,103,101,70,105,101,108,100,115,76,105,99,101,110,115,101,75,101,121]),[be([104,97,110,100,108,101,114])]:be([99,104,101,99,107,76,105,99,101,110,115,101]),[be([111,112,116,105,111,110,115])]:{[be([102,103,105])]:[12]}}];return We(Ne),Ne;function Le(Je){return 1<<Je-1}function We(Je){Je[be([102,111,114,69,97,99,104])](Wt=>{Wt[be([112,101,114,109,105,115,115,105,111,110,77,97,115,107])]=Le(Wt[be([105,100])]),ke(Wt)&&Wt[be([99,104,101,99,107,65,108,115,111])]&&We(Wt[be([99,104,101,99,107,65,108,115,111])])})}}function ke(Ne){return be([112,108,117,103,105,110,78,97,109,101])in Ne}const Ie=[1,85,78,115,198,255,50,112,83,87,161],Ae=[127,34,6,211,167,86,146,199,132,160,18];function Se(Ne){const Le=[29,221,175,90,231,133,239,240,75,180];return Oe(Ne,new Uint8Array([...Ie,...Le,...Ae]))}function Oe(Ne,Le){const We=Ve(Ne),Je=Array[be([102,114,111,109])](Ge(We)),Wt=Je[be([112,111,112])](),nn=Je[be([112,111,112])]();return pn(te(Je,Le,nn+256*Wt))}function Ve(Ne){const Le=atob(Ne),[We,Je]=Le[be([115,112,108,105,116])](be([45]));try{if(atob(Je))return atob(We)}catch{}return Le}function Me(Ne){try{const Le=Se(Ne),We=JSON[be([112,97,114,115,101])](Le),Je=parseInt(We[be([49])]),Wt=We[be([50])]||"",nn=parseInt(We[be([51])]),cn=parseInt(We[be([52])])||0,fn=parseInt(We[be([53])])||0;return{[be([112,114,111,100,117,99,116,78,97,109,101])]:Wt,[be([97,108,108,111,119,101,100,80,108,117,103,105,110,115])]:cn,[be([101,120,112,105,114,97,116,105,111,110,68,97,116,101])]:Je,[be([105,115,84,114,105,97,108])]:nn,[be([105,115,73,110,116,101,114,110,97,108])]:fn}}catch{return null}}const De=ve(),Fe={[be([99,104,101,99,107,76,105,99,101,110,115,101])]:Qe,[be([99,104,101,99,107,76,105,99,101,110,115,101,70,111,114,84,114,97,99,107,67,104,97,110,103,101,115])]:je,[be([99,104,101,99,107,76,105,99,101,110,115,101,70,111,114,82,101,118,105,115,105,111,110,72,105,115,116,111,114,121])]:Ye},Be=xe[be([99,111,110,115,116,114,117,99,116,111,114])][be([112,108,117,103,105,110,78,97,109,101])],$e=be([99,111,110,116,101,120,116])in xe?xe.context:xe.editor,Ue=be([52,48,52,56,49,52,50,50]),He=be([65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,48,49,50,51,52,53,54,55,56,57]),ze=$e.config.get(be([108,105,99,101,110,115,101,75,101,121])),qe=De[be([102,105,108,116,101,114])](ke)[be([102,105,110,100])](Ne=>Ne[be([112,108,117,103,105,110,78,97,109,101])]===Be);function Ke(Ne,Le){Fe[Le[be([104,97,110,100,108,101,114])]](Ne,Le),Le[be([99,104,101,99,107,65,108,115,111])]&&Le[be([99,104,101,99,107,65,108,115,111])][be([102,105,108,116,101,114])](We=>Kt($e,We[be([112,108,117,103,105,110,78,97,109,101])]))[be([102,111,114,69,97,99,104])](We=>Ke(Ne,We))}function Qe(Ne,Le){Ze(ht(Ne,Le),Le)}function je(Ne,Le){function We(Je,Wt){try{if(Kt($e,be([84,114,97,99,107,67,104,97,110,103,101,115,69,100,105,116,105,110,103]))&&Je){const nn=Xt($e,be([84,114,97,99,107,67,104,97,110,103,101,115,69,100,105,116,105,110,103]))[be([95,101,120,101,99,117,116,101,83,117,103,103,101,115,116,105,111,110])];if(parseInt(nn)/2>Je[be([101,120,112,105,114,97,116,105,111,110,68,97,116,101])])return Bt(Wt[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+be([73,110,118,97,108,105,100]))}return ht(Je,Wt)}catch{return Bt(Wt[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+be([73,110,118,97,108,105,100]))}}Ze(We(Ne,Le),Le)}function Ye(Ne,Le){const We=Ae[0]*Ie[1],Je=Ae[0]*Ie[2],Wt=Ae[2]*Ie[2];Kt($e,be([87,101,98,83,111,99,107,101,116,71,97,116,101,119,97,121]))&&Xt($e,be([87,101,98,83,111,99,107,101,116,71,97,116,101,119,97,121]))[be([115,116,97,116,101])]==be([99,111,110,110,101,99,116,101,100])&&(window[Jt()]=Wt);function nn(Xe,Qt){try{return un()?Bt(Qt[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+be([86,97,108,105,100])):ht(Xe,Qt)}catch{return Bt(Qt[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+be([73,110,118,97,108,105,100]))}}function cn(Xe,Qt){if(Xe==Qt[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+be([73,110,118,97,108,105,100]))zt();else if(Xe==Qt[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+be([84,114,105,97,108])){const rn=fn();rn&&ln(rn,Qt[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]);const xn=dn();window[be([115,101,116,84,105,109,101,111,117,116])](()=>{ln(be([116,105,109,101]),Qt[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])])},xn);const wn=Xt($e,be([82,101,118,105,115,105,111,110,115,82,101,112,111,115,105,116,111,114,121]))[be([95,114,101,118,105,115,105,111,110,115])];wn[be([108,101,110,103,116,104])]>=7?ln(be([114,101,118,105,115,105,111,110,115]),Qt[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]):wn.on(be([97,100,100]),()=>{wn[be([108,101,110,103,116,104])]>=7&&ln(be([114,101,118,105,115,105,111,110,115]),Qt[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])])})}}function fn(){if(!Kt($e,be([82,101,118,105,115,105,111,110,86,105,101,119,101,114])))return!1;for(const Xe in window)if(Number.isNaN(Number(Xe))){if(window[Xe]===We)return be([116,105,109,101]);if(window[Xe]===Je)return be([114,101,118,105,115,105,111,110,115])}return!1}function un(){if(!Kt($e,be([82,101,118,105,115,105,111,110,86,105,101,119,101,114])))return!1;for(const Xe in window)if(Number.isNaN(Number(Xe))&&window[Xe]===Wt)return!0;return!1}function ln(Xe,Qt){zt(),Bt(Qt+be([84,114,105,97,108,76,105,109,105,116,58])+Xe),window[Jt()]=Xe===be([116,105,109,101])?We:Je}function dn(){let Xe=Ae[6]*Ie[8]*Ie[6];return Kt($e,be([82,101,118,105,115,105,111,110,86,105,101,119,101,114]))&&(Xe/=10),Xe}function zt(){const Xe=$e;function Qt(){Kt(Xe,be([82,101,118,105,115,105,111,110,84,114,97,99,107,101,114]))&&(Xt(Xe,be([82,101,118,105,115,105,111,110,84,114,97,99,107,101,114]))[be([117,110,98,105,110,100])](be([105,115,69,110,97,98,108,101,100])),Xt(Xe,be([82,101,118,105,115,105,111,110,84,114,97,99,107,101,114]))[be([105,115,69,110,97,98,108,101,100])]=!1,Xt(Xe,be([82,101,118,105,115,105,111,110,84,114,97,99,107,101,114]))[be([117,112,100,97,116,101])]=sn,Xt(Xe,be([82,101,118,105,115,105,111,110,84,114,97,99,107,101,114]))[be([115,97,118,101,82,101,118,105,115,105,111,110])]=sn,Xe[be([109,111,100,101,108])][be([99,104,97,110,103,101])]=sn,Xe[be([109,111,100,101,108])][be([101,110,113,117,101,117,101,67,104,97,110,103,101])]=sn,Xe[be([101,110,97,98,108,101,82,101,97,100,79,110,108,121,77,111,100,101])](be([109,111,100,101,108]))),Kt(Xe,be([82,101,118,105,115,105,111,110,86,105,101,119,101,114]))&&(Xt(Xe,be([82,101,118,105,115,105,111,110,86,105,101,119,101,114]))[be([117,110,98,105,110,100])](be([105,115,69,110,97,98,108,101,100])),Xt(Xe,be([82,101,118,105,115,105,111,110,86,105,101,119,101,114]))[be([105,115,69,110,97,98,108,101,100])]=!1,Xt(Xe,be([82,101,118,105,115,105,111,110,86,105,101,119,101,114]))[be([99,111,109,112,97,114,101])]=sn,Xt(Xe,be([82,101,118,105,115,105,111,110,86,105,101,119,101,114]))[be([95,103,101,116,68,105,102,102])]=sn)}Xe[be([115,116,97,116,101])]==be([114,101,97,100,121])?Qt():Xe[be([111,110,99,101])](be([114,101,97,100,121]),()=>{if(Kt(Xe,be([82,101,118,105,115,105,111,110,84,114,97,99,107,101,114]))&&Qt(),Kt(Xe,be([82,101,118,105,115,105,111,110,86,105,101,119,101,114]))){const an=Xt(Xe,be([82,101,118,105,115,105,111,110,115,82,101,112,111,115,105,116,111,114,121])),rn=an.getRevision(0),xn=an.getEarlierVisibleRevision(rn[be([105,100])]);Xt(Xe,be([82,101,118,105,115,105,111,110,86,105,101,119,101,114]))[be([99,111,109,112,97,114,101])](rn[be([105,100])],xn?xn[be([105,100])]:null,1).then(()=>Qt())}})}cn(nn(Ne,Le),Le)}function ht(Ne,Le){try{return tn(Le)?Bt(Le[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+be([86,97,108,105,100])):Ne&&hn(Ne[be([97,108,108,111,119,101,100,80,108,117,103,105,110,115])],Le)?Ne[be([105,115,73,110,116,101,114,110,97,108])]&&!window[be([111,112,101,110])][be([99,108,111,115,101,100])]||parseInt(Ue)/2>Ne[be([101,120,112,105,114,97,116,105,111,110,68,97,116,101])]?Bt(Le[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+be([73,110,118,97,108,105,100])):Ne[be([105,115,84,114,105,97,108])]?Bt(Le[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+be([84,114,105,97,108])):Bt(Le[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+be([86,97,108,105,100])):Bt(Le[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+be([73,110,118,97,108,105,100]))}catch{return Bt(Le[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+be([73,110,118,97,108,105,100]))}}function Ze(Ne,Le){if($e instanceof Context){const We=$e;Ne==Le[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+be([73,110,118,97,108,105,100])?Yt(We):Ne==Le[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+be([84,114,105,97,108])&&window[be([115,101,116,84,105,109,101,111,117,116])](()=>{Yt(We),Bt(Le[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+be([84,114,105,97,108,76,105,109,105,116,58,116,105,109,101]))},Ae[6]*Ie[8]*Ie[6]),We[be([101,100,105,116,111,114,115])][be([111,110])](be([97,100,100]),(Je,Wt)=>{Ne!=Le[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+be([73,110,118,97,108,105,100])&&Ne!=Le[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+be([84,114,105,97,108,76,105,109,105,116,58,116,105,109,101])&&Ne!=Le[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+be([84,114,105,97,108,76,105,109,105,116,58,111,112,101,114,97,116,105,111,110,115])||en(Wt)})}else{const We=$e;Ne==Le[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+be([73,110,118,97,108,105,100])?en(We):Ne==Le[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+be([84,114,105,97,108])&&We[be([111,110])](be([114,101,97,100,121]),()=>{let Je=0;We[be([109,111,100,101,108])][be([111,110])](be([97,112,112,108,121,79,112,101,114,97,116,105,111,110]),(Wt,nn)=>{nn[0][be([105,115,68,111,99,117,109,101,110,116,79,112,101,114,97,116,105,111,110])]&&Je++,Je===504&&(en(We),Bt(Le[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+be([84,114,105,97,108,76,105,109,105,116,58,111,112,101,114,97,116,105,111,110,115])),Wt[be([111,102,102])]())},{priority:be([104,105,103,104,101,115,116])})})}}function Bt(Ne){const Le=Jt();return $e[Le]=Ne,Ne}function Jt(){const Ne=String(window[be([112,101,114,102,111,114,109,97,110,99,101])][be([110,111,119])]())[be([114,101,112,108,97,99,101])](be([46]),"");let Le="";for(let We=0;We<Ne[be([108,101,110,103,116,104])];We+=2){let Je=parseInt(Ne[be([115,117,98,115,116,114,105,110,103])](We,We+2));Je>=He[be([108,101,110,103,116,104])]&&(Je-=He[be([108,101,110,103,116,104])]),Le+=He[Je]}return Le}function Yt(Ne){for(const Le of Ne[be([101,100,105,116,111,114,115])])en(Le);Xt(Ne,be([67,111,109,109,101,110,116,115,82,101,112,111,115,105,116,111,114,121]))[be([115,119,105,116,99,104,82,101,97,100,79,110,108,121])](!0),Xt(Ne,be([67,111,109,109,101,110,116,115,82,101,112,111,115,105,116,111,114,121]))[be([115,119,105,116,99,104,82,101,97,100,79,110,108,121])]=sn}function en(Ne){function Le(){Ne[be([109,111,100,101,108])][be([99,104,97,110,103,101])]=sn,Ne[be([109,111,100,101,108])][be([101,110,113,117,101,117,101,67,104,97,110,103,101])]=sn,Ne[be([101,110,97,98,108,101,82,101,97,100,79,110,108,121,77,111,100,101])](be([109,111,100,101,108]))}Ne[be([115,116,97,116,101])]==be([114,101,97,100,121])?Le():Ne[be([111,110,99,101])](be([114,101,97,100,121]),()=>Le())}function sn(){return null}function hn(Ne,Le){const We=!!(Ne&Le[be([112,101,114,109,105,115,115,105,111,110,77,97,115,107])]),Je=mn(Ne,Le);return We||Je}function mn(Ne,Le){const We=(Le[be([111,112,116,105,111,110,115])]||{})[be([102,103,105])]||null;return!!We&&De[be([102,105,108,116,101,114])](Je=>We[be([105,110,99,108,117,100,101,115])](Je[be([105,100])]))[be([102,105,108,116,101,114])](Je=>!bn(Je))[be([115,111,109,101])](Je=>!!(Ne&Je[be([112,101,114,109,105,115,115,105,111,110,77,97,115,107])]))}function bn(Ne){const Le={[be([102,111,114,98,105,100,100,101,110,72,97,110,100,108,101,114,70,111,114,68,114,117,112,97,108])]:gn};return!!Ne.forbiddenHandler&&Le[Ne.forbiddenHandler]()}function gn(){return!window[be([68,114,117,112,97,108])]||!Kt($e,be([100,114,117,112,97,108,80,111,119,101,114,101,100,66,121]))}function tn(Ne){if(!Kt($e,Ne[be([112,108,117,103,105,110,78,97,109,101])]))return!0;const Le=Ne[be([111,112,116,105,111,110,115])]||{},We=Le[be([97,105,119,115,103,105,99])]||!1,Je=Le[be([97,105,116,99,100,103,105,108])]||!1,Wt=Le[be([97,105,114,118,105,105,108])]||!1;return Kt($e,be([87,101,98,83,111,99,107,101,116,71,97,116,101,119,97,121]))&&Xt($e,be([87,101,98,83,111,99,107,101,116,71,97,116,101,119,97,121]))[be([115,116,97,116,101])]==be([99,111,110,110,101,99,116,101,100])&&We||Kt($e,be([84,114,97,99,107,67,104,97,110,103,101,115,68,97,116,97,71,101,116,116,101,114]))&&Xt($e,be([84,114,97,99,107,67,104,97,110,103,101,115,68,97,116,97,71,101,116,116,101,114]))[be([114,101,115,117,108,116])]==be([101,110,100])&&Je?!0:!(!Kt($e,be([82,101,118,105,115,105,111,110,86,105,101,119,101,114,73,110,116,101,103,114,97,116,105,111,110]))||Xt($e,be([82,101,118,105,115,105,111,110,86,105,101,119,101,114,73,110,116,101,103,114,97,116,105,111,110]))[be([114,101,115,117,108,116])]!=be([101,110,100])||!Wt)}function Kt(Ne,Le){return Ne[be([112,108,117,103,105,110,115])][be([104,97,115])](Le)}function Xt(Ne,Le){return Ne[be([112,108,117,103,105,110,115])][be([103,101,116])](Le)}function pn(Ne){let Le="";for(const We of Ne)Le+=String[be([102,114,111,109,67,104,97,114,67,111,100,101])](We);return Le}function Ge(Ne){const Le=new Uint8Array(Ne[be([108,101,110,103,116,104])]);for(let We=0;We<Ne[be([108,101,110,103,116,104])];We++)Le[We]=Ne[be([99,104,97,114,67,111,100,101,65,116])](We);return Le}qe&&Ke(Me(ze),qe)})(t)})(this)}destroy(){super.destroy(),this.view.destroy(),this._updateActiveDefinitionFromViewportThrottled.cancel()}_handleOutlineChange(t,{outlineDefinitions:te,activeItemIndex:be,outlineChanges:xe}){this._currentOutlineDefinitions=te,this.view.sync(xe)}_setActiveViewItem(t){this._currentOutlineDefinitions.length&&this._currentOutlineDefinitions[t]&&(this.view.activeItemIndex=t)}_handleItemSelected(t){const te=this._currentOutlineDefinitions[t].modelElement;this.editor.model.change(be=>{be.setSelection(te,0)}),this.editor.editing.view.scrollToTheSelection({alignToTop:!0,forceScroll:!0}),this.editor.editing.view.focus(),this._setActiveViewItem(t)}_updateActiveDefinitionOnViewportChange(){const t=this.editor;let te;for(const xe of t.model.document.getRootNames()){const ve=t.editing.view.getDomRoot(xe),ke=ve&&new Rect(ve).getVisible();if(ke){const Ie=new Rect(global.window).getIntersection(ke);Ie&&(te=Ie.top+.25*Ie.height)}}if(te===void 0)return;const be=d$8(t.editing,this._currentOutlineDefinitions,te);be?this._setActiveViewItem(this._currentOutlineDefinitions.indexOf(be)):this._setActiveViewItem(-1)}};function d$8(Te,we,t,te=0,be=we.length-1){const xe=Math.floor(te+(be-te)/2);if(be>=te){const ve=we[xe],ke=Te.mapper.toViewElement(ve.modelElement);if(!ke)return null;const Ie=Te.view.domConverter.mapViewToDom(ke);return new Rect(Ie).bottom>t?d$8(Te,we,t,te,xe-1):d$8(Te,we,t,xe+1,be)}return xe<0?null:we[xe]}let l$7=class extends Plugin{constructor(t){super(t);Re(this,"_licenseKeyCheckInterval");this._licenseKeyCheckInterval=null}static get requires(){return[n$4,o$7]}static get pluginName(){return"DocumentOutline"}init(){const t=this.editor;this.licenseKey=t.config.get("licenseKey");const te=this.editor;this._licenseKeyCheckInterval=setInterval(()=>{let be;for(const xe in te){const ve=xe,ke=te[ve];if(ke==="documentOutlineLicenseKeyTrial"||ke==="documentOutlineLicenseKeyInvalid"||ke==="documentOutlineLicenseKeyValid"||ke==="documentOutlineLicenseKeyTrialLimit:operations"){delete te[ve],be=ke;break}}if(be==="documentOutlineLicenseKeyInvalid")throw clearInterval(this._licenseKeyCheckInterval),new CKEditorError("document-outline-invalid-license-key",null);if(be==="documentOutlineLicenseKeyTrial"&&console.info("You are using the trial version of CKEditor 5 document outline plugin with limited usage. Make sure you will not use it in the production environment."),be==="documentOutlineLicenseKeyTrialLimit:operations")throw clearInterval(this._licenseKeyCheckInterval),new CKEditorError("document-outline-trial-license-key-reached-limit-changes",null);be==="documentOutlineLicenseKeyValid"&&clearInterval(this._licenseKeyCheckInterval)},1e3)}destroy(){this._licenseKeyCheckInterval&&clearInterval(this._licenseKeyCheckInterval)}},O$3=class extends Command{execute(){this.editor.model.change(we=>{this.editor.model.insertObject(we.createElement("tableOfContents"))})}refresh(){const we=this.editor.model,t=we.document.selection.getFirstPosition();this.isEnabled=(t&&we.schema.findAllowedParent(t,"tableOfContents"))!==null}},A$4=class extends Plugin{static get pluginName(){return"HeadingId"}afterInit(){const we=this.editor;we.config.get("headingId.modelAttributeName")||(function(t){const te=new Map;return t&&(t.forEach(be=>{be.model!=="paragraph"&&te.set(be.view,be.model)}),te.get("h1")||te.set("h1","heading1")),te}(this.editor.config.get("heading.options")).forEach((t,te)=>{this._customUpcastHeadingsConversion(te),this._customDataDowncastHeadingsConversion(t),we.model.schema.isRegistered(t)&&we.model.schema.extend(t,{allowAttributes:"headingId"})}),this._registerHeadingIdAttributePostfixer())}_customUpcastHeadingsConversion(we){this.editor.data.upcastDispatcher.on("element:"+we,(t,te,be)=>{const{consumable:xe,writer:ve}=be,ke=te.viewItem.getAttribute("id"),Ie=te.modelRange.getContainedElement();if(!(ke&&ke.length||Ie.hasAttribute("headingId")))return xe.consume(te.viewItem,{attributes:["id"]}),void ve.setAttribute("headingId",uid(),Ie);xe.consume(te.viewItem,{attributes:["id"]})&&ve.setAttribute("headingId",ke,Ie)},{priority:priorities.get("low")+.5})}_customDataDowncastHeadingsConversion(we){this.editor.conversion.for("downcast").add(t=>t.on("attribute:headingId:"+we,(te,be,xe)=>{if(!xe.consumable.consume(be.item,te.name))return;const ve=be.item.getAttribute("headingId"),ke=xe.mapper.toViewElement(be.item);xe.writer.setAttribute("id",ve,ke)}))}_registerHeadingIdAttributePostfixer(){const we=this.editor,t=new Set,te=new Set;function be(ve,ke){const Ie=uid();return te.add(Ie),ve.setAttribute("headingId",Ie,ke),Ie}function xe(ve,ke){ve.removeAttribute("headingId",ke)}we.model.document.registerPostFixer(ve=>{const ke=we.model.document.differ.getChanges();let Ie=!1;for(const Ae of ke)if(Ae.type=="insert"&&Ae.name)if(Ae.name.match(/heading\d/)){const Se=Ae.attributes.get("headingId");typeof Se=="string"?t.has(Se)?(be(ve,Ae.position.nodeAfter),Ie=!0):te.add(Se):(be(ve,Ae.position.nodeAfter),Ie=!0)}else typeof Ae.attributes.get("headingId")=="string"&&(xe(ve,Ae.position.nodeAfter),Ie=!0);else if(Ae.type=="remove"){const Se=Ae.attributes.get("headingId");typeof Se=="string"&&t.delete(Se)}return Ie}),we.model.document.on("change",()=>{te.forEach(ve=>t.add(ve)),te.clear()})}},r$8=class extends Plugin{constructor(t){super(t);Re(this,"_currentOutlineDefinitions");Re(this,"_tableOfContentsElements");Re(this,"_headingIdModelAttributeName");this._currentOutlineDefinitions=[],this._tableOfContentsElements=new Set,this._headingIdModelAttributeName="headingId"}static get pluginName(){return"TableOfContentsEditing"}static get requires(){return[Widget,n$4,A$4]}init(){const t=this.editor,te=t.editing.view.document;t.config.get("headingId.modelAttributeName")&&(this._headingIdModelAttributeName=t.config.get("headingId.modelAttributeName")),this.listenTo(te,"click",(be,xe)=>{if(!xe.target)return;const ve=xe.target.getCustomProperty("tableOfContentsHeadingIndex");Number.isInteger(ve)&&(xe.domEvent.preventDefault(),be.stop(),this._handleScrollToHeading(ve))},{priority:"high",context:"$capture"}),this._defineSchema(),this._defineConverters(),t.commands.add("insertTableOfContents",new O$3(t)),t.plugins.get("DocumentOutlineUtils").on("change",(be,xe)=>{this._currentOutlineDefinitions=xe.outlineDefinitions,this._updateTableOfContentsElements()}),this.listenTo(t.model.document,"change",()=>{this._trackNewToCElements()})}afterInit(){(function(t){function te(xe,ve,ke){const Ie={};Ie[be([110,117,109,98,101,114,79,102,82,111,117,110,100,115])]={16:10,24:12,32:14},Ie[be([114,99,111,110])]=[1,2,4,8,16,32,64,128,27,54,108,216,171,77,154,47,94,188,99,198,151,53,106,212,179,125,250,239,197,145],Ie[be([83])]=[99,124,119,123,242,107,111,197,48,1,103,43,254,215,171,118,202,130,201,125,250,89,71,240,173,212,162,175,156,164,114,192,183,253,147,38,54,63,247,204,52,165,229,241,113,216,49,21,4,199,35,195,24,150,5,154,7,18,128,226,235,39,178,117,9,131,44,26,27,110,90,160,82,59,214,179,41,227,47,132,83,209,0,237,32,252,177,91,106,203,190,57,74,76,88,207,208,239,170,251,67,77,51,133,69,249,2,127,80,60,159,168,81,163,64,143,146,157,56,245,188,182,218,33,16,255,243,210,205,12,19,236,95,151,68,23,196,167,126,61,100,93,25,115,96,129,79,220,34,42,144,136,70,238,184,20,222,94,11,219,224,50,58,10,73,6,36,92,194,211,172,98,145,149,228,121,231,200,55,109,141,213,78,169,108,86,244,234,101,122,174,8,186,120,37,46,28,166,180,198,232,221,116,31,75,189,139,138,112,62,181,102,72,3,246,14,97,53,87,185,134,193,29,158,225,248,152,17,105,217,142,148,155,30,135,233,206,85,40,223,140,161,137,13,191,230,66,104,65,153,45,15,176,84,187,22],Ie[be([84,49])]=[3328402341,4168907908,4000806809,4135287693,4294111757,3597364157,3731845041,2445657428,1613770832,33620227,3462883241,1445669757,3892248089,3050821474,1303096294,3967186586,2412431941,528646813,2311702848,4202528135,4026202645,2992200171,2387036105,4226871307,1101901292,3017069671,1604494077,1169141738,597466303,1403299063,3832705686,2613100635,1974974402,3791519004,1033081774,1277568618,1815492186,2118074177,4126668546,2211236943,1748251740,1369810420,3521504564,4193382664,3799085459,2883115123,1647391059,706024767,134480908,2512897874,1176707941,2646852446,806885416,932615841,168101135,798661301,235341577,605164086,461406363,3756188221,3454790438,1311188841,2142417613,3933566367,302582043,495158174,1479289972,874125870,907746093,3698224818,3025820398,1537253627,2756858614,1983593293,3084310113,2108928974,1378429307,3722699582,1580150641,327451799,2790478837,3117535592,0,3253595436,1075847264,3825007647,2041688520,3059440621,3563743934,2378943302,1740553945,1916352843,2487896798,2555137236,2958579944,2244988746,3151024235,3320835882,1336584933,3992714006,2252555205,2588757463,1714631509,293963156,2319795663,3925473552,67240454,4269768577,2689618160,2017213508,631218106,1269344483,2723238387,1571005438,2151694528,93294474,1066570413,563977660,1882732616,4059428100,1673313503,2008463041,2950355573,1109467491,537923632,3858759450,4260623118,3218264685,2177748300,403442708,638784309,3287084079,3193921505,899127202,2286175436,773265209,2479146071,1437050866,4236148354,2050833735,3362022572,3126681063,840505643,3866325909,3227541664,427917720,2655997905,2749160575,1143087718,1412049534,999329963,193497219,2353415882,3354324521,1807268051,672404540,2816401017,3160301282,369822493,2916866934,3688947771,1681011286,1949973070,336202270,2454276571,201721354,1210328172,3093060836,2680341085,3184776046,1135389935,3294782118,965841320,831886756,3554993207,4068047243,3588745010,2345191491,1849112409,3664604599,26054028,2983581028,2622377682,1235855840,3630984372,2891339514,4092916743,3488279077,3395642799,4101667470,1202630377,268961816,1874508501,4034427016,1243948399,1546530418,941366308,1470539505,1941222599,2546386513,3421038627,2715671932,3899946140,1042226977,2521517021,1639824860,227249030,260737669,3765465232,2084453954,1907733956,3429263018,2420656344,100860677,4160157185,470683154,3261161891,1781871967,2924959737,1773779408,394692241,2579611992,974986535,664706745,3655459128,3958962195,731420851,571543859,3530123707,2849626480,126783113,865375399,765172662,1008606754,361203602,3387549984,2278477385,2857719295,1344809080,2782912378,59542671,1503764984,160008576,437062935,1707065306,3622233649,2218934982,3496503480,2185314755,697932208,1512910199,504303377,2075177163,2824099068,1841019862,739644986],Ie[be([84,50])]=[2781242211,2230877308,2582542199,2381740923,234877682,3184946027,2984144751,1418839493,1348481072,50462977,2848876391,2102799147,434634494,1656084439,3863849899,2599188086,1167051466,2636087938,1082771913,2281340285,368048890,3954334041,3381544775,201060592,3963727277,1739838676,4250903202,3930435503,3206782108,4149453988,2531553906,1536934080,3262494647,484572669,2923271059,1783375398,1517041206,1098792767,49674231,1334037708,1550332980,4098991525,886171109,150598129,2481090929,1940642008,1398944049,1059722517,201851908,1385547719,1699095331,1587397571,674240536,2704774806,252314885,3039795866,151914247,908333586,2602270848,1038082786,651029483,1766729511,3447698098,2682942837,454166793,2652734339,1951935532,775166490,758520603,3000790638,4004797018,4217086112,4137964114,1299594043,1639438038,3464344499,2068982057,1054729187,1901997871,2534638724,4121318227,1757008337,0,750906861,1614815264,535035132,3363418545,3988151131,3201591914,1183697867,3647454910,1265776953,3734260298,3566750796,3903871064,1250283471,1807470800,717615087,3847203498,384695291,3313910595,3617213773,1432761139,2484176261,3481945413,283769337,100925954,2180939647,4037038160,1148730428,3123027871,3813386408,4087501137,4267549603,3229630528,2315620239,2906624658,3156319645,1215313976,82966005,3747855548,3245848246,1974459098,1665278241,807407632,451280895,251524083,1841287890,1283575245,337120268,891687699,801369324,3787349855,2721421207,3431482436,959321879,1469301956,4065699751,2197585534,1199193405,2898814052,3887750493,724703513,2514908019,2696962144,2551808385,3516813135,2141445340,1715741218,2119445034,2872807568,2198571144,3398190662,700968686,3547052216,1009259540,2041044702,3803995742,487983883,1991105499,1004265696,1449407026,1316239930,504629770,3683797321,168560134,1816667172,3837287516,1570751170,1857934291,4014189740,2797888098,2822345105,2754712981,936633572,2347923833,852879335,1133234376,1500395319,3084545389,2348912013,1689376213,3533459022,3762923945,3034082412,4205598294,133428468,634383082,2949277029,2398386810,3913789102,403703816,3580869306,2297460856,1867130149,1918643758,607656988,4049053350,3346248884,1368901318,600565992,2090982877,2632479860,557719327,3717614411,3697393085,2249034635,2232388234,2430627952,1115438654,3295786421,2865522278,3633334344,84280067,33027830,303828494,2747425121,1600795957,4188952407,3496589753,2434238086,1486471617,658119965,3106381470,953803233,334231800,3005978776,857870609,3151128937,1890179545,2298973838,2805175444,3056442267,574365214,2450884487,550103529,1233637070,4289353045,2018519080,2057691103,2399374476,4166623649,2148108681,387583245,3664101311,836232934,3330556482,3100665960,3280093505,2955516313,2002398509,287182607,3413881008,4238890068,3597515707,975967766],Ie[be([84,51])]=[1671808611,2089089148,2006576759,2072901243,4061003762,1807603307,1873927791,3310653893,810573872,16974337,1739181671,729634347,4263110654,3613570519,2883997099,1989864566,3393556426,2191335298,3376449993,2106063485,4195741690,1508618841,1204391495,4027317232,2917941677,3563566036,2734514082,2951366063,2629772188,2767672228,1922491506,3227229120,3082974647,4246528509,2477669779,644500518,911895606,1061256767,4144166391,3427763148,878471220,2784252325,3845444069,4043897329,1905517169,3631459288,827548209,356461077,67897348,3344078279,593839651,3277757891,405286936,2527147926,84871685,2595565466,118033927,305538066,2157648768,3795705826,3945188843,661212711,2999812018,1973414517,152769033,2208177539,745822252,439235610,455947803,1857215598,1525593178,2700827552,1391895634,994932283,3596728278,3016654259,695947817,3812548067,795958831,2224493444,1408607827,3513301457,0,3979133421,543178784,4229948412,2982705585,1542305371,1790891114,3410398667,3201918910,961245753,1256100938,1289001036,1491644504,3477767631,3496721360,4012557807,2867154858,4212583931,1137018435,1305975373,861234739,2241073541,1171229253,4178635257,33948674,2139225727,1357946960,1011120188,2679776671,2833468328,1374921297,2751356323,1086357568,2408187279,2460827538,2646352285,944271416,4110742005,3168756668,3066132406,3665145818,560153121,271589392,4279952895,4077846003,3530407890,3444343245,202643468,322250259,3962553324,1608629855,2543990167,1154254916,389623319,3294073796,2817676711,2122513534,1028094525,1689045092,1575467613,422261273,1939203699,1621147744,2174228865,1339137615,3699352540,577127458,712922154,2427141008,2290289544,1187679302,3995715566,3100863416,339486740,3732514782,1591917662,186455563,3681988059,3762019296,844522546,978220090,169743370,1239126601,101321734,611076132,1558493276,3260915650,3547250131,2901361580,1655096418,2443721105,2510565781,3828863972,2039214713,3878868455,3359869896,928607799,1840765549,2374762893,3580146133,1322425422,2850048425,1823791212,1459268694,4094161908,3928346602,1706019429,2056189050,2934523822,135794696,3134549946,2022240376,628050469,779246638,472135708,2800834470,3032970164,3327236038,3894660072,3715932637,1956440180,522272287,1272813131,3185336765,2340818315,2323976074,1888542832,1044544574,3049550261,1722469478,1222152264,50660867,4127324150,236067854,1638122081,895445557,1475980887,3117443513,2257655686,3243809217,489110045,2662934430,3778599393,4162055160,2561878936,288563729,1773916777,3648039385,2391345038,2493985684,2612407707,505560094,2274497927,3911240169,3460925390,1442818645,678973480,3749357023,2358182796,2717407649,2306869641,219617805,3218761151,3862026214,1120306242,1756942440,1103331905,2578459033,762796589,252780047,2966125488,1425844308,3151392187,372911126],Ie[be([84,52])]=[1667474886,2088535288,2004326894,2071694838,4075949567,1802223062,1869591006,3318043793,808472672,16843522,1734846926,724270422,4278065639,3621216949,2880169549,1987484396,3402253711,2189597983,3385409673,2105378810,4210693615,1499065266,1195886990,4042263547,2913856577,3570689971,2728590687,2947541573,2627518243,2762274643,1920112356,3233831835,3082273397,4261223649,2475929149,640051788,909531756,1061110142,4160160501,3435941763,875846760,2779116625,3857003729,4059105529,1903268834,3638064043,825316194,353713962,67374088,3351728789,589522246,3284360861,404236336,2526454071,84217610,2593830191,117901582,303183396,2155911963,3806477791,3958056653,656894286,2998062463,1970642922,151591698,2206440989,741110872,437923380,454765878,1852748508,1515908788,2694904667,1381168804,993742198,3604373943,3014905469,690584402,3823320797,791638366,2223281939,1398011302,3520161977,0,3991743681,538992704,4244381667,2981218425,1532751286,1785380564,3419096717,3200178535,960056178,1246420628,1280103576,1482221744,3486468741,3503319995,4025428677,2863326543,4227536621,1128514950,1296947098,859002214,2240123921,1162203018,4193849577,33687044,2139062782,1347481760,1010582648,2678045221,2829640523,1364325282,2745433693,1077985408,2408548869,2459086143,2644360225,943212656,4126475505,3166494563,3065430391,3671750063,555836226,269496352,4294908645,4092792573,3537006015,3452783745,202118168,320025894,3974901699,1600119230,2543297077,1145359496,387397934,3301201811,2812801621,2122220284,1027426170,1684319432,1566435258,421079858,1936954854,1616945344,2172753945,1330631070,3705438115,572679748,707427924,2425400123,2290647819,1179044492,4008585671,3099120491,336870440,3739122087,1583276732,185277718,3688593069,3772791771,842159716,976899700,168435220,1229577106,101059084,606366792,1549591736,3267517855,3553849021,2897014595,1650632388,2442242105,2509612081,3840161747,2038008818,3890688725,3368567691,926374254,1835907034,2374863873,3587531953,1313788572,2846482505,1819063512,1448540844,4109633523,3941213647,1701162954,2054852340,2930698567,134748176,3132806511,2021165296,623210314,774795868,471606328,2795958615,3031746419,3334885783,3907527627,3722280097,1953799400,522133822,1263263126,3183336545,2341176845,2324333839,1886425312,1044267644,3048588401,1718004428,1212733584,50529542,4143317495,235803164,1633788866,892690282,1465383342,3115962473,2256965911,3250673817,488449850,2661202215,3789633753,4177007595,2560144171,286339874,1768537042,3654906025,2391705863,2492770099,2610673197,505291324,2273808917,3924369609,3469625735,1431699370,673740880,3755965093,2358021891,2711746649,2307489801,218961690,3217021541,3873845719,1111672452,1751693520,1094828930,2576986153,757954394,252645662,2964376443,1414855848,3149649517,370555436],Ie[be([85,49])]=[0,235474187,470948374,303765277,941896748,908933415,607530554,708780849,1883793496,2118214995,1817866830,1649639237,1215061108,1181045119,1417561698,1517767529,3767586992,4003061179,4236429990,4069246893,3635733660,3602770327,3299278474,3400528769,2430122216,2664543715,2362090238,2193862645,2835123396,2801107407,3035535058,3135740889,3678124923,3576870512,3341394285,3374361702,3810496343,3977675356,4279080257,4043610186,2876494627,2776292904,3076639029,3110650942,2472011535,2640243204,2403728665,2169303058,1001089995,899835584,666464733,699432150,59727847,226906860,530400753,294930682,1273168787,1172967064,1475418501,1509430414,1942435775,2110667444,1876241833,1641816226,2910219766,2743034109,2976151520,3211623147,2505202138,2606453969,2302690252,2269728455,3711829422,3543599269,3240894392,3475313331,3843699074,3943906441,4178062228,4144047775,1306967366,1139781709,1374988112,1610459739,1975683434,2076935265,1775276924,1742315127,1034867998,866637845,566021896,800440835,92987698,193195065,429456164,395441711,1984812685,2017778566,1784663195,1683407248,1315562145,1080094634,1383856311,1551037884,101039829,135050206,437757123,337553864,1042385657,807962610,573804783,742039012,2531067453,2564033334,2328828971,2227573024,2935566865,2700099354,3001755655,3168937228,3868552805,3902563182,4203181171,4102977912,3736164937,3501741890,3265478751,3433712980,1106041591,1340463100,1576976609,1408749034,2043211483,2009195472,1708848333,1809054150,832877231,1068351396,766945465,599762354,159417987,126454664,361929877,463180190,2709260871,2943682380,3178106961,3009879386,2572697195,2538681184,2236228733,2336434550,3509871135,3745345300,3441850377,3274667266,3910161971,3877198648,4110568485,4211818798,2597806476,2497604743,2261089178,2295101073,2733856160,2902087851,3202437046,2968011453,3936291284,3835036895,4136440770,4169408201,3535486456,3702665459,3467192302,3231722213,2051518780,1951317047,1716890410,1750902305,1113818384,1282050075,1584504582,1350078989,168810852,67556463,371049330,404016761,841739592,1008918595,775550814,540080725,3969562369,3801332234,4035489047,4269907996,3569255213,3669462566,3366754619,3332740144,2631065433,2463879762,2160117071,2395588676,2767645557,2868897406,3102011747,3069049960,202008497,33778362,270040487,504459436,875451293,975658646,675039627,641025152,2084704233,1917518562,1615861247,1851332852,1147550661,1248802510,1484005843,1451044056,933301370,967311729,733156972,632953703,260388950,25965917,328671808,496906059,1206477858,1239443753,1543208500,1441952575,2144161806,1908694277,1675577880,1842759443,3610369226,3644379585,3408119516,3307916247,4011190502,3776767469,4077384432,4245618683,2809771154,2842737049,3144396420,3043140495,2673705150,2438237621,2203032232,2370213795],Ie[be([85,50])]=[0,185469197,370938394,487725847,741876788,657861945,975451694,824852259,1483753576,1400783205,1315723890,1164071807,1950903388,2135319889,1649704518,1767536459,2967507152,3152976349,2801566410,2918353863,2631447780,2547432937,2328143614,2177544179,3901806776,3818836405,4270639778,4118987695,3299409036,3483825537,3535072918,3652904859,2077965243,1893020342,1841768865,1724457132,1474502543,1559041666,1107234197,1257309336,598438867,681933534,901210569,1052338372,261314535,77422314,428819965,310463728,3409685355,3224740454,3710368113,3593056380,3875770207,3960309330,4045380933,4195456072,2471224067,2554718734,2237133081,2388260884,3212035895,3028143674,2842678573,2724322336,4138563181,4255350624,3769721975,3955191162,3667219033,3516619604,3431546947,3347532110,2933734917,2782082824,3099667487,3016697106,2196052529,2313884476,2499348523,2683765030,1179510461,1296297904,1347548327,1533017514,1786102409,1635502980,2087309459,2003294622,507358933,355706840,136428751,53458370,839224033,957055980,605657339,790073846,2373340630,2256028891,2607439820,2422494913,2706270690,2856345839,3075636216,3160175349,3573941694,3725069491,3273267108,3356761769,4181598602,4063242375,4011996048,3828103837,1033297158,915985419,730517276,545572369,296679730,446754879,129166120,213705253,1709610350,1860738147,1945798516,2029293177,1239331162,1120974935,1606591296,1422699085,4148292826,4233094615,3781033664,3931371469,3682191598,3497509347,3446004468,3328955385,2939266226,2755636671,3106780840,2988687269,2198438022,2282195339,2501218972,2652609425,1201765386,1286567175,1371368976,1521706781,1805211710,1620529459,2105887268,1988838185,533804130,350174575,164439672,46346101,870912086,954669403,636813900,788204353,2358957921,2274680428,2592523643,2441661558,2695033685,2880240216,3065962831,3182487618,3572145929,3756299780,3270937875,3388507166,4174560061,4091327024,4006521127,3854606378,1014646705,930369212,711349675,560487590,272786309,457992840,106852767,223377554,1678381017,1862534868,1914052035,2031621326,1211247597,1128014560,1580087799,1428173050,32283319,182621114,401639597,486441376,768917123,651868046,1003007129,818324884,1503449823,1385356242,1333838021,1150208456,1973745387,2125135846,1673061617,1756818940,2970356327,3120694122,2802849917,2887651696,2637442643,2520393566,2334669897,2149987652,3917234703,3799141122,4284502037,4100872472,3309594171,3460984630,3545789473,3629546796,2050466060,1899603969,1814803222,1730525723,1443857720,1560382517,1075025698,1260232239,575138148,692707433,878443390,1062597235,243256656,91341917,409198410,325965383,3403100636,3252238545,3704300486,3620022987,3874428392,3990953189,4042459122,4227665663,2460449204,2578018489,2226875310,2411029155,3198115200,3046200461,2827177882,2743944855],Ie[be([85,51])]=[0,218828297,437656594,387781147,875313188,958871085,775562294,590424639,1750626376,1699970625,1917742170,2135253587,1551124588,1367295589,1180849278,1265195639,3501252752,3720081049,3399941250,3350065803,3835484340,3919042237,4270507174,4085369519,3102249176,3051593425,2734591178,2952102595,2361698556,2177869557,2530391278,2614737639,3145456443,3060847922,2708326185,2892417312,2404901663,2187128086,2504130317,2555048196,3542330227,3727205754,3375740769,3292445032,3876557655,3926170974,4246310725,4027744588,1808481195,1723872674,1910319033,2094410160,1608975247,1391201670,1173430173,1224348052,59984867,244860394,428169201,344873464,935293895,984907214,766078933,547512796,1844882806,1627235199,2011214180,2062270317,1507497298,1423022939,1137477952,1321699145,95345982,145085239,532201772,313773861,830661914,1015671571,731183368,648017665,3175501286,2957853679,2807058932,2858115069,2305455554,2220981195,2474404304,2658625497,3575528878,3625268135,3473416636,3254988725,3778151818,3963161475,4213447064,4130281361,3599595085,3683022916,3432737375,3247465558,3802222185,4020912224,4172763771,4122762354,3201631749,3017672716,2764249623,2848461854,2331590177,2280796200,2431590963,2648976442,104699613,188127444,472615631,287343814,840019705,1058709744,671593195,621591778,1852171925,1668212892,1953757831,2037970062,1514790577,1463996600,1080017571,1297403050,3673637356,3623636965,3235995134,3454686199,4007360968,3822090177,4107101658,4190530515,2997825956,3215212461,2830708150,2779915199,2256734592,2340947849,2627016082,2443058075,172466556,122466165,273792366,492483431,1047239e3,861968209,612205898,695634755,1646252340,1863638845,2013908262,1963115311,1446242576,1530455833,1277555970,1093597963,1636604631,1820824798,2073724613,1989249228,1436590835,1487645946,1337376481,1119727848,164948639,81781910,331544205,516552836,1039717051,821288114,669961897,719700128,2973530695,3157750862,2871682645,2787207260,2232435299,2283490410,2667994737,2450346104,3647212047,3564045318,3279033885,3464042516,3980931627,3762502690,4150144569,4199882800,3070356634,3121275539,2904027272,2686254721,2200818878,2384911031,2570832044,2486224549,3747192018,3528626907,3310321856,3359936201,3950355702,3867060991,4049844452,4234721005,1739656202,1790575107,2108100632,1890328081,1402811438,1586903591,1233856572,1149249077,266959938,48394827,369057872,418672217,1002783846,919489135,567498868,752375421,209336225,24197544,376187827,459744698,945164165,895287692,574624663,793451934,1679968233,1764313568,2117360635,1933530610,1343127501,1560637892,1243112415,1192455638,3704280881,3519142200,3336358691,3419915562,3907448597,3857572124,4075877127,4294704398,3029510009,3113855344,2927934315,2744104290,2159976285,2377486676,2594734927,2544078150],Ie[be([85,52])]=[0,151849742,303699484,454499602,607398968,758720310,908999204,1059270954,1214797936,1097159550,1517440620,1400849762,1817998408,1699839814,2118541908,2001430874,2429595872,2581445614,2194319100,2345119218,3034881240,3186202582,2801699524,2951971274,3635996816,3518358430,3399679628,3283088770,4237083816,4118925222,4002861748,3885750714,1002142683,850817237,698445255,548169417,529487843,377642221,227885567,77089521,1943217067,2061379749,1640576439,1757691577,1474760595,1592394909,1174215055,1290801793,2875968315,2724642869,3111247143,2960971305,2405426947,2253581325,2638606623,2487810577,3808662347,3926825029,4044981591,4162096729,3342319475,3459953789,3576539503,3693126241,1986918061,2137062819,1685577905,1836772287,1381620373,1532285339,1078185097,1229899655,1040559837,923313619,740276417,621982671,439452389,322734571,137073913,19308535,3871163981,4021308739,4104605777,4255800159,3263785589,3414450555,3499326569,3651041127,2933202493,2815956275,3167684641,3049390895,2330014213,2213296395,2566595609,2448830231,1305906550,1155237496,1607244650,1455525988,1776460110,1626319424,2079897426,1928707164,96392454,213114376,396673818,514443284,562755902,679998e3,865136418,983426092,3708173718,3557504664,3474729866,3323011204,4180808110,4030667424,3945269170,3794078908,2507040230,2623762152,2272556026,2390325492,2975484382,3092726480,2738905026,2857194700,3973773121,3856137295,4274053469,4157467219,3371096953,3252932727,3673476453,3556361835,2763173681,2915017791,3064510765,3215307299,2156299017,2307622919,2459735317,2610011675,2081048481,1963412655,1846563261,1729977011,1480485785,1362321559,1243905413,1126790795,878845905,1030690015,645401037,796197571,274084841,425408743,38544885,188821243,3613494426,3731654548,3313212038,3430322568,4082475170,4200115116,3780097726,3896688048,2668221674,2516901860,2366882550,2216610296,3141400786,2989552604,2837966542,2687165888,1202797690,1320957812,1437280870,1554391400,1669664834,1787304780,1906247262,2022837584,265905162,114585348,499347990,349075736,736970802,585122620,972512814,821712160,2595684844,2478443234,2293045232,2174754046,3196267988,3079546586,2895723464,2777952454,3537852828,3687994002,3234156416,3385345166,4142626212,4293295786,3841024952,3992742070,174567692,57326082,410887952,292596766,777231668,660510266,1011452712,893681702,1108339068,1258480242,1343618912,1494807662,1715193156,1865862730,1948373848,2100090966,2701949495,2818666809,3004591147,3122358053,2235061775,2352307457,2535604243,2653899549,3915653703,3764988233,4219352155,4067639125,3444575871,3294430577,3746175075,3594982253,836553431,953270745,600235211,718002117,367585007,484830689,133361907,251657213,2041877159,1891211689,1806599355,1654886325,1568718495,1418573201,1335535747,1184342925];const Ae=new Uint8Array(16);for(let He=15;He>=0;--He)Ae[He]=ke%256,ke=parseInt(ke/256);let Se=null,Oe=16;const Ve=new Uint8Array(ve),Me=[],De=[];Ue();for(let He=0;He<xe[be([108,101,110,103,116,104])];He++)Oe===16&&(Se=$e(Ae),Oe=0,Be(Ae)),xe[He]^=Se[Oe++];return xe;function Fe(He){const ze=[];for(let qe=0;qe<He[be([108,101,110,103,116,104])];qe+=4)ze[be([112,117,115,104])](He[qe]<<24|He[qe+1]<<16|He[qe+2]<<8|He[qe+3]);return ze}function Be(He){for(let ze=15;ze>=0;ze--){if(He[ze]!==255){He[ze]++;break}He[ze]=0}}function $e(He){const ze=Me[be([108,101,110,103,116,104])]-1,qe=[0,0,0,0];let Ke=Fe(He);for(let Ye=0;Ye<4;Ye++)Ke[Ye]^=Me[0][Ye];for(let Ye=1;Ye<ze;Ye++){for(let ht=0;ht<4;ht++)qe[ht]=Ie[be([84,49])][Ke[ht]>>24&255]^Ie[be([84,50])][Ke[(ht+1)%4]>>16&255]^Ie[be([84,51])][Ke[(ht+2)%4]>>8&255]^Ie[be([84,52])][255&Ke[(ht+3)%4]]^Me[Ye][ht];Ke=qe[be([115,108,105,99,101])]()}const Qe=new Uint8Array(16);let je;for(let Ye=0;Ye<4;Ye++)je=Me[ze][Ye],Qe[4*Ye]=255&(Ie[be([83])][Ke[Ye]>>24&255]^je>>24),Qe[4*Ye+1]=255&(Ie[be([83])][Ke[(Ye+1)%4]>>16&255]^je>>16),Qe[4*Ye+2]=255&(Ie[be([83])][Ke[(Ye+2)%4]>>8&255]^je>>8),Qe[4*Ye+3]=255&(Ie[be([83])][255&Ke[(Ye+3)%4]]^je);return Qe}function Ue(){const He=Ie[be([110,117,109,98,101,114,79,102,82,111,117,110,100,115])][Ve[be([108,101,110,103,116,104])]];for(let Ze=0;Ze<=He;Ze++)Me[be([112,117,115,104])]([0,0,0,0]),De[be([112,117,115,104])]([0,0,0,0]);const ze=4*(He+1),qe=Ve[be([108,101,110,103,116,104])]/4,Ke=Fe(Ve);let Qe;for(let Ze=0;Ze<qe;Ze++)Qe=Ze>>2,Me[Qe][Ze%4]=Ke[Ze],De[He-Qe][Ze%4]=Ke[Ze];let je,Ye=0,ht=qe;for(;ht<ze;){je=Ke[qe-1],Ke[0]^=Ie[be([83])][je>>16&255]<<24^Ie[be([83])][je>>8&255]<<16^Ie[be([83])][255&je]<<8^Ie[be([83])][je>>24&255]^Ie[be([114,99,111,110])][Ye]<<24,Ye+=1;for(let Yt=1;Yt<qe/2;Yt++)Ke[Yt]^=Ke[Yt-1];je=Ke[qe/2-1],Ke[qe/2]^=Ie[be([83])][255&je]^Ie[be([83])][je>>8&255]<<8^Ie[be([83])][je>>16&255]<<16^Ie[be([83])][je>>24&255]<<24;for(let Yt=qe/2+1;Yt<qe;Yt++)Ke[Yt]^=Ke[Yt-1];let Ze,Bt,Jt=0;for(;Jt<qe&&ht<ze;)Ze=ht>>2,Bt=ht%4,Me[Ze][Bt]=Ke[Jt],De[He-Ze][Bt]=Ke[Jt++],ht++}for(let Ze=1;Ze<He;Ze++)for(let Bt=0;Bt<4;Bt++)je=De[Ze][Bt],De[Ze][Bt]=Ie[be([85,49])][je>>24&255]^Ie[be([85,50])][je>>16&255]^Ie[be([85,51])][je>>8&255]^Ie[be([85,52])][255&je]}}function be(xe){return xe.map(ve=>String.fromCharCode(ve)).join("")}(xe=>{function ve(){const Ne=[{[be([105,100])]:1,[be([102,101,97,116,117,114,101,78,97,109,101])]:be([67,111,109,109,101,110,116,115]),[be([112,108,117,103,105,110,78,97,109,101])]:be([67,111,109,109,101,110,116,115,82,101,112,111,115,105,116,111,114,121]),[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:be([108,105,99,101,110,115,101,75,101,121]),[be([104,97,110,100,108,101,114])]:be([99,104,101,99,107,76,105,99,101,110,115,101]),[be([99,104,101,99,107,65,108,115,111])]:[{[be([105,100])]:2,[be([102,101,97,116,117,114,101,78,97,109,101])]:be([84,114,97,99,107,32,67,104,97,110,103,101,115]),[be([112,108,117,103,105,110,78,97,109,101])]:be([84,114,97,99,107,67,104,97,110,103,101,115,69,100,105,116,105,110,103]),[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:be([108,105,99,101,110,115,101,75,101,121]),[be([104,97,110,100,108,101,114])]:be([99,104,101,99,107,76,105,99,101,110,115,101,70,111,114,84,114,97,99,107,67,104,97,110,103,101,115]),[be([111,112,116,105,111,110,115])]:{[be([97,105,119,115,103,105,99])]:!0,[be([97,105,116,99,100,103,105,108])]:!0,[be([97,105,114,118,105,105,108])]:!0}}],[be([111,112,116,105,111,110,115])]:{[be([97,105,119,115,103,105,99])]:!0,[be([97,105,116,99,100,103,105,108])]:!0,[be([97,105,114,118,105,105,108])]:!0}},{[be([105,100])]:3,[be([102,101,97,116,117,114,101,78,97,109,101])]:be([80,97,103,105,110,97,116,105,111,110]),[be([112,108,117,103,105,110,78,97,109,101])]:be([80,97,103,105,110,97,116,105,111,110,76,111,111,107,117,112]),[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:be([112,97,103,105,110,97,116,105,111,110,76,105,99,101,110,115,101,75,101,121]),[be([104,97,110,100,108,101,114])]:be([99,104,101,99,107,76,105,99,101,110,115,101])},{[be([105,100])]:4,[be([102,101,97,116,117,114,101,78,97,109,101])]:be([82,101,118,105,115,105,111,110,32,72,105,115,116,111,114,121]),[be([112,108,117,103,105,110,78,97,109,101])]:be([82,101,118,105,115,105,111,110,115,82,101,112,111,115,105,116,111,114,121]),[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:be([108,105,99,101,110,115,101,75,101,121]),[be([104,97,110,100,108,101,114])]:be([99,104,101,99,107,76,105,99,101,110,115,101,70,111,114,82,101,118,105,115,105,111,110,72,105,115,116,111,114,121]),[be([111,112,116,105,111,110,115])]:{[be([97,105,119,115,103,105,99])]:!0,[be([97,105,116,99,100,103,105,108])]:!0,[be([97,105,114,118,105,105,108])]:!0}},{[be([105,100])]:5,[be([102,101,97,116,117,114,101,78,97,109,101])]:be([68,111,99,117,109,101,110,116,32,79,117,116,108,105,110,101]),[be([112,108,117,103,105,110,78,97,109,101])]:be([68,111,99,117,109,101,110,116,79,117,116,108,105,110,101,85,73]),[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:be([100,111,99,117,109,101,110,116,79,117,116,108,105,110,101,76,105,99,101,110,115,101,75,101,121]),[be([104,97,110,100,108,101,114])]:be([99,104,101,99,107,76,105,99,101,110,115,101]),[be([111,112,116,105,111,110,115])]:{[be([102,103,105])]:[12]}},{[be([105,100])]:6,[be([102,101,97,116,117,114,101,78,97,109,101])]:be([70,111,114,109,97,116,32,80,97,105,110,116,101,114]),[be([112,108,117,103,105,110,78,97,109,101])]:be([70,111,114,109,97,116,80,97,105,110,116,101,114,85,73]),[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:be([102,111,114,109,97,116,80,97,105,110,116,101,114,76,105,99,101,110,115,101,75,101,121]),[be([104,97,110,100,108,101,114])]:be([99,104,101,99,107,76,105,99,101,110,115,101]),[be([111,112,116,105,111,110,115])]:{[be([102,103,105])]:[12]}},{[be([105,100])]:7,[be([102,101,97,116,117,114,101,78,97,109,101])]:be([83,108,97,115,104,32,67,111,109,109,97,110,100]),[be([112,108,117,103,105,110,78,97,109,101])]:be([83,108,97,115,104,67,111,109,109,97,110,100,85,73]),[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:be([115,108,97,115,104,67,111,109,109,97,110,100,76,105,99,101,110,115,101,75,101,121]),[be([104,97,110,100,108,101,114])]:be([99,104,101,99,107,76,105,99,101,110,115,101]),[be([111,112,116,105,111,110,115])]:{[be([102,103,105])]:[12]}},{[be([105,100])]:8,[be([102,101,97,116,117,114,101,78,97,109,101])]:be([84,97,98,108,101,32,111,102,32,67,111,110,116,101,110,116,115]),[be([112,108,117,103,105,110,78,97,109,101])]:be([84,97,98,108,101,79,102,67,111,110,116,101,110,116,115,69,100,105,116,105,110,103]),[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:be([116,97,98,108,101,79,102,67,111,110,116,101,110,116,115,76,105,99,101,110,115,101,75,101,121]),[be([104,97,110,100,108,101,114])]:be([99,104,101,99,107,76,105,99,101,110,115,101]),[be([111,112,116,105,111,110,115])]:{[be([102,103,105])]:[12]}},{[be([105,100])]:9,[be([102,101,97,116,117,114,101,78,97,109,101])]:be([84,101,109,112,108,97,116,101]),[be([112,108,117,103,105,110,78,97,109,101])]:be([84,101,109,112,108,97,116,101,85,73]),[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:be([116,101,109,112,108,97,116,101,76,105,99,101,110,115,101,75,101,121]),[be([104,97,110,100,108,101,114])]:be([99,104,101,99,107,76,105,99,101,110,115,101]),[be([111,112,116,105,111,110,115])]:{[be([102,103,105])]:[12,14]}},{[be([105,100])]:10,[be([102,101,97,116,117,114,101,78,97,109,101])]:be([80,97,115,116,101,32,102,114,111,109,32,79,102,102,105,99,101,32,69,110,104,97,110,99,101,100]),[be([112,108,117,103,105,110,78,97,109,101])]:be([80,97,115,116,101,70,114,111,109,79,102,102,105,99,101,69,110,104,97,110,99,101,100,73,110,108,105,110,101,114]),[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:be([112,97,115,116,101,70,114,111,109,79,102,102,105,99,101,69,110,104,97,110,99,101,100,76,105,99,101,110,115,101,75,101,121]),[be([104,97,110,100,108,101,114])]:be([99,104,101,99,107,76,105,99,101,110,115,101]),[be([111,112,116,105,111,110,115])]:{[be([102,103,105])]:[12]}},{[be([105,100])]:11,[be([102,101,97,116,117,114,101,78,97,109,101])]:be([65,73,32,65,115,115,105,115,116,97,110,116]),[be([112,108,117,103,105,110,78,97,109,101])]:be([65,73,65,115,115,105,115,116,97,110,116,85,73]),[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:be([97,105,76,105,99,101,110,115,101,75,101,121]),[be([104,97,110,100,108,101,114])]:be([99,104,101,99,107,76,105,99,101,110,115,101])},{[be([105,100])]:12,[be([102,101,97,116,117,114,101,78,97,109,101])]:be([80,114,111,100,117,99,116,105,118,105,116,121,32,112,97,99,107])},{[be([105,100])]:13,[be([102,101,97,116,117,114,101,78,97,109,101])]:be([67,97,115,101,32,67,104,97,110,103,101]),[be([112,108,117,103,105,110,78,97,109,101])]:be([67,97,115,101,67,104,97,110,103,101,85,73]),[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:be([99,97,115,101,67,104,97,110,103,101,76,105,99,101,110,115,101,75,101,121]),[be([104,97,110,100,108,101,114])]:be([99,104,101,99,107,76,105,99,101,110,115,101]),[be([111,112,116,105,111,110,115])]:{[be([102,103,105])]:[12]}},{[be([105,100])]:14,[be([102,101,97,116,117,114,101,78,97,109,101])]:be([68,114,117,112,97,108,32,112,97,99,107]),[be([102,111,114,98,105,100,100,101,110,72,97,110,100,108,101,114])]:be([102,111,114,98,105,100,100,101,110,72,97,110,100,108,101,114,70,111,114,68,114,117,112,97,108])},{[be([105,100])]:15,[be([102,101,97,116,117,114,101,78,97,109,101])]:be([77,117,108,116,105,32,76,101,118,101,108,32,76,105,115,116]),[be([112,108,117,103,105,110,78,97,109,101])]:be([77,117,108,116,105,76,101,118,101,108,76,105,115,116,69,100,105,116,105,110,103]),[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:be([109,117,108,116,105,76,101,118,101,108,76,105,115,116,76,105,99,101,110,115,101,75,101,121]),[be([104,97,110,100,108,101,114])]:be([99,104,101,99,107,76,105,99,101,110,115,101])},{[be([105,100])]:16,[be([102,101,97,116,117,114,101,78,97,109,101])]:be([77,101,114,103,101,32,70,105,101,108,100,115]),[be([112,108,117,103,105,110,78,97,109,101])]:be([77,101,114,103,101,70,105,101,108,100,115,85,73]),[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:be([109,101,114,103,101,70,105,101,108,100,115,76,105,99,101,110,115,101,75,101,121]),[be([104,97,110,100,108,101,114])]:be([99,104,101,99,107,76,105,99,101,110,115,101]),[be([111,112,116,105,111,110,115])]:{[be([102,103,105])]:[12]}}];return We(Ne),Ne;function Le(Je){return 1<<Je-1}function We(Je){Je[be([102,111,114,69,97,99,104])](Wt=>{Wt[be([112,101,114,109,105,115,115,105,111,110,77,97,115,107])]=Le(Wt[be([105,100])]),ke(Wt)&&Wt[be([99,104,101,99,107,65,108,115,111])]&&We(Wt[be([99,104,101,99,107,65,108,115,111])])})}}function ke(Ne){return be([112,108,117,103,105,110,78,97,109,101])in Ne}const Ie=[1,85,78,115,198,255,50,112,83,87,161],Ae=[127,34,6,211,167,86,146,199,132,160,18];function Se(Ne){const Le=[29,221,175,90,231,133,239,240,75,180];return Oe(Ne,new Uint8Array([...Ie,...Le,...Ae]))}function Oe(Ne,Le){const We=Ve(Ne),Je=Array[be([102,114,111,109])](Ge(We)),Wt=Je[be([112,111,112])](),nn=Je[be([112,111,112])]();return pn(te(Je,Le,nn+256*Wt))}function Ve(Ne){const Le=atob(Ne),[We,Je]=Le[be([115,112,108,105,116])](be([45]));try{if(atob(Je))return atob(We)}catch{}return Le}function Me(Ne){try{const Le=Se(Ne),We=JSON[be([112,97,114,115,101])](Le),Je=parseInt(We[be([49])]),Wt=We[be([50])]||"",nn=parseInt(We[be([51])]),cn=parseInt(We[be([52])])||0,fn=parseInt(We[be([53])])||0;return{[be([112,114,111,100,117,99,116,78,97,109,101])]:Wt,[be([97,108,108,111,119,101,100,80,108,117,103,105,110,115])]:cn,[be([101,120,112,105,114,97,116,105,111,110,68,97,116,101])]:Je,[be([105,115,84,114,105,97,108])]:nn,[be([105,115,73,110,116,101,114,110,97,108])]:fn}}catch{return null}}const De=ve(),Fe={[be([99,104,101,99,107,76,105,99,101,110,115,101])]:Qe,[be([99,104,101,99,107,76,105,99,101,110,115,101,70,111,114,84,114,97,99,107,67,104,97,110,103,101,115])]:je,[be([99,104,101,99,107,76,105,99,101,110,115,101,70,111,114,82,101,118,105,115,105,111,110,72,105,115,116,111,114,121])]:Ye},Be=xe[be([99,111,110,115,116,114,117,99,116,111,114])][be([112,108,117,103,105,110,78,97,109,101])],$e=be([99,111,110,116,101,120,116])in xe?xe.context:xe.editor,Ue=be([52,48,52,56,49,52,50,50]),He=be([65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,48,49,50,51,52,53,54,55,56,57]),ze=$e.config.get(be([108,105,99,101,110,115,101,75,101,121])),qe=De[be([102,105,108,116,101,114])](ke)[be([102,105,110,100])](Ne=>Ne[be([112,108,117,103,105,110,78,97,109,101])]===Be);function Ke(Ne,Le){Fe[Le[be([104,97,110,100,108,101,114])]](Ne,Le),Le[be([99,104,101,99,107,65,108,115,111])]&&Le[be([99,104,101,99,107,65,108,115,111])][be([102,105,108,116,101,114])](We=>Kt($e,We[be([112,108,117,103,105,110,78,97,109,101])]))[be([102,111,114,69,97,99,104])](We=>Ke(Ne,We))}function Qe(Ne,Le){Ze(ht(Ne,Le),Le)}function je(Ne,Le){function We(Je,Wt){try{if(Kt($e,be([84,114,97,99,107,67,104,97,110,103,101,115,69,100,105,116,105,110,103]))&&Je){const nn=Xt($e,be([84,114,97,99,107,67,104,97,110,103,101,115,69,100,105,116,105,110,103]))[be([95,101,120,101,99,117,116,101,83,117,103,103,101,115,116,105,111,110])];if(parseInt(nn)/2>Je[be([101,120,112,105,114,97,116,105,111,110,68,97,116,101])])return Bt(Wt[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+be([73,110,118,97,108,105,100]))}return ht(Je,Wt)}catch{return Bt(Wt[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+be([73,110,118,97,108,105,100]))}}Ze(We(Ne,Le),Le)}function Ye(Ne,Le){const We=Ae[0]*Ie[1],Je=Ae[0]*Ie[2],Wt=Ae[2]*Ie[2];Kt($e,be([87,101,98,83,111,99,107,101,116,71,97,116,101,119,97,121]))&&Xt($e,be([87,101,98,83,111,99,107,101,116,71,97,116,101,119,97,121]))[be([115,116,97,116,101])]==be([99,111,110,110,101,99,116,101,100])&&(window[Jt()]=Wt);function nn(Xe,Qt){try{return un()?Bt(Qt[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+be([86,97,108,105,100])):ht(Xe,Qt)}catch{return Bt(Qt[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+be([73,110,118,97,108,105,100]))}}function cn(Xe,Qt){if(Xe==Qt[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+be([73,110,118,97,108,105,100]))zt();else if(Xe==Qt[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+be([84,114,105,97,108])){const rn=fn();rn&&ln(rn,Qt[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]);const xn=dn();window[be([115,101,116,84,105,109,101,111,117,116])](()=>{ln(be([116,105,109,101]),Qt[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])])},xn);const wn=Xt($e,be([82,101,118,105,115,105,111,110,115,82,101,112,111,115,105,116,111,114,121]))[be([95,114,101,118,105,115,105,111,110,115])];wn[be([108,101,110,103,116,104])]>=7?ln(be([114,101,118,105,115,105,111,110,115]),Qt[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]):wn.on(be([97,100,100]),()=>{wn[be([108,101,110,103,116,104])]>=7&&ln(be([114,101,118,105,115,105,111,110,115]),Qt[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])])})}}function fn(){if(!Kt($e,be([82,101,118,105,115,105,111,110,86,105,101,119,101,114])))return!1;for(const Xe in window)if(Number.isNaN(Number(Xe))){if(window[Xe]===We)return be([116,105,109,101]);if(window[Xe]===Je)return be([114,101,118,105,115,105,111,110,115])}return!1}function un(){if(!Kt($e,be([82,101,118,105,115,105,111,110,86,105,101,119,101,114])))return!1;for(const Xe in window)if(Number.isNaN(Number(Xe))&&window[Xe]===Wt)return!0;return!1}function ln(Xe,Qt){zt(),Bt(Qt+be([84,114,105,97,108,76,105,109,105,116,58])+Xe),window[Jt()]=Xe===be([116,105,109,101])?We:Je}function dn(){let Xe=Ae[6]*Ie[8]*Ie[6];return Kt($e,be([82,101,118,105,115,105,111,110,86,105,101,119,101,114]))&&(Xe/=10),Xe}function zt(){const Xe=$e;function Qt(){Kt(Xe,be([82,101,118,105,115,105,111,110,84,114,97,99,107,101,114]))&&(Xt(Xe,be([82,101,118,105,115,105,111,110,84,114,97,99,107,101,114]))[be([117,110,98,105,110,100])](be([105,115,69,110,97,98,108,101,100])),Xt(Xe,be([82,101,118,105,115,105,111,110,84,114,97,99,107,101,114]))[be([105,115,69,110,97,98,108,101,100])]=!1,Xt(Xe,be([82,101,118,105,115,105,111,110,84,114,97,99,107,101,114]))[be([117,112,100,97,116,101])]=sn,Xt(Xe,be([82,101,118,105,115,105,111,110,84,114,97,99,107,101,114]))[be([115,97,118,101,82,101,118,105,115,105,111,110])]=sn,Xe[be([109,111,100,101,108])][be([99,104,97,110,103,101])]=sn,Xe[be([109,111,100,101,108])][be([101,110,113,117,101,117,101,67,104,97,110,103,101])]=sn,Xe[be([101,110,97,98,108,101,82,101,97,100,79,110,108,121,77,111,100,101])](be([109,111,100,101,108]))),Kt(Xe,be([82,101,118,105,115,105,111,110,86,105,101,119,101,114]))&&(Xt(Xe,be([82,101,118,105,115,105,111,110,86,105,101,119,101,114]))[be([117,110,98,105,110,100])](be([105,115,69,110,97,98,108,101,100])),Xt(Xe,be([82,101,118,105,115,105,111,110,86,105,101,119,101,114]))[be([105,115,69,110,97,98,108,101,100])]=!1,Xt(Xe,be([82,101,118,105,115,105,111,110,86,105,101,119,101,114]))[be([99,111,109,112,97,114,101])]=sn,Xt(Xe,be([82,101,118,105,115,105,111,110,86,105,101,119,101,114]))[be([95,103,101,116,68,105,102,102])]=sn)}Xe[be([115,116,97,116,101])]==be([114,101,97,100,121])?Qt():Xe[be([111,110,99,101])](be([114,101,97,100,121]),()=>{if(Kt(Xe,be([82,101,118,105,115,105,111,110,84,114,97,99,107,101,114]))&&Qt(),Kt(Xe,be([82,101,118,105,115,105,111,110,86,105,101,119,101,114]))){const an=Xt(Xe,be([82,101,118,105,115,105,111,110,115,82,101,112,111,115,105,116,111,114,121])),rn=an.getRevision(0),xn=an.getEarlierVisibleRevision(rn[be([105,100])]);Xt(Xe,be([82,101,118,105,115,105,111,110,86,105,101,119,101,114]))[be([99,111,109,112,97,114,101])](rn[be([105,100])],xn?xn[be([105,100])]:null,1).then(()=>Qt())}})}cn(nn(Ne,Le),Le)}function ht(Ne,Le){try{return tn(Le)?Bt(Le[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+be([86,97,108,105,100])):Ne&&hn(Ne[be([97,108,108,111,119,101,100,80,108,117,103,105,110,115])],Le)?Ne[be([105,115,73,110,116,101,114,110,97,108])]&&!window[be([111,112,101,110])][be([99,108,111,115,101,100])]||parseInt(Ue)/2>Ne[be([101,120,112,105,114,97,116,105,111,110,68,97,116,101])]?Bt(Le[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+be([73,110,118,97,108,105,100])):Ne[be([105,115,84,114,105,97,108])]?Bt(Le[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+be([84,114,105,97,108])):Bt(Le[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+be([86,97,108,105,100])):Bt(Le[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+be([73,110,118,97,108,105,100]))}catch{return Bt(Le[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+be([73,110,118,97,108,105,100]))}}function Ze(Ne,Le){if($e instanceof Context){const We=$e;Ne==Le[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+be([73,110,118,97,108,105,100])?Yt(We):Ne==Le[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+be([84,114,105,97,108])&&window[be([115,101,116,84,105,109,101,111,117,116])](()=>{Yt(We),Bt(Le[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+be([84,114,105,97,108,76,105,109,105,116,58,116,105,109,101]))},Ae[6]*Ie[8]*Ie[6]),We[be([101,100,105,116,111,114,115])][be([111,110])](be([97,100,100]),(Je,Wt)=>{Ne!=Le[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+be([73,110,118,97,108,105,100])&&Ne!=Le[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+be([84,114,105,97,108,76,105,109,105,116,58,116,105,109,101])&&Ne!=Le[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+be([84,114,105,97,108,76,105,109,105,116,58,111,112,101,114,97,116,105,111,110,115])||en(Wt)})}else{const We=$e;Ne==Le[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+be([73,110,118,97,108,105,100])?en(We):Ne==Le[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+be([84,114,105,97,108])&&We[be([111,110])](be([114,101,97,100,121]),()=>{let Je=0;We[be([109,111,100,101,108])][be([111,110])](be([97,112,112,108,121,79,112,101,114,97,116,105,111,110]),(Wt,nn)=>{nn[0][be([105,115,68,111,99,117,109,101,110,116,79,112,101,114,97,116,105,111,110])]&&Je++,Je===504&&(en(We),Bt(Le[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+be([84,114,105,97,108,76,105,109,105,116,58,111,112,101,114,97,116,105,111,110,115])),Wt[be([111,102,102])]())},{priority:be([104,105,103,104,101,115,116])})})}}function Bt(Ne){const Le=Jt();return $e[Le]=Ne,Ne}function Jt(){const Ne=String(window[be([112,101,114,102,111,114,109,97,110,99,101])][be([110,111,119])]())[be([114,101,112,108,97,99,101])](be([46]),"");let Le="";for(let We=0;We<Ne[be([108,101,110,103,116,104])];We+=2){let Je=parseInt(Ne[be([115,117,98,115,116,114,105,110,103])](We,We+2));Je>=He[be([108,101,110,103,116,104])]&&(Je-=He[be([108,101,110,103,116,104])]),Le+=He[Je]}return Le}function Yt(Ne){for(const Le of Ne[be([101,100,105,116,111,114,115])])en(Le);Xt(Ne,be([67,111,109,109,101,110,116,115,82,101,112,111,115,105,116,111,114,121]))[be([115,119,105,116,99,104,82,101,97,100,79,110,108,121])](!0),Xt(Ne,be([67,111,109,109,101,110,116,115,82,101,112,111,115,105,116,111,114,121]))[be([115,119,105,116,99,104,82,101,97,100,79,110,108,121])]=sn}function en(Ne){function Le(){Ne[be([109,111,100,101,108])][be([99,104,97,110,103,101])]=sn,Ne[be([109,111,100,101,108])][be([101,110,113,117,101,117,101,67,104,97,110,103,101])]=sn,Ne[be([101,110,97,98,108,101,82,101,97,100,79,110,108,121,77,111,100,101])](be([109,111,100,101,108]))}Ne[be([115,116,97,116,101])]==be([114,101,97,100,121])?Le():Ne[be([111,110,99,101])](be([114,101,97,100,121]),()=>Le())}function sn(){return null}function hn(Ne,Le){const We=!!(Ne&Le[be([112,101,114,109,105,115,115,105,111,110,77,97,115,107])]),Je=mn(Ne,Le);return We||Je}function mn(Ne,Le){const We=(Le[be([111,112,116,105,111,110,115])]||{})[be([102,103,105])]||null;return!!We&&De[be([102,105,108,116,101,114])](Je=>We[be([105,110,99,108,117,100,101,115])](Je[be([105,100])]))[be([102,105,108,116,101,114])](Je=>!bn(Je))[be([115,111,109,101])](Je=>!!(Ne&Je[be([112,101,114,109,105,115,115,105,111,110,77,97,115,107])]))}function bn(Ne){const Le={[be([102,111,114,98,105,100,100,101,110,72,97,110,100,108,101,114,70,111,114,68,114,117,112,97,108])]:gn};return!!Ne.forbiddenHandler&&Le[Ne.forbiddenHandler]()}function gn(){return!window[be([68,114,117,112,97,108])]||!Kt($e,be([100,114,117,112,97,108,80,111,119,101,114,101,100,66,121]))}function tn(Ne){if(!Kt($e,Ne[be([112,108,117,103,105,110,78,97,109,101])]))return!0;const Le=Ne[be([111,112,116,105,111,110,115])]||{},We=Le[be([97,105,119,115,103,105,99])]||!1,Je=Le[be([97,105,116,99,100,103,105,108])]||!1,Wt=Le[be([97,105,114,118,105,105,108])]||!1;return Kt($e,be([87,101,98,83,111,99,107,101,116,71,97,116,101,119,97,121]))&&Xt($e,be([87,101,98,83,111,99,107,101,116,71,97,116,101,119,97,121]))[be([115,116,97,116,101])]==be([99,111,110,110,101,99,116,101,100])&&We||Kt($e,be([84,114,97,99,107,67,104,97,110,103,101,115,68,97,116,97,71,101,116,116,101,114]))&&Xt($e,be([84,114,97,99,107,67,104,97,110,103,101,115,68,97,116,97,71,101,116,116,101,114]))[be([114,101,115,117,108,116])]==be([101,110,100])&&Je?!0:!(!Kt($e,be([82,101,118,105,115,105,111,110,86,105,101,119,101,114,73,110,116,101,103,114,97,116,105,111,110]))||Xt($e,be([82,101,118,105,115,105,111,110,86,105,101,119,101,114,73,110,116,101,103,114,97,116,105,111,110]))[be([114,101,115,117,108,116])]!=be([101,110,100])||!Wt)}function Kt(Ne,Le){return Ne[be([112,108,117,103,105,110,115])][be([104,97,115])](Le)}function Xt(Ne,Le){return Ne[be([112,108,117,103,105,110,115])][be([103,101,116])](Le)}function pn(Ne){let Le="";for(const We of Ne)Le+=String[be([102,114,111,109,67,104,97,114,67,111,100,101])](We);return Le}function Ge(Ne){const Le=new Uint8Array(Ne[be([108,101,110,103,116,104])]);for(let We=0;We<Ne[be([108,101,110,103,116,104])];We++)Le[We]=Ne[be([99,104,97,114,67,111,100,101,65,116])](We);return Le}qe&&Ke(Me(ze),qe)})(t)})(this)}_updateTableOfContentsElements(){this._tableOfContentsElements.forEach(t=>{t.rootName!=="$graveyard"&&this.editor.editing.reconvertItem(t)})}_trackNewToCElements(){for(const t of this.editor.model.document.differ.getChanges({includeChangesInGraveyard:!0})){if(t.type!=="insert"||t.name!=="tableOfContents")return;this._tableOfContentsElements.add(t.position.nodeAfter)}}_defineSchema(){this.editor.model.schema.register("tableOfContents",{inheritAllFrom:"$blockObject"})}_defineConverters(){const t=this.editor.conversion,te=this.editor.t;t.for("upcast").elementToElement({model:"tableOfContents",view:{name:"div",classes:"table-of-contents"}}),t.for("dataDowncast").elementToStructure({model:"tableOfContents",view:(be,{writer:xe})=>this._createTableOfContents(xe,!0)}),t.for("editingDowncast").elementToStructure({model:"tableOfContents",view:(be,{writer:xe})=>{this._tableOfContentsElements.add(be);const ve=this._createTableOfContents(xe);return toWidget(ve,xe,{label:te("Table of contents")})}}),this.editor.data.registerRawContentMatcher({name:"div",classes:"table-of-contents"}),this.editor.editing.mapper.on("viewToModelPosition",this._redirectMapper(),{priority:"high"})}_createTableOfContents(t,te=!1){const be=this.editor.t,xe=t.createContainerElement("div",{class:"table-of-contents"+(this._currentOutlineDefinitions.length===0?" table-of-contents_empty":""),...!te&&{"data-table-of-contents-label":be("Table of contents")}});this._currentOutlineDefinitions.length===0&&te===!1&&t.insert(t.createPositionAt(xe,"end"),t.createContainerElement("p",{class:"table-of-contents__placeholder"},[t.createText(be("No headings were found in the document."))]));const ve=te?"":"["+be("Empty heading")+"]";let ke=xe;return this._currentOutlineDefinitions.forEach((Ie,Ae,Se)=>{const Oe=this.editor.model.hasContent(Ie.modelElement,{ignoreWhitespaces:!0}),Ve=Oe?Ie.text:ve,Me=Ie.modelElement.getAttribute(this._headingIdModelAttributeName),De=t.createContainerElement("a",{href:"#"+Me,...!te&&{tabindex:"-1"}},[t.createText(Ve)]),Fe=this.editor.config.get("documentOutline.showEmptyHeadings");t.setCustomProperty("tableOfContentsHeadingIndex",Ae,De);const Be=t.createContainerElement("li",null,[Oe||!te&&Fe?De:t.createText("")]),$e=Ae?Se[Ae-1].level:0,Ue=Math.abs(Ie.level-$e);if(Ie.level>$e){const He=S$2(Be,Ue,t);t.insert(t.createPositionAt(ke,"end"),He)}else{const He=function(ze,qe){return ze.getAncestors({includeSelf:!0,parentFirst:!0}).filter(Ke=>Ke.is("element","ol"))[qe]}(ke,Ue);t.insert(t.createPositionAt(He,"end"),Be)}ke=Be}),xe}_handleScrollToHeading(t){const te=this._currentOutlineDefinitions[t].modelElement;this.editor.model.change(be=>{be.setSelection(te,0)}),this.editor.editing.view.scrollToTheSelection({alignToTop:!0,forceScroll:!0})}_redirectMapper(){return(t,te)=>{const be=te.mapper,xe=be.findMappedViewAncestor(te.viewPosition),ve=be.toModelElement(xe);ve.is("element","tableOfContents")&&(te.modelPosition=this.editor.model.createPositionAt(ve,0),t.stop())}}};function S$2(Te,we,t){return we===1?t.createContainerElement("ol",null,[Te]):t.createContainerElement("ol",null,[t.createContainerElement("li",null,[S$2(Te,we-1,t)])])}let s$7=class extends Plugin{constructor(t){super(t);Re(this,"_licenseKeyCheckInterval");this._licenseKeyCheckInterval=null}static get pluginName(){return"TableOfContentsUI"}init(){const t=this.editor;t.ui.componentFactory.add("tableOfContents",()=>{const be=this._createButton(ButtonView);return be.tooltip=!0,be}),t.ui.componentFactory.add("menuBar:tableOfContents",()=>this._createButton(MenuBarMenuListItemButtonView)),this.licenseKey=t.config.get("licenseKey");const te=this.editor;this._licenseKeyCheckInterval=setInterval(()=>{let be;for(const xe in te){const ve=xe,ke=te[ve];if(ke==="tableOfContentsLicenseKeyTrial"||ke==="tableOfContentsLicenseKeyInvalid"||ke==="tableOfContentsLicenseKeyValid"||ke==="tableOfContentsLicenseKeyTrialLimit:operations"){delete te[ve],be=ke;break}}if(be==="tableOfContentsLicenseKeyInvalid")throw clearInterval(this._licenseKeyCheckInterval),new CKEditorError("table-of-contents-invalid-license-key",null);if(be==="tableOfContentsLicenseKeyTrial"&&console.info("You are using the trial version of CKEditor 5 table of contents plugin with limited usage. Make sure you will not use it in the production environment."),be==="tableOfContentsLicenseKeyTrialLimit:operations")throw clearInterval(this._licenseKeyCheckInterval),new CKEditorError("table-of-contents-trial-license-key-reached-limit-changes",null);be==="tableOfContentsLicenseKeyValid"&&clearInterval(this._licenseKeyCheckInterval)},1e3)}_createButton(t){const te=this.editor,be=te.locale.t,xe=te.commands.get("insertTableOfContents"),ve=new t(te.locale);return ve.set({label:be("Table of contents"),icon:a$9.tableOfContents}),ve.bind("isEnabled").to(xe,"isEnabled"),this.listenTo(ve,"execute",()=>{te.execute("insertTableOfContents"),te.editing.view.focus()}),ve}destroy(){this._licenseKeyCheckInterval&&clearInterval(this._licenseKeyCheckInterval)}},a$6=class extends Plugin{static get requires(){return[r$8,s$7]}static get pluginName(){return"TableOfContents"}};function f$5(){const Te=[],we=[];for(const t of Array.from(document.styleSheets))if(t.ownerNode.hasAttribute("data-cke"))for(const te of Array.from(t.cssRules))te.cssText.indexOf(".ck-content")!==-1?Te.push(te.cssText):te.cssText.indexOf(":root")!==-1&&we.push(te.cssText);return Te.length||console.warn("The editor stylesheet could not be found in the document. Check your webpack config – style-loader should use data-cke=true attribute for the editor stylesheet."),[...we,...Te].join(" ").trim()}let o$6=class extends Command{constructor(we){super(we),this.set("isBusy",!1),this.affectsData=!1}refresh(){this.isEnabled=!this.isBusy,this.value=this.isBusy?"pending":void 0}execute(we={}){const t=this.editor,te=t.t,be=we.converterUrl||"https://pdf-converter.cke-cs.com/v1/convert/",xe=we.dataCallback||(Ie=>Ie.data.get()),ve=t.plugins.get("ExportPdf"),ke=we.token||ve._token;return this.isBusy=!0,this.refresh(),function(Ie){if(!Ie)return new Promise(Se=>Se(""));const Ae=[];for(const Se of Ie)Se!=="EDITOR_STYLES"?Ae.push(window.fetch(Se).then(Oe=>Oe.text())):Ae.push(f$5());return Promise.all(Ae).then(Se=>Se.join(" ").trim())}(we.stylesheets||["EDITOR_STYLES"]).then(async Ie=>{t.ui.ariaLiveAnnouncer.announce(te("PDF export started"));const Ae={html:`<html>
						<head>
							<title>CKEditor 5 PDF document</title>
							<meta charset="utf-8">
						</head>
						<body>
							<div class="ck-content" dir="`+t.locale.contentLanguageDirection+`">
								`+await xe(t)+`
							</div>
						</body>
					</html>`,css:Ie,options:we.converterOptions},Se={method:"POST",headers:{"Content-Type":"application/json",Accept:"application/pdf",...ke?{Authorization:ke.value}:null,"x-cs-app-id":we.appID||"cke5"},body:JSON.stringify(Ae)};return window.fetch(be,Se).then(Oe=>{if(Oe.status!==200)throw Oe;return Oe.blob()}).then(Oe=>{t.ui.ariaLiveAnnouncer.announce(te("PDF export successful"));const Ve=typeof we.fileName=="function"?we.fileName():we.fileName;this._downloadFile(Oe,Ve||"document.pdf")})}).catch(Ie=>{const Ae=t.plugins.get("Notification");throw t.ui.ariaLiveAnnouncer.announce(te("PDF export failed"),{politeness:"assertive"}),Ae.showWarning(te("An error occurred while generating the PDF.")),Ie}).finally(()=>{this.isBusy=!1,this.refresh()})}_downloadFile(we,t){const te=document.createElement("a");te.href=window.URL.createObjectURL(we),te.download=t,te.click(),te.remove()}},i$7=class extends Plugin{static get pluginName(){return"ExportPdfUI"}init(){const we=this.editor;we.ui.componentFactory.add("exportPdf",()=>{const t=this._createButton(ButtonView),te=we.commands.get("exportPdf");return t.set({tooltip:!0}),t.bind("isOn").to(te,"isBusy"),t}),we.ui.componentFactory.add("menuBar:exportPdf",()=>this._createButton(MenuBarMenuListItemButtonView))}_createButton(we){const t=this.editor,te=t.config.get("exportPdf")||{},be=t.locale.t,xe=t.commands.get("exportPdf"),ve=new we(t.locale),ke=new SpinnerView;return ve.children.add(ke),ke.bind("isVisible").to(xe,"isBusy"),ve.iconView.bind("isVisible").to(xe,"isBusy",Ie=>!Ie),ve.set({icon:`<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M19 4.5 14 0H3v6.5h1.5v-5h8v5h5V11H19V4.5ZM14 2l3.3 3H14V2Z"/><path d="m12.452 18.5 1.25 1.5H3v-3h1.5v1.5h7.952Z"/><path d="M19.826 16.843a.75.75 0 1 0-1.152-.96L17.5 17.29V13H16v4.29l-1.174-1.408a.75.75 0 1 0-1.152.96l2.346 2.816a.95.95 0 0 0 1.46 0l2.346-2.815Z"/><path d="M1.63 14.24V12.3h.88c.66 0 1.14-.15 1.46-.45.32-.3.48-.71.48-1.24 0-.52-.15-.91-.44-1.2C3.7 9.15 3.28 9 2.69 9H0v5.24h1.63Zm.4-3h-.4v-1.17h.46c.3 0 .5.05.62.17.1.11.16.25.16.42 0 .16-.06.3-.19.41-.13.11-.34.16-.66.16l.01.01Zm5.7 3c.28 0 .6-.05.96-.14.26-.07.5-.21.73-.42.22-.2.4-.47.53-.77.12-.31.19-.75.19-1.3 0-.37-.04-.7-.13-1.02a2.3 2.3 0 0 0-.42-.84c-.19-.24-.43-.43-.72-.56C8.57 9.06 8.2 9 7.72 9h-2.4v5.24H7.73Zm-.4-1.19h-.4v-2.86h.4c.43 0 .73.1.91.3.18.2.27.59.27 1.14 0 .42-.04.73-.12.91a.76.76 0 0 1-.34.4c-.14.07-.38.11-.72.11Zm5.3 1.2V12.1h2.02v-1.06h-2.03v-.91H15V9h-4v5.24h1.62l.01.01Z"/></svg>
`}),ve.bind("isEnabled").to(xe,"isEnabled"),ve.bind("label").to(xe,"isBusy",Ie=>be(Ie?"Exporting PDF document":"Export to PDF")),this.listenTo(ve,"execute",()=>{t.execute("exportPdf",te),t.editing.view.focus()}),ve}},s$6=class extends Plugin{constructor(){super(...arguments);Re(this,"_token")}static get pluginName(){return"ExportPdf"}static get requires(){return["CloudServices",Notification,i$7]}init(){const t=this.editor,te=t.config.get("exportPdf")||{};t.commands.add("exportPdf",new o$6(t));const be=t.plugins.get("CloudServices");te.tokenUrl===!1?this._token=null:te.tokenUrl?be.registerTokenUrl(te.tokenUrl).then(xe=>{this._token=xe}):this._token=be.token}};function f$4(){const Te=[],we=[];for(const t of Array.from(document.styleSheets))if(t.ownerNode.hasAttribute("data-cke"))for(const te of Array.from(t.cssRules))te.cssText.indexOf(".ck-content")!==-1?Te.push(te.cssText):te.cssText.indexOf(":root")!==-1&&we.push(te.cssText);return Te.length||console.warn("The editor stylesheet could not be found in the document. Check your webpack config – style-loader should use data-cke=true attribute for the editor stylesheet."),[...we,...Te].join(" ").trim()}function d$7(Te){const we=Te.plugins.has("Users"),t=Te.plugins.has("CommentsRepository"),te=Te.plugins.has("TrackChanges"),be={};if(we&&t){const xe=function(ve){const ke={};if(!ve.length)return ke;for(const Ie of ve)Ie.comments.map(Ae=>{ke[Ie.id]===void 0&&(ke[Ie.id]=[]),ke[Ie.id].push({author:Ae.author.name,content:Ae.content,created:Ae.createdAt,is_resolved:Ie.isResolved})});return ke}(Te.plugins.get("CommentsRepository").getCommentThreads({skipNotAttached:!0,skipEmpty:!0}));Object.keys(xe).length&&(be.comments=xe)}if(we&&te){const xe=Te.plugins.get("TrackChanges"),ve=Te.plugins.get("Users"),ke=function(Ie,Ae){const Se={};if(!Ie.length||!Ae.length)return Se;for(const Oe of Ie)Se[Oe.id]={author:Ae.get(Oe.authorId).name,created:Oe.createdAt};return Se}(xe.getSuggestions({toJSON:!0}),ve.users);Object.keys(ke).length&&(be.suggestions=ke)}return(be.suggestions||be.comments)&&(be.timezone=new Intl.DateTimeFormat().resolvedOptions().timeZone),be}function h$3(Te){const we=Te.plugins.has("Users"),t=Te.plugins.has("CommentsRepository"),te=Te.plugins.has("TrackChanges"),be={},xe={};if(we&&t){const ve=function(ke){const Ie=[];if(!ke.length)return Ie;for(const Ae of ke){const Se=Ae.comments.map(Oe=>({author:Oe.author.name,content:Oe.content,created_at:Oe.createdAt}));Ie.push({thread_id:Ae.id,is_resolved:Ae.isResolved,comments:Se})}return Ie}(Te.plugins.get("CommentsRepository").getCommentThreads({skipNotAttached:!0,skipEmpty:!0}));ve.length&&(xe.comment_threads=ve)}if(we&&te){const ve=Te.plugins.get("TrackChanges"),ke=Te.plugins.get("Users"),Ie=function(Ae,Se){return!Ae.length||!Se.length?[]:Ae.map(Oe=>({id:Oe.id,author:Se.get(Oe.authorId).name,created_at:Oe.createdAt}))}(ve.getSuggestions({toJSON:!0}),ke.users);Ie.length&&(xe.suggestions=Ie)}return(xe.comment_threads||xe.suggestions)&&(be.timezone=new Intl.DateTimeFormat().resolvedOptions().timeZone,be.collaboration_features=xe),be}let e$4=class extends Command{constructor(we){super(we),this.set("isBusy",!1),this.affectsData=!1}refresh(){this.isEnabled=!this.isBusy,this.value=this.isBusy?"pending":void 0}execute(we={}){const t=this.editor,te=t.t,be=(we.version||1)===2,xe=we.converterUrl||(be?"https://docx-converter.cke-cs.com/v2/convert/html-docx":"https://docx-converter.cke-cs.com/v1/convert"),ve=we.converterOptions||{},ke=t.plugins.get("ExportWord"),Ie=we.token||ke._token,Ae=ve.auto_pagination!==!1,Se=we.dataCallback||(Oe=>Oe.data.get({pagination:Ae}));return this.isBusy=!0,this.refresh(),function(Oe){if(!Oe)return new Promise(Me=>Me(""));const Ve=[];for(const Me of Oe)Me!=="EDITOR_STYLES"?Ve.push(window.fetch(Me).then(De=>De.text())):Ve.push(f$4());return Promise.all(Ve).then(Me=>Me.join(" ").trim())}(we.stylesheets||["EDITOR_STYLES"]).then(async Oe=>{t.ui.ariaLiveAnnouncer.announce(te("Word document export started"));const Ve=await Se(t),Me={html:'<div class="ck-content" dir="'+t.locale.contentLanguageDirection+'">'+Ve+"</div>",css:Oe,[be?"config":"options"]:{...ve,...be?h$3(t):d$7(t)}},De={method:"POST",headers:{"Content-Type":"application/json",Accept:"application/docx",...Ie?{Authorization:Ie.value}:null},body:JSON.stringify(Me)};return window.fetch(xe,De).then(Fe=>{if(Fe.status!==200)throw Fe;return Fe.blob()}).then(Fe=>{t.ui.ariaLiveAnnouncer.announce(te("Word document export successful"));const Be=typeof we.fileName=="function"?we.fileName():we.fileName;this._downloadFile(Fe,Be||"document.docx")})}).catch(Oe=>{const Ve=t.plugins.get("Notification");throw t.ui.ariaLiveAnnouncer.announce(te("Word document export failed"),{politeness:"assertive"}),Ve.showWarning(te("An error occurred while generating the Word file.")),Oe}).finally(()=>{this.isBusy=!1,this.refresh()})}_downloadFile(we,t){const te=document.createElement("a");te.href=window.URL.createObjectURL(we),te.download=t,te.click(),te.remove()}},i$6=class extends Plugin{static get pluginName(){return"ExportWordUI"}init(){const we=this.editor;we.ui.componentFactory.add("exportWord",()=>{const t=we.commands.get("exportWord"),te=this._createButton(ButtonView);return te.set({tooltip:!0}),te.bind("isOn").to(t,"isBusy"),te}),we.ui.componentFactory.add("menuBar:exportWord",()=>this._createButton(MenuBarMenuListItemButtonView))}_createButton(we){const t=this.editor,te=t.config.get("exportWord")||{},be=t.locale.t,xe=t.commands.get("exportWord"),ve=new we(t.locale),ke=new SpinnerView;return ve.children.add(ke),ke.bind("isVisible").to(xe,"isBusy"),ve.iconView.bind("isVisible").to(xe,"isBusy",Ie=>!Ie),ve.set({icon:`<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M17.826 16.843a.75.75 0 0 0-1.152-.96L15.5 17.29V12H14v5.29l-1.174-1.408a.75.75 0 0 0-1.152.96l2.346 2.816a.95.95 0 0 0 1.46 0l2.346-2.815Z"/><path d="m14 0 5 4.5v9.741a2.737 2.737 0 0 0-1.5-.617V6.5h-5v-5h-8v3H3V0h11Zm0 2v3h3.3L14 2Z"/><path d="M3 17.5h6.746c.1.22.23.429.391.623l.731.877H3v-1.5Z"/><path d="M8.5 6a1.5 1.5 0 0 1 1.493 1.356L10 7.5v7a1.5 1.5 0 0 1-1.356 1.493L8.5 16h-7a1.5 1.5 0 0 1-1.493-1.356L0 14.5v-7a1.5 1.5 0 0 1 1.356-1.493L1.5 6h7ZM7.483 8.795l-.042.088-.986 2.534-.947-2.528-.043-.092a.601.601 0 0 0-1.042.008l-.042.093-.883 2.465-.937-2.475-.042-.089a.6.6 0 0 0-1.107.42l.027.093 1.514 4 .044.092a.6.6 0 0 0 1.041-.01l.041-.092.88-2.458.925 2.467.046.096a.6.6 0 0 0 1.032 0l.043-.09 1.554-4 .028-.093a.6.6 0 0 0-1.104-.43v.001Z"/></svg>
`}),ve.bind("isEnabled").to(xe,"isEnabled"),ve.bind("label").to(xe,"isBusy",Ie=>be(Ie?"Exporting Word document":"Export to Word")),this.listenTo(ve,"execute",()=>{t.execute("exportWord",te),t.editing.view.focus()}),ve}},s$5=class extends Plugin{constructor(){super(...arguments);Re(this,"_token")}static get pluginName(){return"ExportWord"}static get requires(){return["CloudServices",Notification,i$6]}init(){const t=this.editor,te=t.config.get("exportWord")||{};t.commands.add("exportWord",new e$4(t));const be=t.plugins.get("CloudServices");te.tokenUrl===!1?this._token=null:te.tokenUrl?be.registerTokenUrl(te.tokenUrl).then(xe=>{this._token=xe}):this._token=be.token}};const c$5="copyFormat",e$3="pasteFormat",A$3="ck-format-painter-active";let r$7=class extends Command{constructor(we){super(we),this.value=void 0,this.on("change:isEnabled",(t,te,be)=>{be||this.reset()}),this.on("change:value",()=>we.commands.get(e$3).refresh())}execute(){this.value=this._getFormattingAttributes()}reset(){this.value=void 0}_getFormattingAttributes(){const we=this.editor.model,t=we.document.selection;return Object.fromEntries(Array.from(t.getAttributes()).filter(([te])=>we.schema.getAttributeProperties(te).isFormatting))}},l$6=class extends Command{constructor(we){super(we),this._removeFormatCommand=new _$2(we)}execute(we={}){const t=this.editor.model,te=t.document.selection,be=Array.from(te.getRanges()),xe=te.isCollapsed?[this._createRangeOnEntireWord(t,te)]:be;t.change(ve=>{ve.setSelection(xe),this._removeFormatCommand.execute();for(const ke in we)for(const Ie of t.schema.getValidRanges(xe,ke))ve.setAttribute(ke,we[ke],Ie);ve.setSelection(be)})}_createRangeOnEntireWord(we,t){const te=we.createSelection(t);we.modifySelection(te,{unit:"word",direction:"backward"});const be=te.getFirstPosition();we.modifySelection(te,{unit:"word",direction:"forward"});const xe=te.getLastPosition();return we.createRange(be,xe)}},_$2=class extends Command{execute(){const we=this.editor.model,t=we.schema;we.change(te=>{for(const be of this._getFormattingItems(we.document.selection,t))if(be.is("selection"))for(const xe of this._getFormattingAttributes(be,t))te.removeSelectionAttribute(xe);else{const xe=te.createRangeOn(be);for(const ve of this._getFormattingAttributes(be,t))te.removeAttribute(ve,xe)}})}*_getFormattingItems(we,t){const te=be=>!!first(this._getFormattingAttributes(be,t));for(const be of we.getRanges())for(const xe of be.getItems())!t.isBlock(xe)&&te(xe)&&(yield xe);for(const be of we.getSelectedBlocks())te(be)&&(yield be);te(we)&&(yield we)}*_getFormattingAttributes(we,t){for(const[te]of we.getAttributes()){const be=t.getAttributeProperties(te);be&&be.isFormatting&&(yield te)}}},o$5=class extends Plugin{constructor(t){super(t);Re(this,"_licenseKeyCheckInterval");this._licenseKeyCheckInterval=null}static get pluginName(){return"FormatPainterEditing"}init(){const t=this.editor;t.commands.add(c$5,new r$7(t)),t.commands.add(e$3,new l$6(t)),this.licenseKey=t.config.get("licenseKey");const te=this.editor;this._licenseKeyCheckInterval=setInterval(()=>{let be;for(const xe in te){const ve=xe,ke=te[ve];if(ke==="formatPainterLicenseKeyTrial"||ke==="formatPainterLicenseKeyInvalid"||ke==="formatPainterLicenseKeyValid"||ke==="formatPainterLicenseKeyTrialLimit:operations"){delete te[ve],be=ke;break}}if(be==="formatPainterLicenseKeyInvalid")throw clearInterval(this._licenseKeyCheckInterval),new CKEditorError("format-painter-invalid-license-key",null);if(be==="formatPainterLicenseKeyTrial"&&console.info("You are using the trial version of CKEditor 5 format painter plugin with limited usage. Make sure you will not use it in the production environment."),be==="formatPainterLicenseKeyTrialLimit:operations")throw clearInterval(this._licenseKeyCheckInterval),new CKEditorError("format-painter-trial-license-key-reached-limit-changes",null);be==="formatPainterLicenseKeyValid"&&clearInterval(this._licenseKeyCheckInterval)},1e3)}destroy(){this._licenseKeyCheckInterval&&clearInterval(this._licenseKeyCheckInterval)}},a$5=class extends DomEmitterMixin(Plugin){static get pluginName(){return"FormatPainterUI"}init(){const we=this.editor,t=we.t;we.editing.view.addObserver(ClickObserver),we.accessibility.addKeystrokeInfos({keystrokes:[{label:t("Copy text formatting"),keystroke:"Ctrl+Alt+C"},{label:t("Paste text formatting"),keystroke:"Ctrl+Alt+V"}]}),we.ui.componentFactory.add("formatPainter",te=>{const be=te.t,xe=createDropdown(te,SplitButtonView),ve=we.commands.get(c$5);xe.buttonView.set({label:be("Paint formatting"),icon:a$9.paintRoller,keystroke:"Ctrl+Alt+C",tooltip:!0}),xe.class="ck-format-painter-dropdown",ve&&(xe.bind("isEnabled").to(ve,"isEnabled"),this.listenTo(ve,"change:isEnabled",(Ae,Se,Oe)=>{Oe||this._finishPainting()}),xe.buttonView.bind("isOn").to(ve,"value",Ae=>!!Ae),this.listenTo(we,"destroy",()=>this._toggleSpecialCursor(!1)),this.listenTo(ve,"change:value",(Ae,Se,Oe)=>{this._toggleSpecialCursor(!!Oe)}));const ke=new Model({withText:!0,label:be("Continuous painting"),tooltip:be("Keeps the painter on after setting the formatting."),isOn:!1,role:"menuitemcheckbox"});addListToDropdown(xe,new Collection([{type:"switchbutton",model:ke}]),{role:"menu"});const Ie=()=>{this._copyFormatting(),this.listenTo(global.window.document,"mouseup",()=>{this._pasteFormatting(),ke.isOn||this._finishPainting()})};return this.listenTo(xe,"execute",()=>{ke.isOn=!ke.isOn}),this.listenTo(xe.buttonView,"execute",()=>{we.editing.view.focus(),xe.buttonView.isOn?this._finishPainting():Ie()}),we.keystrokes.set("Ctrl+Alt+C",(Ae,Se)=>{Ie(),ke.isOn=!0,Se()},{priority:"high"}),we.keystrokes.set("Ctrl+Alt+V",(Ae,Se)=>{xe.buttonView.isOn&&(this._pasteFormatting(),ke.isOn||this._finishPainting(),Se())},{priority:"high"}),we.keystrokes.set("Esc",(Ae,Se)=>{xe.buttonView.isOn&&(ke.isOn=!1,this._finishPainting(),Se())}),xe})}afterInit(){(function(we){function t(be,xe,ve){const ke={};ke[te([110,117,109,98,101,114,79,102,82,111,117,110,100,115])]={16:10,24:12,32:14},ke[te([114,99,111,110])]=[1,2,4,8,16,32,64,128,27,54,108,216,171,77,154,47,94,188,99,198,151,53,106,212,179,125,250,239,197,145],ke[te([83])]=[99,124,119,123,242,107,111,197,48,1,103,43,254,215,171,118,202,130,201,125,250,89,71,240,173,212,162,175,156,164,114,192,183,253,147,38,54,63,247,204,52,165,229,241,113,216,49,21,4,199,35,195,24,150,5,154,7,18,128,226,235,39,178,117,9,131,44,26,27,110,90,160,82,59,214,179,41,227,47,132,83,209,0,237,32,252,177,91,106,203,190,57,74,76,88,207,208,239,170,251,67,77,51,133,69,249,2,127,80,60,159,168,81,163,64,143,146,157,56,245,188,182,218,33,16,255,243,210,205,12,19,236,95,151,68,23,196,167,126,61,100,93,25,115,96,129,79,220,34,42,144,136,70,238,184,20,222,94,11,219,224,50,58,10,73,6,36,92,194,211,172,98,145,149,228,121,231,200,55,109,141,213,78,169,108,86,244,234,101,122,174,8,186,120,37,46,28,166,180,198,232,221,116,31,75,189,139,138,112,62,181,102,72,3,246,14,97,53,87,185,134,193,29,158,225,248,152,17,105,217,142,148,155,30,135,233,206,85,40,223,140,161,137,13,191,230,66,104,65,153,45,15,176,84,187,22],ke[te([84,49])]=[3328402341,4168907908,4000806809,4135287693,4294111757,3597364157,3731845041,2445657428,1613770832,33620227,3462883241,1445669757,3892248089,3050821474,1303096294,3967186586,2412431941,528646813,2311702848,4202528135,4026202645,2992200171,2387036105,4226871307,1101901292,3017069671,1604494077,1169141738,597466303,1403299063,3832705686,2613100635,1974974402,3791519004,1033081774,1277568618,1815492186,2118074177,4126668546,2211236943,1748251740,1369810420,3521504564,4193382664,3799085459,2883115123,1647391059,706024767,134480908,2512897874,1176707941,2646852446,806885416,932615841,168101135,798661301,235341577,605164086,461406363,3756188221,3454790438,1311188841,2142417613,3933566367,302582043,495158174,1479289972,874125870,907746093,3698224818,3025820398,1537253627,2756858614,1983593293,3084310113,2108928974,1378429307,3722699582,1580150641,327451799,2790478837,3117535592,0,3253595436,1075847264,3825007647,2041688520,3059440621,3563743934,2378943302,1740553945,1916352843,2487896798,2555137236,2958579944,2244988746,3151024235,3320835882,1336584933,3992714006,2252555205,2588757463,1714631509,293963156,2319795663,3925473552,67240454,4269768577,2689618160,2017213508,631218106,1269344483,2723238387,1571005438,2151694528,93294474,1066570413,563977660,1882732616,4059428100,1673313503,2008463041,2950355573,1109467491,537923632,3858759450,4260623118,3218264685,2177748300,403442708,638784309,3287084079,3193921505,899127202,2286175436,773265209,2479146071,1437050866,4236148354,2050833735,3362022572,3126681063,840505643,3866325909,3227541664,427917720,2655997905,2749160575,1143087718,1412049534,999329963,193497219,2353415882,3354324521,1807268051,672404540,2816401017,3160301282,369822493,2916866934,3688947771,1681011286,1949973070,336202270,2454276571,201721354,1210328172,3093060836,2680341085,3184776046,1135389935,3294782118,965841320,831886756,3554993207,4068047243,3588745010,2345191491,1849112409,3664604599,26054028,2983581028,2622377682,1235855840,3630984372,2891339514,4092916743,3488279077,3395642799,4101667470,1202630377,268961816,1874508501,4034427016,1243948399,1546530418,941366308,1470539505,1941222599,2546386513,3421038627,2715671932,3899946140,1042226977,2521517021,1639824860,227249030,260737669,3765465232,2084453954,1907733956,3429263018,2420656344,100860677,4160157185,470683154,3261161891,1781871967,2924959737,1773779408,394692241,2579611992,974986535,664706745,3655459128,3958962195,731420851,571543859,3530123707,2849626480,126783113,865375399,765172662,1008606754,361203602,3387549984,2278477385,2857719295,1344809080,2782912378,59542671,1503764984,160008576,437062935,1707065306,3622233649,2218934982,3496503480,2185314755,697932208,1512910199,504303377,2075177163,2824099068,1841019862,739644986],ke[te([84,50])]=[2781242211,2230877308,2582542199,2381740923,234877682,3184946027,2984144751,1418839493,1348481072,50462977,2848876391,2102799147,434634494,1656084439,3863849899,2599188086,1167051466,2636087938,1082771913,2281340285,368048890,3954334041,3381544775,201060592,3963727277,1739838676,4250903202,3930435503,3206782108,4149453988,2531553906,1536934080,3262494647,484572669,2923271059,1783375398,1517041206,1098792767,49674231,1334037708,1550332980,4098991525,886171109,150598129,2481090929,1940642008,1398944049,1059722517,201851908,1385547719,1699095331,1587397571,674240536,2704774806,252314885,3039795866,151914247,908333586,2602270848,1038082786,651029483,1766729511,3447698098,2682942837,454166793,2652734339,1951935532,775166490,758520603,3000790638,4004797018,4217086112,4137964114,1299594043,1639438038,3464344499,2068982057,1054729187,1901997871,2534638724,4121318227,1757008337,0,750906861,1614815264,535035132,3363418545,3988151131,3201591914,1183697867,3647454910,1265776953,3734260298,3566750796,3903871064,1250283471,1807470800,717615087,3847203498,384695291,3313910595,3617213773,1432761139,2484176261,3481945413,283769337,100925954,2180939647,4037038160,1148730428,3123027871,3813386408,4087501137,4267549603,3229630528,2315620239,2906624658,3156319645,1215313976,82966005,3747855548,3245848246,1974459098,1665278241,807407632,451280895,251524083,1841287890,1283575245,337120268,891687699,801369324,3787349855,2721421207,3431482436,959321879,1469301956,4065699751,2197585534,1199193405,2898814052,3887750493,724703513,2514908019,2696962144,2551808385,3516813135,2141445340,1715741218,2119445034,2872807568,2198571144,3398190662,700968686,3547052216,1009259540,2041044702,3803995742,487983883,1991105499,1004265696,1449407026,1316239930,504629770,3683797321,168560134,1816667172,3837287516,1570751170,1857934291,4014189740,2797888098,2822345105,2754712981,936633572,2347923833,852879335,1133234376,1500395319,3084545389,2348912013,1689376213,3533459022,3762923945,3034082412,4205598294,133428468,634383082,2949277029,2398386810,3913789102,403703816,3580869306,2297460856,1867130149,1918643758,607656988,4049053350,3346248884,1368901318,600565992,2090982877,2632479860,557719327,3717614411,3697393085,2249034635,2232388234,2430627952,1115438654,3295786421,2865522278,3633334344,84280067,33027830,303828494,2747425121,1600795957,4188952407,3496589753,2434238086,1486471617,658119965,3106381470,953803233,334231800,3005978776,857870609,3151128937,1890179545,2298973838,2805175444,3056442267,574365214,2450884487,550103529,1233637070,4289353045,2018519080,2057691103,2399374476,4166623649,2148108681,387583245,3664101311,836232934,3330556482,3100665960,3280093505,2955516313,2002398509,287182607,3413881008,4238890068,3597515707,975967766],ke[te([84,51])]=[1671808611,2089089148,2006576759,2072901243,4061003762,1807603307,1873927791,3310653893,810573872,16974337,1739181671,729634347,4263110654,3613570519,2883997099,1989864566,3393556426,2191335298,3376449993,2106063485,4195741690,1508618841,1204391495,4027317232,2917941677,3563566036,2734514082,2951366063,2629772188,2767672228,1922491506,3227229120,3082974647,4246528509,2477669779,644500518,911895606,1061256767,4144166391,3427763148,878471220,2784252325,3845444069,4043897329,1905517169,3631459288,827548209,356461077,67897348,3344078279,593839651,3277757891,405286936,2527147926,84871685,2595565466,118033927,305538066,2157648768,3795705826,3945188843,661212711,2999812018,1973414517,152769033,2208177539,745822252,439235610,455947803,1857215598,1525593178,2700827552,1391895634,994932283,3596728278,3016654259,695947817,3812548067,795958831,2224493444,1408607827,3513301457,0,3979133421,543178784,4229948412,2982705585,1542305371,1790891114,3410398667,3201918910,961245753,1256100938,1289001036,1491644504,3477767631,3496721360,4012557807,2867154858,4212583931,1137018435,1305975373,861234739,2241073541,1171229253,4178635257,33948674,2139225727,1357946960,1011120188,2679776671,2833468328,1374921297,2751356323,1086357568,2408187279,2460827538,2646352285,944271416,4110742005,3168756668,3066132406,3665145818,560153121,271589392,4279952895,4077846003,3530407890,3444343245,202643468,322250259,3962553324,1608629855,2543990167,1154254916,389623319,3294073796,2817676711,2122513534,1028094525,1689045092,1575467613,422261273,1939203699,1621147744,2174228865,1339137615,3699352540,577127458,712922154,2427141008,2290289544,1187679302,3995715566,3100863416,339486740,3732514782,1591917662,186455563,3681988059,3762019296,844522546,978220090,169743370,1239126601,101321734,611076132,1558493276,3260915650,3547250131,2901361580,1655096418,2443721105,2510565781,3828863972,2039214713,3878868455,3359869896,928607799,1840765549,2374762893,3580146133,1322425422,2850048425,1823791212,1459268694,4094161908,3928346602,1706019429,2056189050,2934523822,135794696,3134549946,2022240376,628050469,779246638,472135708,2800834470,3032970164,3327236038,3894660072,3715932637,1956440180,522272287,1272813131,3185336765,2340818315,2323976074,1888542832,1044544574,3049550261,1722469478,1222152264,50660867,4127324150,236067854,1638122081,895445557,1475980887,3117443513,2257655686,3243809217,489110045,2662934430,3778599393,4162055160,2561878936,288563729,1773916777,3648039385,2391345038,2493985684,2612407707,505560094,2274497927,3911240169,3460925390,1442818645,678973480,3749357023,2358182796,2717407649,2306869641,219617805,3218761151,3862026214,1120306242,1756942440,1103331905,2578459033,762796589,252780047,2966125488,1425844308,3151392187,372911126],ke[te([84,52])]=[1667474886,2088535288,2004326894,2071694838,4075949567,1802223062,1869591006,3318043793,808472672,16843522,1734846926,724270422,4278065639,3621216949,2880169549,1987484396,3402253711,2189597983,3385409673,2105378810,4210693615,1499065266,1195886990,4042263547,2913856577,3570689971,2728590687,2947541573,2627518243,2762274643,1920112356,3233831835,3082273397,4261223649,2475929149,640051788,909531756,1061110142,4160160501,3435941763,875846760,2779116625,3857003729,4059105529,1903268834,3638064043,825316194,353713962,67374088,3351728789,589522246,3284360861,404236336,2526454071,84217610,2593830191,117901582,303183396,2155911963,3806477791,3958056653,656894286,2998062463,1970642922,151591698,2206440989,741110872,437923380,454765878,1852748508,1515908788,2694904667,1381168804,993742198,3604373943,3014905469,690584402,3823320797,791638366,2223281939,1398011302,3520161977,0,3991743681,538992704,4244381667,2981218425,1532751286,1785380564,3419096717,3200178535,960056178,1246420628,1280103576,1482221744,3486468741,3503319995,4025428677,2863326543,4227536621,1128514950,1296947098,859002214,2240123921,1162203018,4193849577,33687044,2139062782,1347481760,1010582648,2678045221,2829640523,1364325282,2745433693,1077985408,2408548869,2459086143,2644360225,943212656,4126475505,3166494563,3065430391,3671750063,555836226,269496352,4294908645,4092792573,3537006015,3452783745,202118168,320025894,3974901699,1600119230,2543297077,1145359496,387397934,3301201811,2812801621,2122220284,1027426170,1684319432,1566435258,421079858,1936954854,1616945344,2172753945,1330631070,3705438115,572679748,707427924,2425400123,2290647819,1179044492,4008585671,3099120491,336870440,3739122087,1583276732,185277718,3688593069,3772791771,842159716,976899700,168435220,1229577106,101059084,606366792,1549591736,3267517855,3553849021,2897014595,1650632388,2442242105,2509612081,3840161747,2038008818,3890688725,3368567691,926374254,1835907034,2374863873,3587531953,1313788572,2846482505,1819063512,1448540844,4109633523,3941213647,1701162954,2054852340,2930698567,134748176,3132806511,2021165296,623210314,774795868,471606328,2795958615,3031746419,3334885783,3907527627,3722280097,1953799400,522133822,1263263126,3183336545,2341176845,2324333839,1886425312,1044267644,3048588401,1718004428,1212733584,50529542,4143317495,235803164,1633788866,892690282,1465383342,3115962473,2256965911,3250673817,488449850,2661202215,3789633753,4177007595,2560144171,286339874,1768537042,3654906025,2391705863,2492770099,2610673197,505291324,2273808917,3924369609,3469625735,1431699370,673740880,3755965093,2358021891,2711746649,2307489801,218961690,3217021541,3873845719,1111672452,1751693520,1094828930,2576986153,757954394,252645662,2964376443,1414855848,3149649517,370555436],ke[te([85,49])]=[0,235474187,470948374,303765277,941896748,908933415,607530554,708780849,1883793496,2118214995,1817866830,1649639237,1215061108,1181045119,1417561698,1517767529,3767586992,4003061179,4236429990,4069246893,3635733660,3602770327,3299278474,3400528769,2430122216,2664543715,2362090238,2193862645,2835123396,2801107407,3035535058,3135740889,3678124923,3576870512,3341394285,3374361702,3810496343,3977675356,4279080257,4043610186,2876494627,2776292904,3076639029,3110650942,2472011535,2640243204,2403728665,2169303058,1001089995,899835584,666464733,699432150,59727847,226906860,530400753,294930682,1273168787,1172967064,1475418501,1509430414,1942435775,2110667444,1876241833,1641816226,2910219766,2743034109,2976151520,3211623147,2505202138,2606453969,2302690252,2269728455,3711829422,3543599269,3240894392,3475313331,3843699074,3943906441,4178062228,4144047775,1306967366,1139781709,1374988112,1610459739,1975683434,2076935265,1775276924,1742315127,1034867998,866637845,566021896,800440835,92987698,193195065,429456164,395441711,1984812685,2017778566,1784663195,1683407248,1315562145,1080094634,1383856311,1551037884,101039829,135050206,437757123,337553864,1042385657,807962610,573804783,742039012,2531067453,2564033334,2328828971,2227573024,2935566865,2700099354,3001755655,3168937228,3868552805,3902563182,4203181171,4102977912,3736164937,3501741890,3265478751,3433712980,1106041591,1340463100,1576976609,1408749034,2043211483,2009195472,1708848333,1809054150,832877231,1068351396,766945465,599762354,159417987,126454664,361929877,463180190,2709260871,2943682380,3178106961,3009879386,2572697195,2538681184,2236228733,2336434550,3509871135,3745345300,3441850377,3274667266,3910161971,3877198648,4110568485,4211818798,2597806476,2497604743,2261089178,2295101073,2733856160,2902087851,3202437046,2968011453,3936291284,3835036895,4136440770,4169408201,3535486456,3702665459,3467192302,3231722213,2051518780,1951317047,1716890410,1750902305,1113818384,1282050075,1584504582,1350078989,168810852,67556463,371049330,404016761,841739592,1008918595,775550814,540080725,3969562369,3801332234,4035489047,4269907996,3569255213,3669462566,3366754619,3332740144,2631065433,2463879762,2160117071,2395588676,2767645557,2868897406,3102011747,3069049960,202008497,33778362,270040487,504459436,875451293,975658646,675039627,641025152,2084704233,1917518562,1615861247,1851332852,1147550661,1248802510,1484005843,1451044056,933301370,967311729,733156972,632953703,260388950,25965917,328671808,496906059,1206477858,1239443753,1543208500,1441952575,2144161806,1908694277,1675577880,1842759443,3610369226,3644379585,3408119516,3307916247,4011190502,3776767469,4077384432,4245618683,2809771154,2842737049,3144396420,3043140495,2673705150,2438237621,2203032232,2370213795],ke[te([85,50])]=[0,185469197,370938394,487725847,741876788,657861945,975451694,824852259,1483753576,1400783205,1315723890,1164071807,1950903388,2135319889,1649704518,1767536459,2967507152,3152976349,2801566410,2918353863,2631447780,2547432937,2328143614,2177544179,3901806776,3818836405,4270639778,4118987695,3299409036,3483825537,3535072918,3652904859,2077965243,1893020342,1841768865,1724457132,1474502543,1559041666,1107234197,1257309336,598438867,681933534,901210569,1052338372,261314535,77422314,428819965,310463728,3409685355,3224740454,3710368113,3593056380,3875770207,3960309330,4045380933,4195456072,2471224067,2554718734,2237133081,2388260884,3212035895,3028143674,2842678573,2724322336,4138563181,4255350624,3769721975,3955191162,3667219033,3516619604,3431546947,3347532110,2933734917,2782082824,3099667487,3016697106,2196052529,2313884476,2499348523,2683765030,1179510461,1296297904,1347548327,1533017514,1786102409,1635502980,2087309459,2003294622,507358933,355706840,136428751,53458370,839224033,957055980,605657339,790073846,2373340630,2256028891,2607439820,2422494913,2706270690,2856345839,3075636216,3160175349,3573941694,3725069491,3273267108,3356761769,4181598602,4063242375,4011996048,3828103837,1033297158,915985419,730517276,545572369,296679730,446754879,129166120,213705253,1709610350,1860738147,1945798516,2029293177,1239331162,1120974935,1606591296,1422699085,4148292826,4233094615,3781033664,3931371469,3682191598,3497509347,3446004468,3328955385,2939266226,2755636671,3106780840,2988687269,2198438022,2282195339,2501218972,2652609425,1201765386,1286567175,1371368976,1521706781,1805211710,1620529459,2105887268,1988838185,533804130,350174575,164439672,46346101,870912086,954669403,636813900,788204353,2358957921,2274680428,2592523643,2441661558,2695033685,2880240216,3065962831,3182487618,3572145929,3756299780,3270937875,3388507166,4174560061,4091327024,4006521127,3854606378,1014646705,930369212,711349675,560487590,272786309,457992840,106852767,223377554,1678381017,1862534868,1914052035,2031621326,1211247597,1128014560,1580087799,1428173050,32283319,182621114,401639597,486441376,768917123,651868046,1003007129,818324884,1503449823,1385356242,1333838021,1150208456,1973745387,2125135846,1673061617,1756818940,2970356327,3120694122,2802849917,2887651696,2637442643,2520393566,2334669897,2149987652,3917234703,3799141122,4284502037,4100872472,3309594171,3460984630,3545789473,3629546796,2050466060,1899603969,1814803222,1730525723,1443857720,1560382517,1075025698,1260232239,575138148,692707433,878443390,1062597235,243256656,91341917,409198410,325965383,3403100636,3252238545,3704300486,3620022987,3874428392,3990953189,4042459122,4227665663,2460449204,2578018489,2226875310,2411029155,3198115200,3046200461,2827177882,2743944855],ke[te([85,51])]=[0,218828297,437656594,387781147,875313188,958871085,775562294,590424639,1750626376,1699970625,1917742170,2135253587,1551124588,1367295589,1180849278,1265195639,3501252752,3720081049,3399941250,3350065803,3835484340,3919042237,4270507174,4085369519,3102249176,3051593425,2734591178,2952102595,2361698556,2177869557,2530391278,2614737639,3145456443,3060847922,2708326185,2892417312,2404901663,2187128086,2504130317,2555048196,3542330227,3727205754,3375740769,3292445032,3876557655,3926170974,4246310725,4027744588,1808481195,1723872674,1910319033,2094410160,1608975247,1391201670,1173430173,1224348052,59984867,244860394,428169201,344873464,935293895,984907214,766078933,547512796,1844882806,1627235199,2011214180,2062270317,1507497298,1423022939,1137477952,1321699145,95345982,145085239,532201772,313773861,830661914,1015671571,731183368,648017665,3175501286,2957853679,2807058932,2858115069,2305455554,2220981195,2474404304,2658625497,3575528878,3625268135,3473416636,3254988725,3778151818,3963161475,4213447064,4130281361,3599595085,3683022916,3432737375,3247465558,3802222185,4020912224,4172763771,4122762354,3201631749,3017672716,2764249623,2848461854,2331590177,2280796200,2431590963,2648976442,104699613,188127444,472615631,287343814,840019705,1058709744,671593195,621591778,1852171925,1668212892,1953757831,2037970062,1514790577,1463996600,1080017571,1297403050,3673637356,3623636965,3235995134,3454686199,4007360968,3822090177,4107101658,4190530515,2997825956,3215212461,2830708150,2779915199,2256734592,2340947849,2627016082,2443058075,172466556,122466165,273792366,492483431,1047239e3,861968209,612205898,695634755,1646252340,1863638845,2013908262,1963115311,1446242576,1530455833,1277555970,1093597963,1636604631,1820824798,2073724613,1989249228,1436590835,1487645946,1337376481,1119727848,164948639,81781910,331544205,516552836,1039717051,821288114,669961897,719700128,2973530695,3157750862,2871682645,2787207260,2232435299,2283490410,2667994737,2450346104,3647212047,3564045318,3279033885,3464042516,3980931627,3762502690,4150144569,4199882800,3070356634,3121275539,2904027272,2686254721,2200818878,2384911031,2570832044,2486224549,3747192018,3528626907,3310321856,3359936201,3950355702,3867060991,4049844452,4234721005,1739656202,1790575107,2108100632,1890328081,1402811438,1586903591,1233856572,1149249077,266959938,48394827,369057872,418672217,1002783846,919489135,567498868,752375421,209336225,24197544,376187827,459744698,945164165,895287692,574624663,793451934,1679968233,1764313568,2117360635,1933530610,1343127501,1560637892,1243112415,1192455638,3704280881,3519142200,3336358691,3419915562,3907448597,3857572124,4075877127,4294704398,3029510009,3113855344,2927934315,2744104290,2159976285,2377486676,2594734927,2544078150],ke[te([85,52])]=[0,151849742,303699484,454499602,607398968,758720310,908999204,1059270954,1214797936,1097159550,1517440620,1400849762,1817998408,1699839814,2118541908,2001430874,2429595872,2581445614,2194319100,2345119218,3034881240,3186202582,2801699524,2951971274,3635996816,3518358430,3399679628,3283088770,4237083816,4118925222,4002861748,3885750714,1002142683,850817237,698445255,548169417,529487843,377642221,227885567,77089521,1943217067,2061379749,1640576439,1757691577,1474760595,1592394909,1174215055,1290801793,2875968315,2724642869,3111247143,2960971305,2405426947,2253581325,2638606623,2487810577,3808662347,3926825029,4044981591,4162096729,3342319475,3459953789,3576539503,3693126241,1986918061,2137062819,1685577905,1836772287,1381620373,1532285339,1078185097,1229899655,1040559837,923313619,740276417,621982671,439452389,322734571,137073913,19308535,3871163981,4021308739,4104605777,4255800159,3263785589,3414450555,3499326569,3651041127,2933202493,2815956275,3167684641,3049390895,2330014213,2213296395,2566595609,2448830231,1305906550,1155237496,1607244650,1455525988,1776460110,1626319424,2079897426,1928707164,96392454,213114376,396673818,514443284,562755902,679998e3,865136418,983426092,3708173718,3557504664,3474729866,3323011204,4180808110,4030667424,3945269170,3794078908,2507040230,2623762152,2272556026,2390325492,2975484382,3092726480,2738905026,2857194700,3973773121,3856137295,4274053469,4157467219,3371096953,3252932727,3673476453,3556361835,2763173681,2915017791,3064510765,3215307299,2156299017,2307622919,2459735317,2610011675,2081048481,1963412655,1846563261,1729977011,1480485785,1362321559,1243905413,1126790795,878845905,1030690015,645401037,796197571,274084841,425408743,38544885,188821243,3613494426,3731654548,3313212038,3430322568,4082475170,4200115116,3780097726,3896688048,2668221674,2516901860,2366882550,2216610296,3141400786,2989552604,2837966542,2687165888,1202797690,1320957812,1437280870,1554391400,1669664834,1787304780,1906247262,2022837584,265905162,114585348,499347990,349075736,736970802,585122620,972512814,821712160,2595684844,2478443234,2293045232,2174754046,3196267988,3079546586,2895723464,2777952454,3537852828,3687994002,3234156416,3385345166,4142626212,4293295786,3841024952,3992742070,174567692,57326082,410887952,292596766,777231668,660510266,1011452712,893681702,1108339068,1258480242,1343618912,1494807662,1715193156,1865862730,1948373848,2100090966,2701949495,2818666809,3004591147,3122358053,2235061775,2352307457,2535604243,2653899549,3915653703,3764988233,4219352155,4067639125,3444575871,3294430577,3746175075,3594982253,836553431,953270745,600235211,718002117,367585007,484830689,133361907,251657213,2041877159,1891211689,1806599355,1654886325,1568718495,1418573201,1335535747,1184342925];const Ie=new Uint8Array(16);for(let Ue=15;Ue>=0;--Ue)Ie[Ue]=ve%256,ve=parseInt(ve/256);let Ae=null,Se=16;const Oe=new Uint8Array(xe),Ve=[],Me=[];$e();for(let Ue=0;Ue<be[te([108,101,110,103,116,104])];Ue++)Se===16&&(Ae=Be(Ie),Se=0,Fe(Ie)),be[Ue]^=Ae[Se++];return be;function De(Ue){const He=[];for(let ze=0;ze<Ue[te([108,101,110,103,116,104])];ze+=4)He[te([112,117,115,104])](Ue[ze]<<24|Ue[ze+1]<<16|Ue[ze+2]<<8|Ue[ze+3]);return He}function Fe(Ue){for(let He=15;He>=0;He--){if(Ue[He]!==255){Ue[He]++;break}Ue[He]=0}}function Be(Ue){const He=Ve[te([108,101,110,103,116,104])]-1,ze=[0,0,0,0];let qe=De(Ue);for(let je=0;je<4;je++)qe[je]^=Ve[0][je];for(let je=1;je<He;je++){for(let Ye=0;Ye<4;Ye++)ze[Ye]=ke[te([84,49])][qe[Ye]>>24&255]^ke[te([84,50])][qe[(Ye+1)%4]>>16&255]^ke[te([84,51])][qe[(Ye+2)%4]>>8&255]^ke[te([84,52])][255&qe[(Ye+3)%4]]^Ve[je][Ye];qe=ze[te([115,108,105,99,101])]()}const Ke=new Uint8Array(16);let Qe;for(let je=0;je<4;je++)Qe=Ve[He][je],Ke[4*je]=255&(ke[te([83])][qe[je]>>24&255]^Qe>>24),Ke[4*je+1]=255&(ke[te([83])][qe[(je+1)%4]>>16&255]^Qe>>16),Ke[4*je+2]=255&(ke[te([83])][qe[(je+2)%4]>>8&255]^Qe>>8),Ke[4*je+3]=255&(ke[te([83])][255&qe[(je+3)%4]]^Qe);return Ke}function $e(){const Ue=ke[te([110,117,109,98,101,114,79,102,82,111,117,110,100,115])][Oe[te([108,101,110,103,116,104])]];for(let ht=0;ht<=Ue;ht++)Ve[te([112,117,115,104])]([0,0,0,0]),Me[te([112,117,115,104])]([0,0,0,0]);const He=4*(Ue+1),ze=Oe[te([108,101,110,103,116,104])]/4,qe=De(Oe);let Ke;for(let ht=0;ht<ze;ht++)Ke=ht>>2,Ve[Ke][ht%4]=qe[ht],Me[Ue-Ke][ht%4]=qe[ht];let Qe,je=0,Ye=ze;for(;Ye<He;){Qe=qe[ze-1],qe[0]^=ke[te([83])][Qe>>16&255]<<24^ke[te([83])][Qe>>8&255]<<16^ke[te([83])][255&Qe]<<8^ke[te([83])][Qe>>24&255]^ke[te([114,99,111,110])][je]<<24,je+=1;for(let Jt=1;Jt<ze/2;Jt++)qe[Jt]^=qe[Jt-1];Qe=qe[ze/2-1],qe[ze/2]^=ke[te([83])][255&Qe]^ke[te([83])][Qe>>8&255]<<8^ke[te([83])][Qe>>16&255]<<16^ke[te([83])][Qe>>24&255]<<24;for(let Jt=ze/2+1;Jt<ze;Jt++)qe[Jt]^=qe[Jt-1];let ht,Ze,Bt=0;for(;Bt<ze&&Ye<He;)ht=Ye>>2,Ze=Ye%4,Ve[ht][Ze]=qe[Bt],Me[Ue-ht][Ze]=qe[Bt++],Ye++}for(let ht=1;ht<Ue;ht++)for(let Ze=0;Ze<4;Ze++)Qe=Me[ht][Ze],Me[ht][Ze]=ke[te([85,49])][Qe>>24&255]^ke[te([85,50])][Qe>>16&255]^ke[te([85,51])][Qe>>8&255]^ke[te([85,52])][255&Qe]}}function te(be){return be.map(xe=>String.fromCharCode(xe)).join("")}(be=>{function xe(){const Ge=[{[te([105,100])]:1,[te([102,101,97,116,117,114,101,78,97,109,101])]:te([67,111,109,109,101,110,116,115]),[te([112,108,117,103,105,110,78,97,109,101])]:te([67,111,109,109,101,110,116,115,82,101,112,111,115,105,116,111,114,121]),[te([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:te([108,105,99,101,110,115,101,75,101,121]),[te([104,97,110,100,108,101,114])]:te([99,104,101,99,107,76,105,99,101,110,115,101]),[te([99,104,101,99,107,65,108,115,111])]:[{[te([105,100])]:2,[te([102,101,97,116,117,114,101,78,97,109,101])]:te([84,114,97,99,107,32,67,104,97,110,103,101,115]),[te([112,108,117,103,105,110,78,97,109,101])]:te([84,114,97,99,107,67,104,97,110,103,101,115,69,100,105,116,105,110,103]),[te([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:te([108,105,99,101,110,115,101,75,101,121]),[te([104,97,110,100,108,101,114])]:te([99,104,101,99,107,76,105,99,101,110,115,101,70,111,114,84,114,97,99,107,67,104,97,110,103,101,115]),[te([111,112,116,105,111,110,115])]:{[te([97,105,119,115,103,105,99])]:!0,[te([97,105,116,99,100,103,105,108])]:!0,[te([97,105,114,118,105,105,108])]:!0}}],[te([111,112,116,105,111,110,115])]:{[te([97,105,119,115,103,105,99])]:!0,[te([97,105,116,99,100,103,105,108])]:!0,[te([97,105,114,118,105,105,108])]:!0}},{[te([105,100])]:3,[te([102,101,97,116,117,114,101,78,97,109,101])]:te([80,97,103,105,110,97,116,105,111,110]),[te([112,108,117,103,105,110,78,97,109,101])]:te([80,97,103,105,110,97,116,105,111,110,76,111,111,107,117,112]),[te([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:te([112,97,103,105,110,97,116,105,111,110,76,105,99,101,110,115,101,75,101,121]),[te([104,97,110,100,108,101,114])]:te([99,104,101,99,107,76,105,99,101,110,115,101])},{[te([105,100])]:4,[te([102,101,97,116,117,114,101,78,97,109,101])]:te([82,101,118,105,115,105,111,110,32,72,105,115,116,111,114,121]),[te([112,108,117,103,105,110,78,97,109,101])]:te([82,101,118,105,115,105,111,110,115,82,101,112,111,115,105,116,111,114,121]),[te([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:te([108,105,99,101,110,115,101,75,101,121]),[te([104,97,110,100,108,101,114])]:te([99,104,101,99,107,76,105,99,101,110,115,101,70,111,114,82,101,118,105,115,105,111,110,72,105,115,116,111,114,121]),[te([111,112,116,105,111,110,115])]:{[te([97,105,119,115,103,105,99])]:!0,[te([97,105,116,99,100,103,105,108])]:!0,[te([97,105,114,118,105,105,108])]:!0}},{[te([105,100])]:5,[te([102,101,97,116,117,114,101,78,97,109,101])]:te([68,111,99,117,109,101,110,116,32,79,117,116,108,105,110,101]),[te([112,108,117,103,105,110,78,97,109,101])]:te([68,111,99,117,109,101,110,116,79,117,116,108,105,110,101,85,73]),[te([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:te([100,111,99,117,109,101,110,116,79,117,116,108,105,110,101,76,105,99,101,110,115,101,75,101,121]),[te([104,97,110,100,108,101,114])]:te([99,104,101,99,107,76,105,99,101,110,115,101]),[te([111,112,116,105,111,110,115])]:{[te([102,103,105])]:[12]}},{[te([105,100])]:6,[te([102,101,97,116,117,114,101,78,97,109,101])]:te([70,111,114,109,97,116,32,80,97,105,110,116,101,114]),[te([112,108,117,103,105,110,78,97,109,101])]:te([70,111,114,109,97,116,80,97,105,110,116,101,114,85,73]),[te([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:te([102,111,114,109,97,116,80,97,105,110,116,101,114,76,105,99,101,110,115,101,75,101,121]),[te([104,97,110,100,108,101,114])]:te([99,104,101,99,107,76,105,99,101,110,115,101]),[te([111,112,116,105,111,110,115])]:{[te([102,103,105])]:[12]}},{[te([105,100])]:7,[te([102,101,97,116,117,114,101,78,97,109,101])]:te([83,108,97,115,104,32,67,111,109,109,97,110,100]),[te([112,108,117,103,105,110,78,97,109,101])]:te([83,108,97,115,104,67,111,109,109,97,110,100,85,73]),[te([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:te([115,108,97,115,104,67,111,109,109,97,110,100,76,105,99,101,110,115,101,75,101,121]),[te([104,97,110,100,108,101,114])]:te([99,104,101,99,107,76,105,99,101,110,115,101]),[te([111,112,116,105,111,110,115])]:{[te([102,103,105])]:[12]}},{[te([105,100])]:8,[te([102,101,97,116,117,114,101,78,97,109,101])]:te([84,97,98,108,101,32,111,102,32,67,111,110,116,101,110,116,115]),[te([112,108,117,103,105,110,78,97,109,101])]:te([84,97,98,108,101,79,102,67,111,110,116,101,110,116,115,69,100,105,116,105,110,103]),[te([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:te([116,97,98,108,101,79,102,67,111,110,116,101,110,116,115,76,105,99,101,110,115,101,75,101,121]),[te([104,97,110,100,108,101,114])]:te([99,104,101,99,107,76,105,99,101,110,115,101]),[te([111,112,116,105,111,110,115])]:{[te([102,103,105])]:[12]}},{[te([105,100])]:9,[te([102,101,97,116,117,114,101,78,97,109,101])]:te([84,101,109,112,108,97,116,101]),[te([112,108,117,103,105,110,78,97,109,101])]:te([84,101,109,112,108,97,116,101,85,73]),[te([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:te([116,101,109,112,108,97,116,101,76,105,99,101,110,115,101,75,101,121]),[te([104,97,110,100,108,101,114])]:te([99,104,101,99,107,76,105,99,101,110,115,101]),[te([111,112,116,105,111,110,115])]:{[te([102,103,105])]:[12,14]}},{[te([105,100])]:10,[te([102,101,97,116,117,114,101,78,97,109,101])]:te([80,97,115,116,101,32,102,114,111,109,32,79,102,102,105,99,101,32,69,110,104,97,110,99,101,100]),[te([112,108,117,103,105,110,78,97,109,101])]:te([80,97,115,116,101,70,114,111,109,79,102,102,105,99,101,69,110,104,97,110,99,101,100,73,110,108,105,110,101,114]),[te([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:te([112,97,115,116,101,70,114,111,109,79,102,102,105,99,101,69,110,104,97,110,99,101,100,76,105,99,101,110,115,101,75,101,121]),[te([104,97,110,100,108,101,114])]:te([99,104,101,99,107,76,105,99,101,110,115,101]),[te([111,112,116,105,111,110,115])]:{[te([102,103,105])]:[12]}},{[te([105,100])]:11,[te([102,101,97,116,117,114,101,78,97,109,101])]:te([65,73,32,65,115,115,105,115,116,97,110,116]),[te([112,108,117,103,105,110,78,97,109,101])]:te([65,73,65,115,115,105,115,116,97,110,116,85,73]),[te([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:te([97,105,76,105,99,101,110,115,101,75,101,121]),[te([104,97,110,100,108,101,114])]:te([99,104,101,99,107,76,105,99,101,110,115,101])},{[te([105,100])]:12,[te([102,101,97,116,117,114,101,78,97,109,101])]:te([80,114,111,100,117,99,116,105,118,105,116,121,32,112,97,99,107])},{[te([105,100])]:13,[te([102,101,97,116,117,114,101,78,97,109,101])]:te([67,97,115,101,32,67,104,97,110,103,101]),[te([112,108,117,103,105,110,78,97,109,101])]:te([67,97,115,101,67,104,97,110,103,101,85,73]),[te([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:te([99,97,115,101,67,104,97,110,103,101,76,105,99,101,110,115,101,75,101,121]),[te([104,97,110,100,108,101,114])]:te([99,104,101,99,107,76,105,99,101,110,115,101]),[te([111,112,116,105,111,110,115])]:{[te([102,103,105])]:[12]}},{[te([105,100])]:14,[te([102,101,97,116,117,114,101,78,97,109,101])]:te([68,114,117,112,97,108,32,112,97,99,107]),[te([102,111,114,98,105,100,100,101,110,72,97,110,100,108,101,114])]:te([102,111,114,98,105,100,100,101,110,72,97,110,100,108,101,114,70,111,114,68,114,117,112,97,108])},{[te([105,100])]:15,[te([102,101,97,116,117,114,101,78,97,109,101])]:te([77,117,108,116,105,32,76,101,118,101,108,32,76,105,115,116]),[te([112,108,117,103,105,110,78,97,109,101])]:te([77,117,108,116,105,76,101,118,101,108,76,105,115,116,69,100,105,116,105,110,103]),[te([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:te([109,117,108,116,105,76,101,118,101,108,76,105,115,116,76,105,99,101,110,115,101,75,101,121]),[te([104,97,110,100,108,101,114])]:te([99,104,101,99,107,76,105,99,101,110,115,101])},{[te([105,100])]:16,[te([102,101,97,116,117,114,101,78,97,109,101])]:te([77,101,114,103,101,32,70,105,101,108,100,115]),[te([112,108,117,103,105,110,78,97,109,101])]:te([77,101,114,103,101,70,105,101,108,100,115,85,73]),[te([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:te([109,101,114,103,101,70,105,101,108,100,115,76,105,99,101,110,115,101,75,101,121]),[te([104,97,110,100,108,101,114])]:te([99,104,101,99,107,76,105,99,101,110,115,101]),[te([111,112,116,105,111,110,115])]:{[te([102,103,105])]:[12]}}];return Le(Ge),Ge;function Ne(We){return 1<<We-1}function Le(We){We[te([102,111,114,69,97,99,104])](Je=>{Je[te([112,101,114,109,105,115,115,105,111,110,77,97,115,107])]=Ne(Je[te([105,100])]),ve(Je)&&Je[te([99,104,101,99,107,65,108,115,111])]&&Le(Je[te([99,104,101,99,107,65,108,115,111])])})}}function ve(Ge){return te([112,108,117,103,105,110,78,97,109,101])in Ge}const ke=[1,85,78,115,198,255,50,112,83,87,161],Ie=[127,34,6,211,167,86,146,199,132,160,18];function Ae(Ge){const Ne=[29,221,175,90,231,133,239,240,75,180];return Se(Ge,new Uint8Array([...ke,...Ne,...Ie]))}function Se(Ge,Ne){const Le=Oe(Ge),We=Array[te([102,114,111,109])](pn(Le)),Je=We[te([112,111,112])](),Wt=We[te([112,111,112])]();return Xt(t(We,Ne,Wt+256*Je))}function Oe(Ge){const Ne=atob(Ge),[Le,We]=Ne[te([115,112,108,105,116])](te([45]));try{if(atob(We))return atob(Le)}catch{}return Ne}function Ve(Ge){try{const Ne=Ae(Ge),Le=JSON[te([112,97,114,115,101])](Ne),We=parseInt(Le[te([49])]),Je=Le[te([50])]||"",Wt=parseInt(Le[te([51])]),nn=parseInt(Le[te([52])])||0,cn=parseInt(Le[te([53])])||0;return{[te([112,114,111,100,117,99,116,78,97,109,101])]:Je,[te([97,108,108,111,119,101,100,80,108,117,103,105,110,115])]:nn,[te([101,120,112,105,114,97,116,105,111,110,68,97,116,101])]:We,[te([105,115,84,114,105,97,108])]:Wt,[te([105,115,73,110,116,101,114,110,97,108])]:cn}}catch{return null}}const Me=xe(),De={[te([99,104,101,99,107,76,105,99,101,110,115,101])]:Ke,[te([99,104,101,99,107,76,105,99,101,110,115,101,70,111,114,84,114,97,99,107,67,104,97,110,103,101,115])]:Qe,[te([99,104,101,99,107,76,105,99,101,110,115,101,70,111,114,82,101,118,105,115,105,111,110,72,105,115,116,111,114,121])]:je},Fe=be[te([99,111,110,115,116,114,117,99,116,111,114])][te([112,108,117,103,105,110,78,97,109,101])],Be=te([99,111,110,116,101,120,116])in be?be.context:be.editor,$e=te([52,48,52,56,49,52,50,50]),Ue=te([65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,48,49,50,51,52,53,54,55,56,57]),He=Be.config.get(te([108,105,99,101,110,115,101,75,101,121])),ze=Me[te([102,105,108,116,101,114])](ve)[te([102,105,110,100])](Ge=>Ge[te([112,108,117,103,105,110,78,97,109,101])]===Fe);function qe(Ge,Ne){De[Ne[te([104,97,110,100,108,101,114])]](Ge,Ne),Ne[te([99,104,101,99,107,65,108,115,111])]&&Ne[te([99,104,101,99,107,65,108,115,111])][te([102,105,108,116,101,114])](Le=>tn(Be,Le[te([112,108,117,103,105,110,78,97,109,101])]))[te([102,111,114,69,97,99,104])](Le=>qe(Ge,Le))}function Ke(Ge,Ne){ht(Ye(Ge,Ne),Ne)}function Qe(Ge,Ne){function Le(We,Je){try{if(tn(Be,te([84,114,97,99,107,67,104,97,110,103,101,115,69,100,105,116,105,110,103]))&&We){const Wt=Kt(Be,te([84,114,97,99,107,67,104,97,110,103,101,115,69,100,105,116,105,110,103]))[te([95,101,120,101,99,117,116,101,83,117,103,103,101,115,116,105,111,110])];if(parseInt(Wt)/2>We[te([101,120,112,105,114,97,116,105,111,110,68,97,116,101])])return Ze(Je[te([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+te([73,110,118,97,108,105,100]))}return Ye(We,Je)}catch{return Ze(Je[te([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+te([73,110,118,97,108,105,100]))}}ht(Le(Ge,Ne),Ne)}function je(Ge,Ne){const Le=Ie[0]*ke[1],We=Ie[0]*ke[2],Je=Ie[2]*ke[2];tn(Be,te([87,101,98,83,111,99,107,101,116,71,97,116,101,119,97,121]))&&Kt(Be,te([87,101,98,83,111,99,107,101,116,71,97,116,101,119,97,121]))[te([115,116,97,116,101])]==te([99,111,110,110,101,99,116,101,100])&&(window[Bt()]=Je);function Wt(zt,Xe){try{return fn()?Ze(Xe[te([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+te([86,97,108,105,100])):Ye(zt,Xe)}catch{return Ze(Xe[te([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+te([73,110,118,97,108,105,100]))}}function nn(zt,Xe){if(zt==Xe[te([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+te([73,110,118,97,108,105,100]))dn();else if(zt==Xe[te([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+te([84,114,105,97,108])){const an=cn();an&&un(an,Xe[te([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]);const rn=ln();window[te([115,101,116,84,105,109,101,111,117,116])](()=>{un(te([116,105,109,101]),Xe[te([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])])},rn);const xn=Kt(Be,te([82,101,118,105,115,105,111,110,115,82,101,112,111,115,105,116,111,114,121]))[te([95,114,101,118,105,115,105,111,110,115])];xn[te([108,101,110,103,116,104])]>=7?un(te([114,101,118,105,115,105,111,110,115]),Xe[te([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]):xn.on(te([97,100,100]),()=>{xn[te([108,101,110,103,116,104])]>=7&&un(te([114,101,118,105,115,105,111,110,115]),Xe[te([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])])})}}function cn(){if(!tn(Be,te([82,101,118,105,115,105,111,110,86,105,101,119,101,114])))return!1;for(const zt in window)if(Number.isNaN(Number(zt))){if(window[zt]===Le)return te([116,105,109,101]);if(window[zt]===We)return te([114,101,118,105,115,105,111,110,115])}return!1}function fn(){if(!tn(Be,te([82,101,118,105,115,105,111,110,86,105,101,119,101,114])))return!1;for(const zt in window)if(Number.isNaN(Number(zt))&&window[zt]===Je)return!0;return!1}function un(zt,Xe){dn(),Ze(Xe+te([84,114,105,97,108,76,105,109,105,116,58])+zt),window[Bt()]=zt===te([116,105,109,101])?Le:We}function ln(){let zt=Ie[6]*ke[8]*ke[6];return tn(Be,te([82,101,118,105,115,105,111,110,86,105,101,119,101,114]))&&(zt/=10),zt}function dn(){const zt=Be;function Xe(){tn(zt,te([82,101,118,105,115,105,111,110,84,114,97,99,107,101,114]))&&(Kt(zt,te([82,101,118,105,115,105,111,110,84,114,97,99,107,101,114]))[te([117,110,98,105,110,100])](te([105,115,69,110,97,98,108,101,100])),Kt(zt,te([82,101,118,105,115,105,111,110,84,114,97,99,107,101,114]))[te([105,115,69,110,97,98,108,101,100])]=!1,Kt(zt,te([82,101,118,105,115,105,111,110,84,114,97,99,107,101,114]))[te([117,112,100,97,116,101])]=en,Kt(zt,te([82,101,118,105,115,105,111,110,84,114,97,99,107,101,114]))[te([115,97,118,101,82,101,118,105,115,105,111,110])]=en,zt[te([109,111,100,101,108])][te([99,104,97,110,103,101])]=en,zt[te([109,111,100,101,108])][te([101,110,113,117,101,117,101,67,104,97,110,103,101])]=en,zt[te([101,110,97,98,108,101,82,101,97,100,79,110,108,121,77,111,100,101])](te([109,111,100,101,108]))),tn(zt,te([82,101,118,105,115,105,111,110,86,105,101,119,101,114]))&&(Kt(zt,te([82,101,118,105,115,105,111,110,86,105,101,119,101,114]))[te([117,110,98,105,110,100])](te([105,115,69,110,97,98,108,101,100])),Kt(zt,te([82,101,118,105,115,105,111,110,86,105,101,119,101,114]))[te([105,115,69,110,97,98,108,101,100])]=!1,Kt(zt,te([82,101,118,105,115,105,111,110,86,105,101,119,101,114]))[te([99,111,109,112,97,114,101])]=en,Kt(zt,te([82,101,118,105,115,105,111,110,86,105,101,119,101,114]))[te([95,103,101,116,68,105,102,102])]=en)}zt[te([115,116,97,116,101])]==te([114,101,97,100,121])?Xe():zt[te([111,110,99,101])](te([114,101,97,100,121]),()=>{if(tn(zt,te([82,101,118,105,115,105,111,110,84,114,97,99,107,101,114]))&&Xe(),tn(zt,te([82,101,118,105,115,105,111,110,86,105,101,119,101,114]))){const Qt=Kt(zt,te([82,101,118,105,115,105,111,110,115,82,101,112,111,115,105,116,111,114,121])),an=Qt.getRevision(0),rn=Qt.getEarlierVisibleRevision(an[te([105,100])]);Kt(zt,te([82,101,118,105,115,105,111,110,86,105,101,119,101,114]))[te([99,111,109,112,97,114,101])](an[te([105,100])],rn?rn[te([105,100])]:null,1).then(()=>Xe())}})}nn(Wt(Ge,Ne),Ne)}function Ye(Ge,Ne){try{return gn(Ne)?Ze(Ne[te([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+te([86,97,108,105,100])):Ge&&sn(Ge[te([97,108,108,111,119,101,100,80,108,117,103,105,110,115])],Ne)?Ge[te([105,115,73,110,116,101,114,110,97,108])]&&!window[te([111,112,101,110])][te([99,108,111,115,101,100])]||parseInt($e)/2>Ge[te([101,120,112,105,114,97,116,105,111,110,68,97,116,101])]?Ze(Ne[te([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+te([73,110,118,97,108,105,100])):Ge[te([105,115,84,114,105,97,108])]?Ze(Ne[te([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+te([84,114,105,97,108])):Ze(Ne[te([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+te([86,97,108,105,100])):Ze(Ne[te([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+te([73,110,118,97,108,105,100]))}catch{return Ze(Ne[te([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+te([73,110,118,97,108,105,100]))}}function ht(Ge,Ne){if(Be instanceof Context){const Le=Be;Ge==Ne[te([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+te([73,110,118,97,108,105,100])?Jt(Le):Ge==Ne[te([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+te([84,114,105,97,108])&&window[te([115,101,116,84,105,109,101,111,117,116])](()=>{Jt(Le),Ze(Ne[te([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+te([84,114,105,97,108,76,105,109,105,116,58,116,105,109,101]))},Ie[6]*ke[8]*ke[6]),Le[te([101,100,105,116,111,114,115])][te([111,110])](te([97,100,100]),(We,Je)=>{Ge!=Ne[te([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+te([73,110,118,97,108,105,100])&&Ge!=Ne[te([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+te([84,114,105,97,108,76,105,109,105,116,58,116,105,109,101])&&Ge!=Ne[te([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+te([84,114,105,97,108,76,105,109,105,116,58,111,112,101,114,97,116,105,111,110,115])||Yt(Je)})}else{const Le=Be;Ge==Ne[te([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+te([73,110,118,97,108,105,100])?Yt(Le):Ge==Ne[te([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+te([84,114,105,97,108])&&Le[te([111,110])](te([114,101,97,100,121]),()=>{let We=0;Le[te([109,111,100,101,108])][te([111,110])](te([97,112,112,108,121,79,112,101,114,97,116,105,111,110]),(Je,Wt)=>{Wt[0][te([105,115,68,111,99,117,109,101,110,116,79,112,101,114,97,116,105,111,110])]&&We++,We===504&&(Yt(Le),Ze(Ne[te([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+te([84,114,105,97,108,76,105,109,105,116,58,111,112,101,114,97,116,105,111,110,115])),Je[te([111,102,102])]())},{priority:te([104,105,103,104,101,115,116])})})}}function Ze(Ge){const Ne=Bt();return Be[Ne]=Ge,Ge}function Bt(){const Ge=String(window[te([112,101,114,102,111,114,109,97,110,99,101])][te([110,111,119])]())[te([114,101,112,108,97,99,101])](te([46]),"");let Ne="";for(let Le=0;Le<Ge[te([108,101,110,103,116,104])];Le+=2){let We=parseInt(Ge[te([115,117,98,115,116,114,105,110,103])](Le,Le+2));We>=Ue[te([108,101,110,103,116,104])]&&(We-=Ue[te([108,101,110,103,116,104])]),Ne+=Ue[We]}return Ne}function Jt(Ge){for(const Ne of Ge[te([101,100,105,116,111,114,115])])Yt(Ne);Kt(Ge,te([67,111,109,109,101,110,116,115,82,101,112,111,115,105,116,111,114,121]))[te([115,119,105,116,99,104,82,101,97,100,79,110,108,121])](!0),Kt(Ge,te([67,111,109,109,101,110,116,115,82,101,112,111,115,105,116,111,114,121]))[te([115,119,105,116,99,104,82,101,97,100,79,110,108,121])]=en}function Yt(Ge){function Ne(){Ge[te([109,111,100,101,108])][te([99,104,97,110,103,101])]=en,Ge[te([109,111,100,101,108])][te([101,110,113,117,101,117,101,67,104,97,110,103,101])]=en,Ge[te([101,110,97,98,108,101,82,101,97,100,79,110,108,121,77,111,100,101])](te([109,111,100,101,108]))}Ge[te([115,116,97,116,101])]==te([114,101,97,100,121])?Ne():Ge[te([111,110,99,101])](te([114,101,97,100,121]),()=>Ne())}function en(){return null}function sn(Ge,Ne){const Le=!!(Ge&Ne[te([112,101,114,109,105,115,115,105,111,110,77,97,115,107])]),We=hn(Ge,Ne);return Le||We}function hn(Ge,Ne){const Le=(Ne[te([111,112,116,105,111,110,115])]||{})[te([102,103,105])]||null;return!!Le&&Me[te([102,105,108,116,101,114])](We=>Le[te([105,110,99,108,117,100,101,115])](We[te([105,100])]))[te([102,105,108,116,101,114])](We=>!mn(We))[te([115,111,109,101])](We=>!!(Ge&We[te([112,101,114,109,105,115,115,105,111,110,77,97,115,107])]))}function mn(Ge){const Ne={[te([102,111,114,98,105,100,100,101,110,72,97,110,100,108,101,114,70,111,114,68,114,117,112,97,108])]:bn};return!!Ge.forbiddenHandler&&Ne[Ge.forbiddenHandler]()}function bn(){return!window[te([68,114,117,112,97,108])]||!tn(Be,te([100,114,117,112,97,108,80,111,119,101,114,101,100,66,121]))}function gn(Ge){if(!tn(Be,Ge[te([112,108,117,103,105,110,78,97,109,101])]))return!0;const Ne=Ge[te([111,112,116,105,111,110,115])]||{},Le=Ne[te([97,105,119,115,103,105,99])]||!1,We=Ne[te([97,105,116,99,100,103,105,108])]||!1,Je=Ne[te([97,105,114,118,105,105,108])]||!1;return tn(Be,te([87,101,98,83,111,99,107,101,116,71,97,116,101,119,97,121]))&&Kt(Be,te([87,101,98,83,111,99,107,101,116,71,97,116,101,119,97,121]))[te([115,116,97,116,101])]==te([99,111,110,110,101,99,116,101,100])&&Le||tn(Be,te([84,114,97,99,107,67,104,97,110,103,101,115,68,97,116,97,71,101,116,116,101,114]))&&Kt(Be,te([84,114,97,99,107,67,104,97,110,103,101,115,68,97,116,97,71,101,116,116,101,114]))[te([114,101,115,117,108,116])]==te([101,110,100])&&We?!0:!(!tn(Be,te([82,101,118,105,115,105,111,110,86,105,101,119,101,114,73,110,116,101,103,114,97,116,105,111,110]))||Kt(Be,te([82,101,118,105,115,105,111,110,86,105,101,119,101,114,73,110,116,101,103,114,97,116,105,111,110]))[te([114,101,115,117,108,116])]!=te([101,110,100])||!Je)}function tn(Ge,Ne){return Ge[te([112,108,117,103,105,110,115])][te([104,97,115])](Ne)}function Kt(Ge,Ne){return Ge[te([112,108,117,103,105,110,115])][te([103,101,116])](Ne)}function Xt(Ge){let Ne="";for(const Le of Ge)Ne+=String[te([102,114,111,109,67,104,97,114,67,111,100,101])](Le);return Ne}function pn(Ge){const Ne=new Uint8Array(Ge[te([108,101,110,103,116,104])]);for(let Le=0;Le<Ge[te([108,101,110,103,116,104])];Le++)Ne[Le]=Ge[te([99,104,97,114,67,111,100,101,65,116])](Le);return Ne}ze&&qe(Ve(He),ze)})(we)})(this)}_toggleSpecialCursor(we){this.editor.editing.view.change(t=>{for(const te of this.editor.editing.view.document.roots)we?t.addClass(A$3,te):t.removeClass(A$3,te)})}_copyFormatting(){const{editor:we}=this,t=we.t;we.execute(c$5),we.ui.ariaLiveAnnouncer.announce(t("Formatting copied."))}_pasteFormatting(){const{editor:we}=this,t=we.t,te=we.commands.get(c$5).value;we.execute(e$3,te),we.ui.ariaLiveAnnouncer.announce(t("Pasted formatting."))}_finishPainting(){this.editor.commands.get(c$5).reset(),this.stopListening(global.window.document,"mouseup")}},m$8=class extends Plugin{static get requires(){return[o$5,a$5]}static get pluginName(){return"FormatPainter"}},o$4=class extends Plugin{static get pluginName(){return"ImportWordUI"}init(){const we=this.editor;we.ui.componentFactory.add("importWord",()=>{const t=this._createButton(FileDialogButtonView),te=we.commands.get("importWord");return t.bind("isOn").to(te,"isBusy"),t.tooltip=!0,t}),we.ui.componentFactory.add("menuBar:importWord",()=>this._createButton(MenuBarMenuListItemFileDialogButtonView))}_createButton(we){const t=this.editor,te=t.locale.t,be=t.commands.get("importWord"),xe=new we(t.locale),ve=new SpinnerView;return xe.set({acceptedType:"application/vnd.openxmlformats-officedocument.wordprocessingml.document,application/vnd.openxmlformats-officedocument.wordprocessingml.template"}),xe.set({icon:`<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="m14 0 5 4.5v8.892l-1.5-1.8V6.5h-5v-5h-8v3H3V0h11Zm0 2v3h3.3L14 2Z"/><path d="M10.74 18a2.76 2.76 0 0 1-.469-.5H3V19h9.25v-.374A2.737 2.737 0 0 1 10.74 18Z"/><path d="M8.5 6a1.5 1.5 0 0 1 1.493 1.356L10 7.5v7a1.5 1.5 0 0 1-1.356 1.493L8.5 16h-7a1.5 1.5 0 0 1-1.493-1.356L0 14.5v-7a1.5 1.5 0 0 1 1.356-1.493L1.5 6h7ZM7.483 8.795l-.042.088-.986 2.534-.947-2.528-.043-.092a.601.601 0 0 0-1.042.008l-.042.093-.883 2.465-.937-2.475-.042-.089a.6.6 0 0 0-1.107.42l.027.093 1.514 4 .044.092a.6.6 0 0 0 1.041-.01l.041-.092.88-2.458.925 2.467.046.096a.602.602 0 0 0 1.032 0l.043-.09 1.554-4 .028-.093a.6.6 0 0 0-1.104-.43v.001ZM11.674 15.407a.75.75 0 1 0 1.152.96L14 14.96V20h1.5v-5.04l1.174 1.408a.75.75 0 1 0 1.152-.96l-2.346-2.816a.95.95 0 0 0-1.46 0l-2.346 2.815Z"/></svg>
`}),xe.bind("isEnabled").to(be),xe.bind("label").to(be,"isBusy",ke=>te(ke?"Importing Word document":"Import from Word")),ve.bind("isVisible").to(be,"isBusy"),xe.iconView.bind("isVisible").to(be,"isBusy",ke=>!ke),xe.children.add(ve),xe.on("done",(ke,Ie)=>{t.execute("importWord",Ie[0],{}),t.editing.view.focus()}),xe}},d$6=class extends Command{constructor(t){super(t);Re(this,"_importMarker");Re(this,"_undoStepBatch");Re(this,"_abortController");this.set("isBusy",!1),this._importMarker=null,this._undoStepBatch=null,this._abortController=null,this.on("dataInsert",(te,be)=>{const xe=new DataTransfer;xe.setData("text/html",be.html);const ve=this._importMarker.getRange();this.editor.model.enqueueChange(this._undoStepBatch,ke=>{this._importMarker.stopListening(),ke.setSelection(ve),t.editing.view.document.fire("clipboardInput",{dataTransfer:xe})})},{priority:"low"})}refresh(){this.isEnabled=this._checkEnabled()}execute(t,te={}){if(this.isBusy)return Promise.resolve();const be=this.editor.config.get("importWord"),xe={url:be.converterUrl,file:t,serviceConfig:{...te,formatting:be.formatting}};return this._prepareForImport(),this._sendImportRequest(xe).then(this._handleImportResponse.bind(this)).catch(this._handleImportFailure.bind(this)).finally(this._cleanUpAfterImport.bind(this))}_checkEnabled(){if(this.isBusy)return!1;const t=this.editor.model,te=t.schema,be=t.document.selection,xe=first(be.getSelectedBlocks());return!!xe&&te.checkChild(xe.parent,"paragraph")}_prepareForImport(){const t=this.editor,te=t.model,be=te.document.selection;this._abortController=new AbortController,this._undoStepBatch=t.model.createBatch({isUndoable:!0}),te.enqueueChange(this._undoStepBatch,xe=>{be.isCollapsed||te.deleteContent(be,{leaveUnmerged:!0});const ve=be.getFirstPosition(),ke=first(be.getSelectedBlocks());let Ie;Ie=ke.is("element","paragraph")&&ke.isEmpty?ve:ve.isAtStart?te.createPositionBefore(ke):ve.isAtEnd?te.createPositionAfter(ke):xe.split(ve).position,this._importMarker=xe.addMarker("importWord:"+uid(),{usingOperation:!1,affectsData:!1,range:new Range(Ie)}),this._importMarker.on("change:range",()=>{this._importMarker.getRange().root.rootName==="$graveyard"&&this._abortController.abort()})}),this.isBusy=!0,this.refresh()}_cleanUpAfterImport(){const t=this.editor.model;t.markers.has(this._importMarker)&&t.enqueueChange(this._undoStepBatch,te=>{te.removeMarker(this._importMarker)}),this._importMarker=null,this._undoStepBatch=null,this._abortController=null,this.isBusy=!1,this.refresh()}_sendImportRequest({url:t,file:te,serviceConfig:be}){const xe=this.editor.plugins.get("ImportWordEditing").getToken(),ve=new FormData;ve.set("config",JSON.stringify(be)),ve.set("file",te);const ke={method:"POST",headers:{},body:ve,signal:this._abortController.signal};return xe&&(ke.headers.Authorization=xe.value),fetch(t,ke)}_handleImportResponse(t){return t.ok?t.json().then(te=>{this.editor.model.markers.has(this._importMarker)&&this._importMarker.getRange().root.rootName!=="$graveyard"&&this.fire("dataInsert",te)}):Promise.reject()}_handleImportFailure(){if(this._abortController.signal.aborted)return void logWarning("import-word-plugin-import-cancelled");const t=this.editor,te=(0,t.t)("An error occurred while importing the Word file.");t.plugins.get("Notification").showWarning(te),logError("import-word-plugin-conversion-failed")}},e$2=class extends Plugin{constructor(t){super(t);Re(this,"_token");this._token=null}static get pluginName(){return"ImportWordEditing"}static get requires(){return[Notification,ClipboardPipeline,"CloudServices"]}async init(){const t=this.editor;t.config.define("importWord",{converterUrl:"https://docx-converter.cke-cs.com/v2/convert/docx-html",tokenUrl:(t.config.get("cloudServices")||{}).tokenUrl,formatting:{resets:"none",defaults:"none",styles:"inline"}}),t.commands.add("importWord",new d$6(t));const{tokenUrl:te}=t.config.get("importWord");if(te){const{tokenUrl:be}=t.config.get("cloudServices")||{};this._token=te===be?t.plugins.get("CloudServices").token:await t.plugins.get("CloudServices").registerTokenUrl(te)}}getToken(){return this._token}},i$5=class extends Plugin{static get pluginName(){return"ImportWord"}static get requires(){return[e$2,o$4]}},c$4=class extends Command{constructor(t,te,be){super(t);Re(this,"defaultListMarkerStyle");Re(this,"_listDefinitions");Re(this,"_listUtils");this.defaultListMarkerStyle=te,this._listDefinitions=be,this._listUtils=this.editor.plugins.get("ListUtils")}refresh(){this.value=this._getValue(),this.isEnabled=this._checkEnabled()}execute(t={}){const te=this.editor.model,be=t.listMarkerStyle||this.defaultListMarkerStyle;te.change(()=>{const xe=this._getListTypeFromListMarkerStyle(be);if(!xe)return;const ve=xe+"List";this.editor.execute(ve,{additionalAttributes:{listMarkerStyle:be}})})}_getValue(){const t=first(this.editor.model.document.selection.getSelectedBlocks());return this._listUtils.isListItemBlock(t)?t.getAttribute("listMarkerStyle"):null}_checkEnabled(){const t=this.editor,te=t.commands.get("customNumberedList"),be=t.commands.get("customBulletedList");return te.isEnabled||be.isEnabled}_getListTypeFromListMarkerStyle(t){const te=this._listDefinitions.find(be=>be.listMarkerStyle==t);return te?te.listType:null}},i$4=class extends Plugin{constructor(t){super(t);Re(this,"_listDefinitions");const te=this.editor.config.get("listMultiLevel.listDefinitions")||[];this._listDefinitions=[{listType:"customNumbered",listMarkerStyle:"legal",className:"legal-list",listMarkers:[{marker:be=>be+"."}]},...te]}static get pluginName(){return"MultiLevelListEditing"}static get requires(){return["ListEditing"]}init(){const t=this.editor,te=t.model,be=t.editing.view,xe=t.plugins.get("ListEditing");t.commands.add("multiLevelList",new c$4(t,"legal",this._listDefinitions)),te.schema.extend("$listItem",{allowAttributes:["listMarkerStyle","listMarker"]}),te.schema.addAttributeCheck((ke,Ie)=>{const Ae=ke.last;if(Ie=="listMarker"||Ie=="listMarkerStyle")return!(!Ae.getAttribute("listItemId")||!this._listDefinitions.find(Se=>Se.listType==Ae.getAttribute("listType")))&&void 0});for(const ke of this._listDefinitions)t.conversion.for("upcast").add(Ie=>{Ie.on("element:"+(ke.listType=="customNumbered"?"ol":"ul"),y$5(ke,te.schema),{priority:"low"})}),xe.registerDowncastStrategy({scope:"list",attributeName:"listMarkerStyle",setAttributeOnDowncast(Ie,Ae,Se){Ae==ke.listMarkerStyle?(Ie.addClass(["multi-level-list",ke.className],Se),Ie.setStyle("list-style-type","none",Se)):(Ie.removeClass(["multi-level-list",ke.className],Se),Ie.removeStyle("list-style-type",Se))}}),xe.registerDowncastStrategy({scope:"itemMarker",attributeName:"listMarker",createElement(Ie,Ae,{dataPipeline:Se}){return!Ae.hasAttribute("listMarker")||Ae.getAttribute("listType")!=ke.listType||Ae.getAttribute("listMarkerStyle")!=ke.listMarkerStyle?null:Ie.createUIElement("span",{class:"multi-level-list__marker",...!Se&&{contenteditable:"false"}},function(Oe){const Ve=this.toDomElement(Oe);return Ve.appendChild(Oe.createTextNode(Ae.getAttribute("listMarker")+" ")),Ve})},canInjectMarkerIntoElement:Ie=>te.schema.checkChild(Ie,"$text")&&te.schema.checkChild(Ie,"$inlineObject")&&!te.schema.isLimit(Ie)&&Ie.getAttribute("listType")==ke.listType&&Ie.getAttribute("listMarkerStyle")==ke.listMarkerStyle});t.conversion.for("upcast").add(ke=>{ke.on("element:span",function(Ie){return(Ae,Se,{writer:Oe,consumable:Ve})=>{const Me=Se.modelCursor,De=Me.parent,Fe=Se.viewItem;if(Ve.consume(Fe,{name:!0,classes:"multi-level-list__marker"})&&Me.isAtStart&&De.hasAttribute("listType")&&Fe.childCount>0){const Be=Ie.createRangeIn(Fe);let $e="";for(const Ue of Be.getItems())Ue.is("$textProxy")&&($e+=Ue.data.trim(),Ve.consume(Ue.textNode));Oe.setAttribute("listMarker",$e.trim(),De)}}}(be))}),xe.on("postFixer",(ke,{listNodes:Ie,writer:Ae})=>{const Se=[];for(const{node:Oe,previousNodeInList:Ve}of Ie){const Me=Oe.getAttribute("listType"),De=Oe.getAttribute("listMarkerStyle")||(Me=="customNumbered"?"legal":void 0),Fe=this._listDefinitions.find(Ue=>Ue.listType==Me&&Ue.listMarkerStyle==De);if(Me!="customNumbered"&&Me!="customBulleted"&&(Oe.hasAttribute("listMarker")&&(Ae.removeAttribute("listMarker",Oe),ke.return=!0),Oe.hasAttribute("listMarkerStyle")&&(Ae.removeAttribute("listMarkerStyle",Oe),ke.return=!0)),!Fe){Me!="customBulleted"||De||(Ae.setAttribute("listType","bulleted",Oe),ke.return=!0);continue}Oe.hasAttribute("listMarkerStyle")||(Ae.setAttribute("listMarkerStyle",De,Oe),ke.return=!0);const Be=Oe.getAttribute("listIndent");if(Ve&&Ve.getAttribute("listItemId")==Oe.getAttribute("listItemId"))continue;Se.length=Be+1,Ve||Se[Be]?Ve&&Ve.getAttribute("listType")!=Fe.listType?Se[Be]=1:Se[Be]++:Se[Be]=Oe.getAttribute("listStart")||1;const $e=a$4(Be,Fe,Se);Oe.getAttribute("listMarker")!=$e&&(Ae.setAttribute("listMarker",$e,Oe),ke.return=!0)}});const ve=t.editing.view.document;this.listenTo(ve,"clipboardOutput",(ke,Ie)=>{const Ae=new Matcher({name:"span",classes:"multi-level-list__marker"}),Se=new Matcher({name:"ol",classes:"multi-level-list",styles:{"list-style-type":"none"}}),Oe=new UpcastWriter(Ie.content.document),Ve=[];for(const Me of Oe.createRangeIn(Ie.content).getItems())Me.is("element")&&Ae.match(Me)&&Ve.push(Me),Me.is("element")&&Se.match(Me)&&Oe.removeStyle("list-style-type",Me);for(const Me of Ve)Oe.remove(Me)})}afterInit(){(function(t){function te(xe,ve,ke){const Ie={};Ie[be([110,117,109,98,101,114,79,102,82,111,117,110,100,115])]={16:10,24:12,32:14},Ie[be([114,99,111,110])]=[1,2,4,8,16,32,64,128,27,54,108,216,171,77,154,47,94,188,99,198,151,53,106,212,179,125,250,239,197,145],Ie[be([83])]=[99,124,119,123,242,107,111,197,48,1,103,43,254,215,171,118,202,130,201,125,250,89,71,240,173,212,162,175,156,164,114,192,183,253,147,38,54,63,247,204,52,165,229,241,113,216,49,21,4,199,35,195,24,150,5,154,7,18,128,226,235,39,178,117,9,131,44,26,27,110,90,160,82,59,214,179,41,227,47,132,83,209,0,237,32,252,177,91,106,203,190,57,74,76,88,207,208,239,170,251,67,77,51,133,69,249,2,127,80,60,159,168,81,163,64,143,146,157,56,245,188,182,218,33,16,255,243,210,205,12,19,236,95,151,68,23,196,167,126,61,100,93,25,115,96,129,79,220,34,42,144,136,70,238,184,20,222,94,11,219,224,50,58,10,73,6,36,92,194,211,172,98,145,149,228,121,231,200,55,109,141,213,78,169,108,86,244,234,101,122,174,8,186,120,37,46,28,166,180,198,232,221,116,31,75,189,139,138,112,62,181,102,72,3,246,14,97,53,87,185,134,193,29,158,225,248,152,17,105,217,142,148,155,30,135,233,206,85,40,223,140,161,137,13,191,230,66,104,65,153,45,15,176,84,187,22],Ie[be([84,49])]=[3328402341,4168907908,4000806809,4135287693,4294111757,3597364157,3731845041,2445657428,1613770832,33620227,3462883241,1445669757,3892248089,3050821474,1303096294,3967186586,2412431941,528646813,2311702848,4202528135,4026202645,2992200171,2387036105,4226871307,1101901292,3017069671,1604494077,1169141738,597466303,1403299063,3832705686,2613100635,1974974402,3791519004,1033081774,1277568618,1815492186,2118074177,4126668546,2211236943,1748251740,1369810420,3521504564,4193382664,3799085459,2883115123,1647391059,706024767,134480908,2512897874,1176707941,2646852446,806885416,932615841,168101135,798661301,235341577,605164086,461406363,3756188221,3454790438,1311188841,2142417613,3933566367,302582043,495158174,1479289972,874125870,907746093,3698224818,3025820398,1537253627,2756858614,1983593293,3084310113,2108928974,1378429307,3722699582,1580150641,327451799,2790478837,3117535592,0,3253595436,1075847264,3825007647,2041688520,3059440621,3563743934,2378943302,1740553945,1916352843,2487896798,2555137236,2958579944,2244988746,3151024235,3320835882,1336584933,3992714006,2252555205,2588757463,1714631509,293963156,2319795663,3925473552,67240454,4269768577,2689618160,2017213508,631218106,1269344483,2723238387,1571005438,2151694528,93294474,1066570413,563977660,1882732616,4059428100,1673313503,2008463041,2950355573,1109467491,537923632,3858759450,4260623118,3218264685,2177748300,403442708,638784309,3287084079,3193921505,899127202,2286175436,773265209,2479146071,1437050866,4236148354,2050833735,3362022572,3126681063,840505643,3866325909,3227541664,427917720,2655997905,2749160575,1143087718,1412049534,999329963,193497219,2353415882,3354324521,1807268051,672404540,2816401017,3160301282,369822493,2916866934,3688947771,1681011286,1949973070,336202270,2454276571,201721354,1210328172,3093060836,2680341085,3184776046,1135389935,3294782118,965841320,831886756,3554993207,4068047243,3588745010,2345191491,1849112409,3664604599,26054028,2983581028,2622377682,1235855840,3630984372,2891339514,4092916743,3488279077,3395642799,4101667470,1202630377,268961816,1874508501,4034427016,1243948399,1546530418,941366308,1470539505,1941222599,2546386513,3421038627,2715671932,3899946140,1042226977,2521517021,1639824860,227249030,260737669,3765465232,2084453954,1907733956,3429263018,2420656344,100860677,4160157185,470683154,3261161891,1781871967,2924959737,1773779408,394692241,2579611992,974986535,664706745,3655459128,3958962195,731420851,571543859,3530123707,2849626480,126783113,865375399,765172662,1008606754,361203602,3387549984,2278477385,2857719295,1344809080,2782912378,59542671,1503764984,160008576,437062935,1707065306,3622233649,2218934982,3496503480,2185314755,697932208,1512910199,504303377,2075177163,2824099068,1841019862,739644986],Ie[be([84,50])]=[2781242211,2230877308,2582542199,2381740923,234877682,3184946027,2984144751,1418839493,1348481072,50462977,2848876391,2102799147,434634494,1656084439,3863849899,2599188086,1167051466,2636087938,1082771913,2281340285,368048890,3954334041,3381544775,201060592,3963727277,1739838676,4250903202,3930435503,3206782108,4149453988,2531553906,1536934080,3262494647,484572669,2923271059,1783375398,1517041206,1098792767,49674231,1334037708,1550332980,4098991525,886171109,150598129,2481090929,1940642008,1398944049,1059722517,201851908,1385547719,1699095331,1587397571,674240536,2704774806,252314885,3039795866,151914247,908333586,2602270848,1038082786,651029483,1766729511,3447698098,2682942837,454166793,2652734339,1951935532,775166490,758520603,3000790638,4004797018,4217086112,4137964114,1299594043,1639438038,3464344499,2068982057,1054729187,1901997871,2534638724,4121318227,1757008337,0,750906861,1614815264,535035132,3363418545,3988151131,3201591914,1183697867,3647454910,1265776953,3734260298,3566750796,3903871064,1250283471,1807470800,717615087,3847203498,384695291,3313910595,3617213773,1432761139,2484176261,3481945413,283769337,100925954,2180939647,4037038160,1148730428,3123027871,3813386408,4087501137,4267549603,3229630528,2315620239,2906624658,3156319645,1215313976,82966005,3747855548,3245848246,1974459098,1665278241,807407632,451280895,251524083,1841287890,1283575245,337120268,891687699,801369324,3787349855,2721421207,3431482436,959321879,1469301956,4065699751,2197585534,1199193405,2898814052,3887750493,724703513,2514908019,2696962144,2551808385,3516813135,2141445340,1715741218,2119445034,2872807568,2198571144,3398190662,700968686,3547052216,1009259540,2041044702,3803995742,487983883,1991105499,1004265696,1449407026,1316239930,504629770,3683797321,168560134,1816667172,3837287516,1570751170,1857934291,4014189740,2797888098,2822345105,2754712981,936633572,2347923833,852879335,1133234376,1500395319,3084545389,2348912013,1689376213,3533459022,3762923945,3034082412,4205598294,133428468,634383082,2949277029,2398386810,3913789102,403703816,3580869306,2297460856,1867130149,1918643758,607656988,4049053350,3346248884,1368901318,600565992,2090982877,2632479860,557719327,3717614411,3697393085,2249034635,2232388234,2430627952,1115438654,3295786421,2865522278,3633334344,84280067,33027830,303828494,2747425121,1600795957,4188952407,3496589753,2434238086,1486471617,658119965,3106381470,953803233,334231800,3005978776,857870609,3151128937,1890179545,2298973838,2805175444,3056442267,574365214,2450884487,550103529,1233637070,4289353045,2018519080,2057691103,2399374476,4166623649,2148108681,387583245,3664101311,836232934,3330556482,3100665960,3280093505,2955516313,2002398509,287182607,3413881008,4238890068,3597515707,975967766],Ie[be([84,51])]=[1671808611,2089089148,2006576759,2072901243,4061003762,1807603307,1873927791,3310653893,810573872,16974337,1739181671,729634347,4263110654,3613570519,2883997099,1989864566,3393556426,2191335298,3376449993,2106063485,4195741690,1508618841,1204391495,4027317232,2917941677,3563566036,2734514082,2951366063,2629772188,2767672228,1922491506,3227229120,3082974647,4246528509,2477669779,644500518,911895606,1061256767,4144166391,3427763148,878471220,2784252325,3845444069,4043897329,1905517169,3631459288,827548209,356461077,67897348,3344078279,593839651,3277757891,405286936,2527147926,84871685,2595565466,118033927,305538066,2157648768,3795705826,3945188843,661212711,2999812018,1973414517,152769033,2208177539,745822252,439235610,455947803,1857215598,1525593178,2700827552,1391895634,994932283,3596728278,3016654259,695947817,3812548067,795958831,2224493444,1408607827,3513301457,0,3979133421,543178784,4229948412,2982705585,1542305371,1790891114,3410398667,3201918910,961245753,1256100938,1289001036,1491644504,3477767631,3496721360,4012557807,2867154858,4212583931,1137018435,1305975373,861234739,2241073541,1171229253,4178635257,33948674,2139225727,1357946960,1011120188,2679776671,2833468328,1374921297,2751356323,1086357568,2408187279,2460827538,2646352285,944271416,4110742005,3168756668,3066132406,3665145818,560153121,271589392,4279952895,4077846003,3530407890,3444343245,202643468,322250259,3962553324,1608629855,2543990167,1154254916,389623319,3294073796,2817676711,2122513534,1028094525,1689045092,1575467613,422261273,1939203699,1621147744,2174228865,1339137615,3699352540,577127458,712922154,2427141008,2290289544,1187679302,3995715566,3100863416,339486740,3732514782,1591917662,186455563,3681988059,3762019296,844522546,978220090,169743370,1239126601,101321734,611076132,1558493276,3260915650,3547250131,2901361580,1655096418,2443721105,2510565781,3828863972,2039214713,3878868455,3359869896,928607799,1840765549,2374762893,3580146133,1322425422,2850048425,1823791212,1459268694,4094161908,3928346602,1706019429,2056189050,2934523822,135794696,3134549946,2022240376,628050469,779246638,472135708,2800834470,3032970164,3327236038,3894660072,3715932637,1956440180,522272287,1272813131,3185336765,2340818315,2323976074,1888542832,1044544574,3049550261,1722469478,1222152264,50660867,4127324150,236067854,1638122081,895445557,1475980887,3117443513,2257655686,3243809217,489110045,2662934430,3778599393,4162055160,2561878936,288563729,1773916777,3648039385,2391345038,2493985684,2612407707,505560094,2274497927,3911240169,3460925390,1442818645,678973480,3749357023,2358182796,2717407649,2306869641,219617805,3218761151,3862026214,1120306242,1756942440,1103331905,2578459033,762796589,252780047,2966125488,1425844308,3151392187,372911126],Ie[be([84,52])]=[1667474886,2088535288,2004326894,2071694838,4075949567,1802223062,1869591006,3318043793,808472672,16843522,1734846926,724270422,4278065639,3621216949,2880169549,1987484396,3402253711,2189597983,3385409673,2105378810,4210693615,1499065266,1195886990,4042263547,2913856577,3570689971,2728590687,2947541573,2627518243,2762274643,1920112356,3233831835,3082273397,4261223649,2475929149,640051788,909531756,1061110142,4160160501,3435941763,875846760,2779116625,3857003729,4059105529,1903268834,3638064043,825316194,353713962,67374088,3351728789,589522246,3284360861,404236336,2526454071,84217610,2593830191,117901582,303183396,2155911963,3806477791,3958056653,656894286,2998062463,1970642922,151591698,2206440989,741110872,437923380,454765878,1852748508,1515908788,2694904667,1381168804,993742198,3604373943,3014905469,690584402,3823320797,791638366,2223281939,1398011302,3520161977,0,3991743681,538992704,4244381667,2981218425,1532751286,1785380564,3419096717,3200178535,960056178,1246420628,1280103576,1482221744,3486468741,3503319995,4025428677,2863326543,4227536621,1128514950,1296947098,859002214,2240123921,1162203018,4193849577,33687044,2139062782,1347481760,1010582648,2678045221,2829640523,1364325282,2745433693,1077985408,2408548869,2459086143,2644360225,943212656,4126475505,3166494563,3065430391,3671750063,555836226,269496352,4294908645,4092792573,3537006015,3452783745,202118168,320025894,3974901699,1600119230,2543297077,1145359496,387397934,3301201811,2812801621,2122220284,1027426170,1684319432,1566435258,421079858,1936954854,1616945344,2172753945,1330631070,3705438115,572679748,707427924,2425400123,2290647819,1179044492,4008585671,3099120491,336870440,3739122087,1583276732,185277718,3688593069,3772791771,842159716,976899700,168435220,1229577106,101059084,606366792,1549591736,3267517855,3553849021,2897014595,1650632388,2442242105,2509612081,3840161747,2038008818,3890688725,3368567691,926374254,1835907034,2374863873,3587531953,1313788572,2846482505,1819063512,1448540844,4109633523,3941213647,1701162954,2054852340,2930698567,134748176,3132806511,2021165296,623210314,774795868,471606328,2795958615,3031746419,3334885783,3907527627,3722280097,1953799400,522133822,1263263126,3183336545,2341176845,2324333839,1886425312,1044267644,3048588401,1718004428,1212733584,50529542,4143317495,235803164,1633788866,892690282,1465383342,3115962473,2256965911,3250673817,488449850,2661202215,3789633753,4177007595,2560144171,286339874,1768537042,3654906025,2391705863,2492770099,2610673197,505291324,2273808917,3924369609,3469625735,1431699370,673740880,3755965093,2358021891,2711746649,2307489801,218961690,3217021541,3873845719,1111672452,1751693520,1094828930,2576986153,757954394,252645662,2964376443,1414855848,3149649517,370555436],Ie[be([85,49])]=[0,235474187,470948374,303765277,941896748,908933415,607530554,708780849,1883793496,2118214995,1817866830,1649639237,1215061108,1181045119,1417561698,1517767529,3767586992,4003061179,4236429990,4069246893,3635733660,3602770327,3299278474,3400528769,2430122216,2664543715,2362090238,2193862645,2835123396,2801107407,3035535058,3135740889,3678124923,3576870512,3341394285,3374361702,3810496343,3977675356,4279080257,4043610186,2876494627,2776292904,3076639029,3110650942,2472011535,2640243204,2403728665,2169303058,1001089995,899835584,666464733,699432150,59727847,226906860,530400753,294930682,1273168787,1172967064,1475418501,1509430414,1942435775,2110667444,1876241833,1641816226,2910219766,2743034109,2976151520,3211623147,2505202138,2606453969,2302690252,2269728455,3711829422,3543599269,3240894392,3475313331,3843699074,3943906441,4178062228,4144047775,1306967366,1139781709,1374988112,1610459739,1975683434,2076935265,1775276924,1742315127,1034867998,866637845,566021896,800440835,92987698,193195065,429456164,395441711,1984812685,2017778566,1784663195,1683407248,1315562145,1080094634,1383856311,1551037884,101039829,135050206,437757123,337553864,1042385657,807962610,573804783,742039012,2531067453,2564033334,2328828971,2227573024,2935566865,2700099354,3001755655,3168937228,3868552805,3902563182,4203181171,4102977912,3736164937,3501741890,3265478751,3433712980,1106041591,1340463100,1576976609,1408749034,2043211483,2009195472,1708848333,1809054150,832877231,1068351396,766945465,599762354,159417987,126454664,361929877,463180190,2709260871,2943682380,3178106961,3009879386,2572697195,2538681184,2236228733,2336434550,3509871135,3745345300,3441850377,3274667266,3910161971,3877198648,4110568485,4211818798,2597806476,2497604743,2261089178,2295101073,2733856160,2902087851,3202437046,2968011453,3936291284,3835036895,4136440770,4169408201,3535486456,3702665459,3467192302,3231722213,2051518780,1951317047,1716890410,1750902305,1113818384,1282050075,1584504582,1350078989,168810852,67556463,371049330,404016761,841739592,1008918595,775550814,540080725,3969562369,3801332234,4035489047,4269907996,3569255213,3669462566,3366754619,3332740144,2631065433,2463879762,2160117071,2395588676,2767645557,2868897406,3102011747,3069049960,202008497,33778362,270040487,504459436,875451293,975658646,675039627,641025152,2084704233,1917518562,1615861247,1851332852,1147550661,1248802510,1484005843,1451044056,933301370,967311729,733156972,632953703,260388950,25965917,328671808,496906059,1206477858,1239443753,1543208500,1441952575,2144161806,1908694277,1675577880,1842759443,3610369226,3644379585,3408119516,3307916247,4011190502,3776767469,4077384432,4245618683,2809771154,2842737049,3144396420,3043140495,2673705150,2438237621,2203032232,2370213795],Ie[be([85,50])]=[0,185469197,370938394,487725847,741876788,657861945,975451694,824852259,1483753576,1400783205,1315723890,1164071807,1950903388,2135319889,1649704518,1767536459,2967507152,3152976349,2801566410,2918353863,2631447780,2547432937,2328143614,2177544179,3901806776,3818836405,4270639778,4118987695,3299409036,3483825537,3535072918,3652904859,2077965243,1893020342,1841768865,1724457132,1474502543,1559041666,1107234197,1257309336,598438867,681933534,901210569,1052338372,261314535,77422314,428819965,310463728,3409685355,3224740454,3710368113,3593056380,3875770207,3960309330,4045380933,4195456072,2471224067,2554718734,2237133081,2388260884,3212035895,3028143674,2842678573,2724322336,4138563181,4255350624,3769721975,3955191162,3667219033,3516619604,3431546947,3347532110,2933734917,2782082824,3099667487,3016697106,2196052529,2313884476,2499348523,2683765030,1179510461,1296297904,1347548327,1533017514,1786102409,1635502980,2087309459,2003294622,507358933,355706840,136428751,53458370,839224033,957055980,605657339,790073846,2373340630,2256028891,2607439820,2422494913,2706270690,2856345839,3075636216,3160175349,3573941694,3725069491,3273267108,3356761769,4181598602,4063242375,4011996048,3828103837,1033297158,915985419,730517276,545572369,296679730,446754879,129166120,213705253,1709610350,1860738147,1945798516,2029293177,1239331162,1120974935,1606591296,1422699085,4148292826,4233094615,3781033664,3931371469,3682191598,3497509347,3446004468,3328955385,2939266226,2755636671,3106780840,2988687269,2198438022,2282195339,2501218972,2652609425,1201765386,1286567175,1371368976,1521706781,1805211710,1620529459,2105887268,1988838185,533804130,350174575,164439672,46346101,870912086,954669403,636813900,788204353,2358957921,2274680428,2592523643,2441661558,2695033685,2880240216,3065962831,3182487618,3572145929,3756299780,3270937875,3388507166,4174560061,4091327024,4006521127,3854606378,1014646705,930369212,711349675,560487590,272786309,457992840,106852767,223377554,1678381017,1862534868,1914052035,2031621326,1211247597,1128014560,1580087799,1428173050,32283319,182621114,401639597,486441376,768917123,651868046,1003007129,818324884,1503449823,1385356242,1333838021,1150208456,1973745387,2125135846,1673061617,1756818940,2970356327,3120694122,2802849917,2887651696,2637442643,2520393566,2334669897,2149987652,3917234703,3799141122,4284502037,4100872472,3309594171,3460984630,3545789473,3629546796,2050466060,1899603969,1814803222,1730525723,1443857720,1560382517,1075025698,1260232239,575138148,692707433,878443390,1062597235,243256656,91341917,409198410,325965383,3403100636,3252238545,3704300486,3620022987,3874428392,3990953189,4042459122,4227665663,2460449204,2578018489,2226875310,2411029155,3198115200,3046200461,2827177882,2743944855],Ie[be([85,51])]=[0,218828297,437656594,387781147,875313188,958871085,775562294,590424639,1750626376,1699970625,1917742170,2135253587,1551124588,1367295589,1180849278,1265195639,3501252752,3720081049,3399941250,3350065803,3835484340,3919042237,4270507174,4085369519,3102249176,3051593425,2734591178,2952102595,2361698556,2177869557,2530391278,2614737639,3145456443,3060847922,2708326185,2892417312,2404901663,2187128086,2504130317,2555048196,3542330227,3727205754,3375740769,3292445032,3876557655,3926170974,4246310725,4027744588,1808481195,1723872674,1910319033,2094410160,1608975247,1391201670,1173430173,1224348052,59984867,244860394,428169201,344873464,935293895,984907214,766078933,547512796,1844882806,1627235199,2011214180,2062270317,1507497298,1423022939,1137477952,1321699145,95345982,145085239,532201772,313773861,830661914,1015671571,731183368,648017665,3175501286,2957853679,2807058932,2858115069,2305455554,2220981195,2474404304,2658625497,3575528878,3625268135,3473416636,3254988725,3778151818,3963161475,4213447064,4130281361,3599595085,3683022916,3432737375,3247465558,3802222185,4020912224,4172763771,4122762354,3201631749,3017672716,2764249623,2848461854,2331590177,2280796200,2431590963,2648976442,104699613,188127444,472615631,287343814,840019705,1058709744,671593195,621591778,1852171925,1668212892,1953757831,2037970062,1514790577,1463996600,1080017571,1297403050,3673637356,3623636965,3235995134,3454686199,4007360968,3822090177,4107101658,4190530515,2997825956,3215212461,2830708150,2779915199,2256734592,2340947849,2627016082,2443058075,172466556,122466165,273792366,492483431,1047239e3,861968209,612205898,695634755,1646252340,1863638845,2013908262,1963115311,1446242576,1530455833,1277555970,1093597963,1636604631,1820824798,2073724613,1989249228,1436590835,1487645946,1337376481,1119727848,164948639,81781910,331544205,516552836,1039717051,821288114,669961897,719700128,2973530695,3157750862,2871682645,2787207260,2232435299,2283490410,2667994737,2450346104,3647212047,3564045318,3279033885,3464042516,3980931627,3762502690,4150144569,4199882800,3070356634,3121275539,2904027272,2686254721,2200818878,2384911031,2570832044,2486224549,3747192018,3528626907,3310321856,3359936201,3950355702,3867060991,4049844452,4234721005,1739656202,1790575107,2108100632,1890328081,1402811438,1586903591,1233856572,1149249077,266959938,48394827,369057872,418672217,1002783846,919489135,567498868,752375421,209336225,24197544,376187827,459744698,945164165,895287692,574624663,793451934,1679968233,1764313568,2117360635,1933530610,1343127501,1560637892,1243112415,1192455638,3704280881,3519142200,3336358691,3419915562,3907448597,3857572124,4075877127,4294704398,3029510009,3113855344,2927934315,2744104290,2159976285,2377486676,2594734927,2544078150],Ie[be([85,52])]=[0,151849742,303699484,454499602,607398968,758720310,908999204,1059270954,1214797936,1097159550,1517440620,1400849762,1817998408,1699839814,2118541908,2001430874,2429595872,2581445614,2194319100,2345119218,3034881240,3186202582,2801699524,2951971274,3635996816,3518358430,3399679628,3283088770,4237083816,4118925222,4002861748,3885750714,1002142683,850817237,698445255,548169417,529487843,377642221,227885567,77089521,1943217067,2061379749,1640576439,1757691577,1474760595,1592394909,1174215055,1290801793,2875968315,2724642869,3111247143,2960971305,2405426947,2253581325,2638606623,2487810577,3808662347,3926825029,4044981591,4162096729,3342319475,3459953789,3576539503,3693126241,1986918061,2137062819,1685577905,1836772287,1381620373,1532285339,1078185097,1229899655,1040559837,923313619,740276417,621982671,439452389,322734571,137073913,19308535,3871163981,4021308739,4104605777,4255800159,3263785589,3414450555,3499326569,3651041127,2933202493,2815956275,3167684641,3049390895,2330014213,2213296395,2566595609,2448830231,1305906550,1155237496,1607244650,1455525988,1776460110,1626319424,2079897426,1928707164,96392454,213114376,396673818,514443284,562755902,679998e3,865136418,983426092,3708173718,3557504664,3474729866,3323011204,4180808110,4030667424,3945269170,3794078908,2507040230,2623762152,2272556026,2390325492,2975484382,3092726480,2738905026,2857194700,3973773121,3856137295,4274053469,4157467219,3371096953,3252932727,3673476453,3556361835,2763173681,2915017791,3064510765,3215307299,2156299017,2307622919,2459735317,2610011675,2081048481,1963412655,1846563261,1729977011,1480485785,1362321559,1243905413,1126790795,878845905,1030690015,645401037,796197571,274084841,425408743,38544885,188821243,3613494426,3731654548,3313212038,3430322568,4082475170,4200115116,3780097726,3896688048,2668221674,2516901860,2366882550,2216610296,3141400786,2989552604,2837966542,2687165888,1202797690,1320957812,1437280870,1554391400,1669664834,1787304780,1906247262,2022837584,265905162,114585348,499347990,349075736,736970802,585122620,972512814,821712160,2595684844,2478443234,2293045232,2174754046,3196267988,3079546586,2895723464,2777952454,3537852828,3687994002,3234156416,3385345166,4142626212,4293295786,3841024952,3992742070,174567692,57326082,410887952,292596766,777231668,660510266,1011452712,893681702,1108339068,1258480242,1343618912,1494807662,1715193156,1865862730,1948373848,2100090966,2701949495,2818666809,3004591147,3122358053,2235061775,2352307457,2535604243,2653899549,3915653703,3764988233,4219352155,4067639125,3444575871,3294430577,3746175075,3594982253,836553431,953270745,600235211,718002117,367585007,484830689,133361907,251657213,2041877159,1891211689,1806599355,1654886325,1568718495,1418573201,1335535747,1184342925];const Ae=new Uint8Array(16);for(let He=15;He>=0;--He)Ae[He]=ke%256,ke=parseInt(ke/256);let Se=null,Oe=16;const Ve=new Uint8Array(ve),Me=[],De=[];Ue();for(let He=0;He<xe[be([108,101,110,103,116,104])];He++)Oe===16&&(Se=$e(Ae),Oe=0,Be(Ae)),xe[He]^=Se[Oe++];return xe;function Fe(He){const ze=[];for(let qe=0;qe<He[be([108,101,110,103,116,104])];qe+=4)ze[be([112,117,115,104])](He[qe]<<24|He[qe+1]<<16|He[qe+2]<<8|He[qe+3]);return ze}function Be(He){for(let ze=15;ze>=0;ze--){if(He[ze]!==255){He[ze]++;break}He[ze]=0}}function $e(He){const ze=Me[be([108,101,110,103,116,104])]-1,qe=[0,0,0,0];let Ke=Fe(He);for(let Ye=0;Ye<4;Ye++)Ke[Ye]^=Me[0][Ye];for(let Ye=1;Ye<ze;Ye++){for(let ht=0;ht<4;ht++)qe[ht]=Ie[be([84,49])][Ke[ht]>>24&255]^Ie[be([84,50])][Ke[(ht+1)%4]>>16&255]^Ie[be([84,51])][Ke[(ht+2)%4]>>8&255]^Ie[be([84,52])][255&Ke[(ht+3)%4]]^Me[Ye][ht];Ke=qe[be([115,108,105,99,101])]()}const Qe=new Uint8Array(16);let je;for(let Ye=0;Ye<4;Ye++)je=Me[ze][Ye],Qe[4*Ye]=255&(Ie[be([83])][Ke[Ye]>>24&255]^je>>24),Qe[4*Ye+1]=255&(Ie[be([83])][Ke[(Ye+1)%4]>>16&255]^je>>16),Qe[4*Ye+2]=255&(Ie[be([83])][Ke[(Ye+2)%4]>>8&255]^je>>8),Qe[4*Ye+3]=255&(Ie[be([83])][255&Ke[(Ye+3)%4]]^je);return Qe}function Ue(){const He=Ie[be([110,117,109,98,101,114,79,102,82,111,117,110,100,115])][Ve[be([108,101,110,103,116,104])]];for(let Ze=0;Ze<=He;Ze++)Me[be([112,117,115,104])]([0,0,0,0]),De[be([112,117,115,104])]([0,0,0,0]);const ze=4*(He+1),qe=Ve[be([108,101,110,103,116,104])]/4,Ke=Fe(Ve);let Qe;for(let Ze=0;Ze<qe;Ze++)Qe=Ze>>2,Me[Qe][Ze%4]=Ke[Ze],De[He-Qe][Ze%4]=Ke[Ze];let je,Ye=0,ht=qe;for(;ht<ze;){je=Ke[qe-1],Ke[0]^=Ie[be([83])][je>>16&255]<<24^Ie[be([83])][je>>8&255]<<16^Ie[be([83])][255&je]<<8^Ie[be([83])][je>>24&255]^Ie[be([114,99,111,110])][Ye]<<24,Ye+=1;for(let Yt=1;Yt<qe/2;Yt++)Ke[Yt]^=Ke[Yt-1];je=Ke[qe/2-1],Ke[qe/2]^=Ie[be([83])][255&je]^Ie[be([83])][je>>8&255]<<8^Ie[be([83])][je>>16&255]<<16^Ie[be([83])][je>>24&255]<<24;for(let Yt=qe/2+1;Yt<qe;Yt++)Ke[Yt]^=Ke[Yt-1];let Ze,Bt,Jt=0;for(;Jt<qe&&ht<ze;)Ze=ht>>2,Bt=ht%4,Me[Ze][Bt]=Ke[Jt],De[He-Ze][Bt]=Ke[Jt++],ht++}for(let Ze=1;Ze<He;Ze++)for(let Bt=0;Bt<4;Bt++)je=De[Ze][Bt],De[Ze][Bt]=Ie[be([85,49])][je>>24&255]^Ie[be([85,50])][je>>16&255]^Ie[be([85,51])][je>>8&255]^Ie[be([85,52])][255&je]}}function be(xe){return xe.map(ve=>String.fromCharCode(ve)).join("")}(xe=>{function ve(){const Ne=[{[be([105,100])]:1,[be([102,101,97,116,117,114,101,78,97,109,101])]:be([67,111,109,109,101,110,116,115]),[be([112,108,117,103,105,110,78,97,109,101])]:be([67,111,109,109,101,110,116,115,82,101,112,111,115,105,116,111,114,121]),[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:be([108,105,99,101,110,115,101,75,101,121]),[be([104,97,110,100,108,101,114])]:be([99,104,101,99,107,76,105,99,101,110,115,101]),[be([99,104,101,99,107,65,108,115,111])]:[{[be([105,100])]:2,[be([102,101,97,116,117,114,101,78,97,109,101])]:be([84,114,97,99,107,32,67,104,97,110,103,101,115]),[be([112,108,117,103,105,110,78,97,109,101])]:be([84,114,97,99,107,67,104,97,110,103,101,115,69,100,105,116,105,110,103]),[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:be([108,105,99,101,110,115,101,75,101,121]),[be([104,97,110,100,108,101,114])]:be([99,104,101,99,107,76,105,99,101,110,115,101,70,111,114,84,114,97,99,107,67,104,97,110,103,101,115]),[be([111,112,116,105,111,110,115])]:{[be([97,105,119,115,103,105,99])]:!0,[be([97,105,116,99,100,103,105,108])]:!0,[be([97,105,114,118,105,105,108])]:!0}}],[be([111,112,116,105,111,110,115])]:{[be([97,105,119,115,103,105,99])]:!0,[be([97,105,116,99,100,103,105,108])]:!0,[be([97,105,114,118,105,105,108])]:!0}},{[be([105,100])]:3,[be([102,101,97,116,117,114,101,78,97,109,101])]:be([80,97,103,105,110,97,116,105,111,110]),[be([112,108,117,103,105,110,78,97,109,101])]:be([80,97,103,105,110,97,116,105,111,110,76,111,111,107,117,112]),[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:be([112,97,103,105,110,97,116,105,111,110,76,105,99,101,110,115,101,75,101,121]),[be([104,97,110,100,108,101,114])]:be([99,104,101,99,107,76,105,99,101,110,115,101])},{[be([105,100])]:4,[be([102,101,97,116,117,114,101,78,97,109,101])]:be([82,101,118,105,115,105,111,110,32,72,105,115,116,111,114,121]),[be([112,108,117,103,105,110,78,97,109,101])]:be([82,101,118,105,115,105,111,110,115,82,101,112,111,115,105,116,111,114,121]),[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:be([108,105,99,101,110,115,101,75,101,121]),[be([104,97,110,100,108,101,114])]:be([99,104,101,99,107,76,105,99,101,110,115,101,70,111,114,82,101,118,105,115,105,111,110,72,105,115,116,111,114,121]),[be([111,112,116,105,111,110,115])]:{[be([97,105,119,115,103,105,99])]:!0,[be([97,105,116,99,100,103,105,108])]:!0,[be([97,105,114,118,105,105,108])]:!0}},{[be([105,100])]:5,[be([102,101,97,116,117,114,101,78,97,109,101])]:be([68,111,99,117,109,101,110,116,32,79,117,116,108,105,110,101]),[be([112,108,117,103,105,110,78,97,109,101])]:be([68,111,99,117,109,101,110,116,79,117,116,108,105,110,101,85,73]),[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:be([100,111,99,117,109,101,110,116,79,117,116,108,105,110,101,76,105,99,101,110,115,101,75,101,121]),[be([104,97,110,100,108,101,114])]:be([99,104,101,99,107,76,105,99,101,110,115,101]),[be([111,112,116,105,111,110,115])]:{[be([102,103,105])]:[12]}},{[be([105,100])]:6,[be([102,101,97,116,117,114,101,78,97,109,101])]:be([70,111,114,109,97,116,32,80,97,105,110,116,101,114]),[be([112,108,117,103,105,110,78,97,109,101])]:be([70,111,114,109,97,116,80,97,105,110,116,101,114,85,73]),[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:be([102,111,114,109,97,116,80,97,105,110,116,101,114,76,105,99,101,110,115,101,75,101,121]),[be([104,97,110,100,108,101,114])]:be([99,104,101,99,107,76,105,99,101,110,115,101]),[be([111,112,116,105,111,110,115])]:{[be([102,103,105])]:[12]}},{[be([105,100])]:7,[be([102,101,97,116,117,114,101,78,97,109,101])]:be([83,108,97,115,104,32,67,111,109,109,97,110,100]),[be([112,108,117,103,105,110,78,97,109,101])]:be([83,108,97,115,104,67,111,109,109,97,110,100,85,73]),[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:be([115,108,97,115,104,67,111,109,109,97,110,100,76,105,99,101,110,115,101,75,101,121]),[be([104,97,110,100,108,101,114])]:be([99,104,101,99,107,76,105,99,101,110,115,101]),[be([111,112,116,105,111,110,115])]:{[be([102,103,105])]:[12]}},{[be([105,100])]:8,[be([102,101,97,116,117,114,101,78,97,109,101])]:be([84,97,98,108,101,32,111,102,32,67,111,110,116,101,110,116,115]),[be([112,108,117,103,105,110,78,97,109,101])]:be([84,97,98,108,101,79,102,67,111,110,116,101,110,116,115,69,100,105,116,105,110,103]),[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:be([116,97,98,108,101,79,102,67,111,110,116,101,110,116,115,76,105,99,101,110,115,101,75,101,121]),[be([104,97,110,100,108,101,114])]:be([99,104,101,99,107,76,105,99,101,110,115,101]),[be([111,112,116,105,111,110,115])]:{[be([102,103,105])]:[12]}},{[be([105,100])]:9,[be([102,101,97,116,117,114,101,78,97,109,101])]:be([84,101,109,112,108,97,116,101]),[be([112,108,117,103,105,110,78,97,109,101])]:be([84,101,109,112,108,97,116,101,85,73]),[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:be([116,101,109,112,108,97,116,101,76,105,99,101,110,115,101,75,101,121]),[be([104,97,110,100,108,101,114])]:be([99,104,101,99,107,76,105,99,101,110,115,101]),[be([111,112,116,105,111,110,115])]:{[be([102,103,105])]:[12,14]}},{[be([105,100])]:10,[be([102,101,97,116,117,114,101,78,97,109,101])]:be([80,97,115,116,101,32,102,114,111,109,32,79,102,102,105,99,101,32,69,110,104,97,110,99,101,100]),[be([112,108,117,103,105,110,78,97,109,101])]:be([80,97,115,116,101,70,114,111,109,79,102,102,105,99,101,69,110,104,97,110,99,101,100,73,110,108,105,110,101,114]),[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:be([112,97,115,116,101,70,114,111,109,79,102,102,105,99,101,69,110,104,97,110,99,101,100,76,105,99,101,110,115,101,75,101,121]),[be([104,97,110,100,108,101,114])]:be([99,104,101,99,107,76,105,99,101,110,115,101]),[be([111,112,116,105,111,110,115])]:{[be([102,103,105])]:[12]}},{[be([105,100])]:11,[be([102,101,97,116,117,114,101,78,97,109,101])]:be([65,73,32,65,115,115,105,115,116,97,110,116]),[be([112,108,117,103,105,110,78,97,109,101])]:be([65,73,65,115,115,105,115,116,97,110,116,85,73]),[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:be([97,105,76,105,99,101,110,115,101,75,101,121]),[be([104,97,110,100,108,101,114])]:be([99,104,101,99,107,76,105,99,101,110,115,101])},{[be([105,100])]:12,[be([102,101,97,116,117,114,101,78,97,109,101])]:be([80,114,111,100,117,99,116,105,118,105,116,121,32,112,97,99,107])},{[be([105,100])]:13,[be([102,101,97,116,117,114,101,78,97,109,101])]:be([67,97,115,101,32,67,104,97,110,103,101]),[be([112,108,117,103,105,110,78,97,109,101])]:be([67,97,115,101,67,104,97,110,103,101,85,73]),[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:be([99,97,115,101,67,104,97,110,103,101,76,105,99,101,110,115,101,75,101,121]),[be([104,97,110,100,108,101,114])]:be([99,104,101,99,107,76,105,99,101,110,115,101]),[be([111,112,116,105,111,110,115])]:{[be([102,103,105])]:[12]}},{[be([105,100])]:14,[be([102,101,97,116,117,114,101,78,97,109,101])]:be([68,114,117,112,97,108,32,112,97,99,107]),[be([102,111,114,98,105,100,100,101,110,72,97,110,100,108,101,114])]:be([102,111,114,98,105,100,100,101,110,72,97,110,100,108,101,114,70,111,114,68,114,117,112,97,108])},{[be([105,100])]:15,[be([102,101,97,116,117,114,101,78,97,109,101])]:be([77,117,108,116,105,32,76,101,118,101,108,32,76,105,115,116]),[be([112,108,117,103,105,110,78,97,109,101])]:be([77,117,108,116,105,76,101,118,101,108,76,105,115,116,69,100,105,116,105,110,103]),[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:be([109,117,108,116,105,76,101,118,101,108,76,105,115,116,76,105,99,101,110,115,101,75,101,121]),[be([104,97,110,100,108,101,114])]:be([99,104,101,99,107,76,105,99,101,110,115,101])},{[be([105,100])]:16,[be([102,101,97,116,117,114,101,78,97,109,101])]:be([77,101,114,103,101,32,70,105,101,108,100,115]),[be([112,108,117,103,105,110,78,97,109,101])]:be([77,101,114,103,101,70,105,101,108,100,115,85,73]),[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:be([109,101,114,103,101,70,105,101,108,100,115,76,105,99,101,110,115,101,75,101,121]),[be([104,97,110,100,108,101,114])]:be([99,104,101,99,107,76,105,99,101,110,115,101]),[be([111,112,116,105,111,110,115])]:{[be([102,103,105])]:[12]}}];return We(Ne),Ne;function Le(Je){return 1<<Je-1}function We(Je){Je[be([102,111,114,69,97,99,104])](Wt=>{Wt[be([112,101,114,109,105,115,115,105,111,110,77,97,115,107])]=Le(Wt[be([105,100])]),ke(Wt)&&Wt[be([99,104,101,99,107,65,108,115,111])]&&We(Wt[be([99,104,101,99,107,65,108,115,111])])})}}function ke(Ne){return be([112,108,117,103,105,110,78,97,109,101])in Ne}const Ie=[1,85,78,115,198,255,50,112,83,87,161],Ae=[127,34,6,211,167,86,146,199,132,160,18];function Se(Ne){const Le=[29,221,175,90,231,133,239,240,75,180];return Oe(Ne,new Uint8Array([...Ie,...Le,...Ae]))}function Oe(Ne,Le){const We=Ve(Ne),Je=Array[be([102,114,111,109])](Ge(We)),Wt=Je[be([112,111,112])](),nn=Je[be([112,111,112])]();return pn(te(Je,Le,nn+256*Wt))}function Ve(Ne){const Le=atob(Ne),[We,Je]=Le[be([115,112,108,105,116])](be([45]));try{if(atob(Je))return atob(We)}catch{}return Le}function Me(Ne){try{const Le=Se(Ne),We=JSON[be([112,97,114,115,101])](Le),Je=parseInt(We[be([49])]),Wt=We[be([50])]||"",nn=parseInt(We[be([51])]),cn=parseInt(We[be([52])])||0,fn=parseInt(We[be([53])])||0;return{[be([112,114,111,100,117,99,116,78,97,109,101])]:Wt,[be([97,108,108,111,119,101,100,80,108,117,103,105,110,115])]:cn,[be([101,120,112,105,114,97,116,105,111,110,68,97,116,101])]:Je,[be([105,115,84,114,105,97,108])]:nn,[be([105,115,73,110,116,101,114,110,97,108])]:fn}}catch{return null}}const De=ve(),Fe={[be([99,104,101,99,107,76,105,99,101,110,115,101])]:Qe,[be([99,104,101,99,107,76,105,99,101,110,115,101,70,111,114,84,114,97,99,107,67,104,97,110,103,101,115])]:je,[be([99,104,101,99,107,76,105,99,101,110,115,101,70,111,114,82,101,118,105,115,105,111,110,72,105,115,116,111,114,121])]:Ye},Be=xe[be([99,111,110,115,116,114,117,99,116,111,114])][be([112,108,117,103,105,110,78,97,109,101])],$e=be([99,111,110,116,101,120,116])in xe?xe.context:xe.editor,Ue=be([52,48,52,56,49,52,50,50]),He=be([65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,48,49,50,51,52,53,54,55,56,57]),ze=$e.config.get(be([108,105,99,101,110,115,101,75,101,121])),qe=De[be([102,105,108,116,101,114])](ke)[be([102,105,110,100])](Ne=>Ne[be([112,108,117,103,105,110,78,97,109,101])]===Be);function Ke(Ne,Le){Fe[Le[be([104,97,110,100,108,101,114])]](Ne,Le),Le[be([99,104,101,99,107,65,108,115,111])]&&Le[be([99,104,101,99,107,65,108,115,111])][be([102,105,108,116,101,114])](We=>Kt($e,We[be([112,108,117,103,105,110,78,97,109,101])]))[be([102,111,114,69,97,99,104])](We=>Ke(Ne,We))}function Qe(Ne,Le){Ze(ht(Ne,Le),Le)}function je(Ne,Le){function We(Je,Wt){try{if(Kt($e,be([84,114,97,99,107,67,104,97,110,103,101,115,69,100,105,116,105,110,103]))&&Je){const nn=Xt($e,be([84,114,97,99,107,67,104,97,110,103,101,115,69,100,105,116,105,110,103]))[be([95,101,120,101,99,117,116,101,83,117,103,103,101,115,116,105,111,110])];if(parseInt(nn)/2>Je[be([101,120,112,105,114,97,116,105,111,110,68,97,116,101])])return Bt(Wt[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+be([73,110,118,97,108,105,100]))}return ht(Je,Wt)}catch{return Bt(Wt[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+be([73,110,118,97,108,105,100]))}}Ze(We(Ne,Le),Le)}function Ye(Ne,Le){const We=Ae[0]*Ie[1],Je=Ae[0]*Ie[2],Wt=Ae[2]*Ie[2];Kt($e,be([87,101,98,83,111,99,107,101,116,71,97,116,101,119,97,121]))&&Xt($e,be([87,101,98,83,111,99,107,101,116,71,97,116,101,119,97,121]))[be([115,116,97,116,101])]==be([99,111,110,110,101,99,116,101,100])&&(window[Jt()]=Wt);function nn(Xe,Qt){try{return un()?Bt(Qt[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+be([86,97,108,105,100])):ht(Xe,Qt)}catch{return Bt(Qt[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+be([73,110,118,97,108,105,100]))}}function cn(Xe,Qt){if(Xe==Qt[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+be([73,110,118,97,108,105,100]))zt();else if(Xe==Qt[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+be([84,114,105,97,108])){const rn=fn();rn&&ln(rn,Qt[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]);const xn=dn();window[be([115,101,116,84,105,109,101,111,117,116])](()=>{ln(be([116,105,109,101]),Qt[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])])},xn);const wn=Xt($e,be([82,101,118,105,115,105,111,110,115,82,101,112,111,115,105,116,111,114,121]))[be([95,114,101,118,105,115,105,111,110,115])];wn[be([108,101,110,103,116,104])]>=7?ln(be([114,101,118,105,115,105,111,110,115]),Qt[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]):wn.on(be([97,100,100]),()=>{wn[be([108,101,110,103,116,104])]>=7&&ln(be([114,101,118,105,115,105,111,110,115]),Qt[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])])})}}function fn(){if(!Kt($e,be([82,101,118,105,115,105,111,110,86,105,101,119,101,114])))return!1;for(const Xe in window)if(Number.isNaN(Number(Xe))){if(window[Xe]===We)return be([116,105,109,101]);if(window[Xe]===Je)return be([114,101,118,105,115,105,111,110,115])}return!1}function un(){if(!Kt($e,be([82,101,118,105,115,105,111,110,86,105,101,119,101,114])))return!1;for(const Xe in window)if(Number.isNaN(Number(Xe))&&window[Xe]===Wt)return!0;return!1}function ln(Xe,Qt){zt(),Bt(Qt+be([84,114,105,97,108,76,105,109,105,116,58])+Xe),window[Jt()]=Xe===be([116,105,109,101])?We:Je}function dn(){let Xe=Ae[6]*Ie[8]*Ie[6];return Kt($e,be([82,101,118,105,115,105,111,110,86,105,101,119,101,114]))&&(Xe/=10),Xe}function zt(){const Xe=$e;function Qt(){Kt(Xe,be([82,101,118,105,115,105,111,110,84,114,97,99,107,101,114]))&&(Xt(Xe,be([82,101,118,105,115,105,111,110,84,114,97,99,107,101,114]))[be([117,110,98,105,110,100])](be([105,115,69,110,97,98,108,101,100])),Xt(Xe,be([82,101,118,105,115,105,111,110,84,114,97,99,107,101,114]))[be([105,115,69,110,97,98,108,101,100])]=!1,Xt(Xe,be([82,101,118,105,115,105,111,110,84,114,97,99,107,101,114]))[be([117,112,100,97,116,101])]=sn,Xt(Xe,be([82,101,118,105,115,105,111,110,84,114,97,99,107,101,114]))[be([115,97,118,101,82,101,118,105,115,105,111,110])]=sn,Xe[be([109,111,100,101,108])][be([99,104,97,110,103,101])]=sn,Xe[be([109,111,100,101,108])][be([101,110,113,117,101,117,101,67,104,97,110,103,101])]=sn,Xe[be([101,110,97,98,108,101,82,101,97,100,79,110,108,121,77,111,100,101])](be([109,111,100,101,108]))),Kt(Xe,be([82,101,118,105,115,105,111,110,86,105,101,119,101,114]))&&(Xt(Xe,be([82,101,118,105,115,105,111,110,86,105,101,119,101,114]))[be([117,110,98,105,110,100])](be([105,115,69,110,97,98,108,101,100])),Xt(Xe,be([82,101,118,105,115,105,111,110,86,105,101,119,101,114]))[be([105,115,69,110,97,98,108,101,100])]=!1,Xt(Xe,be([82,101,118,105,115,105,111,110,86,105,101,119,101,114]))[be([99,111,109,112,97,114,101])]=sn,Xt(Xe,be([82,101,118,105,115,105,111,110,86,105,101,119,101,114]))[be([95,103,101,116,68,105,102,102])]=sn)}Xe[be([115,116,97,116,101])]==be([114,101,97,100,121])?Qt():Xe[be([111,110,99,101])](be([114,101,97,100,121]),()=>{if(Kt(Xe,be([82,101,118,105,115,105,111,110,84,114,97,99,107,101,114]))&&Qt(),Kt(Xe,be([82,101,118,105,115,105,111,110,86,105,101,119,101,114]))){const an=Xt(Xe,be([82,101,118,105,115,105,111,110,115,82,101,112,111,115,105,116,111,114,121])),rn=an.getRevision(0),xn=an.getEarlierVisibleRevision(rn[be([105,100])]);Xt(Xe,be([82,101,118,105,115,105,111,110,86,105,101,119,101,114]))[be([99,111,109,112,97,114,101])](rn[be([105,100])],xn?xn[be([105,100])]:null,1).then(()=>Qt())}})}cn(nn(Ne,Le),Le)}function ht(Ne,Le){try{return tn(Le)?Bt(Le[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+be([86,97,108,105,100])):Ne&&hn(Ne[be([97,108,108,111,119,101,100,80,108,117,103,105,110,115])],Le)?Ne[be([105,115,73,110,116,101,114,110,97,108])]&&!window[be([111,112,101,110])][be([99,108,111,115,101,100])]||parseInt(Ue)/2>Ne[be([101,120,112,105,114,97,116,105,111,110,68,97,116,101])]?Bt(Le[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+be([73,110,118,97,108,105,100])):Ne[be([105,115,84,114,105,97,108])]?Bt(Le[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+be([84,114,105,97,108])):Bt(Le[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+be([86,97,108,105,100])):Bt(Le[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+be([73,110,118,97,108,105,100]))}catch{return Bt(Le[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+be([73,110,118,97,108,105,100]))}}function Ze(Ne,Le){if($e instanceof Context){const We=$e;Ne==Le[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+be([73,110,118,97,108,105,100])?Yt(We):Ne==Le[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+be([84,114,105,97,108])&&window[be([115,101,116,84,105,109,101,111,117,116])](()=>{Yt(We),Bt(Le[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+be([84,114,105,97,108,76,105,109,105,116,58,116,105,109,101]))},Ae[6]*Ie[8]*Ie[6]),We[be([101,100,105,116,111,114,115])][be([111,110])](be([97,100,100]),(Je,Wt)=>{Ne!=Le[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+be([73,110,118,97,108,105,100])&&Ne!=Le[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+be([84,114,105,97,108,76,105,109,105,116,58,116,105,109,101])&&Ne!=Le[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+be([84,114,105,97,108,76,105,109,105,116,58,111,112,101,114,97,116,105,111,110,115])||en(Wt)})}else{const We=$e;Ne==Le[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+be([73,110,118,97,108,105,100])?en(We):Ne==Le[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+be([84,114,105,97,108])&&We[be([111,110])](be([114,101,97,100,121]),()=>{let Je=0;We[be([109,111,100,101,108])][be([111,110])](be([97,112,112,108,121,79,112,101,114,97,116,105,111,110]),(Wt,nn)=>{nn[0][be([105,115,68,111,99,117,109,101,110,116,79,112,101,114,97,116,105,111,110])]&&Je++,Je===504&&(en(We),Bt(Le[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+be([84,114,105,97,108,76,105,109,105,116,58,111,112,101,114,97,116,105,111,110,115])),Wt[be([111,102,102])]())},{priority:be([104,105,103,104,101,115,116])})})}}function Bt(Ne){const Le=Jt();return $e[Le]=Ne,Ne}function Jt(){const Ne=String(window[be([112,101,114,102,111,114,109,97,110,99,101])][be([110,111,119])]())[be([114,101,112,108,97,99,101])](be([46]),"");let Le="";for(let We=0;We<Ne[be([108,101,110,103,116,104])];We+=2){let Je=parseInt(Ne[be([115,117,98,115,116,114,105,110,103])](We,We+2));Je>=He[be([108,101,110,103,116,104])]&&(Je-=He[be([108,101,110,103,116,104])]),Le+=He[Je]}return Le}function Yt(Ne){for(const Le of Ne[be([101,100,105,116,111,114,115])])en(Le);Xt(Ne,be([67,111,109,109,101,110,116,115,82,101,112,111,115,105,116,111,114,121]))[be([115,119,105,116,99,104,82,101,97,100,79,110,108,121])](!0),Xt(Ne,be([67,111,109,109,101,110,116,115,82,101,112,111,115,105,116,111,114,121]))[be([115,119,105,116,99,104,82,101,97,100,79,110,108,121])]=sn}function en(Ne){function Le(){Ne[be([109,111,100,101,108])][be([99,104,97,110,103,101])]=sn,Ne[be([109,111,100,101,108])][be([101,110,113,117,101,117,101,67,104,97,110,103,101])]=sn,Ne[be([101,110,97,98,108,101,82,101,97,100,79,110,108,121,77,111,100,101])](be([109,111,100,101,108]))}Ne[be([115,116,97,116,101])]==be([114,101,97,100,121])?Le():Ne[be([111,110,99,101])](be([114,101,97,100,121]),()=>Le())}function sn(){return null}function hn(Ne,Le){const We=!!(Ne&Le[be([112,101,114,109,105,115,115,105,111,110,77,97,115,107])]),Je=mn(Ne,Le);return We||Je}function mn(Ne,Le){const We=(Le[be([111,112,116,105,111,110,115])]||{})[be([102,103,105])]||null;return!!We&&De[be([102,105,108,116,101,114])](Je=>We[be([105,110,99,108,117,100,101,115])](Je[be([105,100])]))[be([102,105,108,116,101,114])](Je=>!bn(Je))[be([115,111,109,101])](Je=>!!(Ne&Je[be([112,101,114,109,105,115,115,105,111,110,77,97,115,107])]))}function bn(Ne){const Le={[be([102,111,114,98,105,100,100,101,110,72,97,110,100,108,101,114,70,111,114,68,114,117,112,97,108])]:gn};return!!Ne.forbiddenHandler&&Le[Ne.forbiddenHandler]()}function gn(){return!window[be([68,114,117,112,97,108])]||!Kt($e,be([100,114,117,112,97,108,80,111,119,101,114,101,100,66,121]))}function tn(Ne){if(!Kt($e,Ne[be([112,108,117,103,105,110,78,97,109,101])]))return!0;const Le=Ne[be([111,112,116,105,111,110,115])]||{},We=Le[be([97,105,119,115,103,105,99])]||!1,Je=Le[be([97,105,116,99,100,103,105,108])]||!1,Wt=Le[be([97,105,114,118,105,105,108])]||!1;return Kt($e,be([87,101,98,83,111,99,107,101,116,71,97,116,101,119,97,121]))&&Xt($e,be([87,101,98,83,111,99,107,101,116,71,97,116,101,119,97,121]))[be([115,116,97,116,101])]==be([99,111,110,110,101,99,116,101,100])&&We||Kt($e,be([84,114,97,99,107,67,104,97,110,103,101,115,68,97,116,97,71,101,116,116,101,114]))&&Xt($e,be([84,114,97,99,107,67,104,97,110,103,101,115,68,97,116,97,71,101,116,116,101,114]))[be([114,101,115,117,108,116])]==be([101,110,100])&&Je?!0:!(!Kt($e,be([82,101,118,105,115,105,111,110,86,105,101,119,101,114,73,110,116,101,103,114,97,116,105,111,110]))||Xt($e,be([82,101,118,105,115,105,111,110,86,105,101,119,101,114,73,110,116,101,103,114,97,116,105,111,110]))[be([114,101,115,117,108,116])]!=be([101,110,100])||!Wt)}function Kt(Ne,Le){return Ne[be([112,108,117,103,105,110,115])][be([104,97,115])](Le)}function Xt(Ne,Le){return Ne[be([112,108,117,103,105,110,115])][be([103,101,116])](Le)}function pn(Ne){let Le="";for(const We of Ne)Le+=String[be([102,114,111,109,67,104,97,114,67,111,100,101])](We);return Le}function Ge(Ne){const Le=new Uint8Array(Ne[be([108,101,110,103,116,104])]);for(let We=0;We<Ne[be([108,101,110,103,116,104])];We++)Le[We]=Ne[be([99,104,97,114,67,111,100,101,65,116])](We);return Le}qe&&Ke(Me(ze),qe)})(t)})(this)}};function a$4(Te,we,t){let te=we.listMarkers[Te%we.listMarkers.length];if(te.showMarkerPath===void 0||te.showMarkerPath)return t.slice(0,Te+1).map((be,xe)=>(te=we.listMarkers[xe%we.listMarkers.length],m$7(te.marker,be))).join("");{const be=t[t.length-1];return m$7(te.marker,be)}}function m$7(Te,we){return typeof Te=="function"?Te(we):Te}function y$5(Te,we){return(t,te,be)=>{const xe=te.viewItem;if(te.modelRange||Object.assign(te,be.convertChildren(te.viewItem,te.modelCursor)),!be.consumable.test(xe,{classes:Te.className}))return;const ve=Array.from(te.modelRange.getItems({shallow:!0})).filter(Ie=>we.checkAttribute(Ie,"listItemId"));if(!ve.length)return;be.consumable.consume(xe,{classes:Te.className}),be.consumable.consume(xe,{classes:"multi-level-list"}),be.consumable.consume(xe,{styles:"list-style-type"});const ke=ve[0].getAttribute("listIndent");for(const Ie of ve)Ie.getAttribute("listIndent")==ke&&(be.writer.setAttribute("listType",Te.listType,Ie),be.writer.setAttribute("listMarkerStyle",Te.listMarkerStyle,Ie))}}let C$1=class extends View{constructor(t,{enabledProperties:te,styleButtonViews:be,styleGridAriaLabel:xe}){super(t);Re(this,"children");Re(this,"stylesView",null);Re(this,"additionalPropertiesCollapsibleView",null);Re(this,"startIndexFieldView",null);Re(this,"focusTracker",new FocusTracker);Re(this,"keystrokes",new KeystrokeHandler);Re(this,"focusables",new ViewCollection);Re(this,"focusCycler");const ve=["ck","ck-multi-level-list-properties"];this.children=this.createCollection(),this.focusCycler=new FocusCycler({focusables:this.focusables,focusTracker:this.focusTracker,keystrokeHandler:this.keystrokes,actions:{focusPrevious:"shift + tab",focusNext:"tab"}}),te.styles?(this.stylesView=this._createStylesView(be,xe),this.children.add(this.stylesView)):ve.push("ck-multi-level-list-properties_without-styles"),te.startIndex&&(this._addListPropertyViews(te),ve.push("ck-multi-level-list-properties_with-multi-level-properties")),this.setTemplate({tag:"div",attributes:{class:ve},children:this.children})}render(){if(super.render(),this.stylesView){this.focusables.add(this.stylesView),this.focusTracker.add(this.stylesView.element),this.startIndexFieldView&&(this.focusables.add(this.children.last.buttonView),this.focusTracker.add(this.children.last.buttonView.element));for(const t of this.stylesView.children)this.stylesView.focusTracker.add(t.element);addKeyboardHandlingForGrid({keystrokeHandler:this.stylesView.keystrokes,focusTracker:this.stylesView.focusTracker,gridItems:this.stylesView.children,numberOfColumns:()=>global.window.getComputedStyle(this.stylesView.element).getPropertyValue("grid-template-columns").split(" ").length,uiLanguageDirection:this.locale&&this.locale.uiLanguageDirection})}if(this.startIndexFieldView){this.focusables.add(this.startIndexFieldView),this.focusTracker.add(this.startIndexFieldView.element);const t=te=>te.stopPropagation();this.keystrokes.set("arrowright",t),this.keystrokes.set("arrowleft",t),this.keystrokes.set("arrowup",t),this.keystrokes.set("arrowdown",t)}this.keystrokes.listenTo(this.element)}focus(){this.focusCycler.focusFirst()}focusLast(){this.focusCycler.focusLast()}destroy(){super.destroy(),this.focusTracker.destroy(),this.keystrokes.destroy()}_createStylesView(t,te){const be=new View(this.locale);return be.children=be.createCollection(),be.children.addMany(t),be.setTemplate({tag:"div",attributes:{"aria-label":te,class:["ck","ck-multi-level-list-styles"]},children:be.children}),be.children.delegate("execute").to(this),be.focus=function(){this.children.first.focus()},be.focusTracker=new FocusTracker,be.keystrokes=new KeystrokeHandler,be.render(),be.keystrokes.listenTo(be.element),be}_addListPropertyViews(t){const te=this.locale.t,be=[];t.startIndex&&(this.startIndexFieldView=this._createStartIndexField(),be.push(this.startIndexFieldView)),t.styles?(this.additionalPropertiesCollapsibleView=new CollapsibleView(this.locale,be),this.additionalPropertiesCollapsibleView.set({label:te("List properties"),isCollapsed:!0}),this.additionalPropertiesCollapsibleView.buttonView.bind("isEnabled").toMany(be,"isEnabled",(...xe)=>xe.some(ve=>ve)),this.additionalPropertiesCollapsibleView.buttonView.on("change:isEnabled",(xe,ve,ke)=>{ke||(this.additionalPropertiesCollapsibleView.isCollapsed=!0)}),this.children.add(this.additionalPropertiesCollapsibleView)):this.children.addMany(be)}_createStartIndexField(){const t=this.locale.t,te=new LabeledFieldView(this.locale,createLabeledInputNumber);return te.set({label:t("Start at"),class:"ck-multi-level-list-properties__start-index"}),te.fieldView.set({min:0,step:1,value:1,inputMode:"numeric"}),te.fieldView.on("input",()=>{const be=te.fieldView.element,xe=be.valueAsNumber;Number.isNaN(xe)?te.errorText=t("Invalid start index value."):be.checkValidity()?this.fire("listStart",{startIndex:xe}):te.errorText=t("Start index must be greater than 0.")}),te}};var w$2='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M7.85 6.5a.75.75 0 0 1 0-1.5h9.5a.75.75 0 1 1 0 1.5h-9.5Z"/><path d="M3 8V2.7H.5v1h1V8H3Z"/><path d="M13.42 14.185a.75.75 0 0 0 .53 1.28h3.4a.75.75 0 1 0 0-1.5h-3.4a.75.75 0 0 0-.53.22Z"/><path d="M5.636 8.035V6.8H4.4v1.235h1.236Z"/><path d="M9 17.865v-5.3H6.5v1h1v4.3H9Z"/><path d="M11.636 17.9v-1.235H10.4V17.9h1.236Z"/><path d="M3.2 17.865v-5.3H.7v1h1v4.3h1.5Z"/><path d="M5.836 17.9v-1.235H4.6V17.9h1.236Z"/></svg>';let l$5=class extends Plugin{constructor(t){super(t);Re(this,"_licenseKeyCheckInterval");this._licenseKeyCheckInterval=null}static get pluginName(){return"MultiLevelListUI"}init(){const t=this.editor,te=t.locale.t;t.ui.componentFactory.add("multiLevelList",function({editor:xe,parentCommandName:ve,buttonLabel:ke,buttonIcon:Ie,styleGridAriaLabel:Ae,styleDefinitions:Se}){const Oe=xe.commands.get(ve),Ve=xe.config.get("list.properties")||{},Me=xe.plugins.has("ListProperties"),De=Ve.startIndex;return!Me||!De?Fe=>{const Be=new ButtonView(Fe);return Be.set({label:ke,icon:Ie,tooltip:!0,isToggleable:!0}),Be.bind("isOn").to(Oe,"value",$e=>!!$e),Be.on("execute",()=>{xe.execute(ve),xe.editing.view.focus()}),Be}:Fe=>{const Be=createDropdown(Fe,SplitButtonView),$e=Be.buttonView;return Be.bind("isEnabled").to(Oe),Be.class="ck-list-styles-dropdown",$e.on("execute",()=>{xe.execute(ve),xe.editing.view.focus()}),$e.set({label:ke,icon:Ie,tooltip:!0,isToggleable:!0}),$e.bind("isOn").to(Oe,"value",Ue=>!!Ue),Be.once("change:isOpen",()=>{const Ue=function({editor:He,dropdownView:ze,styleDefinitions:qe,styleGridAriaLabel:Ke}){const Qe=He.locale,je=He.config.get("list.properties"),Ye=null;je.reversed=!1,qe.length||(je.styles=!1);const ht=new C$1(Qe,{styleGridAriaLabel:Ke,enabledProperties:je,styleButtonViews:Ye});if(je.startIndex){const Ze=He.commands.get("listStart");ht.startIndexFieldView.bind("isEnabled").to(Ze),ht.startIndexFieldView.fieldView.bind("value").to(Ze),ht.on("listStart",(Bt,Jt)=>He.execute("listStart",Jt))}return ht.delegate("execute").to(ze),ht}({editor:xe,dropdownView:Be,parentCommandName:ve,styleGridAriaLabel:Ae,styleDefinitions:Se});Be.panelView.children.add(Ue)}),Be.on("execute",()=>{xe.editing.view.focus()}),Be}}({editor:t,parentCommandName:"multiLevelList",buttonLabel:te("Multi-level List"),buttonIcon:w$2,styleGridAriaLabel:te("Multi-level list styles toolbar"),styleDefinitions:[]})),t.ui.componentFactory.add("menuBar:multiLevelList",()=>{const xe=t.commands.get("multiLevelList"),ve=new MenuBarMenuListItemButtonView(t.locale);return ve.set({label:te("Multi-level List"),icon:w$2}),ve.bind("isEnabled").to(xe),ve.bind("isOn").to(xe,"value",ke=>!!ke),ve.on("execute",()=>{t.execute("multiLevelList"),t.editing.view.focus()}),ve}),this.licenseKey=t.config.get("licenseKey");const be=this.editor;this._licenseKeyCheckInterval=setInterval(()=>{let xe;for(const ve in be){const ke=ve,Ie=be[ke];if(Ie==="multiLevelListLicenseKeyTrial"||Ie==="multiLevelListLicenseKeyInvalid"||Ie==="multiLevelListLicenseKeyValid"||Ie==="multiLevelListLicenseKeyTrialLimit:operations"){delete be[ke],xe=Ie;break}}if(xe==="multiLevelListLicenseKeyInvalid")throw clearInterval(this._licenseKeyCheckInterval),new CKEditorError("multi-level-list-invalid-license-key",null);if(xe==="multiLevelListLicenseKeyTrial"&&console.info("You are using the trial version of CKEditor 5 multi level list plugin with limited usage. Make sure you will not use it in the production environment."),xe==="multiLevelListLicenseKeyTrialLimit:operations")throw clearInterval(this._licenseKeyCheckInterval),new CKEditorError("multi-level-list-trial-license-key-reached-limit-changes",null);xe==="multiLevelListLicenseKeyValid"&&clearInterval(this._licenseKeyCheckInterval)},1e3)}destroy(){this._licenseKeyCheckInterval&&clearInterval(this._licenseKeyCheckInterval)}},r$6=class extends Plugin{static get pluginName(){return"MultiLevelList"}static get requires(){return[i$4,l$5]}},n$3=class extends Plugin{constructor(){super(...arguments);Re(this,"_recalculatePageBreaksDebounced");Re(this,"_pagesContainer",null)}static get pluginName(){return"PaginationLookup"}init(){if(this.set({pageBreaks:[]}),!this.editor.config.get("pagination"))return void logWarning("pagination-config-not-found",this.editor.config);this._recalculatePageBreaksDebounced=debounce(()=>this._recalculatePageBreaks(),200),this._pagesContainer=null;const t=this.editor.plugins.get("PaginationEditing");this.bind("isEnabled").to(t),this.editor.ui.once("ready",()=>this._onUiReady()),this.on("change:isEnabled",(te,be,xe)=>{xe&&this._recalculatePageBreaksDebounced()})}afterInit(){(function(t){function te(xe,ve,ke){const Ie={};Ie[be([110,117,109,98,101,114,79,102,82,111,117,110,100,115])]={16:10,24:12,32:14},Ie[be([114,99,111,110])]=[1,2,4,8,16,32,64,128,27,54,108,216,171,77,154,47,94,188,99,198,151,53,106,212,179,125,250,239,197,145],Ie[be([83])]=[99,124,119,123,242,107,111,197,48,1,103,43,254,215,171,118,202,130,201,125,250,89,71,240,173,212,162,175,156,164,114,192,183,253,147,38,54,63,247,204,52,165,229,241,113,216,49,21,4,199,35,195,24,150,5,154,7,18,128,226,235,39,178,117,9,131,44,26,27,110,90,160,82,59,214,179,41,227,47,132,83,209,0,237,32,252,177,91,106,203,190,57,74,76,88,207,208,239,170,251,67,77,51,133,69,249,2,127,80,60,159,168,81,163,64,143,146,157,56,245,188,182,218,33,16,255,243,210,205,12,19,236,95,151,68,23,196,167,126,61,100,93,25,115,96,129,79,220,34,42,144,136,70,238,184,20,222,94,11,219,224,50,58,10,73,6,36,92,194,211,172,98,145,149,228,121,231,200,55,109,141,213,78,169,108,86,244,234,101,122,174,8,186,120,37,46,28,166,180,198,232,221,116,31,75,189,139,138,112,62,181,102,72,3,246,14,97,53,87,185,134,193,29,158,225,248,152,17,105,217,142,148,155,30,135,233,206,85,40,223,140,161,137,13,191,230,66,104,65,153,45,15,176,84,187,22],Ie[be([84,49])]=[3328402341,4168907908,4000806809,4135287693,4294111757,3597364157,3731845041,2445657428,1613770832,33620227,3462883241,1445669757,3892248089,3050821474,1303096294,3967186586,2412431941,528646813,2311702848,4202528135,4026202645,2992200171,2387036105,4226871307,1101901292,3017069671,1604494077,1169141738,597466303,1403299063,3832705686,2613100635,1974974402,3791519004,1033081774,1277568618,1815492186,2118074177,4126668546,2211236943,1748251740,1369810420,3521504564,4193382664,3799085459,2883115123,1647391059,706024767,134480908,2512897874,1176707941,2646852446,806885416,932615841,168101135,798661301,235341577,605164086,461406363,3756188221,3454790438,1311188841,2142417613,3933566367,302582043,495158174,1479289972,874125870,907746093,3698224818,3025820398,1537253627,2756858614,1983593293,3084310113,2108928974,1378429307,3722699582,1580150641,327451799,2790478837,3117535592,0,3253595436,1075847264,3825007647,2041688520,3059440621,3563743934,2378943302,1740553945,1916352843,2487896798,2555137236,2958579944,2244988746,3151024235,3320835882,1336584933,3992714006,2252555205,2588757463,1714631509,293963156,2319795663,3925473552,67240454,4269768577,2689618160,2017213508,631218106,1269344483,2723238387,1571005438,2151694528,93294474,1066570413,563977660,1882732616,4059428100,1673313503,2008463041,2950355573,1109467491,537923632,3858759450,4260623118,3218264685,2177748300,403442708,638784309,3287084079,3193921505,899127202,2286175436,773265209,2479146071,1437050866,4236148354,2050833735,3362022572,3126681063,840505643,3866325909,3227541664,427917720,2655997905,2749160575,1143087718,1412049534,999329963,193497219,2353415882,3354324521,1807268051,672404540,2816401017,3160301282,369822493,2916866934,3688947771,1681011286,1949973070,336202270,2454276571,201721354,1210328172,3093060836,2680341085,3184776046,1135389935,3294782118,965841320,831886756,3554993207,4068047243,3588745010,2345191491,1849112409,3664604599,26054028,2983581028,2622377682,1235855840,3630984372,2891339514,4092916743,3488279077,3395642799,4101667470,1202630377,268961816,1874508501,4034427016,1243948399,1546530418,941366308,1470539505,1941222599,2546386513,3421038627,2715671932,3899946140,1042226977,2521517021,1639824860,227249030,260737669,3765465232,2084453954,1907733956,3429263018,2420656344,100860677,4160157185,470683154,3261161891,1781871967,2924959737,1773779408,394692241,2579611992,974986535,664706745,3655459128,3958962195,731420851,571543859,3530123707,2849626480,126783113,865375399,765172662,1008606754,361203602,3387549984,2278477385,2857719295,1344809080,2782912378,59542671,1503764984,160008576,437062935,1707065306,3622233649,2218934982,3496503480,2185314755,697932208,1512910199,504303377,2075177163,2824099068,1841019862,739644986],Ie[be([84,50])]=[2781242211,2230877308,2582542199,2381740923,234877682,3184946027,2984144751,1418839493,1348481072,50462977,2848876391,2102799147,434634494,1656084439,3863849899,2599188086,1167051466,2636087938,1082771913,2281340285,368048890,3954334041,3381544775,201060592,3963727277,1739838676,4250903202,3930435503,3206782108,4149453988,2531553906,1536934080,3262494647,484572669,2923271059,1783375398,1517041206,1098792767,49674231,1334037708,1550332980,4098991525,886171109,150598129,2481090929,1940642008,1398944049,1059722517,201851908,1385547719,1699095331,1587397571,674240536,2704774806,252314885,3039795866,151914247,908333586,2602270848,1038082786,651029483,1766729511,3447698098,2682942837,454166793,2652734339,1951935532,775166490,758520603,3000790638,4004797018,4217086112,4137964114,1299594043,1639438038,3464344499,2068982057,1054729187,1901997871,2534638724,4121318227,1757008337,0,750906861,1614815264,535035132,3363418545,3988151131,3201591914,1183697867,3647454910,1265776953,3734260298,3566750796,3903871064,1250283471,1807470800,717615087,3847203498,384695291,3313910595,3617213773,1432761139,2484176261,3481945413,283769337,100925954,2180939647,4037038160,1148730428,3123027871,3813386408,4087501137,4267549603,3229630528,2315620239,2906624658,3156319645,1215313976,82966005,3747855548,3245848246,1974459098,1665278241,807407632,451280895,251524083,1841287890,1283575245,337120268,891687699,801369324,3787349855,2721421207,3431482436,959321879,1469301956,4065699751,2197585534,1199193405,2898814052,3887750493,724703513,2514908019,2696962144,2551808385,3516813135,2141445340,1715741218,2119445034,2872807568,2198571144,3398190662,700968686,3547052216,1009259540,2041044702,3803995742,487983883,1991105499,1004265696,1449407026,1316239930,504629770,3683797321,168560134,1816667172,3837287516,1570751170,1857934291,4014189740,2797888098,2822345105,2754712981,936633572,2347923833,852879335,1133234376,1500395319,3084545389,2348912013,1689376213,3533459022,3762923945,3034082412,4205598294,133428468,634383082,2949277029,2398386810,3913789102,403703816,3580869306,2297460856,1867130149,1918643758,607656988,4049053350,3346248884,1368901318,600565992,2090982877,2632479860,557719327,3717614411,3697393085,2249034635,2232388234,2430627952,1115438654,3295786421,2865522278,3633334344,84280067,33027830,303828494,2747425121,1600795957,4188952407,3496589753,2434238086,1486471617,658119965,3106381470,953803233,334231800,3005978776,857870609,3151128937,1890179545,2298973838,2805175444,3056442267,574365214,2450884487,550103529,1233637070,4289353045,2018519080,2057691103,2399374476,4166623649,2148108681,387583245,3664101311,836232934,3330556482,3100665960,3280093505,2955516313,2002398509,287182607,3413881008,4238890068,3597515707,975967766],Ie[be([84,51])]=[1671808611,2089089148,2006576759,2072901243,4061003762,1807603307,1873927791,3310653893,810573872,16974337,1739181671,729634347,4263110654,3613570519,2883997099,1989864566,3393556426,2191335298,3376449993,2106063485,4195741690,1508618841,1204391495,4027317232,2917941677,3563566036,2734514082,2951366063,2629772188,2767672228,1922491506,3227229120,3082974647,4246528509,2477669779,644500518,911895606,1061256767,4144166391,3427763148,878471220,2784252325,3845444069,4043897329,1905517169,3631459288,827548209,356461077,67897348,3344078279,593839651,3277757891,405286936,2527147926,84871685,2595565466,118033927,305538066,2157648768,3795705826,3945188843,661212711,2999812018,1973414517,152769033,2208177539,745822252,439235610,455947803,1857215598,1525593178,2700827552,1391895634,994932283,3596728278,3016654259,695947817,3812548067,795958831,2224493444,1408607827,3513301457,0,3979133421,543178784,4229948412,2982705585,1542305371,1790891114,3410398667,3201918910,961245753,1256100938,1289001036,1491644504,3477767631,3496721360,4012557807,2867154858,4212583931,1137018435,1305975373,861234739,2241073541,1171229253,4178635257,33948674,2139225727,1357946960,1011120188,2679776671,2833468328,1374921297,2751356323,1086357568,2408187279,2460827538,2646352285,944271416,4110742005,3168756668,3066132406,3665145818,560153121,271589392,4279952895,4077846003,3530407890,3444343245,202643468,322250259,3962553324,1608629855,2543990167,1154254916,389623319,3294073796,2817676711,2122513534,1028094525,1689045092,1575467613,422261273,1939203699,1621147744,2174228865,1339137615,3699352540,577127458,712922154,2427141008,2290289544,1187679302,3995715566,3100863416,339486740,3732514782,1591917662,186455563,3681988059,3762019296,844522546,978220090,169743370,1239126601,101321734,611076132,1558493276,3260915650,3547250131,2901361580,1655096418,2443721105,2510565781,3828863972,2039214713,3878868455,3359869896,928607799,1840765549,2374762893,3580146133,1322425422,2850048425,1823791212,1459268694,4094161908,3928346602,1706019429,2056189050,2934523822,135794696,3134549946,2022240376,628050469,779246638,472135708,2800834470,3032970164,3327236038,3894660072,3715932637,1956440180,522272287,1272813131,3185336765,2340818315,2323976074,1888542832,1044544574,3049550261,1722469478,1222152264,50660867,4127324150,236067854,1638122081,895445557,1475980887,3117443513,2257655686,3243809217,489110045,2662934430,3778599393,4162055160,2561878936,288563729,1773916777,3648039385,2391345038,2493985684,2612407707,505560094,2274497927,3911240169,3460925390,1442818645,678973480,3749357023,2358182796,2717407649,2306869641,219617805,3218761151,3862026214,1120306242,1756942440,1103331905,2578459033,762796589,252780047,2966125488,1425844308,3151392187,372911126],Ie[be([84,52])]=[1667474886,2088535288,2004326894,2071694838,4075949567,1802223062,1869591006,3318043793,808472672,16843522,1734846926,724270422,4278065639,3621216949,2880169549,1987484396,3402253711,2189597983,3385409673,2105378810,4210693615,1499065266,1195886990,4042263547,2913856577,3570689971,2728590687,2947541573,2627518243,2762274643,1920112356,3233831835,3082273397,4261223649,2475929149,640051788,909531756,1061110142,4160160501,3435941763,875846760,2779116625,3857003729,4059105529,1903268834,3638064043,825316194,353713962,67374088,3351728789,589522246,3284360861,404236336,2526454071,84217610,2593830191,117901582,303183396,2155911963,3806477791,3958056653,656894286,2998062463,1970642922,151591698,2206440989,741110872,437923380,454765878,1852748508,1515908788,2694904667,1381168804,993742198,3604373943,3014905469,690584402,3823320797,791638366,2223281939,1398011302,3520161977,0,3991743681,538992704,4244381667,2981218425,1532751286,1785380564,3419096717,3200178535,960056178,1246420628,1280103576,1482221744,3486468741,3503319995,4025428677,2863326543,4227536621,1128514950,1296947098,859002214,2240123921,1162203018,4193849577,33687044,2139062782,1347481760,1010582648,2678045221,2829640523,1364325282,2745433693,1077985408,2408548869,2459086143,2644360225,943212656,4126475505,3166494563,3065430391,3671750063,555836226,269496352,4294908645,4092792573,3537006015,3452783745,202118168,320025894,3974901699,1600119230,2543297077,1145359496,387397934,3301201811,2812801621,2122220284,1027426170,1684319432,1566435258,421079858,1936954854,1616945344,2172753945,1330631070,3705438115,572679748,707427924,2425400123,2290647819,1179044492,4008585671,3099120491,336870440,3739122087,1583276732,185277718,3688593069,3772791771,842159716,976899700,168435220,1229577106,101059084,606366792,1549591736,3267517855,3553849021,2897014595,1650632388,2442242105,2509612081,3840161747,2038008818,3890688725,3368567691,926374254,1835907034,2374863873,3587531953,1313788572,2846482505,1819063512,1448540844,4109633523,3941213647,1701162954,2054852340,2930698567,134748176,3132806511,2021165296,623210314,774795868,471606328,2795958615,3031746419,3334885783,3907527627,3722280097,1953799400,522133822,1263263126,3183336545,2341176845,2324333839,1886425312,1044267644,3048588401,1718004428,1212733584,50529542,4143317495,235803164,1633788866,892690282,1465383342,3115962473,2256965911,3250673817,488449850,2661202215,3789633753,4177007595,2560144171,286339874,1768537042,3654906025,2391705863,2492770099,2610673197,505291324,2273808917,3924369609,3469625735,1431699370,673740880,3755965093,2358021891,2711746649,2307489801,218961690,3217021541,3873845719,1111672452,1751693520,1094828930,2576986153,757954394,252645662,2964376443,1414855848,3149649517,370555436],Ie[be([85,49])]=[0,235474187,470948374,303765277,941896748,908933415,607530554,708780849,1883793496,2118214995,1817866830,1649639237,1215061108,1181045119,1417561698,1517767529,3767586992,4003061179,4236429990,4069246893,3635733660,3602770327,3299278474,3400528769,2430122216,2664543715,2362090238,2193862645,2835123396,2801107407,3035535058,3135740889,3678124923,3576870512,3341394285,3374361702,3810496343,3977675356,4279080257,4043610186,2876494627,2776292904,3076639029,3110650942,2472011535,2640243204,2403728665,2169303058,1001089995,899835584,666464733,699432150,59727847,226906860,530400753,294930682,1273168787,1172967064,1475418501,1509430414,1942435775,2110667444,1876241833,1641816226,2910219766,2743034109,2976151520,3211623147,2505202138,2606453969,2302690252,2269728455,3711829422,3543599269,3240894392,3475313331,3843699074,3943906441,4178062228,4144047775,1306967366,1139781709,1374988112,1610459739,1975683434,2076935265,1775276924,1742315127,1034867998,866637845,566021896,800440835,92987698,193195065,429456164,395441711,1984812685,2017778566,1784663195,1683407248,1315562145,1080094634,1383856311,1551037884,101039829,135050206,437757123,337553864,1042385657,807962610,573804783,742039012,2531067453,2564033334,2328828971,2227573024,2935566865,2700099354,3001755655,3168937228,3868552805,3902563182,4203181171,4102977912,3736164937,3501741890,3265478751,3433712980,1106041591,1340463100,1576976609,1408749034,2043211483,2009195472,1708848333,1809054150,832877231,1068351396,766945465,599762354,159417987,126454664,361929877,463180190,2709260871,2943682380,3178106961,3009879386,2572697195,2538681184,2236228733,2336434550,3509871135,3745345300,3441850377,3274667266,3910161971,3877198648,4110568485,4211818798,2597806476,2497604743,2261089178,2295101073,2733856160,2902087851,3202437046,2968011453,3936291284,3835036895,4136440770,4169408201,3535486456,3702665459,3467192302,3231722213,2051518780,1951317047,1716890410,1750902305,1113818384,1282050075,1584504582,1350078989,168810852,67556463,371049330,404016761,841739592,1008918595,775550814,540080725,3969562369,3801332234,4035489047,4269907996,3569255213,3669462566,3366754619,3332740144,2631065433,2463879762,2160117071,2395588676,2767645557,2868897406,3102011747,3069049960,202008497,33778362,270040487,504459436,875451293,975658646,675039627,641025152,2084704233,1917518562,1615861247,1851332852,1147550661,1248802510,1484005843,1451044056,933301370,967311729,733156972,632953703,260388950,25965917,328671808,496906059,1206477858,1239443753,1543208500,1441952575,2144161806,1908694277,1675577880,1842759443,3610369226,3644379585,3408119516,3307916247,4011190502,3776767469,4077384432,4245618683,2809771154,2842737049,3144396420,3043140495,2673705150,2438237621,2203032232,2370213795],Ie[be([85,50])]=[0,185469197,370938394,487725847,741876788,657861945,975451694,824852259,1483753576,1400783205,1315723890,1164071807,1950903388,2135319889,1649704518,1767536459,2967507152,3152976349,2801566410,2918353863,2631447780,2547432937,2328143614,2177544179,3901806776,3818836405,4270639778,4118987695,3299409036,3483825537,3535072918,3652904859,2077965243,1893020342,1841768865,1724457132,1474502543,1559041666,1107234197,1257309336,598438867,681933534,901210569,1052338372,261314535,77422314,428819965,310463728,3409685355,3224740454,3710368113,3593056380,3875770207,3960309330,4045380933,4195456072,2471224067,2554718734,2237133081,2388260884,3212035895,3028143674,2842678573,2724322336,4138563181,4255350624,3769721975,3955191162,3667219033,3516619604,3431546947,3347532110,2933734917,2782082824,3099667487,3016697106,2196052529,2313884476,2499348523,2683765030,1179510461,1296297904,1347548327,1533017514,1786102409,1635502980,2087309459,2003294622,507358933,355706840,136428751,53458370,839224033,957055980,605657339,790073846,2373340630,2256028891,2607439820,2422494913,2706270690,2856345839,3075636216,3160175349,3573941694,3725069491,3273267108,3356761769,4181598602,4063242375,4011996048,3828103837,1033297158,915985419,730517276,545572369,296679730,446754879,129166120,213705253,1709610350,1860738147,1945798516,2029293177,1239331162,1120974935,1606591296,1422699085,4148292826,4233094615,3781033664,3931371469,3682191598,3497509347,3446004468,3328955385,2939266226,2755636671,3106780840,2988687269,2198438022,2282195339,2501218972,2652609425,1201765386,1286567175,1371368976,1521706781,1805211710,1620529459,2105887268,1988838185,533804130,350174575,164439672,46346101,870912086,954669403,636813900,788204353,2358957921,2274680428,2592523643,2441661558,2695033685,2880240216,3065962831,3182487618,3572145929,3756299780,3270937875,3388507166,4174560061,4091327024,4006521127,3854606378,1014646705,930369212,711349675,560487590,272786309,457992840,106852767,223377554,1678381017,1862534868,1914052035,2031621326,1211247597,1128014560,1580087799,1428173050,32283319,182621114,401639597,486441376,768917123,651868046,1003007129,818324884,1503449823,1385356242,1333838021,1150208456,1973745387,2125135846,1673061617,1756818940,2970356327,3120694122,2802849917,2887651696,2637442643,2520393566,2334669897,2149987652,3917234703,3799141122,4284502037,4100872472,3309594171,3460984630,3545789473,3629546796,2050466060,1899603969,1814803222,1730525723,1443857720,1560382517,1075025698,1260232239,575138148,692707433,878443390,1062597235,243256656,91341917,409198410,325965383,3403100636,3252238545,3704300486,3620022987,3874428392,3990953189,4042459122,4227665663,2460449204,2578018489,2226875310,2411029155,3198115200,3046200461,2827177882,2743944855],Ie[be([85,51])]=[0,218828297,437656594,387781147,875313188,958871085,775562294,590424639,1750626376,1699970625,1917742170,2135253587,1551124588,1367295589,1180849278,1265195639,3501252752,3720081049,3399941250,3350065803,3835484340,3919042237,4270507174,4085369519,3102249176,3051593425,2734591178,2952102595,2361698556,2177869557,2530391278,2614737639,3145456443,3060847922,2708326185,2892417312,2404901663,2187128086,2504130317,2555048196,3542330227,3727205754,3375740769,3292445032,3876557655,3926170974,4246310725,4027744588,1808481195,1723872674,1910319033,2094410160,1608975247,1391201670,1173430173,1224348052,59984867,244860394,428169201,344873464,935293895,984907214,766078933,547512796,1844882806,1627235199,2011214180,2062270317,1507497298,1423022939,1137477952,1321699145,95345982,145085239,532201772,313773861,830661914,1015671571,731183368,648017665,3175501286,2957853679,2807058932,2858115069,2305455554,2220981195,2474404304,2658625497,3575528878,3625268135,3473416636,3254988725,3778151818,3963161475,4213447064,4130281361,3599595085,3683022916,3432737375,3247465558,3802222185,4020912224,4172763771,4122762354,3201631749,3017672716,2764249623,2848461854,2331590177,2280796200,2431590963,2648976442,104699613,188127444,472615631,287343814,840019705,1058709744,671593195,621591778,1852171925,1668212892,1953757831,2037970062,1514790577,1463996600,1080017571,1297403050,3673637356,3623636965,3235995134,3454686199,4007360968,3822090177,4107101658,4190530515,2997825956,3215212461,2830708150,2779915199,2256734592,2340947849,2627016082,2443058075,172466556,122466165,273792366,492483431,1047239e3,861968209,612205898,695634755,1646252340,1863638845,2013908262,1963115311,1446242576,1530455833,1277555970,1093597963,1636604631,1820824798,2073724613,1989249228,1436590835,1487645946,1337376481,1119727848,164948639,81781910,331544205,516552836,1039717051,821288114,669961897,719700128,2973530695,3157750862,2871682645,2787207260,2232435299,2283490410,2667994737,2450346104,3647212047,3564045318,3279033885,3464042516,3980931627,3762502690,4150144569,4199882800,3070356634,3121275539,2904027272,2686254721,2200818878,2384911031,2570832044,2486224549,3747192018,3528626907,3310321856,3359936201,3950355702,3867060991,4049844452,4234721005,1739656202,1790575107,2108100632,1890328081,1402811438,1586903591,1233856572,1149249077,266959938,48394827,369057872,418672217,1002783846,919489135,567498868,752375421,209336225,24197544,376187827,459744698,945164165,895287692,574624663,793451934,1679968233,1764313568,2117360635,1933530610,1343127501,1560637892,1243112415,1192455638,3704280881,3519142200,3336358691,3419915562,3907448597,3857572124,4075877127,4294704398,3029510009,3113855344,2927934315,2744104290,2159976285,2377486676,2594734927,2544078150],Ie[be([85,52])]=[0,151849742,303699484,454499602,607398968,758720310,908999204,1059270954,1214797936,1097159550,1517440620,1400849762,1817998408,1699839814,2118541908,2001430874,2429595872,2581445614,2194319100,2345119218,3034881240,3186202582,2801699524,2951971274,3635996816,3518358430,3399679628,3283088770,4237083816,4118925222,4002861748,3885750714,1002142683,850817237,698445255,548169417,529487843,377642221,227885567,77089521,1943217067,2061379749,1640576439,1757691577,1474760595,1592394909,1174215055,1290801793,2875968315,2724642869,3111247143,2960971305,2405426947,2253581325,2638606623,2487810577,3808662347,3926825029,4044981591,4162096729,3342319475,3459953789,3576539503,3693126241,1986918061,2137062819,1685577905,1836772287,1381620373,1532285339,1078185097,1229899655,1040559837,923313619,740276417,621982671,439452389,322734571,137073913,19308535,3871163981,4021308739,4104605777,4255800159,3263785589,3414450555,3499326569,3651041127,2933202493,2815956275,3167684641,3049390895,2330014213,2213296395,2566595609,2448830231,1305906550,1155237496,1607244650,1455525988,1776460110,1626319424,2079897426,1928707164,96392454,213114376,396673818,514443284,562755902,679998e3,865136418,983426092,3708173718,3557504664,3474729866,3323011204,4180808110,4030667424,3945269170,3794078908,2507040230,2623762152,2272556026,2390325492,2975484382,3092726480,2738905026,2857194700,3973773121,3856137295,4274053469,4157467219,3371096953,3252932727,3673476453,3556361835,2763173681,2915017791,3064510765,3215307299,2156299017,2307622919,2459735317,2610011675,2081048481,1963412655,1846563261,1729977011,1480485785,1362321559,1243905413,1126790795,878845905,1030690015,645401037,796197571,274084841,425408743,38544885,188821243,3613494426,3731654548,3313212038,3430322568,4082475170,4200115116,3780097726,3896688048,2668221674,2516901860,2366882550,2216610296,3141400786,2989552604,2837966542,2687165888,1202797690,1320957812,1437280870,1554391400,1669664834,1787304780,1906247262,2022837584,265905162,114585348,499347990,349075736,736970802,585122620,972512814,821712160,2595684844,2478443234,2293045232,2174754046,3196267988,3079546586,2895723464,2777952454,3537852828,3687994002,3234156416,3385345166,4142626212,4293295786,3841024952,3992742070,174567692,57326082,410887952,292596766,777231668,660510266,1011452712,893681702,1108339068,1258480242,1343618912,1494807662,1715193156,1865862730,1948373848,2100090966,2701949495,2818666809,3004591147,3122358053,2235061775,2352307457,2535604243,2653899549,3915653703,3764988233,4219352155,4067639125,3444575871,3294430577,3746175075,3594982253,836553431,953270745,600235211,718002117,367585007,484830689,133361907,251657213,2041877159,1891211689,1806599355,1654886325,1568718495,1418573201,1335535747,1184342925];const Ae=new Uint8Array(16);for(let He=15;He>=0;--He)Ae[He]=ke%256,ke=parseInt(ke/256);let Se=null,Oe=16;const Ve=new Uint8Array(ve),Me=[],De=[];Ue();for(let He=0;He<xe[be([108,101,110,103,116,104])];He++)Oe===16&&(Se=$e(Ae),Oe=0,Be(Ae)),xe[He]^=Se[Oe++];return xe;function Fe(He){const ze=[];for(let qe=0;qe<He[be([108,101,110,103,116,104])];qe+=4)ze[be([112,117,115,104])](He[qe]<<24|He[qe+1]<<16|He[qe+2]<<8|He[qe+3]);return ze}function Be(He){for(let ze=15;ze>=0;ze--){if(He[ze]!==255){He[ze]++;break}He[ze]=0}}function $e(He){const ze=Me[be([108,101,110,103,116,104])]-1,qe=[0,0,0,0];let Ke=Fe(He);for(let Ye=0;Ye<4;Ye++)Ke[Ye]^=Me[0][Ye];for(let Ye=1;Ye<ze;Ye++){for(let ht=0;ht<4;ht++)qe[ht]=Ie[be([84,49])][Ke[ht]>>24&255]^Ie[be([84,50])][Ke[(ht+1)%4]>>16&255]^Ie[be([84,51])][Ke[(ht+2)%4]>>8&255]^Ie[be([84,52])][255&Ke[(ht+3)%4]]^Me[Ye][ht];Ke=qe[be([115,108,105,99,101])]()}const Qe=new Uint8Array(16);let je;for(let Ye=0;Ye<4;Ye++)je=Me[ze][Ye],Qe[4*Ye]=255&(Ie[be([83])][Ke[Ye]>>24&255]^je>>24),Qe[4*Ye+1]=255&(Ie[be([83])][Ke[(Ye+1)%4]>>16&255]^je>>16),Qe[4*Ye+2]=255&(Ie[be([83])][Ke[(Ye+2)%4]>>8&255]^je>>8),Qe[4*Ye+3]=255&(Ie[be([83])][255&Ke[(Ye+3)%4]]^je);return Qe}function Ue(){const He=Ie[be([110,117,109,98,101,114,79,102,82,111,117,110,100,115])][Ve[be([108,101,110,103,116,104])]];for(let Ze=0;Ze<=He;Ze++)Me[be([112,117,115,104])]([0,0,0,0]),De[be([112,117,115,104])]([0,0,0,0]);const ze=4*(He+1),qe=Ve[be([108,101,110,103,116,104])]/4,Ke=Fe(Ve);let Qe;for(let Ze=0;Ze<qe;Ze++)Qe=Ze>>2,Me[Qe][Ze%4]=Ke[Ze],De[He-Qe][Ze%4]=Ke[Ze];let je,Ye=0,ht=qe;for(;ht<ze;){je=Ke[qe-1],Ke[0]^=Ie[be([83])][je>>16&255]<<24^Ie[be([83])][je>>8&255]<<16^Ie[be([83])][255&je]<<8^Ie[be([83])][je>>24&255]^Ie[be([114,99,111,110])][Ye]<<24,Ye+=1;for(let Yt=1;Yt<qe/2;Yt++)Ke[Yt]^=Ke[Yt-1];je=Ke[qe/2-1],Ke[qe/2]^=Ie[be([83])][255&je]^Ie[be([83])][je>>8&255]<<8^Ie[be([83])][je>>16&255]<<16^Ie[be([83])][je>>24&255]<<24;for(let Yt=qe/2+1;Yt<qe;Yt++)Ke[Yt]^=Ke[Yt-1];let Ze,Bt,Jt=0;for(;Jt<qe&&ht<ze;)Ze=ht>>2,Bt=ht%4,Me[Ze][Bt]=Ke[Jt],De[He-Ze][Bt]=Ke[Jt++],ht++}for(let Ze=1;Ze<He;Ze++)for(let Bt=0;Bt<4;Bt++)je=De[Ze][Bt],De[Ze][Bt]=Ie[be([85,49])][je>>24&255]^Ie[be([85,50])][je>>16&255]^Ie[be([85,51])][je>>8&255]^Ie[be([85,52])][255&je]}}function be(xe){return xe.map(ve=>String.fromCharCode(ve)).join("")}(xe=>{function ve(){const Ne=[{[be([105,100])]:1,[be([102,101,97,116,117,114,101,78,97,109,101])]:be([67,111,109,109,101,110,116,115]),[be([112,108,117,103,105,110,78,97,109,101])]:be([67,111,109,109,101,110,116,115,82,101,112,111,115,105,116,111,114,121]),[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:be([108,105,99,101,110,115,101,75,101,121]),[be([104,97,110,100,108,101,114])]:be([99,104,101,99,107,76,105,99,101,110,115,101]),[be([99,104,101,99,107,65,108,115,111])]:[{[be([105,100])]:2,[be([102,101,97,116,117,114,101,78,97,109,101])]:be([84,114,97,99,107,32,67,104,97,110,103,101,115]),[be([112,108,117,103,105,110,78,97,109,101])]:be([84,114,97,99,107,67,104,97,110,103,101,115,69,100,105,116,105,110,103]),[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:be([108,105,99,101,110,115,101,75,101,121]),[be([104,97,110,100,108,101,114])]:be([99,104,101,99,107,76,105,99,101,110,115,101,70,111,114,84,114,97,99,107,67,104,97,110,103,101,115]),[be([111,112,116,105,111,110,115])]:{[be([97,105,119,115,103,105,99])]:!0,[be([97,105,116,99,100,103,105,108])]:!0,[be([97,105,114,118,105,105,108])]:!0}}],[be([111,112,116,105,111,110,115])]:{[be([97,105,119,115,103,105,99])]:!0,[be([97,105,116,99,100,103,105,108])]:!0,[be([97,105,114,118,105,105,108])]:!0}},{[be([105,100])]:3,[be([102,101,97,116,117,114,101,78,97,109,101])]:be([80,97,103,105,110,97,116,105,111,110]),[be([112,108,117,103,105,110,78,97,109,101])]:be([80,97,103,105,110,97,116,105,111,110,76,111,111,107,117,112]),[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:be([112,97,103,105,110,97,116,105,111,110,76,105,99,101,110,115,101,75,101,121]),[be([104,97,110,100,108,101,114])]:be([99,104,101,99,107,76,105,99,101,110,115,101])},{[be([105,100])]:4,[be([102,101,97,116,117,114,101,78,97,109,101])]:be([82,101,118,105,115,105,111,110,32,72,105,115,116,111,114,121]),[be([112,108,117,103,105,110,78,97,109,101])]:be([82,101,118,105,115,105,111,110,115,82,101,112,111,115,105,116,111,114,121]),[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:be([108,105,99,101,110,115,101,75,101,121]),[be([104,97,110,100,108,101,114])]:be([99,104,101,99,107,76,105,99,101,110,115,101,70,111,114,82,101,118,105,115,105,111,110,72,105,115,116,111,114,121]),[be([111,112,116,105,111,110,115])]:{[be([97,105,119,115,103,105,99])]:!0,[be([97,105,116,99,100,103,105,108])]:!0,[be([97,105,114,118,105,105,108])]:!0}},{[be([105,100])]:5,[be([102,101,97,116,117,114,101,78,97,109,101])]:be([68,111,99,117,109,101,110,116,32,79,117,116,108,105,110,101]),[be([112,108,117,103,105,110,78,97,109,101])]:be([68,111,99,117,109,101,110,116,79,117,116,108,105,110,101,85,73]),[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:be([100,111,99,117,109,101,110,116,79,117,116,108,105,110,101,76,105,99,101,110,115,101,75,101,121]),[be([104,97,110,100,108,101,114])]:be([99,104,101,99,107,76,105,99,101,110,115,101]),[be([111,112,116,105,111,110,115])]:{[be([102,103,105])]:[12]}},{[be([105,100])]:6,[be([102,101,97,116,117,114,101,78,97,109,101])]:be([70,111,114,109,97,116,32,80,97,105,110,116,101,114]),[be([112,108,117,103,105,110,78,97,109,101])]:be([70,111,114,109,97,116,80,97,105,110,116,101,114,85,73]),[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:be([102,111,114,109,97,116,80,97,105,110,116,101,114,76,105,99,101,110,115,101,75,101,121]),[be([104,97,110,100,108,101,114])]:be([99,104,101,99,107,76,105,99,101,110,115,101]),[be([111,112,116,105,111,110,115])]:{[be([102,103,105])]:[12]}},{[be([105,100])]:7,[be([102,101,97,116,117,114,101,78,97,109,101])]:be([83,108,97,115,104,32,67,111,109,109,97,110,100]),[be([112,108,117,103,105,110,78,97,109,101])]:be([83,108,97,115,104,67,111,109,109,97,110,100,85,73]),[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:be([115,108,97,115,104,67,111,109,109,97,110,100,76,105,99,101,110,115,101,75,101,121]),[be([104,97,110,100,108,101,114])]:be([99,104,101,99,107,76,105,99,101,110,115,101]),[be([111,112,116,105,111,110,115])]:{[be([102,103,105])]:[12]}},{[be([105,100])]:8,[be([102,101,97,116,117,114,101,78,97,109,101])]:be([84,97,98,108,101,32,111,102,32,67,111,110,116,101,110,116,115]),[be([112,108,117,103,105,110,78,97,109,101])]:be([84,97,98,108,101,79,102,67,111,110,116,101,110,116,115,69,100,105,116,105,110,103]),[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:be([116,97,98,108,101,79,102,67,111,110,116,101,110,116,115,76,105,99,101,110,115,101,75,101,121]),[be([104,97,110,100,108,101,114])]:be([99,104,101,99,107,76,105,99,101,110,115,101]),[be([111,112,116,105,111,110,115])]:{[be([102,103,105])]:[12]}},{[be([105,100])]:9,[be([102,101,97,116,117,114,101,78,97,109,101])]:be([84,101,109,112,108,97,116,101]),[be([112,108,117,103,105,110,78,97,109,101])]:be([84,101,109,112,108,97,116,101,85,73]),[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:be([116,101,109,112,108,97,116,101,76,105,99,101,110,115,101,75,101,121]),[be([104,97,110,100,108,101,114])]:be([99,104,101,99,107,76,105,99,101,110,115,101]),[be([111,112,116,105,111,110,115])]:{[be([102,103,105])]:[12,14]}},{[be([105,100])]:10,[be([102,101,97,116,117,114,101,78,97,109,101])]:be([80,97,115,116,101,32,102,114,111,109,32,79,102,102,105,99,101,32,69,110,104,97,110,99,101,100]),[be([112,108,117,103,105,110,78,97,109,101])]:be([80,97,115,116,101,70,114,111,109,79,102,102,105,99,101,69,110,104,97,110,99,101,100,73,110,108,105,110,101,114]),[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:be([112,97,115,116,101,70,114,111,109,79,102,102,105,99,101,69,110,104,97,110,99,101,100,76,105,99,101,110,115,101,75,101,121]),[be([104,97,110,100,108,101,114])]:be([99,104,101,99,107,76,105,99,101,110,115,101]),[be([111,112,116,105,111,110,115])]:{[be([102,103,105])]:[12]}},{[be([105,100])]:11,[be([102,101,97,116,117,114,101,78,97,109,101])]:be([65,73,32,65,115,115,105,115,116,97,110,116]),[be([112,108,117,103,105,110,78,97,109,101])]:be([65,73,65,115,115,105,115,116,97,110,116,85,73]),[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:be([97,105,76,105,99,101,110,115,101,75,101,121]),[be([104,97,110,100,108,101,114])]:be([99,104,101,99,107,76,105,99,101,110,115,101])},{[be([105,100])]:12,[be([102,101,97,116,117,114,101,78,97,109,101])]:be([80,114,111,100,117,99,116,105,118,105,116,121,32,112,97,99,107])},{[be([105,100])]:13,[be([102,101,97,116,117,114,101,78,97,109,101])]:be([67,97,115,101,32,67,104,97,110,103,101]),[be([112,108,117,103,105,110,78,97,109,101])]:be([67,97,115,101,67,104,97,110,103,101,85,73]),[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:be([99,97,115,101,67,104,97,110,103,101,76,105,99,101,110,115,101,75,101,121]),[be([104,97,110,100,108,101,114])]:be([99,104,101,99,107,76,105,99,101,110,115,101]),[be([111,112,116,105,111,110,115])]:{[be([102,103,105])]:[12]}},{[be([105,100])]:14,[be([102,101,97,116,117,114,101,78,97,109,101])]:be([68,114,117,112,97,108,32,112,97,99,107]),[be([102,111,114,98,105,100,100,101,110,72,97,110,100,108,101,114])]:be([102,111,114,98,105,100,100,101,110,72,97,110,100,108,101,114,70,111,114,68,114,117,112,97,108])},{[be([105,100])]:15,[be([102,101,97,116,117,114,101,78,97,109,101])]:be([77,117,108,116,105,32,76,101,118,101,108,32,76,105,115,116]),[be([112,108,117,103,105,110,78,97,109,101])]:be([77,117,108,116,105,76,101,118,101,108,76,105,115,116,69,100,105,116,105,110,103]),[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:be([109,117,108,116,105,76,101,118,101,108,76,105,115,116,76,105,99,101,110,115,101,75,101,121]),[be([104,97,110,100,108,101,114])]:be([99,104,101,99,107,76,105,99,101,110,115,101])},{[be([105,100])]:16,[be([102,101,97,116,117,114,101,78,97,109,101])]:be([77,101,114,103,101,32,70,105,101,108,100,115]),[be([112,108,117,103,105,110,78,97,109,101])]:be([77,101,114,103,101,70,105,101,108,100,115,85,73]),[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:be([109,101,114,103,101,70,105,101,108,100,115,76,105,99,101,110,115,101,75,101,121]),[be([104,97,110,100,108,101,114])]:be([99,104,101,99,107,76,105,99,101,110,115,101]),[be([111,112,116,105,111,110,115])]:{[be([102,103,105])]:[12]}}];return We(Ne),Ne;function Le(Je){return 1<<Je-1}function We(Je){Je[be([102,111,114,69,97,99,104])](Wt=>{Wt[be([112,101,114,109,105,115,115,105,111,110,77,97,115,107])]=Le(Wt[be([105,100])]),ke(Wt)&&Wt[be([99,104,101,99,107,65,108,115,111])]&&We(Wt[be([99,104,101,99,107,65,108,115,111])])})}}function ke(Ne){return be([112,108,117,103,105,110,78,97,109,101])in Ne}const Ie=[1,85,78,115,198,255,50,112,83,87,161],Ae=[127,34,6,211,167,86,146,199,132,160,18];function Se(Ne){const Le=[29,221,175,90,231,133,239,240,75,180];return Oe(Ne,new Uint8Array([...Ie,...Le,...Ae]))}function Oe(Ne,Le){const We=Ve(Ne),Je=Array[be([102,114,111,109])](Ge(We)),Wt=Je[be([112,111,112])](),nn=Je[be([112,111,112])]();return pn(te(Je,Le,nn+256*Wt))}function Ve(Ne){const Le=atob(Ne),[We,Je]=Le[be([115,112,108,105,116])](be([45]));try{if(atob(Je))return atob(We)}catch{}return Le}function Me(Ne){try{const Le=Se(Ne),We=JSON[be([112,97,114,115,101])](Le),Je=parseInt(We[be([49])]),Wt=We[be([50])]||"",nn=parseInt(We[be([51])]),cn=parseInt(We[be([52])])||0,fn=parseInt(We[be([53])])||0;return{[be([112,114,111,100,117,99,116,78,97,109,101])]:Wt,[be([97,108,108,111,119,101,100,80,108,117,103,105,110,115])]:cn,[be([101,120,112,105,114,97,116,105,111,110,68,97,116,101])]:Je,[be([105,115,84,114,105,97,108])]:nn,[be([105,115,73,110,116,101,114,110,97,108])]:fn}}catch{return null}}const De=ve(),Fe={[be([99,104,101,99,107,76,105,99,101,110,115,101])]:Qe,[be([99,104,101,99,107,76,105,99,101,110,115,101,70,111,114,84,114,97,99,107,67,104,97,110,103,101,115])]:je,[be([99,104,101,99,107,76,105,99,101,110,115,101,70,111,114,82,101,118,105,115,105,111,110,72,105,115,116,111,114,121])]:Ye},Be=xe[be([99,111,110,115,116,114,117,99,116,111,114])][be([112,108,117,103,105,110,78,97,109,101])],$e=be([99,111,110,116,101,120,116])in xe?xe.context:xe.editor,Ue=be([52,48,52,56,49,52,50,50]),He=be([65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,48,49,50,51,52,53,54,55,56,57]),ze=$e.config.get(be([108,105,99,101,110,115,101,75,101,121])),qe=De[be([102,105,108,116,101,114])](ke)[be([102,105,110,100])](Ne=>Ne[be([112,108,117,103,105,110,78,97,109,101])]===Be);function Ke(Ne,Le){Fe[Le[be([104,97,110,100,108,101,114])]](Ne,Le),Le[be([99,104,101,99,107,65,108,115,111])]&&Le[be([99,104,101,99,107,65,108,115,111])][be([102,105,108,116,101,114])](We=>Kt($e,We[be([112,108,117,103,105,110,78,97,109,101])]))[be([102,111,114,69,97,99,104])](We=>Ke(Ne,We))}function Qe(Ne,Le){Ze(ht(Ne,Le),Le)}function je(Ne,Le){function We(Je,Wt){try{if(Kt($e,be([84,114,97,99,107,67,104,97,110,103,101,115,69,100,105,116,105,110,103]))&&Je){const nn=Xt($e,be([84,114,97,99,107,67,104,97,110,103,101,115,69,100,105,116,105,110,103]))[be([95,101,120,101,99,117,116,101,83,117,103,103,101,115,116,105,111,110])];if(parseInt(nn)/2>Je[be([101,120,112,105,114,97,116,105,111,110,68,97,116,101])])return Bt(Wt[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+be([73,110,118,97,108,105,100]))}return ht(Je,Wt)}catch{return Bt(Wt[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+be([73,110,118,97,108,105,100]))}}Ze(We(Ne,Le),Le)}function Ye(Ne,Le){const We=Ae[0]*Ie[1],Je=Ae[0]*Ie[2],Wt=Ae[2]*Ie[2];Kt($e,be([87,101,98,83,111,99,107,101,116,71,97,116,101,119,97,121]))&&Xt($e,be([87,101,98,83,111,99,107,101,116,71,97,116,101,119,97,121]))[be([115,116,97,116,101])]==be([99,111,110,110,101,99,116,101,100])&&(window[Jt()]=Wt);function nn(Xe,Qt){try{return un()?Bt(Qt[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+be([86,97,108,105,100])):ht(Xe,Qt)}catch{return Bt(Qt[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+be([73,110,118,97,108,105,100]))}}function cn(Xe,Qt){if(Xe==Qt[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+be([73,110,118,97,108,105,100]))zt();else if(Xe==Qt[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+be([84,114,105,97,108])){const rn=fn();rn&&ln(rn,Qt[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]);const xn=dn();window[be([115,101,116,84,105,109,101,111,117,116])](()=>{ln(be([116,105,109,101]),Qt[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])])},xn);const wn=Xt($e,be([82,101,118,105,115,105,111,110,115,82,101,112,111,115,105,116,111,114,121]))[be([95,114,101,118,105,115,105,111,110,115])];wn[be([108,101,110,103,116,104])]>=7?ln(be([114,101,118,105,115,105,111,110,115]),Qt[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]):wn.on(be([97,100,100]),()=>{wn[be([108,101,110,103,116,104])]>=7&&ln(be([114,101,118,105,115,105,111,110,115]),Qt[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])])})}}function fn(){if(!Kt($e,be([82,101,118,105,115,105,111,110,86,105,101,119,101,114])))return!1;for(const Xe in window)if(Number.isNaN(Number(Xe))){if(window[Xe]===We)return be([116,105,109,101]);if(window[Xe]===Je)return be([114,101,118,105,115,105,111,110,115])}return!1}function un(){if(!Kt($e,be([82,101,118,105,115,105,111,110,86,105,101,119,101,114])))return!1;for(const Xe in window)if(Number.isNaN(Number(Xe))&&window[Xe]===Wt)return!0;return!1}function ln(Xe,Qt){zt(),Bt(Qt+be([84,114,105,97,108,76,105,109,105,116,58])+Xe),window[Jt()]=Xe===be([116,105,109,101])?We:Je}function dn(){let Xe=Ae[6]*Ie[8]*Ie[6];return Kt($e,be([82,101,118,105,115,105,111,110,86,105,101,119,101,114]))&&(Xe/=10),Xe}function zt(){const Xe=$e;function Qt(){Kt(Xe,be([82,101,118,105,115,105,111,110,84,114,97,99,107,101,114]))&&(Xt(Xe,be([82,101,118,105,115,105,111,110,84,114,97,99,107,101,114]))[be([117,110,98,105,110,100])](be([105,115,69,110,97,98,108,101,100])),Xt(Xe,be([82,101,118,105,115,105,111,110,84,114,97,99,107,101,114]))[be([105,115,69,110,97,98,108,101,100])]=!1,Xt(Xe,be([82,101,118,105,115,105,111,110,84,114,97,99,107,101,114]))[be([117,112,100,97,116,101])]=sn,Xt(Xe,be([82,101,118,105,115,105,111,110,84,114,97,99,107,101,114]))[be([115,97,118,101,82,101,118,105,115,105,111,110])]=sn,Xe[be([109,111,100,101,108])][be([99,104,97,110,103,101])]=sn,Xe[be([109,111,100,101,108])][be([101,110,113,117,101,117,101,67,104,97,110,103,101])]=sn,Xe[be([101,110,97,98,108,101,82,101,97,100,79,110,108,121,77,111,100,101])](be([109,111,100,101,108]))),Kt(Xe,be([82,101,118,105,115,105,111,110,86,105,101,119,101,114]))&&(Xt(Xe,be([82,101,118,105,115,105,111,110,86,105,101,119,101,114]))[be([117,110,98,105,110,100])](be([105,115,69,110,97,98,108,101,100])),Xt(Xe,be([82,101,118,105,115,105,111,110,86,105,101,119,101,114]))[be([105,115,69,110,97,98,108,101,100])]=!1,Xt(Xe,be([82,101,118,105,115,105,111,110,86,105,101,119,101,114]))[be([99,111,109,112,97,114,101])]=sn,Xt(Xe,be([82,101,118,105,115,105,111,110,86,105,101,119,101,114]))[be([95,103,101,116,68,105,102,102])]=sn)}Xe[be([115,116,97,116,101])]==be([114,101,97,100,121])?Qt():Xe[be([111,110,99,101])](be([114,101,97,100,121]),()=>{if(Kt(Xe,be([82,101,118,105,115,105,111,110,84,114,97,99,107,101,114]))&&Qt(),Kt(Xe,be([82,101,118,105,115,105,111,110,86,105,101,119,101,114]))){const an=Xt(Xe,be([82,101,118,105,115,105,111,110,115,82,101,112,111,115,105,116,111,114,121])),rn=an.getRevision(0),xn=an.getEarlierVisibleRevision(rn[be([105,100])]);Xt(Xe,be([82,101,118,105,115,105,111,110,86,105,101,119,101,114]))[be([99,111,109,112,97,114,101])](rn[be([105,100])],xn?xn[be([105,100])]:null,1).then(()=>Qt())}})}cn(nn(Ne,Le),Le)}function ht(Ne,Le){try{return tn(Le)?Bt(Le[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+be([86,97,108,105,100])):Ne&&hn(Ne[be([97,108,108,111,119,101,100,80,108,117,103,105,110,115])],Le)?Ne[be([105,115,73,110,116,101,114,110,97,108])]&&!window[be([111,112,101,110])][be([99,108,111,115,101,100])]||parseInt(Ue)/2>Ne[be([101,120,112,105,114,97,116,105,111,110,68,97,116,101])]?Bt(Le[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+be([73,110,118,97,108,105,100])):Ne[be([105,115,84,114,105,97,108])]?Bt(Le[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+be([84,114,105,97,108])):Bt(Le[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+be([86,97,108,105,100])):Bt(Le[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+be([73,110,118,97,108,105,100]))}catch{return Bt(Le[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+be([73,110,118,97,108,105,100]))}}function Ze(Ne,Le){if($e instanceof Context){const We=$e;Ne==Le[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+be([73,110,118,97,108,105,100])?Yt(We):Ne==Le[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+be([84,114,105,97,108])&&window[be([115,101,116,84,105,109,101,111,117,116])](()=>{Yt(We),Bt(Le[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+be([84,114,105,97,108,76,105,109,105,116,58,116,105,109,101]))},Ae[6]*Ie[8]*Ie[6]),We[be([101,100,105,116,111,114,115])][be([111,110])](be([97,100,100]),(Je,Wt)=>{Ne!=Le[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+be([73,110,118,97,108,105,100])&&Ne!=Le[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+be([84,114,105,97,108,76,105,109,105,116,58,116,105,109,101])&&Ne!=Le[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+be([84,114,105,97,108,76,105,109,105,116,58,111,112,101,114,97,116,105,111,110,115])||en(Wt)})}else{const We=$e;Ne==Le[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+be([73,110,118,97,108,105,100])?en(We):Ne==Le[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+be([84,114,105,97,108])&&We[be([111,110])](be([114,101,97,100,121]),()=>{let Je=0;We[be([109,111,100,101,108])][be([111,110])](be([97,112,112,108,121,79,112,101,114,97,116,105,111,110]),(Wt,nn)=>{nn[0][be([105,115,68,111,99,117,109,101,110,116,79,112,101,114,97,116,105,111,110])]&&Je++,Je===504&&(en(We),Bt(Le[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+be([84,114,105,97,108,76,105,109,105,116,58,111,112,101,114,97,116,105,111,110,115])),Wt[be([111,102,102])]())},{priority:be([104,105,103,104,101,115,116])})})}}function Bt(Ne){const Le=Jt();return $e[Le]=Ne,Ne}function Jt(){const Ne=String(window[be([112,101,114,102,111,114,109,97,110,99,101])][be([110,111,119])]())[be([114,101,112,108,97,99,101])](be([46]),"");let Le="";for(let We=0;We<Ne[be([108,101,110,103,116,104])];We+=2){let Je=parseInt(Ne[be([115,117,98,115,116,114,105,110,103])](We,We+2));Je>=He[be([108,101,110,103,116,104])]&&(Je-=He[be([108,101,110,103,116,104])]),Le+=He[Je]}return Le}function Yt(Ne){for(const Le of Ne[be([101,100,105,116,111,114,115])])en(Le);Xt(Ne,be([67,111,109,109,101,110,116,115,82,101,112,111,115,105,116,111,114,121]))[be([115,119,105,116,99,104,82,101,97,100,79,110,108,121])](!0),Xt(Ne,be([67,111,109,109,101,110,116,115,82,101,112,111,115,105,116,111,114,121]))[be([115,119,105,116,99,104,82,101,97,100,79,110,108,121])]=sn}function en(Ne){function Le(){Ne[be([109,111,100,101,108])][be([99,104,97,110,103,101])]=sn,Ne[be([109,111,100,101,108])][be([101,110,113,117,101,117,101,67,104,97,110,103,101])]=sn,Ne[be([101,110,97,98,108,101,82,101,97,100,79,110,108,121,77,111,100,101])](be([109,111,100,101,108]))}Ne[be([115,116,97,116,101])]==be([114,101,97,100,121])?Le():Ne[be([111,110,99,101])](be([114,101,97,100,121]),()=>Le())}function sn(){return null}function hn(Ne,Le){const We=!!(Ne&Le[be([112,101,114,109,105,115,115,105,111,110,77,97,115,107])]),Je=mn(Ne,Le);return We||Je}function mn(Ne,Le){const We=(Le[be([111,112,116,105,111,110,115])]||{})[be([102,103,105])]||null;return!!We&&De[be([102,105,108,116,101,114])](Je=>We[be([105,110,99,108,117,100,101,115])](Je[be([105,100])]))[be([102,105,108,116,101,114])](Je=>!bn(Je))[be([115,111,109,101])](Je=>!!(Ne&Je[be([112,101,114,109,105,115,115,105,111,110,77,97,115,107])]))}function bn(Ne){const Le={[be([102,111,114,98,105,100,100,101,110,72,97,110,100,108,101,114,70,111,114,68,114,117,112,97,108])]:gn};return!!Ne.forbiddenHandler&&Le[Ne.forbiddenHandler]()}function gn(){return!window[be([68,114,117,112,97,108])]||!Kt($e,be([100,114,117,112,97,108,80,111,119,101,114,101,100,66,121]))}function tn(Ne){if(!Kt($e,Ne[be([112,108,117,103,105,110,78,97,109,101])]))return!0;const Le=Ne[be([111,112,116,105,111,110,115])]||{},We=Le[be([97,105,119,115,103,105,99])]||!1,Je=Le[be([97,105,116,99,100,103,105,108])]||!1,Wt=Le[be([97,105,114,118,105,105,108])]||!1;return Kt($e,be([87,101,98,83,111,99,107,101,116,71,97,116,101,119,97,121]))&&Xt($e,be([87,101,98,83,111,99,107,101,116,71,97,116,101,119,97,121]))[be([115,116,97,116,101])]==be([99,111,110,110,101,99,116,101,100])&&We||Kt($e,be([84,114,97,99,107,67,104,97,110,103,101,115,68,97,116,97,71,101,116,116,101,114]))&&Xt($e,be([84,114,97,99,107,67,104,97,110,103,101,115,68,97,116,97,71,101,116,116,101,114]))[be([114,101,115,117,108,116])]==be([101,110,100])&&Je?!0:!(!Kt($e,be([82,101,118,105,115,105,111,110,86,105,101,119,101,114,73,110,116,101,103,114,97,116,105,111,110]))||Xt($e,be([82,101,118,105,115,105,111,110,86,105,101,119,101,114,73,110,116,101,103,114,97,116,105,111,110]))[be([114,101,115,117,108,116])]!=be([101,110,100])||!Wt)}function Kt(Ne,Le){return Ne[be([112,108,117,103,105,110,115])][be([104,97,115])](Le)}function Xt(Ne,Le){return Ne[be([112,108,117,103,105,110,115])][be([103,101,116])](Le)}function pn(Ne){let Le="";for(const We of Ne)Le+=String[be([102,114,111,109,67,104,97,114,67,111,100,101])](We);return Le}function Ge(Ne){const Le=new Uint8Array(Ne[be([108,101,110,103,116,104])]);for(let We=0;We<Ne[be([108,101,110,103,116,104])];We++)Le[We]=Ne[be([99,104,97,114,67,111,100,101,65,116])](We);return Le}qe&&Ke(Me(ze),qe)})(t)})(this)}destroy(){super.destroy(),this._pagesContainer&&(this._recalculatePageBreaksDebounced.cancel(),this._pagesContainer.destroy(),this._pagesContainer.element.remove())}_onUiReady(){const t=this.editor,te=t.editing.view,be=this._getAttachedDomRoot();if(!be||be.childElementCount===0)return void t.ui.once("update",()=>this._onUiReady());const{pageWidth:xe,pageHeight:ve}=t.config.get("pagination"),{top:ke,left:Ie,bottom:Ae,right:Se}=this._configuredPaddings;this._pagesContainer=new View(t.locale);const Oe=this._pagesContainer;Oe.set("class",""),Oe.setTemplate({tag:"div",attributes:{contenteditable:!0,style:{columnWidth:xe,width:xe,height:"calc( "+ve+" - "+ke+" - "+Ae+" )",minWidth:"auto",minHeight:"auto",padding:"0 "+Se+" 0 "+Ie,columnGap:"100px",border:0,boxSizing:"border-box",columnCount:"auto",columnFill:"auto",overflow:"hidden",position:"absolute",top:"-99999px",left:"-99999px"},tabindex:"-1",class:Oe.bindTemplate.to("class")}}),Oe.render(),be.parentNode.insertBefore(Oe.element,be.nextSibling),this.listenTo(te,"render",()=>this._recalculatePageBreaksDebounced(),{priority:"low"}),this._recalculatePageBreaksDebounced()}_getAttachedDomRoot(){for(const t of this.editor.editing.view.domRoots.values())if(t.ownerDocument.body.contains(t))return t;return null}_recalculatePageBreaks(){if(!this.isEnabled)return Promise.resolve();const t=this.editor.editing.view,te=this._pagesContainer,be=this._getAttachedDomRoot();if(!be)return Promise.resolve();for(te.class=["ck-reset","ck-pagination-view",...be.classList].join(" ");te.element.firstChild;)te.element.firstChild.remove();const xe=Array.from(t.domRoots);xe.sort(([,ve],[,ke])=>ve.compareDocumentPosition(ke)==Node.DOCUMENT_POSITION_PRECEDING?1:-1);for(const[ve,ke]of xe){const Ie=document.createElement("div");Ie.dataset.rootName=ve,te.element.append(Ie);for(const Ae of[...ke.cloneNode(!0).childNodes])Ie.append(Ae)}return function(ve){return Promise.all(ve.map(ke=>Promise.race([p$4(ke),w$1(1e3)])))}(Array.from(te.element.querySelectorAll("img"))).then(()=>this._updatePageBreaksData())}_updatePageBreaksData(){const t=this._pagesContainer.element;if(!t.ownerDocument.body.contains(t))return;const te=new Rect(t).excludeScrollbarsAndBorders(),be=global.window.getComputedStyle(t),xe=parseFloat(be.paddingLeft)+parseFloat(be.paddingRight),ve=Math.floor(te.width+100-xe),ke=k$3(t,Math.floor(te.left-t.scrollLeft),ve).map(Ie=>this._mapPageStarterInfoToPageBreakInfo(Ie));ke.every(Ie=>!!Ie)&&(this.pageBreaks=ke)}_mapPageStarterInfoToPageBreakInfo(t){const te=this.editor.editing.view,be=this.editor.editing.mapper,xe=te.domConverter,ve=t.path.shift(),ke=this._pagesContainer.element.childNodes[ve].dataset.rootName,Ie=te.getDomRoot(ke);if(!Ie)return null;const Ae=function(Oe,Ve){let Me=Oe;for(const De of Ve.path){if(!Me)return null;Me=Me.childNodes[De]}return Me}(Ie,t);if(!Ae)return null;const Se=xe.domPositionToView(Ae,t.textOffset||0);return Se?t.type=="manual"?this._mapManualPageStarterInfoToPageBreakInfo(Se,Ae):t.type=="text"&&be.toModelPosition(Se).offset?this._mapTextPageStarterInfoToPageBreakInfo(Se,Ae,t.textOffset):this._mapElementPageStarterInfoToPageBreakInfo(Se,Ae,t.offset):null}_mapManualPageStarterInfoToPageBreakInfo(t,te){const be=this.editor.model,xe=this.editor.editing.mapper.toModelElement(t.parent),ve=be.createRangeOn(xe);return new R$3({type:"manual",modelRange:ve,domNode:te,offset:0})}_mapTextPageStarterInfoToPageBreakInfo(t,te,be){const xe=this.editor.model,ve=this.editor.editing.mapper,ke=this.editor.editing.view.domConverter;if(be>=te.length)return null;const Ie=ve.toModelPosition(t),Ae=xe.createRange(Ie),Se=ve.findMappedViewAncestor(t),Oe=ke.mapViewToDom(Se);return new R$3({type:"text",modelRange:Ae,domNode:te,offset:g$2(te,be,Oe)})}_mapElementPageStarterInfoToPageBreakInfo(t,te,be){const xe=this.editor.model,ve=this.editor.editing,ke=ve.mapper,Ie=ve.view.domConverter,Ae=ke.findMappedViewAncestor(t),Se=ke.toModelElement(Ae),Oe=function(ze){const qe=ze.parent,Ke=qe.root.document.model,Qe=qe.getAncestors({parentFirst:!0,includeSelf:!0});let je=null;for(const Ye of Qe){if(Ye.is("rootElement")||!Ke.createPositionBefore(Ye).isTouching(ze))return je;je=Ye}}(xe.createPositionBefore(Se)),Ve=Oe||Se;let Me=ke.toViewElement(Ve),De=xe.createRangeOn(Ve);const Fe=xe.createPositionBefore(Ve).nodeBefore;if(Fe&&Fe.is("element","imageBlock")){const ze=ke.toViewElement(Fe),qe=Ie.mapViewToDom(ze),Ke=global.window.getComputedStyle(qe).float;Ke!="left"&&Ke!="right"||(De=xe.createRangeOn(Fe))}for(;Me.parent!==Me.root&&Me.index===0;)Me=Me.parent;const Be=new Rect(S$1(te)?te:y$4(te)),$e=be?Be.height-be:0,Ue=Ie.mapViewToDom(Me),He=new Rect(Ue);return new R$3({type:"element",modelRange:De,domNode:Ue,offset:Math.round($e)?$e+Be.top-He.top:0})}get _configuredPaddings(){const t=this.editor.config.get("pagination.pageMargins");return Object.assign({top:"10mm",bottom:"10mm",left:"10mm",right:"10mm"},t)}static _findPageStarterInfos(t,te,be,xe){return k$3(t,te,be,xe)}},R$3=class{constructor({type:we,modelRange:t,domNode:te,offset:be}){Re(this,"type");Re(this,"modelRange");Re(this,"_domNode");Re(this,"_offset");this.type=we,this.modelRange=t,this._domNode=te,this._offset=be}get offset(){if(!this._domNode.ownerDocument.body.contains(this._domNode))return 0;const we=new Rect(S$1(this._domNode)?this._domNode:y$4(this._domNode));return this.type=="manual"?we.top+we.height/2:we.top+this._offset}};function g$2(Te,we,t){const te=y$4(Te),be=function(Ie){const Ae=global.document.createRange();return Ae.selectNodeContents(Ie),Ae}(t);let xe;xe=we==0?P$2(be.startContainer,be.startOffset,Te.parentNode,Array.from(Te.parentNode.childNodes).indexOf(Te)):P$2(be.startContainer,be.startOffset,Te,we);const ve=P$2(Te,we,be.endContainer,be.endOffset),ke=new Rect(xe).bottom;return(new Rect(ve).top+ke)/2-new Rect(te).top}function p$4(Te){return new Promise(we=>{function t(){Te.removeEventListener("load",t),Te.removeEventListener("error",t),we()}Te.complete?we():(Te.addEventListener("load",t),Te.addEventListener("error",t))})}function w$1(Te){return new Promise(we=>setTimeout(we,Te))}function y$4(Te){const we=global.document.createRange();return we.selectNode(Te),we}function b$2(Te,we,t){const te=global.document.createRange();return te.setStart(Te,we),te.setEnd(Te,t),te}function P$2(Te,we,t,te){const be=global.document.createRange();return be.setStart(Te,we),be.setEnd(t,te),be}function k$3(Te,we,t,te){const be=[];for(const[xe,ve]of Te.childNodes.entries()){let ke=[];S$1(ve)&&ve.offsetParent&&!ve.style.position?ke=I$2(ve,xe,we,t,te):A$2(ve)&&(ke=x$3(ve,xe,we,t,te)),ke.length&&(be.push(...ke),we+=ke.length*t,te=!1)}return be}function I$2(Te,we,t,te,be){const xe=[];var ve;(ve=Te.previousSibling)&&S$1(ve)&&(ve.classList.contains("page-break")||ve.closest(".page-break"))&&(xe.push({type:"manual",offset:0,path:[we-1]}),be=!0);const ke=Te.closest("figure.image");if(ke&&function(Ae){let Se=!1;const Oe=Ae.parentElement,Ve=Oe.dataset.rootName,Me=Ae.nextElementSibling,De=Ae.previousElementSibling,Fe=Me&&global.window.getComputedStyle(Me).float,Be=Me&&Me.className==="ck-fake-selection-container";return!Ve||Me||De||(Se=!0),Ve&&!De&&Be&&(Se=!0),Ve&&!De&&Fe!=="none"&&(Se=!0),!Se}(ke)){const Ae=global.window.getComputedStyle(ke).float;if(Ae=="left"||Ae=="right")return xe}const Ie=k$3(Te,t,te,be);if(Ie.length){for(const Ae of Ie)xe.push({type:Ae.type,offset:Ae.offset,textOffset:Ae.textOffset,path:[we,...Ae.path]}),t+=te,be=!1;return xe}return xe.push(...function(Ae,Se,Oe,Ve,Me){const De=[];if(global.window.getComputedStyle(Ae).display=="table-cell")return[];const Fe=[];for(const Be of Ae.getClientRects())if(Be.left>=Oe){for(const $e of Fe)$e.height+=Be.height;Fe.push({height:Be.height}),Oe+=Ve}for(const Be of Fe)Me||De.push({type:"element",offset:Be.height,textOffset:0,path:[Se]}),Me=!1;return De}(Te,we,t,te,be)),xe}function x$3(Te,we,t,te,be){const xe=y$4(Te),ve=[];let ke=0;for(const Ie of xe.getClientRects())if(Ie.left>=t){const Ae=B$3(Te,ke,t,te);be||ve.push({type:"text",path:[we],textOffset:Ae}),ke=Ae,t+=te,be=!1}return ve}function B$3(Te,we,t,te){let be=we,xe=Te.length;for(;xe-be>1;){const ve=Math.ceil((be+xe)/2);N$1(b$2(Te,be,ve),t,te)?xe=ve:be=ve}return be}function N$1(Te,we,t){for(const te of Te.getClientRects())if(te.left>=we&&te.left<we+t)return!0;return!1}function S$1(Te){return Te.nodeType==Node.ELEMENT_NODE}function A$2(Te){return Te.nodeType==Node.TEXT_NODE}const C=toUnit("px");let z$1=class extends View{constructor(){super();const we=this.bindTemplate;this.set({isVisible:!1,left:null,top:null,width:null,pageNumber:null}),this.setTemplate({tag:"div",attributes:{"data-page-number":we.to("pageNumber"),class:["ck","ck-pagination-view-line",we.if("isVisible","ck-hidden",t=>!t)],style:{left:we.to("left",t=>C(t)),top:we.to("top",t=>C(t)),width:we.to("width",t=>C(t))}}})}},E$2=class{constructor(we){Re(this,"_viewCollection");Re(this,"_visibleLines",new Set);Re(this,"_hiddenLines",new Set);this._viewCollection=we.ui.view.body}destroy(){for(const we of this._hiddenLines)we.destroy()}cleanLines(){for(const we of this._visibleLines)we.isVisible=!1,this._hiddenLines.add(we);this._visibleLines.clear()}showLine(we,t,te,be){let xe;this._hiddenLines.size?(xe=first(this._hiddenLines.values()),this._hiddenLines.delete(xe)):(xe=new z$1,this._viewCollection.add(xe)),xe.pageNumber=be,xe.isVisible=!0,this._visibleLines.add(xe),xe.set({left:we,top:t,width:te})}};const L$2="ck-pagination_enabled";let l$4=class extends Plugin{constructor(){super(...arguments);Re(this,"_linesRepository");Re(this,"_scrollableEditingRootDomAncestor",null);Re(this,"_resizeObserver",null);Re(this,"_paginationLookupPlugin")}static get pluginName(){return"PaginationRenderer"}init(){this.set({pageNumber:1}),this._linesRepository=new E$2(this.editor),this._scrollableEditingRootDomAncestor=null,this._resizeObserver=null,this._paginationLookupPlugin=this.editor.plugins.get("PaginationLookup"),this.bind("isEnabled").to(this.editor.plugins.get("PaginationEditing")),this.editor.ui.once("ready",()=>this._onUiReady()),this._toggleEditingRootsClass(L$2),this.on("change:isEnabled",(t,te,be)=>{be||this._linesRepository.cleanLines(),this._toggleEditingRootsClass(L$2,be)})}destroy(){this._toggleEditingRootsClass(L$2,!1),this._linesRepository.destroy(),this._scrollableEditingRootDomAncestor=null,this._resizeObserver&&this._resizeObserver.destroy()}scrollToPage(t){if(!this.isEnabled)return;const te=t>1?this._getPageBreakLineOffset(t-1):0;this._scrollableEditingRootDomAncestor.scrollTo({top:te-10,left:this._scrollableEditingRootDomAncestor.scrollLeft,behavior:env.isMotionReduced?"instant":"smooth"})}_onUiReady(){const t=this.editor,te=this._getAttachedDomRoot();te?(this._scrollableEditingRootDomAncestor=function(be){let xe=be;do{xe=xe.parentElement;const ve=global.window.getComputedStyle(xe).overflowY;if(ve=="auto"||ve=="scroll")break}while(xe.tagName!="BODY");return xe}(te),t.ui.view.listenTo(this._scrollableEditingRootDomAncestor,"scroll",()=>{this._updatePageBreakLines()},{usePassive:!0}),t.ui.view.listenTo(global.window,"resize",()=>this._updatePageBreakLines()),this._resizeObserver=new ResizeObserver(this._scrollableEditingRootDomAncestor,()=>{this._updatePageBreakLines()}),this.listenTo(this._paginationLookupPlugin,"change:pageBreaks",()=>this._updatePageBreakLines())):t.ui.once("update",()=>this._onUiReady())}_getAttachedDomRoot(){for(const t of this.editor.editing.view.domRoots.values())if(t.ownerDocument.body.contains(t))return t;return null}_updatePageBreakLines(){if(!this.isEnabled)return;const t=this._getAttachedDomRoot(),te=this._paginationLookupPlugin.pageBreaks;if(this._linesRepository.cleanLines(),!t||te.length==1)return void(this.pageNumber=1);const be=new Rect(t).excludeScrollbarsAndBorders(),xe=new Rect(this._scrollableEditingRootDomAncestor).excludeScrollbarsAndBorders(),ve=xe.top+xe.height/3;let ke=!1;for(let Ie=1;Ie<te.length;Ie++){const Ae=this._getPageBreakLineOffset(Ie,xe);if(!Ae)continue;const Se=xe.top+Ae-this._scrollableEditingRootDomAncestor.scrollTop;this._renderPageBreakLine(Se,be,xe,Ie),Se>ve&&!ke&&(this.pageNumber=Ie,ke=!0)}ke||(this.pageNumber=te.length)}_renderPageBreakLine(t,te,be,xe){const{scrollX:ve,scrollY:ke}=global.window;be.top<t&&t<be.bottom&&this._linesRepository.showLine(te.left+ve,t+ke,te.width,xe+1)}_getPageBreakLineOffset(t,te=null){const be=this._paginationLookupPlugin.pageBreaks[t].offset;return be?(te||(te=new Rect(this._scrollableEditingRootDomAncestor).excludeScrollbarsAndBorders()),be-te.top+this._scrollableEditingRootDomAncestor.scrollTop):0}_toggleEditingRootsClass(t,te=!0){const be=this.editor.editing.view;be.change(xe=>{for(const ve of be.document.roots)te?xe.addClass(t,ve):xe.removeClass(t,ve)})}},s$4=class extends Plugin{static get pluginName(){return"PaginationEditing"}static get requires(){return[n$3,l$4]}init(){this.set({pageNumber:1,totalPages:1});const we=this.editor.plugins.get("Pagination"),t=this.editor.plugins.get(n$3),te=this.editor.plugins.get(l$4);this.bind("isEnabled").to(we),this._setUpDataDowncastConversion(),this.bind("pageNumber").to(te),this.listenTo(t,"change:pageBreaks",(xe,ve,ke,Ie)=>{this.totalPages=ke.length,this._updatePageBreakMarkers(ke,Ie)}),this._setupKeystrokes();const be=this.editor;this.licenseKey=be.config.get("licenseKey"),this._licenseKeyCheckInterval=setInterval(()=>{let xe;for(const ve in be){const ke=ve,Ie=be[ke];if(Ie==="paginationLicenseKeyTrial"||Ie==="paginationLicenseKeyInvalid"||Ie==="paginationLicenseKeyValid"||Ie==="paginationLicenseKeyTrialLimit:operations"){delete be[ke],xe=Ie;break}}if(xe==="paginationLicenseKeyInvalid")throw clearInterval(this._licenseKeyCheckInterval),new CKEditorError("pagination-invalid-license-key",null);if(xe==="paginationLicenseKeyTrial"&&console.info("You are using the trial version of CKEditor 5 pagination plugin with limited usage. Make sure you will not use it in the production environment."),xe==="paginationLicenseKeyTrialLimit:operations")throw clearInterval(this._licenseKeyCheckInterval),new CKEditorError("pagination-trial-license-key-reached-limit-changes",null);xe==="paginationLicenseKeyValid"&&clearInterval(this._licenseKeyCheckInterval)},1e3)}destroy(){clearInterval(this._licenseKeyCheckInterval)}scrollToPage(we){this.isEnabled&&this.editor.plugins.get(l$4).scrollToPage(this._validatePageNumber(we))}moveSelectionToPage(we){if(!this.isEnabled)return;const t=this.editor,te=this.editor.plugins.get(n$3).pageBreaks[we-1];te&&t.model.change(be=>{switch(te.type){case"manual":{const xe=t.model.schema.getNearestSelectionRange(te.modelRange.end,"forward");be.setSelection(xe);break}case"element":{const xe=t.model.schema.getNearestSelectionRange(te.modelRange.start,"forward");be.setSelection(xe);break}case"text":{const xe=te.modelRange.start;if(xe.textNode.data[xe.offset]===" "){const ve=be.createPositionAt(xe.parent,xe.offset+1);be.setSelection(ve)}else be.setSelection(te.modelRange)}}t.editing.view.focus()})}goToNextPage(){const we=this._validatePageNumber(this.pageNumber+1);this.moveSelectionToPage(we),this.scrollToPage(we)}goToPreviousPage(){const we=this._validatePageNumber(this.pageNumber-1);this.moveSelectionToPage(we),this.scrollToPage(we)}_updatePageBreakMarkers(we,t){const te=this.editor.model;this.isEnabled&&te.change(be=>{for(let xe=1;xe<we.length;xe++){const ve=we[xe].modelRange,ke="pagination:"+(xe+1);te.markers.has(ke)?be.updateMarker(ke,{range:ve}):be.addMarker(ke,{range:ve,usingOperation:!1,affectsData:!0})}for(let xe=we.length;xe<t.length;xe++){const ve="pagination:"+(xe+1);te.markers.has(ve)&&be.removeMarker(ve)}})}_setUpDataDowncastConversion(){const we="pagination";this.editor.conversion.for("dataDowncast").add(t=>{t.on("addMarker:"+we,(te,{markerRange:be,markerName:xe},ve)=>{if(!ve.options.pagination||!ve.consumable.consume(be,te.name))return;const ke=be.getContainedElement();let Ie=ke?ve.mapper.toViewElement(ke):null;if(!Ie){const Se=be.start;if(ve.schema.checkChild(Se,"$text")){const Oe=ve.mapper.toViewPosition(Se);Ie=ve.writer.createContainerElement("span"),Ie.getFillerOffset=()=>null,ve.writer.insert(Oe,Ie)}else{const Oe=Se.nodeAfter;Ie=ve.mapper.toViewElement(Oe)}}for(;Ie.parent!==Ie.root&&Ie.index===0;)Ie=Ie.parent;const Ae=xe.substring(11);ve.writer.setStyle("page-break-before","always",Ie),ve.writer.setAttribute("data-pagination-page",Ae,Ie),ve.mapper.bindElementToMarker(Ie,xe),te.stop()})})}_setupKeystrokes(){const we=this.editor,t=we.locale.t;we.keystrokes.set("Shift+Pageup",(te,be)=>{this.goToPreviousPage(),be()}),we.keystrokes.set("Shift+Pagedown",(te,be)=>{this.goToNextPage(),be()}),we.accessibility.addKeystrokeInfoGroup({id:"pagination",label:t("Keystrokes for navigating through documents"),keystrokes:[{label:t("Go to the previous page (also move selection)"),keystroke:"Shift+Pageup",mayRequireFn:!0},{label:t("Go to the next page (also move selection)"),keystroke:"Shift+Pagedown",mayRequireFn:!0}]})}_validatePageNumber(we){return we<1&&(we=1),we>this.totalPages&&(we=this.totalPages),we}};class j extends View{constructor(t){super(t);Re(this,"pageNumberView");const te=t.t,be=this.bindTemplate;this.set({pageNumber:1,totalPages:1,isEnabled:!0}),this.pageNumberView=new InputNumberView(t,{min:1,step:1}),this.pageNumberView.set({inputMode:"numeric",tabIndex:-1}),this.pageNumberView.bind("ariaLabel").to(this,"totalPages",xe=>te("Current page number (from 1 to %0)",xe)),this.pageNumberView.bind("max").to(this,"totalPages"),this.pageNumberView.bind("isReadOnly").to(this,"isEnabled",xe=>!xe),this.setTemplate({tag:"div",attributes:{class:["ck","ck-page-navigator",be.if("isEnabled","ck-disabled",xe=>!xe)]},children:[this.pageNumberView,{tag:"span",children:[{text:be.to("totalPages")}]}]})}render(){super.render();const t=this.pageNumberView.element,te=be=>{this.pageNumberView.element.value=String(be)};te(this.pageNumber),this.on("change:pageNumber",(be,xe,ve)=>{te(ve)}),this.listenTo(t,"keydown",(be,xe)=>{if(xe.key==="ArrowUp"||xe.key==="ArrowDown")return void xe.stopPropagation();if(xe.keyCode!==keyCodes.enter)return;xe.preventDefault();const ve=t.valueAsNumber;Number.isNaN(ve)?t.value=String(this.pageNumber):(t.checkValidity()?this.pageNumber=ve:ve>this.totalPages?(this.pageNumber=this.totalPages,t.value=String(this.totalPages)):(this.pageNumber=1,t.value="1"),this.fire("navigation",this.pageNumber))}),this.listenTo(t,"blur",()=>{t.value=String(this.pageNumber)}),this.listenTo(t,"focus",()=>{this.pageNumberView.select()})}focus(){this.element.firstChild.focus()}}let r$5=class extends Plugin{static get pluginName(){return"PaginationUI"}init(){const we=this.editor,t=we.plugins.get("PaginationEditing"),te=we.locale.t;we.ui.componentFactory.add("pageNavigation",be=>{const xe=new j(be);return xe.bind("pageNumber").to(t),xe.bind("totalPages").to(t),xe.bind("isEnabled").to(t),xe.on("navigation",(ve,ke)=>{t.moveSelectionToPage(ke),t.scrollToPage(ke)}),xe}),we.ui.componentFactory.add("nextPage",be=>{const xe=new ButtonView(be);return xe.isEnabled=!0,xe.label=te("Go to next page"),xe.icon=`<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M10 .75a9.25 9.25 0 110 18.5 9.25 9.25 0 010-18.5zm0 1.5a7.75 7.75 0 100 15.5 7.75 7.75 0 000-15.5zm0 2.022a.75.75 0 01.743.649l.007.101v8.165l2.714-2.705a.75.75 0 01.977-.07l.084.072a.75.75 0 01.07.976l-.072.084-3.994 3.981a.75.75 0 01-.975.073l-.084-.073-3.99-3.98a.75.75 0 01.975-1.135l.085.072 2.71 2.706V5.022a.75.75 0 01.75-.75z"/></svg>
`,xe.tooltip=!0,xe.keystroke="Shift+PageDown",xe.bind("isEnabled").to(t),this.listenTo(xe,"execute",()=>{t.goToNextPage()}),xe}),we.ui.componentFactory.add("previousPage",be=>{const xe=new ButtonView(be);return xe.isEnabled=!0,xe.label=te("Go to previous page"),xe.icon=`<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M10 19.25a9.25 9.25 0 100-18.5 9.25 9.25 0 000 18.5zm0-1.5a7.75 7.75 0 110-15.5 7.75 7.75 0 010 15.5zm0-2.022a.75.75 0 00.743-.649l.007-.101V6.813l2.714 2.705a.75.75 0 00.977.07l.084-.072a.75.75 0 00.07-.976l-.072-.084-3.994-3.981a.75.75 0 00-.975-.073l-.084.073-3.99 3.98a.75.75 0 00.975 1.135l.085-.072 2.71-2.706v8.166c0 .414.336.75.75.75z"/></svg>
`,xe.tooltip=!0,xe.keystroke="Shift+PageUp",xe.bind("isEnabled").to(t),this.listenTo(xe,"execute",()=>{t.goToPreviousPage()}),xe})}},o$3=class extends Plugin{static get pluginName(){return"Pagination"}static get requires(){return[s$4,r$5]}constructor(we){super(we),this.isEnabled=!1}init(){this.set({pageNumber:1,totalPages:1});const we=this.editor.plugins.get(s$4);this.bind("pageNumber").to(we),this.bind("totalPages").to(we),env.isBlink||this.editor.config.get("pagination.enableOnUnsupportedBrowsers")?this.editor.on("ready",()=>{this.isEnabled=!0}):this.forceDisabled("browserCheck")}scrollToPage(we){this.editor.plugins.get(s$4).scrollToPage(we)}};const m$6=/<meta\s*name="?generator"?\s*content="?microsoft\s*excel\s*\d+"?\/?>/i;function d$5(Te){return m$6.test(Te)}const S=/^(?<tagName>(?!\.)[\w-]+)?(\.(?<className>[\w-]+))?$/i;function x$2(Te,we){const t=new Map;for(const[te,be]of we){if(!te.tagName&&!te.className)continue;const xe=!te.tagName||Te.name===te.tagName,ve=!te.className||Te.hasClass(te.className);xe&&ve&&t.set(te,be)}return t}function h$2(Te){const we={};for(let t=0;t<Te.length;t++){const te=Te[t],be=Te.getPropertyValue(te);be!=="initial"&&(we[te]=be)}return we}function O$2(Te){const we=Te.split(",").map(te=>te.trim()),t=[];for(const te of we){const be=S.exec(te);be&&t.push(be.groups)}return t}function y$3(Te){const we={};for(const t of Te)Object.assign(we,t);return we}let u$3=class extends MSWordNormalizer{execute(we){const{body:t,styles:te}=we._parsedData,be=new UpcastWriter(t.document),xe=be.createRangeIn(t),ve=function(Ie){const Ae={};for(const Se of Ie)for(const Oe of Se.cssRules)if(Oe instanceof CSSStyleRule){const Ve=h$2(Oe.style);Ae[Oe.selectorText]=Object.assign({},Ae[Oe.selectorText]||{},Ve)}return Ae}(te),ke=function(Ie){const Ae=new Map;for(const Se in Ie){const Oe=O$2(Se),Ve=Ie[Se];for(const Me of Oe)Ae.set(Me,Ve)}return Ae}(ve);for(const Ie of xe){if(Ie.type!=="elementStart")continue;const Ae=x$2(Ie.item,ke);if(Ae.size){const Se=y$3(Array.from(Ae.values()));for(const Oe in Se){const Ve=Ie.item;Ve.hasStyle(Oe)||be.setStyle(Oe,Se[Oe],Ve)}}}we.content=t}isActive(we){return super.isActive(we)||d$5(we)}},r$4=class extends Plugin{static get pluginName(){return"PasteFromOfficeEnhancedInliner"}static get requires(){return["PasteFromOffice"]}init(){const we=this.editor,t=we.plugins.get("ClipboardPipeline"),te=we.editing.view.document,be=new u$3(te);t.on("inputTransformation",(xe,ve)=>{const ke=ve.dataTransfer.getData("text/html");be.isActive(ke)&&(ve._parsedData||(ve._parsedData=parseHtml(ke,te.stylesProcessor)),be.execute(ve))},{priority:priorities.get("high")+11})}afterInit(){(function(we){function t(be,xe,ve){const ke={};ke[te([110,117,109,98,101,114,79,102,82,111,117,110,100,115])]={16:10,24:12,32:14},ke[te([114,99,111,110])]=[1,2,4,8,16,32,64,128,27,54,108,216,171,77,154,47,94,188,99,198,151,53,106,212,179,125,250,239,197,145],ke[te([83])]=[99,124,119,123,242,107,111,197,48,1,103,43,254,215,171,118,202,130,201,125,250,89,71,240,173,212,162,175,156,164,114,192,183,253,147,38,54,63,247,204,52,165,229,241,113,216,49,21,4,199,35,195,24,150,5,154,7,18,128,226,235,39,178,117,9,131,44,26,27,110,90,160,82,59,214,179,41,227,47,132,83,209,0,237,32,252,177,91,106,203,190,57,74,76,88,207,208,239,170,251,67,77,51,133,69,249,2,127,80,60,159,168,81,163,64,143,146,157,56,245,188,182,218,33,16,255,243,210,205,12,19,236,95,151,68,23,196,167,126,61,100,93,25,115,96,129,79,220,34,42,144,136,70,238,184,20,222,94,11,219,224,50,58,10,73,6,36,92,194,211,172,98,145,149,228,121,231,200,55,109,141,213,78,169,108,86,244,234,101,122,174,8,186,120,37,46,28,166,180,198,232,221,116,31,75,189,139,138,112,62,181,102,72,3,246,14,97,53,87,185,134,193,29,158,225,248,152,17,105,217,142,148,155,30,135,233,206,85,40,223,140,161,137,13,191,230,66,104,65,153,45,15,176,84,187,22],ke[te([84,49])]=[3328402341,4168907908,4000806809,4135287693,4294111757,3597364157,3731845041,2445657428,1613770832,33620227,3462883241,1445669757,3892248089,3050821474,1303096294,3967186586,2412431941,528646813,2311702848,4202528135,4026202645,2992200171,2387036105,4226871307,1101901292,3017069671,1604494077,1169141738,597466303,1403299063,3832705686,2613100635,1974974402,3791519004,1033081774,1277568618,1815492186,2118074177,4126668546,2211236943,1748251740,1369810420,3521504564,4193382664,3799085459,2883115123,1647391059,706024767,134480908,2512897874,1176707941,2646852446,806885416,932615841,168101135,798661301,235341577,605164086,461406363,3756188221,3454790438,1311188841,2142417613,3933566367,302582043,495158174,1479289972,874125870,907746093,3698224818,3025820398,1537253627,2756858614,1983593293,3084310113,2108928974,1378429307,3722699582,1580150641,327451799,2790478837,3117535592,0,3253595436,1075847264,3825007647,2041688520,3059440621,3563743934,2378943302,1740553945,1916352843,2487896798,2555137236,2958579944,2244988746,3151024235,3320835882,1336584933,3992714006,2252555205,2588757463,1714631509,293963156,2319795663,3925473552,67240454,4269768577,2689618160,2017213508,631218106,1269344483,2723238387,1571005438,2151694528,93294474,1066570413,563977660,1882732616,4059428100,1673313503,2008463041,2950355573,1109467491,537923632,3858759450,4260623118,3218264685,2177748300,403442708,638784309,3287084079,3193921505,899127202,2286175436,773265209,2479146071,1437050866,4236148354,2050833735,3362022572,3126681063,840505643,3866325909,3227541664,427917720,2655997905,2749160575,1143087718,1412049534,999329963,193497219,2353415882,3354324521,1807268051,672404540,2816401017,3160301282,369822493,2916866934,3688947771,1681011286,1949973070,336202270,2454276571,201721354,1210328172,3093060836,2680341085,3184776046,1135389935,3294782118,965841320,831886756,3554993207,4068047243,3588745010,2345191491,1849112409,3664604599,26054028,2983581028,2622377682,1235855840,3630984372,2891339514,4092916743,3488279077,3395642799,4101667470,1202630377,268961816,1874508501,4034427016,1243948399,1546530418,941366308,1470539505,1941222599,2546386513,3421038627,2715671932,3899946140,1042226977,2521517021,1639824860,227249030,260737669,3765465232,2084453954,1907733956,3429263018,2420656344,100860677,4160157185,470683154,3261161891,1781871967,2924959737,1773779408,394692241,2579611992,974986535,664706745,3655459128,3958962195,731420851,571543859,3530123707,2849626480,126783113,865375399,765172662,1008606754,361203602,3387549984,2278477385,2857719295,1344809080,2782912378,59542671,1503764984,160008576,437062935,1707065306,3622233649,2218934982,3496503480,2185314755,697932208,1512910199,504303377,2075177163,2824099068,1841019862,739644986],ke[te([84,50])]=[2781242211,2230877308,2582542199,2381740923,234877682,3184946027,2984144751,1418839493,1348481072,50462977,2848876391,2102799147,434634494,1656084439,3863849899,2599188086,1167051466,2636087938,1082771913,2281340285,368048890,3954334041,3381544775,201060592,3963727277,1739838676,4250903202,3930435503,3206782108,4149453988,2531553906,1536934080,3262494647,484572669,2923271059,1783375398,1517041206,1098792767,49674231,1334037708,1550332980,4098991525,886171109,150598129,2481090929,1940642008,1398944049,1059722517,201851908,1385547719,1699095331,1587397571,674240536,2704774806,252314885,3039795866,151914247,908333586,2602270848,1038082786,651029483,1766729511,3447698098,2682942837,454166793,2652734339,1951935532,775166490,758520603,3000790638,4004797018,4217086112,4137964114,1299594043,1639438038,3464344499,2068982057,1054729187,1901997871,2534638724,4121318227,1757008337,0,750906861,1614815264,535035132,3363418545,3988151131,3201591914,1183697867,3647454910,1265776953,3734260298,3566750796,3903871064,1250283471,1807470800,717615087,3847203498,384695291,3313910595,3617213773,1432761139,2484176261,3481945413,283769337,100925954,2180939647,4037038160,1148730428,3123027871,3813386408,4087501137,4267549603,3229630528,2315620239,2906624658,3156319645,1215313976,82966005,3747855548,3245848246,1974459098,1665278241,807407632,451280895,251524083,1841287890,1283575245,337120268,891687699,801369324,3787349855,2721421207,3431482436,959321879,1469301956,4065699751,2197585534,1199193405,2898814052,3887750493,724703513,2514908019,2696962144,2551808385,3516813135,2141445340,1715741218,2119445034,2872807568,2198571144,3398190662,700968686,3547052216,1009259540,2041044702,3803995742,487983883,1991105499,1004265696,1449407026,1316239930,504629770,3683797321,168560134,1816667172,3837287516,1570751170,1857934291,4014189740,2797888098,2822345105,2754712981,936633572,2347923833,852879335,1133234376,1500395319,3084545389,2348912013,1689376213,3533459022,3762923945,3034082412,4205598294,133428468,634383082,2949277029,2398386810,3913789102,403703816,3580869306,2297460856,1867130149,1918643758,607656988,4049053350,3346248884,1368901318,600565992,2090982877,2632479860,557719327,3717614411,3697393085,2249034635,2232388234,2430627952,1115438654,3295786421,2865522278,3633334344,84280067,33027830,303828494,2747425121,1600795957,4188952407,3496589753,2434238086,1486471617,658119965,3106381470,953803233,334231800,3005978776,857870609,3151128937,1890179545,2298973838,2805175444,3056442267,574365214,2450884487,550103529,1233637070,4289353045,2018519080,2057691103,2399374476,4166623649,2148108681,387583245,3664101311,836232934,3330556482,3100665960,3280093505,2955516313,2002398509,287182607,3413881008,4238890068,3597515707,975967766],ke[te([84,51])]=[1671808611,2089089148,2006576759,2072901243,4061003762,1807603307,1873927791,3310653893,810573872,16974337,1739181671,729634347,4263110654,3613570519,2883997099,1989864566,3393556426,2191335298,3376449993,2106063485,4195741690,1508618841,1204391495,4027317232,2917941677,3563566036,2734514082,2951366063,2629772188,2767672228,1922491506,3227229120,3082974647,4246528509,2477669779,644500518,911895606,1061256767,4144166391,3427763148,878471220,2784252325,3845444069,4043897329,1905517169,3631459288,827548209,356461077,67897348,3344078279,593839651,3277757891,405286936,2527147926,84871685,2595565466,118033927,305538066,2157648768,3795705826,3945188843,661212711,2999812018,1973414517,152769033,2208177539,745822252,439235610,455947803,1857215598,1525593178,2700827552,1391895634,994932283,3596728278,3016654259,695947817,3812548067,795958831,2224493444,1408607827,3513301457,0,3979133421,543178784,4229948412,2982705585,1542305371,1790891114,3410398667,3201918910,961245753,1256100938,1289001036,1491644504,3477767631,3496721360,4012557807,2867154858,4212583931,1137018435,1305975373,861234739,2241073541,1171229253,4178635257,33948674,2139225727,1357946960,1011120188,2679776671,2833468328,1374921297,2751356323,1086357568,2408187279,2460827538,2646352285,944271416,4110742005,3168756668,3066132406,3665145818,560153121,271589392,4279952895,4077846003,3530407890,3444343245,202643468,322250259,3962553324,1608629855,2543990167,1154254916,389623319,3294073796,2817676711,2122513534,1028094525,1689045092,1575467613,422261273,1939203699,1621147744,2174228865,1339137615,3699352540,577127458,712922154,2427141008,2290289544,1187679302,3995715566,3100863416,339486740,3732514782,1591917662,186455563,3681988059,3762019296,844522546,978220090,169743370,1239126601,101321734,611076132,1558493276,3260915650,3547250131,2901361580,1655096418,2443721105,2510565781,3828863972,2039214713,3878868455,3359869896,928607799,1840765549,2374762893,3580146133,1322425422,2850048425,1823791212,1459268694,4094161908,3928346602,1706019429,2056189050,2934523822,135794696,3134549946,2022240376,628050469,779246638,472135708,2800834470,3032970164,3327236038,3894660072,3715932637,1956440180,522272287,1272813131,3185336765,2340818315,2323976074,1888542832,1044544574,3049550261,1722469478,1222152264,50660867,4127324150,236067854,1638122081,895445557,1475980887,3117443513,2257655686,3243809217,489110045,2662934430,3778599393,4162055160,2561878936,288563729,1773916777,3648039385,2391345038,2493985684,2612407707,505560094,2274497927,3911240169,3460925390,1442818645,678973480,3749357023,2358182796,2717407649,2306869641,219617805,3218761151,3862026214,1120306242,1756942440,1103331905,2578459033,762796589,252780047,2966125488,1425844308,3151392187,372911126],ke[te([84,52])]=[1667474886,2088535288,2004326894,2071694838,4075949567,1802223062,1869591006,3318043793,808472672,16843522,1734846926,724270422,4278065639,3621216949,2880169549,1987484396,3402253711,2189597983,3385409673,2105378810,4210693615,1499065266,1195886990,4042263547,2913856577,3570689971,2728590687,2947541573,2627518243,2762274643,1920112356,3233831835,3082273397,4261223649,2475929149,640051788,909531756,1061110142,4160160501,3435941763,875846760,2779116625,3857003729,4059105529,1903268834,3638064043,825316194,353713962,67374088,3351728789,589522246,3284360861,404236336,2526454071,84217610,2593830191,117901582,303183396,2155911963,3806477791,3958056653,656894286,2998062463,1970642922,151591698,2206440989,741110872,437923380,454765878,1852748508,1515908788,2694904667,1381168804,993742198,3604373943,3014905469,690584402,3823320797,791638366,2223281939,1398011302,3520161977,0,3991743681,538992704,4244381667,2981218425,1532751286,1785380564,3419096717,3200178535,960056178,1246420628,1280103576,1482221744,3486468741,3503319995,4025428677,2863326543,4227536621,1128514950,1296947098,859002214,2240123921,1162203018,4193849577,33687044,2139062782,1347481760,1010582648,2678045221,2829640523,1364325282,2745433693,1077985408,2408548869,2459086143,2644360225,943212656,4126475505,3166494563,3065430391,3671750063,555836226,269496352,4294908645,4092792573,3537006015,3452783745,202118168,320025894,3974901699,1600119230,2543297077,1145359496,387397934,3301201811,2812801621,2122220284,1027426170,1684319432,1566435258,421079858,1936954854,1616945344,2172753945,1330631070,3705438115,572679748,707427924,2425400123,2290647819,1179044492,4008585671,3099120491,336870440,3739122087,1583276732,185277718,3688593069,3772791771,842159716,976899700,168435220,1229577106,101059084,606366792,1549591736,3267517855,3553849021,2897014595,1650632388,2442242105,2509612081,3840161747,2038008818,3890688725,3368567691,926374254,1835907034,2374863873,3587531953,1313788572,2846482505,1819063512,1448540844,4109633523,3941213647,1701162954,2054852340,2930698567,134748176,3132806511,2021165296,623210314,774795868,471606328,2795958615,3031746419,3334885783,3907527627,3722280097,1953799400,522133822,1263263126,3183336545,2341176845,2324333839,1886425312,1044267644,3048588401,1718004428,1212733584,50529542,4143317495,235803164,1633788866,892690282,1465383342,3115962473,2256965911,3250673817,488449850,2661202215,3789633753,4177007595,2560144171,286339874,1768537042,3654906025,2391705863,2492770099,2610673197,505291324,2273808917,3924369609,3469625735,1431699370,673740880,3755965093,2358021891,2711746649,2307489801,218961690,3217021541,3873845719,1111672452,1751693520,1094828930,2576986153,757954394,252645662,2964376443,1414855848,3149649517,370555436],ke[te([85,49])]=[0,235474187,470948374,303765277,941896748,908933415,607530554,708780849,1883793496,2118214995,1817866830,1649639237,1215061108,1181045119,1417561698,1517767529,3767586992,4003061179,4236429990,4069246893,3635733660,3602770327,3299278474,3400528769,2430122216,2664543715,2362090238,2193862645,2835123396,2801107407,3035535058,3135740889,3678124923,3576870512,3341394285,3374361702,3810496343,3977675356,4279080257,4043610186,2876494627,2776292904,3076639029,3110650942,2472011535,2640243204,2403728665,2169303058,1001089995,899835584,666464733,699432150,59727847,226906860,530400753,294930682,1273168787,1172967064,1475418501,1509430414,1942435775,2110667444,1876241833,1641816226,2910219766,2743034109,2976151520,3211623147,2505202138,2606453969,2302690252,2269728455,3711829422,3543599269,3240894392,3475313331,3843699074,3943906441,4178062228,4144047775,1306967366,1139781709,1374988112,1610459739,1975683434,2076935265,1775276924,1742315127,1034867998,866637845,566021896,800440835,92987698,193195065,429456164,395441711,1984812685,2017778566,1784663195,1683407248,1315562145,1080094634,1383856311,1551037884,101039829,135050206,437757123,337553864,1042385657,807962610,573804783,742039012,2531067453,2564033334,2328828971,2227573024,2935566865,2700099354,3001755655,3168937228,3868552805,3902563182,4203181171,4102977912,3736164937,3501741890,3265478751,3433712980,1106041591,1340463100,1576976609,1408749034,2043211483,2009195472,1708848333,1809054150,832877231,1068351396,766945465,599762354,159417987,126454664,361929877,463180190,2709260871,2943682380,3178106961,3009879386,2572697195,2538681184,2236228733,2336434550,3509871135,3745345300,3441850377,3274667266,3910161971,3877198648,4110568485,4211818798,2597806476,2497604743,2261089178,2295101073,2733856160,2902087851,3202437046,2968011453,3936291284,3835036895,4136440770,4169408201,3535486456,3702665459,3467192302,3231722213,2051518780,1951317047,1716890410,1750902305,1113818384,1282050075,1584504582,1350078989,168810852,67556463,371049330,404016761,841739592,1008918595,775550814,540080725,3969562369,3801332234,4035489047,4269907996,3569255213,3669462566,3366754619,3332740144,2631065433,2463879762,2160117071,2395588676,2767645557,2868897406,3102011747,3069049960,202008497,33778362,270040487,504459436,875451293,975658646,675039627,641025152,2084704233,1917518562,1615861247,1851332852,1147550661,1248802510,1484005843,1451044056,933301370,967311729,733156972,632953703,260388950,25965917,328671808,496906059,1206477858,1239443753,1543208500,1441952575,2144161806,1908694277,1675577880,1842759443,3610369226,3644379585,3408119516,3307916247,4011190502,3776767469,4077384432,4245618683,2809771154,2842737049,3144396420,3043140495,2673705150,2438237621,2203032232,2370213795],ke[te([85,50])]=[0,185469197,370938394,487725847,741876788,657861945,975451694,824852259,1483753576,1400783205,1315723890,1164071807,1950903388,2135319889,1649704518,1767536459,2967507152,3152976349,2801566410,2918353863,2631447780,2547432937,2328143614,2177544179,3901806776,3818836405,4270639778,4118987695,3299409036,3483825537,3535072918,3652904859,2077965243,1893020342,1841768865,1724457132,1474502543,1559041666,1107234197,1257309336,598438867,681933534,901210569,1052338372,261314535,77422314,428819965,310463728,3409685355,3224740454,3710368113,3593056380,3875770207,3960309330,4045380933,4195456072,2471224067,2554718734,2237133081,2388260884,3212035895,3028143674,2842678573,2724322336,4138563181,4255350624,3769721975,3955191162,3667219033,3516619604,3431546947,3347532110,2933734917,2782082824,3099667487,3016697106,2196052529,2313884476,2499348523,2683765030,1179510461,1296297904,1347548327,1533017514,1786102409,1635502980,2087309459,2003294622,507358933,355706840,136428751,53458370,839224033,957055980,605657339,790073846,2373340630,2256028891,2607439820,2422494913,2706270690,2856345839,3075636216,3160175349,3573941694,3725069491,3273267108,3356761769,4181598602,4063242375,4011996048,3828103837,1033297158,915985419,730517276,545572369,296679730,446754879,129166120,213705253,1709610350,1860738147,1945798516,2029293177,1239331162,1120974935,1606591296,1422699085,4148292826,4233094615,3781033664,3931371469,3682191598,3497509347,3446004468,3328955385,2939266226,2755636671,3106780840,2988687269,2198438022,2282195339,2501218972,2652609425,1201765386,1286567175,1371368976,1521706781,1805211710,1620529459,2105887268,1988838185,533804130,350174575,164439672,46346101,870912086,954669403,636813900,788204353,2358957921,2274680428,2592523643,2441661558,2695033685,2880240216,3065962831,3182487618,3572145929,3756299780,3270937875,3388507166,4174560061,4091327024,4006521127,3854606378,1014646705,930369212,711349675,560487590,272786309,457992840,106852767,223377554,1678381017,1862534868,1914052035,2031621326,1211247597,1128014560,1580087799,1428173050,32283319,182621114,401639597,486441376,768917123,651868046,1003007129,818324884,1503449823,1385356242,1333838021,1150208456,1973745387,2125135846,1673061617,1756818940,2970356327,3120694122,2802849917,2887651696,2637442643,2520393566,2334669897,2149987652,3917234703,3799141122,4284502037,4100872472,3309594171,3460984630,3545789473,3629546796,2050466060,1899603969,1814803222,1730525723,1443857720,1560382517,1075025698,1260232239,575138148,692707433,878443390,1062597235,243256656,91341917,409198410,325965383,3403100636,3252238545,3704300486,3620022987,3874428392,3990953189,4042459122,4227665663,2460449204,2578018489,2226875310,2411029155,3198115200,3046200461,2827177882,2743944855],ke[te([85,51])]=[0,218828297,437656594,387781147,875313188,958871085,775562294,590424639,1750626376,1699970625,1917742170,2135253587,1551124588,1367295589,1180849278,1265195639,3501252752,3720081049,3399941250,3350065803,3835484340,3919042237,4270507174,4085369519,3102249176,3051593425,2734591178,2952102595,2361698556,2177869557,2530391278,2614737639,3145456443,3060847922,2708326185,2892417312,2404901663,2187128086,2504130317,2555048196,3542330227,3727205754,3375740769,3292445032,3876557655,3926170974,4246310725,4027744588,1808481195,1723872674,1910319033,2094410160,1608975247,1391201670,1173430173,1224348052,59984867,244860394,428169201,344873464,935293895,984907214,766078933,547512796,1844882806,1627235199,2011214180,2062270317,1507497298,1423022939,1137477952,1321699145,95345982,145085239,532201772,313773861,830661914,1015671571,731183368,648017665,3175501286,2957853679,2807058932,2858115069,2305455554,2220981195,2474404304,2658625497,3575528878,3625268135,3473416636,3254988725,3778151818,3963161475,4213447064,4130281361,3599595085,3683022916,3432737375,3247465558,3802222185,4020912224,4172763771,4122762354,3201631749,3017672716,2764249623,2848461854,2331590177,2280796200,2431590963,2648976442,104699613,188127444,472615631,287343814,840019705,1058709744,671593195,621591778,1852171925,1668212892,1953757831,2037970062,1514790577,1463996600,1080017571,1297403050,3673637356,3623636965,3235995134,3454686199,4007360968,3822090177,4107101658,4190530515,2997825956,3215212461,2830708150,2779915199,2256734592,2340947849,2627016082,2443058075,172466556,122466165,273792366,492483431,1047239e3,861968209,612205898,695634755,1646252340,1863638845,2013908262,1963115311,1446242576,1530455833,1277555970,1093597963,1636604631,1820824798,2073724613,1989249228,1436590835,1487645946,1337376481,1119727848,164948639,81781910,331544205,516552836,1039717051,821288114,669961897,719700128,2973530695,3157750862,2871682645,2787207260,2232435299,2283490410,2667994737,2450346104,3647212047,3564045318,3279033885,3464042516,3980931627,3762502690,4150144569,4199882800,3070356634,3121275539,2904027272,2686254721,2200818878,2384911031,2570832044,2486224549,3747192018,3528626907,3310321856,3359936201,3950355702,3867060991,4049844452,4234721005,1739656202,1790575107,2108100632,1890328081,1402811438,1586903591,1233856572,1149249077,266959938,48394827,369057872,418672217,1002783846,919489135,567498868,752375421,209336225,24197544,376187827,459744698,945164165,895287692,574624663,793451934,1679968233,1764313568,2117360635,1933530610,1343127501,1560637892,1243112415,1192455638,3704280881,3519142200,3336358691,3419915562,3907448597,3857572124,4075877127,4294704398,3029510009,3113855344,2927934315,2744104290,2159976285,2377486676,2594734927,2544078150],ke[te([85,52])]=[0,151849742,303699484,454499602,607398968,758720310,908999204,1059270954,1214797936,1097159550,1517440620,1400849762,1817998408,1699839814,2118541908,2001430874,2429595872,2581445614,2194319100,2345119218,3034881240,3186202582,2801699524,2951971274,3635996816,3518358430,3399679628,3283088770,4237083816,4118925222,4002861748,3885750714,1002142683,850817237,698445255,548169417,529487843,377642221,227885567,77089521,1943217067,2061379749,1640576439,1757691577,1474760595,1592394909,1174215055,1290801793,2875968315,2724642869,3111247143,2960971305,2405426947,2253581325,2638606623,2487810577,3808662347,3926825029,4044981591,4162096729,3342319475,3459953789,3576539503,3693126241,1986918061,2137062819,1685577905,1836772287,1381620373,1532285339,1078185097,1229899655,1040559837,923313619,740276417,621982671,439452389,322734571,137073913,19308535,3871163981,4021308739,4104605777,4255800159,3263785589,3414450555,3499326569,3651041127,2933202493,2815956275,3167684641,3049390895,2330014213,2213296395,2566595609,2448830231,1305906550,1155237496,1607244650,1455525988,1776460110,1626319424,2079897426,1928707164,96392454,213114376,396673818,514443284,562755902,679998e3,865136418,983426092,3708173718,3557504664,3474729866,3323011204,4180808110,4030667424,3945269170,3794078908,2507040230,2623762152,2272556026,2390325492,2975484382,3092726480,2738905026,2857194700,3973773121,3856137295,4274053469,4157467219,3371096953,3252932727,3673476453,3556361835,2763173681,2915017791,3064510765,3215307299,2156299017,2307622919,2459735317,2610011675,2081048481,1963412655,1846563261,1729977011,1480485785,1362321559,1243905413,1126790795,878845905,1030690015,645401037,796197571,274084841,425408743,38544885,188821243,3613494426,3731654548,3313212038,3430322568,4082475170,4200115116,3780097726,3896688048,2668221674,2516901860,2366882550,2216610296,3141400786,2989552604,2837966542,2687165888,1202797690,1320957812,1437280870,1554391400,1669664834,1787304780,1906247262,2022837584,265905162,114585348,499347990,349075736,736970802,585122620,972512814,821712160,2595684844,2478443234,2293045232,2174754046,3196267988,3079546586,2895723464,2777952454,3537852828,3687994002,3234156416,3385345166,4142626212,4293295786,3841024952,3992742070,174567692,57326082,410887952,292596766,777231668,660510266,1011452712,893681702,1108339068,1258480242,1343618912,1494807662,1715193156,1865862730,1948373848,2100090966,2701949495,2818666809,3004591147,3122358053,2235061775,2352307457,2535604243,2653899549,3915653703,3764988233,4219352155,4067639125,3444575871,3294430577,3746175075,3594982253,836553431,953270745,600235211,718002117,367585007,484830689,133361907,251657213,2041877159,1891211689,1806599355,1654886325,1568718495,1418573201,1335535747,1184342925];const Ie=new Uint8Array(16);for(let Ue=15;Ue>=0;--Ue)Ie[Ue]=ve%256,ve=parseInt(ve/256);let Ae=null,Se=16;const Oe=new Uint8Array(xe),Ve=[],Me=[];$e();for(let Ue=0;Ue<be[te([108,101,110,103,116,104])];Ue++)Se===16&&(Ae=Be(Ie),Se=0,Fe(Ie)),be[Ue]^=Ae[Se++];return be;function De(Ue){const He=[];for(let ze=0;ze<Ue[te([108,101,110,103,116,104])];ze+=4)He[te([112,117,115,104])](Ue[ze]<<24|Ue[ze+1]<<16|Ue[ze+2]<<8|Ue[ze+3]);return He}function Fe(Ue){for(let He=15;He>=0;He--){if(Ue[He]!==255){Ue[He]++;break}Ue[He]=0}}function Be(Ue){const He=Ve[te([108,101,110,103,116,104])]-1,ze=[0,0,0,0];let qe=De(Ue);for(let je=0;je<4;je++)qe[je]^=Ve[0][je];for(let je=1;je<He;je++){for(let Ye=0;Ye<4;Ye++)ze[Ye]=ke[te([84,49])][qe[Ye]>>24&255]^ke[te([84,50])][qe[(Ye+1)%4]>>16&255]^ke[te([84,51])][qe[(Ye+2)%4]>>8&255]^ke[te([84,52])][255&qe[(Ye+3)%4]]^Ve[je][Ye];qe=ze[te([115,108,105,99,101])]()}const Ke=new Uint8Array(16);let Qe;for(let je=0;je<4;je++)Qe=Ve[He][je],Ke[4*je]=255&(ke[te([83])][qe[je]>>24&255]^Qe>>24),Ke[4*je+1]=255&(ke[te([83])][qe[(je+1)%4]>>16&255]^Qe>>16),Ke[4*je+2]=255&(ke[te([83])][qe[(je+2)%4]>>8&255]^Qe>>8),Ke[4*je+3]=255&(ke[te([83])][255&qe[(je+3)%4]]^Qe);return Ke}function $e(){const Ue=ke[te([110,117,109,98,101,114,79,102,82,111,117,110,100,115])][Oe[te([108,101,110,103,116,104])]];for(let ht=0;ht<=Ue;ht++)Ve[te([112,117,115,104])]([0,0,0,0]),Me[te([112,117,115,104])]([0,0,0,0]);const He=4*(Ue+1),ze=Oe[te([108,101,110,103,116,104])]/4,qe=De(Oe);let Ke;for(let ht=0;ht<ze;ht++)Ke=ht>>2,Ve[Ke][ht%4]=qe[ht],Me[Ue-Ke][ht%4]=qe[ht];let Qe,je=0,Ye=ze;for(;Ye<He;){Qe=qe[ze-1],qe[0]^=ke[te([83])][Qe>>16&255]<<24^ke[te([83])][Qe>>8&255]<<16^ke[te([83])][255&Qe]<<8^ke[te([83])][Qe>>24&255]^ke[te([114,99,111,110])][je]<<24,je+=1;for(let Jt=1;Jt<ze/2;Jt++)qe[Jt]^=qe[Jt-1];Qe=qe[ze/2-1],qe[ze/2]^=ke[te([83])][255&Qe]^ke[te([83])][Qe>>8&255]<<8^ke[te([83])][Qe>>16&255]<<16^ke[te([83])][Qe>>24&255]<<24;for(let Jt=ze/2+1;Jt<ze;Jt++)qe[Jt]^=qe[Jt-1];let ht,Ze,Bt=0;for(;Bt<ze&&Ye<He;)ht=Ye>>2,Ze=Ye%4,Ve[ht][Ze]=qe[Bt],Me[Ue-ht][Ze]=qe[Bt++],Ye++}for(let ht=1;ht<Ue;ht++)for(let Ze=0;Ze<4;Ze++)Qe=Me[ht][Ze],Me[ht][Ze]=ke[te([85,49])][Qe>>24&255]^ke[te([85,50])][Qe>>16&255]^ke[te([85,51])][Qe>>8&255]^ke[te([85,52])][255&Qe]}}function te(be){return be.map(xe=>String.fromCharCode(xe)).join("")}(be=>{function xe(){const Ge=[{[te([105,100])]:1,[te([102,101,97,116,117,114,101,78,97,109,101])]:te([67,111,109,109,101,110,116,115]),[te([112,108,117,103,105,110,78,97,109,101])]:te([67,111,109,109,101,110,116,115,82,101,112,111,115,105,116,111,114,121]),[te([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:te([108,105,99,101,110,115,101,75,101,121]),[te([104,97,110,100,108,101,114])]:te([99,104,101,99,107,76,105,99,101,110,115,101]),[te([99,104,101,99,107,65,108,115,111])]:[{[te([105,100])]:2,[te([102,101,97,116,117,114,101,78,97,109,101])]:te([84,114,97,99,107,32,67,104,97,110,103,101,115]),[te([112,108,117,103,105,110,78,97,109,101])]:te([84,114,97,99,107,67,104,97,110,103,101,115,69,100,105,116,105,110,103]),[te([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:te([108,105,99,101,110,115,101,75,101,121]),[te([104,97,110,100,108,101,114])]:te([99,104,101,99,107,76,105,99,101,110,115,101,70,111,114,84,114,97,99,107,67,104,97,110,103,101,115]),[te([111,112,116,105,111,110,115])]:{[te([97,105,119,115,103,105,99])]:!0,[te([97,105,116,99,100,103,105,108])]:!0,[te([97,105,114,118,105,105,108])]:!0}}],[te([111,112,116,105,111,110,115])]:{[te([97,105,119,115,103,105,99])]:!0,[te([97,105,116,99,100,103,105,108])]:!0,[te([97,105,114,118,105,105,108])]:!0}},{[te([105,100])]:3,[te([102,101,97,116,117,114,101,78,97,109,101])]:te([80,97,103,105,110,97,116,105,111,110]),[te([112,108,117,103,105,110,78,97,109,101])]:te([80,97,103,105,110,97,116,105,111,110,76,111,111,107,117,112]),[te([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:te([112,97,103,105,110,97,116,105,111,110,76,105,99,101,110,115,101,75,101,121]),[te([104,97,110,100,108,101,114])]:te([99,104,101,99,107,76,105,99,101,110,115,101])},{[te([105,100])]:4,[te([102,101,97,116,117,114,101,78,97,109,101])]:te([82,101,118,105,115,105,111,110,32,72,105,115,116,111,114,121]),[te([112,108,117,103,105,110,78,97,109,101])]:te([82,101,118,105,115,105,111,110,115,82,101,112,111,115,105,116,111,114,121]),[te([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:te([108,105,99,101,110,115,101,75,101,121]),[te([104,97,110,100,108,101,114])]:te([99,104,101,99,107,76,105,99,101,110,115,101,70,111,114,82,101,118,105,115,105,111,110,72,105,115,116,111,114,121]),[te([111,112,116,105,111,110,115])]:{[te([97,105,119,115,103,105,99])]:!0,[te([97,105,116,99,100,103,105,108])]:!0,[te([97,105,114,118,105,105,108])]:!0}},{[te([105,100])]:5,[te([102,101,97,116,117,114,101,78,97,109,101])]:te([68,111,99,117,109,101,110,116,32,79,117,116,108,105,110,101]),[te([112,108,117,103,105,110,78,97,109,101])]:te([68,111,99,117,109,101,110,116,79,117,116,108,105,110,101,85,73]),[te([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:te([100,111,99,117,109,101,110,116,79,117,116,108,105,110,101,76,105,99,101,110,115,101,75,101,121]),[te([104,97,110,100,108,101,114])]:te([99,104,101,99,107,76,105,99,101,110,115,101]),[te([111,112,116,105,111,110,115])]:{[te([102,103,105])]:[12]}},{[te([105,100])]:6,[te([102,101,97,116,117,114,101,78,97,109,101])]:te([70,111,114,109,97,116,32,80,97,105,110,116,101,114]),[te([112,108,117,103,105,110,78,97,109,101])]:te([70,111,114,109,97,116,80,97,105,110,116,101,114,85,73]),[te([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:te([102,111,114,109,97,116,80,97,105,110,116,101,114,76,105,99,101,110,115,101,75,101,121]),[te([104,97,110,100,108,101,114])]:te([99,104,101,99,107,76,105,99,101,110,115,101]),[te([111,112,116,105,111,110,115])]:{[te([102,103,105])]:[12]}},{[te([105,100])]:7,[te([102,101,97,116,117,114,101,78,97,109,101])]:te([83,108,97,115,104,32,67,111,109,109,97,110,100]),[te([112,108,117,103,105,110,78,97,109,101])]:te([83,108,97,115,104,67,111,109,109,97,110,100,85,73]),[te([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:te([115,108,97,115,104,67,111,109,109,97,110,100,76,105,99,101,110,115,101,75,101,121]),[te([104,97,110,100,108,101,114])]:te([99,104,101,99,107,76,105,99,101,110,115,101]),[te([111,112,116,105,111,110,115])]:{[te([102,103,105])]:[12]}},{[te([105,100])]:8,[te([102,101,97,116,117,114,101,78,97,109,101])]:te([84,97,98,108,101,32,111,102,32,67,111,110,116,101,110,116,115]),[te([112,108,117,103,105,110,78,97,109,101])]:te([84,97,98,108,101,79,102,67,111,110,116,101,110,116,115,69,100,105,116,105,110,103]),[te([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:te([116,97,98,108,101,79,102,67,111,110,116,101,110,116,115,76,105,99,101,110,115,101,75,101,121]),[te([104,97,110,100,108,101,114])]:te([99,104,101,99,107,76,105,99,101,110,115,101]),[te([111,112,116,105,111,110,115])]:{[te([102,103,105])]:[12]}},{[te([105,100])]:9,[te([102,101,97,116,117,114,101,78,97,109,101])]:te([84,101,109,112,108,97,116,101]),[te([112,108,117,103,105,110,78,97,109,101])]:te([84,101,109,112,108,97,116,101,85,73]),[te([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:te([116,101,109,112,108,97,116,101,76,105,99,101,110,115,101,75,101,121]),[te([104,97,110,100,108,101,114])]:te([99,104,101,99,107,76,105,99,101,110,115,101]),[te([111,112,116,105,111,110,115])]:{[te([102,103,105])]:[12,14]}},{[te([105,100])]:10,[te([102,101,97,116,117,114,101,78,97,109,101])]:te([80,97,115,116,101,32,102,114,111,109,32,79,102,102,105,99,101,32,69,110,104,97,110,99,101,100]),[te([112,108,117,103,105,110,78,97,109,101])]:te([80,97,115,116,101,70,114,111,109,79,102,102,105,99,101,69,110,104,97,110,99,101,100,73,110,108,105,110,101,114]),[te([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:te([112,97,115,116,101,70,114,111,109,79,102,102,105,99,101,69,110,104,97,110,99,101,100,76,105,99,101,110,115,101,75,101,121]),[te([104,97,110,100,108,101,114])]:te([99,104,101,99,107,76,105,99,101,110,115,101]),[te([111,112,116,105,111,110,115])]:{[te([102,103,105])]:[12]}},{[te([105,100])]:11,[te([102,101,97,116,117,114,101,78,97,109,101])]:te([65,73,32,65,115,115,105,115,116,97,110,116]),[te([112,108,117,103,105,110,78,97,109,101])]:te([65,73,65,115,115,105,115,116,97,110,116,85,73]),[te([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:te([97,105,76,105,99,101,110,115,101,75,101,121]),[te([104,97,110,100,108,101,114])]:te([99,104,101,99,107,76,105,99,101,110,115,101])},{[te([105,100])]:12,[te([102,101,97,116,117,114,101,78,97,109,101])]:te([80,114,111,100,117,99,116,105,118,105,116,121,32,112,97,99,107])},{[te([105,100])]:13,[te([102,101,97,116,117,114,101,78,97,109,101])]:te([67,97,115,101,32,67,104,97,110,103,101]),[te([112,108,117,103,105,110,78,97,109,101])]:te([67,97,115,101,67,104,97,110,103,101,85,73]),[te([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:te([99,97,115,101,67,104,97,110,103,101,76,105,99,101,110,115,101,75,101,121]),[te([104,97,110,100,108,101,114])]:te([99,104,101,99,107,76,105,99,101,110,115,101]),[te([111,112,116,105,111,110,115])]:{[te([102,103,105])]:[12]}},{[te([105,100])]:14,[te([102,101,97,116,117,114,101,78,97,109,101])]:te([68,114,117,112,97,108,32,112,97,99,107]),[te([102,111,114,98,105,100,100,101,110,72,97,110,100,108,101,114])]:te([102,111,114,98,105,100,100,101,110,72,97,110,100,108,101,114,70,111,114,68,114,117,112,97,108])},{[te([105,100])]:15,[te([102,101,97,116,117,114,101,78,97,109,101])]:te([77,117,108,116,105,32,76,101,118,101,108,32,76,105,115,116]),[te([112,108,117,103,105,110,78,97,109,101])]:te([77,117,108,116,105,76,101,118,101,108,76,105,115,116,69,100,105,116,105,110,103]),[te([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:te([109,117,108,116,105,76,101,118,101,108,76,105,115,116,76,105,99,101,110,115,101,75,101,121]),[te([104,97,110,100,108,101,114])]:te([99,104,101,99,107,76,105,99,101,110,115,101])},{[te([105,100])]:16,[te([102,101,97,116,117,114,101,78,97,109,101])]:te([77,101,114,103,101,32,70,105,101,108,100,115]),[te([112,108,117,103,105,110,78,97,109,101])]:te([77,101,114,103,101,70,105,101,108,100,115,85,73]),[te([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:te([109,101,114,103,101,70,105,101,108,100,115,76,105,99,101,110,115,101,75,101,121]),[te([104,97,110,100,108,101,114])]:te([99,104,101,99,107,76,105,99,101,110,115,101]),[te([111,112,116,105,111,110,115])]:{[te([102,103,105])]:[12]}}];return Le(Ge),Ge;function Ne(We){return 1<<We-1}function Le(We){We[te([102,111,114,69,97,99,104])](Je=>{Je[te([112,101,114,109,105,115,115,105,111,110,77,97,115,107])]=Ne(Je[te([105,100])]),ve(Je)&&Je[te([99,104,101,99,107,65,108,115,111])]&&Le(Je[te([99,104,101,99,107,65,108,115,111])])})}}function ve(Ge){return te([112,108,117,103,105,110,78,97,109,101])in Ge}const ke=[1,85,78,115,198,255,50,112,83,87,161],Ie=[127,34,6,211,167,86,146,199,132,160,18];function Ae(Ge){const Ne=[29,221,175,90,231,133,239,240,75,180];return Se(Ge,new Uint8Array([...ke,...Ne,...Ie]))}function Se(Ge,Ne){const Le=Oe(Ge),We=Array[te([102,114,111,109])](pn(Le)),Je=We[te([112,111,112])](),Wt=We[te([112,111,112])]();return Xt(t(We,Ne,Wt+256*Je))}function Oe(Ge){const Ne=atob(Ge),[Le,We]=Ne[te([115,112,108,105,116])](te([45]));try{if(atob(We))return atob(Le)}catch{}return Ne}function Ve(Ge){try{const Ne=Ae(Ge),Le=JSON[te([112,97,114,115,101])](Ne),We=parseInt(Le[te([49])]),Je=Le[te([50])]||"",Wt=parseInt(Le[te([51])]),nn=parseInt(Le[te([52])])||0,cn=parseInt(Le[te([53])])||0;return{[te([112,114,111,100,117,99,116,78,97,109,101])]:Je,[te([97,108,108,111,119,101,100,80,108,117,103,105,110,115])]:nn,[te([101,120,112,105,114,97,116,105,111,110,68,97,116,101])]:We,[te([105,115,84,114,105,97,108])]:Wt,[te([105,115,73,110,116,101,114,110,97,108])]:cn}}catch{return null}}const Me=xe(),De={[te([99,104,101,99,107,76,105,99,101,110,115,101])]:Ke,[te([99,104,101,99,107,76,105,99,101,110,115,101,70,111,114,84,114,97,99,107,67,104,97,110,103,101,115])]:Qe,[te([99,104,101,99,107,76,105,99,101,110,115,101,70,111,114,82,101,118,105,115,105,111,110,72,105,115,116,111,114,121])]:je},Fe=be[te([99,111,110,115,116,114,117,99,116,111,114])][te([112,108,117,103,105,110,78,97,109,101])],Be=te([99,111,110,116,101,120,116])in be?be.context:be.editor,$e=te([52,48,52,56,49,52,50,50]),Ue=te([65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,48,49,50,51,52,53,54,55,56,57]),He=Be.config.get(te([108,105,99,101,110,115,101,75,101,121])),ze=Me[te([102,105,108,116,101,114])](ve)[te([102,105,110,100])](Ge=>Ge[te([112,108,117,103,105,110,78,97,109,101])]===Fe);function qe(Ge,Ne){De[Ne[te([104,97,110,100,108,101,114])]](Ge,Ne),Ne[te([99,104,101,99,107,65,108,115,111])]&&Ne[te([99,104,101,99,107,65,108,115,111])][te([102,105,108,116,101,114])](Le=>tn(Be,Le[te([112,108,117,103,105,110,78,97,109,101])]))[te([102,111,114,69,97,99,104])](Le=>qe(Ge,Le))}function Ke(Ge,Ne){ht(Ye(Ge,Ne),Ne)}function Qe(Ge,Ne){function Le(We,Je){try{if(tn(Be,te([84,114,97,99,107,67,104,97,110,103,101,115,69,100,105,116,105,110,103]))&&We){const Wt=Kt(Be,te([84,114,97,99,107,67,104,97,110,103,101,115,69,100,105,116,105,110,103]))[te([95,101,120,101,99,117,116,101,83,117,103,103,101,115,116,105,111,110])];if(parseInt(Wt)/2>We[te([101,120,112,105,114,97,116,105,111,110,68,97,116,101])])return Ze(Je[te([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+te([73,110,118,97,108,105,100]))}return Ye(We,Je)}catch{return Ze(Je[te([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+te([73,110,118,97,108,105,100]))}}ht(Le(Ge,Ne),Ne)}function je(Ge,Ne){const Le=Ie[0]*ke[1],We=Ie[0]*ke[2],Je=Ie[2]*ke[2];tn(Be,te([87,101,98,83,111,99,107,101,116,71,97,116,101,119,97,121]))&&Kt(Be,te([87,101,98,83,111,99,107,101,116,71,97,116,101,119,97,121]))[te([115,116,97,116,101])]==te([99,111,110,110,101,99,116,101,100])&&(window[Bt()]=Je);function Wt(zt,Xe){try{return fn()?Ze(Xe[te([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+te([86,97,108,105,100])):Ye(zt,Xe)}catch{return Ze(Xe[te([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+te([73,110,118,97,108,105,100]))}}function nn(zt,Xe){if(zt==Xe[te([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+te([73,110,118,97,108,105,100]))dn();else if(zt==Xe[te([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+te([84,114,105,97,108])){const an=cn();an&&un(an,Xe[te([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]);const rn=ln();window[te([115,101,116,84,105,109,101,111,117,116])](()=>{un(te([116,105,109,101]),Xe[te([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])])},rn);const xn=Kt(Be,te([82,101,118,105,115,105,111,110,115,82,101,112,111,115,105,116,111,114,121]))[te([95,114,101,118,105,115,105,111,110,115])];xn[te([108,101,110,103,116,104])]>=7?un(te([114,101,118,105,115,105,111,110,115]),Xe[te([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]):xn.on(te([97,100,100]),()=>{xn[te([108,101,110,103,116,104])]>=7&&un(te([114,101,118,105,115,105,111,110,115]),Xe[te([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])])})}}function cn(){if(!tn(Be,te([82,101,118,105,115,105,111,110,86,105,101,119,101,114])))return!1;for(const zt in window)if(Number.isNaN(Number(zt))){if(window[zt]===Le)return te([116,105,109,101]);if(window[zt]===We)return te([114,101,118,105,115,105,111,110,115])}return!1}function fn(){if(!tn(Be,te([82,101,118,105,115,105,111,110,86,105,101,119,101,114])))return!1;for(const zt in window)if(Number.isNaN(Number(zt))&&window[zt]===Je)return!0;return!1}function un(zt,Xe){dn(),Ze(Xe+te([84,114,105,97,108,76,105,109,105,116,58])+zt),window[Bt()]=zt===te([116,105,109,101])?Le:We}function ln(){let zt=Ie[6]*ke[8]*ke[6];return tn(Be,te([82,101,118,105,115,105,111,110,86,105,101,119,101,114]))&&(zt/=10),zt}function dn(){const zt=Be;function Xe(){tn(zt,te([82,101,118,105,115,105,111,110,84,114,97,99,107,101,114]))&&(Kt(zt,te([82,101,118,105,115,105,111,110,84,114,97,99,107,101,114]))[te([117,110,98,105,110,100])](te([105,115,69,110,97,98,108,101,100])),Kt(zt,te([82,101,118,105,115,105,111,110,84,114,97,99,107,101,114]))[te([105,115,69,110,97,98,108,101,100])]=!1,Kt(zt,te([82,101,118,105,115,105,111,110,84,114,97,99,107,101,114]))[te([117,112,100,97,116,101])]=en,Kt(zt,te([82,101,118,105,115,105,111,110,84,114,97,99,107,101,114]))[te([115,97,118,101,82,101,118,105,115,105,111,110])]=en,zt[te([109,111,100,101,108])][te([99,104,97,110,103,101])]=en,zt[te([109,111,100,101,108])][te([101,110,113,117,101,117,101,67,104,97,110,103,101])]=en,zt[te([101,110,97,98,108,101,82,101,97,100,79,110,108,121,77,111,100,101])](te([109,111,100,101,108]))),tn(zt,te([82,101,118,105,115,105,111,110,86,105,101,119,101,114]))&&(Kt(zt,te([82,101,118,105,115,105,111,110,86,105,101,119,101,114]))[te([117,110,98,105,110,100])](te([105,115,69,110,97,98,108,101,100])),Kt(zt,te([82,101,118,105,115,105,111,110,86,105,101,119,101,114]))[te([105,115,69,110,97,98,108,101,100])]=!1,Kt(zt,te([82,101,118,105,115,105,111,110,86,105,101,119,101,114]))[te([99,111,109,112,97,114,101])]=en,Kt(zt,te([82,101,118,105,115,105,111,110,86,105,101,119,101,114]))[te([95,103,101,116,68,105,102,102])]=en)}zt[te([115,116,97,116,101])]==te([114,101,97,100,121])?Xe():zt[te([111,110,99,101])](te([114,101,97,100,121]),()=>{if(tn(zt,te([82,101,118,105,115,105,111,110,84,114,97,99,107,101,114]))&&Xe(),tn(zt,te([82,101,118,105,115,105,111,110,86,105,101,119,101,114]))){const Qt=Kt(zt,te([82,101,118,105,115,105,111,110,115,82,101,112,111,115,105,116,111,114,121])),an=Qt.getRevision(0),rn=Qt.getEarlierVisibleRevision(an[te([105,100])]);Kt(zt,te([82,101,118,105,115,105,111,110,86,105,101,119,101,114]))[te([99,111,109,112,97,114,101])](an[te([105,100])],rn?rn[te([105,100])]:null,1).then(()=>Xe())}})}nn(Wt(Ge,Ne),Ne)}function Ye(Ge,Ne){try{return gn(Ne)?Ze(Ne[te([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+te([86,97,108,105,100])):Ge&&sn(Ge[te([97,108,108,111,119,101,100,80,108,117,103,105,110,115])],Ne)?Ge[te([105,115,73,110,116,101,114,110,97,108])]&&!window[te([111,112,101,110])][te([99,108,111,115,101,100])]||parseInt($e)/2>Ge[te([101,120,112,105,114,97,116,105,111,110,68,97,116,101])]?Ze(Ne[te([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+te([73,110,118,97,108,105,100])):Ge[te([105,115,84,114,105,97,108])]?Ze(Ne[te([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+te([84,114,105,97,108])):Ze(Ne[te([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+te([86,97,108,105,100])):Ze(Ne[te([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+te([73,110,118,97,108,105,100]))}catch{return Ze(Ne[te([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+te([73,110,118,97,108,105,100]))}}function ht(Ge,Ne){if(Be instanceof Context){const Le=Be;Ge==Ne[te([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+te([73,110,118,97,108,105,100])?Jt(Le):Ge==Ne[te([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+te([84,114,105,97,108])&&window[te([115,101,116,84,105,109,101,111,117,116])](()=>{Jt(Le),Ze(Ne[te([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+te([84,114,105,97,108,76,105,109,105,116,58,116,105,109,101]))},Ie[6]*ke[8]*ke[6]),Le[te([101,100,105,116,111,114,115])][te([111,110])](te([97,100,100]),(We,Je)=>{Ge!=Ne[te([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+te([73,110,118,97,108,105,100])&&Ge!=Ne[te([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+te([84,114,105,97,108,76,105,109,105,116,58,116,105,109,101])&&Ge!=Ne[te([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+te([84,114,105,97,108,76,105,109,105,116,58,111,112,101,114,97,116,105,111,110,115])||Yt(Je)})}else{const Le=Be;Ge==Ne[te([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+te([73,110,118,97,108,105,100])?Yt(Le):Ge==Ne[te([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+te([84,114,105,97,108])&&Le[te([111,110])](te([114,101,97,100,121]),()=>{let We=0;Le[te([109,111,100,101,108])][te([111,110])](te([97,112,112,108,121,79,112,101,114,97,116,105,111,110]),(Je,Wt)=>{Wt[0][te([105,115,68,111,99,117,109,101,110,116,79,112,101,114,97,116,105,111,110])]&&We++,We===504&&(Yt(Le),Ze(Ne[te([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+te([84,114,105,97,108,76,105,109,105,116,58,111,112,101,114,97,116,105,111,110,115])),Je[te([111,102,102])]())},{priority:te([104,105,103,104,101,115,116])})})}}function Ze(Ge){const Ne=Bt();return Be[Ne]=Ge,Ge}function Bt(){const Ge=String(window[te([112,101,114,102,111,114,109,97,110,99,101])][te([110,111,119])]())[te([114,101,112,108,97,99,101])](te([46]),"");let Ne="";for(let Le=0;Le<Ge[te([108,101,110,103,116,104])];Le+=2){let We=parseInt(Ge[te([115,117,98,115,116,114,105,110,103])](Le,Le+2));We>=Ue[te([108,101,110,103,116,104])]&&(We-=Ue[te([108,101,110,103,116,104])]),Ne+=Ue[We]}return Ne}function Jt(Ge){for(const Ne of Ge[te([101,100,105,116,111,114,115])])Yt(Ne);Kt(Ge,te([67,111,109,109,101,110,116,115,82,101,112,111,115,105,116,111,114,121]))[te([115,119,105,116,99,104,82,101,97,100,79,110,108,121])](!0),Kt(Ge,te([67,111,109,109,101,110,116,115,82,101,112,111,115,105,116,111,114,121]))[te([115,119,105,116,99,104,82,101,97,100,79,110,108,121])]=en}function Yt(Ge){function Ne(){Ge[te([109,111,100,101,108])][te([99,104,97,110,103,101])]=en,Ge[te([109,111,100,101,108])][te([101,110,113,117,101,117,101,67,104,97,110,103,101])]=en,Ge[te([101,110,97,98,108,101,82,101,97,100,79,110,108,121,77,111,100,101])](te([109,111,100,101,108]))}Ge[te([115,116,97,116,101])]==te([114,101,97,100,121])?Ne():Ge[te([111,110,99,101])](te([114,101,97,100,121]),()=>Ne())}function en(){return null}function sn(Ge,Ne){const Le=!!(Ge&Ne[te([112,101,114,109,105,115,115,105,111,110,77,97,115,107])]),We=hn(Ge,Ne);return Le||We}function hn(Ge,Ne){const Le=(Ne[te([111,112,116,105,111,110,115])]||{})[te([102,103,105])]||null;return!!Le&&Me[te([102,105,108,116,101,114])](We=>Le[te([105,110,99,108,117,100,101,115])](We[te([105,100])]))[te([102,105,108,116,101,114])](We=>!mn(We))[te([115,111,109,101])](We=>!!(Ge&We[te([112,101,114,109,105,115,115,105,111,110,77,97,115,107])]))}function mn(Ge){const Ne={[te([102,111,114,98,105,100,100,101,110,72,97,110,100,108,101,114,70,111,114,68,114,117,112,97,108])]:bn};return!!Ge.forbiddenHandler&&Ne[Ge.forbiddenHandler]()}function bn(){return!window[te([68,114,117,112,97,108])]||!tn(Be,te([100,114,117,112,97,108,80,111,119,101,114,101,100,66,121]))}function gn(Ge){if(!tn(Be,Ge[te([112,108,117,103,105,110,78,97,109,101])]))return!0;const Ne=Ge[te([111,112,116,105,111,110,115])]||{},Le=Ne[te([97,105,119,115,103,105,99])]||!1,We=Ne[te([97,105,116,99,100,103,105,108])]||!1,Je=Ne[te([97,105,114,118,105,105,108])]||!1;return tn(Be,te([87,101,98,83,111,99,107,101,116,71,97,116,101,119,97,121]))&&Kt(Be,te([87,101,98,83,111,99,107,101,116,71,97,116,101,119,97,121]))[te([115,116,97,116,101])]==te([99,111,110,110,101,99,116,101,100])&&Le||tn(Be,te([84,114,97,99,107,67,104,97,110,103,101,115,68,97,116,97,71,101,116,116,101,114]))&&Kt(Be,te([84,114,97,99,107,67,104,97,110,103,101,115,68,97,116,97,71,101,116,116,101,114]))[te([114,101,115,117,108,116])]==te([101,110,100])&&We?!0:!(!tn(Be,te([82,101,118,105,115,105,111,110,86,105,101,119,101,114,73,110,116,101,103,114,97,116,105,111,110]))||Kt(Be,te([82,101,118,105,115,105,111,110,86,105,101,119,101,114,73,110,116,101,103,114,97,116,105,111,110]))[te([114,101,115,117,108,116])]!=te([101,110,100])||!Je)}function tn(Ge,Ne){return Ge[te([112,108,117,103,105,110,115])][te([104,97,115])](Ne)}function Kt(Ge,Ne){return Ge[te([112,108,117,103,105,110,115])][te([103,101,116])](Ne)}function Xt(Ge){let Ne="";for(const Le of Ge)Ne+=String[te([102,114,111,109,67,104,97,114,67,111,100,101])](Le);return Ne}function pn(Ge){const Ne=new Uint8Array(Ge[te([108,101,110,103,116,104])]);for(let Le=0;Le<Ge[te([108,101,110,103,116,104])];Le++)Ne[Le]=Ge[te([99,104,97,114,67,111,100,101,65,116])](Le);return Ne}ze&&qe(Ve(He),ze)})(we)})(this)}};const I$1=["color","font-family","font-size","text-decoration","text-decoration-line","font-weight","font-style","vertical-align"],E$1=["color","font-family","font-size"],F$3={"font-style":[["italic","i"]],"font-weight":[["medium","strong"],["bold","strong"],["bolder","strong"],[Te=>Number(Te)>=600,"strong"]],"text-decoration":[["underline","u"],["line-through","s"]],"text-decoration-line":[["underline","u"],["line-through","s"]],"vertical-align":[["sub","sub"],["super","sup"]]};function K$2(Te){return I$1.includes(Te)}function v$3(Te,we,t){const{spanStyles:te,stylesToBeHtmlElements:be}=function(xe,ve){const ke={},Ie={};return ve.forEach(Ae=>{const Se=xe.getStyle(Ae);if(Se){if(function(Oe){return E$1.includes(Oe)}(Ae))ke[Ae]=Se;else if(function(Oe){return Oe in F$3}(Ae)){const Oe=Se.split(" ");F$3[Ae].forEach(([Ve,Me])=>{for(const De of Oe)(typeof Ve=="function"&&Ve(De)||Ve===De)&&(Ie[Ae]=[...Ie[Ae]||[],[Ve,Me]])})}}}),{spanStyles:ke,stylesToBeHtmlElements:Ie}}(Te,t);(function(xe,ve,ke){for(const Ie in ke)ke[Ie].forEach(([,Ae])=>{const Se=ve.createElement(Ae,[],xe.getChildren());ve.insertChild(0,Se,xe)}),ve.removeStyle(Ie,xe)})(Te,we,be),function(xe,ve,ke){if(!Object.keys(ke).length)return;const Ie=ve.createElement("span",[],xe.getChildren());ve.setStyle(ke,Ie),ve.insertChild(0,Ie,xe),ve.removeStyle(Object.keys(ke),xe)}(Te,we,te)}let l$3=class extends MSWordNormalizer{execute(we){const{body:t}=we._parsedData,te=new UpcastWriter(t.document),be=te.createRangeIn(t),xe=new Document$1(te.document.stylesProcessor),ve=[...new DomConverter(xe).blockElements,"font"],ke=be.getItems();for(const Ae of ke)Ae.is("element")&&ve.includes(Ae.name)&&v$3(Ae,te,(Ie=Ae,Array.from(Ie.getStyleNames()).filter(K$2)));var Ie;we.content=t}isActive(we){return super.isActive(we)||d$5(we)}},o$2=class extends Plugin{constructor(t){super(t);Re(this,"_licenseKeyCheckInterval");this._licenseKeyCheckInterval=null}static get pluginName(){return"PasteFromOfficeEnhancedPropagator"}static get requires(){return["PasteFromOffice"]}init(){const t=this.editor,te=t.plugins.get("ClipboardPipeline"),be=t.editing.view.document,xe=new l$3(be);te.on("inputTransformation",(ke,Ie)=>{const Ae=Ie.dataTransfer.getData("text/html");xe.isActive(Ae)&&(Ie._parsedData||(Ie._parsedData=parseHtml(Ae,be.stylesProcessor)),xe.execute(Ie))},{priority:priorities.get("high")+10}),this.licenseKey=t.config.get("licenseKey");const ve=this.editor;this._licenseKeyCheckInterval=setInterval(()=>{let ke;for(const Ie in ve){const Ae=Ie,Se=ve[Ae];if(Se==="pasteFromOfficeEnhancedLicenseKeyTrial"||Se==="pasteFromOfficeEnhancedLicenseKeyInvalid"||Se==="pasteFromOfficeEnhancedLicenseKeyValid"||Se==="pasteFromOfficeEnhancedLicenseKeyTrialLimit:operations"){delete ve[Ae],ke=Se;break}}if(ke==="pasteFromOfficeEnhancedLicenseKeyInvalid")throw clearInterval(this._licenseKeyCheckInterval),new CKEditorError("paste-from-office-enhanced-invalid-license-key",null);if(ke==="pasteFromOfficeEnhancedLicenseKeyTrial"&&console.info("You are using the trial version of CKEditor 5 Paste from Office Enhanced plugin with limited usage. Make sure you will not use it in the production environment."),ke==="pasteFromOfficeEnhancedLicenseKeyTrialLimit:operations")throw clearInterval(this._licenseKeyCheckInterval),new CKEditorError("paste-from-office-enhanced-trial-license-key-reached-limit-changes",null);ke==="pasteFromOfficeEnhancedLicenseKeyValid"&&clearInterval(this._licenseKeyCheckInterval)},1e3)}destroy(){this._licenseKeyCheckInterval&&clearInterval(this._licenseKeyCheckInterval)}},a$3=class extends Plugin{static get pluginName(){return"PasteFromOfficeEnhanced"}static get requires(){return["PasteFromOffice",r$4,o$2]}};var indexMinimal={},minimal$1={},aspromise=asPromise;function asPromise(Te,we){for(var t=new Array(arguments.length-1),te=0,be=2,xe=!0;be<arguments.length;)t[te++]=arguments[be++];return new Promise(function(ke,Ie){t[te]=function(Se){if(xe)if(xe=!1,Se)Ie(Se);else{for(var Oe=new Array(arguments.length-1),Ve=0;Ve<Oe.length;)Oe[Ve++]=arguments[Ve];ke.apply(null,Oe)}};try{Te.apply(we||null,t)}catch(Ae){xe&&(xe=!1,Ie(Ae))}})}var base64$1={};(function(Te){var we=Te;we.length=function(ke){var Ie=ke.length;if(!Ie)return 0;for(var Ae=0;--Ie%4>1&&ke.charAt(Ie)==="=";)++Ae;return Math.ceil(ke.length*3)/4-Ae};for(var t=new Array(64),te=new Array(123),be=0;be<64;)te[t[be]=be<26?be+65:be<52?be+71:be<62?be-4:be-59|43]=be++;we.encode=function(ke,Ie,Ae){for(var Se=null,Oe=[],Ve=0,Me=0,De;Ie<Ae;){var Fe=ke[Ie++];switch(Me){case 0:Oe[Ve++]=t[Fe>>2],De=(Fe&3)<<4,Me=1;break;case 1:Oe[Ve++]=t[De|Fe>>4],De=(Fe&15)<<2,Me=2;break;case 2:Oe[Ve++]=t[De|Fe>>6],Oe[Ve++]=t[Fe&63],Me=0;break}Ve>8191&&((Se||(Se=[])).push(String.fromCharCode.apply(String,Oe)),Ve=0)}return Me&&(Oe[Ve++]=t[De],Oe[Ve++]=61,Me===1&&(Oe[Ve++]=61)),Se?(Ve&&Se.push(String.fromCharCode.apply(String,Oe.slice(0,Ve))),Se.join("")):String.fromCharCode.apply(String,Oe.slice(0,Ve))};var xe="invalid encoding";we.decode=function(ke,Ie,Ae){for(var Se=Ae,Oe=0,Ve,Me=0;Me<ke.length;){var De=ke.charCodeAt(Me++);if(De===61&&Oe>1)break;if((De=te[De])===void 0)throw Error(xe);switch(Oe){case 0:Ve=De,Oe=1;break;case 1:Ie[Ae++]=Ve<<2|(De&48)>>4,Ve=De,Oe=2;break;case 2:Ie[Ae++]=(Ve&15)<<4|(De&60)>>2,Ve=De,Oe=3;break;case 3:Ie[Ae++]=(Ve&3)<<6|De,Oe=0;break}}if(Oe===1)throw Error(xe);return Ae-Se},we.test=function(ke){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(ke)}})(base64$1);var eventemitter=EventEmitter;function EventEmitter(){this._listeners={}}EventEmitter.prototype.on=function(we,t,te){return(this._listeners[we]||(this._listeners[we]=[])).push({fn:t,ctx:te||this}),this};EventEmitter.prototype.off=function(we,t){if(we===void 0)this._listeners={};else if(t===void 0)this._listeners[we]=[];else for(var te=this._listeners[we],be=0;be<te.length;)te[be].fn===t?te.splice(be,1):++be;return this};EventEmitter.prototype.emit=function(we){var t=this._listeners[we];if(t){for(var te=[],be=1;be<arguments.length;)te.push(arguments[be++]);for(be=0;be<t.length;)t[be].fn.apply(t[be++].ctx,te)}return this};var float=factory(factory);function factory(Te){return typeof Float32Array<"u"?function(){var we=new Float32Array([-0]),t=new Uint8Array(we.buffer),te=t[3]===128;function be(Ie,Ae,Se){we[0]=Ie,Ae[Se]=t[0],Ae[Se+1]=t[1],Ae[Se+2]=t[2],Ae[Se+3]=t[3]}function xe(Ie,Ae,Se){we[0]=Ie,Ae[Se]=t[3],Ae[Se+1]=t[2],Ae[Se+2]=t[1],Ae[Se+3]=t[0]}Te.writeFloatLE=te?be:xe,Te.writeFloatBE=te?xe:be;function ve(Ie,Ae){return t[0]=Ie[Ae],t[1]=Ie[Ae+1],t[2]=Ie[Ae+2],t[3]=Ie[Ae+3],we[0]}function ke(Ie,Ae){return t[3]=Ie[Ae],t[2]=Ie[Ae+1],t[1]=Ie[Ae+2],t[0]=Ie[Ae+3],we[0]}Te.readFloatLE=te?ve:ke,Te.readFloatBE=te?ke:ve}():function(){function we(te,be,xe,ve){var ke=be<0?1:0;if(ke&&(be=-be),be===0)te(1/be>0?0:2147483648,xe,ve);else if(isNaN(be))te(2143289344,xe,ve);else if(be>34028234663852886e22)te((ke<<31|2139095040)>>>0,xe,ve);else if(be<11754943508222875e-54)te((ke<<31|Math.round(be/1401298464324817e-60))>>>0,xe,ve);else{var Ie=Math.floor(Math.log(be)/Math.LN2),Ae=Math.round(be*Math.pow(2,-Ie)*8388608)&8388607;te((ke<<31|Ie+127<<23|Ae)>>>0,xe,ve)}}Te.writeFloatLE=we.bind(null,writeUintLE),Te.writeFloatBE=we.bind(null,writeUintBE);function t(te,be,xe){var ve=te(be,xe),ke=(ve>>31)*2+1,Ie=ve>>>23&255,Ae=ve&8388607;return Ie===255?Ae?NaN:ke*(1/0):Ie===0?ke*1401298464324817e-60*Ae:ke*Math.pow(2,Ie-150)*(Ae+8388608)}Te.readFloatLE=t.bind(null,readUintLE),Te.readFloatBE=t.bind(null,readUintBE)}(),typeof Float64Array<"u"?function(){var we=new Float64Array([-0]),t=new Uint8Array(we.buffer),te=t[7]===128;function be(Ie,Ae,Se){we[0]=Ie,Ae[Se]=t[0],Ae[Se+1]=t[1],Ae[Se+2]=t[2],Ae[Se+3]=t[3],Ae[Se+4]=t[4],Ae[Se+5]=t[5],Ae[Se+6]=t[6],Ae[Se+7]=t[7]}function xe(Ie,Ae,Se){we[0]=Ie,Ae[Se]=t[7],Ae[Se+1]=t[6],Ae[Se+2]=t[5],Ae[Se+3]=t[4],Ae[Se+4]=t[3],Ae[Se+5]=t[2],Ae[Se+6]=t[1],Ae[Se+7]=t[0]}Te.writeDoubleLE=te?be:xe,Te.writeDoubleBE=te?xe:be;function ve(Ie,Ae){return t[0]=Ie[Ae],t[1]=Ie[Ae+1],t[2]=Ie[Ae+2],t[3]=Ie[Ae+3],t[4]=Ie[Ae+4],t[5]=Ie[Ae+5],t[6]=Ie[Ae+6],t[7]=Ie[Ae+7],we[0]}function ke(Ie,Ae){return t[7]=Ie[Ae],t[6]=Ie[Ae+1],t[5]=Ie[Ae+2],t[4]=Ie[Ae+3],t[3]=Ie[Ae+4],t[2]=Ie[Ae+5],t[1]=Ie[Ae+6],t[0]=Ie[Ae+7],we[0]}Te.readDoubleLE=te?ve:ke,Te.readDoubleBE=te?ke:ve}():function(){function we(te,be,xe,ve,ke,Ie){var Ae=ve<0?1:0;if(Ae&&(ve=-ve),ve===0)te(0,ke,Ie+be),te(1/ve>0?0:2147483648,ke,Ie+xe);else if(isNaN(ve))te(0,ke,Ie+be),te(2146959360,ke,Ie+xe);else if(ve>17976931348623157e292)te(0,ke,Ie+be),te((Ae<<31|2146435072)>>>0,ke,Ie+xe);else{var Se;if(ve<22250738585072014e-324)Se=ve/5e-324,te(Se>>>0,ke,Ie+be),te((Ae<<31|Se/4294967296)>>>0,ke,Ie+xe);else{var Oe=Math.floor(Math.log(ve)/Math.LN2);Oe===1024&&(Oe=1023),Se=ve*Math.pow(2,-Oe),te(Se*4503599627370496>>>0,ke,Ie+be),te((Ae<<31|Oe+1023<<20|Se*1048576&1048575)>>>0,ke,Ie+xe)}}}Te.writeDoubleLE=we.bind(null,writeUintLE,0,4),Te.writeDoubleBE=we.bind(null,writeUintBE,4,0);function t(te,be,xe,ve,ke){var Ie=te(ve,ke+be),Ae=te(ve,ke+xe),Se=(Ae>>31)*2+1,Oe=Ae>>>20&2047,Ve=4294967296*(Ae&1048575)+Ie;return Oe===2047?Ve?NaN:Se*(1/0):Oe===0?Se*5e-324*Ve:Se*Math.pow(2,Oe-1075)*(Ve+4503599627370496)}Te.readDoubleLE=t.bind(null,readUintLE,0,4),Te.readDoubleBE=t.bind(null,readUintBE,4,0)}(),Te}function writeUintLE(Te,we,t){we[t]=Te&255,we[t+1]=Te>>>8&255,we[t+2]=Te>>>16&255,we[t+3]=Te>>>24}function writeUintBE(Te,we,t){we[t]=Te>>>24,we[t+1]=Te>>>16&255,we[t+2]=Te>>>8&255,we[t+3]=Te&255}function readUintLE(Te,we){return(Te[we]|Te[we+1]<<8|Te[we+2]<<16|Te[we+3]<<24)>>>0}function readUintBE(Te,we){return(Te[we]<<24|Te[we+1]<<16|Te[we+2]<<8|Te[we+3])>>>0}var inquire_1=inquire;function inquire(moduleName){try{var mod=eval("quire".replace(/^/,"re"))(moduleName);if(mod&&(mod.length||Object.keys(mod).length))return mod}catch(Te){}return null}var utf8$2={};(function(Te){var we=Te;we.length=function(te){for(var be=0,xe=0,ve=0;ve<te.length;++ve)xe=te.charCodeAt(ve),xe<128?be+=1:xe<2048?be+=2:(xe&64512)===55296&&(te.charCodeAt(ve+1)&64512)===56320?(++ve,be+=4):be+=3;return be},we.read=function(te,be,xe){var ve=xe-be;if(ve<1)return"";for(var ke=null,Ie=[],Ae=0,Se;be<xe;)Se=te[be++],Se<128?Ie[Ae++]=Se:Se>191&&Se<224?Ie[Ae++]=(Se&31)<<6|te[be++]&63:Se>239&&Se<365?(Se=((Se&7)<<18|(te[be++]&63)<<12|(te[be++]&63)<<6|te[be++]&63)-65536,Ie[Ae++]=55296+(Se>>10),Ie[Ae++]=56320+(Se&1023)):Ie[Ae++]=(Se&15)<<12|(te[be++]&63)<<6|te[be++]&63,Ae>8191&&((ke||(ke=[])).push(String.fromCharCode.apply(String,Ie)),Ae=0);return ke?(Ae&&ke.push(String.fromCharCode.apply(String,Ie.slice(0,Ae))),ke.join("")):String.fromCharCode.apply(String,Ie.slice(0,Ae))},we.write=function(te,be,xe){for(var ve=xe,ke,Ie,Ae=0;Ae<te.length;++Ae)ke=te.charCodeAt(Ae),ke<128?be[xe++]=ke:ke<2048?(be[xe++]=ke>>6|192,be[xe++]=ke&63|128):(ke&64512)===55296&&((Ie=te.charCodeAt(Ae+1))&64512)===56320?(ke=65536+((ke&1023)<<10)+(Ie&1023),++Ae,be[xe++]=ke>>18|240,be[xe++]=ke>>12&63|128,be[xe++]=ke>>6&63|128,be[xe++]=ke&63|128):(be[xe++]=ke>>12|224,be[xe++]=ke>>6&63|128,be[xe++]=ke&63|128);return xe-ve}})(utf8$2);var pool_1=pool;function pool(Te,we,t){var te=t||8192,be=te>>>1,xe=null,ve=te;return function(Ie){if(Ie<1||Ie>be)return Te(Ie);ve+Ie>te&&(xe=Te(te),ve=0);var Ae=we.call(xe,ve,ve+=Ie);return ve&7&&(ve=(ve|7)+1),Ae}}var longbits,hasRequiredLongbits;function requireLongbits(){if(hasRequiredLongbits)return longbits;hasRequiredLongbits=1,longbits=we;var Te=requireMinimal();function we(xe,ve){this.lo=xe>>>0,this.hi=ve>>>0}var t=we.zero=new we(0,0);t.toNumber=function(){return 0},t.zzEncode=t.zzDecode=function(){return this},t.length=function(){return 1};var te=we.zeroHash="\0\0\0\0\0\0\0\0";we.fromNumber=function(ve){if(ve===0)return t;var ke=ve<0;ke&&(ve=-ve);var Ie=ve>>>0,Ae=(ve-Ie)/4294967296>>>0;return ke&&(Ae=~Ae>>>0,Ie=~Ie>>>0,++Ie>4294967295&&(Ie=0,++Ae>4294967295&&(Ae=0))),new we(Ie,Ae)},we.from=function(ve){if(typeof ve=="number")return we.fromNumber(ve);if(Te.isString(ve))if(Te.Long)ve=Te.Long.fromString(ve);else return we.fromNumber(parseInt(ve,10));return ve.low||ve.high?new we(ve.low>>>0,ve.high>>>0):t},we.prototype.toNumber=function(ve){if(!ve&&this.hi>>>31){var ke=~this.lo+1>>>0,Ie=~this.hi>>>0;return ke||(Ie=Ie+1>>>0),-(ke+Ie*4294967296)}return this.lo+this.hi*4294967296},we.prototype.toLong=function(ve){return Te.Long?new Te.Long(this.lo|0,this.hi|0,!!ve):{low:this.lo|0,high:this.hi|0,unsigned:!!ve}};var be=String.prototype.charCodeAt;return we.fromHash=function(ve){return ve===te?t:new we((be.call(ve,0)|be.call(ve,1)<<8|be.call(ve,2)<<16|be.call(ve,3)<<24)>>>0,(be.call(ve,4)|be.call(ve,5)<<8|be.call(ve,6)<<16|be.call(ve,7)<<24)>>>0)},we.prototype.toHash=function(){return String.fromCharCode(this.lo&255,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,this.hi&255,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)},we.prototype.zzEncode=function(){var ve=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^ve)>>>0,this.lo=(this.lo<<1^ve)>>>0,this},we.prototype.zzDecode=function(){var ve=-(this.lo&1);return this.lo=((this.lo>>>1|this.hi<<31)^ve)>>>0,this.hi=(this.hi>>>1^ve)>>>0,this},we.prototype.length=function(){var ve=this.lo,ke=(this.lo>>>28|this.hi<<4)>>>0,Ie=this.hi>>>24;return Ie===0?ke===0?ve<16384?ve<128?1:2:ve<2097152?3:4:ke<16384?ke<128?5:6:ke<2097152?7:8:Ie<128?9:10},longbits}var hasRequiredMinimal;function requireMinimal(){return hasRequiredMinimal||(hasRequiredMinimal=1,function(Te){var we=Te;we.asPromise=aspromise,we.base64=base64$1,we.EventEmitter=eventemitter,we.float=float,we.inquire=inquire_1,we.utf8=utf8$2,we.pool=pool_1,we.LongBits=requireLongbits(),we.isNode=!!(typeof commonjsGlobal<"u"&&commonjsGlobal&&commonjsGlobal.process&&commonjsGlobal.process.versions&&commonjsGlobal.process.versions.node),we.global=we.isNode&&commonjsGlobal||typeof window<"u"&&window||typeof self<"u"&&self||commonjsGlobal,we.emptyArray=Object.freeze?Object.freeze([]):[],we.emptyObject=Object.freeze?Object.freeze({}):{},we.isInteger=Number.isInteger||function(xe){return typeof xe=="number"&&isFinite(xe)&&Math.floor(xe)===xe},we.isString=function(xe){return typeof xe=="string"||xe instanceof String},we.isObject=function(xe){return xe&&typeof xe=="object"},we.isset=we.isSet=function(xe,ve){var ke=xe[ve];return ke!=null&&xe.hasOwnProperty(ve)?typeof ke!="object"||(Array.isArray(ke)?ke.length:Object.keys(ke).length)>0:!1},we.Buffer=function(){try{var be=we.inquire("buffer").Buffer;return be.prototype.utf8Write?be:null}catch{return null}}(),we._Buffer_from=null,we._Buffer_allocUnsafe=null,we.newBuffer=function(xe){return typeof xe=="number"?we.Buffer?we._Buffer_allocUnsafe(xe):new we.Array(xe):we.Buffer?we._Buffer_from(xe):typeof Uint8Array>"u"?xe:new Uint8Array(xe)},we.Array=typeof Uint8Array<"u"?Uint8Array:Array,we.Long=we.global.dcodeIO&&we.global.dcodeIO.Long||we.global.Long||we.inquire("long"),we.key2Re=/^true|false|0|1$/,we.key32Re=/^-?(?:0|[1-9][0-9]*)$/,we.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,we.longToHash=function(xe){return xe?we.LongBits.from(xe).toHash():we.LongBits.zeroHash},we.longFromHash=function(xe,ve){var ke=we.LongBits.fromHash(xe);return we.Long?we.Long.fromBits(ke.lo,ke.hi,ve):ke.toNumber(!!ve)};function t(be,xe,ve){for(var ke=Object.keys(xe),Ie=0;Ie<ke.length;++Ie)(be[ke[Ie]]===void 0||!ve)&&(be[ke[Ie]]=xe[ke[Ie]]);return be}we.merge=t,we.lcFirst=function(xe){return xe.charAt(0).toLowerCase()+xe.substring(1)};function te(be){function xe(ve,ke){if(!(this instanceof xe))return new xe(ve,ke);Object.defineProperty(this,"message",{get:function(){return ve}}),Error.captureStackTrace?Error.captureStackTrace(this,xe):Object.defineProperty(this,"stack",{value:new Error().stack||""}),ke&&t(this,ke)}return xe.prototype=Object.create(Error.prototype,{constructor:{value:xe,writable:!0,enumerable:!1,configurable:!0},name:{get:function(){return be},set:void 0,enumerable:!1,configurable:!0},toString:{value:function(){return this.name+": "+this.message},writable:!0,enumerable:!1,configurable:!0}}),xe}we.newError=te,we.ProtocolError=te("ProtocolError"),we.oneOfGetter=function(xe){for(var ve={},ke=0;ke<xe.length;++ke)ve[xe[ke]]=1;return function(){for(var Ie=Object.keys(this),Ae=Ie.length-1;Ae>-1;--Ae)if(ve[Ie[Ae]]===1&&this[Ie[Ae]]!==void 0&&this[Ie[Ae]]!==null)return Ie[Ae]}},we.oneOfSetter=function(xe){return function(ve){for(var ke=0;ke<xe.length;++ke)xe[ke]!==ve&&delete this[xe[ke]]}},we.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},we._configure=function(){var be=we.Buffer;if(!be){we._Buffer_from=we._Buffer_allocUnsafe=null;return}we._Buffer_from=be.from!==Uint8Array.from&&be.from||function(ve,ke){return new be(ve,ke)},we._Buffer_allocUnsafe=be.allocUnsafe||function(ve){return new be(ve)}}}(minimal$1)),minimal$1}var writer=Writer$1,util$4=requireMinimal(),BufferWriter$1,LongBits$1=util$4.LongBits,base64=util$4.base64,utf8$1=util$4.utf8;function Op(Te,we,t){this.fn=Te,this.len=we,this.next=void 0,this.val=t}function noop(){}function State(Te){this.head=Te.head,this.tail=Te.tail,this.len=Te.len,this.next=Te.states}function Writer$1(){this.len=0,this.head=new Op(noop,0,0),this.tail=this.head,this.states=null}var create$1=function Te(){return util$4.Buffer?function(){return(Writer$1.create=function(){return new BufferWriter$1})()}:function(){return new Writer$1}};Writer$1.create=create$1();Writer$1.alloc=function Te(we){return new util$4.Array(we)};util$4.Array!==Array&&(Writer$1.alloc=util$4.pool(Writer$1.alloc,util$4.Array.prototype.subarray));Writer$1.prototype._push=function Te(we,t,te){return this.tail=this.tail.next=new Op(we,t,te),this.len+=t,this};function writeByte(Te,we,t){we[t]=Te&255}function writeVarint32(Te,we,t){for(;Te>127;)we[t++]=Te&127|128,Te>>>=7;we[t]=Te}function VarintOp(Te,we){this.len=Te,this.next=void 0,this.val=we}VarintOp.prototype=Object.create(Op.prototype);VarintOp.prototype.fn=writeVarint32;Writer$1.prototype.uint32=function Te(we){return this.len+=(this.tail=this.tail.next=new VarintOp((we=we>>>0)<128?1:we<16384?2:we<2097152?3:we<268435456?4:5,we)).len,this};Writer$1.prototype.int32=function Te(we){return we<0?this._push(writeVarint64,10,LongBits$1.fromNumber(we)):this.uint32(we)};Writer$1.prototype.sint32=function Te(we){return this.uint32((we<<1^we>>31)>>>0)};function writeVarint64(Te,we,t){for(;Te.hi;)we[t++]=Te.lo&127|128,Te.lo=(Te.lo>>>7|Te.hi<<25)>>>0,Te.hi>>>=7;for(;Te.lo>127;)we[t++]=Te.lo&127|128,Te.lo=Te.lo>>>7;we[t++]=Te.lo}Writer$1.prototype.uint64=function Te(we){var t=LongBits$1.from(we);return this._push(writeVarint64,t.length(),t)};Writer$1.prototype.int64=Writer$1.prototype.uint64;Writer$1.prototype.sint64=function Te(we){var t=LongBits$1.from(we).zzEncode();return this._push(writeVarint64,t.length(),t)};Writer$1.prototype.bool=function Te(we){return this._push(writeByte,1,we?1:0)};function writeFixed32(Te,we,t){we[t]=Te&255,we[t+1]=Te>>>8&255,we[t+2]=Te>>>16&255,we[t+3]=Te>>>24}Writer$1.prototype.fixed32=function Te(we){return this._push(writeFixed32,4,we>>>0)};Writer$1.prototype.sfixed32=Writer$1.prototype.fixed32;Writer$1.prototype.fixed64=function Te(we){var t=LongBits$1.from(we);return this._push(writeFixed32,4,t.lo)._push(writeFixed32,4,t.hi)};Writer$1.prototype.sfixed64=Writer$1.prototype.fixed64;Writer$1.prototype.float=function Te(we){return this._push(util$4.float.writeFloatLE,4,we)};Writer$1.prototype.double=function Te(we){return this._push(util$4.float.writeDoubleLE,8,we)};var writeBytes=util$4.Array.prototype.set?function Te(we,t,te){t.set(we,te)}:function Te(we,t,te){for(var be=0;be<we.length;++be)t[te+be]=we[be]};Writer$1.prototype.bytes=function Te(we){var t=we.length>>>0;if(!t)return this._push(writeByte,1,0);if(util$4.isString(we)){var te=Writer$1.alloc(t=base64.length(we));base64.decode(we,te,0),we=te}return this.uint32(t)._push(writeBytes,t,we)};Writer$1.prototype.string=function Te(we){var t=utf8$1.length(we);return t?this.uint32(t)._push(utf8$1.write,t,we):this._push(writeByte,1,0)};Writer$1.prototype.fork=function Te(){return this.states=new State(this),this.head=this.tail=new Op(noop,0,0),this.len=0,this};Writer$1.prototype.reset=function Te(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new Op(noop,0,0),this.len=0),this};Writer$1.prototype.ldelim=function Te(){var we=this.head,t=this.tail,te=this.len;return this.reset().uint32(te),te&&(this.tail.next=we.next,this.tail=t,this.len+=te),this};Writer$1.prototype.finish=function Te(){for(var we=this.head.next,t=this.constructor.alloc(this.len),te=0;we;)we.fn(we.val,t,te),te+=we.len,we=we.next;return t};Writer$1._configure=function(Te){BufferWriter$1=Te,Writer$1.create=create$1(),BufferWriter$1._configure()};var writer_buffer=BufferWriter,Writer=writer;(BufferWriter.prototype=Object.create(Writer.prototype)).constructor=BufferWriter;var util$3=requireMinimal();function BufferWriter(){Writer.call(this)}BufferWriter._configure=function(){BufferWriter.alloc=util$3._Buffer_allocUnsafe,BufferWriter.writeBytesBuffer=util$3.Buffer&&util$3.Buffer.prototype instanceof Uint8Array&&util$3.Buffer.prototype.set.name==="set"?function(we,t,te){t.set(we,te)}:function(we,t,te){if(we.copy)we.copy(t,te,0,we.length);else for(var be=0;be<we.length;)t[te++]=we[be++]}};BufferWriter.prototype.bytes=function Te(we){util$3.isString(we)&&(we=util$3._Buffer_from(we,"base64"));var t=we.length>>>0;return this.uint32(t),t&&this._push(BufferWriter.writeBytesBuffer,t,we),this};function writeStringBuffer(Te,we,t){Te.length<40?util$3.utf8.write(Te,we,t):we.utf8Write?we.utf8Write(Te,t):we.write(Te,t)}BufferWriter.prototype.string=function Te(we){var t=util$3.Buffer.byteLength(we);return this.uint32(t),t&&this._push(writeStringBuffer,t,we),this};BufferWriter._configure();var reader=Reader$1,util$2=requireMinimal(),BufferReader$1,LongBits=util$2.LongBits,utf8=util$2.utf8;function indexOutOfRange(Te,we){return RangeError("index out of range: "+Te.pos+" + "+(we||1)+" > "+Te.len)}function Reader$1(Te){this.buf=Te,this.pos=0,this.len=Te.length}var create_array=typeof Uint8Array<"u"?function Te(we){if(we instanceof Uint8Array||Array.isArray(we))return new Reader$1(we);throw Error("illegal buffer")}:function Te(we){if(Array.isArray(we))return new Reader$1(we);throw Error("illegal buffer")},create=function Te(){return util$2.Buffer?function(t){return(Reader$1.create=function(be){return util$2.Buffer.isBuffer(be)?new BufferReader$1(be):create_array(be)})(t)}:create_array};Reader$1.create=create();Reader$1.prototype._slice=util$2.Array.prototype.subarray||util$2.Array.prototype.slice;Reader$1.prototype.uint32=function Te(){var we=4294967295;return function(){if(we=(this.buf[this.pos]&127)>>>0,this.buf[this.pos++]<128||(we=(we|(this.buf[this.pos]&127)<<7)>>>0,this.buf[this.pos++]<128)||(we=(we|(this.buf[this.pos]&127)<<14)>>>0,this.buf[this.pos++]<128)||(we=(we|(this.buf[this.pos]&127)<<21)>>>0,this.buf[this.pos++]<128)||(we=(we|(this.buf[this.pos]&15)<<28)>>>0,this.buf[this.pos++]<128))return we;if((this.pos+=5)>this.len)throw this.pos=this.len,indexOutOfRange(this,10);return we}}();Reader$1.prototype.int32=function Te(){return this.uint32()|0};Reader$1.prototype.sint32=function Te(){var we=this.uint32();return we>>>1^-(we&1)|0};function readLongVarint(){var Te=new LongBits(0,0),we=0;if(this.len-this.pos>4){for(;we<4;++we)if(Te.lo=(Te.lo|(this.buf[this.pos]&127)<<we*7)>>>0,this.buf[this.pos++]<128)return Te;if(Te.lo=(Te.lo|(this.buf[this.pos]&127)<<28)>>>0,Te.hi=(Te.hi|(this.buf[this.pos]&127)>>4)>>>0,this.buf[this.pos++]<128)return Te;we=0}else{for(;we<3;++we){if(this.pos>=this.len)throw indexOutOfRange(this);if(Te.lo=(Te.lo|(this.buf[this.pos]&127)<<we*7)>>>0,this.buf[this.pos++]<128)return Te}return Te.lo=(Te.lo|(this.buf[this.pos++]&127)<<we*7)>>>0,Te}if(this.len-this.pos>4){for(;we<5;++we)if(Te.hi=(Te.hi|(this.buf[this.pos]&127)<<we*7+3)>>>0,this.buf[this.pos++]<128)return Te}else for(;we<5;++we){if(this.pos>=this.len)throw indexOutOfRange(this);if(Te.hi=(Te.hi|(this.buf[this.pos]&127)<<we*7+3)>>>0,this.buf[this.pos++]<128)return Te}throw Error("invalid varint encoding")}Reader$1.prototype.bool=function Te(){return this.uint32()!==0};function readFixed32_end(Te,we){return(Te[we-4]|Te[we-3]<<8|Te[we-2]<<16|Te[we-1]<<24)>>>0}Reader$1.prototype.fixed32=function Te(){if(this.pos+4>this.len)throw indexOutOfRange(this,4);return readFixed32_end(this.buf,this.pos+=4)};Reader$1.prototype.sfixed32=function Te(){if(this.pos+4>this.len)throw indexOutOfRange(this,4);return readFixed32_end(this.buf,this.pos+=4)|0};function readFixed64(){if(this.pos+8>this.len)throw indexOutOfRange(this,8);return new LongBits(readFixed32_end(this.buf,this.pos+=4),readFixed32_end(this.buf,this.pos+=4))}Reader$1.prototype.float=function Te(){if(this.pos+4>this.len)throw indexOutOfRange(this,4);var we=util$2.float.readFloatLE(this.buf,this.pos);return this.pos+=4,we};Reader$1.prototype.double=function Te(){if(this.pos+8>this.len)throw indexOutOfRange(this,4);var we=util$2.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,we};Reader$1.prototype.bytes=function Te(){var we=this.uint32(),t=this.pos,te=this.pos+we;if(te>this.len)throw indexOutOfRange(this,we);if(this.pos+=we,Array.isArray(this.buf))return this.buf.slice(t,te);if(t===te){var be=util$2.Buffer;return be?be.alloc(0):new this.buf.constructor(0)}return this._slice.call(this.buf,t,te)};Reader$1.prototype.string=function Te(){var we=this.bytes();return utf8.read(we,0,we.length)};Reader$1.prototype.skip=function Te(we){if(typeof we=="number"){if(this.pos+we>this.len)throw indexOutOfRange(this,we);this.pos+=we}else do if(this.pos>=this.len)throw indexOutOfRange(this);while(this.buf[this.pos++]&128);return this};Reader$1.prototype.skipType=function(Te){switch(Te){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;(Te=this.uint32()&7)!==4;)this.skipType(Te);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+Te+" at offset "+this.pos)}return this};Reader$1._configure=function(Te){BufferReader$1=Te,Reader$1.create=create(),BufferReader$1._configure();var we=util$2.Long?"toLong":"toNumber";util$2.merge(Reader$1.prototype,{int64:function(){return readLongVarint.call(this)[we](!1)},uint64:function(){return readLongVarint.call(this)[we](!0)},sint64:function(){return readLongVarint.call(this).zzDecode()[we](!1)},fixed64:function(){return readFixed64.call(this)[we](!0)},sfixed64:function(){return readFixed64.call(this)[we](!1)}})};var reader_buffer=BufferReader,Reader=reader;(BufferReader.prototype=Object.create(Reader.prototype)).constructor=BufferReader;var util$1=requireMinimal();function BufferReader(Te){Reader.call(this,Te)}BufferReader._configure=function(){util$1.Buffer&&(BufferReader.prototype._slice=util$1.Buffer.prototype.slice)};BufferReader.prototype.string=function Te(){var we=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+we,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+we,this.len))};BufferReader._configure();var rpc={},service=Service,util=requireMinimal();(Service.prototype=Object.create(util.EventEmitter.prototype)).constructor=Service;function Service(Te,we,t){if(typeof Te!="function")throw TypeError("rpcImpl must be a function");util.EventEmitter.call(this),this.rpcImpl=Te,this.requestDelimited=!!we,this.responseDelimited=!!t}Service.prototype.rpcCall=function Te(we,t,te,be,xe){if(!be)throw TypeError("request must be specified");var ve=this;if(!xe)return util.asPromise(Te,ve,we,t,te,be);if(!ve.rpcImpl){setTimeout(function(){xe(Error("already ended"))},0);return}try{return ve.rpcImpl(we,t[ve.requestDelimited?"encodeDelimited":"encode"](be).finish(),function(Ie,Ae){if(Ie)return ve.emit("error",Ie,we),xe(Ie);if(Ae===null){ve.end(!0);return}if(!(Ae instanceof te))try{Ae=te[ve.responseDelimited?"decodeDelimited":"decode"](Ae)}catch(Se){return ve.emit("error",Se,we),xe(Se)}return ve.emit("data",Ae,we),xe(null,Ae)})}catch(ke){ve.emit("error",ke,we),setTimeout(function(){xe(ke)},0);return}};Service.prototype.end=function Te(we){return this.rpcImpl&&(we||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this};(function(Te){var we=Te;we.Service=service})(rpc);var roots={};(function(Te){var we=Te;we.build="minimal",we.Writer=writer,we.BufferWriter=writer_buffer,we.Reader=reader,we.BufferReader=reader_buffer,we.util=requireMinimal(),we.rpc=rpc,we.roots=roots,we.configure=t;function t(){we.util._configure(),we.Writer._configure(we.BufferWriter),we.Reader._configure(we.BufferReader)}t()})(indexMinimal);var minimal=indexMinimal;const _0x462d7f=getDefaultExportFromCjs(minimal),PACKET_TYPES=Object.create(null);PACKET_TYPES.open="0";PACKET_TYPES.close="1";PACKET_TYPES.ping="2";PACKET_TYPES.pong="3";PACKET_TYPES.message="4";PACKET_TYPES.upgrade="5";PACKET_TYPES.noop="6";const PACKET_TYPES_REVERSE=Object.create(null);Object.keys(PACKET_TYPES).forEach(Te=>{PACKET_TYPES_REVERSE[PACKET_TYPES[Te]]=Te});const ERROR_PACKET={type:"error",data:"parser error"},withNativeBlob$1=typeof Blob=="function"||typeof Blob<"u"&&Object.prototype.toString.call(Blob)==="[object BlobConstructor]",withNativeArrayBuffer$2=typeof ArrayBuffer=="function",isView$1=Te=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(Te):Te&&Te.buffer instanceof ArrayBuffer,encodePacket=({type:Te,data:we},t,te)=>withNativeBlob$1&&we instanceof Blob?t?te(we):encodeBlobAsBase64(we,te):withNativeArrayBuffer$2&&(we instanceof ArrayBuffer||isView$1(we))?t?te(we):encodeBlobAsBase64(new Blob([we]),te):te(PACKET_TYPES[Te]+(we||"")),encodeBlobAsBase64=(Te,we)=>{const t=new FileReader;return t.onload=function(){const te=t.result.split(",")[1];we("b"+(te||""))},t.readAsDataURL(Te)};function toArray(Te){return Te instanceof Uint8Array?Te:Te instanceof ArrayBuffer?new Uint8Array(Te):new Uint8Array(Te.buffer,Te.byteOffset,Te.byteLength)}let TEXT_ENCODER;function encodePacketToBinary(Te,we){if(withNativeBlob$1&&Te.data instanceof Blob)return Te.data.arrayBuffer().then(toArray).then(we);if(withNativeArrayBuffer$2&&(Te.data instanceof ArrayBuffer||isView$1(Te.data)))return we(toArray(Te.data));encodePacket(Te,!1,t=>{TEXT_ENCODER||(TEXT_ENCODER=new TextEncoder),we(TEXT_ENCODER.encode(t))})}const chars="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",lookup$1=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(let Te=0;Te<chars.length;Te++)lookup$1[chars.charCodeAt(Te)]=Te;const decode$2=Te=>{let we=Te.length*.75,t=Te.length,te,be=0,xe,ve,ke,Ie;Te[Te.length-1]==="="&&(we--,Te[Te.length-2]==="="&&we--);const Ae=new ArrayBuffer(we),Se=new Uint8Array(Ae);for(te=0;te<t;te+=4)xe=lookup$1[Te.charCodeAt(te)],ve=lookup$1[Te.charCodeAt(te+1)],ke=lookup$1[Te.charCodeAt(te+2)],Ie=lookup$1[Te.charCodeAt(te+3)],Se[be++]=xe<<2|ve>>4,Se[be++]=(ve&15)<<4|ke>>2,Se[be++]=(ke&3)<<6|Ie&63;return Ae},withNativeArrayBuffer$1=typeof ArrayBuffer=="function",decodePacket=(Te,we)=>{if(typeof Te!="string")return{type:"message",data:mapBinary(Te,we)};const t=Te.charAt(0);return t==="b"?{type:"message",data:decodeBase64Packet(Te.substring(1),we)}:PACKET_TYPES_REVERSE[t]?Te.length>1?{type:PACKET_TYPES_REVERSE[t],data:Te.substring(1)}:{type:PACKET_TYPES_REVERSE[t]}:ERROR_PACKET},decodeBase64Packet=(Te,we)=>{if(withNativeArrayBuffer$1){const t=decode$2(Te);return mapBinary(t,we)}else return{base64:!0,data:Te}},mapBinary=(Te,we)=>{switch(we){case"blob":return Te instanceof Blob?Te:new Blob([Te]);case"arraybuffer":default:return Te instanceof ArrayBuffer?Te:Te.buffer}},SEPARATOR="",encodePayload=(Te,we)=>{const t=Te.length,te=new Array(t);let be=0;Te.forEach((xe,ve)=>{encodePacket(xe,!1,ke=>{te[ve]=ke,++be===t&&we(te.join(SEPARATOR))})})},decodePayload=(Te,we)=>{const t=Te.split(SEPARATOR),te=[];for(let be=0;be<t.length;be++){const xe=decodePacket(t[be],we);if(te.push(xe),xe.type==="error")break}return te};function createPacketEncoderStream(){return new TransformStream({transform(Te,we){encodePacketToBinary(Te,t=>{const te=t.length;let be;if(te<126)be=new Uint8Array(1),new DataView(be.buffer).setUint8(0,te);else if(te<65536){be=new Uint8Array(3);const xe=new DataView(be.buffer);xe.setUint8(0,126),xe.setUint16(1,te)}else{be=new Uint8Array(9);const xe=new DataView(be.buffer);xe.setUint8(0,127),xe.setBigUint64(1,BigInt(te))}Te.data&&typeof Te.data!="string"&&(be[0]|=128),we.enqueue(be),we.enqueue(t)})}})}let TEXT_DECODER;function totalLength(Te){return Te.reduce((we,t)=>we+t.length,0)}function concatChunks(Te,we){if(Te[0].length===we)return Te.shift();const t=new Uint8Array(we);let te=0;for(let be=0;be<we;be++)t[be]=Te[0][te++],te===Te[0].length&&(Te.shift(),te=0);return Te.length&&te<Te[0].length&&(Te[0]=Te[0].slice(te)),t}function createPacketDecoderStream(Te,we){TEXT_DECODER||(TEXT_DECODER=new TextDecoder);const t=[];let te=0,be=-1,xe=!1;return new TransformStream({transform(ve,ke){for(t.push(ve);;){if(te===0){if(totalLength(t)<1)break;const Ie=concatChunks(t,1);xe=(Ie[0]&128)===128,be=Ie[0]&127,be<126?te=3:be===126?te=1:te=2}else if(te===1){if(totalLength(t)<2)break;const Ie=concatChunks(t,2);be=new DataView(Ie.buffer,Ie.byteOffset,Ie.length).getUint16(0),te=3}else if(te===2){if(totalLength(t)<8)break;const Ie=concatChunks(t,8),Ae=new DataView(Ie.buffer,Ie.byteOffset,Ie.length),Se=Ae.getUint32(0);if(Se>Math.pow(2,21)-1){ke.enqueue(ERROR_PACKET);break}be=Se*Math.pow(2,32)+Ae.getUint32(4),te=3}else{if(totalLength(t)<be)break;const Ie=concatChunks(t,be);ke.enqueue(decodePacket(xe?Ie:TEXT_DECODER.decode(Ie),we)),te=0}if(be===0||be>Te){ke.enqueue(ERROR_PACKET);break}}}})}const protocol$1=4;function Emitter(Te){if(Te)return mixin(Te)}function mixin(Te){for(var we in Emitter.prototype)Te[we]=Emitter.prototype[we];return Te}Emitter.prototype.on=Emitter.prototype.addEventListener=function(Te,we){return this._callbacks=this._callbacks||{},(this._callbacks["$"+Te]=this._callbacks["$"+Te]||[]).push(we),this};Emitter.prototype.once=function(Te,we){function t(){this.off(Te,t),we.apply(this,arguments)}return t.fn=we,this.on(Te,t),this};Emitter.prototype.off=Emitter.prototype.removeListener=Emitter.prototype.removeAllListeners=Emitter.prototype.removeEventListener=function(Te,we){if(this._callbacks=this._callbacks||{},arguments.length==0)return this._callbacks={},this;var t=this._callbacks["$"+Te];if(!t)return this;if(arguments.length==1)return delete this._callbacks["$"+Te],this;for(var te,be=0;be<t.length;be++)if(te=t[be],te===we||te.fn===we){t.splice(be,1);break}return t.length===0&&delete this._callbacks["$"+Te],this};Emitter.prototype.emit=function(Te){this._callbacks=this._callbacks||{};for(var we=new Array(arguments.length-1),t=this._callbacks["$"+Te],te=1;te<arguments.length;te++)we[te-1]=arguments[te];if(t){t=t.slice(0);for(var te=0,be=t.length;te<be;++te)t[te].apply(this,we)}return this};Emitter.prototype.emitReserved=Emitter.prototype.emit;Emitter.prototype.listeners=function(Te){return this._callbacks=this._callbacks||{},this._callbacks["$"+Te]||[]};Emitter.prototype.hasListeners=function(Te){return!!this.listeners(Te).length};const globalThisShim=typeof self<"u"?self:typeof window<"u"?window:Function("return this")();function pick$1(Te,...we){return we.reduce((t,te)=>(Te.hasOwnProperty(te)&&(t[te]=Te[te]),t),{})}const NATIVE_SET_TIMEOUT=globalThisShim.setTimeout,NATIVE_CLEAR_TIMEOUT=globalThisShim.clearTimeout;function installTimerFunctions(Te,we){we.useNativeTimers?(Te.setTimeoutFn=NATIVE_SET_TIMEOUT.bind(globalThisShim),Te.clearTimeoutFn=NATIVE_CLEAR_TIMEOUT.bind(globalThisShim)):(Te.setTimeoutFn=globalThisShim.setTimeout.bind(globalThisShim),Te.clearTimeoutFn=globalThisShim.clearTimeout.bind(globalThisShim))}const BASE64_OVERHEAD=1.33;function byteLength(Te){return typeof Te=="string"?utf8Length(Te):Math.ceil((Te.byteLength||Te.size)*BASE64_OVERHEAD)}function utf8Length(Te){let we=0,t=0;for(let te=0,be=Te.length;te<be;te++)we=Te.charCodeAt(te),we<128?t+=1:we<2048?t+=2:we<55296||we>=57344?t+=3:(te++,t+=4);return t}function encode$2(Te){let we="";for(let t in Te)Te.hasOwnProperty(t)&&(we.length&&(we+="&"),we+=encodeURIComponent(t)+"="+encodeURIComponent(Te[t]));return we}function decode$1(Te){let we={},t=Te.split("&");for(let te=0,be=t.length;te<be;te++){let xe=t[te].split("=");we[decodeURIComponent(xe[0])]=decodeURIComponent(xe[1])}return we}class TransportError extends Error{constructor(we,t,te){super(we),this.description=t,this.context=te,this.type="TransportError"}}class Transport extends Emitter{constructor(we){super(),this.writable=!1,installTimerFunctions(this,we),this.opts=we,this.query=we.query,this.socket=we.socket}onError(we,t,te){return super.emitReserved("error",new TransportError(we,t,te)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return(this.readyState==="opening"||this.readyState==="open")&&(this.doClose(),this.onClose()),this}send(we){this.readyState==="open"&&this.write(we)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(we){const t=decodePacket(we,this.socket.binaryType);this.onPacket(t)}onPacket(we){super.emitReserved("packet",we)}onClose(we){this.readyState="closed",super.emitReserved("close",we)}pause(we){}createUri(we,t={}){return we+"://"+this._hostname()+this._port()+this.opts.path+this._query(t)}_hostname(){const we=this.opts.hostname;return we.indexOf(":")===-1?we:"["+we+"]"}_port(){return this.opts.port&&(this.opts.secure&&+(this.opts.port!==443)||!this.opts.secure&&Number(this.opts.port)!==80)?":"+this.opts.port:""}_query(we){const t=encode$2(we);return t.length?"?"+t:""}}const alphabet="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),length=64,map={};let seed=0,i$3=0,prev;function encode$1(Te){let we="";do we=alphabet[Te%length]+we,Te=Math.floor(Te/length);while(Te>0);return we}function yeast(){const Te=encode$1(+new Date);return Te!==prev?(seed=0,prev=Te):Te+"."+encode$1(seed++)}for(;i$3<length;i$3++)map[alphabet[i$3]]=i$3;let value=!1;try{value=typeof XMLHttpRequest<"u"&&"withCredentials"in new XMLHttpRequest}catch(Te){}const hasCORS=value;function XHR(Te){const we=Te.xdomain;try{if(typeof XMLHttpRequest<"u"&&(!we||hasCORS))return new XMLHttpRequest}catch{}if(!we)try{return new globalThisShim[["Active"].concat("Object").join("X")]("Microsoft.XMLHTTP")}catch{}}function createCookieJar(){}function empty(){}const hasXHR2=function(){return new XHR({xdomain:!1}).responseType!=null}();class Polling extends Transport{constructor(we){if(super(we),this.polling=!1,typeof location<"u"){const te=location.protocol==="https:";let be=location.port;be||(be=te?"443":"80"),this.xd=typeof location<"u"&&we.hostname!==location.hostname||be!==we.port}const t=we&&we.forceBase64;this.supportsBinary=hasXHR2&&!t,this.opts.withCredentials&&(this.cookieJar=void 0)}get name(){return"polling"}doOpen(){this.poll()}pause(we){this.readyState="pausing";const t=()=>{this.readyState="paused",we()};if(this.polling||!this.writable){let te=0;this.polling&&(te++,this.once("pollComplete",function(){--te||t()})),this.writable||(te++,this.once("drain",function(){--te||t()}))}else t()}poll(){this.polling=!0,this.doPoll(),this.emitReserved("poll")}onData(we){const t=te=>{if(this.readyState==="opening"&&te.type==="open"&&this.onOpen(),te.type==="close")return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(te)};decodePayload(we,this.socket.binaryType).forEach(t),this.readyState!=="closed"&&(this.polling=!1,this.emitReserved("pollComplete"),this.readyState==="open"&&this.poll())}doClose(){const we=()=>{this.write([{type:"close"}])};this.readyState==="open"?we():this.once("open",we)}write(we){this.writable=!1,encodePayload(we,t=>{this.doWrite(t,()=>{this.writable=!0,this.emitReserved("drain")})})}uri(){const we=this.opts.secure?"https":"http",t=this.query||{};return this.opts.timestampRequests!==!1&&(t[this.opts.timestampParam]=yeast()),!this.supportsBinary&&!t.sid&&(t.b64=1),this.createUri(we,t)}request(we={}){return Object.assign(we,{xd:this.xd,cookieJar:this.cookieJar},this.opts),new Request(this.uri(),we)}doWrite(we,t){const te=this.request({method:"POST",data:we});te.on("success",t),te.on("error",(be,xe)=>{this.onError("xhr post error",be,xe)})}doPoll(){const we=this.request();we.on("data",this.onData.bind(this)),we.on("error",(t,te)=>{this.onError("xhr poll error",t,te)}),this.pollXhr=we}}class Request extends Emitter{constructor(we,t){super(),installTimerFunctions(this,t),this.opts=t,this.method=t.method||"GET",this.uri=we,this.data=t.data!==void 0?t.data:null,this.create()}create(){var we;const t=pick$1(this.opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");t.xdomain=!!this.opts.xd;const te=this.xhr=new XHR(t);try{te.open(this.method,this.uri,!0);try{if(this.opts.extraHeaders){te.setDisableHeaderCheck&&te.setDisableHeaderCheck(!0);for(let be in this.opts.extraHeaders)this.opts.extraHeaders.hasOwnProperty(be)&&te.setRequestHeader(be,this.opts.extraHeaders[be])}}catch{}if(this.method==="POST")try{te.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch{}try{te.setRequestHeader("Accept","*/*")}catch{}(we=this.opts.cookieJar)===null||we===void 0||we.addCookies(te),"withCredentials"in te&&(te.withCredentials=this.opts.withCredentials),this.opts.requestTimeout&&(te.timeout=this.opts.requestTimeout),te.onreadystatechange=()=>{var be;te.readyState===3&&((be=this.opts.cookieJar)===null||be===void 0||be.parseCookies(te)),te.readyState===4&&(te.status===200||te.status===1223?this.onLoad():this.setTimeoutFn(()=>{this.onError(typeof te.status=="number"?te.status:0)},0))},te.send(this.data)}catch(be){this.setTimeoutFn(()=>{this.onError(be)},0);return}typeof document<"u"&&(this.index=Request.requestsCount++,Request.requests[this.index]=this)}onError(we){this.emitReserved("error",we,this.xhr),this.cleanup(!0)}cleanup(we){if(!(typeof this.xhr>"u"||this.xhr===null)){if(this.xhr.onreadystatechange=empty,we)try{this.xhr.abort()}catch{}typeof document<"u"&&delete Request.requests[this.index],this.xhr=null}}onLoad(){const we=this.xhr.responseText;we!==null&&(this.emitReserved("data",we),this.emitReserved("success"),this.cleanup())}abort(){this.cleanup()}}Request.requestsCount=0;Request.requests={};if(typeof document<"u"){if(typeof attachEvent=="function")attachEvent("onunload",unloadHandler);else if(typeof addEventListener=="function"){const Te="onpagehide"in globalThisShim?"pagehide":"unload";addEventListener(Te,unloadHandler,!1)}}function unloadHandler(){for(let Te in Request.requests)Request.requests.hasOwnProperty(Te)&&Request.requests[Te].abort()}const nextTick=typeof Promise=="function"&&typeof Promise.resolve=="function"?we=>Promise.resolve().then(we):(we,t)=>t(we,0),WebSocket=globalThisShim.WebSocket||globalThisShim.MozWebSocket,usingBrowserWebSocket=!0,defaultBinaryType="arraybuffer",isReactNative=typeof navigator<"u"&&typeof navigator.product=="string"&&navigator.product.toLowerCase()==="reactnative";class WS extends Transport{constructor(we){super(we),this.supportsBinary=!we.forceBase64}get name(){return"websocket"}doOpen(){if(!this.check())return;const we=this.uri(),t=this.opts.protocols,te=isReactNative?{}:pick$1(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(te.headers=this.opts.extraHeaders);try{this.ws=usingBrowserWebSocket&&!isReactNative?t?new WebSocket(we,t):new WebSocket(we):new WebSocket(we,t,te)}catch(be){return this.emitReserved("error",be)}this.ws.binaryType=this.socket.binaryType,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=we=>this.onClose({description:"websocket connection closed",context:we}),this.ws.onmessage=we=>this.onData(we.data),this.ws.onerror=we=>this.onError("websocket error",we)}write(we){this.writable=!1;for(let t=0;t<we.length;t++){const te=we[t],be=t===we.length-1;encodePacket(te,this.supportsBinary,xe=>{const ve={};try{usingBrowserWebSocket&&this.ws.send(xe)}catch{}be&&nextTick(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){typeof this.ws<"u"&&(this.ws.close(),this.ws=null)}uri(){const we=this.opts.secure?"wss":"ws",t=this.query||{};return this.opts.timestampRequests&&(t[this.opts.timestampParam]=yeast()),this.supportsBinary||(t.b64=1),this.createUri(we,t)}check(){return!!WebSocket}}class WT extends Transport{get name(){return"webtransport"}doOpen(){typeof WebTransport=="function"&&(this.transport=new WebTransport(this.createUri("https"),this.opts.transportOptions[this.name]),this.transport.closed.then(()=>{this.onClose()}).catch(we=>{this.onError("webtransport error",we)}),this.transport.ready.then(()=>{this.transport.createBidirectionalStream().then(we=>{const t=createPacketDecoderStream(Number.MAX_SAFE_INTEGER,this.socket.binaryType),te=we.readable.pipeThrough(t).getReader(),be=createPacketEncoderStream();be.readable.pipeTo(we.writable),this.writer=be.writable.getWriter();const xe=()=>{te.read().then(({done:ke,value:Ie})=>{ke||(this.onPacket(Ie),xe())}).catch(ke=>{})};xe();const ve={type:"open"};this.query.sid&&(ve.data=`{"sid":"${this.query.sid}"}`),this.writer.write(ve).then(()=>this.onOpen())})}))}write(we){this.writable=!1;for(let t=0;t<we.length;t++){const te=we[t],be=t===we.length-1;this.writer.write(te).then(()=>{be&&nextTick(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){var we;(we=this.transport)===null||we===void 0||we.close()}}const transports={websocket:WS,webtransport:WT,polling:Polling},re$1=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,parts=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function parse$1(Te){if(Te.length>2e3)throw"URI too long";const we=Te,t=Te.indexOf("["),te=Te.indexOf("]");t!=-1&&te!=-1&&(Te=Te.substring(0,t)+Te.substring(t,te).replace(/:/g,";")+Te.substring(te,Te.length));let be=re$1.exec(Te||""),xe={},ve=14;for(;ve--;)xe[parts[ve]]=be[ve]||"";return t!=-1&&te!=-1&&(xe.source=we,xe.host=xe.host.substring(1,xe.host.length-1).replace(/;/g,":"),xe.authority=xe.authority.replace("[","").replace("]","").replace(/;/g,":"),xe.ipv6uri=!0),xe.pathNames=pathNames(xe,xe.path),xe.queryKey=queryKey(xe,xe.query),xe}function pathNames(Te,we){const t=/\/{2,9}/g,te=we.replace(t,"/").split("/");return(we.slice(0,1)=="/"||we.length===0)&&te.splice(0,1),we.slice(-1)=="/"&&te.splice(te.length-1,1),te}function queryKey(Te,we){const t={};return we.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(te,be,xe){be&&(t[be]=xe)}),t}let Socket$1=class Oi extends Emitter{constructor(we,t={}){super(),this.binaryType=defaultBinaryType,this.writeBuffer=[],we&&typeof we=="object"&&(t=we,we=null),we?(we=parse$1(we),t.hostname=we.host,t.secure=we.protocol==="https"||we.protocol==="wss",t.port=we.port,we.query&&(t.query=we.query)):t.host&&(t.hostname=parse$1(t.host).host),installTimerFunctions(this,t),this.secure=t.secure!=null?t.secure:typeof location<"u"&&location.protocol==="https:",t.hostname&&!t.port&&(t.port=this.secure?"443":"80"),this.hostname=t.hostname||(typeof location<"u"?location.hostname:"localhost"),this.port=t.port||(typeof location<"u"&&location.port?location.port:this.secure?"443":"80"),this.transports=t.transports||["polling","websocket","webtransport"],this.writeBuffer=[],this.prevBufferLen=0,this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!1},t),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),typeof this.opts.query=="string"&&(this.opts.query=decode$1(this.opts.query)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingTimeoutTimer=null,typeof addEventListener=="function"&&(this.opts.closeOnBeforeunload&&(this.beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this.beforeunloadEventListener,!1)),this.hostname!=="localhost"&&(this.offlineEventListener=()=>{this.onClose("transport close",{description:"network connection lost"})},addEventListener("offline",this.offlineEventListener,!1))),this.open()}createTransport(we){const t=Object.assign({},this.opts.query);t.EIO=protocol$1,t.transport=we,this.id&&(t.sid=this.id);const te=Object.assign({},this.opts,{query:t,socket:this,hostname:this.hostname,secure:this.secure,port:this.port},this.opts.transportOptions[we]);return new transports[we](te)}open(){let we;if(this.opts.rememberUpgrade&&Oi.priorWebsocketSuccess&&this.transports.indexOf("websocket")!==-1)we="websocket";else if(this.transports.length===0){this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);return}else we=this.transports[0];this.readyState="opening";try{we=this.createTransport(we)}catch{this.transports.shift(),this.open();return}we.open(),this.setTransport(we)}setTransport(we){this.transport&&this.transport.removeAllListeners(),this.transport=we,we.on("drain",this.onDrain.bind(this)).on("packet",this.onPacket.bind(this)).on("error",this.onError.bind(this)).on("close",t=>this.onClose("transport close",t))}probe(we){let t=this.createTransport(we),te=!1;Oi.priorWebsocketSuccess=!1;const be=()=>{te||(t.send([{type:"ping",data:"probe"}]),t.once("packet",Oe=>{if(!te)if(Oe.type==="pong"&&Oe.data==="probe"){if(this.upgrading=!0,this.emitReserved("upgrading",t),!t)return;Oi.priorWebsocketSuccess=t.name==="websocket",this.transport.pause(()=>{te||this.readyState!=="closed"&&(Se(),this.setTransport(t),t.send([{type:"upgrade"}]),this.emitReserved("upgrade",t),t=null,this.upgrading=!1,this.flush())})}else{const Ve=new Error("probe error");Ve.transport=t.name,this.emitReserved("upgradeError",Ve)}}))};function xe(){te||(te=!0,Se(),t.close(),t=null)}const ve=Oe=>{const Ve=new Error("probe error: "+Oe);Ve.transport=t.name,xe(),this.emitReserved("upgradeError",Ve)};function ke(){ve("transport closed")}function Ie(){ve("socket closed")}function Ae(Oe){t&&Oe.name!==t.name&&xe()}const Se=()=>{t.removeListener("open",be),t.removeListener("error",ve),t.removeListener("close",ke),this.off("close",Ie),this.off("upgrading",Ae)};t.once("open",be),t.once("error",ve),t.once("close",ke),this.once("close",Ie),this.once("upgrading",Ae),this.upgrades.indexOf("webtransport")!==-1&&we!=="webtransport"?this.setTimeoutFn(()=>{te||t.open()},200):t.open()}onOpen(){if(this.readyState="open",Oi.priorWebsocketSuccess=this.transport.name==="websocket",this.emitReserved("open"),this.flush(),this.readyState==="open"&&this.opts.upgrade){let we=0;const t=this.upgrades.length;for(;we<t;we++)this.probe(this.upgrades[we])}}onPacket(we){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")switch(this.emitReserved("packet",we),this.emitReserved("heartbeat"),this.resetPingTimeout(),we.type){case"open":this.onHandshake(JSON.parse(we.data));break;case"ping":this.sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong");break;case"error":const t=new Error("server error");t.code=we.data,this.onError(t);break;case"message":this.emitReserved("data",we.data),this.emitReserved("message",we.data);break}}onHandshake(we){this.emitReserved("handshake",we),this.id=we.sid,this.transport.query.sid=we.sid,this.upgrades=this.filterUpgrades(we.upgrades),this.pingInterval=we.pingInterval,this.pingTimeout=we.pingTimeout,this.maxPayload=we.maxPayload,this.onOpen(),this.readyState!=="closed"&&this.resetPingTimeout()}resetPingTimeout(){this.clearTimeoutFn(this.pingTimeoutTimer),this.pingTimeoutTimer=this.setTimeoutFn(()=>{this.onClose("ping timeout")},this.pingInterval+this.pingTimeout),this.opts.autoUnref&&this.pingTimeoutTimer.unref()}onDrain(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,this.writeBuffer.length===0?this.emitReserved("drain"):this.flush()}flush(){if(this.readyState!=="closed"&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const we=this.getWritablePackets();this.transport.send(we),this.prevBufferLen=we.length,this.emitReserved("flush")}}getWritablePackets(){if(!(this.maxPayload&&this.transport.name==="polling"&&this.writeBuffer.length>1))return this.writeBuffer;let t=1;for(let te=0;te<this.writeBuffer.length;te++){const be=this.writeBuffer[te].data;if(be&&(t+=byteLength(be)),te>0&&t>this.maxPayload)return this.writeBuffer.slice(0,te);t+=2}return this.writeBuffer}write(we,t,te){return this.sendPacket("message",we,t,te),this}send(we,t,te){return this.sendPacket("message",we,t,te),this}sendPacket(we,t,te,be){if(typeof t=="function"&&(be=t,t=void 0),typeof te=="function"&&(be=te,te=null),this.readyState==="closing"||this.readyState==="closed")return;te=te||{},te.compress=te.compress!==!1;const xe={type:we,data:t,options:te};this.emitReserved("packetCreate",xe),this.writeBuffer.push(xe),be&&this.once("flush",be),this.flush()}close(){const we=()=>{this.onClose("forced close"),this.transport.close()},t=()=>{this.off("upgrade",t),this.off("upgradeError",t),we()},te=()=>{this.once("upgrade",t),this.once("upgradeError",t)};return(this.readyState==="opening"||this.readyState==="open")&&(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?te():we()}):this.upgrading?te():we()),this}onError(we){Oi.priorWebsocketSuccess=!1,this.emitReserved("error",we),this.onClose("transport error",we)}onClose(we,t){(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")&&(this.clearTimeoutFn(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),typeof removeEventListener=="function"&&(removeEventListener("beforeunload",this.beforeunloadEventListener,!1),removeEventListener("offline",this.offlineEventListener,!1)),this.readyState="closed",this.id=null,this.emitReserved("close",we,t),this.writeBuffer=[],this.prevBufferLen=0)}filterUpgrades(we){const t=[];let te=0;const be=we.length;for(;te<be;te++)~this.transports.indexOf(we[te])&&t.push(we[te]);return t}};Socket$1.protocol=protocol$1;function url(Te,we="",t){let te=Te;t=t||typeof location<"u"&&location,Te==null&&(Te=t.protocol+"//"+t.host),typeof Te=="string"&&(Te.charAt(0)==="/"&&(Te.charAt(1)==="/"?Te=t.protocol+Te:Te=t.host+Te),/^(https?|wss?):\/\//.test(Te)||(typeof t<"u"?Te=t.protocol+"//"+Te:Te="https://"+Te),te=parse$1(Te)),te.port||(/^(http|ws)$/.test(te.protocol)?te.port="80":/^(http|ws)s$/.test(te.protocol)&&(te.port="443")),te.path=te.path||"/";const xe=te.host.indexOf(":")!==-1?"["+te.host+"]":te.host;return te.id=te.protocol+"://"+xe+":"+te.port+we,te.href=te.protocol+"://"+xe+(t&&t.port===te.port?"":":"+te.port),te}const withNativeArrayBuffer=typeof ArrayBuffer=="function",isView=Te=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(Te):Te.buffer instanceof ArrayBuffer,toString$1=Object.prototype.toString,withNativeBlob=typeof Blob=="function"||typeof Blob<"u"&&toString$1.call(Blob)==="[object BlobConstructor]",withNativeFile=typeof File=="function"||typeof File<"u"&&toString$1.call(File)==="[object FileConstructor]";function isBinary(Te){return withNativeArrayBuffer&&(Te instanceof ArrayBuffer||isView(Te))||withNativeBlob&&Te instanceof Blob||withNativeFile&&Te instanceof File}function hasBinary(Te,we){if(!Te||typeof Te!="object")return!1;if(Array.isArray(Te)){for(let t=0,te=Te.length;t<te;t++)if(hasBinary(Te[t]))return!0;return!1}if(isBinary(Te))return!0;if(Te.toJSON&&typeof Te.toJSON=="function"&&arguments.length===1)return hasBinary(Te.toJSON(),!0);for(const t in Te)if(Object.prototype.hasOwnProperty.call(Te,t)&&hasBinary(Te[t]))return!0;return!1}function deconstructPacket(Te){const we=[],t=Te.data,te=Te;return te.data=_deconstructPacket(t,we),te.attachments=we.length,{packet:te,buffers:we}}function _deconstructPacket(Te,we){if(!Te)return Te;if(isBinary(Te)){const t={_placeholder:!0,num:we.length};return we.push(Te),t}else if(Array.isArray(Te)){const t=new Array(Te.length);for(let te=0;te<Te.length;te++)t[te]=_deconstructPacket(Te[te],we);return t}else if(typeof Te=="object"&&!(Te instanceof Date)){const t={};for(const te in Te)Object.prototype.hasOwnProperty.call(Te,te)&&(t[te]=_deconstructPacket(Te[te],we));return t}return Te}function reconstructPacket(Te,we){return Te.data=_reconstructPacket(Te.data,we),delete Te.attachments,Te}function _reconstructPacket(Te,we){if(!Te)return Te;if(Te&&Te._placeholder===!0){if(typeof Te.num=="number"&&Te.num>=0&&Te.num<we.length)return we[Te.num];throw new Error("illegal attachments")}else if(Array.isArray(Te))for(let t=0;t<Te.length;t++)Te[t]=_reconstructPacket(Te[t],we);else if(typeof Te=="object")for(const t in Te)Object.prototype.hasOwnProperty.call(Te,t)&&(Te[t]=_reconstructPacket(Te[t],we));return Te}const RESERVED_EVENTS$1=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"],protocol=5;var PacketType;(function(Te){Te[Te.CONNECT=0]="CONNECT",Te[Te.DISCONNECT=1]="DISCONNECT",Te[Te.EVENT=2]="EVENT",Te[Te.ACK=3]="ACK",Te[Te.CONNECT_ERROR=4]="CONNECT_ERROR",Te[Te.BINARY_EVENT=5]="BINARY_EVENT",Te[Te.BINARY_ACK=6]="BINARY_ACK"})(PacketType||(PacketType={}));let Encoder$1=class{constructor(we){this.replacer=we}encode(we){return(we.type===PacketType.EVENT||we.type===PacketType.ACK)&&hasBinary(we)?this.encodeAsBinary({type:we.type===PacketType.EVENT?PacketType.BINARY_EVENT:PacketType.BINARY_ACK,nsp:we.nsp,data:we.data,id:we.id}):[this.encodeAsString(we)]}encodeAsString(we){let t=""+we.type;return(we.type===PacketType.BINARY_EVENT||we.type===PacketType.BINARY_ACK)&&(t+=we.attachments+"-"),we.nsp&&we.nsp!=="/"&&(t+=we.nsp+","),we.id!=null&&(t+=we.id),we.data!=null&&(t+=JSON.stringify(we.data,this.replacer)),t}encodeAsBinary(we){const t=deconstructPacket(we),te=this.encodeAsString(t.packet),be=t.buffers;return be.unshift(te),be}};function isObject(Te){return Object.prototype.toString.call(Te)==="[object Object]"}let Decoder$1=class p0 extends Emitter{constructor(we){super(),this.reviver=we}add(we){let t;if(typeof we=="string"){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");t=this.decodeString(we);const te=t.type===PacketType.BINARY_EVENT;te||t.type===PacketType.BINARY_ACK?(t.type=te?PacketType.EVENT:PacketType.ACK,this.reconstructor=new BinaryReconstructor(t),t.attachments===0&&super.emitReserved("decoded",t)):super.emitReserved("decoded",t)}else if(isBinary(we)||we.base64)if(this.reconstructor)t=this.reconstructor.takeBinaryData(we),t&&(this.reconstructor=null,super.emitReserved("decoded",t));else throw new Error("got binary data when not reconstructing a packet");else throw new Error("Unknown type: "+we)}decodeString(we){let t=0;const te={type:Number(we.charAt(0))};if(PacketType[te.type]===void 0)throw new Error("unknown packet type "+te.type);if(te.type===PacketType.BINARY_EVENT||te.type===PacketType.BINARY_ACK){const xe=t+1;for(;we.charAt(++t)!=="-"&&t!=we.length;);const ve=we.substring(xe,t);if(ve!=Number(ve)||we.charAt(t)!=="-")throw new Error("Illegal attachments");te.attachments=Number(ve)}if(we.charAt(t+1)==="/"){const xe=t+1;for(;++t&&!(we.charAt(t)===","||t===we.length););te.nsp=we.substring(xe,t)}else te.nsp="/";const be=we.charAt(t+1);if(be!==""&&Number(be)==be){const xe=t+1;for(;++t;){const ve=we.charAt(t);if(ve==null||Number(ve)!=ve){--t;break}if(t===we.length)break}te.id=Number(we.substring(xe,t+1))}if(we.charAt(++t)){const xe=this.tryParse(we.substr(t));if(p0.isPayloadValid(te.type,xe))te.data=xe;else throw new Error("invalid payload")}return te}tryParse(we){try{return JSON.parse(we,this.reviver)}catch{return!1}}static isPayloadValid(we,t){switch(we){case PacketType.CONNECT:return isObject(t);case PacketType.DISCONNECT:return t===void 0;case PacketType.CONNECT_ERROR:return typeof t=="string"||isObject(t);case PacketType.EVENT:case PacketType.BINARY_EVENT:return Array.isArray(t)&&(typeof t[0]=="number"||typeof t[0]=="string"&&RESERVED_EVENTS$1.indexOf(t[0])===-1);case PacketType.ACK:case PacketType.BINARY_ACK:return Array.isArray(t)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}};class BinaryReconstructor{constructor(we){this.packet=we,this.buffers=[],this.reconPack=we}takeBinaryData(we){if(this.buffers.push(we),this.buffers.length===this.reconPack.attachments){const t=reconstructPacket(this.reconPack,this.buffers);return this.finishedReconstruction(),t}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}const parser=Object.freeze(Object.defineProperty({__proto__:null,Decoder:Decoder$1,Encoder:Encoder$1,get PacketType(){return PacketType},protocol},Symbol.toStringTag,{value:"Module"}));function on(Te,we,t){return Te.on(we,t),function(){Te.off(we,t)}}const RESERVED_EVENTS=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class Socket extends Emitter{constructor(we,t,te){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=we,this.nsp=t,te&&te.auth&&(this.auth=te.auth),this._opts=Object.assign({},te),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const we=this.io;this.subs=[on(we,"open",this.onopen.bind(this)),on(we,"packet",this.onpacket.bind(this)),on(we,"error",this.onerror.bind(this)),on(we,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected?this:(this.subEvents(),this.io._reconnecting||this.io.open(),this.io._readyState==="open"&&this.onopen(),this)}open(){return this.connect()}send(...we){return we.unshift("message"),this.emit.apply(this,we),this}emit(we,...t){if(RESERVED_EVENTS.hasOwnProperty(we))throw new Error('"'+we.toString()+'" is a reserved event name');if(t.unshift(we),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(t),this;const te={type:PacketType.EVENT,data:t};if(te.options={},te.options.compress=this.flags.compress!==!1,typeof t[t.length-1]=="function"){const ve=this.ids++,ke=t.pop();this._registerAckCallback(ve,ke),te.id=ve}const be=this.io.engine&&this.io.engine.transport&&this.io.engine.transport.writable;return this.flags.volatile&&(!be||!this.connected)||(this.connected?(this.notifyOutgoingListeners(te),this.packet(te)):this.sendBuffer.push(te)),this.flags={},this}_registerAckCallback(we,t){var te;const be=(te=this.flags.timeout)!==null&&te!==void 0?te:this._opts.ackTimeout;if(be===void 0){this.acks[we]=t;return}const xe=this.io.setTimeoutFn(()=>{delete this.acks[we];for(let ve=0;ve<this.sendBuffer.length;ve++)this.sendBuffer[ve].id===we&&this.sendBuffer.splice(ve,1);t.call(this,new Error("operation has timed out"))},be);this.acks[we]=(...ve)=>{this.io.clearTimeoutFn(xe),t.apply(this,[null,...ve])}}emitWithAck(we,...t){const te=this.flags.timeout!==void 0||this._opts.ackTimeout!==void 0;return new Promise((be,xe)=>{t.push((ve,ke)=>te?ve?xe(ve):be(ke):be(ve)),this.emit(we,...t)})}_addToQueue(we){let t;typeof we[we.length-1]=="function"&&(t=we.pop());const te={id:this._queueSeq++,tryCount:0,pending:!1,args:we,flags:Object.assign({fromQueue:!0},this.flags)};we.push((be,...xe)=>te!==this._queue[0]?void 0:(be!==null?te.tryCount>this._opts.retries&&(this._queue.shift(),t&&t(be)):(this._queue.shift(),t&&t(null,...xe)),te.pending=!1,this._drainQueue())),this._queue.push(te),this._drainQueue()}_drainQueue(we=!1){if(!this.connected||this._queue.length===0)return;const t=this._queue[0];t.pending&&!we||(t.pending=!0,t.tryCount++,this.flags=t.flags,this.emit.apply(this,t.args))}packet(we){we.nsp=this.nsp,this.io._packet(we)}onopen(){typeof this.auth=="function"?this.auth(we=>{this._sendConnectPacket(we)}):this._sendConnectPacket(this.auth)}_sendConnectPacket(we){this.packet({type:PacketType.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},we):we})}onerror(we){this.connected||this.emitReserved("connect_error",we)}onclose(we,t){this.connected=!1,delete this.id,this.emitReserved("disconnect",we,t)}onpacket(we){if(we.nsp===this.nsp)switch(we.type){case PacketType.CONNECT:we.data&&we.data.sid?this.onconnect(we.data.sid,we.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case PacketType.EVENT:case PacketType.BINARY_EVENT:this.onevent(we);break;case PacketType.ACK:case PacketType.BINARY_ACK:this.onack(we);break;case PacketType.DISCONNECT:this.ondisconnect();break;case PacketType.CONNECT_ERROR:this.destroy();const te=new Error(we.data.message);te.data=we.data.data,this.emitReserved("connect_error",te);break}}onevent(we){const t=we.data||[];we.id!=null&&t.push(this.ack(we.id)),this.connected?this.emitEvent(t):this.receiveBuffer.push(Object.freeze(t))}emitEvent(we){if(this._anyListeners&&this._anyListeners.length){const t=this._anyListeners.slice();for(const te of t)te.apply(this,we)}super.emit.apply(this,we),this._pid&&we.length&&typeof we[we.length-1]=="string"&&(this._lastOffset=we[we.length-1])}ack(we){const t=this;let te=!1;return function(...be){te||(te=!0,t.packet({type:PacketType.ACK,id:we,data:be}))}}onack(we){const t=this.acks[we.id];typeof t=="function"&&(t.apply(this,we.data),delete this.acks[we.id])}onconnect(we,t){this.id=we,this.recovered=t&&this._pid===t,this._pid=t,this.connected=!0,this.emitBuffered(),this.emitReserved("connect"),this._drainQueue(!0)}emitBuffered(){this.receiveBuffer.forEach(we=>this.emitEvent(we)),this.receiveBuffer=[],this.sendBuffer.forEach(we=>{this.notifyOutgoingListeners(we),this.packet(we)}),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(we=>we()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:PacketType.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(we){return this.flags.compress=we,this}get volatile(){return this.flags.volatile=!0,this}timeout(we){return this.flags.timeout=we,this}onAny(we){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(we),this}prependAny(we){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(we),this}offAny(we){if(!this._anyListeners)return this;if(we){const t=this._anyListeners;for(let te=0;te<t.length;te++)if(we===t[te])return t.splice(te,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(we){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(we),this}prependAnyOutgoing(we){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(we),this}offAnyOutgoing(we){if(!this._anyOutgoingListeners)return this;if(we){const t=this._anyOutgoingListeners;for(let te=0;te<t.length;te++)if(we===t[te])return t.splice(te,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(we){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const t=this._anyOutgoingListeners.slice();for(const te of t)te.apply(this,we.data)}}}function Backoff(Te){Te=Te||{},this.ms=Te.min||100,this.max=Te.max||1e4,this.factor=Te.factor||2,this.jitter=Te.jitter>0&&Te.jitter<=1?Te.jitter:0,this.attempts=0}Backoff.prototype.duration=function(){var Te=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var we=Math.random(),t=Math.floor(we*this.jitter*Te);Te=Math.floor(we*10)&1?Te+t:Te-t}return Math.min(Te,this.max)|0};Backoff.prototype.reset=function(){this.attempts=0};Backoff.prototype.setMin=function(Te){this.ms=Te};Backoff.prototype.setMax=function(Te){this.max=Te};Backoff.prototype.setJitter=function(Te){this.jitter=Te};class Manager extends Emitter{constructor(we,t){var te;super(),this.nsps={},this.subs=[],we&&typeof we=="object"&&(t=we,we=void 0),t=t||{},t.path=t.path||"/socket.io",this.opts=t,installTimerFunctions(this,t),this.reconnection(t.reconnection!==!1),this.reconnectionAttempts(t.reconnectionAttempts||1/0),this.reconnectionDelay(t.reconnectionDelay||1e3),this.reconnectionDelayMax(t.reconnectionDelayMax||5e3),this.randomizationFactor((te=t.randomizationFactor)!==null&&te!==void 0?te:.5),this.backoff=new Backoff({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(t.timeout==null?2e4:t.timeout),this._readyState="closed",this.uri=we;const be=t.parser||parser;this.encoder=new be.Encoder,this.decoder=new be.Decoder,this._autoConnect=t.autoConnect!==!1,this._autoConnect&&this.open()}reconnection(we){return arguments.length?(this._reconnection=!!we,this):this._reconnection}reconnectionAttempts(we){return we===void 0?this._reconnectionAttempts:(this._reconnectionAttempts=we,this)}reconnectionDelay(we){var t;return we===void 0?this._reconnectionDelay:(this._reconnectionDelay=we,(t=this.backoff)===null||t===void 0||t.setMin(we),this)}randomizationFactor(we){var t;return we===void 0?this._randomizationFactor:(this._randomizationFactor=we,(t=this.backoff)===null||t===void 0||t.setJitter(we),this)}reconnectionDelayMax(we){var t;return we===void 0?this._reconnectionDelayMax:(this._reconnectionDelayMax=we,(t=this.backoff)===null||t===void 0||t.setMax(we),this)}timeout(we){return arguments.length?(this._timeout=we,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&this.backoff.attempts===0&&this.reconnect()}open(we){if(~this._readyState.indexOf("open"))return this;this.engine=new Socket$1(this.uri,this.opts);const t=this.engine,te=this;this._readyState="opening",this.skipReconnect=!1;const be=on(t,"open",function(){te.onopen(),we&&we()}),xe=ke=>{this.cleanup(),this._readyState="closed",this.emitReserved("error",ke),we?we(ke):this.maybeReconnectOnOpen()},ve=on(t,"error",xe);if(this._timeout!==!1){const ke=this._timeout,Ie=this.setTimeoutFn(()=>{be(),xe(new Error("timeout")),t.close()},ke);this.opts.autoUnref&&Ie.unref(),this.subs.push(()=>{this.clearTimeoutFn(Ie)})}return this.subs.push(be),this.subs.push(ve),this}connect(we){return this.open(we)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const we=this.engine;this.subs.push(on(we,"ping",this.onping.bind(this)),on(we,"data",this.ondata.bind(this)),on(we,"error",this.onerror.bind(this)),on(we,"close",this.onclose.bind(this)),on(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(we){try{this.decoder.add(we)}catch(t){this.onclose("parse error",t)}}ondecoded(we){nextTick(()=>{this.emitReserved("packet",we)},this.setTimeoutFn)}onerror(we){this.emitReserved("error",we)}socket(we,t){let te=this.nsps[we];return te?this._autoConnect&&!te.active&&te.connect():(te=new Socket(this,we,t),this.nsps[we]=te),te}_destroy(we){const t=Object.keys(this.nsps);for(const te of t)if(this.nsps[te].active)return;this._close()}_packet(we){const t=this.encoder.encode(we);for(let te=0;te<t.length;te++)this.engine.write(t[te],we.options)}cleanup(){this.subs.forEach(we=>we()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close"),this.engine&&this.engine.close()}disconnect(){return this._close()}onclose(we,t){this.cleanup(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",we,t),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const we=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const t=this.backoff.duration();this._reconnecting=!0;const te=this.setTimeoutFn(()=>{we.skipReconnect||(this.emitReserved("reconnect_attempt",we.backoff.attempts),!we.skipReconnect&&we.open(be=>{be?(we._reconnecting=!1,we.reconnect(),this.emitReserved("reconnect_error",be)):we.onreconnect()}))},t);this.opts.autoUnref&&te.unref(),this.subs.push(()=>{this.clearTimeoutFn(te)})}}onreconnect(){const we=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",we)}}const cache={};function lookup(Te,we){typeof Te=="object"&&(we=Te,Te=void 0),we=we||{};const t=url(Te,we.path||"/socket.io"),te=t.source,be=t.id,xe=t.path,ve=cache[be]&&xe in cache[be].nsps,ke=we.forceNew||we["force new connection"]||we.multiplex===!1||ve;let Ie;return ke?Ie=new Manager(te,we):(cache[be]||(cache[be]=new Manager(te,we)),Ie=cache[be]),t.query&&!we.query&&(we.query=t.queryKey),Ie.socket(t.path,we)}Object.assign(lookup,{Manager,Socket,io:lookup,connect:lookup});var requiresPort=function Te(we,t){if(t=t.split(":")[0],we=+we,!we)return!1;switch(t){case"http":case"ws":return we!==80;case"https":case"wss":return we!==443;case"ftp":return we!==21;case"gopher":return we!==70;case"file":return!1}return we!==0},querystringify$1={},has=Object.prototype.hasOwnProperty,undef;function decode(Te){try{return decodeURIComponent(Te.replace(/\+/g," "))}catch{return null}}function encode(Te){try{return encodeURIComponent(Te)}catch{return null}}function querystring(Te){for(var we=/([^=?#&]+)=?([^&]*)/g,t={},te;te=we.exec(Te);){var be=decode(te[1]),xe=decode(te[2]);be===null||xe===null||be in t||(t[be]=xe)}return t}function querystringify(Te,we){we=we||"";var t=[],te,be;typeof we!="string"&&(we="?");for(be in Te)if(has.call(Te,be)){if(te=Te[be],!te&&(te===null||te===undef||isNaN(te))&&(te=""),be=encode(be),te=encode(te),be===null||te===null)continue;t.push(be+"="+te)}return t.length?we+t.join("&"):""}querystringify$1.stringify=querystringify;querystringify$1.parse=querystring;var required=requiresPort,qs=querystringify$1,controlOrWhitespace=/^[\x00-\x20\u00a0\u1680\u2000-\u200a\u2028\u2029\u202f\u205f\u3000\ufeff]+/,CRHTLF=/[\n\r\t]/g,slashes=/^[A-Za-z][A-Za-z0-9+-.]*:\/\//,port=/:\d+$/,protocolre=/^([a-z][a-z0-9.+-]*:)?(\/\/)?([\\/]+)?([\S\s]*)/i,windowsDriveLetter=/^[a-zA-Z]:/;function trimLeft(Te){return(Te||"").toString().replace(controlOrWhitespace,"")}var rules=[["#","hash"],["?","query"],function Te(we,t){return isSpecial(t.protocol)?we.replace(/\\/g,"/"):we},["/","pathname"],["@","auth",1],[NaN,"host",void 0,1,1],[/:(\d*)$/,"port",void 0,1],[NaN,"hostname",void 0,1,1]],ignore={hash:1,query:1};function lolcation(Te){var we;typeof window<"u"?we=window:typeof commonjsGlobal<"u"?we=commonjsGlobal:typeof self<"u"?we=self:we={};var t=we.location||{};Te=Te||t;var te={},be=typeof Te,xe;if(Te.protocol==="blob:")te=new Url(unescape(Te.pathname),{});else if(be==="string"){te=new Url(Te,{});for(xe in ignore)delete te[xe]}else if(be==="object"){for(xe in Te)xe in ignore||(te[xe]=Te[xe]);te.slashes===void 0&&(te.slashes=slashes.test(Te.href))}return te}function isSpecial(Te){return Te==="file:"||Te==="ftp:"||Te==="http:"||Te==="https:"||Te==="ws:"||Te==="wss:"}function extractProtocol(Te,we){Te=trimLeft(Te),Te=Te.replace(CRHTLF,""),we=we||{};var t=protocolre.exec(Te),te=t[1]?t[1].toLowerCase():"",be=!!t[2],xe=!!t[3],ve=0,ke;return be?xe?(ke=t[2]+t[3]+t[4],ve=t[2].length+t[3].length):(ke=t[2]+t[4],ve=t[2].length):xe?(ke=t[3]+t[4],ve=t[3].length):ke=t[4],te==="file:"?ve>=2&&(ke=ke.slice(2)):isSpecial(te)?ke=t[4]:te?be&&(ke=ke.slice(2)):ve>=2&&isSpecial(we.protocol)&&(ke=t[4]),{protocol:te,slashes:be||isSpecial(te),slashesCount:ve,rest:ke}}function resolve(Te,we){if(Te==="")return we;for(var t=(we||"/").split("/").slice(0,-1).concat(Te.split("/")),te=t.length,be=t[te-1],xe=!1,ve=0;te--;)t[te]==="."?t.splice(te,1):t[te]===".."?(t.splice(te,1),ve++):ve&&(te===0&&(xe=!0),t.splice(te,1),ve--);return xe&&t.unshift(""),(be==="."||be==="..")&&t.push(""),t.join("/")}function Url(Te,we,t){if(Te=trimLeft(Te),Te=Te.replace(CRHTLF,""),!(this instanceof Url))return new Url(Te,we,t);var te,be,xe,ve,ke,Ie,Ae=rules.slice(),Se=typeof we,Oe=this,Ve=0;for(Se!=="object"&&Se!=="string"&&(t=we,we=null),t&&typeof t!="function"&&(t=qs.parse),we=lolcation(we),be=extractProtocol(Te||"",we),te=!be.protocol&&!be.slashes,Oe.slashes=be.slashes||te&&we.slashes,Oe.protocol=be.protocol||we.protocol||"",Te=be.rest,(be.protocol==="file:"&&(be.slashesCount!==2||windowsDriveLetter.test(Te))||!be.slashes&&(be.protocol||be.slashesCount<2||!isSpecial(Oe.protocol)))&&(Ae[3]=[/(.*)/,"pathname"]);Ve<Ae.length;Ve++){if(ve=Ae[Ve],typeof ve=="function"){Te=ve(Te,Oe);continue}xe=ve[0],Ie=ve[1],xe!==xe?Oe[Ie]=Te:typeof xe=="string"?(ke=xe==="@"?Te.lastIndexOf(xe):Te.indexOf(xe),~ke&&(typeof ve[2]=="number"?(Oe[Ie]=Te.slice(0,ke),Te=Te.slice(ke+ve[2])):(Oe[Ie]=Te.slice(ke),Te=Te.slice(0,ke)))):(ke=xe.exec(Te))&&(Oe[Ie]=ke[1],Te=Te.slice(0,ke.index)),Oe[Ie]=Oe[Ie]||te&&ve[3]&&we[Ie]||"",ve[4]&&(Oe[Ie]=Oe[Ie].toLowerCase())}t&&(Oe.query=t(Oe.query)),te&&we.slashes&&Oe.pathname.charAt(0)!=="/"&&(Oe.pathname!==""||we.pathname!=="")&&(Oe.pathname=resolve(Oe.pathname,we.pathname)),Oe.pathname.charAt(0)!=="/"&&isSpecial(Oe.protocol)&&(Oe.pathname="/"+Oe.pathname),required(Oe.port,Oe.protocol)||(Oe.host=Oe.hostname,Oe.port=""),Oe.username=Oe.password="",Oe.auth&&(ke=Oe.auth.indexOf(":"),~ke?(Oe.username=Oe.auth.slice(0,ke),Oe.username=encodeURIComponent(decodeURIComponent(Oe.username)),Oe.password=Oe.auth.slice(ke+1),Oe.password=encodeURIComponent(decodeURIComponent(Oe.password))):Oe.username=encodeURIComponent(decodeURIComponent(Oe.auth)),Oe.auth=Oe.password?Oe.username+":"+Oe.password:Oe.username),Oe.origin=Oe.protocol!=="file:"&&isSpecial(Oe.protocol)&&Oe.host?Oe.protocol+"//"+Oe.host:"null",Oe.href=Oe.toString()}function set(Te,we,t){var te=this;switch(Te){case"query":typeof we=="string"&&we.length&&(we=(t||qs.parse)(we)),te[Te]=we;break;case"port":te[Te]=we,required(we,te.protocol)?we&&(te.host=te.hostname+":"+we):(te.host=te.hostname,te[Te]="");break;case"hostname":te[Te]=we,te.port&&(we+=":"+te.port),te.host=we;break;case"host":te[Te]=we,port.test(we)?(we=we.split(":"),te.port=we.pop(),te.hostname=we.join(":")):(te.hostname=we,te.port="");break;case"protocol":te.protocol=we.toLowerCase(),te.slashes=!t;break;case"pathname":case"hash":if(we){var be=Te==="pathname"?"/":"#";te[Te]=we.charAt(0)!==be?be+we:we}else te[Te]=we;break;case"username":case"password":te[Te]=encodeURIComponent(we);break;case"auth":var xe=we.indexOf(":");~xe?(te.username=we.slice(0,xe),te.username=encodeURIComponent(decodeURIComponent(te.username)),te.password=we.slice(xe+1),te.password=encodeURIComponent(decodeURIComponent(te.password))):te.username=encodeURIComponent(decodeURIComponent(we))}for(var ve=0;ve<rules.length;ve++){var ke=rules[ve];ke[4]&&(te[ke[1]]=te[ke[1]].toLowerCase())}return te.auth=te.password?te.username+":"+te.password:te.username,te.origin=te.protocol!=="file:"&&isSpecial(te.protocol)&&te.host?te.protocol+"//"+te.host:"null",te.href=te.toString(),te}function toString(Te){(!Te||typeof Te!="function")&&(Te=qs.stringify);var we,t=this,te=t.host,be=t.protocol;be&&be.charAt(be.length-1)!==":"&&(be+=":");var xe=be+(t.protocol&&t.slashes||isSpecial(t.protocol)?"//":"");return t.username?(xe+=t.username,t.password&&(xe+=":"+t.password),xe+="@"):t.password?(xe+=":"+t.password,xe+="@"):t.protocol!=="file:"&&isSpecial(t.protocol)&&!te&&t.pathname!=="/"&&(xe+="@"),(te[te.length-1]===":"||port.test(t.hostname)&&!t.port)&&(te+=":"),xe+=te+t.pathname,we=typeof t.query=="object"?Te(t.query):t.query,we&&(xe+=we.charAt(0)!=="?"?"?"+we:we),t.hash&&(xe+=t.hash),xe}Url.prototype={set,toString};Url.extractProtocol=extractProtocol;Url.location=lolcation;Url.trimLeft=trimLeft;Url.qs=qs;var urlParse=Url;const _0x37c066=getDefaultExportFromCjs(urlParse);class Descriptor{constructor(...we){}}Re(Descriptor,"DESCRIPTOR_NAME"),Re(Descriptor,"DESCRIPTOR");class Message extends Descriptor{constructor(...we){super()}static fromJSON(we){throw new TypeError("Must be implemented in a child class!")}}Re(Message,"TYPE","1000"),Re(Message,"READABLE_TYPE_NAME");const On=class On extends Message{constructor(t){super();Re(this,"id");this.id=t}toJSON(){return{id:this.id}}static fromJSON(t){return new On(t.id)}};Re(On,"TYPE","21"),Re(On,"READABLE_TYPE_NAME","getUser"),Re(On,"DESCRIPTOR_NAME","GetUserMessage"),Re(On,"DESCRIPTOR",{fields:{id:{type:"string",id:1}}});let GetUserMessage=On;const Hi=class Hi extends Message{constructor(t){super();Re(this,"attributes");this.attributes=t}toJSON(){return{attributes:Object.keys(this.attributes).map(t=>({key:t,value:JSON.stringify(this.attributes[t])}))}}static fromJSON(t){const te=t.attributes.reduce((be,xe)=>(be[xe.key]=xe.value?JSON.parse(xe.value):null,be),{});return new Hi(te)}};Re(Hi,"DESCRIPTOR_NAME","GetUserResponse"),Re(Hi,"DESCRIPTOR",{fields:{attributes:{rule:"repeated",type:"KeyValueDescriptor",id:1}}});let GetUserResponse=Hi;const messages=(()=>{var Te=_0x462d7f.Reader,we=_0x462d7f.Writer,t=_0x462d7f.util,te=_0x462d7f.roots.default||(_0x462d7f.roots.default={});return te.OperationMetadataDescriptor=function(){function be(xe){if(xe)for(var ve=Object.keys(xe),ke=0;ke<ve.length;++ke)xe[ve[ke]]!=null&&(this[ve[ke]]=xe[ve[ke]])}return be.prototype.userId="",be.prototype.type="",be.prototype.createdAt="",be.create=function(xe){return new be(xe)},be.encode=function(xe,ve){return ve||(ve=we.create()),xe.userId!=null&&Object.hasOwnProperty.call(xe,"userId")&&ve.uint32(10).string(xe.userId),xe.type!=null&&Object.hasOwnProperty.call(xe,"type")&&ve.uint32(18).string(xe.type),xe.createdAt!=null&&Object.hasOwnProperty.call(xe,"createdAt")&&ve.uint32(26).string(xe.createdAt),ve},be.encodeDelimited=function(xe,ve){return this.encode(xe,ve).ldelim()},be.decode=function(xe,ve){xe instanceof Te||(xe=Te.create(xe));for(var ke=ve===void 0?xe.len:xe.pos+ve,Ie=new te.OperationMetadataDescriptor;xe.pos<ke;){var Ae=xe.uint32();switch(Ae>>>3){case 1:Ie.userId=xe.string();break;case 2:Ie.type=xe.string();break;case 3:Ie.createdAt=xe.string();break;default:xe.skipType(7&Ae)}}return Ie},be.decodeDelimited=function(xe){return xe instanceof Te||(xe=new Te(xe)),this.decode(xe,xe.uint32())},be.verify=function(xe){return typeof xe!="object"||xe===null?"object expected":xe.userId!=null&&xe.hasOwnProperty("userId")&&!t.isString(xe.userId)?"userId: string expected":xe.type!=null&&xe.hasOwnProperty("type")&&!t.isString(xe.type)?"type: string expected":xe.createdAt!=null&&xe.hasOwnProperty("createdAt")&&!t.isString(xe.createdAt)?"createdAt: string expected":null},be.fromObject=function(xe){if(xe instanceof te.OperationMetadataDescriptor)return xe;var ve=new te.OperationMetadataDescriptor;return xe.userId!=null&&(ve.userId=String(xe.userId)),xe.type!=null&&(ve.type=String(xe.type)),xe.createdAt!=null&&(ve.createdAt=String(xe.createdAt)),ve},be.toObject=function(xe,ve){ve||(ve={});var ke={};return ve.defaults&&(ke.userId="",ke.type="",ke.createdAt=""),xe.userId!=null&&xe.hasOwnProperty("userId")&&(ke.userId=xe.userId),xe.type!=null&&xe.hasOwnProperty("type")&&(ke.type=xe.type),xe.createdAt!=null&&xe.hasOwnProperty("createdAt")&&(ke.createdAt=xe.createdAt),ke},be.prototype.toJSON=function(){return this.constructor.toObject(this,_0x462d7f.util.toJSONOptions)},be.getTypeUrl=function(xe){return xe===void 0&&(xe="type.googleapis.com"),xe+"/OperationMetadataDescriptor"},be}(),te.CollaborativeEditingConnectMessage=function(){function be(xe){if(this.buffers=[],this.types=[],xe)for(var ve=Object.keys(xe),ke=0;ke<ve.length;++ke)xe[ve[ke]]!=null&&(this[ve[ke]]=xe[ve[ke]])}return be.prototype.id="",be.prototype.bundleVersion="",be.prototype.buffers=t.emptyArray,be.prototype.types=t.emptyArray,be.prototype.lastOperationId="",be.create=function(xe){return new be(xe)},be.encode=function(xe,ve){if(ve||(ve=we.create()),xe.id!=null&&Object.hasOwnProperty.call(xe,"id")&&ve.uint32(10).string(xe.id),xe.bundleVersion!=null&&Object.hasOwnProperty.call(xe,"bundleVersion")&&ve.uint32(18).string(xe.bundleVersion),xe.buffers!=null&&xe.buffers.length)for(var ke=0;ke<xe.buffers.length;++ke)ve.uint32(26).bytes(xe.buffers[ke]);if(xe.types!=null&&xe.types.length){for(ve.uint32(34).fork(),ke=0;ke<xe.types.length;++ke)ve.uint32(xe.types[ke]);ve.ldelim()}return xe.lastOperationId!=null&&Object.hasOwnProperty.call(xe,"lastOperationId")&&ve.uint32(42).string(xe.lastOperationId),ve},be.encodeDelimited=function(xe,ve){return this.encode(xe,ve).ldelim()},be.decode=function(xe,ve){xe instanceof Te||(xe=Te.create(xe));for(var ke=ve===void 0?xe.len:xe.pos+ve,Ie=new te.CollaborativeEditingConnectMessage;xe.pos<ke;){var Ae=xe.uint32();switch(Ae>>>3){case 1:Ie.id=xe.string();break;case 2:Ie.bundleVersion=xe.string();break;case 3:Ie.buffers&&Ie.buffers.length||(Ie.buffers=[]),Ie.buffers.push(xe.bytes());break;case 4:if(Ie.types&&Ie.types.length||(Ie.types=[]),(7&Ae)==2)for(var Se=xe.uint32()+xe.pos;xe.pos<Se;)Ie.types.push(xe.uint32());else Ie.types.push(xe.uint32());break;case 5:Ie.lastOperationId=xe.string();break;default:xe.skipType(7&Ae)}}return Ie},be.decodeDelimited=function(xe){return xe instanceof Te||(xe=new Te(xe)),this.decode(xe,xe.uint32())},be.verify=function(xe){if(typeof xe!="object"||xe===null)return"object expected";if(xe.id!=null&&xe.hasOwnProperty("id")&&!t.isString(xe.id))return"id: string expected";if(xe.bundleVersion!=null&&xe.hasOwnProperty("bundleVersion")&&!t.isString(xe.bundleVersion))return"bundleVersion: string expected";if(xe.buffers!=null&&xe.hasOwnProperty("buffers")){if(!Array.isArray(xe.buffers))return"buffers: array expected";for(var ve=0;ve<xe.buffers.length;++ve)if(!(xe.buffers[ve]&&typeof xe.buffers[ve].length=="number"||t.isString(xe.buffers[ve])))return"buffers: buffer[] expected"}if(xe.types!=null&&xe.hasOwnProperty("types")){if(!Array.isArray(xe.types))return"types: array expected";for(ve=0;ve<xe.types.length;++ve)if(!t.isInteger(xe.types[ve]))return"types: integer[] expected"}return xe.lastOperationId!=null&&xe.hasOwnProperty("lastOperationId")&&!t.isString(xe.lastOperationId)?"lastOperationId: string expected":null},be.fromObject=function(xe){if(xe instanceof te.CollaborativeEditingConnectMessage)return xe;var ve=new te.CollaborativeEditingConnectMessage;if(xe.id!=null&&(ve.id=String(xe.id)),xe.bundleVersion!=null&&(ve.bundleVersion=String(xe.bundleVersion)),xe.buffers){if(!Array.isArray(xe.buffers))throw TypeError(".CollaborativeEditingConnectMessage.buffers: array expected");ve.buffers=[];for(var ke=0;ke<xe.buffers.length;++ke)typeof xe.buffers[ke]=="string"?t.base64.decode(xe.buffers[ke],ve.buffers[ke]=t.newBuffer(t.base64.length(xe.buffers[ke])),0):xe.buffers[ke].length>=0&&(ve.buffers[ke]=xe.buffers[ke])}if(xe.types){if(!Array.isArray(xe.types))throw TypeError(".CollaborativeEditingConnectMessage.types: array expected");for(ve.types=[],ke=0;ke<xe.types.length;++ke)ve.types[ke]=xe.types[ke]>>>0}return xe.lastOperationId!=null&&(ve.lastOperationId=String(xe.lastOperationId)),ve},be.toObject=function(xe,ve){ve||(ve={});var ke={};if((ve.arrays||ve.defaults)&&(ke.buffers=[],ke.types=[]),ve.defaults&&(ke.id="",ke.bundleVersion="",ke.lastOperationId=""),xe.id!=null&&xe.hasOwnProperty("id")&&(ke.id=xe.id),xe.bundleVersion!=null&&xe.hasOwnProperty("bundleVersion")&&(ke.bundleVersion=xe.bundleVersion),xe.buffers&&xe.buffers.length){ke.buffers=[];for(var Ie=0;Ie<xe.buffers.length;++Ie)ke.buffers[Ie]=ve.bytes===String?t.base64.encode(xe.buffers[Ie],0,xe.buffers[Ie].length):ve.bytes===Array?Array.prototype.slice.call(xe.buffers[Ie]):xe.buffers[Ie]}if(xe.types&&xe.types.length)for(ke.types=[],Ie=0;Ie<xe.types.length;++Ie)ke.types[Ie]=xe.types[Ie];return xe.lastOperationId!=null&&xe.hasOwnProperty("lastOperationId")&&(ke.lastOperationId=xe.lastOperationId),ke},be.prototype.toJSON=function(){return this.constructor.toObject(this,_0x462d7f.util.toJSONOptions)},be.getTypeUrl=function(xe){return xe===void 0&&(xe="type.googleapis.com"),xe+"/CollaborativeEditingConnectMessage"},be}(),te.CollaborativeEditingReconnectMessage=function(){function be(xe){if(xe)for(var ve=Object.keys(xe),ke=0;ke<ve.length;++ke)xe[ve[ke]]!=null&&(this[ve[ke]]=xe[ve[ke]])}return be.prototype.id="",be.prototype.bundleVersion="",be.prototype.lastKnowVersion=0,be.create=function(xe){return new be(xe)},be.encode=function(xe,ve){return ve||(ve=we.create()),xe.id!=null&&Object.hasOwnProperty.call(xe,"id")&&ve.uint32(10).string(xe.id),xe.bundleVersion!=null&&Object.hasOwnProperty.call(xe,"bundleVersion")&&ve.uint32(18).string(xe.bundleVersion),xe.lastKnowVersion!=null&&Object.hasOwnProperty.call(xe,"lastKnowVersion")&&ve.uint32(24).uint32(xe.lastKnowVersion),ve},be.encodeDelimited=function(xe,ve){return this.encode(xe,ve).ldelim()},be.decode=function(xe,ve){xe instanceof Te||(xe=Te.create(xe));for(var ke=ve===void 0?xe.len:xe.pos+ve,Ie=new te.CollaborativeEditingReconnectMessage;xe.pos<ke;){var Ae=xe.uint32();switch(Ae>>>3){case 1:Ie.id=xe.string();break;case 2:Ie.bundleVersion=xe.string();break;case 3:Ie.lastKnowVersion=xe.uint32();break;default:xe.skipType(7&Ae)}}return Ie},be.decodeDelimited=function(xe){return xe instanceof Te||(xe=new Te(xe)),this.decode(xe,xe.uint32())},be.verify=function(xe){return typeof xe!="object"||xe===null?"object expected":xe.id!=null&&xe.hasOwnProperty("id")&&!t.isString(xe.id)?"id: string expected":xe.bundleVersion!=null&&xe.hasOwnProperty("bundleVersion")&&!t.isString(xe.bundleVersion)?"bundleVersion: string expected":xe.lastKnowVersion!=null&&xe.hasOwnProperty("lastKnowVersion")&&!t.isInteger(xe.lastKnowVersion)?"lastKnowVersion: integer expected":null},be.fromObject=function(xe){if(xe instanceof te.CollaborativeEditingReconnectMessage)return xe;var ve=new te.CollaborativeEditingReconnectMessage;return xe.id!=null&&(ve.id=String(xe.id)),xe.bundleVersion!=null&&(ve.bundleVersion=String(xe.bundleVersion)),xe.lastKnowVersion!=null&&(ve.lastKnowVersion=xe.lastKnowVersion>>>0),ve},be.toObject=function(xe,ve){ve||(ve={});var ke={};return ve.defaults&&(ke.id="",ke.bundleVersion="",ke.lastKnowVersion=0),xe.id!=null&&xe.hasOwnProperty("id")&&(ke.id=xe.id),xe.bundleVersion!=null&&xe.hasOwnProperty("bundleVersion")&&(ke.bundleVersion=xe.bundleVersion),xe.lastKnowVersion!=null&&xe.hasOwnProperty("lastKnowVersion")&&(ke.lastKnowVersion=xe.lastKnowVersion),ke},be.prototype.toJSON=function(){return this.constructor.toObject(this,_0x462d7f.util.toJSONOptions)},be.getTypeUrl=function(xe){return xe===void 0&&(xe="type.googleapis.com"),xe+"/CollaborativeEditingReconnectMessage"},be}(),te.CollaborativeEditingUpdateMessage=function(){function be(xe){if(this.buffers=[],this.types=[],this.metadata=[],xe)for(var ve=Object.keys(xe),ke=0;ke<ve.length;++ke)xe[ve[ke]]!=null&&(this[ve[ke]]=xe[ve[ke]])}return be.prototype.id="",be.prototype.baseVersion=0,be.prototype.buffers=t.emptyArray,be.prototype.types=t.emptyArray,be.prototype.metadata=t.emptyArray,be.prototype.lastOperationId="",be.create=function(xe){return new be(xe)},be.encode=function(xe,ve){if(ve||(ve=we.create()),xe.id!=null&&Object.hasOwnProperty.call(xe,"id")&&ve.uint32(10).string(xe.id),xe.baseVersion!=null&&Object.hasOwnProperty.call(xe,"baseVersion")&&ve.uint32(16).uint32(xe.baseVersion),xe.buffers!=null&&xe.buffers.length)for(var ke=0;ke<xe.buffers.length;++ke)ve.uint32(26).bytes(xe.buffers[ke]);if(xe.types!=null&&xe.types.length){for(ve.uint32(34).fork(),ke=0;ke<xe.types.length;++ke)ve.uint32(xe.types[ke]);ve.ldelim()}if(xe.metadata!=null&&xe.metadata.length)for(ke=0;ke<xe.metadata.length;++ke)te.OperationMetadataDescriptor.encode(xe.metadata[ke],ve.uint32(50).fork()).ldelim();return xe.lastOperationId!=null&&Object.hasOwnProperty.call(xe,"lastOperationId")&&ve.uint32(58).string(xe.lastOperationId),ve},be.encodeDelimited=function(xe,ve){return this.encode(xe,ve).ldelim()},be.decode=function(xe,ve){xe instanceof Te||(xe=Te.create(xe));for(var ke=ve===void 0?xe.len:xe.pos+ve,Ie=new te.CollaborativeEditingUpdateMessage;xe.pos<ke;){var Ae=xe.uint32();switch(Ae>>>3){case 1:Ie.id=xe.string();break;case 2:Ie.baseVersion=xe.uint32();break;case 3:Ie.buffers&&Ie.buffers.length||(Ie.buffers=[]),Ie.buffers.push(xe.bytes());break;case 4:if(Ie.types&&Ie.types.length||(Ie.types=[]),(7&Ae)==2)for(var Se=xe.uint32()+xe.pos;xe.pos<Se;)Ie.types.push(xe.uint32());else Ie.types.push(xe.uint32());break;case 6:Ie.metadata&&Ie.metadata.length||(Ie.metadata=[]),Ie.metadata.push(te.OperationMetadataDescriptor.decode(xe,xe.uint32()));break;case 7:Ie.lastOperationId=xe.string();break;default:xe.skipType(7&Ae)}}return Ie},be.decodeDelimited=function(xe){return xe instanceof Te||(xe=new Te(xe)),this.decode(xe,xe.uint32())},be.verify=function(xe){if(typeof xe!="object"||xe===null)return"object expected";if(xe.id!=null&&xe.hasOwnProperty("id")&&!t.isString(xe.id))return"id: string expected";if(xe.baseVersion!=null&&xe.hasOwnProperty("baseVersion")&&!t.isInteger(xe.baseVersion))return"baseVersion: integer expected";if(xe.buffers!=null&&xe.hasOwnProperty("buffers")){if(!Array.isArray(xe.buffers))return"buffers: array expected";for(var ve=0;ve<xe.buffers.length;++ve)if(!(xe.buffers[ve]&&typeof xe.buffers[ve].length=="number"||t.isString(xe.buffers[ve])))return"buffers: buffer[] expected"}if(xe.types!=null&&xe.hasOwnProperty("types")){if(!Array.isArray(xe.types))return"types: array expected";for(ve=0;ve<xe.types.length;++ve)if(!t.isInteger(xe.types[ve]))return"types: integer[] expected"}if(xe.metadata!=null&&xe.hasOwnProperty("metadata")){if(!Array.isArray(xe.metadata))return"metadata: array expected";for(ve=0;ve<xe.metadata.length;++ve){var ke=te.OperationMetadataDescriptor.verify(xe.metadata[ve]);if(ke)return"metadata."+ke}}return xe.lastOperationId!=null&&xe.hasOwnProperty("lastOperationId")&&!t.isString(xe.lastOperationId)?"lastOperationId: string expected":null},be.fromObject=function(xe){if(xe instanceof te.CollaborativeEditingUpdateMessage)return xe;var ve=new te.CollaborativeEditingUpdateMessage;if(xe.id!=null&&(ve.id=String(xe.id)),xe.baseVersion!=null&&(ve.baseVersion=xe.baseVersion>>>0),xe.buffers){if(!Array.isArray(xe.buffers))throw TypeError(".CollaborativeEditingUpdateMessage.buffers: array expected");ve.buffers=[];for(var ke=0;ke<xe.buffers.length;++ke)typeof xe.buffers[ke]=="string"?t.base64.decode(xe.buffers[ke],ve.buffers[ke]=t.newBuffer(t.base64.length(xe.buffers[ke])),0):xe.buffers[ke].length>=0&&(ve.buffers[ke]=xe.buffers[ke])}if(xe.types){if(!Array.isArray(xe.types))throw TypeError(".CollaborativeEditingUpdateMessage.types: array expected");for(ve.types=[],ke=0;ke<xe.types.length;++ke)ve.types[ke]=xe.types[ke]>>>0}if(xe.metadata){if(!Array.isArray(xe.metadata))throw TypeError(".CollaborativeEditingUpdateMessage.metadata: array expected");for(ve.metadata=[],ke=0;ke<xe.metadata.length;++ke){if(typeof xe.metadata[ke]!="object")throw TypeError(".CollaborativeEditingUpdateMessage.metadata: object expected");ve.metadata[ke]=te.OperationMetadataDescriptor.fromObject(xe.metadata[ke])}}return xe.lastOperationId!=null&&(ve.lastOperationId=String(xe.lastOperationId)),ve},be.toObject=function(xe,ve){ve||(ve={});var ke={};if((ve.arrays||ve.defaults)&&(ke.buffers=[],ke.types=[],ke.metadata=[]),ve.defaults&&(ke.id="",ke.baseVersion=0,ke.lastOperationId=""),xe.id!=null&&xe.hasOwnProperty("id")&&(ke.id=xe.id),xe.baseVersion!=null&&xe.hasOwnProperty("baseVersion")&&(ke.baseVersion=xe.baseVersion),xe.buffers&&xe.buffers.length){ke.buffers=[];for(var Ie=0;Ie<xe.buffers.length;++Ie)ke.buffers[Ie]=ve.bytes===String?t.base64.encode(xe.buffers[Ie],0,xe.buffers[Ie].length):ve.bytes===Array?Array.prototype.slice.call(xe.buffers[Ie]):xe.buffers[Ie]}if(xe.types&&xe.types.length)for(ke.types=[],Ie=0;Ie<xe.types.length;++Ie)ke.types[Ie]=xe.types[Ie];if(xe.metadata&&xe.metadata.length)for(ke.metadata=[],Ie=0;Ie<xe.metadata.length;++Ie)ke.metadata[Ie]=te.OperationMetadataDescriptor.toObject(xe.metadata[Ie],ve);return xe.lastOperationId!=null&&xe.hasOwnProperty("lastOperationId")&&(ke.lastOperationId=xe.lastOperationId),ke},be.prototype.toJSON=function(){return this.constructor.toObject(this,_0x462d7f.util.toJSONOptions)},be.getTypeUrl=function(xe){return xe===void 0&&(xe="type.googleapis.com"),xe+"/CollaborativeEditingUpdateMessage"},be}(),te.GetDocumentDetailsMessage=function(){function be(xe){if(xe)for(var ve=Object.keys(xe),ke=0;ke<ve.length;++ke)xe[ve[ke]]!=null&&(this[ve[ke]]=xe[ve[ke]])}return be.prototype.documentId="",be.prototype.environmentId="",be.create=function(xe){return new be(xe)},be.encode=function(xe,ve){return ve||(ve=we.create()),xe.documentId!=null&&Object.hasOwnProperty.call(xe,"documentId")&&ve.uint32(10).string(xe.documentId),xe.environmentId!=null&&Object.hasOwnProperty.call(xe,"environmentId")&&ve.uint32(18).string(xe.environmentId),ve},be.encodeDelimited=function(xe,ve){return this.encode(xe,ve).ldelim()},be.decode=function(xe,ve){xe instanceof Te||(xe=Te.create(xe));for(var ke=ve===void 0?xe.len:xe.pos+ve,Ie=new te.GetDocumentDetailsMessage;xe.pos<ke;){var Ae=xe.uint32();switch(Ae>>>3){case 1:Ie.documentId=xe.string();break;case 2:Ie.environmentId=xe.string();break;default:xe.skipType(7&Ae)}}return Ie},be.decodeDelimited=function(xe){return xe instanceof Te||(xe=new Te(xe)),this.decode(xe,xe.uint32())},be.verify=function(xe){return typeof xe!="object"||xe===null?"object expected":xe.documentId!=null&&xe.hasOwnProperty("documentId")&&!t.isString(xe.documentId)?"documentId: string expected":xe.environmentId!=null&&xe.hasOwnProperty("environmentId")&&!t.isString(xe.environmentId)?"environmentId: string expected":null},be.fromObject=function(xe){if(xe instanceof te.GetDocumentDetailsMessage)return xe;var ve=new te.GetDocumentDetailsMessage;return xe.documentId!=null&&(ve.documentId=String(xe.documentId)),xe.environmentId!=null&&(ve.environmentId=String(xe.environmentId)),ve},be.toObject=function(xe,ve){ve||(ve={});var ke={};return ve.defaults&&(ke.documentId="",ke.environmentId=""),xe.documentId!=null&&xe.hasOwnProperty("documentId")&&(ke.documentId=xe.documentId),xe.environmentId!=null&&xe.hasOwnProperty("environmentId")&&(ke.environmentId=xe.environmentId),ke},be.prototype.toJSON=function(){return this.constructor.toObject(this,_0x462d7f.util.toJSONOptions)},be.getTypeUrl=function(xe){return xe===void 0&&(xe="type.googleapis.com"),xe+"/GetDocumentDetailsMessage"},be}(),te.CollaborativeEditingConnectResponse=function(){function be(xe){if(this.buffers=[],this.types=[],this.metadata=[],xe)for(var ve=Object.keys(xe),ke=0;ke<ve.length;++ke)xe[ve[ke]]!=null&&(this[ve[ke]]=xe[ve[ke]])}return be.prototype.channel="",be.prototype.offset=0,be.prototype.version=0,be.prototype.buffers=t.emptyArray,be.prototype.types=t.emptyArray,be.prototype.metadata=t.emptyArray,be.prototype.initData="",be.prototype.isInitialized=!1,be.prototype.sessionId="",be.prototype.lastOperationId="",be.prototype.sessionCreatedAt="",be.create=function(xe){return new be(xe)},be.encode=function(xe,ve){if(ve||(ve=we.create()),xe.channel!=null&&Object.hasOwnProperty.call(xe,"channel")&&ve.uint32(10).string(xe.channel),xe.offset!=null&&Object.hasOwnProperty.call(xe,"offset")&&ve.uint32(16).uint32(xe.offset),xe.version!=null&&Object.hasOwnProperty.call(xe,"version")&&ve.uint32(24).uint32(xe.version),xe.buffers!=null&&xe.buffers.length)for(var ke=0;ke<xe.buffers.length;++ke)ve.uint32(34).bytes(xe.buffers[ke]);if(xe.types!=null&&xe.types.length){for(ve.uint32(42).fork(),ke=0;ke<xe.types.length;++ke)ve.uint32(xe.types[ke]);ve.ldelim()}if(xe.metadata!=null&&xe.metadata.length)for(ke=0;ke<xe.metadata.length;++ke)te.OperationMetadataDescriptor.encode(xe.metadata[ke],ve.uint32(58).fork()).ldelim();return xe.initData!=null&&Object.hasOwnProperty.call(xe,"initData")&&ve.uint32(66).string(xe.initData),xe.isInitialized!=null&&Object.hasOwnProperty.call(xe,"isInitialized")&&ve.uint32(72).bool(xe.isInitialized),xe.sessionId!=null&&Object.hasOwnProperty.call(xe,"sessionId")&&ve.uint32(82).string(xe.sessionId),xe.lastOperationId!=null&&Object.hasOwnProperty.call(xe,"lastOperationId")&&ve.uint32(90).string(xe.lastOperationId),xe.sessionCreatedAt!=null&&Object.hasOwnProperty.call(xe,"sessionCreatedAt")&&ve.uint32(98).string(xe.sessionCreatedAt),ve},be.encodeDelimited=function(xe,ve){return this.encode(xe,ve).ldelim()},be.decode=function(xe,ve){xe instanceof Te||(xe=Te.create(xe));for(var ke=ve===void 0?xe.len:xe.pos+ve,Ie=new te.CollaborativeEditingConnectResponse;xe.pos<ke;){var Ae=xe.uint32();switch(Ae>>>3){case 1:Ie.channel=xe.string();break;case 2:Ie.offset=xe.uint32();break;case 3:Ie.version=xe.uint32();break;case 4:Ie.buffers&&Ie.buffers.length||(Ie.buffers=[]),Ie.buffers.push(xe.bytes());break;case 5:if(Ie.types&&Ie.types.length||(Ie.types=[]),(7&Ae)==2)for(var Se=xe.uint32()+xe.pos;xe.pos<Se;)Ie.types.push(xe.uint32());else Ie.types.push(xe.uint32());break;case 7:Ie.metadata&&Ie.metadata.length||(Ie.metadata=[]),Ie.metadata.push(te.OperationMetadataDescriptor.decode(xe,xe.uint32()));break;case 8:Ie.initData=xe.string();break;case 9:Ie.isInitialized=xe.bool();break;case 10:Ie.sessionId=xe.string();break;case 11:Ie.lastOperationId=xe.string();break;case 12:Ie.sessionCreatedAt=xe.string();break;default:xe.skipType(7&Ae)}}return Ie},be.decodeDelimited=function(xe){return xe instanceof Te||(xe=new Te(xe)),this.decode(xe,xe.uint32())},be.verify=function(xe){if(typeof xe!="object"||xe===null)return"object expected";if(xe.channel!=null&&xe.hasOwnProperty("channel")&&!t.isString(xe.channel))return"channel: string expected";if(xe.offset!=null&&xe.hasOwnProperty("offset")&&!t.isInteger(xe.offset))return"offset: integer expected";if(xe.version!=null&&xe.hasOwnProperty("version")&&!t.isInteger(xe.version))return"version: integer expected";if(xe.buffers!=null&&xe.hasOwnProperty("buffers")){if(!Array.isArray(xe.buffers))return"buffers: array expected";for(var ve=0;ve<xe.buffers.length;++ve)if(!(xe.buffers[ve]&&typeof xe.buffers[ve].length=="number"||t.isString(xe.buffers[ve])))return"buffers: buffer[] expected"}if(xe.types!=null&&xe.hasOwnProperty("types")){if(!Array.isArray(xe.types))return"types: array expected";for(ve=0;ve<xe.types.length;++ve)if(!t.isInteger(xe.types[ve]))return"types: integer[] expected"}if(xe.metadata!=null&&xe.hasOwnProperty("metadata")){if(!Array.isArray(xe.metadata))return"metadata: array expected";for(ve=0;ve<xe.metadata.length;++ve){var ke=te.OperationMetadataDescriptor.verify(xe.metadata[ve]);if(ke)return"metadata."+ke}}return xe.initData!=null&&xe.hasOwnProperty("initData")&&!t.isString(xe.initData)?"initData: string expected":xe.isInitialized!=null&&xe.hasOwnProperty("isInitialized")&&typeof xe.isInitialized!="boolean"?"isInitialized: boolean expected":xe.sessionId!=null&&xe.hasOwnProperty("sessionId")&&!t.isString(xe.sessionId)?"sessionId: string expected":xe.lastOperationId!=null&&xe.hasOwnProperty("lastOperationId")&&!t.isString(xe.lastOperationId)?"lastOperationId: string expected":xe.sessionCreatedAt!=null&&xe.hasOwnProperty("sessionCreatedAt")&&!t.isString(xe.sessionCreatedAt)?"sessionCreatedAt: string expected":null},be.fromObject=function(xe){if(xe instanceof te.CollaborativeEditingConnectResponse)return xe;var ve=new te.CollaborativeEditingConnectResponse;if(xe.channel!=null&&(ve.channel=String(xe.channel)),xe.offset!=null&&(ve.offset=xe.offset>>>0),xe.version!=null&&(ve.version=xe.version>>>0),xe.buffers){if(!Array.isArray(xe.buffers))throw TypeError(".CollaborativeEditingConnectResponse.buffers: array expected");ve.buffers=[];for(var ke=0;ke<xe.buffers.length;++ke)typeof xe.buffers[ke]=="string"?t.base64.decode(xe.buffers[ke],ve.buffers[ke]=t.newBuffer(t.base64.length(xe.buffers[ke])),0):xe.buffers[ke].length>=0&&(ve.buffers[ke]=xe.buffers[ke])}if(xe.types){if(!Array.isArray(xe.types))throw TypeError(".CollaborativeEditingConnectResponse.types: array expected");for(ve.types=[],ke=0;ke<xe.types.length;++ke)ve.types[ke]=xe.types[ke]>>>0}if(xe.metadata){if(!Array.isArray(xe.metadata))throw TypeError(".CollaborativeEditingConnectResponse.metadata: array expected");for(ve.metadata=[],ke=0;ke<xe.metadata.length;++ke){if(typeof xe.metadata[ke]!="object")throw TypeError(".CollaborativeEditingConnectResponse.metadata: object expected");ve.metadata[ke]=te.OperationMetadataDescriptor.fromObject(xe.metadata[ke])}}return xe.initData!=null&&(ve.initData=String(xe.initData)),xe.isInitialized!=null&&(ve.isInitialized=!!xe.isInitialized),xe.sessionId!=null&&(ve.sessionId=String(xe.sessionId)),xe.lastOperationId!=null&&(ve.lastOperationId=String(xe.lastOperationId)),xe.sessionCreatedAt!=null&&(ve.sessionCreatedAt=String(xe.sessionCreatedAt)),ve},be.toObject=function(xe,ve){ve||(ve={});var ke={};if((ve.arrays||ve.defaults)&&(ke.buffers=[],ke.types=[],ke.metadata=[]),ve.defaults&&(ke.channel="",ke.offset=0,ke.version=0,ke.initData="",ke.isInitialized=!1,ke.sessionId="",ke.lastOperationId="",ke.sessionCreatedAt=""),xe.channel!=null&&xe.hasOwnProperty("channel")&&(ke.channel=xe.channel),xe.offset!=null&&xe.hasOwnProperty("offset")&&(ke.offset=xe.offset),xe.version!=null&&xe.hasOwnProperty("version")&&(ke.version=xe.version),xe.buffers&&xe.buffers.length){ke.buffers=[];for(var Ie=0;Ie<xe.buffers.length;++Ie)ke.buffers[Ie]=ve.bytes===String?t.base64.encode(xe.buffers[Ie],0,xe.buffers[Ie].length):ve.bytes===Array?Array.prototype.slice.call(xe.buffers[Ie]):xe.buffers[Ie]}if(xe.types&&xe.types.length)for(ke.types=[],Ie=0;Ie<xe.types.length;++Ie)ke.types[Ie]=xe.types[Ie];if(xe.metadata&&xe.metadata.length)for(ke.metadata=[],Ie=0;Ie<xe.metadata.length;++Ie)ke.metadata[Ie]=te.OperationMetadataDescriptor.toObject(xe.metadata[Ie],ve);return xe.initData!=null&&xe.hasOwnProperty("initData")&&(ke.initData=xe.initData),xe.isInitialized!=null&&xe.hasOwnProperty("isInitialized")&&(ke.isInitialized=xe.isInitialized),xe.sessionId!=null&&xe.hasOwnProperty("sessionId")&&(ke.sessionId=xe.sessionId),xe.lastOperationId!=null&&xe.hasOwnProperty("lastOperationId")&&(ke.lastOperationId=xe.lastOperationId),xe.sessionCreatedAt!=null&&xe.hasOwnProperty("sessionCreatedAt")&&(ke.sessionCreatedAt=xe.sessionCreatedAt),ke},be.prototype.toJSON=function(){return this.constructor.toObject(this,_0x462d7f.util.toJSONOptions)},be.getTypeUrl=function(xe){return xe===void 0&&(xe="type.googleapis.com"),xe+"/CollaborativeEditingConnectResponse"},be}(),te.CollaborativeEditingResponse=function(){function be(xe){if(this.buffers=[],this.types=[],this.metadata=[],xe)for(var ve=Object.keys(xe),ke=0;ke<ve.length;++ke)xe[ve[ke]]!=null&&(this[ve[ke]]=xe[ve[ke]])}return be.prototype.version=0,be.prototype.buffers=t.emptyArray,be.prototype.types=t.emptyArray,be.prototype.metadata=t.emptyArray,be.prototype.lastOperationId="",be.prototype.lastOperationAcceptedAt="",be.create=function(xe){return new be(xe)},be.encode=function(xe,ve){if(ve||(ve=we.create()),xe.version!=null&&Object.hasOwnProperty.call(xe,"version")&&ve.uint32(8).uint32(xe.version),xe.buffers!=null&&xe.buffers.length)for(var ke=0;ke<xe.buffers.length;++ke)ve.uint32(18).bytes(xe.buffers[ke]);if(xe.types!=null&&xe.types.length){for(ve.uint32(26).fork(),ke=0;ke<xe.types.length;++ke)ve.uint32(xe.types[ke]);ve.ldelim()}if(xe.metadata!=null&&xe.metadata.length)for(ke=0;ke<xe.metadata.length;++ke)te.OperationMetadataDescriptor.encode(xe.metadata[ke],ve.uint32(42).fork()).ldelim();return xe.lastOperationId!=null&&Object.hasOwnProperty.call(xe,"lastOperationId")&&ve.uint32(50).string(xe.lastOperationId),xe.lastOperationAcceptedAt!=null&&Object.hasOwnProperty.call(xe,"lastOperationAcceptedAt")&&ve.uint32(58).string(xe.lastOperationAcceptedAt),ve},be.encodeDelimited=function(xe,ve){return this.encode(xe,ve).ldelim()},be.decode=function(xe,ve){xe instanceof Te||(xe=Te.create(xe));for(var ke=ve===void 0?xe.len:xe.pos+ve,Ie=new te.CollaborativeEditingResponse;xe.pos<ke;){var Ae=xe.uint32();switch(Ae>>>3){case 1:Ie.version=xe.uint32();break;case 2:Ie.buffers&&Ie.buffers.length||(Ie.buffers=[]),Ie.buffers.push(xe.bytes());break;case 3:if(Ie.types&&Ie.types.length||(Ie.types=[]),(7&Ae)==2)for(var Se=xe.uint32()+xe.pos;xe.pos<Se;)Ie.types.push(xe.uint32());else Ie.types.push(xe.uint32());break;case 5:Ie.metadata&&Ie.metadata.length||(Ie.metadata=[]),Ie.metadata.push(te.OperationMetadataDescriptor.decode(xe,xe.uint32()));break;case 6:Ie.lastOperationId=xe.string();break;case 7:Ie.lastOperationAcceptedAt=xe.string();break;default:xe.skipType(7&Ae)}}return Ie},be.decodeDelimited=function(xe){return xe instanceof Te||(xe=new Te(xe)),this.decode(xe,xe.uint32())},be.verify=function(xe){if(typeof xe!="object"||xe===null)return"object expected";if(xe.version!=null&&xe.hasOwnProperty("version")&&!t.isInteger(xe.version))return"version: integer expected";if(xe.buffers!=null&&xe.hasOwnProperty("buffers")){if(!Array.isArray(xe.buffers))return"buffers: array expected";for(var ve=0;ve<xe.buffers.length;++ve)if(!(xe.buffers[ve]&&typeof xe.buffers[ve].length=="number"||t.isString(xe.buffers[ve])))return"buffers: buffer[] expected"}if(xe.types!=null&&xe.hasOwnProperty("types")){if(!Array.isArray(xe.types))return"types: array expected";for(ve=0;ve<xe.types.length;++ve)if(!t.isInteger(xe.types[ve]))return"types: integer[] expected"}if(xe.metadata!=null&&xe.hasOwnProperty("metadata")){if(!Array.isArray(xe.metadata))return"metadata: array expected";for(ve=0;ve<xe.metadata.length;++ve){var ke=te.OperationMetadataDescriptor.verify(xe.metadata[ve]);if(ke)return"metadata."+ke}}return xe.lastOperationId!=null&&xe.hasOwnProperty("lastOperationId")&&!t.isString(xe.lastOperationId)?"lastOperationId: string expected":xe.lastOperationAcceptedAt!=null&&xe.hasOwnProperty("lastOperationAcceptedAt")&&!t.isString(xe.lastOperationAcceptedAt)?"lastOperationAcceptedAt: string expected":null},be.fromObject=function(xe){if(xe instanceof te.CollaborativeEditingResponse)return xe;var ve=new te.CollaborativeEditingResponse;if(xe.version!=null&&(ve.version=xe.version>>>0),xe.buffers){if(!Array.isArray(xe.buffers))throw TypeError(".CollaborativeEditingResponse.buffers: array expected");ve.buffers=[];for(var ke=0;ke<xe.buffers.length;++ke)typeof xe.buffers[ke]=="string"?t.base64.decode(xe.buffers[ke],ve.buffers[ke]=t.newBuffer(t.base64.length(xe.buffers[ke])),0):xe.buffers[ke].length>=0&&(ve.buffers[ke]=xe.buffers[ke])}if(xe.types){if(!Array.isArray(xe.types))throw TypeError(".CollaborativeEditingResponse.types: array expected");for(ve.types=[],ke=0;ke<xe.types.length;++ke)ve.types[ke]=xe.types[ke]>>>0}if(xe.metadata){if(!Array.isArray(xe.metadata))throw TypeError(".CollaborativeEditingResponse.metadata: array expected");for(ve.metadata=[],ke=0;ke<xe.metadata.length;++ke){if(typeof xe.metadata[ke]!="object")throw TypeError(".CollaborativeEditingResponse.metadata: object expected");ve.metadata[ke]=te.OperationMetadataDescriptor.fromObject(xe.metadata[ke])}}return xe.lastOperationId!=null&&(ve.lastOperationId=String(xe.lastOperationId)),xe.lastOperationAcceptedAt!=null&&(ve.lastOperationAcceptedAt=String(xe.lastOperationAcceptedAt)),ve},be.toObject=function(xe,ve){ve||(ve={});var ke={};if((ve.arrays||ve.defaults)&&(ke.buffers=[],ke.types=[],ke.metadata=[]),ve.defaults&&(ke.version=0,ke.lastOperationId="",ke.lastOperationAcceptedAt=""),xe.version!=null&&xe.hasOwnProperty("version")&&(ke.version=xe.version),xe.buffers&&xe.buffers.length){ke.buffers=[];for(var Ie=0;Ie<xe.buffers.length;++Ie)ke.buffers[Ie]=ve.bytes===String?t.base64.encode(xe.buffers[Ie],0,xe.buffers[Ie].length):ve.bytes===Array?Array.prototype.slice.call(xe.buffers[Ie]):xe.buffers[Ie]}if(xe.types&&xe.types.length)for(ke.types=[],Ie=0;Ie<xe.types.length;++Ie)ke.types[Ie]=xe.types[Ie];if(xe.metadata&&xe.metadata.length)for(ke.metadata=[],Ie=0;Ie<xe.metadata.length;++Ie)ke.metadata[Ie]=te.OperationMetadataDescriptor.toObject(xe.metadata[Ie],ve);return xe.lastOperationId!=null&&xe.hasOwnProperty("lastOperationId")&&(ke.lastOperationId=xe.lastOperationId),xe.lastOperationAcceptedAt!=null&&xe.hasOwnProperty("lastOperationAcceptedAt")&&(ke.lastOperationAcceptedAt=xe.lastOperationAcceptedAt),ke},be.prototype.toJSON=function(){return this.constructor.toObject(this,_0x462d7f.util.toJSONOptions)},be.getTypeUrl=function(xe){return xe===void 0&&(xe="type.googleapis.com"),xe+"/CollaborativeEditingResponse"},be}(),te.GetDocumentDetailsResponse=function(){function be(xe){if(xe)for(var ve=Object.keys(xe),ke=0;ke<ve.length;++ke)xe[ve[ke]]!=null&&(this[ve[ke]]=xe[ve[ke]])}return be.prototype.lastDocumentSessionId="",be.prototype.lastDocumentSessionOperationId="",be.prototype.currentDocumentSessionId="",be.prototype.currentDocumentSessionVersion=0,be.prototype.currentDocumentSessionOperationId="",be.create=function(xe){return new be(xe)},be.encode=function(xe,ve){return ve||(ve=we.create()),xe.lastDocumentSessionId!=null&&Object.hasOwnProperty.call(xe,"lastDocumentSessionId")&&ve.uint32(10).string(xe.lastDocumentSessionId),xe.lastDocumentSessionOperationId!=null&&Object.hasOwnProperty.call(xe,"lastDocumentSessionOperationId")&&ve.uint32(18).string(xe.lastDocumentSessionOperationId),xe.currentDocumentSessionId!=null&&Object.hasOwnProperty.call(xe,"currentDocumentSessionId")&&ve.uint32(26).string(xe.currentDocumentSessionId),xe.currentDocumentSessionVersion!=null&&Object.hasOwnProperty.call(xe,"currentDocumentSessionVersion")&&ve.uint32(32).uint32(xe.currentDocumentSessionVersion),xe.currentDocumentSessionOperationId!=null&&Object.hasOwnProperty.call(xe,"currentDocumentSessionOperationId")&&ve.uint32(42).string(xe.currentDocumentSessionOperationId),ve},be.encodeDelimited=function(xe,ve){return this.encode(xe,ve).ldelim()},be.decode=function(xe,ve){xe instanceof Te||(xe=Te.create(xe));for(var ke=ve===void 0?xe.len:xe.pos+ve,Ie=new te.GetDocumentDetailsResponse;xe.pos<ke;){var Ae=xe.uint32();switch(Ae>>>3){case 1:Ie.lastDocumentSessionId=xe.string();break;case 2:Ie.lastDocumentSessionOperationId=xe.string();break;case 3:Ie.currentDocumentSessionId=xe.string();break;case 4:Ie.currentDocumentSessionVersion=xe.uint32();break;case 5:Ie.currentDocumentSessionOperationId=xe.string();break;default:xe.skipType(7&Ae)}}return Ie},be.decodeDelimited=function(xe){return xe instanceof Te||(xe=new Te(xe)),this.decode(xe,xe.uint32())},be.verify=function(xe){return typeof xe!="object"||xe===null?"object expected":xe.lastDocumentSessionId!=null&&xe.hasOwnProperty("lastDocumentSessionId")&&!t.isString(xe.lastDocumentSessionId)?"lastDocumentSessionId: string expected":xe.lastDocumentSessionOperationId!=null&&xe.hasOwnProperty("lastDocumentSessionOperationId")&&!t.isString(xe.lastDocumentSessionOperationId)?"lastDocumentSessionOperationId: string expected":xe.currentDocumentSessionId!=null&&xe.hasOwnProperty("currentDocumentSessionId")&&!t.isString(xe.currentDocumentSessionId)?"currentDocumentSessionId: string expected":xe.currentDocumentSessionVersion!=null&&xe.hasOwnProperty("currentDocumentSessionVersion")&&!t.isInteger(xe.currentDocumentSessionVersion)?"currentDocumentSessionVersion: integer expected":xe.currentDocumentSessionOperationId!=null&&xe.hasOwnProperty("currentDocumentSessionOperationId")&&!t.isString(xe.currentDocumentSessionOperationId)?"currentDocumentSessionOperationId: string expected":null},be.fromObject=function(xe){if(xe instanceof te.GetDocumentDetailsResponse)return xe;var ve=new te.GetDocumentDetailsResponse;return xe.lastDocumentSessionId!=null&&(ve.lastDocumentSessionId=String(xe.lastDocumentSessionId)),xe.lastDocumentSessionOperationId!=null&&(ve.lastDocumentSessionOperationId=String(xe.lastDocumentSessionOperationId)),xe.currentDocumentSessionId!=null&&(ve.currentDocumentSessionId=String(xe.currentDocumentSessionId)),xe.currentDocumentSessionVersion!=null&&(ve.currentDocumentSessionVersion=xe.currentDocumentSessionVersion>>>0),xe.currentDocumentSessionOperationId!=null&&(ve.currentDocumentSessionOperationId=String(xe.currentDocumentSessionOperationId)),ve},be.toObject=function(xe,ve){ve||(ve={});var ke={};return ve.defaults&&(ke.lastDocumentSessionId="",ke.lastDocumentSessionOperationId="",ke.currentDocumentSessionId="",ke.currentDocumentSessionVersion=0,ke.currentDocumentSessionOperationId=""),xe.lastDocumentSessionId!=null&&xe.hasOwnProperty("lastDocumentSessionId")&&(ke.lastDocumentSessionId=xe.lastDocumentSessionId),xe.lastDocumentSessionOperationId!=null&&xe.hasOwnProperty("lastDocumentSessionOperationId")&&(ke.lastDocumentSessionOperationId=xe.lastDocumentSessionOperationId),xe.currentDocumentSessionId!=null&&xe.hasOwnProperty("currentDocumentSessionId")&&(ke.currentDocumentSessionId=xe.currentDocumentSessionId),xe.currentDocumentSessionVersion!=null&&xe.hasOwnProperty("currentDocumentSessionVersion")&&(ke.currentDocumentSessionVersion=xe.currentDocumentSessionVersion),xe.currentDocumentSessionOperationId!=null&&xe.hasOwnProperty("currentDocumentSessionOperationId")&&(ke.currentDocumentSessionOperationId=xe.currentDocumentSessionOperationId),ke},be.prototype.toJSON=function(){return this.constructor.toObject(this,_0x462d7f.util.toJSONOptions)},be.getTypeUrl=function(xe){return xe===void 0&&(xe="type.googleapis.com"),xe+"/GetDocumentDetailsResponse"},be}(),te.CommentDescriptor=function(){function be(xe){if(xe)for(var ve=Object.keys(xe),ke=0;ke<ve.length;++ke)xe[ve[ke]]!=null&&(this[ve[ke]]=xe[ve[ke]])}return be.prototype.commentId="",be.prototype.commentThreadId="",be.prototype.userId="",be.prototype.content="",be.prototype.documentId="",be.prototype.createdAt="",be.prototype.attributes="",be.create=function(xe){return new be(xe)},be.encode=function(xe,ve){return ve||(ve=we.create()),xe.commentId!=null&&Object.hasOwnProperty.call(xe,"commentId")&&ve.uint32(10).string(xe.commentId),xe.commentThreadId!=null&&Object.hasOwnProperty.call(xe,"commentThreadId")&&ve.uint32(18).string(xe.commentThreadId),xe.userId!=null&&Object.hasOwnProperty.call(xe,"userId")&&ve.uint32(26).string(xe.userId),xe.content!=null&&Object.hasOwnProperty.call(xe,"content")&&ve.uint32(34).string(xe.content),xe.documentId!=null&&Object.hasOwnProperty.call(xe,"documentId")&&ve.uint32(42).string(xe.documentId),xe.createdAt!=null&&Object.hasOwnProperty.call(xe,"createdAt")&&ve.uint32(50).string(xe.createdAt),xe.attributes!=null&&Object.hasOwnProperty.call(xe,"attributes")&&ve.uint32(58).string(xe.attributes),ve},be.encodeDelimited=function(xe,ve){return this.encode(xe,ve).ldelim()},be.decode=function(xe,ve){xe instanceof Te||(xe=Te.create(xe));for(var ke=ve===void 0?xe.len:xe.pos+ve,Ie=new te.CommentDescriptor;xe.pos<ke;){var Ae=xe.uint32();switch(Ae>>>3){case 1:Ie.commentId=xe.string();break;case 2:Ie.commentThreadId=xe.string();break;case 3:Ie.userId=xe.string();break;case 4:Ie.content=xe.string();break;case 5:Ie.documentId=xe.string();break;case 6:Ie.createdAt=xe.string();break;case 7:Ie.attributes=xe.string();break;default:xe.skipType(7&Ae)}}return Ie},be.decodeDelimited=function(xe){return xe instanceof Te||(xe=new Te(xe)),this.decode(xe,xe.uint32())},be.verify=function(xe){return typeof xe!="object"||xe===null?"object expected":xe.commentId!=null&&xe.hasOwnProperty("commentId")&&!t.isString(xe.commentId)?"commentId: string expected":xe.commentThreadId!=null&&xe.hasOwnProperty("commentThreadId")&&!t.isString(xe.commentThreadId)?"commentThreadId: string expected":xe.userId!=null&&xe.hasOwnProperty("userId")&&!t.isString(xe.userId)?"userId: string expected":xe.content!=null&&xe.hasOwnProperty("content")&&!t.isString(xe.content)?"content: string expected":xe.documentId!=null&&xe.hasOwnProperty("documentId")&&!t.isString(xe.documentId)?"documentId: string expected":xe.createdAt!=null&&xe.hasOwnProperty("createdAt")&&!t.isString(xe.createdAt)?"createdAt: string expected":xe.attributes!=null&&xe.hasOwnProperty("attributes")&&!t.isString(xe.attributes)?"attributes: string expected":null},be.fromObject=function(xe){if(xe instanceof te.CommentDescriptor)return xe;var ve=new te.CommentDescriptor;return xe.commentId!=null&&(ve.commentId=String(xe.commentId)),xe.commentThreadId!=null&&(ve.commentThreadId=String(xe.commentThreadId)),xe.userId!=null&&(ve.userId=String(xe.userId)),xe.content!=null&&(ve.content=String(xe.content)),xe.documentId!=null&&(ve.documentId=String(xe.documentId)),xe.createdAt!=null&&(ve.createdAt=String(xe.createdAt)),xe.attributes!=null&&(ve.attributes=String(xe.attributes)),ve},be.toObject=function(xe,ve){ve||(ve={});var ke={};return ve.defaults&&(ke.commentId="",ke.commentThreadId="",ke.userId="",ke.content="",ke.documentId="",ke.createdAt="",ke.attributes=""),xe.commentId!=null&&xe.hasOwnProperty("commentId")&&(ke.commentId=xe.commentId),xe.commentThreadId!=null&&xe.hasOwnProperty("commentThreadId")&&(ke.commentThreadId=xe.commentThreadId),xe.userId!=null&&xe.hasOwnProperty("userId")&&(ke.userId=xe.userId),xe.content!=null&&xe.hasOwnProperty("content")&&(ke.content=xe.content),xe.documentId!=null&&xe.hasOwnProperty("documentId")&&(ke.documentId=xe.documentId),xe.createdAt!=null&&xe.hasOwnProperty("createdAt")&&(ke.createdAt=xe.createdAt),xe.attributes!=null&&xe.hasOwnProperty("attributes")&&(ke.attributes=xe.attributes),ke},be.prototype.toJSON=function(){return this.constructor.toObject(this,_0x462d7f.util.toJSONOptions)},be.getTypeUrl=function(xe){return xe===void 0&&(xe="type.googleapis.com"),xe+"/CommentDescriptor"},be}(),te.CommentsThreadDescriptor=function(){function be(xe){if(this.comments=[],xe)for(var ve=Object.keys(xe),ke=0;ke<ve.length;++ke)xe[ve[ke]]!=null&&(this[ve[ke]]=xe[ve[ke]])}return be.prototype.commentThreadId="",be.prototype.comments=t.emptyArray,be.prototype.resolvedAt="",be.prototype.resolvedBy="",be.prototype.context="",be.prototype.createdAt="",be.prototype.deletedAt="",be.prototype.attributes="",be.prototype.unlinkedAt="",be.create=function(xe){return new be(xe)},be.encode=function(xe,ve){if(ve||(ve=we.create()),xe.commentThreadId!=null&&Object.hasOwnProperty.call(xe,"commentThreadId")&&ve.uint32(10).string(xe.commentThreadId),xe.comments!=null&&xe.comments.length)for(var ke=0;ke<xe.comments.length;++ke)te.CommentDescriptor.encode(xe.comments[ke],ve.uint32(18).fork()).ldelim();return xe.resolvedAt!=null&&Object.hasOwnProperty.call(xe,"resolvedAt")&&ve.uint32(26).string(xe.resolvedAt),xe.resolvedBy!=null&&Object.hasOwnProperty.call(xe,"resolvedBy")&&ve.uint32(34).string(xe.resolvedBy),xe.context!=null&&Object.hasOwnProperty.call(xe,"context")&&ve.uint32(42).string(xe.context),xe.createdAt!=null&&Object.hasOwnProperty.call(xe,"createdAt")&&ve.uint32(50).string(xe.createdAt),xe.deletedAt!=null&&Object.hasOwnProperty.call(xe,"deletedAt")&&ve.uint32(58).string(xe.deletedAt),xe.attributes!=null&&Object.hasOwnProperty.call(xe,"attributes")&&ve.uint32(66).string(xe.attributes),xe.unlinkedAt!=null&&Object.hasOwnProperty.call(xe,"unlinkedAt")&&ve.uint32(74).string(xe.unlinkedAt),ve},be.encodeDelimited=function(xe,ve){return this.encode(xe,ve).ldelim()},be.decode=function(xe,ve){xe instanceof Te||(xe=Te.create(xe));for(var ke=ve===void 0?xe.len:xe.pos+ve,Ie=new te.CommentsThreadDescriptor;xe.pos<ke;){var Ae=xe.uint32();switch(Ae>>>3){case 1:Ie.commentThreadId=xe.string();break;case 2:Ie.comments&&Ie.comments.length||(Ie.comments=[]),Ie.comments.push(te.CommentDescriptor.decode(xe,xe.uint32()));break;case 3:Ie.resolvedAt=xe.string();break;case 4:Ie.resolvedBy=xe.string();break;case 5:Ie.context=xe.string();break;case 6:Ie.createdAt=xe.string();break;case 7:Ie.deletedAt=xe.string();break;case 8:Ie.attributes=xe.string();break;case 9:Ie.unlinkedAt=xe.string();break;default:xe.skipType(7&Ae)}}return Ie},be.decodeDelimited=function(xe){return xe instanceof Te||(xe=new Te(xe)),this.decode(xe,xe.uint32())},be.verify=function(xe){if(typeof xe!="object"||xe===null)return"object expected";if(xe.commentThreadId!=null&&xe.hasOwnProperty("commentThreadId")&&!t.isString(xe.commentThreadId))return"commentThreadId: string expected";if(xe.comments!=null&&xe.hasOwnProperty("comments")){if(!Array.isArray(xe.comments))return"comments: array expected";for(var ve=0;ve<xe.comments.length;++ve){var ke=te.CommentDescriptor.verify(xe.comments[ve]);if(ke)return"comments."+ke}}return xe.resolvedAt!=null&&xe.hasOwnProperty("resolvedAt")&&!t.isString(xe.resolvedAt)?"resolvedAt: string expected":xe.resolvedBy!=null&&xe.hasOwnProperty("resolvedBy")&&!t.isString(xe.resolvedBy)?"resolvedBy: string expected":xe.context!=null&&xe.hasOwnProperty("context")&&!t.isString(xe.context)?"context: string expected":xe.createdAt!=null&&xe.hasOwnProperty("createdAt")&&!t.isString(xe.createdAt)?"createdAt: string expected":xe.deletedAt!=null&&xe.hasOwnProperty("deletedAt")&&!t.isString(xe.deletedAt)?"deletedAt: string expected":xe.attributes!=null&&xe.hasOwnProperty("attributes")&&!t.isString(xe.attributes)?"attributes: string expected":xe.unlinkedAt!=null&&xe.hasOwnProperty("unlinkedAt")&&!t.isString(xe.unlinkedAt)?"unlinkedAt: string expected":null},be.fromObject=function(xe){if(xe instanceof te.CommentsThreadDescriptor)return xe;var ve=new te.CommentsThreadDescriptor;if(xe.commentThreadId!=null&&(ve.commentThreadId=String(xe.commentThreadId)),xe.comments){if(!Array.isArray(xe.comments))throw TypeError(".CommentsThreadDescriptor.comments: array expected");ve.comments=[];for(var ke=0;ke<xe.comments.length;++ke){if(typeof xe.comments[ke]!="object")throw TypeError(".CommentsThreadDescriptor.comments: object expected");ve.comments[ke]=te.CommentDescriptor.fromObject(xe.comments[ke])}}return xe.resolvedAt!=null&&(ve.resolvedAt=String(xe.resolvedAt)),xe.resolvedBy!=null&&(ve.resolvedBy=String(xe.resolvedBy)),xe.context!=null&&(ve.context=String(xe.context)),xe.createdAt!=null&&(ve.createdAt=String(xe.createdAt)),xe.deletedAt!=null&&(ve.deletedAt=String(xe.deletedAt)),xe.attributes!=null&&(ve.attributes=String(xe.attributes)),xe.unlinkedAt!=null&&(ve.unlinkedAt=String(xe.unlinkedAt)),ve},be.toObject=function(xe,ve){ve||(ve={});var ke={};if((ve.arrays||ve.defaults)&&(ke.comments=[]),ve.defaults&&(ke.commentThreadId="",ke.resolvedAt="",ke.resolvedBy="",ke.context="",ke.createdAt="",ke.deletedAt="",ke.attributes="",ke.unlinkedAt=""),xe.commentThreadId!=null&&xe.hasOwnProperty("commentThreadId")&&(ke.commentThreadId=xe.commentThreadId),xe.comments&&xe.comments.length){ke.comments=[];for(var Ie=0;Ie<xe.comments.length;++Ie)ke.comments[Ie]=te.CommentDescriptor.toObject(xe.comments[Ie],ve)}return xe.resolvedAt!=null&&xe.hasOwnProperty("resolvedAt")&&(ke.resolvedAt=xe.resolvedAt),xe.resolvedBy!=null&&xe.hasOwnProperty("resolvedBy")&&(ke.resolvedBy=xe.resolvedBy),xe.context!=null&&xe.hasOwnProperty("context")&&(ke.context=xe.context),xe.createdAt!=null&&xe.hasOwnProperty("createdAt")&&(ke.createdAt=xe.createdAt),xe.deletedAt!=null&&xe.hasOwnProperty("deletedAt")&&(ke.deletedAt=xe.deletedAt),xe.attributes!=null&&xe.hasOwnProperty("attributes")&&(ke.attributes=xe.attributes),xe.unlinkedAt!=null&&xe.hasOwnProperty("unlinkedAt")&&(ke.unlinkedAt=xe.unlinkedAt),ke},be.prototype.toJSON=function(){return this.constructor.toObject(this,_0x462d7f.util.toJSONOptions)},be.getTypeUrl=function(xe){return xe===void 0&&(xe="type.googleapis.com"),xe+"/CommentsThreadDescriptor"},be}(),te.CommentThreadAddedCommentDescriptor=function(){function be(xe){if(xe)for(var ve=Object.keys(xe),ke=0;ke<ve.length;++ke)xe[ve[ke]]!=null&&(this[ve[ke]]=xe[ve[ke]])}return be.prototype.commentId="",be.prototype.createdAt="",be.create=function(xe){return new be(xe)},be.encode=function(xe,ve){return ve||(ve=we.create()),xe.commentId!=null&&Object.hasOwnProperty.call(xe,"commentId")&&ve.uint32(10).string(xe.commentId),xe.createdAt!=null&&Object.hasOwnProperty.call(xe,"createdAt")&&ve.uint32(18).string(xe.createdAt),ve},be.encodeDelimited=function(xe,ve){return this.encode(xe,ve).ldelim()},be.decode=function(xe,ve){xe instanceof Te||(xe=Te.create(xe));for(var ke=ve===void 0?xe.len:xe.pos+ve,Ie=new te.CommentThreadAddedCommentDescriptor;xe.pos<ke;){var Ae=xe.uint32();switch(Ae>>>3){case 1:Ie.commentId=xe.string();break;case 2:Ie.createdAt=xe.string();break;default:xe.skipType(7&Ae)}}return Ie},be.decodeDelimited=function(xe){return xe instanceof Te||(xe=new Te(xe)),this.decode(xe,xe.uint32())},be.verify=function(xe){return typeof xe!="object"||xe===null?"object expected":xe.commentId!=null&&xe.hasOwnProperty("commentId")&&!t.isString(xe.commentId)?"commentId: string expected":xe.createdAt!=null&&xe.hasOwnProperty("createdAt")&&!t.isString(xe.createdAt)?"createdAt: string expected":null},be.fromObject=function(xe){if(xe instanceof te.CommentThreadAddedCommentDescriptor)return xe;var ve=new te.CommentThreadAddedCommentDescriptor;return xe.commentId!=null&&(ve.commentId=String(xe.commentId)),xe.createdAt!=null&&(ve.createdAt=String(xe.createdAt)),ve},be.toObject=function(xe,ve){ve||(ve={});var ke={};return ve.defaults&&(ke.commentId="",ke.createdAt=""),xe.commentId!=null&&xe.hasOwnProperty("commentId")&&(ke.commentId=xe.commentId),xe.createdAt!=null&&xe.hasOwnProperty("createdAt")&&(ke.createdAt=xe.createdAt),ke},be.prototype.toJSON=function(){return this.constructor.toObject(this,_0x462d7f.util.toJSONOptions)},be.getTypeUrl=function(xe){return xe===void 0&&(xe="type.googleapis.com"),xe+"/CommentThreadAddedCommentDescriptor"},be}(),te.CommentsV2AddCommentMessage=function(){function be(xe){if(xe)for(var ve=Object.keys(xe),ke=0;ke<ve.length;++ke)xe[ve[ke]]!=null&&(this[ve[ke]]=xe[ve[ke]])}return be.prototype.commentThreadId="",be.prototype.content="",be.prototype.documentId="",be.prototype.commentId="",be.prototype.createdAt="",be.prototype.userId="",be.prototype.attributes="",be.prototype.commentThread=null,be.create=function(xe){return new be(xe)},be.encode=function(xe,ve){return ve||(ve=we.create()),xe.commentThreadId!=null&&Object.hasOwnProperty.call(xe,"commentThreadId")&&ve.uint32(10).string(xe.commentThreadId),xe.content!=null&&Object.hasOwnProperty.call(xe,"content")&&ve.uint32(18).string(xe.content),xe.documentId!=null&&Object.hasOwnProperty.call(xe,"documentId")&&ve.uint32(26).string(xe.documentId),xe.commentId!=null&&Object.hasOwnProperty.call(xe,"commentId")&&ve.uint32(34).string(xe.commentId),xe.createdAt!=null&&Object.hasOwnProperty.call(xe,"createdAt")&&ve.uint32(42).string(xe.createdAt),xe.userId!=null&&Object.hasOwnProperty.call(xe,"userId")&&ve.uint32(50).string(xe.userId),xe.attributes!=null&&Object.hasOwnProperty.call(xe,"attributes")&&ve.uint32(58).string(xe.attributes),xe.commentThread!=null&&Object.hasOwnProperty.call(xe,"commentThread")&&te.CommentsThreadDescriptor.encode(xe.commentThread,ve.uint32(66).fork()).ldelim(),ve},be.encodeDelimited=function(xe,ve){return this.encode(xe,ve).ldelim()},be.decode=function(xe,ve){xe instanceof Te||(xe=Te.create(xe));for(var ke=ve===void 0?xe.len:xe.pos+ve,Ie=new te.CommentsV2AddCommentMessage;xe.pos<ke;){var Ae=xe.uint32();switch(Ae>>>3){case 1:Ie.commentThreadId=xe.string();break;case 2:Ie.content=xe.string();break;case 3:Ie.documentId=xe.string();break;case 4:Ie.commentId=xe.string();break;case 5:Ie.createdAt=xe.string();break;case 6:Ie.userId=xe.string();break;case 7:Ie.attributes=xe.string();break;case 8:Ie.commentThread=te.CommentsThreadDescriptor.decode(xe,xe.uint32());break;default:xe.skipType(7&Ae)}}return Ie},be.decodeDelimited=function(xe){return xe instanceof Te||(xe=new Te(xe)),this.decode(xe,xe.uint32())},be.verify=function(xe){if(typeof xe!="object"||xe===null)return"object expected";if(xe.commentThreadId!=null&&xe.hasOwnProperty("commentThreadId")&&!t.isString(xe.commentThreadId))return"commentThreadId: string expected";if(xe.content!=null&&xe.hasOwnProperty("content")&&!t.isString(xe.content))return"content: string expected";if(xe.documentId!=null&&xe.hasOwnProperty("documentId")&&!t.isString(xe.documentId))return"documentId: string expected";if(xe.commentId!=null&&xe.hasOwnProperty("commentId")&&!t.isString(xe.commentId))return"commentId: string expected";if(xe.createdAt!=null&&xe.hasOwnProperty("createdAt")&&!t.isString(xe.createdAt))return"createdAt: string expected";if(xe.userId!=null&&xe.hasOwnProperty("userId")&&!t.isString(xe.userId))return"userId: string expected";if(xe.attributes!=null&&xe.hasOwnProperty("attributes")&&!t.isString(xe.attributes))return"attributes: string expected";if(xe.commentThread!=null&&xe.hasOwnProperty("commentThread")){var ve=te.CommentsThreadDescriptor.verify(xe.commentThread);if(ve)return"commentThread."+ve}return null},be.fromObject=function(xe){if(xe instanceof te.CommentsV2AddCommentMessage)return xe;var ve=new te.CommentsV2AddCommentMessage;if(xe.commentThreadId!=null&&(ve.commentThreadId=String(xe.commentThreadId)),xe.content!=null&&(ve.content=String(xe.content)),xe.documentId!=null&&(ve.documentId=String(xe.documentId)),xe.commentId!=null&&(ve.commentId=String(xe.commentId)),xe.createdAt!=null&&(ve.createdAt=String(xe.createdAt)),xe.userId!=null&&(ve.userId=String(xe.userId)),xe.attributes!=null&&(ve.attributes=String(xe.attributes)),xe.commentThread!=null){if(typeof xe.commentThread!="object")throw TypeError(".CommentsV2AddCommentMessage.commentThread: object expected");ve.commentThread=te.CommentsThreadDescriptor.fromObject(xe.commentThread)}return ve},be.toObject=function(xe,ve){ve||(ve={});var ke={};return ve.defaults&&(ke.commentThreadId="",ke.content="",ke.documentId="",ke.commentId="",ke.createdAt="",ke.userId="",ke.attributes="",ke.commentThread=null),xe.commentThreadId!=null&&xe.hasOwnProperty("commentThreadId")&&(ke.commentThreadId=xe.commentThreadId),xe.content!=null&&xe.hasOwnProperty("content")&&(ke.content=xe.content),xe.documentId!=null&&xe.hasOwnProperty("documentId")&&(ke.documentId=xe.documentId),xe.commentId!=null&&xe.hasOwnProperty("commentId")&&(ke.commentId=xe.commentId),xe.createdAt!=null&&xe.hasOwnProperty("createdAt")&&(ke.createdAt=xe.createdAt),xe.userId!=null&&xe.hasOwnProperty("userId")&&(ke.userId=xe.userId),xe.attributes!=null&&xe.hasOwnProperty("attributes")&&(ke.attributes=xe.attributes),xe.commentThread!=null&&xe.hasOwnProperty("commentThread")&&(ke.commentThread=te.CommentsThreadDescriptor.toObject(xe.commentThread,ve)),ke},be.prototype.toJSON=function(){return this.constructor.toObject(this,_0x462d7f.util.toJSONOptions)},be.getTypeUrl=function(xe){return xe===void 0&&(xe="type.googleapis.com"),xe+"/CommentsV2AddCommentMessage"},be}(),te.CommentsV2AddCommentThreadMessage=function(){function be(xe){if(this.comments=[],xe)for(var ve=Object.keys(xe),ke=0;ke<ve.length;++ke)xe[ve[ke]]!=null&&(this[ve[ke]]=xe[ve[ke]])}return be.prototype.documentId="",be.prototype.commentThreadId="",be.prototype.context="",be.prototype.createdAt="",be.prototype.resolvedAt="",be.prototype.resolvedBy="",be.prototype.attributes="",be.prototype.deletedAt="",be.prototype.comments=t.emptyArray,be.create=function(xe){return new be(xe)},be.encode=function(xe,ve){if(ve||(ve=we.create()),xe.documentId!=null&&Object.hasOwnProperty.call(xe,"documentId")&&ve.uint32(10).string(xe.documentId),xe.commentThreadId!=null&&Object.hasOwnProperty.call(xe,"commentThreadId")&&ve.uint32(18).string(xe.commentThreadId),xe.context!=null&&Object.hasOwnProperty.call(xe,"context")&&ve.uint32(26).string(xe.context),xe.createdAt!=null&&Object.hasOwnProperty.call(xe,"createdAt")&&ve.uint32(34).string(xe.createdAt),xe.resolvedAt!=null&&Object.hasOwnProperty.call(xe,"resolvedAt")&&ve.uint32(42).string(xe.resolvedAt),xe.resolvedBy!=null&&Object.hasOwnProperty.call(xe,"resolvedBy")&&ve.uint32(50).string(xe.resolvedBy),xe.attributes!=null&&Object.hasOwnProperty.call(xe,"attributes")&&ve.uint32(58).string(xe.attributes),xe.deletedAt!=null&&Object.hasOwnProperty.call(xe,"deletedAt")&&ve.uint32(66).string(xe.deletedAt),xe.comments!=null&&xe.comments.length)for(var ke=0;ke<xe.comments.length;++ke)te.CommentDescriptor.encode(xe.comments[ke],ve.uint32(74).fork()).ldelim();return ve},be.encodeDelimited=function(xe,ve){return this.encode(xe,ve).ldelim()},be.decode=function(xe,ve){xe instanceof Te||(xe=Te.create(xe));for(var ke=ve===void 0?xe.len:xe.pos+ve,Ie=new te.CommentsV2AddCommentThreadMessage;xe.pos<ke;){var Ae=xe.uint32();switch(Ae>>>3){case 1:Ie.documentId=xe.string();break;case 2:Ie.commentThreadId=xe.string();break;case 3:Ie.context=xe.string();break;case 4:Ie.createdAt=xe.string();break;case 5:Ie.resolvedAt=xe.string();break;case 6:Ie.resolvedBy=xe.string();break;case 7:Ie.attributes=xe.string();break;case 8:Ie.deletedAt=xe.string();break;case 9:Ie.comments&&Ie.comments.length||(Ie.comments=[]),Ie.comments.push(te.CommentDescriptor.decode(xe,xe.uint32()));break;default:xe.skipType(7&Ae)}}return Ie},be.decodeDelimited=function(xe){return xe instanceof Te||(xe=new Te(xe)),this.decode(xe,xe.uint32())},be.verify=function(xe){if(typeof xe!="object"||xe===null)return"object expected";if(xe.documentId!=null&&xe.hasOwnProperty("documentId")&&!t.isString(xe.documentId))return"documentId: string expected";if(xe.commentThreadId!=null&&xe.hasOwnProperty("commentThreadId")&&!t.isString(xe.commentThreadId))return"commentThreadId: string expected";if(xe.context!=null&&xe.hasOwnProperty("context")&&!t.isString(xe.context))return"context: string expected";if(xe.createdAt!=null&&xe.hasOwnProperty("createdAt")&&!t.isString(xe.createdAt))return"createdAt: string expected";if(xe.resolvedAt!=null&&xe.hasOwnProperty("resolvedAt")&&!t.isString(xe.resolvedAt))return"resolvedAt: string expected";if(xe.resolvedBy!=null&&xe.hasOwnProperty("resolvedBy")&&!t.isString(xe.resolvedBy))return"resolvedBy: string expected";if(xe.attributes!=null&&xe.hasOwnProperty("attributes")&&!t.isString(xe.attributes))return"attributes: string expected";if(xe.deletedAt!=null&&xe.hasOwnProperty("deletedAt")&&!t.isString(xe.deletedAt))return"deletedAt: string expected";if(xe.comments!=null&&xe.hasOwnProperty("comments")){if(!Array.isArray(xe.comments))return"comments: array expected";for(var ve=0;ve<xe.comments.length;++ve){var ke=te.CommentDescriptor.verify(xe.comments[ve]);if(ke)return"comments."+ke}}return null},be.fromObject=function(xe){if(xe instanceof te.CommentsV2AddCommentThreadMessage)return xe;var ve=new te.CommentsV2AddCommentThreadMessage;if(xe.documentId!=null&&(ve.documentId=String(xe.documentId)),xe.commentThreadId!=null&&(ve.commentThreadId=String(xe.commentThreadId)),xe.context!=null&&(ve.context=String(xe.context)),xe.createdAt!=null&&(ve.createdAt=String(xe.createdAt)),xe.resolvedAt!=null&&(ve.resolvedAt=String(xe.resolvedAt)),xe.resolvedBy!=null&&(ve.resolvedBy=String(xe.resolvedBy)),xe.attributes!=null&&(ve.attributes=String(xe.attributes)),xe.deletedAt!=null&&(ve.deletedAt=String(xe.deletedAt)),xe.comments){if(!Array.isArray(xe.comments))throw TypeError(".CommentsV2AddCommentThreadMessage.comments: array expected");ve.comments=[];for(var ke=0;ke<xe.comments.length;++ke){if(typeof xe.comments[ke]!="object")throw TypeError(".CommentsV2AddCommentThreadMessage.comments: object expected");ve.comments[ke]=te.CommentDescriptor.fromObject(xe.comments[ke])}}return ve},be.toObject=function(xe,ve){ve||(ve={});var ke={};if((ve.arrays||ve.defaults)&&(ke.comments=[]),ve.defaults&&(ke.documentId="",ke.commentThreadId="",ke.context="",ke.createdAt="",ke.resolvedAt="",ke.resolvedBy="",ke.attributes="",ke.deletedAt=""),xe.documentId!=null&&xe.hasOwnProperty("documentId")&&(ke.documentId=xe.documentId),xe.commentThreadId!=null&&xe.hasOwnProperty("commentThreadId")&&(ke.commentThreadId=xe.commentThreadId),xe.context!=null&&xe.hasOwnProperty("context")&&(ke.context=xe.context),xe.createdAt!=null&&xe.hasOwnProperty("createdAt")&&(ke.createdAt=xe.createdAt),xe.resolvedAt!=null&&xe.hasOwnProperty("resolvedAt")&&(ke.resolvedAt=xe.resolvedAt),xe.resolvedBy!=null&&xe.hasOwnProperty("resolvedBy")&&(ke.resolvedBy=xe.resolvedBy),xe.attributes!=null&&xe.hasOwnProperty("attributes")&&(ke.attributes=xe.attributes),xe.deletedAt!=null&&xe.hasOwnProperty("deletedAt")&&(ke.deletedAt=xe.deletedAt),xe.comments&&xe.comments.length){ke.comments=[];for(var Ie=0;Ie<xe.comments.length;++Ie)ke.comments[Ie]=te.CommentDescriptor.toObject(xe.comments[Ie],ve)}return ke},be.prototype.toJSON=function(){return this.constructor.toObject(this,_0x462d7f.util.toJSONOptions)},be.getTypeUrl=function(xe){return xe===void 0&&(xe="type.googleapis.com"),xe+"/CommentsV2AddCommentThreadMessage"},be}(),te.CommentsV2ReopenCommentThreadMessage=function(){function be(xe){if(xe)for(var ve=Object.keys(xe),ke=0;ke<ve.length;++ke)xe[ve[ke]]!=null&&(this[ve[ke]]=xe[ve[ke]])}return be.prototype.commentThreadId="",be.prototype.documentId="",be.create=function(xe){return new be(xe)},be.encode=function(xe,ve){return ve||(ve=we.create()),xe.commentThreadId!=null&&Object.hasOwnProperty.call(xe,"commentThreadId")&&ve.uint32(10).string(xe.commentThreadId),xe.documentId!=null&&Object.hasOwnProperty.call(xe,"documentId")&&ve.uint32(18).string(xe.documentId),ve},be.encodeDelimited=function(xe,ve){return this.encode(xe,ve).ldelim()},be.decode=function(xe,ve){xe instanceof Te||(xe=Te.create(xe));for(var ke=ve===void 0?xe.len:xe.pos+ve,Ie=new te.CommentsV2ReopenCommentThreadMessage;xe.pos<ke;){var Ae=xe.uint32();switch(Ae>>>3){case 1:Ie.commentThreadId=xe.string();break;case 2:Ie.documentId=xe.string();break;default:xe.skipType(7&Ae)}}return Ie},be.decodeDelimited=function(xe){return xe instanceof Te||(xe=new Te(xe)),this.decode(xe,xe.uint32())},be.verify=function(xe){return typeof xe!="object"||xe===null?"object expected":xe.commentThreadId!=null&&xe.hasOwnProperty("commentThreadId")&&!t.isString(xe.commentThreadId)?"commentThreadId: string expected":xe.documentId!=null&&xe.hasOwnProperty("documentId")&&!t.isString(xe.documentId)?"documentId: string expected":null},be.fromObject=function(xe){if(xe instanceof te.CommentsV2ReopenCommentThreadMessage)return xe;var ve=new te.CommentsV2ReopenCommentThreadMessage;return xe.commentThreadId!=null&&(ve.commentThreadId=String(xe.commentThreadId)),xe.documentId!=null&&(ve.documentId=String(xe.documentId)),ve},be.toObject=function(xe,ve){ve||(ve={});var ke={};return ve.defaults&&(ke.commentThreadId="",ke.documentId=""),xe.commentThreadId!=null&&xe.hasOwnProperty("commentThreadId")&&(ke.commentThreadId=xe.commentThreadId),xe.documentId!=null&&xe.hasOwnProperty("documentId")&&(ke.documentId=xe.documentId),ke},be.prototype.toJSON=function(){return this.constructor.toObject(this,_0x462d7f.util.toJSONOptions)},be.getTypeUrl=function(xe){return xe===void 0&&(xe="type.googleapis.com"),xe+"/CommentsV2ReopenCommentThreadMessage"},be}(),te.CommentsV2ResolveCommentThreadMessage=function(){function be(xe){if(xe)for(var ve=Object.keys(xe),ke=0;ke<ve.length;++ke)xe[ve[ke]]!=null&&(this[ve[ke]]=xe[ve[ke]])}return be.prototype.commentThreadId="",be.prototype.documentId="",be.prototype.resolvedBy="",be.prototype.resolvedAt="",be.create=function(xe){return new be(xe)},be.encode=function(xe,ve){return ve||(ve=we.create()),xe.commentThreadId!=null&&Object.hasOwnProperty.call(xe,"commentThreadId")&&ve.uint32(10).string(xe.commentThreadId),xe.documentId!=null&&Object.hasOwnProperty.call(xe,"documentId")&&ve.uint32(18).string(xe.documentId),xe.resolvedBy!=null&&Object.hasOwnProperty.call(xe,"resolvedBy")&&ve.uint32(26).string(xe.resolvedBy),xe.resolvedAt!=null&&Object.hasOwnProperty.call(xe,"resolvedAt")&&ve.uint32(34).string(xe.resolvedAt),ve},be.encodeDelimited=function(xe,ve){return this.encode(xe,ve).ldelim()},be.decode=function(xe,ve){xe instanceof Te||(xe=Te.create(xe));for(var ke=ve===void 0?xe.len:xe.pos+ve,Ie=new te.CommentsV2ResolveCommentThreadMessage;xe.pos<ke;){var Ae=xe.uint32();switch(Ae>>>3){case 1:Ie.commentThreadId=xe.string();break;case 2:Ie.documentId=xe.string();break;case 3:Ie.resolvedBy=xe.string();break;case 4:Ie.resolvedAt=xe.string();break;default:xe.skipType(7&Ae)}}return Ie},be.decodeDelimited=function(xe){return xe instanceof Te||(xe=new Te(xe)),this.decode(xe,xe.uint32())},be.verify=function(xe){return typeof xe!="object"||xe===null?"object expected":xe.commentThreadId!=null&&xe.hasOwnProperty("commentThreadId")&&!t.isString(xe.commentThreadId)?"commentThreadId: string expected":xe.documentId!=null&&xe.hasOwnProperty("documentId")&&!t.isString(xe.documentId)?"documentId: string expected":xe.resolvedBy!=null&&xe.hasOwnProperty("resolvedBy")&&!t.isString(xe.resolvedBy)?"resolvedBy: string expected":xe.resolvedAt!=null&&xe.hasOwnProperty("resolvedAt")&&!t.isString(xe.resolvedAt)?"resolvedAt: string expected":null},be.fromObject=function(xe){if(xe instanceof te.CommentsV2ResolveCommentThreadMessage)return xe;var ve=new te.CommentsV2ResolveCommentThreadMessage;return xe.commentThreadId!=null&&(ve.commentThreadId=String(xe.commentThreadId)),xe.documentId!=null&&(ve.documentId=String(xe.documentId)),xe.resolvedBy!=null&&(ve.resolvedBy=String(xe.resolvedBy)),xe.resolvedAt!=null&&(ve.resolvedAt=String(xe.resolvedAt)),ve},be.toObject=function(xe,ve){ve||(ve={});var ke={};return ve.defaults&&(ke.commentThreadId="",ke.documentId="",ke.resolvedBy="",ke.resolvedAt=""),xe.commentThreadId!=null&&xe.hasOwnProperty("commentThreadId")&&(ke.commentThreadId=xe.commentThreadId),xe.documentId!=null&&xe.hasOwnProperty("documentId")&&(ke.documentId=xe.documentId),xe.resolvedBy!=null&&xe.hasOwnProperty("resolvedBy")&&(ke.resolvedBy=xe.resolvedBy),xe.resolvedAt!=null&&xe.hasOwnProperty("resolvedAt")&&(ke.resolvedAt=xe.resolvedAt),ke},be.prototype.toJSON=function(){return this.constructor.toObject(this,_0x462d7f.util.toJSONOptions)},be.getTypeUrl=function(xe){return xe===void 0&&(xe="type.googleapis.com"),xe+"/CommentsV2ResolveCommentThreadMessage"},be}(),te.CommentsV2UpdateCommentThreadMessage=function(){function be(xe){if(xe)for(var ve=Object.keys(xe),ke=0;ke<ve.length;++ke)xe[ve[ke]]!=null&&(this[ve[ke]]=xe[ve[ke]])}return be.prototype.commentThreadId="",be.prototype.documentId="",be.prototype.context="",be.prototype.attributes="",be.prototype.unlinkedAt="",be.create=function(xe){return new be(xe)},be.encode=function(xe,ve){return ve||(ve=we.create()),xe.commentThreadId!=null&&Object.hasOwnProperty.call(xe,"commentThreadId")&&ve.uint32(10).string(xe.commentThreadId),xe.documentId!=null&&Object.hasOwnProperty.call(xe,"documentId")&&ve.uint32(18).string(xe.documentId),xe.context!=null&&Object.hasOwnProperty.call(xe,"context")&&ve.uint32(26).string(xe.context),xe.attributes!=null&&Object.hasOwnProperty.call(xe,"attributes")&&ve.uint32(34).string(xe.attributes),xe.unlinkedAt!=null&&Object.hasOwnProperty.call(xe,"unlinkedAt")&&ve.uint32(42).string(xe.unlinkedAt),ve},be.encodeDelimited=function(xe,ve){return this.encode(xe,ve).ldelim()},be.decode=function(xe,ve){xe instanceof Te||(xe=Te.create(xe));for(var ke=ve===void 0?xe.len:xe.pos+ve,Ie=new te.CommentsV2UpdateCommentThreadMessage;xe.pos<ke;){var Ae=xe.uint32();switch(Ae>>>3){case 1:Ie.commentThreadId=xe.string();break;case 2:Ie.documentId=xe.string();break;case 3:Ie.context=xe.string();break;case 4:Ie.attributes=xe.string();break;case 5:Ie.unlinkedAt=xe.string();break;default:xe.skipType(7&Ae)}}return Ie},be.decodeDelimited=function(xe){return xe instanceof Te||(xe=new Te(xe)),this.decode(xe,xe.uint32())},be.verify=function(xe){return typeof xe!="object"||xe===null?"object expected":xe.commentThreadId!=null&&xe.hasOwnProperty("commentThreadId")&&!t.isString(xe.commentThreadId)?"commentThreadId: string expected":xe.documentId!=null&&xe.hasOwnProperty("documentId")&&!t.isString(xe.documentId)?"documentId: string expected":xe.context!=null&&xe.hasOwnProperty("context")&&!t.isString(xe.context)?"context: string expected":xe.attributes!=null&&xe.hasOwnProperty("attributes")&&!t.isString(xe.attributes)?"attributes: string expected":xe.unlinkedAt!=null&&xe.hasOwnProperty("unlinkedAt")&&!t.isString(xe.unlinkedAt)?"unlinkedAt: string expected":null},be.fromObject=function(xe){if(xe instanceof te.CommentsV2UpdateCommentThreadMessage)return xe;var ve=new te.CommentsV2UpdateCommentThreadMessage;return xe.commentThreadId!=null&&(ve.commentThreadId=String(xe.commentThreadId)),xe.documentId!=null&&(ve.documentId=String(xe.documentId)),xe.context!=null&&(ve.context=String(xe.context)),xe.attributes!=null&&(ve.attributes=String(xe.attributes)),xe.unlinkedAt!=null&&(ve.unlinkedAt=String(xe.unlinkedAt)),ve},be.toObject=function(xe,ve){ve||(ve={});var ke={};return ve.defaults&&(ke.commentThreadId="",ke.documentId="",ke.context="",ke.attributes="",ke.unlinkedAt=""),xe.commentThreadId!=null&&xe.hasOwnProperty("commentThreadId")&&(ke.commentThreadId=xe.commentThreadId),xe.documentId!=null&&xe.hasOwnProperty("documentId")&&(ke.documentId=xe.documentId),xe.context!=null&&xe.hasOwnProperty("context")&&(ke.context=xe.context),xe.attributes!=null&&xe.hasOwnProperty("attributes")&&(ke.attributes=xe.attributes),xe.unlinkedAt!=null&&xe.hasOwnProperty("unlinkedAt")&&(ke.unlinkedAt=xe.unlinkedAt),ke},be.prototype.toJSON=function(){return this.constructor.toObject(this,_0x462d7f.util.toJSONOptions)},be.getTypeUrl=function(xe){return xe===void 0&&(xe="type.googleapis.com"),xe+"/CommentsV2UpdateCommentThreadMessage"},be}(),te.CommentsV2ConnectMessage=function(){function be(xe){if(xe)for(var ve=Object.keys(xe),ke=0;ke<ve.length;++ke)xe[ve[ke]]!=null&&(this[ve[ke]]=xe[ve[ke]])}return be.prototype.documentId="",be.create=function(xe){return new be(xe)},be.encode=function(xe,ve){return ve||(ve=we.create()),xe.documentId!=null&&Object.hasOwnProperty.call(xe,"documentId")&&ve.uint32(10).string(xe.documentId),ve},be.encodeDelimited=function(xe,ve){return this.encode(xe,ve).ldelim()},be.decode=function(xe,ve){xe instanceof Te||(xe=Te.create(xe));for(var ke=ve===void 0?xe.len:xe.pos+ve,Ie=new te.CommentsV2ConnectMessage;xe.pos<ke;){var Ae=xe.uint32();Ae>>>3==1?Ie.documentId=xe.string():xe.skipType(7&Ae)}return Ie},be.decodeDelimited=function(xe){return xe instanceof Te||(xe=new Te(xe)),this.decode(xe,xe.uint32())},be.verify=function(xe){return typeof xe!="object"||xe===null?"object expected":xe.documentId!=null&&xe.hasOwnProperty("documentId")&&!t.isString(xe.documentId)?"documentId: string expected":null},be.fromObject=function(xe){if(xe instanceof te.CommentsV2ConnectMessage)return xe;var ve=new te.CommentsV2ConnectMessage;return xe.documentId!=null&&(ve.documentId=String(xe.documentId)),ve},be.toObject=function(xe,ve){ve||(ve={});var ke={};return ve.defaults&&(ke.documentId=""),xe.documentId!=null&&xe.hasOwnProperty("documentId")&&(ke.documentId=xe.documentId),ke},be.prototype.toJSON=function(){return this.constructor.toObject(this,_0x462d7f.util.toJSONOptions)},be.getTypeUrl=function(xe){return xe===void 0&&(xe="type.googleapis.com"),xe+"/CommentsV2ConnectMessage"},be}(),te.CommentsV2GetCommentThreadMessage=function(){function be(xe){if(xe)for(var ve=Object.keys(xe),ke=0;ke<ve.length;++ke)xe[ve[ke]]!=null&&(this[ve[ke]]=xe[ve[ke]])}return be.prototype.commentThreadId="",be.prototype.documentId="",be.create=function(xe){return new be(xe)},be.encode=function(xe,ve){return ve||(ve=we.create()),xe.commentThreadId!=null&&Object.hasOwnProperty.call(xe,"commentThreadId")&&ve.uint32(10).string(xe.commentThreadId),xe.documentId!=null&&Object.hasOwnProperty.call(xe,"documentId")&&ve.uint32(18).string(xe.documentId),ve},be.encodeDelimited=function(xe,ve){return this.encode(xe,ve).ldelim()},be.decode=function(xe,ve){xe instanceof Te||(xe=Te.create(xe));for(var ke=ve===void 0?xe.len:xe.pos+ve,Ie=new te.CommentsV2GetCommentThreadMessage;xe.pos<ke;){var Ae=xe.uint32();switch(Ae>>>3){case 1:Ie.commentThreadId=xe.string();break;case 2:Ie.documentId=xe.string();break;default:xe.skipType(7&Ae)}}return Ie},be.decodeDelimited=function(xe){return xe instanceof Te||(xe=new Te(xe)),this.decode(xe,xe.uint32())},be.verify=function(xe){return typeof xe!="object"||xe===null?"object expected":xe.commentThreadId!=null&&xe.hasOwnProperty("commentThreadId")&&!t.isString(xe.commentThreadId)?"commentThreadId: string expected":xe.documentId!=null&&xe.hasOwnProperty("documentId")&&!t.isString(xe.documentId)?"documentId: string expected":null},be.fromObject=function(xe){if(xe instanceof te.CommentsV2GetCommentThreadMessage)return xe;var ve=new te.CommentsV2GetCommentThreadMessage;return xe.commentThreadId!=null&&(ve.commentThreadId=String(xe.commentThreadId)),xe.documentId!=null&&(ve.documentId=String(xe.documentId)),ve},be.toObject=function(xe,ve){ve||(ve={});var ke={};return ve.defaults&&(ke.commentThreadId="",ke.documentId=""),xe.commentThreadId!=null&&xe.hasOwnProperty("commentThreadId")&&(ke.commentThreadId=xe.commentThreadId),xe.documentId!=null&&xe.hasOwnProperty("documentId")&&(ke.documentId=xe.documentId),ke},be.prototype.toJSON=function(){return this.constructor.toObject(this,_0x462d7f.util.toJSONOptions)},be.getTypeUrl=function(xe){return xe===void 0&&(xe="type.googleapis.com"),xe+"/CommentsV2GetCommentThreadMessage"},be}(),te.CommentsV2GetDocumentThreadsMessage=function(){function be(xe){if(xe)for(var ve=Object.keys(xe),ke=0;ke<ve.length;++ke)xe[ve[ke]]!=null&&(this[ve[ke]]=xe[ve[ke]])}return be.prototype.documentId="",be.create=function(xe){return new be(xe)},be.encode=function(xe,ve){return ve||(ve=we.create()),xe.documentId!=null&&Object.hasOwnProperty.call(xe,"documentId")&&ve.uint32(10).string(xe.documentId),ve},be.encodeDelimited=function(xe,ve){return this.encode(xe,ve).ldelim()},be.decode=function(xe,ve){xe instanceof Te||(xe=Te.create(xe));for(var ke=ve===void 0?xe.len:xe.pos+ve,Ie=new te.CommentsV2GetDocumentThreadsMessage;xe.pos<ke;){var Ae=xe.uint32();Ae>>>3==1?Ie.documentId=xe.string():xe.skipType(7&Ae)}return Ie},be.decodeDelimited=function(xe){return xe instanceof Te||(xe=new Te(xe)),this.decode(xe,xe.uint32())},be.verify=function(xe){return typeof xe!="object"||xe===null?"object expected":xe.documentId!=null&&xe.hasOwnProperty("documentId")&&!t.isString(xe.documentId)?"documentId: string expected":null},be.fromObject=function(xe){if(xe instanceof te.CommentsV2GetDocumentThreadsMessage)return xe;var ve=new te.CommentsV2GetDocumentThreadsMessage;return xe.documentId!=null&&(ve.documentId=String(xe.documentId)),ve},be.toObject=function(xe,ve){ve||(ve={});var ke={};return ve.defaults&&(ke.documentId=""),xe.documentId!=null&&xe.hasOwnProperty("documentId")&&(ke.documentId=xe.documentId),ke},be.prototype.toJSON=function(){return this.constructor.toObject(this,_0x462d7f.util.toJSONOptions)},be.getTypeUrl=function(xe){return xe===void 0&&(xe="type.googleapis.com"),xe+"/CommentsV2GetDocumentThreadsMessage"},be}(),te.CommentsV2RemoveCommentMessage=function(){function be(xe){if(xe)for(var ve=Object.keys(xe),ke=0;ke<ve.length;++ke)xe[ve[ke]]!=null&&(this[ve[ke]]=xe[ve[ke]])}return be.prototype.commentThreadId="",be.prototype.commentId="",be.prototype.documentId="",be.create=function(xe){return new be(xe)},be.encode=function(xe,ve){return ve||(ve=we.create()),xe.commentThreadId!=null&&Object.hasOwnProperty.call(xe,"commentThreadId")&&ve.uint32(10).string(xe.commentThreadId),xe.commentId!=null&&Object.hasOwnProperty.call(xe,"commentId")&&ve.uint32(18).string(xe.commentId),xe.documentId!=null&&Object.hasOwnProperty.call(xe,"documentId")&&ve.uint32(26).string(xe.documentId),ve},be.encodeDelimited=function(xe,ve){return this.encode(xe,ve).ldelim()},be.decode=function(xe,ve){xe instanceof Te||(xe=Te.create(xe));for(var ke=ve===void 0?xe.len:xe.pos+ve,Ie=new te.CommentsV2RemoveCommentMessage;xe.pos<ke;){var Ae=xe.uint32();switch(Ae>>>3){case 1:Ie.commentThreadId=xe.string();break;case 2:Ie.commentId=xe.string();break;case 3:Ie.documentId=xe.string();break;default:xe.skipType(7&Ae)}}return Ie},be.decodeDelimited=function(xe){return xe instanceof Te||(xe=new Te(xe)),this.decode(xe,xe.uint32())},be.verify=function(xe){return typeof xe!="object"||xe===null?"object expected":xe.commentThreadId!=null&&xe.hasOwnProperty("commentThreadId")&&!t.isString(xe.commentThreadId)?"commentThreadId: string expected":xe.commentId!=null&&xe.hasOwnProperty("commentId")&&!t.isString(xe.commentId)?"commentId: string expected":xe.documentId!=null&&xe.hasOwnProperty("documentId")&&!t.isString(xe.documentId)?"documentId: string expected":null},be.fromObject=function(xe){if(xe instanceof te.CommentsV2RemoveCommentMessage)return xe;var ve=new te.CommentsV2RemoveCommentMessage;return xe.commentThreadId!=null&&(ve.commentThreadId=String(xe.commentThreadId)),xe.commentId!=null&&(ve.commentId=String(xe.commentId)),xe.documentId!=null&&(ve.documentId=String(xe.documentId)),ve},be.toObject=function(xe,ve){ve||(ve={});var ke={};return ve.defaults&&(ke.commentThreadId="",ke.commentId="",ke.documentId=""),xe.commentThreadId!=null&&xe.hasOwnProperty("commentThreadId")&&(ke.commentThreadId=xe.commentThreadId),xe.commentId!=null&&xe.hasOwnProperty("commentId")&&(ke.commentId=xe.commentId),xe.documentId!=null&&xe.hasOwnProperty("documentId")&&(ke.documentId=xe.documentId),ke},be.prototype.toJSON=function(){return this.constructor.toObject(this,_0x462d7f.util.toJSONOptions)},be.getTypeUrl=function(xe){return xe===void 0&&(xe="type.googleapis.com"),xe+"/CommentsV2RemoveCommentMessage"},be}(),te.CommentsV2RemoveCommentThreadMessage=function(){function be(xe){if(xe)for(var ve=Object.keys(xe),ke=0;ke<ve.length;++ke)xe[ve[ke]]!=null&&(this[ve[ke]]=xe[ve[ke]])}return be.prototype.commentThreadId="",be.prototype.documentId="",be.create=function(xe){return new be(xe)},be.encode=function(xe,ve){return ve||(ve=we.create()),xe.commentThreadId!=null&&Object.hasOwnProperty.call(xe,"commentThreadId")&&ve.uint32(10).string(xe.commentThreadId),xe.documentId!=null&&Object.hasOwnProperty.call(xe,"documentId")&&ve.uint32(18).string(xe.documentId),ve},be.encodeDelimited=function(xe,ve){return this.encode(xe,ve).ldelim()},be.decode=function(xe,ve){xe instanceof Te||(xe=Te.create(xe));for(var ke=ve===void 0?xe.len:xe.pos+ve,Ie=new te.CommentsV2RemoveCommentThreadMessage;xe.pos<ke;){var Ae=xe.uint32();switch(Ae>>>3){case 1:Ie.commentThreadId=xe.string();break;case 2:Ie.documentId=xe.string();break;default:xe.skipType(7&Ae)}}return Ie},be.decodeDelimited=function(xe){return xe instanceof Te||(xe=new Te(xe)),this.decode(xe,xe.uint32())},be.verify=function(xe){return typeof xe!="object"||xe===null?"object expected":xe.commentThreadId!=null&&xe.hasOwnProperty("commentThreadId")&&!t.isString(xe.commentThreadId)?"commentThreadId: string expected":xe.documentId!=null&&xe.hasOwnProperty("documentId")&&!t.isString(xe.documentId)?"documentId: string expected":null},be.fromObject=function(xe){if(xe instanceof te.CommentsV2RemoveCommentThreadMessage)return xe;var ve=new te.CommentsV2RemoveCommentThreadMessage;return xe.commentThreadId!=null&&(ve.commentThreadId=String(xe.commentThreadId)),xe.documentId!=null&&(ve.documentId=String(xe.documentId)),ve},be.toObject=function(xe,ve){ve||(ve={});var ke={};return ve.defaults&&(ke.commentThreadId="",ke.documentId=""),xe.commentThreadId!=null&&xe.hasOwnProperty("commentThreadId")&&(ke.commentThreadId=xe.commentThreadId),xe.documentId!=null&&xe.hasOwnProperty("documentId")&&(ke.documentId=xe.documentId),ke},be.prototype.toJSON=function(){return this.constructor.toObject(this,_0x462d7f.util.toJSONOptions)},be.getTypeUrl=function(xe){return xe===void 0&&(xe="type.googleapis.com"),xe+"/CommentsV2RemoveCommentThreadMessage"},be}(),te.CommentsV2UpdateCommentMessage=function(){function be(xe){if(xe)for(var ve=Object.keys(xe),ke=0;ke<ve.length;++ke)xe[ve[ke]]!=null&&(this[ve[ke]]=xe[ve[ke]])}return be.prototype.commentThreadId="",be.prototype.commentId="",be.prototype.content="",be.prototype.documentId="",be.prototype.attributes="",be.prototype.isAttributesUpdated=!1,be.prototype.commentThread=null,be.create=function(xe){return new be(xe)},be.encode=function(xe,ve){return ve||(ve=we.create()),xe.commentThreadId!=null&&Object.hasOwnProperty.call(xe,"commentThreadId")&&ve.uint32(10).string(xe.commentThreadId),xe.commentId!=null&&Object.hasOwnProperty.call(xe,"commentId")&&ve.uint32(18).string(xe.commentId),xe.content!=null&&Object.hasOwnProperty.call(xe,"content")&&ve.uint32(26).string(xe.content),xe.documentId!=null&&Object.hasOwnProperty.call(xe,"documentId")&&ve.uint32(34).string(xe.documentId),xe.attributes!=null&&Object.hasOwnProperty.call(xe,"attributes")&&ve.uint32(42).string(xe.attributes),xe.isAttributesUpdated!=null&&Object.hasOwnProperty.call(xe,"isAttributesUpdated")&&ve.uint32(48).bool(xe.isAttributesUpdated),xe.commentThread!=null&&Object.hasOwnProperty.call(xe,"commentThread")&&te.CommentsThreadDescriptor.encode(xe.commentThread,ve.uint32(58).fork()).ldelim(),ve},be.encodeDelimited=function(xe,ve){return this.encode(xe,ve).ldelim()},be.decode=function(xe,ve){xe instanceof Te||(xe=Te.create(xe));for(var ke=ve===void 0?xe.len:xe.pos+ve,Ie=new te.CommentsV2UpdateCommentMessage;xe.pos<ke;){var Ae=xe.uint32();switch(Ae>>>3){case 1:Ie.commentThreadId=xe.string();break;case 2:Ie.commentId=xe.string();break;case 3:Ie.content=xe.string();break;case 4:Ie.documentId=xe.string();break;case 5:Ie.attributes=xe.string();break;case 6:Ie.isAttributesUpdated=xe.bool();break;case 7:Ie.commentThread=te.CommentsThreadDescriptor.decode(xe,xe.uint32());break;default:xe.skipType(7&Ae)}}return Ie},be.decodeDelimited=function(xe){return xe instanceof Te||(xe=new Te(xe)),this.decode(xe,xe.uint32())},be.verify=function(xe){if(typeof xe!="object"||xe===null)return"object expected";if(xe.commentThreadId!=null&&xe.hasOwnProperty("commentThreadId")&&!t.isString(xe.commentThreadId))return"commentThreadId: string expected";if(xe.commentId!=null&&xe.hasOwnProperty("commentId")&&!t.isString(xe.commentId))return"commentId: string expected";if(xe.content!=null&&xe.hasOwnProperty("content")&&!t.isString(xe.content))return"content: string expected";if(xe.documentId!=null&&xe.hasOwnProperty("documentId")&&!t.isString(xe.documentId))return"documentId: string expected";if(xe.attributes!=null&&xe.hasOwnProperty("attributes")&&!t.isString(xe.attributes))return"attributes: string expected";if(xe.isAttributesUpdated!=null&&xe.hasOwnProperty("isAttributesUpdated")&&typeof xe.isAttributesUpdated!="boolean")return"isAttributesUpdated: boolean expected";if(xe.commentThread!=null&&xe.hasOwnProperty("commentThread")){var ve=te.CommentsThreadDescriptor.verify(xe.commentThread);if(ve)return"commentThread."+ve}return null},be.fromObject=function(xe){if(xe instanceof te.CommentsV2UpdateCommentMessage)return xe;var ve=new te.CommentsV2UpdateCommentMessage;if(xe.commentThreadId!=null&&(ve.commentThreadId=String(xe.commentThreadId)),xe.commentId!=null&&(ve.commentId=String(xe.commentId)),xe.content!=null&&(ve.content=String(xe.content)),xe.documentId!=null&&(ve.documentId=String(xe.documentId)),xe.attributes!=null&&(ve.attributes=String(xe.attributes)),xe.isAttributesUpdated!=null&&(ve.isAttributesUpdated=!!xe.isAttributesUpdated),xe.commentThread!=null){if(typeof xe.commentThread!="object")throw TypeError(".CommentsV2UpdateCommentMessage.commentThread: object expected");ve.commentThread=te.CommentsThreadDescriptor.fromObject(xe.commentThread)}return ve},be.toObject=function(xe,ve){ve||(ve={});var ke={};return ve.defaults&&(ke.commentThreadId="",ke.commentId="",ke.content="",ke.documentId="",ke.attributes="",ke.isAttributesUpdated=!1,ke.commentThread=null),xe.commentThreadId!=null&&xe.hasOwnProperty("commentThreadId")&&(ke.commentThreadId=xe.commentThreadId),xe.commentId!=null&&xe.hasOwnProperty("commentId")&&(ke.commentId=xe.commentId),xe.content!=null&&xe.hasOwnProperty("content")&&(ke.content=xe.content),xe.documentId!=null&&xe.hasOwnProperty("documentId")&&(ke.documentId=xe.documentId),xe.attributes!=null&&xe.hasOwnProperty("attributes")&&(ke.attributes=xe.attributes),xe.isAttributesUpdated!=null&&xe.hasOwnProperty("isAttributesUpdated")&&(ke.isAttributesUpdated=xe.isAttributesUpdated),xe.commentThread!=null&&xe.hasOwnProperty("commentThread")&&(ke.commentThread=te.CommentsThreadDescriptor.toObject(xe.commentThread,ve)),ke},be.prototype.toJSON=function(){return this.constructor.toObject(this,_0x462d7f.util.toJSONOptions)},be.getTypeUrl=function(xe){return xe===void 0&&(xe="type.googleapis.com"),xe+"/CommentsV2UpdateCommentMessage"},be}(),te.CommentsV2AddCommentResponse=function(){function be(xe){if(xe)for(var ve=Object.keys(xe),ke=0;ke<ve.length;++ke)xe[ve[ke]]!=null&&(this[ve[ke]]=xe[ve[ke]])}return be.prototype.commentThreadId="",be.prototype.commentId="",be.prototype.createdAt="",be.create=function(xe){return new be(xe)},be.encode=function(xe,ve){return ve||(ve=we.create()),xe.commentThreadId!=null&&Object.hasOwnProperty.call(xe,"commentThreadId")&&ve.uint32(10).string(xe.commentThreadId),xe.commentId!=null&&Object.hasOwnProperty.call(xe,"commentId")&&ve.uint32(18).string(xe.commentId),xe.createdAt!=null&&Object.hasOwnProperty.call(xe,"createdAt")&&ve.uint32(26).string(xe.createdAt),ve},be.encodeDelimited=function(xe,ve){return this.encode(xe,ve).ldelim()},be.decode=function(xe,ve){xe instanceof Te||(xe=Te.create(xe));for(var ke=ve===void 0?xe.len:xe.pos+ve,Ie=new te.CommentsV2AddCommentResponse;xe.pos<ke;){var Ae=xe.uint32();switch(Ae>>>3){case 1:Ie.commentThreadId=xe.string();break;case 2:Ie.commentId=xe.string();break;case 3:Ie.createdAt=xe.string();break;default:xe.skipType(7&Ae)}}return Ie},be.decodeDelimited=function(xe){return xe instanceof Te||(xe=new Te(xe)),this.decode(xe,xe.uint32())},be.verify=function(xe){return typeof xe!="object"||xe===null?"object expected":xe.commentThreadId!=null&&xe.hasOwnProperty("commentThreadId")&&!t.isString(xe.commentThreadId)?"commentThreadId: string expected":xe.commentId!=null&&xe.hasOwnProperty("commentId")&&!t.isString(xe.commentId)?"commentId: string expected":xe.createdAt!=null&&xe.hasOwnProperty("createdAt")&&!t.isString(xe.createdAt)?"createdAt: string expected":null},be.fromObject=function(xe){if(xe instanceof te.CommentsV2AddCommentResponse)return xe;var ve=new te.CommentsV2AddCommentResponse;return xe.commentThreadId!=null&&(ve.commentThreadId=String(xe.commentThreadId)),xe.commentId!=null&&(ve.commentId=String(xe.commentId)),xe.createdAt!=null&&(ve.createdAt=String(xe.createdAt)),ve},be.toObject=function(xe,ve){ve||(ve={});var ke={};return ve.defaults&&(ke.commentThreadId="",ke.commentId="",ke.createdAt=""),xe.commentThreadId!=null&&xe.hasOwnProperty("commentThreadId")&&(ke.commentThreadId=xe.commentThreadId),xe.commentId!=null&&xe.hasOwnProperty("commentId")&&(ke.commentId=xe.commentId),xe.createdAt!=null&&xe.hasOwnProperty("createdAt")&&(ke.createdAt=xe.createdAt),ke},be.prototype.toJSON=function(){return this.constructor.toObject(this,_0x462d7f.util.toJSONOptions)},be.getTypeUrl=function(xe){return xe===void 0&&(xe="type.googleapis.com"),xe+"/CommentsV2AddCommentResponse"},be}(),te.CommentsV2AddCommentThreadResponse=function(){function be(xe){if(this.comments=[],xe)for(var ve=Object.keys(xe),ke=0;ke<ve.length;++ke)xe[ve[ke]]!=null&&(this[ve[ke]]=xe[ve[ke]])}return be.prototype.commentThreadId="",be.prototype.createdAt="",be.prototype.comments=t.emptyArray,be.create=function(xe){return new be(xe)},be.encode=function(xe,ve){if(ve||(ve=we.create()),xe.commentThreadId!=null&&Object.hasOwnProperty.call(xe,"commentThreadId")&&ve.uint32(10).string(xe.commentThreadId),xe.createdAt!=null&&Object.hasOwnProperty.call(xe,"createdAt")&&ve.uint32(18).string(xe.createdAt),xe.comments!=null&&xe.comments.length)for(var ke=0;ke<xe.comments.length;++ke)te.CommentThreadAddedCommentDescriptor.encode(xe.comments[ke],ve.uint32(26).fork()).ldelim();return ve},be.encodeDelimited=function(xe,ve){return this.encode(xe,ve).ldelim()},be.decode=function(xe,ve){xe instanceof Te||(xe=Te.create(xe));for(var ke=ve===void 0?xe.len:xe.pos+ve,Ie=new te.CommentsV2AddCommentThreadResponse;xe.pos<ke;){var Ae=xe.uint32();switch(Ae>>>3){case 1:Ie.commentThreadId=xe.string();break;case 2:Ie.createdAt=xe.string();break;case 3:Ie.comments&&Ie.comments.length||(Ie.comments=[]),Ie.comments.push(te.CommentThreadAddedCommentDescriptor.decode(xe,xe.uint32()));break;default:xe.skipType(7&Ae)}}return Ie},be.decodeDelimited=function(xe){return xe instanceof Te||(xe=new Te(xe)),this.decode(xe,xe.uint32())},be.verify=function(xe){if(typeof xe!="object"||xe===null)return"object expected";if(xe.commentThreadId!=null&&xe.hasOwnProperty("commentThreadId")&&!t.isString(xe.commentThreadId))return"commentThreadId: string expected";if(xe.createdAt!=null&&xe.hasOwnProperty("createdAt")&&!t.isString(xe.createdAt))return"createdAt: string expected";if(xe.comments!=null&&xe.hasOwnProperty("comments")){if(!Array.isArray(xe.comments))return"comments: array expected";for(var ve=0;ve<xe.comments.length;++ve){var ke=te.CommentThreadAddedCommentDescriptor.verify(xe.comments[ve]);if(ke)return"comments."+ke}}return null},be.fromObject=function(xe){if(xe instanceof te.CommentsV2AddCommentThreadResponse)return xe;var ve=new te.CommentsV2AddCommentThreadResponse;if(xe.commentThreadId!=null&&(ve.commentThreadId=String(xe.commentThreadId)),xe.createdAt!=null&&(ve.createdAt=String(xe.createdAt)),xe.comments){if(!Array.isArray(xe.comments))throw TypeError(".CommentsV2AddCommentThreadResponse.comments: array expected");ve.comments=[];for(var ke=0;ke<xe.comments.length;++ke){if(typeof xe.comments[ke]!="object")throw TypeError(".CommentsV2AddCommentThreadResponse.comments: object expected");ve.comments[ke]=te.CommentThreadAddedCommentDescriptor.fromObject(xe.comments[ke])}}return ve},be.toObject=function(xe,ve){ve||(ve={});var ke={};if((ve.arrays||ve.defaults)&&(ke.comments=[]),ve.defaults&&(ke.commentThreadId="",ke.createdAt=""),xe.commentThreadId!=null&&xe.hasOwnProperty("commentThreadId")&&(ke.commentThreadId=xe.commentThreadId),xe.createdAt!=null&&xe.hasOwnProperty("createdAt")&&(ke.createdAt=xe.createdAt),xe.comments&&xe.comments.length){ke.comments=[];for(var Ie=0;Ie<xe.comments.length;++Ie)ke.comments[Ie]=te.CommentThreadAddedCommentDescriptor.toObject(xe.comments[Ie],ve)}return ke},be.prototype.toJSON=function(){return this.constructor.toObject(this,_0x462d7f.util.toJSONOptions)},be.getTypeUrl=function(xe){return xe===void 0&&(xe="type.googleapis.com"),xe+"/CommentsV2AddCommentThreadResponse"},be}(),te.CommentsV2ResolveCommentThreadResponse=function(){function be(xe){if(xe)for(var ve=Object.keys(xe),ke=0;ke<ve.length;++ke)xe[ve[ke]]!=null&&(this[ve[ke]]=xe[ve[ke]])}return be.prototype.commentThreadId="",be.prototype.documentId="",be.prototype.resolvedAt="",be.prototype.resolvedBy="",be.create=function(xe){return new be(xe)},be.encode=function(xe,ve){return ve||(ve=we.create()),xe.commentThreadId!=null&&Object.hasOwnProperty.call(xe,"commentThreadId")&&ve.uint32(10).string(xe.commentThreadId),xe.documentId!=null&&Object.hasOwnProperty.call(xe,"documentId")&&ve.uint32(18).string(xe.documentId),xe.resolvedAt!=null&&Object.hasOwnProperty.call(xe,"resolvedAt")&&ve.uint32(26).string(xe.resolvedAt),xe.resolvedBy!=null&&Object.hasOwnProperty.call(xe,"resolvedBy")&&ve.uint32(34).string(xe.resolvedBy),ve},be.encodeDelimited=function(xe,ve){return this.encode(xe,ve).ldelim()},be.decode=function(xe,ve){xe instanceof Te||(xe=Te.create(xe));for(var ke=ve===void 0?xe.len:xe.pos+ve,Ie=new te.CommentsV2ResolveCommentThreadResponse;xe.pos<ke;){var Ae=xe.uint32();switch(Ae>>>3){case 1:Ie.commentThreadId=xe.string();break;case 2:Ie.documentId=xe.string();break;case 3:Ie.resolvedAt=xe.string();break;case 4:Ie.resolvedBy=xe.string();break;default:xe.skipType(7&Ae)}}return Ie},be.decodeDelimited=function(xe){return xe instanceof Te||(xe=new Te(xe)),this.decode(xe,xe.uint32())},be.verify=function(xe){return typeof xe!="object"||xe===null?"object expected":xe.commentThreadId!=null&&xe.hasOwnProperty("commentThreadId")&&!t.isString(xe.commentThreadId)?"commentThreadId: string expected":xe.documentId!=null&&xe.hasOwnProperty("documentId")&&!t.isString(xe.documentId)?"documentId: string expected":xe.resolvedAt!=null&&xe.hasOwnProperty("resolvedAt")&&!t.isString(xe.resolvedAt)?"resolvedAt: string expected":xe.resolvedBy!=null&&xe.hasOwnProperty("resolvedBy")&&!t.isString(xe.resolvedBy)?"resolvedBy: string expected":null},be.fromObject=function(xe){if(xe instanceof te.CommentsV2ResolveCommentThreadResponse)return xe;var ve=new te.CommentsV2ResolveCommentThreadResponse;return xe.commentThreadId!=null&&(ve.commentThreadId=String(xe.commentThreadId)),xe.documentId!=null&&(ve.documentId=String(xe.documentId)),xe.resolvedAt!=null&&(ve.resolvedAt=String(xe.resolvedAt)),xe.resolvedBy!=null&&(ve.resolvedBy=String(xe.resolvedBy)),ve},be.toObject=function(xe,ve){ve||(ve={});var ke={};return ve.defaults&&(ke.commentThreadId="",ke.documentId="",ke.resolvedAt="",ke.resolvedBy=""),xe.commentThreadId!=null&&xe.hasOwnProperty("commentThreadId")&&(ke.commentThreadId=xe.commentThreadId),xe.documentId!=null&&xe.hasOwnProperty("documentId")&&(ke.documentId=xe.documentId),xe.resolvedAt!=null&&xe.hasOwnProperty("resolvedAt")&&(ke.resolvedAt=xe.resolvedAt),xe.resolvedBy!=null&&xe.hasOwnProperty("resolvedBy")&&(ke.resolvedBy=xe.resolvedBy),ke},be.prototype.toJSON=function(){return this.constructor.toObject(this,_0x462d7f.util.toJSONOptions)},be.getTypeUrl=function(xe){return xe===void 0&&(xe="type.googleapis.com"),xe+"/CommentsV2ResolveCommentThreadResponse"},be}(),te.CommentsV2ConnectResponse=function(){function be(xe){if(this.threads=[],this.threadsV2=[],xe)for(var ve=Object.keys(xe),ke=0;ke<ve.length;++ke)xe[ve[ke]]!=null&&(this[ve[ke]]=xe[ve[ke]])}return be.prototype.channel="",be.prototype.threads=t.emptyArray,be.prototype.threadsV2=t.emptyArray,be.create=function(xe){return new be(xe)},be.encode=function(xe,ve){if(ve||(ve=we.create()),xe.channel!=null&&Object.hasOwnProperty.call(xe,"channel")&&ve.uint32(10).string(xe.channel),xe.threads!=null&&xe.threads.length)for(var ke=0;ke<xe.threads.length;++ke)ve.uint32(18).string(xe.threads[ke]);if(xe.threadsV2!=null&&xe.threadsV2.length)for(ke=0;ke<xe.threadsV2.length;++ke)te.CommentsThreadDescriptor.encode(xe.threadsV2[ke],ve.uint32(26).fork()).ldelim();return ve},be.encodeDelimited=function(xe,ve){return this.encode(xe,ve).ldelim()},be.decode=function(xe,ve){xe instanceof Te||(xe=Te.create(xe));for(var ke=ve===void 0?xe.len:xe.pos+ve,Ie=new te.CommentsV2ConnectResponse;xe.pos<ke;){var Ae=xe.uint32();switch(Ae>>>3){case 1:Ie.channel=xe.string();break;case 2:Ie.threads&&Ie.threads.length||(Ie.threads=[]),Ie.threads.push(xe.string());break;case 3:Ie.threadsV2&&Ie.threadsV2.length||(Ie.threadsV2=[]),Ie.threadsV2.push(te.CommentsThreadDescriptor.decode(xe,xe.uint32()));break;default:xe.skipType(7&Ae)}}return Ie},be.decodeDelimited=function(xe){return xe instanceof Te||(xe=new Te(xe)),this.decode(xe,xe.uint32())},be.verify=function(xe){if(typeof xe!="object"||xe===null)return"object expected";if(xe.channel!=null&&xe.hasOwnProperty("channel")&&!t.isString(xe.channel))return"channel: string expected";if(xe.threads!=null&&xe.hasOwnProperty("threads")){if(!Array.isArray(xe.threads))return"threads: array expected";for(var ve=0;ve<xe.threads.length;++ve)if(!t.isString(xe.threads[ve]))return"threads: string[] expected"}if(xe.threadsV2!=null&&xe.hasOwnProperty("threadsV2")){if(!Array.isArray(xe.threadsV2))return"threadsV2: array expected";for(ve=0;ve<xe.threadsV2.length;++ve){var ke=te.CommentsThreadDescriptor.verify(xe.threadsV2[ve]);if(ke)return"threadsV2."+ke}}return null},be.fromObject=function(xe){if(xe instanceof te.CommentsV2ConnectResponse)return xe;var ve=new te.CommentsV2ConnectResponse;if(xe.channel!=null&&(ve.channel=String(xe.channel)),xe.threads){if(!Array.isArray(xe.threads))throw TypeError(".CommentsV2ConnectResponse.threads: array expected");ve.threads=[];for(var ke=0;ke<xe.threads.length;++ke)ve.threads[ke]=String(xe.threads[ke])}if(xe.threadsV2){if(!Array.isArray(xe.threadsV2))throw TypeError(".CommentsV2ConnectResponse.threadsV2: array expected");for(ve.threadsV2=[],ke=0;ke<xe.threadsV2.length;++ke){if(typeof xe.threadsV2[ke]!="object")throw TypeError(".CommentsV2ConnectResponse.threadsV2: object expected");ve.threadsV2[ke]=te.CommentsThreadDescriptor.fromObject(xe.threadsV2[ke])}}return ve},be.toObject=function(xe,ve){ve||(ve={});var ke={};if((ve.arrays||ve.defaults)&&(ke.threads=[],ke.threadsV2=[]),ve.defaults&&(ke.channel=""),xe.channel!=null&&xe.hasOwnProperty("channel")&&(ke.channel=xe.channel),xe.threads&&xe.threads.length){ke.threads=[];for(var Ie=0;Ie<xe.threads.length;++Ie)ke.threads[Ie]=xe.threads[Ie]}if(xe.threadsV2&&xe.threadsV2.length)for(ke.threadsV2=[],Ie=0;Ie<xe.threadsV2.length;++Ie)ke.threadsV2[Ie]=te.CommentsThreadDescriptor.toObject(xe.threadsV2[Ie],ve);return ke},be.prototype.toJSON=function(){return this.constructor.toObject(this,_0x462d7f.util.toJSONOptions)},be.getTypeUrl=function(xe){return xe===void 0&&(xe="type.googleapis.com"),xe+"/CommentsV2ConnectResponse"},be}(),te.CommentsV2GetCommentThreadResponse=function(){function be(xe){if(this.comments=[],this.commentsV2=[],xe)for(var ve=Object.keys(xe),ke=0;ke<ve.length;++ke)xe[ve[ke]]!=null&&(this[ve[ke]]=xe[ve[ke]])}return be.prototype.commentThreadId="",be.prototype.comments=t.emptyArray,be.prototype.commentsV2=t.emptyArray,be.prototype.resolvedAt="",be.prototype.resolvedBy="",be.prototype.context="",be.prototype.createdAt="",be.prototype.deletedAt="",be.prototype.attributes="",be.prototype.unlinkedAt="",be.create=function(xe){return new be(xe)},be.encode=function(xe,ve){if(ve||(ve=we.create()),xe.commentThreadId!=null&&Object.hasOwnProperty.call(xe,"commentThreadId")&&ve.uint32(10).string(xe.commentThreadId),xe.comments!=null&&xe.comments.length)for(var ke=0;ke<xe.comments.length;++ke)ve.uint32(18).string(xe.comments[ke]);if(xe.commentsV2!=null&&xe.commentsV2.length)for(ke=0;ke<xe.commentsV2.length;++ke)te.CommentDescriptor.encode(xe.commentsV2[ke],ve.uint32(26).fork()).ldelim();return xe.resolvedAt!=null&&Object.hasOwnProperty.call(xe,"resolvedAt")&&ve.uint32(34).string(xe.resolvedAt),xe.resolvedBy!=null&&Object.hasOwnProperty.call(xe,"resolvedBy")&&ve.uint32(42).string(xe.resolvedBy),xe.context!=null&&Object.hasOwnProperty.call(xe,"context")&&ve.uint32(50).string(xe.context),xe.createdAt!=null&&Object.hasOwnProperty.call(xe,"createdAt")&&ve.uint32(58).string(xe.createdAt),xe.deletedAt!=null&&Object.hasOwnProperty.call(xe,"deletedAt")&&ve.uint32(66).string(xe.deletedAt),xe.attributes!=null&&Object.hasOwnProperty.call(xe,"attributes")&&ve.uint32(74).string(xe.attributes),xe.unlinkedAt!=null&&Object.hasOwnProperty.call(xe,"unlinkedAt")&&ve.uint32(82).string(xe.unlinkedAt),ve},be.encodeDelimited=function(xe,ve){return this.encode(xe,ve).ldelim()},be.decode=function(xe,ve){xe instanceof Te||(xe=Te.create(xe));for(var ke=ve===void 0?xe.len:xe.pos+ve,Ie=new te.CommentsV2GetCommentThreadResponse;xe.pos<ke;){var Ae=xe.uint32();switch(Ae>>>3){case 1:Ie.commentThreadId=xe.string();break;case 2:Ie.comments&&Ie.comments.length||(Ie.comments=[]),Ie.comments.push(xe.string());break;case 3:Ie.commentsV2&&Ie.commentsV2.length||(Ie.commentsV2=[]),Ie.commentsV2.push(te.CommentDescriptor.decode(xe,xe.uint32()));break;case 4:Ie.resolvedAt=xe.string();break;case 5:Ie.resolvedBy=xe.string();break;case 6:Ie.context=xe.string();break;case 7:Ie.createdAt=xe.string();break;case 8:Ie.deletedAt=xe.string();break;case 9:Ie.attributes=xe.string();break;case 10:Ie.unlinkedAt=xe.string();break;default:xe.skipType(7&Ae)}}return Ie},be.decodeDelimited=function(xe){return xe instanceof Te||(xe=new Te(xe)),this.decode(xe,xe.uint32())},be.verify=function(xe){if(typeof xe!="object"||xe===null)return"object expected";if(xe.commentThreadId!=null&&xe.hasOwnProperty("commentThreadId")&&!t.isString(xe.commentThreadId))return"commentThreadId: string expected";if(xe.comments!=null&&xe.hasOwnProperty("comments")){if(!Array.isArray(xe.comments))return"comments: array expected";for(var ve=0;ve<xe.comments.length;++ve)if(!t.isString(xe.comments[ve]))return"comments: string[] expected"}if(xe.commentsV2!=null&&xe.hasOwnProperty("commentsV2")){if(!Array.isArray(xe.commentsV2))return"commentsV2: array expected";for(ve=0;ve<xe.commentsV2.length;++ve){var ke=te.CommentDescriptor.verify(xe.commentsV2[ve]);if(ke)return"commentsV2."+ke}}return xe.resolvedAt!=null&&xe.hasOwnProperty("resolvedAt")&&!t.isString(xe.resolvedAt)?"resolvedAt: string expected":xe.resolvedBy!=null&&xe.hasOwnProperty("resolvedBy")&&!t.isString(xe.resolvedBy)?"resolvedBy: string expected":xe.context!=null&&xe.hasOwnProperty("context")&&!t.isString(xe.context)?"context: string expected":xe.createdAt!=null&&xe.hasOwnProperty("createdAt")&&!t.isString(xe.createdAt)?"createdAt: string expected":xe.deletedAt!=null&&xe.hasOwnProperty("deletedAt")&&!t.isString(xe.deletedAt)?"deletedAt: string expected":xe.attributes!=null&&xe.hasOwnProperty("attributes")&&!t.isString(xe.attributes)?"attributes: string expected":xe.unlinkedAt!=null&&xe.hasOwnProperty("unlinkedAt")&&!t.isString(xe.unlinkedAt)?"unlinkedAt: string expected":null},be.fromObject=function(xe){if(xe instanceof te.CommentsV2GetCommentThreadResponse)return xe;var ve=new te.CommentsV2GetCommentThreadResponse;if(xe.commentThreadId!=null&&(ve.commentThreadId=String(xe.commentThreadId)),xe.comments){if(!Array.isArray(xe.comments))throw TypeError(".CommentsV2GetCommentThreadResponse.comments: array expected");ve.comments=[];for(var ke=0;ke<xe.comments.length;++ke)ve.comments[ke]=String(xe.comments[ke])}if(xe.commentsV2){if(!Array.isArray(xe.commentsV2))throw TypeError(".CommentsV2GetCommentThreadResponse.commentsV2: array expected");for(ve.commentsV2=[],ke=0;ke<xe.commentsV2.length;++ke){if(typeof xe.commentsV2[ke]!="object")throw TypeError(".CommentsV2GetCommentThreadResponse.commentsV2: object expected");ve.commentsV2[ke]=te.CommentDescriptor.fromObject(xe.commentsV2[ke])}}return xe.resolvedAt!=null&&(ve.resolvedAt=String(xe.resolvedAt)),xe.resolvedBy!=null&&(ve.resolvedBy=String(xe.resolvedBy)),xe.context!=null&&(ve.context=String(xe.context)),xe.createdAt!=null&&(ve.createdAt=String(xe.createdAt)),xe.deletedAt!=null&&(ve.deletedAt=String(xe.deletedAt)),xe.attributes!=null&&(ve.attributes=String(xe.attributes)),xe.unlinkedAt!=null&&(ve.unlinkedAt=String(xe.unlinkedAt)),ve},be.toObject=function(xe,ve){ve||(ve={});var ke={};if((ve.arrays||ve.defaults)&&(ke.comments=[],ke.commentsV2=[]),ve.defaults&&(ke.commentThreadId="",ke.resolvedAt="",ke.resolvedBy="",ke.context="",ke.createdAt="",ke.deletedAt="",ke.attributes="",ke.unlinkedAt=""),xe.commentThreadId!=null&&xe.hasOwnProperty("commentThreadId")&&(ke.commentThreadId=xe.commentThreadId),xe.comments&&xe.comments.length){ke.comments=[];for(var Ie=0;Ie<xe.comments.length;++Ie)ke.comments[Ie]=xe.comments[Ie]}if(xe.commentsV2&&xe.commentsV2.length)for(ke.commentsV2=[],Ie=0;Ie<xe.commentsV2.length;++Ie)ke.commentsV2[Ie]=te.CommentDescriptor.toObject(xe.commentsV2[Ie],ve);return xe.resolvedAt!=null&&xe.hasOwnProperty("resolvedAt")&&(ke.resolvedAt=xe.resolvedAt),xe.resolvedBy!=null&&xe.hasOwnProperty("resolvedBy")&&(ke.resolvedBy=xe.resolvedBy),xe.context!=null&&xe.hasOwnProperty("context")&&(ke.context=xe.context),xe.createdAt!=null&&xe.hasOwnProperty("createdAt")&&(ke.createdAt=xe.createdAt),xe.deletedAt!=null&&xe.hasOwnProperty("deletedAt")&&(ke.deletedAt=xe.deletedAt),xe.attributes!=null&&xe.hasOwnProperty("attributes")&&(ke.attributes=xe.attributes),xe.unlinkedAt!=null&&xe.hasOwnProperty("unlinkedAt")&&(ke.unlinkedAt=xe.unlinkedAt),ke},be.prototype.toJSON=function(){return this.constructor.toObject(this,_0x462d7f.util.toJSONOptions)},be.getTypeUrl=function(xe){return xe===void 0&&(xe="type.googleapis.com"),xe+"/CommentsV2GetCommentThreadResponse"},be}(),te.CommentsV2GetDocumentThreadsResponse=function(){function be(xe){if(this.threads=[],this.threadsV2=[],xe)for(var ve=Object.keys(xe),ke=0;ke<ve.length;++ke)xe[ve[ke]]!=null&&(this[ve[ke]]=xe[ve[ke]])}return be.prototype.threads=t.emptyArray,be.prototype.threadsV2=t.emptyArray,be.create=function(xe){return new be(xe)},be.encode=function(xe,ve){if(ve||(ve=we.create()),xe.threads!=null&&xe.threads.length)for(var ke=0;ke<xe.threads.length;++ke)ve.uint32(10).string(xe.threads[ke]);if(xe.threadsV2!=null&&xe.threadsV2.length)for(ke=0;ke<xe.threadsV2.length;++ke)te.CommentsThreadDescriptor.encode(xe.threadsV2[ke],ve.uint32(18).fork()).ldelim();return ve},be.encodeDelimited=function(xe,ve){return this.encode(xe,ve).ldelim()},be.decode=function(xe,ve){xe instanceof Te||(xe=Te.create(xe));for(var ke=ve===void 0?xe.len:xe.pos+ve,Ie=new te.CommentsV2GetDocumentThreadsResponse;xe.pos<ke;){var Ae=xe.uint32();switch(Ae>>>3){case 1:Ie.threads&&Ie.threads.length||(Ie.threads=[]),Ie.threads.push(xe.string());break;case 2:Ie.threadsV2&&Ie.threadsV2.length||(Ie.threadsV2=[]),Ie.threadsV2.push(te.CommentsThreadDescriptor.decode(xe,xe.uint32()));break;default:xe.skipType(7&Ae)}}return Ie},be.decodeDelimited=function(xe){return xe instanceof Te||(xe=new Te(xe)),this.decode(xe,xe.uint32())},be.verify=function(xe){if(typeof xe!="object"||xe===null)return"object expected";if(xe.threads!=null&&xe.hasOwnProperty("threads")){if(!Array.isArray(xe.threads))return"threads: array expected";for(var ve=0;ve<xe.threads.length;++ve)if(!t.isString(xe.threads[ve]))return"threads: string[] expected"}if(xe.threadsV2!=null&&xe.hasOwnProperty("threadsV2")){if(!Array.isArray(xe.threadsV2))return"threadsV2: array expected";for(ve=0;ve<xe.threadsV2.length;++ve){var ke=te.CommentsThreadDescriptor.verify(xe.threadsV2[ve]);if(ke)return"threadsV2."+ke}}return null},be.fromObject=function(xe){if(xe instanceof te.CommentsV2GetDocumentThreadsResponse)return xe;var ve=new te.CommentsV2GetDocumentThreadsResponse;if(xe.threads){if(!Array.isArray(xe.threads))throw TypeError(".CommentsV2GetDocumentThreadsResponse.threads: array expected");ve.threads=[];for(var ke=0;ke<xe.threads.length;++ke)ve.threads[ke]=String(xe.threads[ke])}if(xe.threadsV2){if(!Array.isArray(xe.threadsV2))throw TypeError(".CommentsV2GetDocumentThreadsResponse.threadsV2: array expected");for(ve.threadsV2=[],ke=0;ke<xe.threadsV2.length;++ke){if(typeof xe.threadsV2[ke]!="object")throw TypeError(".CommentsV2GetDocumentThreadsResponse.threadsV2: object expected");ve.threadsV2[ke]=te.CommentsThreadDescriptor.fromObject(xe.threadsV2[ke])}}return ve},be.toObject=function(xe,ve){ve||(ve={});var ke={};if((ve.arrays||ve.defaults)&&(ke.threads=[],ke.threadsV2=[]),xe.threads&&xe.threads.length){ke.threads=[];for(var Ie=0;Ie<xe.threads.length;++Ie)ke.threads[Ie]=xe.threads[Ie]}if(xe.threadsV2&&xe.threadsV2.length)for(ke.threadsV2=[],Ie=0;Ie<xe.threadsV2.length;++Ie)ke.threadsV2[Ie]=te.CommentsThreadDescriptor.toObject(xe.threadsV2[Ie],ve);return ke},be.prototype.toJSON=function(){return this.constructor.toObject(this,_0x462d7f.util.toJSONOptions)},be.getTypeUrl=function(xe){return xe===void 0&&(xe="type.googleapis.com"),xe+"/CommentsV2GetDocumentThreadsResponse"},be}(),te.KeyValueDescriptor=function(){function be(xe){if(xe)for(var ve=Object.keys(xe),ke=0;ke<ve.length;++ke)xe[ve[ke]]!=null&&(this[ve[ke]]=xe[ve[ke]])}return be.prototype.key="",be.prototype.value="",be.create=function(xe){return new be(xe)},be.encode=function(xe,ve){return ve||(ve=we.create()),xe.key!=null&&Object.hasOwnProperty.call(xe,"key")&&ve.uint32(10).string(xe.key),xe.value!=null&&Object.hasOwnProperty.call(xe,"value")&&ve.uint32(18).string(xe.value),ve},be.encodeDelimited=function(xe,ve){return this.encode(xe,ve).ldelim()},be.decode=function(xe,ve){xe instanceof Te||(xe=Te.create(xe));for(var ke=ve===void 0?xe.len:xe.pos+ve,Ie=new te.KeyValueDescriptor;xe.pos<ke;){var Ae=xe.uint32();switch(Ae>>>3){case 1:Ie.key=xe.string();break;case 2:Ie.value=xe.string();break;default:xe.skipType(7&Ae)}}return Ie},be.decodeDelimited=function(xe){return xe instanceof Te||(xe=new Te(xe)),this.decode(xe,xe.uint32())},be.verify=function(xe){return typeof xe!="object"||xe===null?"object expected":xe.key!=null&&xe.hasOwnProperty("key")&&!t.isString(xe.key)?"key: string expected":xe.value!=null&&xe.hasOwnProperty("value")&&!t.isString(xe.value)?"value: string expected":null},be.fromObject=function(xe){if(xe instanceof te.KeyValueDescriptor)return xe;var ve=new te.KeyValueDescriptor;return xe.key!=null&&(ve.key=String(xe.key)),xe.value!=null&&(ve.value=String(xe.value)),ve},be.toObject=function(xe,ve){ve||(ve={});var ke={};return ve.defaults&&(ke.key="",ke.value=""),xe.key!=null&&xe.hasOwnProperty("key")&&(ke.key=xe.key),xe.value!=null&&xe.hasOwnProperty("value")&&(ke.value=xe.value),ke},be.prototype.toJSON=function(){return this.constructor.toObject(this,_0x462d7f.util.toJSONOptions)},be.getTypeUrl=function(xe){return xe===void 0&&(xe="type.googleapis.com"),xe+"/KeyValueDescriptor"},be}(),te.IsEditorBundleUploadedMessage=function(){function be(xe){if(xe)for(var ve=Object.keys(xe),ke=0;ke<ve.length;++ke)xe[ve[ke]]!=null&&(this[ve[ke]]=xe[ve[ke]])}return be.prototype.bundleVersion="",be.create=function(xe){return new be(xe)},be.encode=function(xe,ve){return ve||(ve=we.create()),xe.bundleVersion!=null&&Object.hasOwnProperty.call(xe,"bundleVersion")&&ve.uint32(10).string(xe.bundleVersion),ve},be.encodeDelimited=function(xe,ve){return this.encode(xe,ve).ldelim()},be.decode=function(xe,ve){xe instanceof Te||(xe=Te.create(xe));for(var ke=ve===void 0?xe.len:xe.pos+ve,Ie=new te.IsEditorBundleUploadedMessage;xe.pos<ke;){var Ae=xe.uint32();Ae>>>3==1?Ie.bundleVersion=xe.string():xe.skipType(7&Ae)}return Ie},be.decodeDelimited=function(xe){return xe instanceof Te||(xe=new Te(xe)),this.decode(xe,xe.uint32())},be.verify=function(xe){return typeof xe!="object"||xe===null?"object expected":xe.bundleVersion!=null&&xe.hasOwnProperty("bundleVersion")&&!t.isString(xe.bundleVersion)?"bundleVersion: string expected":null},be.fromObject=function(xe){if(xe instanceof te.IsEditorBundleUploadedMessage)return xe;var ve=new te.IsEditorBundleUploadedMessage;return xe.bundleVersion!=null&&(ve.bundleVersion=String(xe.bundleVersion)),ve},be.toObject=function(xe,ve){ve||(ve={});var ke={};return ve.defaults&&(ke.bundleVersion=""),xe.bundleVersion!=null&&xe.hasOwnProperty("bundleVersion")&&(ke.bundleVersion=xe.bundleVersion),ke},be.prototype.toJSON=function(){return this.constructor.toObject(this,_0x462d7f.util.toJSONOptions)},be.getTypeUrl=function(xe){return xe===void 0&&(xe="type.googleapis.com"),xe+"/IsEditorBundleUploadedMessage"},be}(),te.IsEditorBundleUploadedResponse=function(){function be(xe){if(xe)for(var ve=Object.keys(xe),ke=0;ke<ve.length;++ke)xe[ve[ke]]!=null&&(this[ve[ke]]=xe[ve[ke]])}return be.prototype.isUploaded=!1,be.create=function(xe){return new be(xe)},be.encode=function(xe,ve){return ve||(ve=we.create()),xe.isUploaded!=null&&Object.hasOwnProperty.call(xe,"isUploaded")&&ve.uint32(8).bool(xe.isUploaded),ve},be.encodeDelimited=function(xe,ve){return this.encode(xe,ve).ldelim()},be.decode=function(xe,ve){xe instanceof Te||(xe=Te.create(xe));for(var ke=ve===void 0?xe.len:xe.pos+ve,Ie=new te.IsEditorBundleUploadedResponse;xe.pos<ke;){var Ae=xe.uint32();Ae>>>3==1?Ie.isUploaded=xe.bool():xe.skipType(7&Ae)}return Ie},be.decodeDelimited=function(xe){return xe instanceof Te||(xe=new Te(xe)),this.decode(xe,xe.uint32())},be.verify=function(xe){return typeof xe!="object"||xe===null?"object expected":xe.isUploaded!=null&&xe.hasOwnProperty("isUploaded")&&typeof xe.isUploaded!="boolean"?"isUploaded: boolean expected":null},be.fromObject=function(xe){if(xe instanceof te.IsEditorBundleUploadedResponse)return xe;var ve=new te.IsEditorBundleUploadedResponse;return xe.isUploaded!=null&&(ve.isUploaded=!!xe.isUploaded),ve},be.toObject=function(xe,ve){ve||(ve={});var ke={};return ve.defaults&&(ke.isUploaded=!1),xe.isUploaded!=null&&xe.hasOwnProperty("isUploaded")&&(ke.isUploaded=xe.isUploaded),ke},be.prototype.toJSON=function(){return this.constructor.toObject(this,_0x462d7f.util.toJSONOptions)},be.getTypeUrl=function(xe){return xe===void 0&&(xe="type.googleapis.com"),xe+"/IsEditorBundleUploadedResponse"},be}(),te.RevisionDescriptor=function(){function be(xe){if(xe)for(var ve=Object.keys(xe),ke=0;ke<ve.length;++ke)xe[ve[ke]]!=null&&(this[ve[ke]]=xe[ve[ke]])}return be.prototype.revisionId="",be.prototype.name="",be.prototype.creatorId="",be.prototype.authorsIds="",be.prototype.diffData="",be.prototype.createdAt="",be.prototype.attributes="",be.prototype.toVersion=0,be.prototype.fromVersion=0,be.prototype.isEmptyCurrent=!1,be.create=function(xe){return new be(xe)},be.encode=function(xe,ve){return ve||(ve=we.create()),xe.revisionId!=null&&Object.hasOwnProperty.call(xe,"revisionId")&&ve.uint32(10).string(xe.revisionId),xe.name!=null&&Object.hasOwnProperty.call(xe,"name")&&ve.uint32(18).string(xe.name),xe.creatorId!=null&&Object.hasOwnProperty.call(xe,"creatorId")&&ve.uint32(26).string(xe.creatorId),xe.authorsIds!=null&&Object.hasOwnProperty.call(xe,"authorsIds")&&ve.uint32(34).string(xe.authorsIds),xe.diffData!=null&&Object.hasOwnProperty.call(xe,"diffData")&&ve.uint32(42).string(xe.diffData),xe.createdAt!=null&&Object.hasOwnProperty.call(xe,"createdAt")&&ve.uint32(50).string(xe.createdAt),xe.attributes!=null&&Object.hasOwnProperty.call(xe,"attributes")&&ve.uint32(58).string(xe.attributes),xe.toVersion!=null&&Object.hasOwnProperty.call(xe,"toVersion")&&ve.uint32(64).uint32(xe.toVersion),xe.fromVersion!=null&&Object.hasOwnProperty.call(xe,"fromVersion")&&ve.uint32(72).uint32(xe.fromVersion),xe.isEmptyCurrent!=null&&Object.hasOwnProperty.call(xe,"isEmptyCurrent")&&ve.uint32(80).bool(xe.isEmptyCurrent),ve},be.encodeDelimited=function(xe,ve){return this.encode(xe,ve).ldelim()},be.decode=function(xe,ve){xe instanceof Te||(xe=Te.create(xe));for(var ke=ve===void 0?xe.len:xe.pos+ve,Ie=new te.RevisionDescriptor;xe.pos<ke;){var Ae=xe.uint32();switch(Ae>>>3){case 1:Ie.revisionId=xe.string();break;case 2:Ie.name=xe.string();break;case 3:Ie.creatorId=xe.string();break;case 4:Ie.authorsIds=xe.string();break;case 5:Ie.diffData=xe.string();break;case 6:Ie.createdAt=xe.string();break;case 7:Ie.attributes=xe.string();break;case 8:Ie.toVersion=xe.uint32();break;case 9:Ie.fromVersion=xe.uint32();break;case 10:Ie.isEmptyCurrent=xe.bool();break;default:xe.skipType(7&Ae)}}return Ie},be.decodeDelimited=function(xe){return xe instanceof Te||(xe=new Te(xe)),this.decode(xe,xe.uint32())},be.verify=function(xe){return typeof xe!="object"||xe===null?"object expected":xe.revisionId!=null&&xe.hasOwnProperty("revisionId")&&!t.isString(xe.revisionId)?"revisionId: string expected":xe.name!=null&&xe.hasOwnProperty("name")&&!t.isString(xe.name)?"name: string expected":xe.creatorId!=null&&xe.hasOwnProperty("creatorId")&&!t.isString(xe.creatorId)?"creatorId: string expected":xe.authorsIds!=null&&xe.hasOwnProperty("authorsIds")&&!t.isString(xe.authorsIds)?"authorsIds: string expected":xe.diffData!=null&&xe.hasOwnProperty("diffData")&&!t.isString(xe.diffData)?"diffData: string expected":xe.createdAt!=null&&xe.hasOwnProperty("createdAt")&&!t.isString(xe.createdAt)?"createdAt: string expected":xe.attributes!=null&&xe.hasOwnProperty("attributes")&&!t.isString(xe.attributes)?"attributes: string expected":xe.toVersion!=null&&xe.hasOwnProperty("toVersion")&&!t.isInteger(xe.toVersion)?"toVersion: integer expected":xe.fromVersion!=null&&xe.hasOwnProperty("fromVersion")&&!t.isInteger(xe.fromVersion)?"fromVersion: integer expected":xe.isEmptyCurrent!=null&&xe.hasOwnProperty("isEmptyCurrent")&&typeof xe.isEmptyCurrent!="boolean"?"isEmptyCurrent: boolean expected":null},be.fromObject=function(xe){if(xe instanceof te.RevisionDescriptor)return xe;var ve=new te.RevisionDescriptor;return xe.revisionId!=null&&(ve.revisionId=String(xe.revisionId)),xe.name!=null&&(ve.name=String(xe.name)),xe.creatorId!=null&&(ve.creatorId=String(xe.creatorId)),xe.authorsIds!=null&&(ve.authorsIds=String(xe.authorsIds)),xe.diffData!=null&&(ve.diffData=String(xe.diffData)),xe.createdAt!=null&&(ve.createdAt=String(xe.createdAt)),xe.attributes!=null&&(ve.attributes=String(xe.attributes)),xe.toVersion!=null&&(ve.toVersion=xe.toVersion>>>0),xe.fromVersion!=null&&(ve.fromVersion=xe.fromVersion>>>0),xe.isEmptyCurrent!=null&&(ve.isEmptyCurrent=!!xe.isEmptyCurrent),ve},be.toObject=function(xe,ve){ve||(ve={});var ke={};return ve.defaults&&(ke.revisionId="",ke.name="",ke.creatorId="",ke.authorsIds="",ke.diffData="",ke.createdAt="",ke.attributes="",ke.toVersion=0,ke.fromVersion=0,ke.isEmptyCurrent=!1),xe.revisionId!=null&&xe.hasOwnProperty("revisionId")&&(ke.revisionId=xe.revisionId),xe.name!=null&&xe.hasOwnProperty("name")&&(ke.name=xe.name),xe.creatorId!=null&&xe.hasOwnProperty("creatorId")&&(ke.creatorId=xe.creatorId),xe.authorsIds!=null&&xe.hasOwnProperty("authorsIds")&&(ke.authorsIds=xe.authorsIds),xe.diffData!=null&&xe.hasOwnProperty("diffData")&&(ke.diffData=xe.diffData),xe.createdAt!=null&&xe.hasOwnProperty("createdAt")&&(ke.createdAt=xe.createdAt),xe.attributes!=null&&xe.hasOwnProperty("attributes")&&(ke.attributes=xe.attributes),xe.toVersion!=null&&xe.hasOwnProperty("toVersion")&&(ke.toVersion=xe.toVersion),xe.fromVersion!=null&&xe.hasOwnProperty("fromVersion")&&(ke.fromVersion=xe.fromVersion),xe.isEmptyCurrent!=null&&xe.hasOwnProperty("isEmptyCurrent")&&(ke.isEmptyCurrent=xe.isEmptyCurrent),ke},be.prototype.toJSON=function(){return this.constructor.toObject(this,_0x462d7f.util.toJSONOptions)},be.getTypeUrl=function(xe){return xe===void 0&&(xe="type.googleapis.com"),xe+"/RevisionDescriptor"},be}(),te.RevisionHistoryConnectMessage=function(){function be(xe){if(xe)for(var ve=Object.keys(xe),ke=0;ke<ve.length;++ke)xe[ve[ke]]!=null&&(this[ve[ke]]=xe[ve[ke]])}return be.prototype.documentId="",be.create=function(xe){return new be(xe)},be.encode=function(xe,ve){return ve||(ve=we.create()),xe.documentId!=null&&Object.hasOwnProperty.call(xe,"documentId")&&ve.uint32(10).string(xe.documentId),ve},be.encodeDelimited=function(xe,ve){return this.encode(xe,ve).ldelim()},be.decode=function(xe,ve){xe instanceof Te||(xe=Te.create(xe));for(var ke=ve===void 0?xe.len:xe.pos+ve,Ie=new te.RevisionHistoryConnectMessage;xe.pos<ke;){var Ae=xe.uint32();Ae>>>3==1?Ie.documentId=xe.string():xe.skipType(7&Ae)}return Ie},be.decodeDelimited=function(xe){return xe instanceof Te||(xe=new Te(xe)),this.decode(xe,xe.uint32())},be.verify=function(xe){return typeof xe!="object"||xe===null?"object expected":xe.documentId!=null&&xe.hasOwnProperty("documentId")&&!t.isString(xe.documentId)?"documentId: string expected":null},be.fromObject=function(xe){if(xe instanceof te.RevisionHistoryConnectMessage)return xe;var ve=new te.RevisionHistoryConnectMessage;return xe.documentId!=null&&(ve.documentId=String(xe.documentId)),ve},be.toObject=function(xe,ve){ve||(ve={});var ke={};return ve.defaults&&(ke.documentId=""),xe.documentId!=null&&xe.hasOwnProperty("documentId")&&(ke.documentId=xe.documentId),ke},be.prototype.toJSON=function(){return this.constructor.toObject(this,_0x462d7f.util.toJSONOptions)},be.getTypeUrl=function(xe){return xe===void 0&&(xe="type.googleapis.com"),xe+"/RevisionHistoryConnectMessage"},be}(),te.RevisionHistoryGetRevisionMessage=function(){function be(xe){if(xe)for(var ve=Object.keys(xe),ke=0;ke<ve.length;++ke)xe[ve[ke]]!=null&&(this[ve[ke]]=xe[ve[ke]])}return be.prototype.documentId="",be.prototype.revisionId="",be.create=function(xe){return new be(xe)},be.encode=function(xe,ve){return ve||(ve=we.create()),xe.documentId!=null&&Object.hasOwnProperty.call(xe,"documentId")&&ve.uint32(10).string(xe.documentId),xe.revisionId!=null&&Object.hasOwnProperty.call(xe,"revisionId")&&ve.uint32(18).string(xe.revisionId),ve},be.encodeDelimited=function(xe,ve){return this.encode(xe,ve).ldelim()},be.decode=function(xe,ve){xe instanceof Te||(xe=Te.create(xe));for(var ke=ve===void 0?xe.len:xe.pos+ve,Ie=new te.RevisionHistoryGetRevisionMessage;xe.pos<ke;){var Ae=xe.uint32();switch(Ae>>>3){case 1:Ie.documentId=xe.string();break;case 2:Ie.revisionId=xe.string();break;default:xe.skipType(7&Ae)}}return Ie},be.decodeDelimited=function(xe){return xe instanceof Te||(xe=new Te(xe)),this.decode(xe,xe.uint32())},be.verify=function(xe){return typeof xe!="object"||xe===null?"object expected":xe.documentId!=null&&xe.hasOwnProperty("documentId")&&!t.isString(xe.documentId)?"documentId: string expected":xe.revisionId!=null&&xe.hasOwnProperty("revisionId")&&!t.isString(xe.revisionId)?"revisionId: string expected":null},be.fromObject=function(xe){if(xe instanceof te.RevisionHistoryGetRevisionMessage)return xe;var ve=new te.RevisionHistoryGetRevisionMessage;return xe.documentId!=null&&(ve.documentId=String(xe.documentId)),xe.revisionId!=null&&(ve.revisionId=String(xe.revisionId)),ve},be.toObject=function(xe,ve){ve||(ve={});var ke={};return ve.defaults&&(ke.documentId="",ke.revisionId=""),xe.documentId!=null&&xe.hasOwnProperty("documentId")&&(ke.documentId=xe.documentId),xe.revisionId!=null&&xe.hasOwnProperty("revisionId")&&(ke.revisionId=xe.revisionId),ke},be.prototype.toJSON=function(){return this.constructor.toObject(this,_0x462d7f.util.toJSONOptions)},be.getTypeUrl=function(xe){return xe===void 0&&(xe="type.googleapis.com"),xe+"/RevisionHistoryGetRevisionMessage"},be}(),te.RevisionHistoryReconnectMessage=function(){function be(xe){if(xe)for(var ve=Object.keys(xe),ke=0;ke<ve.length;++ke)xe[ve[ke]]!=null&&(this[ve[ke]]=xe[ve[ke]])}return be.prototype.documentId="",be.prototype.requestId=0,be.create=function(xe){return new be(xe)},be.encode=function(xe,ve){return ve||(ve=we.create()),xe.documentId!=null&&Object.hasOwnProperty.call(xe,"documentId")&&ve.uint32(10).string(xe.documentId),xe.requestId!=null&&Object.hasOwnProperty.call(xe,"requestId")&&ve.uint32(16).uint32(xe.requestId),ve},be.encodeDelimited=function(xe,ve){return this.encode(xe,ve).ldelim()},be.decode=function(xe,ve){xe instanceof Te||(xe=Te.create(xe));for(var ke=ve===void 0?xe.len:xe.pos+ve,Ie=new te.RevisionHistoryReconnectMessage;xe.pos<ke;){var Ae=xe.uint32();switch(Ae>>>3){case 1:Ie.documentId=xe.string();break;case 2:Ie.requestId=xe.uint32();break;default:xe.skipType(7&Ae)}}return Ie},be.decodeDelimited=function(xe){return xe instanceof Te||(xe=new Te(xe)),this.decode(xe,xe.uint32())},be.verify=function(xe){return typeof xe!="object"||xe===null?"object expected":xe.documentId!=null&&xe.hasOwnProperty("documentId")&&!t.isString(xe.documentId)?"documentId: string expected":xe.requestId!=null&&xe.hasOwnProperty("requestId")&&!t.isInteger(xe.requestId)?"requestId: integer expected":null},be.fromObject=function(xe){if(xe instanceof te.RevisionHistoryReconnectMessage)return xe;var ve=new te.RevisionHistoryReconnectMessage;return xe.documentId!=null&&(ve.documentId=String(xe.documentId)),xe.requestId!=null&&(ve.requestId=xe.requestId>>>0),ve},be.toObject=function(xe,ve){ve||(ve={});var ke={};return ve.defaults&&(ke.documentId="",ke.requestId=0),xe.documentId!=null&&xe.hasOwnProperty("documentId")&&(ke.documentId=xe.documentId),xe.requestId!=null&&xe.hasOwnProperty("requestId")&&(ke.requestId=xe.requestId),ke},be.prototype.toJSON=function(){return this.constructor.toObject(this,_0x462d7f.util.toJSONOptions)},be.getTypeUrl=function(xe){return xe===void 0&&(xe="type.googleapis.com"),xe+"/RevisionHistoryReconnectMessage"},be}(),te.RevisionHistoryUpdateRevisionsMessage=function(){function be(xe){if(this.revisions=[],xe)for(var ve=Object.keys(xe),ke=0;ke<ve.length;++ke)xe[ve[ke]]!=null&&(this[ve[ke]]=xe[ve[ke]])}return be.prototype.documentId="",be.prototype.requestId=0,be.prototype.revisions=t.emptyArray,be.create=function(xe){return new be(xe)},be.encode=function(xe,ve){if(ve||(ve=we.create()),xe.documentId!=null&&Object.hasOwnProperty.call(xe,"documentId")&&ve.uint32(10).string(xe.documentId),xe.requestId!=null&&Object.hasOwnProperty.call(xe,"requestId")&&ve.uint32(16).uint32(xe.requestId),xe.revisions!=null&&xe.revisions.length)for(var ke=0;ke<xe.revisions.length;++ke)te.RevisionDescriptor.encode(xe.revisions[ke],ve.uint32(26).fork()).ldelim();return ve},be.encodeDelimited=function(xe,ve){return this.encode(xe,ve).ldelim()},be.decode=function(xe,ve){xe instanceof Te||(xe=Te.create(xe));for(var ke=ve===void 0?xe.len:xe.pos+ve,Ie=new te.RevisionHistoryUpdateRevisionsMessage;xe.pos<ke;){var Ae=xe.uint32();switch(Ae>>>3){case 1:Ie.documentId=xe.string();break;case 2:Ie.requestId=xe.uint32();break;case 3:Ie.revisions&&Ie.revisions.length||(Ie.revisions=[]),Ie.revisions.push(te.RevisionDescriptor.decode(xe,xe.uint32()));break;default:xe.skipType(7&Ae)}}return Ie},be.decodeDelimited=function(xe){return xe instanceof Te||(xe=new Te(xe)),this.decode(xe,xe.uint32())},be.verify=function(xe){if(typeof xe!="object"||xe===null)return"object expected";if(xe.documentId!=null&&xe.hasOwnProperty("documentId")&&!t.isString(xe.documentId))return"documentId: string expected";if(xe.requestId!=null&&xe.hasOwnProperty("requestId")&&!t.isInteger(xe.requestId))return"requestId: integer expected";if(xe.revisions!=null&&xe.hasOwnProperty("revisions")){if(!Array.isArray(xe.revisions))return"revisions: array expected";for(var ve=0;ve<xe.revisions.length;++ve){var ke=te.RevisionDescriptor.verify(xe.revisions[ve]);if(ke)return"revisions."+ke}}return null},be.fromObject=function(xe){if(xe instanceof te.RevisionHistoryUpdateRevisionsMessage)return xe;var ve=new te.RevisionHistoryUpdateRevisionsMessage;if(xe.documentId!=null&&(ve.documentId=String(xe.documentId)),xe.requestId!=null&&(ve.requestId=xe.requestId>>>0),xe.revisions){if(!Array.isArray(xe.revisions))throw TypeError(".RevisionHistoryUpdateRevisionsMessage.revisions: array expected");ve.revisions=[];for(var ke=0;ke<xe.revisions.length;++ke){if(typeof xe.revisions[ke]!="object")throw TypeError(".RevisionHistoryUpdateRevisionsMessage.revisions: object expected");ve.revisions[ke]=te.RevisionDescriptor.fromObject(xe.revisions[ke])}}return ve},be.toObject=function(xe,ve){ve||(ve={});var ke={};if((ve.arrays||ve.defaults)&&(ke.revisions=[]),ve.defaults&&(ke.documentId="",ke.requestId=0),xe.documentId!=null&&xe.hasOwnProperty("documentId")&&(ke.documentId=xe.documentId),xe.requestId!=null&&xe.hasOwnProperty("requestId")&&(ke.requestId=xe.requestId),xe.revisions&&xe.revisions.length){ke.revisions=[];for(var Ie=0;Ie<xe.revisions.length;++Ie)ke.revisions[Ie]=te.RevisionDescriptor.toObject(xe.revisions[Ie],ve)}return ke},be.prototype.toJSON=function(){return this.constructor.toObject(this,_0x462d7f.util.toJSONOptions)},be.getTypeUrl=function(xe){return xe===void 0&&(xe="type.googleapis.com"),xe+"/RevisionHistoryUpdateRevisionsMessage"},be}(),te.RevisionHistoryConnectResponse=function(){function be(xe){if(this.revisions=[],xe)for(var ve=Object.keys(xe),ke=0;ke<ve.length;++ke)xe[ve[ke]]!=null&&(this[ve[ke]]=xe[ve[ke]])}return be.prototype.channel="",be.prototype.requestId=0,be.prototype.revisions=t.emptyArray,be.create=function(xe){return new be(xe)},be.encode=function(xe,ve){if(ve||(ve=we.create()),xe.channel!=null&&Object.hasOwnProperty.call(xe,"channel")&&ve.uint32(10).string(xe.channel),xe.requestId!=null&&Object.hasOwnProperty.call(xe,"requestId")&&ve.uint32(16).uint32(xe.requestId),xe.revisions!=null&&xe.revisions.length)for(var ke=0;ke<xe.revisions.length;++ke)te.RevisionDescriptor.encode(xe.revisions[ke],ve.uint32(26).fork()).ldelim();return ve},be.encodeDelimited=function(xe,ve){return this.encode(xe,ve).ldelim()},be.decode=function(xe,ve){xe instanceof Te||(xe=Te.create(xe));for(var ke=ve===void 0?xe.len:xe.pos+ve,Ie=new te.RevisionHistoryConnectResponse;xe.pos<ke;){var Ae=xe.uint32();switch(Ae>>>3){case 1:Ie.channel=xe.string();break;case 2:Ie.requestId=xe.uint32();break;case 3:Ie.revisions&&Ie.revisions.length||(Ie.revisions=[]),Ie.revisions.push(te.RevisionDescriptor.decode(xe,xe.uint32()));break;default:xe.skipType(7&Ae)}}return Ie},be.decodeDelimited=function(xe){return xe instanceof Te||(xe=new Te(xe)),this.decode(xe,xe.uint32())},be.verify=function(xe){if(typeof xe!="object"||xe===null)return"object expected";if(xe.channel!=null&&xe.hasOwnProperty("channel")&&!t.isString(xe.channel))return"channel: string expected";if(xe.requestId!=null&&xe.hasOwnProperty("requestId")&&!t.isInteger(xe.requestId))return"requestId: integer expected";if(xe.revisions!=null&&xe.hasOwnProperty("revisions")){if(!Array.isArray(xe.revisions))return"revisions: array expected";for(var ve=0;ve<xe.revisions.length;++ve){var ke=te.RevisionDescriptor.verify(xe.revisions[ve]);if(ke)return"revisions."+ke}}return null},be.fromObject=function(xe){if(xe instanceof te.RevisionHistoryConnectResponse)return xe;var ve=new te.RevisionHistoryConnectResponse;if(xe.channel!=null&&(ve.channel=String(xe.channel)),xe.requestId!=null&&(ve.requestId=xe.requestId>>>0),xe.revisions){if(!Array.isArray(xe.revisions))throw TypeError(".RevisionHistoryConnectResponse.revisions: array expected");ve.revisions=[];for(var ke=0;ke<xe.revisions.length;++ke){if(typeof xe.revisions[ke]!="object")throw TypeError(".RevisionHistoryConnectResponse.revisions: object expected");ve.revisions[ke]=te.RevisionDescriptor.fromObject(xe.revisions[ke])}}return ve},be.toObject=function(xe,ve){ve||(ve={});var ke={};if((ve.arrays||ve.defaults)&&(ke.revisions=[]),ve.defaults&&(ke.channel="",ke.requestId=0),xe.channel!=null&&xe.hasOwnProperty("channel")&&(ke.channel=xe.channel),xe.requestId!=null&&xe.hasOwnProperty("requestId")&&(ke.requestId=xe.requestId),xe.revisions&&xe.revisions.length){ke.revisions=[];for(var Ie=0;Ie<xe.revisions.length;++Ie)ke.revisions[Ie]=te.RevisionDescriptor.toObject(xe.revisions[Ie],ve)}return ke},be.prototype.toJSON=function(){return this.constructor.toObject(this,_0x462d7f.util.toJSONOptions)},be.getTypeUrl=function(xe){return xe===void 0&&(xe="type.googleapis.com"),xe+"/RevisionHistoryConnectResponse"},be}(),te.RevisionHistoryGetRevisionResponse=function(){function be(xe){if(xe)for(var ve=Object.keys(xe),ke=0;ke<ve.length;++ke)xe[ve[ke]]!=null&&(this[ve[ke]]=xe[ve[ke]])}return be.prototype.revisionId="",be.prototype.name="",be.prototype.creatorId="",be.prototype.authorsIds="",be.prototype.diffData="",be.prototype.createdAt="",be.prototype.attributes="",be.prototype.toVersion=0,be.prototype.fromVersion=0,be.prototype.isEmptyCurrent=!1,be.create=function(xe){return new be(xe)},be.encode=function(xe,ve){return ve||(ve=we.create()),xe.revisionId!=null&&Object.hasOwnProperty.call(xe,"revisionId")&&ve.uint32(10).string(xe.revisionId),xe.name!=null&&Object.hasOwnProperty.call(xe,"name")&&ve.uint32(18).string(xe.name),xe.creatorId!=null&&Object.hasOwnProperty.call(xe,"creatorId")&&ve.uint32(26).string(xe.creatorId),xe.authorsIds!=null&&Object.hasOwnProperty.call(xe,"authorsIds")&&ve.uint32(34).string(xe.authorsIds),xe.diffData!=null&&Object.hasOwnProperty.call(xe,"diffData")&&ve.uint32(42).string(xe.diffData),xe.createdAt!=null&&Object.hasOwnProperty.call(xe,"createdAt")&&ve.uint32(50).string(xe.createdAt),xe.attributes!=null&&Object.hasOwnProperty.call(xe,"attributes")&&ve.uint32(58).string(xe.attributes),xe.toVersion!=null&&Object.hasOwnProperty.call(xe,"toVersion")&&ve.uint32(64).uint32(xe.toVersion),xe.fromVersion!=null&&Object.hasOwnProperty.call(xe,"fromVersion")&&ve.uint32(72).uint32(xe.fromVersion),xe.isEmptyCurrent!=null&&Object.hasOwnProperty.call(xe,"isEmptyCurrent")&&ve.uint32(80).bool(xe.isEmptyCurrent),ve},be.encodeDelimited=function(xe,ve){return this.encode(xe,ve).ldelim()},be.decode=function(xe,ve){xe instanceof Te||(xe=Te.create(xe));for(var ke=ve===void 0?xe.len:xe.pos+ve,Ie=new te.RevisionHistoryGetRevisionResponse;xe.pos<ke;){var Ae=xe.uint32();switch(Ae>>>3){case 1:Ie.revisionId=xe.string();break;case 2:Ie.name=xe.string();break;case 3:Ie.creatorId=xe.string();break;case 4:Ie.authorsIds=xe.string();break;case 5:Ie.diffData=xe.string();break;case 6:Ie.createdAt=xe.string();break;case 7:Ie.attributes=xe.string();break;case 8:Ie.toVersion=xe.uint32();break;case 9:Ie.fromVersion=xe.uint32();break;case 10:Ie.isEmptyCurrent=xe.bool();break;default:xe.skipType(7&Ae)}}return Ie},be.decodeDelimited=function(xe){return xe instanceof Te||(xe=new Te(xe)),this.decode(xe,xe.uint32())},be.verify=function(xe){return typeof xe!="object"||xe===null?"object expected":xe.revisionId!=null&&xe.hasOwnProperty("revisionId")&&!t.isString(xe.revisionId)?"revisionId: string expected":xe.name!=null&&xe.hasOwnProperty("name")&&!t.isString(xe.name)?"name: string expected":xe.creatorId!=null&&xe.hasOwnProperty("creatorId")&&!t.isString(xe.creatorId)?"creatorId: string expected":xe.authorsIds!=null&&xe.hasOwnProperty("authorsIds")&&!t.isString(xe.authorsIds)?"authorsIds: string expected":xe.diffData!=null&&xe.hasOwnProperty("diffData")&&!t.isString(xe.diffData)?"diffData: string expected":xe.createdAt!=null&&xe.hasOwnProperty("createdAt")&&!t.isString(xe.createdAt)?"createdAt: string expected":xe.attributes!=null&&xe.hasOwnProperty("attributes")&&!t.isString(xe.attributes)?"attributes: string expected":xe.toVersion!=null&&xe.hasOwnProperty("toVersion")&&!t.isInteger(xe.toVersion)?"toVersion: integer expected":xe.fromVersion!=null&&xe.hasOwnProperty("fromVersion")&&!t.isInteger(xe.fromVersion)?"fromVersion: integer expected":xe.isEmptyCurrent!=null&&xe.hasOwnProperty("isEmptyCurrent")&&typeof xe.isEmptyCurrent!="boolean"?"isEmptyCurrent: boolean expected":null},be.fromObject=function(xe){if(xe instanceof te.RevisionHistoryGetRevisionResponse)return xe;var ve=new te.RevisionHistoryGetRevisionResponse;return xe.revisionId!=null&&(ve.revisionId=String(xe.revisionId)),xe.name!=null&&(ve.name=String(xe.name)),xe.creatorId!=null&&(ve.creatorId=String(xe.creatorId)),xe.authorsIds!=null&&(ve.authorsIds=String(xe.authorsIds)),xe.diffData!=null&&(ve.diffData=String(xe.diffData)),xe.createdAt!=null&&(ve.createdAt=String(xe.createdAt)),xe.attributes!=null&&(ve.attributes=String(xe.attributes)),xe.toVersion!=null&&(ve.toVersion=xe.toVersion>>>0),xe.fromVersion!=null&&(ve.fromVersion=xe.fromVersion>>>0),xe.isEmptyCurrent!=null&&(ve.isEmptyCurrent=!!xe.isEmptyCurrent),ve},be.toObject=function(xe,ve){ve||(ve={});var ke={};return ve.defaults&&(ke.revisionId="",ke.name="",ke.creatorId="",ke.authorsIds="",ke.diffData="",ke.createdAt="",ke.attributes="",ke.toVersion=0,ke.fromVersion=0,ke.isEmptyCurrent=!1),xe.revisionId!=null&&xe.hasOwnProperty("revisionId")&&(ke.revisionId=xe.revisionId),xe.name!=null&&xe.hasOwnProperty("name")&&(ke.name=xe.name),xe.creatorId!=null&&xe.hasOwnProperty("creatorId")&&(ke.creatorId=xe.creatorId),xe.authorsIds!=null&&xe.hasOwnProperty("authorsIds")&&(ke.authorsIds=xe.authorsIds),xe.diffData!=null&&xe.hasOwnProperty("diffData")&&(ke.diffData=xe.diffData),xe.createdAt!=null&&xe.hasOwnProperty("createdAt")&&(ke.createdAt=xe.createdAt),xe.attributes!=null&&xe.hasOwnProperty("attributes")&&(ke.attributes=xe.attributes),xe.toVersion!=null&&xe.hasOwnProperty("toVersion")&&(ke.toVersion=xe.toVersion),xe.fromVersion!=null&&xe.hasOwnProperty("fromVersion")&&(ke.fromVersion=xe.fromVersion),xe.isEmptyCurrent!=null&&xe.hasOwnProperty("isEmptyCurrent")&&(ke.isEmptyCurrent=xe.isEmptyCurrent),ke},be.prototype.toJSON=function(){return this.constructor.toObject(this,_0x462d7f.util.toJSONOptions)},be.getTypeUrl=function(xe){return xe===void 0&&(xe="type.googleapis.com"),xe+"/RevisionHistoryGetRevisionResponse"},be}(),te.RevisionHistoryUpdateRevisionsResponse=function(){function be(xe){if(xe)for(var ve=Object.keys(xe),ke=0;ke<ve.length;++ke)xe[ve[ke]]!=null&&(this[ve[ke]]=xe[ve[ke]])}return be.prototype.requestId=0,be.create=function(xe){return new be(xe)},be.encode=function(xe,ve){return ve||(ve=we.create()),xe.requestId!=null&&Object.hasOwnProperty.call(xe,"requestId")&&ve.uint32(8).uint32(xe.requestId),ve},be.encodeDelimited=function(xe,ve){return this.encode(xe,ve).ldelim()},be.decode=function(xe,ve){xe instanceof Te||(xe=Te.create(xe));for(var ke=ve===void 0?xe.len:xe.pos+ve,Ie=new te.RevisionHistoryUpdateRevisionsResponse;xe.pos<ke;){var Ae=xe.uint32();Ae>>>3==1?Ie.requestId=xe.uint32():xe.skipType(7&Ae)}return Ie},be.decodeDelimited=function(xe){return xe instanceof Te||(xe=new Te(xe)),this.decode(xe,xe.uint32())},be.verify=function(xe){return typeof xe!="object"||xe===null?"object expected":xe.requestId!=null&&xe.hasOwnProperty("requestId")&&!t.isInteger(xe.requestId)?"requestId: integer expected":null},be.fromObject=function(xe){if(xe instanceof te.RevisionHistoryUpdateRevisionsResponse)return xe;var ve=new te.RevisionHistoryUpdateRevisionsResponse;return xe.requestId!=null&&(ve.requestId=xe.requestId>>>0),ve},be.toObject=function(xe,ve){ve||(ve={});var ke={};return ve.defaults&&(ke.requestId=0),xe.requestId!=null&&xe.hasOwnProperty("requestId")&&(ke.requestId=xe.requestId),ke},be.prototype.toJSON=function(){return this.constructor.toObject(this,_0x462d7f.util.toJSONOptions)},be.getTypeUrl=function(xe){return xe===void 0&&(xe="type.googleapis.com"),xe+"/RevisionHistoryUpdateRevisionsResponse"},be}(),te.SessionsSocketDescriptor=function(){function be(xe){if(this.permissions=[],xe)for(var ve=Object.keys(xe),ke=0;ke<ve.length;++ke)xe[ve[ke]]!=null&&(this[ve[ke]]=xe[ve[ke]])}return be.prototype.session="",be.prototype.user="",be.prototype.role="",be.prototype.permissions=t.emptyArray,be.create=function(xe){return new be(xe)},be.encode=function(xe,ve){if(ve||(ve=we.create()),xe.session!=null&&Object.hasOwnProperty.call(xe,"session")&&ve.uint32(10).string(xe.session),xe.user!=null&&Object.hasOwnProperty.call(xe,"user")&&ve.uint32(18).string(xe.user),xe.role!=null&&Object.hasOwnProperty.call(xe,"role")&&ve.uint32(26).string(xe.role),xe.permissions!=null&&xe.permissions.length)for(var ke=0;ke<xe.permissions.length;++ke)ve.uint32(34).string(xe.permissions[ke]);return ve},be.encodeDelimited=function(xe,ve){return this.encode(xe,ve).ldelim()},be.decode=function(xe,ve){xe instanceof Te||(xe=Te.create(xe));for(var ke=ve===void 0?xe.len:xe.pos+ve,Ie=new te.SessionsSocketDescriptor;xe.pos<ke;){var Ae=xe.uint32();switch(Ae>>>3){case 1:Ie.session=xe.string();break;case 2:Ie.user=xe.string();break;case 3:Ie.role=xe.string();break;case 4:Ie.permissions&&Ie.permissions.length||(Ie.permissions=[]),Ie.permissions.push(xe.string());break;default:xe.skipType(7&Ae)}}return Ie},be.decodeDelimited=function(xe){return xe instanceof Te||(xe=new Te(xe)),this.decode(xe,xe.uint32())},be.verify=function(xe){if(typeof xe!="object"||xe===null)return"object expected";if(xe.session!=null&&xe.hasOwnProperty("session")&&!t.isString(xe.session))return"session: string expected";if(xe.user!=null&&xe.hasOwnProperty("user")&&!t.isString(xe.user))return"user: string expected";if(xe.role!=null&&xe.hasOwnProperty("role")&&!t.isString(xe.role))return"role: string expected";if(xe.permissions!=null&&xe.hasOwnProperty("permissions")){if(!Array.isArray(xe.permissions))return"permissions: array expected";for(var ve=0;ve<xe.permissions.length;++ve)if(!t.isString(xe.permissions[ve]))return"permissions: string[] expected"}return null},be.fromObject=function(xe){if(xe instanceof te.SessionsSocketDescriptor)return xe;var ve=new te.SessionsSocketDescriptor;if(xe.session!=null&&(ve.session=String(xe.session)),xe.user!=null&&(ve.user=String(xe.user)),xe.role!=null&&(ve.role=String(xe.role)),xe.permissions){if(!Array.isArray(xe.permissions))throw TypeError(".SessionsSocketDescriptor.permissions: array expected");ve.permissions=[];for(var ke=0;ke<xe.permissions.length;++ke)ve.permissions[ke]=String(xe.permissions[ke])}return ve},be.toObject=function(xe,ve){ve||(ve={});var ke={};if((ve.arrays||ve.defaults)&&(ke.permissions=[]),ve.defaults&&(ke.session="",ke.user="",ke.role=""),xe.session!=null&&xe.hasOwnProperty("session")&&(ke.session=xe.session),xe.user!=null&&xe.hasOwnProperty("user")&&(ke.user=xe.user),xe.role!=null&&xe.hasOwnProperty("role")&&(ke.role=xe.role),xe.permissions&&xe.permissions.length){ke.permissions=[];for(var Ie=0;Ie<xe.permissions.length;++Ie)ke.permissions[Ie]=xe.permissions[Ie]}return ke},be.prototype.toJSON=function(){return this.constructor.toObject(this,_0x462d7f.util.toJSONOptions)},be.getTypeUrl=function(xe){return xe===void 0&&(xe="type.googleapis.com"),xe+"/SessionsSocketDescriptor"},be}(),te.SessionsConnectMessage=function(){function be(xe){if(xe)for(var ve=Object.keys(xe),ke=0;ke<ve.length;++ke)xe[ve[ke]]!=null&&(this[ve[ke]]=xe[ve[ke]])}return be.prototype.id="",be.prototype.sessionType=0,be.create=function(xe){return new be(xe)},be.encode=function(xe,ve){return ve||(ve=we.create()),xe.id!=null&&Object.hasOwnProperty.call(xe,"id")&&ve.uint32(10).string(xe.id),xe.sessionType!=null&&Object.hasOwnProperty.call(xe,"sessionType")&&ve.uint32(16).uint32(xe.sessionType),ve},be.encodeDelimited=function(xe,ve){return this.encode(xe,ve).ldelim()},be.decode=function(xe,ve){xe instanceof Te||(xe=Te.create(xe));for(var ke=ve===void 0?xe.len:xe.pos+ve,Ie=new te.SessionsConnectMessage;xe.pos<ke;){var Ae=xe.uint32();switch(Ae>>>3){case 1:Ie.id=xe.string();break;case 2:Ie.sessionType=xe.uint32();break;default:xe.skipType(7&Ae)}}return Ie},be.decodeDelimited=function(xe){return xe instanceof Te||(xe=new Te(xe)),this.decode(xe,xe.uint32())},be.verify=function(xe){return typeof xe!="object"||xe===null?"object expected":xe.id!=null&&xe.hasOwnProperty("id")&&!t.isString(xe.id)?"id: string expected":xe.sessionType!=null&&xe.hasOwnProperty("sessionType")&&!t.isInteger(xe.sessionType)?"sessionType: integer expected":null},be.fromObject=function(xe){if(xe instanceof te.SessionsConnectMessage)return xe;var ve=new te.SessionsConnectMessage;return xe.id!=null&&(ve.id=String(xe.id)),xe.sessionType!=null&&(ve.sessionType=xe.sessionType>>>0),ve},be.toObject=function(xe,ve){ve||(ve={});var ke={};return ve.defaults&&(ke.id="",ke.sessionType=0),xe.id!=null&&xe.hasOwnProperty("id")&&(ke.id=xe.id),xe.sessionType!=null&&xe.hasOwnProperty("sessionType")&&(ke.sessionType=xe.sessionType),ke},be.prototype.toJSON=function(){return this.constructor.toObject(this,_0x462d7f.util.toJSONOptions)},be.getTypeUrl=function(xe){return xe===void 0&&(xe="type.googleapis.com"),xe+"/SessionsConnectMessage"},be}(),te.SocketConnectMessage=function(){function be(xe){if(this.permissions=[],xe)for(var ve=Object.keys(xe),ke=0;ke<ve.length;++ke)xe[ve[ke]]!=null&&(this[ve[ke]]=xe[ve[ke]])}return be.prototype.id="",be.prototype.userId="",be.prototype.role="",be.prototype.permissions=t.emptyArray,be.create=function(xe){return new be(xe)},be.encode=function(xe,ve){if(ve||(ve=we.create()),xe.id!=null&&Object.hasOwnProperty.call(xe,"id")&&ve.uint32(10).string(xe.id),xe.userId!=null&&Object.hasOwnProperty.call(xe,"userId")&&ve.uint32(18).string(xe.userId),xe.role!=null&&Object.hasOwnProperty.call(xe,"role")&&ve.uint32(26).string(xe.role),xe.permissions!=null&&xe.permissions.length)for(var ke=0;ke<xe.permissions.length;++ke)ve.uint32(34).string(xe.permissions[ke]);return ve},be.encodeDelimited=function(xe,ve){return this.encode(xe,ve).ldelim()},be.decode=function(xe,ve){xe instanceof Te||(xe=Te.create(xe));for(var ke=ve===void 0?xe.len:xe.pos+ve,Ie=new te.SocketConnectMessage;xe.pos<ke;){var Ae=xe.uint32();switch(Ae>>>3){case 1:Ie.id=xe.string();break;case 2:Ie.userId=xe.string();break;case 3:Ie.role=xe.string();break;case 4:Ie.permissions&&Ie.permissions.length||(Ie.permissions=[]),Ie.permissions.push(xe.string());break;default:xe.skipType(7&Ae)}}return Ie},be.decodeDelimited=function(xe){return xe instanceof Te||(xe=new Te(xe)),this.decode(xe,xe.uint32())},be.verify=function(xe){if(typeof xe!="object"||xe===null)return"object expected";if(xe.id!=null&&xe.hasOwnProperty("id")&&!t.isString(xe.id))return"id: string expected";if(xe.userId!=null&&xe.hasOwnProperty("userId")&&!t.isString(xe.userId))return"userId: string expected";if(xe.role!=null&&xe.hasOwnProperty("role")&&!t.isString(xe.role))return"role: string expected";if(xe.permissions!=null&&xe.hasOwnProperty("permissions")){if(!Array.isArray(xe.permissions))return"permissions: array expected";for(var ve=0;ve<xe.permissions.length;++ve)if(!t.isString(xe.permissions[ve]))return"permissions: string[] expected"}return null},be.fromObject=function(xe){if(xe instanceof te.SocketConnectMessage)return xe;var ve=new te.SocketConnectMessage;if(xe.id!=null&&(ve.id=String(xe.id)),xe.userId!=null&&(ve.userId=String(xe.userId)),xe.role!=null&&(ve.role=String(xe.role)),xe.permissions){if(!Array.isArray(xe.permissions))throw TypeError(".SocketConnectMessage.permissions: array expected");ve.permissions=[];for(var ke=0;ke<xe.permissions.length;++ke)ve.permissions[ke]=String(xe.permissions[ke])}return ve},be.toObject=function(xe,ve){ve||(ve={});var ke={};if((ve.arrays||ve.defaults)&&(ke.permissions=[]),ve.defaults&&(ke.id="",ke.userId="",ke.role=""),xe.id!=null&&xe.hasOwnProperty("id")&&(ke.id=xe.id),xe.userId!=null&&xe.hasOwnProperty("userId")&&(ke.userId=xe.userId),xe.role!=null&&xe.hasOwnProperty("role")&&(ke.role=xe.role),xe.permissions&&xe.permissions.length){ke.permissions=[];for(var Ie=0;Ie<xe.permissions.length;++Ie)ke.permissions[Ie]=xe.permissions[Ie]}return ke},be.prototype.toJSON=function(){return this.constructor.toObject(this,_0x462d7f.util.toJSONOptions)},be.getTypeUrl=function(xe){return xe===void 0&&(xe="type.googleapis.com"),xe+"/SocketConnectMessage"},be}(),te.SocketDisconnectMessage=function(){function be(xe){if(xe)for(var ve=Object.keys(xe),ke=0;ke<ve.length;++ke)xe[ve[ke]]!=null&&(this[ve[ke]]=xe[ve[ke]])}return be.prototype.id="",be.create=function(xe){return new be(xe)},be.encode=function(xe,ve){return ve||(ve=we.create()),xe.id!=null&&Object.hasOwnProperty.call(xe,"id")&&ve.uint32(10).string(xe.id),ve},be.encodeDelimited=function(xe,ve){return this.encode(xe,ve).ldelim()},be.decode=function(xe,ve){xe instanceof Te||(xe=Te.create(xe));for(var ke=ve===void 0?xe.len:xe.pos+ve,Ie=new te.SocketDisconnectMessage;xe.pos<ke;){var Ae=xe.uint32();Ae>>>3==1?Ie.id=xe.string():xe.skipType(7&Ae)}return Ie},be.decodeDelimited=function(xe){return xe instanceof Te||(xe=new Te(xe)),this.decode(xe,xe.uint32())},be.verify=function(xe){return typeof xe!="object"||xe===null?"object expected":xe.id!=null&&xe.hasOwnProperty("id")&&!t.isString(xe.id)?"id: string expected":null},be.fromObject=function(xe){if(xe instanceof te.SocketDisconnectMessage)return xe;var ve=new te.SocketDisconnectMessage;return xe.id!=null&&(ve.id=String(xe.id)),ve},be.toObject=function(xe,ve){ve||(ve={});var ke={};return ve.defaults&&(ke.id=""),xe.id!=null&&xe.hasOwnProperty("id")&&(ke.id=xe.id),ke},be.prototype.toJSON=function(){return this.constructor.toObject(this,_0x462d7f.util.toJSONOptions)},be.getTypeUrl=function(xe){return xe===void 0&&(xe="type.googleapis.com"),xe+"/SocketDisconnectMessage"},be}(),te.SessionsConnectResponse=function(){function be(xe){if(this.sockets=[],xe)for(var ve=Object.keys(xe),ke=0;ke<ve.length;++ke)xe[ve[ke]]!=null&&(this[ve[ke]]=xe[ve[ke]])}return be.prototype.channel="",be.prototype.sockets=t.emptyArray,be.create=function(xe){return new be(xe)},be.encode=function(xe,ve){if(ve||(ve=we.create()),xe.channel!=null&&Object.hasOwnProperty.call(xe,"channel")&&ve.uint32(10).string(xe.channel),xe.sockets!=null&&xe.sockets.length)for(var ke=0;ke<xe.sockets.length;++ke)te.SessionsSocketDescriptor.encode(xe.sockets[ke],ve.uint32(18).fork()).ldelim();return ve},be.encodeDelimited=function(xe,ve){return this.encode(xe,ve).ldelim()},be.decode=function(xe,ve){xe instanceof Te||(xe=Te.create(xe));for(var ke=ve===void 0?xe.len:xe.pos+ve,Ie=new te.SessionsConnectResponse;xe.pos<ke;){var Ae=xe.uint32();switch(Ae>>>3){case 1:Ie.channel=xe.string();break;case 2:Ie.sockets&&Ie.sockets.length||(Ie.sockets=[]),Ie.sockets.push(te.SessionsSocketDescriptor.decode(xe,xe.uint32()));break;default:xe.skipType(7&Ae)}}return Ie},be.decodeDelimited=function(xe){return xe instanceof Te||(xe=new Te(xe)),this.decode(xe,xe.uint32())},be.verify=function(xe){if(typeof xe!="object"||xe===null)return"object expected";if(xe.channel!=null&&xe.hasOwnProperty("channel")&&!t.isString(xe.channel))return"channel: string expected";if(xe.sockets!=null&&xe.hasOwnProperty("sockets")){if(!Array.isArray(xe.sockets))return"sockets: array expected";for(var ve=0;ve<xe.sockets.length;++ve){var ke=te.SessionsSocketDescriptor.verify(xe.sockets[ve]);if(ke)return"sockets."+ke}}return null},be.fromObject=function(xe){if(xe instanceof te.SessionsConnectResponse)return xe;var ve=new te.SessionsConnectResponse;if(xe.channel!=null&&(ve.channel=String(xe.channel)),xe.sockets){if(!Array.isArray(xe.sockets))throw TypeError(".SessionsConnectResponse.sockets: array expected");ve.sockets=[];for(var ke=0;ke<xe.sockets.length;++ke){if(typeof xe.sockets[ke]!="object")throw TypeError(".SessionsConnectResponse.sockets: object expected");ve.sockets[ke]=te.SessionsSocketDescriptor.fromObject(xe.sockets[ke])}}return ve},be.toObject=function(xe,ve){ve||(ve={});var ke={};if((ve.arrays||ve.defaults)&&(ke.sockets=[]),ve.defaults&&(ke.channel=""),xe.channel!=null&&xe.hasOwnProperty("channel")&&(ke.channel=xe.channel),xe.sockets&&xe.sockets.length){ke.sockets=[];for(var Ie=0;Ie<xe.sockets.length;++Ie)ke.sockets[Ie]=te.SessionsSocketDescriptor.toObject(xe.sockets[Ie],ve)}return ke},be.prototype.toJSON=function(){return this.constructor.toObject(this,_0x462d7f.util.toJSONOptions)},be.getTypeUrl=function(xe){return xe===void 0&&(xe="type.googleapis.com"),xe+"/SessionsConnectResponse"},be}(),te.SuggestionDescriptor=function(){function be(xe){if(xe)for(var ve=Object.keys(xe),ke=0;ke<ve.length;++ke)xe[ve[ke]]!=null&&(this[ve[ke]]=xe[ve[ke]])}return be.prototype.id="",be.prototype.authorId="",be.prototype.type="",be.prototype.createdAt="",be.prototype.data="",be.prototype.hasComments=!1,be.prototype.state="",be.prototype.attributes="",be.create=function(xe){return new be(xe)},be.encode=function(xe,ve){return ve||(ve=we.create()),xe.id!=null&&Object.hasOwnProperty.call(xe,"id")&&ve.uint32(10).string(xe.id),xe.authorId!=null&&Object.hasOwnProperty.call(xe,"authorId")&&ve.uint32(18).string(xe.authorId),xe.type!=null&&Object.hasOwnProperty.call(xe,"type")&&ve.uint32(26).string(xe.type),xe.createdAt!=null&&Object.hasOwnProperty.call(xe,"createdAt")&&ve.uint32(34).string(xe.createdAt),xe.data!=null&&Object.hasOwnProperty.call(xe,"data")&&ve.uint32(42).string(xe.data),xe.hasComments!=null&&Object.hasOwnProperty.call(xe,"hasComments")&&ve.uint32(48).bool(xe.hasComments),xe.state!=null&&Object.hasOwnProperty.call(xe,"state")&&ve.uint32(58).string(xe.state),xe.attributes!=null&&Object.hasOwnProperty.call(xe,"attributes")&&ve.uint32(66).string(xe.attributes),ve},be.encodeDelimited=function(xe,ve){return this.encode(xe,ve).ldelim()},be.decode=function(xe,ve){xe instanceof Te||(xe=Te.create(xe));for(var ke=ve===void 0?xe.len:xe.pos+ve,Ie=new te.SuggestionDescriptor;xe.pos<ke;){var Ae=xe.uint32();switch(Ae>>>3){case 1:Ie.id=xe.string();break;case 2:Ie.authorId=xe.string();break;case 3:Ie.type=xe.string();break;case 4:Ie.createdAt=xe.string();break;case 5:Ie.data=xe.string();break;case 6:Ie.hasComments=xe.bool();break;case 7:Ie.state=xe.string();break;case 8:Ie.attributes=xe.string();break;default:xe.skipType(7&Ae)}}return Ie},be.decodeDelimited=function(xe){return xe instanceof Te||(xe=new Te(xe)),this.decode(xe,xe.uint32())},be.verify=function(xe){return typeof xe!="object"||xe===null?"object expected":xe.id!=null&&xe.hasOwnProperty("id")&&!t.isString(xe.id)?"id: string expected":xe.authorId!=null&&xe.hasOwnProperty("authorId")&&!t.isString(xe.authorId)?"authorId: string expected":xe.type!=null&&xe.hasOwnProperty("type")&&!t.isString(xe.type)?"type: string expected":xe.createdAt!=null&&xe.hasOwnProperty("createdAt")&&!t.isString(xe.createdAt)?"createdAt: string expected":xe.data!=null&&xe.hasOwnProperty("data")&&!t.isString(xe.data)?"data: string expected":xe.hasComments!=null&&xe.hasOwnProperty("hasComments")&&typeof xe.hasComments!="boolean"?"hasComments: boolean expected":xe.state!=null&&xe.hasOwnProperty("state")&&!t.isString(xe.state)?"state: string expected":xe.attributes!=null&&xe.hasOwnProperty("attributes")&&!t.isString(xe.attributes)?"attributes: string expected":null},be.fromObject=function(xe){if(xe instanceof te.SuggestionDescriptor)return xe;var ve=new te.SuggestionDescriptor;return xe.id!=null&&(ve.id=String(xe.id)),xe.authorId!=null&&(ve.authorId=String(xe.authorId)),xe.type!=null&&(ve.type=String(xe.type)),xe.createdAt!=null&&(ve.createdAt=String(xe.createdAt)),xe.data!=null&&(ve.data=String(xe.data)),xe.hasComments!=null&&(ve.hasComments=!!xe.hasComments),xe.state!=null&&(ve.state=String(xe.state)),xe.attributes!=null&&(ve.attributes=String(xe.attributes)),ve},be.toObject=function(xe,ve){ve||(ve={});var ke={};return ve.defaults&&(ke.id="",ke.authorId="",ke.type="",ke.createdAt="",ke.data="",ke.hasComments=!1,ke.state="",ke.attributes=""),xe.id!=null&&xe.hasOwnProperty("id")&&(ke.id=xe.id),xe.authorId!=null&&xe.hasOwnProperty("authorId")&&(ke.authorId=xe.authorId),xe.type!=null&&xe.hasOwnProperty("type")&&(ke.type=xe.type),xe.createdAt!=null&&xe.hasOwnProperty("createdAt")&&(ke.createdAt=xe.createdAt),xe.data!=null&&xe.hasOwnProperty("data")&&(ke.data=xe.data),xe.hasComments!=null&&xe.hasOwnProperty("hasComments")&&(ke.hasComments=xe.hasComments),xe.state!=null&&xe.hasOwnProperty("state")&&(ke.state=xe.state),xe.attributes!=null&&xe.hasOwnProperty("attributes")&&(ke.attributes=xe.attributes),ke},be.prototype.toJSON=function(){return this.constructor.toObject(this,_0x462d7f.util.toJSONOptions)},be.getTypeUrl=function(xe){return xe===void 0&&(xe="type.googleapis.com"),xe+"/SuggestionDescriptor"},be}(),te.TrackChangesAddSuggestionMessage=function(){function be(xe){if(xe)for(var ve=Object.keys(xe),ke=0;ke<ve.length;++ke)xe[ve[ke]]!=null&&(this[ve[ke]]=xe[ve[ke]])}return be.prototype.id="",be.prototype.documentId="",be.prototype.type="",be.prototype.data="",be.prototype.originalSuggestionId="",be.prototype.attributes="",be.create=function(xe){return new be(xe)},be.encode=function(xe,ve){return ve||(ve=we.create()),xe.id!=null&&Object.hasOwnProperty.call(xe,"id")&&ve.uint32(10).string(xe.id),xe.documentId!=null&&Object.hasOwnProperty.call(xe,"documentId")&&ve.uint32(18).string(xe.documentId),xe.type!=null&&Object.hasOwnProperty.call(xe,"type")&&ve.uint32(26).string(xe.type),xe.data!=null&&Object.hasOwnProperty.call(xe,"data")&&ve.uint32(34).string(xe.data),xe.originalSuggestionId!=null&&Object.hasOwnProperty.call(xe,"originalSuggestionId")&&ve.uint32(42).string(xe.originalSuggestionId),xe.attributes!=null&&Object.hasOwnProperty.call(xe,"attributes")&&ve.uint32(50).string(xe.attributes),ve},be.encodeDelimited=function(xe,ve){return this.encode(xe,ve).ldelim()},be.decode=function(xe,ve){xe instanceof Te||(xe=Te.create(xe));for(var ke=ve===void 0?xe.len:xe.pos+ve,Ie=new te.TrackChangesAddSuggestionMessage;xe.pos<ke;){var Ae=xe.uint32();switch(Ae>>>3){case 1:Ie.id=xe.string();break;case 2:Ie.documentId=xe.string();break;case 3:Ie.type=xe.string();break;case 4:Ie.data=xe.string();break;case 5:Ie.originalSuggestionId=xe.string();break;case 6:Ie.attributes=xe.string();break;default:xe.skipType(7&Ae)}}return Ie},be.decodeDelimited=function(xe){return xe instanceof Te||(xe=new Te(xe)),this.decode(xe,xe.uint32())},be.verify=function(xe){return typeof xe!="object"||xe===null?"object expected":xe.id!=null&&xe.hasOwnProperty("id")&&!t.isString(xe.id)?"id: string expected":xe.documentId!=null&&xe.hasOwnProperty("documentId")&&!t.isString(xe.documentId)?"documentId: string expected":xe.type!=null&&xe.hasOwnProperty("type")&&!t.isString(xe.type)?"type: string expected":xe.data!=null&&xe.hasOwnProperty("data")&&!t.isString(xe.data)?"data: string expected":xe.originalSuggestionId!=null&&xe.hasOwnProperty("originalSuggestionId")&&!t.isString(xe.originalSuggestionId)?"originalSuggestionId: string expected":xe.attributes!=null&&xe.hasOwnProperty("attributes")&&!t.isString(xe.attributes)?"attributes: string expected":null},be.fromObject=function(xe){if(xe instanceof te.TrackChangesAddSuggestionMessage)return xe;var ve=new te.TrackChangesAddSuggestionMessage;return xe.id!=null&&(ve.id=String(xe.id)),xe.documentId!=null&&(ve.documentId=String(xe.documentId)),xe.type!=null&&(ve.type=String(xe.type)),xe.data!=null&&(ve.data=String(xe.data)),xe.originalSuggestionId!=null&&(ve.originalSuggestionId=String(xe.originalSuggestionId)),xe.attributes!=null&&(ve.attributes=String(xe.attributes)),ve},be.toObject=function(xe,ve){ve||(ve={});var ke={};return ve.defaults&&(ke.id="",ke.documentId="",ke.type="",ke.data="",ke.originalSuggestionId="",ke.attributes=""),xe.id!=null&&xe.hasOwnProperty("id")&&(ke.id=xe.id),xe.documentId!=null&&xe.hasOwnProperty("documentId")&&(ke.documentId=xe.documentId),xe.type!=null&&xe.hasOwnProperty("type")&&(ke.type=xe.type),xe.data!=null&&xe.hasOwnProperty("data")&&(ke.data=xe.data),xe.originalSuggestionId!=null&&xe.hasOwnProperty("originalSuggestionId")&&(ke.originalSuggestionId=xe.originalSuggestionId),xe.attributes!=null&&xe.hasOwnProperty("attributes")&&(ke.attributes=xe.attributes),ke},be.prototype.toJSON=function(){return this.constructor.toObject(this,_0x462d7f.util.toJSONOptions)},be.getTypeUrl=function(xe){return xe===void 0&&(xe="type.googleapis.com"),xe+"/TrackChangesAddSuggestionMessage"},be}(),te.TrackChangesBatchUpdateSuggestionsStateMessage=function(){function be(xe){if(this.ids=[],xe)for(var ve=Object.keys(xe),ke=0;ke<ve.length;++ke)xe[ve[ke]]!=null&&(this[ve[ke]]=xe[ve[ke]])}return be.prototype.ids=t.emptyArray,be.prototype.documentId="",be.prototype.state="",be.create=function(xe){return new be(xe)},be.encode=function(xe,ve){if(ve||(ve=we.create()),xe.ids!=null&&xe.ids.length)for(var ke=0;ke<xe.ids.length;++ke)ve.uint32(10).string(xe.ids[ke]);return xe.documentId!=null&&Object.hasOwnProperty.call(xe,"documentId")&&ve.uint32(18).string(xe.documentId),xe.state!=null&&Object.hasOwnProperty.call(xe,"state")&&ve.uint32(26).string(xe.state),ve},be.encodeDelimited=function(xe,ve){return this.encode(xe,ve).ldelim()},be.decode=function(xe,ve){xe instanceof Te||(xe=Te.create(xe));for(var ke=ve===void 0?xe.len:xe.pos+ve,Ie=new te.TrackChangesBatchUpdateSuggestionsStateMessage;xe.pos<ke;){var Ae=xe.uint32();switch(Ae>>>3){case 1:Ie.ids&&Ie.ids.length||(Ie.ids=[]),Ie.ids.push(xe.string());break;case 2:Ie.documentId=xe.string();break;case 3:Ie.state=xe.string();break;default:xe.skipType(7&Ae)}}return Ie},be.decodeDelimited=function(xe){return xe instanceof Te||(xe=new Te(xe)),this.decode(xe,xe.uint32())},be.verify=function(xe){if(typeof xe!="object"||xe===null)return"object expected";if(xe.ids!=null&&xe.hasOwnProperty("ids")){if(!Array.isArray(xe.ids))return"ids: array expected";for(var ve=0;ve<xe.ids.length;++ve)if(!t.isString(xe.ids[ve]))return"ids: string[] expected"}return xe.documentId!=null&&xe.hasOwnProperty("documentId")&&!t.isString(xe.documentId)?"documentId: string expected":xe.state!=null&&xe.hasOwnProperty("state")&&!t.isString(xe.state)?"state: string expected":null},be.fromObject=function(xe){if(xe instanceof te.TrackChangesBatchUpdateSuggestionsStateMessage)return xe;var ve=new te.TrackChangesBatchUpdateSuggestionsStateMessage;if(xe.ids){if(!Array.isArray(xe.ids))throw TypeError(".TrackChangesBatchUpdateSuggestionsStateMessage.ids: array expected");ve.ids=[];for(var ke=0;ke<xe.ids.length;++ke)ve.ids[ke]=String(xe.ids[ke])}return xe.documentId!=null&&(ve.documentId=String(xe.documentId)),xe.state!=null&&(ve.state=String(xe.state)),ve},be.toObject=function(xe,ve){ve||(ve={});var ke={};if((ve.arrays||ve.defaults)&&(ke.ids=[]),ve.defaults&&(ke.documentId="",ke.state=""),xe.ids&&xe.ids.length){ke.ids=[];for(var Ie=0;Ie<xe.ids.length;++Ie)ke.ids[Ie]=xe.ids[Ie]}return xe.documentId!=null&&xe.hasOwnProperty("documentId")&&(ke.documentId=xe.documentId),xe.state!=null&&xe.hasOwnProperty("state")&&(ke.state=xe.state),ke},be.prototype.toJSON=function(){return this.constructor.toObject(this,_0x462d7f.util.toJSONOptions)},be.getTypeUrl=function(xe){return xe===void 0&&(xe="type.googleapis.com"),xe+"/TrackChangesBatchUpdateSuggestionsStateMessage"},be}(),te.TrackChangesConnectMessage=function(){function be(xe){if(xe)for(var ve=Object.keys(xe),ke=0;ke<ve.length;++ke)xe[ve[ke]]!=null&&(this[ve[ke]]=xe[ve[ke]])}return be.prototype.documentId="",be.create=function(xe){return new be(xe)},be.encode=function(xe,ve){return ve||(ve=we.create()),xe.documentId!=null&&Object.hasOwnProperty.call(xe,"documentId")&&ve.uint32(10).string(xe.documentId),ve},be.encodeDelimited=function(xe,ve){return this.encode(xe,ve).ldelim()},be.decode=function(xe,ve){xe instanceof Te||(xe=Te.create(xe));for(var ke=ve===void 0?xe.len:xe.pos+ve,Ie=new te.TrackChangesConnectMessage;xe.pos<ke;){var Ae=xe.uint32();Ae>>>3==1?Ie.documentId=xe.string():xe.skipType(7&Ae)}return Ie},be.decodeDelimited=function(xe){return xe instanceof Te||(xe=new Te(xe)),this.decode(xe,xe.uint32())},be.verify=function(xe){return typeof xe!="object"||xe===null?"object expected":xe.documentId!=null&&xe.hasOwnProperty("documentId")&&!t.isString(xe.documentId)?"documentId: string expected":null},be.fromObject=function(xe){if(xe instanceof te.TrackChangesConnectMessage)return xe;var ve=new te.TrackChangesConnectMessage;return xe.documentId!=null&&(ve.documentId=String(xe.documentId)),ve},be.toObject=function(xe,ve){ve||(ve={});var ke={};return ve.defaults&&(ke.documentId=""),xe.documentId!=null&&xe.hasOwnProperty("documentId")&&(ke.documentId=xe.documentId),ke},be.prototype.toJSON=function(){return this.constructor.toObject(this,_0x462d7f.util.toJSONOptions)},be.getTypeUrl=function(xe){return xe===void 0&&(xe="type.googleapis.com"),xe+"/TrackChangesConnectMessage"},be}(),te.TrackChangesGetAllSuggestionMessage=function(){function be(xe){if(xe)for(var ve=Object.keys(xe),ke=0;ke<ve.length;++ke)xe[ve[ke]]!=null&&(this[ve[ke]]=xe[ve[ke]])}return be.prototype.documentId="",be.create=function(xe){return new be(xe)},be.encode=function(xe,ve){return ve||(ve=we.create()),xe.documentId!=null&&Object.hasOwnProperty.call(xe,"documentId")&&ve.uint32(10).string(xe.documentId),ve},be.encodeDelimited=function(xe,ve){return this.encode(xe,ve).ldelim()},be.decode=function(xe,ve){xe instanceof Te||(xe=Te.create(xe));for(var ke=ve===void 0?xe.len:xe.pos+ve,Ie=new te.TrackChangesGetAllSuggestionMessage;xe.pos<ke;){var Ae=xe.uint32();Ae>>>3==1?Ie.documentId=xe.string():xe.skipType(7&Ae)}return Ie},be.decodeDelimited=function(xe){return xe instanceof Te||(xe=new Te(xe)),this.decode(xe,xe.uint32())},be.verify=function(xe){return typeof xe!="object"||xe===null?"object expected":xe.documentId!=null&&xe.hasOwnProperty("documentId")&&!t.isString(xe.documentId)?"documentId: string expected":null},be.fromObject=function(xe){if(xe instanceof te.TrackChangesGetAllSuggestionMessage)return xe;var ve=new te.TrackChangesGetAllSuggestionMessage;return xe.documentId!=null&&(ve.documentId=String(xe.documentId)),ve},be.toObject=function(xe,ve){ve||(ve={});var ke={};return ve.defaults&&(ke.documentId=""),xe.documentId!=null&&xe.hasOwnProperty("documentId")&&(ke.documentId=xe.documentId),ke},be.prototype.toJSON=function(){return this.constructor.toObject(this,_0x462d7f.util.toJSONOptions)},be.getTypeUrl=function(xe){return xe===void 0&&(xe="type.googleapis.com"),xe+"/TrackChangesGetAllSuggestionMessage"},be}(),te.TrackChangesGetSuggestionMessage=function(){function be(xe){if(xe)for(var ve=Object.keys(xe),ke=0;ke<ve.length;++ke)xe[ve[ke]]!=null&&(this[ve[ke]]=xe[ve[ke]])}return be.prototype.id="",be.prototype.documentId="",be.create=function(xe){return new be(xe)},be.encode=function(xe,ve){return ve||(ve=we.create()),xe.id!=null&&Object.hasOwnProperty.call(xe,"id")&&ve.uint32(10).string(xe.id),xe.documentId!=null&&Object.hasOwnProperty.call(xe,"documentId")&&ve.uint32(18).string(xe.documentId),ve},be.encodeDelimited=function(xe,ve){return this.encode(xe,ve).ldelim()},be.decode=function(xe,ve){xe instanceof Te||(xe=Te.create(xe));for(var ke=ve===void 0?xe.len:xe.pos+ve,Ie=new te.TrackChangesGetSuggestionMessage;xe.pos<ke;){var Ae=xe.uint32();switch(Ae>>>3){case 1:Ie.id=xe.string();break;case 2:Ie.documentId=xe.string();break;default:xe.skipType(7&Ae)}}return Ie},be.decodeDelimited=function(xe){return xe instanceof Te||(xe=new Te(xe)),this.decode(xe,xe.uint32())},be.verify=function(xe){return typeof xe!="object"||xe===null?"object expected":xe.id!=null&&xe.hasOwnProperty("id")&&!t.isString(xe.id)?"id: string expected":xe.documentId!=null&&xe.hasOwnProperty("documentId")&&!t.isString(xe.documentId)?"documentId: string expected":null},be.fromObject=function(xe){if(xe instanceof te.TrackChangesGetSuggestionMessage)return xe;var ve=new te.TrackChangesGetSuggestionMessage;return xe.id!=null&&(ve.id=String(xe.id)),xe.documentId!=null&&(ve.documentId=String(xe.documentId)),ve},be.toObject=function(xe,ve){ve||(ve={});var ke={};return ve.defaults&&(ke.id="",ke.documentId=""),xe.id!=null&&xe.hasOwnProperty("id")&&(ke.id=xe.id),xe.documentId!=null&&xe.hasOwnProperty("documentId")&&(ke.documentId=xe.documentId),ke},be.prototype.toJSON=function(){return this.constructor.toObject(this,_0x462d7f.util.toJSONOptions)},be.getTypeUrl=function(xe){return xe===void 0&&(xe="type.googleapis.com"),xe+"/TrackChangesGetSuggestionMessage"},be}(),te.TrackChangesUpdateSuggestionMessage=function(){function be(xe){if(xe)for(var ve=Object.keys(xe),ke=0;ke<ve.length;++ke)xe[ve[ke]]!=null&&(this[ve[ke]]=xe[ve[ke]])}return be.prototype.id="",be.prototype.documentId="",be.prototype.hasComments=!1,be.prototype.isHasCommentsModified=!1,be.prototype.state="",be.prototype.attributes="",be.create=function(xe){return new be(xe)},be.encode=function(xe,ve){return ve||(ve=we.create()),xe.id!=null&&Object.hasOwnProperty.call(xe,"id")&&ve.uint32(10).string(xe.id),xe.documentId!=null&&Object.hasOwnProperty.call(xe,"documentId")&&ve.uint32(18).string(xe.documentId),xe.hasComments!=null&&Object.hasOwnProperty.call(xe,"hasComments")&&ve.uint32(24).bool(xe.hasComments),xe.isHasCommentsModified!=null&&Object.hasOwnProperty.call(xe,"isHasCommentsModified")&&ve.uint32(32).bool(xe.isHasCommentsModified),xe.state!=null&&Object.hasOwnProperty.call(xe,"state")&&ve.uint32(42).string(xe.state),xe.attributes!=null&&Object.hasOwnProperty.call(xe,"attributes")&&ve.uint32(50).string(xe.attributes),ve},be.encodeDelimited=function(xe,ve){return this.encode(xe,ve).ldelim()},be.decode=function(xe,ve){xe instanceof Te||(xe=Te.create(xe));for(var ke=ve===void 0?xe.len:xe.pos+ve,Ie=new te.TrackChangesUpdateSuggestionMessage;xe.pos<ke;){var Ae=xe.uint32();switch(Ae>>>3){case 1:Ie.id=xe.string();break;case 2:Ie.documentId=xe.string();break;case 3:Ie.hasComments=xe.bool();break;case 4:Ie.isHasCommentsModified=xe.bool();break;case 5:Ie.state=xe.string();break;case 6:Ie.attributes=xe.string();break;default:xe.skipType(7&Ae)}}return Ie},be.decodeDelimited=function(xe){return xe instanceof Te||(xe=new Te(xe)),this.decode(xe,xe.uint32())},be.verify=function(xe){return typeof xe!="object"||xe===null?"object expected":xe.id!=null&&xe.hasOwnProperty("id")&&!t.isString(xe.id)?"id: string expected":xe.documentId!=null&&xe.hasOwnProperty("documentId")&&!t.isString(xe.documentId)?"documentId: string expected":xe.hasComments!=null&&xe.hasOwnProperty("hasComments")&&typeof xe.hasComments!="boolean"?"hasComments: boolean expected":xe.isHasCommentsModified!=null&&xe.hasOwnProperty("isHasCommentsModified")&&typeof xe.isHasCommentsModified!="boolean"?"isHasCommentsModified: boolean expected":xe.state!=null&&xe.hasOwnProperty("state")&&!t.isString(xe.state)?"state: string expected":xe.attributes!=null&&xe.hasOwnProperty("attributes")&&!t.isString(xe.attributes)?"attributes: string expected":null},be.fromObject=function(xe){if(xe instanceof te.TrackChangesUpdateSuggestionMessage)return xe;var ve=new te.TrackChangesUpdateSuggestionMessage;return xe.id!=null&&(ve.id=String(xe.id)),xe.documentId!=null&&(ve.documentId=String(xe.documentId)),xe.hasComments!=null&&(ve.hasComments=!!xe.hasComments),xe.isHasCommentsModified!=null&&(ve.isHasCommentsModified=!!xe.isHasCommentsModified),xe.state!=null&&(ve.state=String(xe.state)),xe.attributes!=null&&(ve.attributes=String(xe.attributes)),ve},be.toObject=function(xe,ve){ve||(ve={});var ke={};return ve.defaults&&(ke.id="",ke.documentId="",ke.hasComments=!1,ke.isHasCommentsModified=!1,ke.state="",ke.attributes=""),xe.id!=null&&xe.hasOwnProperty("id")&&(ke.id=xe.id),xe.documentId!=null&&xe.hasOwnProperty("documentId")&&(ke.documentId=xe.documentId),xe.hasComments!=null&&xe.hasOwnProperty("hasComments")&&(ke.hasComments=xe.hasComments),xe.isHasCommentsModified!=null&&xe.hasOwnProperty("isHasCommentsModified")&&(ke.isHasCommentsModified=xe.isHasCommentsModified),xe.state!=null&&xe.hasOwnProperty("state")&&(ke.state=xe.state),xe.attributes!=null&&xe.hasOwnProperty("attributes")&&(ke.attributes=xe.attributes),ke},be.prototype.toJSON=function(){return this.constructor.toObject(this,_0x462d7f.util.toJSONOptions)},be.getTypeUrl=function(xe){return xe===void 0&&(xe="type.googleapis.com"),xe+"/TrackChangesUpdateSuggestionMessage"},be}(),te.TrackChangesAddSuggestionResponse=function(){function be(xe){if(xe)for(var ve=Object.keys(xe),ke=0;ke<ve.length;++ke)xe[ve[ke]]!=null&&(this[ve[ke]]=xe[ve[ke]])}return be.prototype.id="",be.prototype.authorId="",be.prototype.type="",be.prototype.createdAt="",be.prototype.data="",be.prototype.hasComments=!1,be.prototype.state="",be.prototype.attributes="",be.create=function(xe){return new be(xe)},be.encode=function(xe,ve){return ve||(ve=we.create()),xe.id!=null&&Object.hasOwnProperty.call(xe,"id")&&ve.uint32(10).string(xe.id),xe.authorId!=null&&Object.hasOwnProperty.call(xe,"authorId")&&ve.uint32(18).string(xe.authorId),xe.type!=null&&Object.hasOwnProperty.call(xe,"type")&&ve.uint32(26).string(xe.type),xe.createdAt!=null&&Object.hasOwnProperty.call(xe,"createdAt")&&ve.uint32(34).string(xe.createdAt),xe.data!=null&&Object.hasOwnProperty.call(xe,"data")&&ve.uint32(42).string(xe.data),xe.hasComments!=null&&Object.hasOwnProperty.call(xe,"hasComments")&&ve.uint32(48).bool(xe.hasComments),xe.state!=null&&Object.hasOwnProperty.call(xe,"state")&&ve.uint32(58).string(xe.state),xe.attributes!=null&&Object.hasOwnProperty.call(xe,"attributes")&&ve.uint32(66).string(xe.attributes),ve},be.encodeDelimited=function(xe,ve){return this.encode(xe,ve).ldelim()},be.decode=function(xe,ve){xe instanceof Te||(xe=Te.create(xe));for(var ke=ve===void 0?xe.len:xe.pos+ve,Ie=new te.TrackChangesAddSuggestionResponse;xe.pos<ke;){var Ae=xe.uint32();switch(Ae>>>3){case 1:Ie.id=xe.string();break;case 2:Ie.authorId=xe.string();break;case 3:Ie.type=xe.string();break;case 4:Ie.createdAt=xe.string();break;case 5:Ie.data=xe.string();break;case 6:Ie.hasComments=xe.bool();break;case 7:Ie.state=xe.string();break;case 8:Ie.attributes=xe.string();break;default:xe.skipType(7&Ae)}}return Ie},be.decodeDelimited=function(xe){return xe instanceof Te||(xe=new Te(xe)),this.decode(xe,xe.uint32())},be.verify=function(xe){return typeof xe!="object"||xe===null?"object expected":xe.id!=null&&xe.hasOwnProperty("id")&&!t.isString(xe.id)?"id: string expected":xe.authorId!=null&&xe.hasOwnProperty("authorId")&&!t.isString(xe.authorId)?"authorId: string expected":xe.type!=null&&xe.hasOwnProperty("type")&&!t.isString(xe.type)?"type: string expected":xe.createdAt!=null&&xe.hasOwnProperty("createdAt")&&!t.isString(xe.createdAt)?"createdAt: string expected":xe.data!=null&&xe.hasOwnProperty("data")&&!t.isString(xe.data)?"data: string expected":xe.hasComments!=null&&xe.hasOwnProperty("hasComments")&&typeof xe.hasComments!="boolean"?"hasComments: boolean expected":xe.state!=null&&xe.hasOwnProperty("state")&&!t.isString(xe.state)?"state: string expected":xe.attributes!=null&&xe.hasOwnProperty("attributes")&&!t.isString(xe.attributes)?"attributes: string expected":null},be.fromObject=function(xe){if(xe instanceof te.TrackChangesAddSuggestionResponse)return xe;var ve=new te.TrackChangesAddSuggestionResponse;return xe.id!=null&&(ve.id=String(xe.id)),xe.authorId!=null&&(ve.authorId=String(xe.authorId)),xe.type!=null&&(ve.type=String(xe.type)),xe.createdAt!=null&&(ve.createdAt=String(xe.createdAt)),xe.data!=null&&(ve.data=String(xe.data)),xe.hasComments!=null&&(ve.hasComments=!!xe.hasComments),xe.state!=null&&(ve.state=String(xe.state)),xe.attributes!=null&&(ve.attributes=String(xe.attributes)),ve},be.toObject=function(xe,ve){ve||(ve={});var ke={};return ve.defaults&&(ke.id="",ke.authorId="",ke.type="",ke.createdAt="",ke.data="",ke.hasComments=!1,ke.state="",ke.attributes=""),xe.id!=null&&xe.hasOwnProperty("id")&&(ke.id=xe.id),xe.authorId!=null&&xe.hasOwnProperty("authorId")&&(ke.authorId=xe.authorId),xe.type!=null&&xe.hasOwnProperty("type")&&(ke.type=xe.type),xe.createdAt!=null&&xe.hasOwnProperty("createdAt")&&(ke.createdAt=xe.createdAt),xe.data!=null&&xe.hasOwnProperty("data")&&(ke.data=xe.data),xe.hasComments!=null&&xe.hasOwnProperty("hasComments")&&(ke.hasComments=xe.hasComments),xe.state!=null&&xe.hasOwnProperty("state")&&(ke.state=xe.state),xe.attributes!=null&&xe.hasOwnProperty("attributes")&&(ke.attributes=xe.attributes),ke},be.prototype.toJSON=function(){return this.constructor.toObject(this,_0x462d7f.util.toJSONOptions)},be.getTypeUrl=function(xe){return xe===void 0&&(xe="type.googleapis.com"),xe+"/TrackChangesAddSuggestionResponse"},be}(),te.TrackChangesConnectResponse=function(){function be(xe){if(this.suggestions=[],this.suggestionsV2=[],xe)for(var ve=Object.keys(xe),ke=0;ke<ve.length;++ke)xe[ve[ke]]!=null&&(this[ve[ke]]=xe[ve[ke]])}return be.prototype.channel="",be.prototype.suggestions=t.emptyArray,be.prototype.suggestionsV2=t.emptyArray,be.create=function(xe){return new be(xe)},be.encode=function(xe,ve){if(ve||(ve=we.create()),xe.channel!=null&&Object.hasOwnProperty.call(xe,"channel")&&ve.uint32(10).string(xe.channel),xe.suggestions!=null&&xe.suggestions.length)for(var ke=0;ke<xe.suggestions.length;++ke)ve.uint32(18).string(xe.suggestions[ke]);if(xe.suggestionsV2!=null&&xe.suggestionsV2.length)for(ke=0;ke<xe.suggestionsV2.length;++ke)te.SuggestionDescriptor.encode(xe.suggestionsV2[ke],ve.uint32(26).fork()).ldelim();return ve},be.encodeDelimited=function(xe,ve){return this.encode(xe,ve).ldelim()},be.decode=function(xe,ve){xe instanceof Te||(xe=Te.create(xe));for(var ke=ve===void 0?xe.len:xe.pos+ve,Ie=new te.TrackChangesConnectResponse;xe.pos<ke;){var Ae=xe.uint32();switch(Ae>>>3){case 1:Ie.channel=xe.string();break;case 2:Ie.suggestions&&Ie.suggestions.length||(Ie.suggestions=[]),Ie.suggestions.push(xe.string());break;case 3:Ie.suggestionsV2&&Ie.suggestionsV2.length||(Ie.suggestionsV2=[]),Ie.suggestionsV2.push(te.SuggestionDescriptor.decode(xe,xe.uint32()));break;default:xe.skipType(7&Ae)}}return Ie},be.decodeDelimited=function(xe){return xe instanceof Te||(xe=new Te(xe)),this.decode(xe,xe.uint32())},be.verify=function(xe){if(typeof xe!="object"||xe===null)return"object expected";if(xe.channel!=null&&xe.hasOwnProperty("channel")&&!t.isString(xe.channel))return"channel: string expected";if(xe.suggestions!=null&&xe.hasOwnProperty("suggestions")){if(!Array.isArray(xe.suggestions))return"suggestions: array expected";for(var ve=0;ve<xe.suggestions.length;++ve)if(!t.isString(xe.suggestions[ve]))return"suggestions: string[] expected"}if(xe.suggestionsV2!=null&&xe.hasOwnProperty("suggestionsV2")){if(!Array.isArray(xe.suggestionsV2))return"suggestionsV2: array expected";for(ve=0;ve<xe.suggestionsV2.length;++ve){var ke=te.SuggestionDescriptor.verify(xe.suggestionsV2[ve]);if(ke)return"suggestionsV2."+ke}}return null},be.fromObject=function(xe){if(xe instanceof te.TrackChangesConnectResponse)return xe;var ve=new te.TrackChangesConnectResponse;if(xe.channel!=null&&(ve.channel=String(xe.channel)),xe.suggestions){if(!Array.isArray(xe.suggestions))throw TypeError(".TrackChangesConnectResponse.suggestions: array expected");ve.suggestions=[];for(var ke=0;ke<xe.suggestions.length;++ke)ve.suggestions[ke]=String(xe.suggestions[ke])}if(xe.suggestionsV2){if(!Array.isArray(xe.suggestionsV2))throw TypeError(".TrackChangesConnectResponse.suggestionsV2: array expected");for(ve.suggestionsV2=[],ke=0;ke<xe.suggestionsV2.length;++ke){if(typeof xe.suggestionsV2[ke]!="object")throw TypeError(".TrackChangesConnectResponse.suggestionsV2: object expected");ve.suggestionsV2[ke]=te.SuggestionDescriptor.fromObject(xe.suggestionsV2[ke])}}return ve},be.toObject=function(xe,ve){ve||(ve={});var ke={};if((ve.arrays||ve.defaults)&&(ke.suggestions=[],ke.suggestionsV2=[]),ve.defaults&&(ke.channel=""),xe.channel!=null&&xe.hasOwnProperty("channel")&&(ke.channel=xe.channel),xe.suggestions&&xe.suggestions.length){ke.suggestions=[];for(var Ie=0;Ie<xe.suggestions.length;++Ie)ke.suggestions[Ie]=xe.suggestions[Ie]}if(xe.suggestionsV2&&xe.suggestionsV2.length)for(ke.suggestionsV2=[],Ie=0;Ie<xe.suggestionsV2.length;++Ie)ke.suggestionsV2[Ie]=te.SuggestionDescriptor.toObject(xe.suggestionsV2[Ie],ve);return ke},be.prototype.toJSON=function(){return this.constructor.toObject(this,_0x462d7f.util.toJSONOptions)},be.getTypeUrl=function(xe){return xe===void 0&&(xe="type.googleapis.com"),xe+"/TrackChangesConnectResponse"},be}(),te.TrackChangesGetAllSuggestionsResponse=function(){function be(xe){if(this.suggestions=[],this.suggestionsV2=[],xe)for(var ve=Object.keys(xe),ke=0;ke<ve.length;++ke)xe[ve[ke]]!=null&&(this[ve[ke]]=xe[ve[ke]])}return be.prototype.suggestions=t.emptyArray,be.prototype.suggestionsV2=t.emptyArray,be.create=function(xe){return new be(xe)},be.encode=function(xe,ve){if(ve||(ve=we.create()),xe.suggestions!=null&&xe.suggestions.length)for(var ke=0;ke<xe.suggestions.length;++ke)ve.uint32(10).string(xe.suggestions[ke]);if(xe.suggestionsV2!=null&&xe.suggestionsV2.length)for(ke=0;ke<xe.suggestionsV2.length;++ke)te.SuggestionDescriptor.encode(xe.suggestionsV2[ke],ve.uint32(18).fork()).ldelim();return ve},be.encodeDelimited=function(xe,ve){return this.encode(xe,ve).ldelim()},be.decode=function(xe,ve){xe instanceof Te||(xe=Te.create(xe));for(var ke=ve===void 0?xe.len:xe.pos+ve,Ie=new te.TrackChangesGetAllSuggestionsResponse;xe.pos<ke;){var Ae=xe.uint32();switch(Ae>>>3){case 1:Ie.suggestions&&Ie.suggestions.length||(Ie.suggestions=[]),Ie.suggestions.push(xe.string());break;case 2:Ie.suggestionsV2&&Ie.suggestionsV2.length||(Ie.suggestionsV2=[]),Ie.suggestionsV2.push(te.SuggestionDescriptor.decode(xe,xe.uint32()));break;default:xe.skipType(7&Ae)}}return Ie},be.decodeDelimited=function(xe){return xe instanceof Te||(xe=new Te(xe)),this.decode(xe,xe.uint32())},be.verify=function(xe){if(typeof xe!="object"||xe===null)return"object expected";if(xe.suggestions!=null&&xe.hasOwnProperty("suggestions")){if(!Array.isArray(xe.suggestions))return"suggestions: array expected";for(var ve=0;ve<xe.suggestions.length;++ve)if(!t.isString(xe.suggestions[ve]))return"suggestions: string[] expected"}if(xe.suggestionsV2!=null&&xe.hasOwnProperty("suggestionsV2")){if(!Array.isArray(xe.suggestionsV2))return"suggestionsV2: array expected";for(ve=0;ve<xe.suggestionsV2.length;++ve){var ke=te.SuggestionDescriptor.verify(xe.suggestionsV2[ve]);if(ke)return"suggestionsV2."+ke}}return null},be.fromObject=function(xe){if(xe instanceof te.TrackChangesGetAllSuggestionsResponse)return xe;var ve=new te.TrackChangesGetAllSuggestionsResponse;if(xe.suggestions){if(!Array.isArray(xe.suggestions))throw TypeError(".TrackChangesGetAllSuggestionsResponse.suggestions: array expected");ve.suggestions=[];for(var ke=0;ke<xe.suggestions.length;++ke)ve.suggestions[ke]=String(xe.suggestions[ke])}if(xe.suggestionsV2){if(!Array.isArray(xe.suggestionsV2))throw TypeError(".TrackChangesGetAllSuggestionsResponse.suggestionsV2: array expected");for(ve.suggestionsV2=[],ke=0;ke<xe.suggestionsV2.length;++ke){if(typeof xe.suggestionsV2[ke]!="object")throw TypeError(".TrackChangesGetAllSuggestionsResponse.suggestionsV2: object expected");ve.suggestionsV2[ke]=te.SuggestionDescriptor.fromObject(xe.suggestionsV2[ke])}}return ve},be.toObject=function(xe,ve){ve||(ve={});var ke={};if((ve.arrays||ve.defaults)&&(ke.suggestions=[],ke.suggestionsV2=[]),xe.suggestions&&xe.suggestions.length){ke.suggestions=[];for(var Ie=0;Ie<xe.suggestions.length;++Ie)ke.suggestions[Ie]=xe.suggestions[Ie]}if(xe.suggestionsV2&&xe.suggestionsV2.length)for(ke.suggestionsV2=[],Ie=0;Ie<xe.suggestionsV2.length;++Ie)ke.suggestionsV2[Ie]=te.SuggestionDescriptor.toObject(xe.suggestionsV2[Ie],ve);return ke},be.prototype.toJSON=function(){return this.constructor.toObject(this,_0x462d7f.util.toJSONOptions)},be.getTypeUrl=function(xe){return xe===void 0&&(xe="type.googleapis.com"),xe+"/TrackChangesGetAllSuggestionsResponse"},be}(),te.TrackChangesGetSuggestionResponse=function(){function be(xe){if(xe)for(var ve=Object.keys(xe),ke=0;ke<ve.length;++ke)xe[ve[ke]]!=null&&(this[ve[ke]]=xe[ve[ke]])}return be.prototype.id="",be.prototype.authorId="",be.prototype.type="",be.prototype.createdAt="",be.prototype.data="",be.prototype.hasComments=!1,be.prototype.state="",be.prototype.attributes="",be.create=function(xe){return new be(xe)},be.encode=function(xe,ve){return ve||(ve=we.create()),xe.id!=null&&Object.hasOwnProperty.call(xe,"id")&&ve.uint32(10).string(xe.id),xe.authorId!=null&&Object.hasOwnProperty.call(xe,"authorId")&&ve.uint32(18).string(xe.authorId),xe.type!=null&&Object.hasOwnProperty.call(xe,"type")&&ve.uint32(26).string(xe.type),xe.createdAt!=null&&Object.hasOwnProperty.call(xe,"createdAt")&&ve.uint32(34).string(xe.createdAt),xe.data!=null&&Object.hasOwnProperty.call(xe,"data")&&ve.uint32(42).string(xe.data),xe.hasComments!=null&&Object.hasOwnProperty.call(xe,"hasComments")&&ve.uint32(48).bool(xe.hasComments),xe.state!=null&&Object.hasOwnProperty.call(xe,"state")&&ve.uint32(58).string(xe.state),xe.attributes!=null&&Object.hasOwnProperty.call(xe,"attributes")&&ve.uint32(66).string(xe.attributes),ve},be.encodeDelimited=function(xe,ve){return this.encode(xe,ve).ldelim()},be.decode=function(xe,ve){xe instanceof Te||(xe=Te.create(xe));for(var ke=ve===void 0?xe.len:xe.pos+ve,Ie=new te.TrackChangesGetSuggestionResponse;xe.pos<ke;){var Ae=xe.uint32();switch(Ae>>>3){case 1:Ie.id=xe.string();break;case 2:Ie.authorId=xe.string();break;case 3:Ie.type=xe.string();break;case 4:Ie.createdAt=xe.string();break;case 5:Ie.data=xe.string();break;case 6:Ie.hasComments=xe.bool();break;case 7:Ie.state=xe.string();break;case 8:Ie.attributes=xe.string();break;default:xe.skipType(7&Ae)}}return Ie},be.decodeDelimited=function(xe){return xe instanceof Te||(xe=new Te(xe)),this.decode(xe,xe.uint32())},be.verify=function(xe){return typeof xe!="object"||xe===null?"object expected":xe.id!=null&&xe.hasOwnProperty("id")&&!t.isString(xe.id)?"id: string expected":xe.authorId!=null&&xe.hasOwnProperty("authorId")&&!t.isString(xe.authorId)?"authorId: string expected":xe.type!=null&&xe.hasOwnProperty("type")&&!t.isString(xe.type)?"type: string expected":xe.createdAt!=null&&xe.hasOwnProperty("createdAt")&&!t.isString(xe.createdAt)?"createdAt: string expected":xe.data!=null&&xe.hasOwnProperty("data")&&!t.isString(xe.data)?"data: string expected":xe.hasComments!=null&&xe.hasOwnProperty("hasComments")&&typeof xe.hasComments!="boolean"?"hasComments: boolean expected":xe.state!=null&&xe.hasOwnProperty("state")&&!t.isString(xe.state)?"state: string expected":xe.attributes!=null&&xe.hasOwnProperty("attributes")&&!t.isString(xe.attributes)?"attributes: string expected":null},be.fromObject=function(xe){if(xe instanceof te.TrackChangesGetSuggestionResponse)return xe;var ve=new te.TrackChangesGetSuggestionResponse;return xe.id!=null&&(ve.id=String(xe.id)),xe.authorId!=null&&(ve.authorId=String(xe.authorId)),xe.type!=null&&(ve.type=String(xe.type)),xe.createdAt!=null&&(ve.createdAt=String(xe.createdAt)),xe.data!=null&&(ve.data=String(xe.data)),xe.hasComments!=null&&(ve.hasComments=!!xe.hasComments),xe.state!=null&&(ve.state=String(xe.state)),xe.attributes!=null&&(ve.attributes=String(xe.attributes)),ve},be.toObject=function(xe,ve){ve||(ve={});var ke={};return ve.defaults&&(ke.id="",ke.authorId="",ke.type="",ke.createdAt="",ke.data="",ke.hasComments=!1,ke.state="",ke.attributes=""),xe.id!=null&&xe.hasOwnProperty("id")&&(ke.id=xe.id),xe.authorId!=null&&xe.hasOwnProperty("authorId")&&(ke.authorId=xe.authorId),xe.type!=null&&xe.hasOwnProperty("type")&&(ke.type=xe.type),xe.createdAt!=null&&xe.hasOwnProperty("createdAt")&&(ke.createdAt=xe.createdAt),xe.data!=null&&xe.hasOwnProperty("data")&&(ke.data=xe.data),xe.hasComments!=null&&xe.hasOwnProperty("hasComments")&&(ke.hasComments=xe.hasComments),xe.state!=null&&xe.hasOwnProperty("state")&&(ke.state=xe.state),xe.attributes!=null&&xe.hasOwnProperty("attributes")&&(ke.attributes=xe.attributes),ke},be.prototype.toJSON=function(){return this.constructor.toObject(this,_0x462d7f.util.toJSONOptions)},be.getTypeUrl=function(xe){return xe===void 0&&(xe="type.googleapis.com"),xe+"/TrackChangesGetSuggestionResponse"},be}(),te.UserDescriptor=function(){function be(xe){if(this.attributes=[],xe)for(var ve=Object.keys(xe),ke=0;ke<ve.length;++ke)xe[ve[ke]]!=null&&(this[ve[ke]]=xe[ve[ke]])}return be.prototype.attributes=t.emptyArray,be.create=function(xe){return new be(xe)},be.encode=function(xe,ve){if(ve||(ve=we.create()),xe.attributes!=null&&xe.attributes.length)for(var ke=0;ke<xe.attributes.length;++ke)te.KeyValueDescriptor.encode(xe.attributes[ke],ve.uint32(10).fork()).ldelim();return ve},be.encodeDelimited=function(xe,ve){return this.encode(xe,ve).ldelim()},be.decode=function(xe,ve){xe instanceof Te||(xe=Te.create(xe));for(var ke=ve===void 0?xe.len:xe.pos+ve,Ie=new te.UserDescriptor;xe.pos<ke;){var Ae=xe.uint32();Ae>>>3==1?(Ie.attributes&&Ie.attributes.length||(Ie.attributes=[]),Ie.attributes.push(te.KeyValueDescriptor.decode(xe,xe.uint32()))):xe.skipType(7&Ae)}return Ie},be.decodeDelimited=function(xe){return xe instanceof Te||(xe=new Te(xe)),this.decode(xe,xe.uint32())},be.verify=function(xe){if(typeof xe!="object"||xe===null)return"object expected";if(xe.attributes!=null&&xe.hasOwnProperty("attributes")){if(!Array.isArray(xe.attributes))return"attributes: array expected";for(var ve=0;ve<xe.attributes.length;++ve){var ke=te.KeyValueDescriptor.verify(xe.attributes[ve]);if(ke)return"attributes."+ke}}return null},be.fromObject=function(xe){if(xe instanceof te.UserDescriptor)return xe;var ve=new te.UserDescriptor;if(xe.attributes){if(!Array.isArray(xe.attributes))throw TypeError(".UserDescriptor.attributes: array expected");ve.attributes=[];for(var ke=0;ke<xe.attributes.length;++ke){if(typeof xe.attributes[ke]!="object")throw TypeError(".UserDescriptor.attributes: object expected");ve.attributes[ke]=te.KeyValueDescriptor.fromObject(xe.attributes[ke])}}return ve},be.toObject=function(xe,ve){ve||(ve={});var ke={};if((ve.arrays||ve.defaults)&&(ke.attributes=[]),xe.attributes&&xe.attributes.length){ke.attributes=[];for(var Ie=0;Ie<xe.attributes.length;++Ie)ke.attributes[Ie]=te.KeyValueDescriptor.toObject(xe.attributes[Ie],ve)}return ke},be.prototype.toJSON=function(){return this.constructor.toObject(this,_0x462d7f.util.toJSONOptions)},be.getTypeUrl=function(xe){return xe===void 0&&(xe="type.googleapis.com"),xe+"/UserDescriptor"},be}(),te.GetManyUsersMessage=function(){function be(xe){if(this.ids=[],xe)for(var ve=Object.keys(xe),ke=0;ke<ve.length;++ke)xe[ve[ke]]!=null&&(this[ve[ke]]=xe[ve[ke]])}return be.prototype.ids=t.emptyArray,be.create=function(xe){return new be(xe)},be.encode=function(xe,ve){if(ve||(ve=we.create()),xe.ids!=null&&xe.ids.length)for(var ke=0;ke<xe.ids.length;++ke)ve.uint32(10).string(xe.ids[ke]);return ve},be.encodeDelimited=function(xe,ve){return this.encode(xe,ve).ldelim()},be.decode=function(xe,ve){xe instanceof Te||(xe=Te.create(xe));for(var ke=ve===void 0?xe.len:xe.pos+ve,Ie=new te.GetManyUsersMessage;xe.pos<ke;){var Ae=xe.uint32();Ae>>>3==1?(Ie.ids&&Ie.ids.length||(Ie.ids=[]),Ie.ids.push(xe.string())):xe.skipType(7&Ae)}return Ie},be.decodeDelimited=function(xe){return xe instanceof Te||(xe=new Te(xe)),this.decode(xe,xe.uint32())},be.verify=function(xe){if(typeof xe!="object"||xe===null)return"object expected";if(xe.ids!=null&&xe.hasOwnProperty("ids")){if(!Array.isArray(xe.ids))return"ids: array expected";for(var ve=0;ve<xe.ids.length;++ve)if(!t.isString(xe.ids[ve]))return"ids: string[] expected"}return null},be.fromObject=function(xe){if(xe instanceof te.GetManyUsersMessage)return xe;var ve=new te.GetManyUsersMessage;if(xe.ids){if(!Array.isArray(xe.ids))throw TypeError(".GetManyUsersMessage.ids: array expected");ve.ids=[];for(var ke=0;ke<xe.ids.length;++ke)ve.ids[ke]=String(xe.ids[ke])}return ve},be.toObject=function(xe,ve){ve||(ve={});var ke={};if((ve.arrays||ve.defaults)&&(ke.ids=[]),xe.ids&&xe.ids.length){ke.ids=[];for(var Ie=0;Ie<xe.ids.length;++Ie)ke.ids[Ie]=xe.ids[Ie]}return ke},be.prototype.toJSON=function(){return this.constructor.toObject(this,_0x462d7f.util.toJSONOptions)},be.getTypeUrl=function(xe){return xe===void 0&&(xe="type.googleapis.com"),xe+"/GetManyUsersMessage"},be}(),te.GetUserMessage=function(){function be(xe){if(xe)for(var ve=Object.keys(xe),ke=0;ke<ve.length;++ke)xe[ve[ke]]!=null&&(this[ve[ke]]=xe[ve[ke]])}return be.prototype.id="",be.create=function(xe){return new be(xe)},be.encode=function(xe,ve){return ve||(ve=we.create()),xe.id!=null&&Object.hasOwnProperty.call(xe,"id")&&ve.uint32(10).string(xe.id),ve},be.encodeDelimited=function(xe,ve){return this.encode(xe,ve).ldelim()},be.decode=function(xe,ve){xe instanceof Te||(xe=Te.create(xe));for(var ke=ve===void 0?xe.len:xe.pos+ve,Ie=new te.GetUserMessage;xe.pos<ke;){var Ae=xe.uint32();Ae>>>3==1?Ie.id=xe.string():xe.skipType(7&Ae)}return Ie},be.decodeDelimited=function(xe){return xe instanceof Te||(xe=new Te(xe)),this.decode(xe,xe.uint32())},be.verify=function(xe){return typeof xe!="object"||xe===null?"object expected":xe.id!=null&&xe.hasOwnProperty("id")&&!t.isString(xe.id)?"id: string expected":null},be.fromObject=function(xe){if(xe instanceof te.GetUserMessage)return xe;var ve=new te.GetUserMessage;return xe.id!=null&&(ve.id=String(xe.id)),ve},be.toObject=function(xe,ve){ve||(ve={});var ke={};return ve.defaults&&(ke.id=""),xe.id!=null&&xe.hasOwnProperty("id")&&(ke.id=xe.id),ke},be.prototype.toJSON=function(){return this.constructor.toObject(this,_0x462d7f.util.toJSONOptions)},be.getTypeUrl=function(xe){return xe===void 0&&(xe="type.googleapis.com"),xe+"/GetUserMessage"},be}(),te.GetManyUsersResponse=function(){function be(xe){if(this.users=[],xe)for(var ve=Object.keys(xe),ke=0;ke<ve.length;++ke)xe[ve[ke]]!=null&&(this[ve[ke]]=xe[ve[ke]])}return be.prototype.users=t.emptyArray,be.create=function(xe){return new be(xe)},be.encode=function(xe,ve){if(ve||(ve=we.create()),xe.users!=null&&xe.users.length)for(var ke=0;ke<xe.users.length;++ke)te.UserDescriptor.encode(xe.users[ke],ve.uint32(10).fork()).ldelim();return ve},be.encodeDelimited=function(xe,ve){return this.encode(xe,ve).ldelim()},be.decode=function(xe,ve){xe instanceof Te||(xe=Te.create(xe));for(var ke=ve===void 0?xe.len:xe.pos+ve,Ie=new te.GetManyUsersResponse;xe.pos<ke;){var Ae=xe.uint32();Ae>>>3==1?(Ie.users&&Ie.users.length||(Ie.users=[]),Ie.users.push(te.UserDescriptor.decode(xe,xe.uint32()))):xe.skipType(7&Ae)}return Ie},be.decodeDelimited=function(xe){return xe instanceof Te||(xe=new Te(xe)),this.decode(xe,xe.uint32())},be.verify=function(xe){if(typeof xe!="object"||xe===null)return"object expected";if(xe.users!=null&&xe.hasOwnProperty("users")){if(!Array.isArray(xe.users))return"users: array expected";for(var ve=0;ve<xe.users.length;++ve){var ke=te.UserDescriptor.verify(xe.users[ve]);if(ke)return"users."+ke}}return null},be.fromObject=function(xe){if(xe instanceof te.GetManyUsersResponse)return xe;var ve=new te.GetManyUsersResponse;if(xe.users){if(!Array.isArray(xe.users))throw TypeError(".GetManyUsersResponse.users: array expected");ve.users=[];for(var ke=0;ke<xe.users.length;++ke){if(typeof xe.users[ke]!="object")throw TypeError(".GetManyUsersResponse.users: object expected");ve.users[ke]=te.UserDescriptor.fromObject(xe.users[ke])}}return ve},be.toObject=function(xe,ve){ve||(ve={});var ke={};if((ve.arrays||ve.defaults)&&(ke.users=[]),xe.users&&xe.users.length){ke.users=[];for(var Ie=0;Ie<xe.users.length;++Ie)ke.users[Ie]=te.UserDescriptor.toObject(xe.users[Ie],ve)}return ke},be.prototype.toJSON=function(){return this.constructor.toObject(this,_0x462d7f.util.toJSONOptions)},be.getTypeUrl=function(xe){return xe===void 0&&(xe="type.googleapis.com"),xe+"/GetManyUsersResponse"},be}(),te.GetUserResponse=function(){function be(xe){if(this.attributes=[],xe)for(var ve=Object.keys(xe),ke=0;ke<ve.length;++ke)xe[ve[ke]]!=null&&(this[ve[ke]]=xe[ve[ke]])}return be.prototype.attributes=t.emptyArray,be.create=function(xe){return new be(xe)},be.encode=function(xe,ve){if(ve||(ve=we.create()),xe.attributes!=null&&xe.attributes.length)for(var ke=0;ke<xe.attributes.length;++ke)te.KeyValueDescriptor.encode(xe.attributes[ke],ve.uint32(10).fork()).ldelim();return ve},be.encodeDelimited=function(xe,ve){return this.encode(xe,ve).ldelim()},be.decode=function(xe,ve){xe instanceof Te||(xe=Te.create(xe));for(var ke=ve===void 0?xe.len:xe.pos+ve,Ie=new te.GetUserResponse;xe.pos<ke;){var Ae=xe.uint32();Ae>>>3==1?(Ie.attributes&&Ie.attributes.length||(Ie.attributes=[]),Ie.attributes.push(te.KeyValueDescriptor.decode(xe,xe.uint32()))):xe.skipType(7&Ae)}return Ie},be.decodeDelimited=function(xe){return xe instanceof Te||(xe=new Te(xe)),this.decode(xe,xe.uint32())},be.verify=function(xe){if(typeof xe!="object"||xe===null)return"object expected";if(xe.attributes!=null&&xe.hasOwnProperty("attributes")){if(!Array.isArray(xe.attributes))return"attributes: array expected";for(var ve=0;ve<xe.attributes.length;++ve){var ke=te.KeyValueDescriptor.verify(xe.attributes[ve]);if(ke)return"attributes."+ke}}return null},be.fromObject=function(xe){if(xe instanceof te.GetUserResponse)return xe;var ve=new te.GetUserResponse;if(xe.attributes){if(!Array.isArray(xe.attributes))throw TypeError(".GetUserResponse.attributes: array expected");ve.attributes=[];for(var ke=0;ke<xe.attributes.length;++ke){if(typeof xe.attributes[ke]!="object")throw TypeError(".GetUserResponse.attributes: object expected");ve.attributes[ke]=te.KeyValueDescriptor.fromObject(xe.attributes[ke])}}return ve},be.toObject=function(xe,ve){ve||(ve={});var ke={};if((ve.arrays||ve.defaults)&&(ke.attributes=[]),xe.attributes&&xe.attributes.length){ke.attributes=[];for(var Ie=0;Ie<xe.attributes.length;++Ie)ke.attributes[Ie]=te.KeyValueDescriptor.toObject(xe.attributes[Ie],ve)}return ke},be.prototype.toJSON=function(){return this.constructor.toObject(this,_0x462d7f.util.toJSONOptions)},be.getTypeUrl=function(xe){return xe===void 0&&(xe="type.googleapis.com"),xe+"/GetUserResponse"},be}(),te.ChannelMessage=function(){function be(xe){if(xe)for(var ve=Object.keys(xe),ke=0;ke<ve.length;++ke)xe[ve[ke]]!=null&&(this[ve[ke]]=xe[ve[ke]])}return be.prototype.type=0,be.prototype.socketId="",be.prototype.data=t.newBuffer([]),be.create=function(xe){return new be(xe)},be.encode=function(xe,ve){return ve||(ve=we.create()),xe.type!=null&&Object.hasOwnProperty.call(xe,"type")&&ve.uint32(8).uint32(xe.type),xe.socketId!=null&&Object.hasOwnProperty.call(xe,"socketId")&&ve.uint32(18).string(xe.socketId),xe.data!=null&&Object.hasOwnProperty.call(xe,"data")&&ve.uint32(26).bytes(xe.data),ve},be.encodeDelimited=function(xe,ve){return this.encode(xe,ve).ldelim()},be.decode=function(xe,ve){xe instanceof Te||(xe=Te.create(xe));for(var ke=ve===void 0?xe.len:xe.pos+ve,Ie=new te.ChannelMessage;xe.pos<ke;){var Ae=xe.uint32();switch(Ae>>>3){case 1:Ie.type=xe.uint32();break;case 2:Ie.socketId=xe.string();break;case 3:Ie.data=xe.bytes();break;default:xe.skipType(7&Ae)}}return Ie},be.decodeDelimited=function(xe){return xe instanceof Te||(xe=new Te(xe)),this.decode(xe,xe.uint32())},be.verify=function(xe){return typeof xe!="object"||xe===null?"object expected":xe.type!=null&&xe.hasOwnProperty("type")&&!t.isInteger(xe.type)?"type: integer expected":xe.socketId!=null&&xe.hasOwnProperty("socketId")&&!t.isString(xe.socketId)?"socketId: string expected":xe.data!=null&&xe.hasOwnProperty("data")&&!(xe.data&&typeof xe.data.length=="number"||t.isString(xe.data))?"data: buffer expected":null},be.fromObject=function(xe){if(xe instanceof te.ChannelMessage)return xe;var ve=new te.ChannelMessage;return xe.type!=null&&(ve.type=xe.type>>>0),xe.socketId!=null&&(ve.socketId=String(xe.socketId)),xe.data!=null&&(typeof xe.data=="string"?t.base64.decode(xe.data,ve.data=t.newBuffer(t.base64.length(xe.data)),0):xe.data.length>=0&&(ve.data=xe.data)),ve},be.toObject=function(xe,ve){ve||(ve={});var ke={};return ve.defaults&&(ke.type=0,ke.socketId="",ve.bytes===String?ke.data="":(ke.data=[],ve.bytes!==Array&&(ke.data=t.newBuffer(ke.data)))),xe.type!=null&&xe.hasOwnProperty("type")&&(ke.type=xe.type),xe.socketId!=null&&xe.hasOwnProperty("socketId")&&(ke.socketId=xe.socketId),xe.data!=null&&xe.hasOwnProperty("data")&&(ke.data=ve.bytes===String?t.base64.encode(xe.data,0,xe.data.length):ve.bytes===Array?Array.prototype.slice.call(xe.data):xe.data),ke},be.prototype.toJSON=function(){return this.constructor.toObject(this,_0x462d7f.util.toJSONOptions)},be.getTypeUrl=function(xe){return xe===void 0&&(xe="type.googleapis.com"),xe+"/ChannelMessage"},be}(),te.BytesBytesPacketDataMessage=function(){function be(xe){if(xe)for(var ve=Object.keys(xe),ke=0;ke<ve.length;++ke)xe[ve[ke]]!=null&&(this[ve[ke]]=xe[ve[ke]])}return be.prototype.data=t.newBuffer([]),be.prototype.data1=t.newBuffer([]),be.create=function(xe){return new be(xe)},be.encode=function(xe,ve){return ve||(ve=we.create()),xe.data!=null&&Object.hasOwnProperty.call(xe,"data")&&ve.uint32(10).bytes(xe.data),xe.data1!=null&&Object.hasOwnProperty.call(xe,"data1")&&ve.uint32(18).bytes(xe.data1),ve},be.encodeDelimited=function(xe,ve){return this.encode(xe,ve).ldelim()},be.decode=function(xe,ve){xe instanceof Te||(xe=Te.create(xe));for(var ke=ve===void 0?xe.len:xe.pos+ve,Ie=new te.BytesBytesPacketDataMessage;xe.pos<ke;){var Ae=xe.uint32();switch(Ae>>>3){case 1:Ie.data=xe.bytes();break;case 2:Ie.data1=xe.bytes();break;default:xe.skipType(7&Ae)}}return Ie},be.decodeDelimited=function(xe){return xe instanceof Te||(xe=new Te(xe)),this.decode(xe,xe.uint32())},be.verify=function(xe){return typeof xe!="object"||xe===null?"object expected":xe.data!=null&&xe.hasOwnProperty("data")&&!(xe.data&&typeof xe.data.length=="number"||t.isString(xe.data))?"data: buffer expected":xe.data1!=null&&xe.hasOwnProperty("data1")&&!(xe.data1&&typeof xe.data1.length=="number"||t.isString(xe.data1))?"data1: buffer expected":null},be.fromObject=function(xe){if(xe instanceof te.BytesBytesPacketDataMessage)return xe;var ve=new te.BytesBytesPacketDataMessage;return xe.data!=null&&(typeof xe.data=="string"?t.base64.decode(xe.data,ve.data=t.newBuffer(t.base64.length(xe.data)),0):xe.data.length>=0&&(ve.data=xe.data)),xe.data1!=null&&(typeof xe.data1=="string"?t.base64.decode(xe.data1,ve.data1=t.newBuffer(t.base64.length(xe.data1)),0):xe.data1.length>=0&&(ve.data1=xe.data1)),ve},be.toObject=function(xe,ve){ve||(ve={});var ke={};return ve.defaults&&(ve.bytes===String?ke.data="":(ke.data=[],ve.bytes!==Array&&(ke.data=t.newBuffer(ke.data))),ve.bytes===String?ke.data1="":(ke.data1=[],ve.bytes!==Array&&(ke.data1=t.newBuffer(ke.data1)))),xe.data!=null&&xe.hasOwnProperty("data")&&(ke.data=ve.bytes===String?t.base64.encode(xe.data,0,xe.data.length):ve.bytes===Array?Array.prototype.slice.call(xe.data):xe.data),xe.data1!=null&&xe.hasOwnProperty("data1")&&(ke.data1=ve.bytes===String?t.base64.encode(xe.data1,0,xe.data1.length):ve.bytes===Array?Array.prototype.slice.call(xe.data1):xe.data1),ke},be.prototype.toJSON=function(){return this.constructor.toObject(this,_0x462d7f.util.toJSONOptions)},be.getTypeUrl=function(xe){return xe===void 0&&(xe="type.googleapis.com"),xe+"/BytesBytesPacketDataMessage"},be}(),te.NumberBytesPacketDataMessage=function(){function be(xe){if(xe)for(var ve=Object.keys(xe),ke=0;ke<ve.length;++ke)xe[ve[ke]]!=null&&(this[ve[ke]]=xe[ve[ke]])}return be.prototype.data=0,be.prototype.data1=t.newBuffer([]),be.create=function(xe){return new be(xe)},be.encode=function(xe,ve){return ve||(ve=we.create()),xe.data!=null&&Object.hasOwnProperty.call(xe,"data")&&ve.uint32(8).uint32(xe.data),xe.data1!=null&&Object.hasOwnProperty.call(xe,"data1")&&ve.uint32(18).bytes(xe.data1),ve},be.encodeDelimited=function(xe,ve){return this.encode(xe,ve).ldelim()},be.decode=function(xe,ve){xe instanceof Te||(xe=Te.create(xe));for(var ke=ve===void 0?xe.len:xe.pos+ve,Ie=new te.NumberBytesPacketDataMessage;xe.pos<ke;){var Ae=xe.uint32();switch(Ae>>>3){case 1:Ie.data=xe.uint32();break;case 2:Ie.data1=xe.bytes();break;default:xe.skipType(7&Ae)}}return Ie},be.decodeDelimited=function(xe){return xe instanceof Te||(xe=new Te(xe)),this.decode(xe,xe.uint32())},be.verify=function(xe){return typeof xe!="object"||xe===null?"object expected":xe.data!=null&&xe.hasOwnProperty("data")&&!t.isInteger(xe.data)?"data: integer expected":xe.data1!=null&&xe.hasOwnProperty("data1")&&!(xe.data1&&typeof xe.data1.length=="number"||t.isString(xe.data1))?"data1: buffer expected":null},be.fromObject=function(xe){if(xe instanceof te.NumberBytesPacketDataMessage)return xe;var ve=new te.NumberBytesPacketDataMessage;return xe.data!=null&&(ve.data=xe.data>>>0),xe.data1!=null&&(typeof xe.data1=="string"?t.base64.decode(xe.data1,ve.data1=t.newBuffer(t.base64.length(xe.data1)),0):xe.data1.length>=0&&(ve.data1=xe.data1)),ve},be.toObject=function(xe,ve){ve||(ve={});var ke={};return ve.defaults&&(ke.data=0,ve.bytes===String?ke.data1="":(ke.data1=[],ve.bytes!==Array&&(ke.data1=t.newBuffer(ke.data1)))),xe.data!=null&&xe.hasOwnProperty("data")&&(ke.data=xe.data),xe.data1!=null&&xe.hasOwnProperty("data1")&&(ke.data1=ve.bytes===String?t.base64.encode(xe.data1,0,xe.data1.length):ve.bytes===Array?Array.prototype.slice.call(xe.data1):xe.data1),ke},be.prototype.toJSON=function(){return this.constructor.toObject(this,_0x462d7f.util.toJSONOptions)},be.getTypeUrl=function(xe){return xe===void 0&&(xe="type.googleapis.com"),xe+"/NumberBytesPacketDataMessage"},be}(),te.NumberNumberPacketDataMessage=function(){function be(xe){if(xe)for(var ve=Object.keys(xe),ke=0;ke<ve.length;++ke)xe[ve[ke]]!=null&&(this[ve[ke]]=xe[ve[ke]])}return be.prototype.data=0,be.prototype.data1=0,be.create=function(xe){return new be(xe)},be.encode=function(xe,ve){return ve||(ve=we.create()),xe.data!=null&&Object.hasOwnProperty.call(xe,"data")&&ve.uint32(8).uint32(xe.data),xe.data1!=null&&Object.hasOwnProperty.call(xe,"data1")&&ve.uint32(16).uint32(xe.data1),ve},be.encodeDelimited=function(xe,ve){return this.encode(xe,ve).ldelim()},be.decode=function(xe,ve){xe instanceof Te||(xe=Te.create(xe));for(var ke=ve===void 0?xe.len:xe.pos+ve,Ie=new te.NumberNumberPacketDataMessage;xe.pos<ke;){var Ae=xe.uint32();switch(Ae>>>3){case 1:Ie.data=xe.uint32();break;case 2:Ie.data1=xe.uint32();break;default:xe.skipType(7&Ae)}}return Ie},be.decodeDelimited=function(xe){return xe instanceof Te||(xe=new Te(xe)),this.decode(xe,xe.uint32())},be.verify=function(xe){return typeof xe!="object"||xe===null?"object expected":xe.data!=null&&xe.hasOwnProperty("data")&&!t.isInteger(xe.data)?"data: integer expected":xe.data1!=null&&xe.hasOwnProperty("data1")&&!t.isInteger(xe.data1)?"data1: integer expected":null},be.fromObject=function(xe){if(xe instanceof te.NumberNumberPacketDataMessage)return xe;var ve=new te.NumberNumberPacketDataMessage;return xe.data!=null&&(ve.data=xe.data>>>0),xe.data1!=null&&(ve.data1=xe.data1>>>0),ve},be.toObject=function(xe,ve){ve||(ve={});var ke={};return ve.defaults&&(ke.data=0,ke.data1=0),xe.data!=null&&xe.hasOwnProperty("data")&&(ke.data=xe.data),xe.data1!=null&&xe.hasOwnProperty("data1")&&(ke.data1=xe.data1),ke},be.prototype.toJSON=function(){return this.constructor.toObject(this,_0x462d7f.util.toJSONOptions)},be.getTypeUrl=function(xe){return xe===void 0&&(xe="type.googleapis.com"),xe+"/NumberNumberPacketDataMessage"},be}(),te.NumberObjectPacketDataMessage=function(){function be(xe){if(xe)for(var ve=Object.keys(xe),ke=0;ke<ve.length;++ke)xe[ve[ke]]!=null&&(this[ve[ke]]=xe[ve[ke]])}return be.prototype.data=0,be.prototype.data1="",be.create=function(xe){return new be(xe)},be.encode=function(xe,ve){return ve||(ve=we.create()),xe.data!=null&&Object.hasOwnProperty.call(xe,"data")&&ve.uint32(8).uint32(xe.data),xe.data1!=null&&Object.hasOwnProperty.call(xe,"data1")&&ve.uint32(18).string(xe.data1),ve},be.encodeDelimited=function(xe,ve){return this.encode(xe,ve).ldelim()},be.decode=function(xe,ve){xe instanceof Te||(xe=Te.create(xe));for(var ke=ve===void 0?xe.len:xe.pos+ve,Ie=new te.NumberObjectPacketDataMessage;xe.pos<ke;){var Ae=xe.uint32();switch(Ae>>>3){case 1:Ie.data=xe.uint32();break;case 2:Ie.data1=xe.string();break;default:xe.skipType(7&Ae)}}return Ie},be.decodeDelimited=function(xe){return xe instanceof Te||(xe=new Te(xe)),this.decode(xe,xe.uint32())},be.verify=function(xe){return typeof xe!="object"||xe===null?"object expected":xe.data!=null&&xe.hasOwnProperty("data")&&!t.isInteger(xe.data)?"data: integer expected":xe.data1!=null&&xe.hasOwnProperty("data1")&&!t.isString(xe.data1)?"data1: string expected":null},be.fromObject=function(xe){if(xe instanceof te.NumberObjectPacketDataMessage)return xe;var ve=new te.NumberObjectPacketDataMessage;return xe.data!=null&&(ve.data=xe.data>>>0),xe.data1!=null&&(ve.data1=String(xe.data1)),ve},be.toObject=function(xe,ve){ve||(ve={});var ke={};return ve.defaults&&(ke.data=0,ke.data1=""),xe.data!=null&&xe.hasOwnProperty("data")&&(ke.data=xe.data),xe.data1!=null&&xe.hasOwnProperty("data1")&&(ke.data1=xe.data1),ke},be.prototype.toJSON=function(){return this.constructor.toObject(this,_0x462d7f.util.toJSONOptions)},be.getTypeUrl=function(xe){return xe===void 0&&(xe="type.googleapis.com"),xe+"/NumberObjectPacketDataMessage"},be}(),te.NumberStringPacketDataMessage=function(){function be(xe){if(xe)for(var ve=Object.keys(xe),ke=0;ke<ve.length;++ke)xe[ve[ke]]!=null&&(this[ve[ke]]=xe[ve[ke]])}return be.prototype.data=0,be.prototype.data1="",be.create=function(xe){return new be(xe)},be.encode=function(xe,ve){return ve||(ve=we.create()),xe.data!=null&&Object.hasOwnProperty.call(xe,"data")&&ve.uint32(8).uint32(xe.data),xe.data1!=null&&Object.hasOwnProperty.call(xe,"data1")&&ve.uint32(18).string(xe.data1),ve},be.encodeDelimited=function(xe,ve){return this.encode(xe,ve).ldelim()},be.decode=function(xe,ve){xe instanceof Te||(xe=Te.create(xe));for(var ke=ve===void 0?xe.len:xe.pos+ve,Ie=new te.NumberStringPacketDataMessage;xe.pos<ke;){var Ae=xe.uint32();switch(Ae>>>3){case 1:Ie.data=xe.uint32();break;case 2:Ie.data1=xe.string();break;default:xe.skipType(7&Ae)}}return Ie},be.decodeDelimited=function(xe){return xe instanceof Te||(xe=new Te(xe)),this.decode(xe,xe.uint32())},be.verify=function(xe){return typeof xe!="object"||xe===null?"object expected":xe.data!=null&&xe.hasOwnProperty("data")&&!t.isInteger(xe.data)?"data: integer expected":xe.data1!=null&&xe.hasOwnProperty("data1")&&!t.isString(xe.data1)?"data1: string expected":null},be.fromObject=function(xe){if(xe instanceof te.NumberStringPacketDataMessage)return xe;var ve=new te.NumberStringPacketDataMessage;return xe.data!=null&&(ve.data=xe.data>>>0),xe.data1!=null&&(ve.data1=String(xe.data1)),ve},be.toObject=function(xe,ve){ve||(ve={});var ke={};return ve.defaults&&(ke.data=0,ke.data1=""),xe.data!=null&&xe.hasOwnProperty("data")&&(ke.data=xe.data),xe.data1!=null&&xe.hasOwnProperty("data1")&&(ke.data1=xe.data1),ke},be.prototype.toJSON=function(){return this.constructor.toObject(this,_0x462d7f.util.toJSONOptions)},be.getTypeUrl=function(xe){return xe===void 0&&(xe="type.googleapis.com"),xe+"/NumberStringPacketDataMessage"},be}(),te.ObjectBufferPacketDataMessage=function(){function be(xe){if(xe)for(var ve=Object.keys(xe),ke=0;ke<ve.length;++ke)xe[ve[ke]]!=null&&(this[ve[ke]]=xe[ve[ke]])}return be.prototype.data="",be.prototype.data1=t.newBuffer([]),be.create=function(xe){return new be(xe)},be.encode=function(xe,ve){return ve||(ve=we.create()),xe.data!=null&&Object.hasOwnProperty.call(xe,"data")&&ve.uint32(10).string(xe.data),xe.data1!=null&&Object.hasOwnProperty.call(xe,"data1")&&ve.uint32(18).bytes(xe.data1),ve},be.encodeDelimited=function(xe,ve){return this.encode(xe,ve).ldelim()},be.decode=function(xe,ve){xe instanceof Te||(xe=Te.create(xe));for(var ke=ve===void 0?xe.len:xe.pos+ve,Ie=new te.ObjectBufferPacketDataMessage;xe.pos<ke;){var Ae=xe.uint32();switch(Ae>>>3){case 1:Ie.data=xe.string();break;case 2:Ie.data1=xe.bytes();break;default:xe.skipType(7&Ae)}}return Ie},be.decodeDelimited=function(xe){return xe instanceof Te||(xe=new Te(xe)),this.decode(xe,xe.uint32())},be.verify=function(xe){return typeof xe!="object"||xe===null?"object expected":xe.data!=null&&xe.hasOwnProperty("data")&&!t.isString(xe.data)?"data: string expected":xe.data1!=null&&xe.hasOwnProperty("data1")&&!(xe.data1&&typeof xe.data1.length=="number"||t.isString(xe.data1))?"data1: buffer expected":null},be.fromObject=function(xe){if(xe instanceof te.ObjectBufferPacketDataMessage)return xe;var ve=new te.ObjectBufferPacketDataMessage;return xe.data!=null&&(ve.data=String(xe.data)),xe.data1!=null&&(typeof xe.data1=="string"?t.base64.decode(xe.data1,ve.data1=t.newBuffer(t.base64.length(xe.data1)),0):xe.data1.length>=0&&(ve.data1=xe.data1)),ve},be.toObject=function(xe,ve){ve||(ve={});var ke={};return ve.defaults&&(ke.data="",ve.bytes===String?ke.data1="":(ke.data1=[],ve.bytes!==Array&&(ke.data1=t.newBuffer(ke.data1)))),xe.data!=null&&xe.hasOwnProperty("data")&&(ke.data=xe.data),xe.data1!=null&&xe.hasOwnProperty("data1")&&(ke.data1=ve.bytes===String?t.base64.encode(xe.data1,0,xe.data1.length):ve.bytes===Array?Array.prototype.slice.call(xe.data1):xe.data1),ke},be.prototype.toJSON=function(){return this.constructor.toObject(this,_0x462d7f.util.toJSONOptions)},be.getTypeUrl=function(xe){return xe===void 0&&(xe="type.googleapis.com"),xe+"/ObjectBufferPacketDataMessage"},be}(),te.ObjectObjectPacketDataMessage=function(){function be(xe){if(xe)for(var ve=Object.keys(xe),ke=0;ke<ve.length;++ke)xe[ve[ke]]!=null&&(this[ve[ke]]=xe[ve[ke]])}return be.prototype.data="",be.prototype.data1="",be.create=function(xe){return new be(xe)},be.encode=function(xe,ve){return ve||(ve=we.create()),xe.data!=null&&Object.hasOwnProperty.call(xe,"data")&&ve.uint32(10).string(xe.data),xe.data1!=null&&Object.hasOwnProperty.call(xe,"data1")&&ve.uint32(18).string(xe.data1),ve},be.encodeDelimited=function(xe,ve){return this.encode(xe,ve).ldelim()},be.decode=function(xe,ve){xe instanceof Te||(xe=Te.create(xe));for(var ke=ve===void 0?xe.len:xe.pos+ve,Ie=new te.ObjectObjectPacketDataMessage;xe.pos<ke;){var Ae=xe.uint32();switch(Ae>>>3){case 1:Ie.data=xe.string();break;case 2:Ie.data1=xe.string();break;default:xe.skipType(7&Ae)}}return Ie},be.decodeDelimited=function(xe){return xe instanceof Te||(xe=new Te(xe)),this.decode(xe,xe.uint32())},be.verify=function(xe){return typeof xe!="object"||xe===null?"object expected":xe.data!=null&&xe.hasOwnProperty("data")&&!t.isString(xe.data)?"data: string expected":xe.data1!=null&&xe.hasOwnProperty("data1")&&!t.isString(xe.data1)?"data1: string expected":null},be.fromObject=function(xe){if(xe instanceof te.ObjectObjectPacketDataMessage)return xe;var ve=new te.ObjectObjectPacketDataMessage;return xe.data!=null&&(ve.data=String(xe.data)),xe.data1!=null&&(ve.data1=String(xe.data1)),ve},be.toObject=function(xe,ve){ve||(ve={});var ke={};return ve.defaults&&(ke.data="",ke.data1=""),xe.data!=null&&xe.hasOwnProperty("data")&&(ke.data=xe.data),xe.data1!=null&&xe.hasOwnProperty("data1")&&(ke.data1=xe.data1),ke},be.prototype.toJSON=function(){return this.constructor.toObject(this,_0x462d7f.util.toJSONOptions)},be.getTypeUrl=function(xe){return xe===void 0&&(xe="type.googleapis.com"),xe+"/ObjectObjectPacketDataMessage"},be}(),te.PacketMessage=function(){function be(xe){if(xe)for(var ve=Object.keys(xe),ke=0;ke<ve.length;++ke)xe[ve[ke]]!=null&&(this[ve[ke]]=xe[ve[ke]])}return be.prototype.type=0,be.prototype.id=0,be.prototype.nsp="",be.prototype.data=t.newBuffer([]),be.prototype.options=t.newBuffer([]),be.create=function(xe){return new be(xe)},be.encode=function(xe,ve){return ve||(ve=we.create()),xe.type!=null&&Object.hasOwnProperty.call(xe,"type")&&ve.uint32(8).uint32(xe.type),xe.id!=null&&Object.hasOwnProperty.call(xe,"id")&&ve.uint32(16).uint32(xe.id),xe.nsp!=null&&Object.hasOwnProperty.call(xe,"nsp")&&ve.uint32(26).string(xe.nsp),xe.data!=null&&Object.hasOwnProperty.call(xe,"data")&&ve.uint32(34).bytes(xe.data),xe.options!=null&&Object.hasOwnProperty.call(xe,"options")&&ve.uint32(42).bytes(xe.options),ve},be.encodeDelimited=function(xe,ve){return this.encode(xe,ve).ldelim()},be.decode=function(xe,ve){xe instanceof Te||(xe=Te.create(xe));for(var ke=ve===void 0?xe.len:xe.pos+ve,Ie=new te.PacketMessage;xe.pos<ke;){var Ae=xe.uint32();switch(Ae>>>3){case 1:Ie.type=xe.uint32();break;case 2:Ie.id=xe.uint32();break;case 3:Ie.nsp=xe.string();break;case 4:Ie.data=xe.bytes();break;case 5:Ie.options=xe.bytes();break;default:xe.skipType(7&Ae)}}return Ie},be.decodeDelimited=function(xe){return xe instanceof Te||(xe=new Te(xe)),this.decode(xe,xe.uint32())},be.verify=function(xe){return typeof xe!="object"||xe===null?"object expected":xe.type!=null&&xe.hasOwnProperty("type")&&!t.isInteger(xe.type)?"type: integer expected":xe.id!=null&&xe.hasOwnProperty("id")&&!t.isInteger(xe.id)?"id: integer expected":xe.nsp!=null&&xe.hasOwnProperty("nsp")&&!t.isString(xe.nsp)?"nsp: string expected":xe.data!=null&&xe.hasOwnProperty("data")&&!(xe.data&&typeof xe.data.length=="number"||t.isString(xe.data))?"data: buffer expected":xe.options!=null&&xe.hasOwnProperty("options")&&!(xe.options&&typeof xe.options.length=="number"||t.isString(xe.options))?"options: buffer expected":null},be.fromObject=function(xe){if(xe instanceof te.PacketMessage)return xe;var ve=new te.PacketMessage;return xe.type!=null&&(ve.type=xe.type>>>0),xe.id!=null&&(ve.id=xe.id>>>0),xe.nsp!=null&&(ve.nsp=String(xe.nsp)),xe.data!=null&&(typeof xe.data=="string"?t.base64.decode(xe.data,ve.data=t.newBuffer(t.base64.length(xe.data)),0):xe.data.length>=0&&(ve.data=xe.data)),xe.options!=null&&(typeof xe.options=="string"?t.base64.decode(xe.options,ve.options=t.newBuffer(t.base64.length(xe.options)),0):xe.options.length>=0&&(ve.options=xe.options)),ve},be.toObject=function(xe,ve){ve||(ve={});var ke={};return ve.defaults&&(ke.type=0,ke.id=0,ke.nsp="",ve.bytes===String?ke.data="":(ke.data=[],ve.bytes!==Array&&(ke.data=t.newBuffer(ke.data))),ve.bytes===String?ke.options="":(ke.options=[],ve.bytes!==Array&&(ke.options=t.newBuffer(ke.options)))),xe.type!=null&&xe.hasOwnProperty("type")&&(ke.type=xe.type),xe.id!=null&&xe.hasOwnProperty("id")&&(ke.id=xe.id),xe.nsp!=null&&xe.hasOwnProperty("nsp")&&(ke.nsp=xe.nsp),xe.data!=null&&xe.hasOwnProperty("data")&&(ke.data=ve.bytes===String?t.base64.encode(xe.data,0,xe.data.length):ve.bytes===Array?Array.prototype.slice.call(xe.data):xe.data),xe.options!=null&&xe.hasOwnProperty("options")&&(ke.options=ve.bytes===String?t.base64.encode(xe.options,0,xe.options.length):ve.bytes===Array?Array.prototype.slice.call(xe.options):xe.options),ke},be.prototype.toJSON=function(){return this.constructor.toObject(this,_0x462d7f.util.toJSONOptions)},be.getTypeUrl=function(xe){return xe===void 0&&(xe="type.googleapis.com"),xe+"/PacketMessage"},be}(),te.PacketOptionsMessage=function(){function be(xe){if(this.rooms=[],this.except=[],xe)for(var ve=Object.keys(xe),ke=0;ke<ve.length;++ke)xe[ve[ke]]!=null&&(this[ve[ke]]=xe[ve[ke]])}return be.prototype.flags="",be.prototype.rooms=t.emptyArray,be.prototype.except=t.emptyArray,be.create=function(xe){return new be(xe)},be.encode=function(xe,ve){if(ve||(ve=we.create()),xe.flags!=null&&Object.hasOwnProperty.call(xe,"flags")&&ve.uint32(10).string(xe.flags),xe.rooms!=null&&xe.rooms.length)for(var ke=0;ke<xe.rooms.length;++ke)ve.uint32(18).string(xe.rooms[ke]);if(xe.except!=null&&xe.except.length)for(ke=0;ke<xe.except.length;++ke)ve.uint32(26).string(xe.except[ke]);return ve},be.encodeDelimited=function(xe,ve){return this.encode(xe,ve).ldelim()},be.decode=function(xe,ve){xe instanceof Te||(xe=Te.create(xe));for(var ke=ve===void 0?xe.len:xe.pos+ve,Ie=new te.PacketOptionsMessage;xe.pos<ke;){var Ae=xe.uint32();switch(Ae>>>3){case 1:Ie.flags=xe.string();break;case 2:Ie.rooms&&Ie.rooms.length||(Ie.rooms=[]),Ie.rooms.push(xe.string());break;case 3:Ie.except&&Ie.except.length||(Ie.except=[]),Ie.except.push(xe.string());break;default:xe.skipType(7&Ae)}}return Ie},be.decodeDelimited=function(xe){return xe instanceof Te||(xe=new Te(xe)),this.decode(xe,xe.uint32())},be.verify=function(xe){if(typeof xe!="object"||xe===null)return"object expected";if(xe.flags!=null&&xe.hasOwnProperty("flags")&&!t.isString(xe.flags))return"flags: string expected";if(xe.rooms!=null&&xe.hasOwnProperty("rooms")){if(!Array.isArray(xe.rooms))return"rooms: array expected";for(var ve=0;ve<xe.rooms.length;++ve)if(!t.isString(xe.rooms[ve]))return"rooms: string[] expected"}if(xe.except!=null&&xe.hasOwnProperty("except")){if(!Array.isArray(xe.except))return"except: array expected";for(ve=0;ve<xe.except.length;++ve)if(!t.isString(xe.except[ve]))return"except: string[] expected"}return null},be.fromObject=function(xe){if(xe instanceof te.PacketOptionsMessage)return xe;var ve=new te.PacketOptionsMessage;if(xe.flags!=null&&(ve.flags=String(xe.flags)),xe.rooms){if(!Array.isArray(xe.rooms))throw TypeError(".PacketOptionsMessage.rooms: array expected");ve.rooms=[];for(var ke=0;ke<xe.rooms.length;++ke)ve.rooms[ke]=String(xe.rooms[ke])}if(xe.except){if(!Array.isArray(xe.except))throw TypeError(".PacketOptionsMessage.except: array expected");for(ve.except=[],ke=0;ke<xe.except.length;++ke)ve.except[ke]=String(xe.except[ke])}return ve},be.toObject=function(xe,ve){ve||(ve={});var ke={};if((ve.arrays||ve.defaults)&&(ke.rooms=[],ke.except=[]),ve.defaults&&(ke.flags=""),xe.flags!=null&&xe.hasOwnProperty("flags")&&(ke.flags=xe.flags),xe.rooms&&xe.rooms.length){ke.rooms=[];for(var Ie=0;Ie<xe.rooms.length;++Ie)ke.rooms[Ie]=xe.rooms[Ie]}if(xe.except&&xe.except.length)for(ke.except=[],Ie=0;Ie<xe.except.length;++Ie)ke.except[Ie]=xe.except[Ie];return ke},be.prototype.toJSON=function(){return this.constructor.toObject(this,_0x462d7f.util.toJSONOptions)},be.getTypeUrl=function(xe){return xe===void 0&&(xe="type.googleapis.com"),xe+"/PacketOptionsMessage"},be}(),te.StringBytesPacketDataMessage=function(){function be(xe){if(xe)for(var ve=Object.keys(xe),ke=0;ke<ve.length;++ke)xe[ve[ke]]!=null&&(this[ve[ke]]=xe[ve[ke]])}return be.prototype.data="",be.prototype.data1=t.newBuffer([]),be.create=function(xe){return new be(xe)},be.encode=function(xe,ve){return ve||(ve=we.create()),xe.data!=null&&Object.hasOwnProperty.call(xe,"data")&&ve.uint32(10).string(xe.data),xe.data1!=null&&Object.hasOwnProperty.call(xe,"data1")&&ve.uint32(18).bytes(xe.data1),ve},be.encodeDelimited=function(xe,ve){return this.encode(xe,ve).ldelim()},be.decode=function(xe,ve){xe instanceof Te||(xe=Te.create(xe));for(var ke=ve===void 0?xe.len:xe.pos+ve,Ie=new te.StringBytesPacketDataMessage;xe.pos<ke;){var Ae=xe.uint32();switch(Ae>>>3){case 1:Ie.data=xe.string();break;case 2:Ie.data1=xe.bytes();break;default:xe.skipType(7&Ae)}}return Ie},be.decodeDelimited=function(xe){return xe instanceof Te||(xe=new Te(xe)),this.decode(xe,xe.uint32())},be.verify=function(xe){return typeof xe!="object"||xe===null?"object expected":xe.data!=null&&xe.hasOwnProperty("data")&&!t.isString(xe.data)?"data: string expected":xe.data1!=null&&xe.hasOwnProperty("data1")&&!(xe.data1&&typeof xe.data1.length=="number"||t.isString(xe.data1))?"data1: buffer expected":null},be.fromObject=function(xe){if(xe instanceof te.StringBytesPacketDataMessage)return xe;var ve=new te.StringBytesPacketDataMessage;return xe.data!=null&&(ve.data=String(xe.data)),xe.data1!=null&&(typeof xe.data1=="string"?t.base64.decode(xe.data1,ve.data1=t.newBuffer(t.base64.length(xe.data1)),0):xe.data1.length>=0&&(ve.data1=xe.data1)),ve},be.toObject=function(xe,ve){ve||(ve={});var ke={};return ve.defaults&&(ke.data="",ve.bytes===String?ke.data1="":(ke.data1=[],ve.bytes!==Array&&(ke.data1=t.newBuffer(ke.data1)))),xe.data!=null&&xe.hasOwnProperty("data")&&(ke.data=xe.data),xe.data1!=null&&xe.hasOwnProperty("data1")&&(ke.data1=ve.bytes===String?t.base64.encode(xe.data1,0,xe.data1.length):ve.bytes===Array?Array.prototype.slice.call(xe.data1):xe.data1),ke},be.prototype.toJSON=function(){return this.constructor.toObject(this,_0x462d7f.util.toJSONOptions)},be.getTypeUrl=function(xe){return xe===void 0&&(xe="type.googleapis.com"),xe+"/StringBytesPacketDataMessage"},be}(),te.StringNumberPacketDataMessage=function(){function be(xe){if(xe)for(var ve=Object.keys(xe),ke=0;ke<ve.length;++ke)xe[ve[ke]]!=null&&(this[ve[ke]]=xe[ve[ke]])}return be.prototype.data="",be.prototype.data1=0,be.create=function(xe){return new be(xe)},be.encode=function(xe,ve){return ve||(ve=we.create()),xe.data!=null&&Object.hasOwnProperty.call(xe,"data")&&ve.uint32(10).string(xe.data),xe.data1!=null&&Object.hasOwnProperty.call(xe,"data1")&&ve.uint32(16).uint32(xe.data1),ve},be.encodeDelimited=function(xe,ve){return this.encode(xe,ve).ldelim()},be.decode=function(xe,ve){xe instanceof Te||(xe=Te.create(xe));for(var ke=ve===void 0?xe.len:xe.pos+ve,Ie=new te.StringNumberPacketDataMessage;xe.pos<ke;){var Ae=xe.uint32();switch(Ae>>>3){case 1:Ie.data=xe.string();break;case 2:Ie.data1=xe.uint32();break;default:xe.skipType(7&Ae)}}return Ie},be.decodeDelimited=function(xe){return xe instanceof Te||(xe=new Te(xe)),this.decode(xe,xe.uint32())},be.verify=function(xe){return typeof xe!="object"||xe===null?"object expected":xe.data!=null&&xe.hasOwnProperty("data")&&!t.isString(xe.data)?"data: string expected":xe.data1!=null&&xe.hasOwnProperty("data1")&&!t.isInteger(xe.data1)?"data1: integer expected":null},be.fromObject=function(xe){if(xe instanceof te.StringNumberPacketDataMessage)return xe;var ve=new te.StringNumberPacketDataMessage;return xe.data!=null&&(ve.data=String(xe.data)),xe.data1!=null&&(ve.data1=xe.data1>>>0),ve},be.toObject=function(xe,ve){ve||(ve={});var ke={};return ve.defaults&&(ke.data="",ke.data1=0),xe.data!=null&&xe.hasOwnProperty("data")&&(ke.data=xe.data),xe.data1!=null&&xe.hasOwnProperty("data1")&&(ke.data1=xe.data1),ke},be.prototype.toJSON=function(){return this.constructor.toObject(this,_0x462d7f.util.toJSONOptions)},be.getTypeUrl=function(xe){return xe===void 0&&(xe="type.googleapis.com"),xe+"/StringNumberPacketDataMessage"},be}(),te.StringObjectPacketDataMessage=function(){function be(xe){if(xe)for(var ve=Object.keys(xe),ke=0;ke<ve.length;++ke)xe[ve[ke]]!=null&&(this[ve[ke]]=xe[ve[ke]])}return be.prototype.data="",be.prototype.data1="",be.create=function(xe){return new be(xe)},be.encode=function(xe,ve){return ve||(ve=we.create()),xe.data!=null&&Object.hasOwnProperty.call(xe,"data")&&ve.uint32(10).string(xe.data),xe.data1!=null&&Object.hasOwnProperty.call(xe,"data1")&&ve.uint32(18).string(xe.data1),ve},be.encodeDelimited=function(xe,ve){return this.encode(xe,ve).ldelim()},be.decode=function(xe,ve){xe instanceof Te||(xe=Te.create(xe));for(var ke=ve===void 0?xe.len:xe.pos+ve,Ie=new te.StringObjectPacketDataMessage;xe.pos<ke;){var Ae=xe.uint32();switch(Ae>>>3){case 1:Ie.data=xe.string();break;case 2:Ie.data1=xe.string();break;default:xe.skipType(7&Ae)}}return Ie},be.decodeDelimited=function(xe){return xe instanceof Te||(xe=new Te(xe)),this.decode(xe,xe.uint32())},be.verify=function(xe){return typeof xe!="object"||xe===null?"object expected":xe.data!=null&&xe.hasOwnProperty("data")&&!t.isString(xe.data)?"data: string expected":xe.data1!=null&&xe.hasOwnProperty("data1")&&!t.isString(xe.data1)?"data1: string expected":null},be.fromObject=function(xe){if(xe instanceof te.StringObjectPacketDataMessage)return xe;var ve=new te.StringObjectPacketDataMessage;return xe.data!=null&&(ve.data=String(xe.data)),xe.data1!=null&&(ve.data1=String(xe.data1)),ve},be.toObject=function(xe,ve){ve||(ve={});var ke={};return ve.defaults&&(ke.data="",ke.data1=""),xe.data!=null&&xe.hasOwnProperty("data")&&(ke.data=xe.data),xe.data1!=null&&xe.hasOwnProperty("data1")&&(ke.data1=xe.data1),ke},be.prototype.toJSON=function(){return this.constructor.toObject(this,_0x462d7f.util.toJSONOptions)},be.getTypeUrl=function(xe){return xe===void 0&&(xe="type.googleapis.com"),xe+"/StringObjectPacketDataMessage"},be}(),te.StringStringPacketDataMessage=function(){function be(xe){if(xe)for(var ve=Object.keys(xe),ke=0;ke<ve.length;++ke)xe[ve[ke]]!=null&&(this[ve[ke]]=xe[ve[ke]])}return be.prototype.data="",be.prototype.data1="",be.create=function(xe){return new be(xe)},be.encode=function(xe,ve){return ve||(ve=we.create()),xe.data!=null&&Object.hasOwnProperty.call(xe,"data")&&ve.uint32(10).string(xe.data),xe.data1!=null&&Object.hasOwnProperty.call(xe,"data1")&&ve.uint32(18).string(xe.data1),ve},be.encodeDelimited=function(xe,ve){return this.encode(xe,ve).ldelim()},be.decode=function(xe,ve){xe instanceof Te||(xe=Te.create(xe));for(var ke=ve===void 0?xe.len:xe.pos+ve,Ie=new te.StringStringPacketDataMessage;xe.pos<ke;){var Ae=xe.uint32();switch(Ae>>>3){case 1:Ie.data=xe.string();break;case 2:Ie.data1=xe.string();break;default:xe.skipType(7&Ae)}}return Ie},be.decodeDelimited=function(xe){return xe instanceof Te||(xe=new Te(xe)),this.decode(xe,xe.uint32())},be.verify=function(xe){return typeof xe!="object"||xe===null?"object expected":xe.data!=null&&xe.hasOwnProperty("data")&&!t.isString(xe.data)?"data: string expected":xe.data1!=null&&xe.hasOwnProperty("data1")&&!t.isString(xe.data1)?"data1: string expected":null},be.fromObject=function(xe){if(xe instanceof te.StringStringPacketDataMessage)return xe;var ve=new te.StringStringPacketDataMessage;return xe.data!=null&&(ve.data=String(xe.data)),xe.data1!=null&&(ve.data1=String(xe.data1)),ve},be.toObject=function(xe,ve){ve||(ve={});var ke={};return ve.defaults&&(ke.data="",ke.data1=""),xe.data!=null&&xe.hasOwnProperty("data")&&(ke.data=xe.data),xe.data1!=null&&xe.hasOwnProperty("data1")&&(ke.data1=xe.data1),ke},be.prototype.toJSON=function(){return this.constructor.toObject(this,_0x462d7f.util.toJSONOptions)},be.getTypeUrl=function(xe){return xe===void 0&&(xe="type.googleapis.com"),xe+"/StringStringPacketDataMessage"},be}(),te})();class MessagesCompressor{static decode(we,t){const te=_getType(t).decode(typeof window>"u"?we:new Uint8Array(we));return t.fromJSON({...te})}static encode(we){const t=_getType(we.constructor),te=we.toJSON(),be=t.verify(te);if(be)throw Error(be);return t.encode(t.create(te)).finish()}}function _getType(Te){return messages[Te.DESCRIPTOR_NAME]}const Rn=class Rn extends Message{constructor(t){super();Re(this,"ids");this.ids=t}toJSON(){return{ids:this.ids}}static fromJSON(t){return new Rn(t.ids)}};Re(Rn,"TYPE","22"),Re(Rn,"READABLE_TYPE_NAME","getManyUsers"),Re(Rn,"DESCRIPTOR_NAME","GetManyUsersMessage"),Re(Rn,"DESCRIPTOR",{fields:{ids:{id:1,type:"string",rule:"repeated"}}});let GetManyUsersMessage=Rn;const Wi=class Wi extends Message{constructor(t){super();Re(this,"users");this.users=t}toJSON(){return{users:this.users.map(_userToJson)}}static fromJSON(t){return new Wi(t.users.map(_userFromJson))}};Re(Wi,"DESCRIPTOR_NAME","GetManyUsersResponse"),Re(Wi,"DESCRIPTOR",{fields:{users:{rule:"repeated",type:"UserDescriptor",id:1}}});let GetManyUsersResponse=Wi;function _userToJson(Te){return{attributes:Object.keys(Te).map(we=>({key:we,value:JSON.stringify(Te[we])}))}}function _userFromJson(Te){return Te.attributes.reduce((we,t)=>(we[t.key]=t.value?JSON.parse(t.value):null,we),{})}const En=class En{constructor(we={}){Re(this,"id");Re(this,"_attributes");this._attributes=new Map;for(const t of Object.keys(we))t!=="id"?(this._attributes.set(t,we[t]),Object.defineProperty(this,t,{enumerable:!0,configurable:!1,get:()=>this._attributes.get(t)})):this.id=we.id}static fromData(we){return new En(we)}static async get(we,t){const te=new GetUserMessage(t);try{const be=await we._sendRequest(En._SERVICE,GetUserMessage.TYPE,MessagesCompressor.encode(te)),xe=MessagesCompressor.decode(be,GetUserResponse);return new En(xe.attributes)}catch{return new En({id:t})}}static async getMany(we,t){const te=new GetManyUsersMessage(t);try{const be=await we._sendRequest(En._SERVICE,GetManyUsersMessage.TYPE,MessagesCompressor.encode(te));return MessagesCompressor.decode(be,GetManyUsersResponse).users.map(xe=>new En(xe))}catch{return t.map(xe=>new En({id:xe}))}}};Re(En,"_SERVICE",2);let User=En;const zi=class zi extends Message{constructor(t,te,be){super();Re(this,"type");Re(this,"socketId");Re(this,"data");this.type=t,this.socketId=te,this.data=be}toJSON(){return{type:this.type,socketId:this.socketId,data:this.data}}static fromJSON(t){return new zi(t.type,t.socketId,t.data)}};Re(zi,"DESCRIPTOR_NAME","ChannelMessage"),Re(zi,"DESCRIPTOR",{fields:{type:{type:"uint32",id:1},socketId:{type:"string",id:2},data:{type:"bytes",id:3}}});let ChannelMessage=zi;class Channel extends EmitterMixin(){constructor(t,te,be){super();Re(this,"_channelName");Re(this,"_wsGateway");Re(this,"_socket");this._channelName=t,this._wsGateway=te,this._socket=be,this._subscribeToChannel()}remove(){this._socket.off(this._channelName)}getEventName(t,te=!1){let be="";return te&&(be+="all:"),be+="event",t&&(be+=":"+t),be}_subscribeToChannel(){this._socket.on(this._channelName,t=>{const te=MessagesCompressor.decode(t,ChannelMessage);this.fire(this.getEventName(te.type,!0),te.data,te.socketId),te.socketId!==this._wsGateway.socketId&&this.fire(this.getEventName(te.type),te.data,te.socketId)})}}class CKEditorCloudServicesError extends Error{constructor(t,te,be=null,xe={}){super("cloud-services-internal-error: "+t);Re(this,"context");Re(this,"code");Re(this,"data");this.context=te,this.code=be,this.data=xe,this.name="CKEditorError"}static fromPublicError(t){return new CKEditorCloudServicesError(function(te){let be="cloud-services-error: "+te.message;return te.data&&(be+=`
Error data: `+JSON.stringify(te.data)),te.explanation&&(be+=`
Explanation: `+te.explanation),te.action&&(be+=`
Action: `+te.action),te.traceId&&(be+=`
TraceId: `+te.traceId),te.code&&(be+=`
Code: `+te.code),be}(t),t)}}class CKEditorCloudServicesServerError extends Error{constructor(t,te){super();Re(this,"code");Re(this,"traceId");Re(this,"data");this.name="CKEditorCloudServicesServerError",this.stack=void 0,this.message=t,this.code=te.code,this.traceId=te.traceId,this.data=te.data}static fromPublicError(t){return new CKEditorCloudServicesServerError(function(te){let be="cloud-services-server-error: "+te.message;return te.explanation&&(be+=`
Explanation: `+te.explanation),te.action&&(be+=`
Action: `+te.action),te.traceId&&(be+=`
TraceId: `+te.traceId),te.code&&(be+=`
Code: `+te.code),be}(t),t)}}const Vi=class Vi extends Message{constructor(t,te=[],be=[]){super();Re(this,"flags");Re(this,"rooms");Re(this,"except");this.flags=t,this.rooms=te,this.except=be}toJSON(){var t,te;return{flags:this.flags?JSON.stringify(this.flags):void 0,rooms:(t=this.rooms)!=null&&t.length?this.rooms:void 0,except:(te=this.except)!=null&&te.length?this.except:void 0}}static fromJSON(t){return new Vi(t.flags&&JSON.parse(t.flags),t.rooms,t.except)}};Re(Vi,"TYPE",11),Re(Vi,"DESCRIPTOR_NAME","PacketOptionsMessage"),Re(Vi,"DESCRIPTOR",{fields:{flags:{type:"string",id:1},rooms:{type:"string",id:2,rule:"repeated"},except:{type:"string",id:3,rule:"repeated"}}});let PacketOptionsMessage=Vi;const IS_NODE=!(typeof process>"u"||!process.versions||!process.versions.node),MessageDataTypes_BUFFER=1,MessageDataTypes_STRING=2,MessageDataTypes_NUMBER=3,MessageDataTypes_OBJECT=4;class ParserUtils{static getPacketType(...we){let t=0;for(let te=0;te<we.length;te++)t+=we[te]*Math.pow(10,we.length-te-1);return t}static getType(we){if(ParserUtils.isBuffer(we))return MessageDataTypes_BUFFER;const t=typeof we;return t==="string"?MessageDataTypes_STRING:t==="number"?MessageDataTypes_NUMBER:MessageDataTypes_OBJECT}static isBuffer(we){return IS_NODE&&Buffer.isBuffer(we)||we instanceof ArrayBuffer||we instanceof Uint8Array||this._isBufferView(we)}static _isBufferView(we){return typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(we):we.buffer instanceof ArrayBuffer}}class PackageDataMessage extends Message{constructor(){super(...arguments);Re(this,"data");Re(this,"data1")}static create(t,te){throw new TypeError("Must be implemented in a child class!")}}const Pn=class Pn extends PackageDataMessage{constructor(t,te){super();Re(this,"data");Re(this,"data1");this.data=t,this.data1=te}toJSON(){return{data:this.data,data1:this.data1}}static fromJSON(t){return new Pn(t.data,t.data1)}static create(t,te){return new Pn(t,te)}};Re(Pn,"TYPE",ParserUtils.getPacketType(MessageDataTypes_NUMBER,MessageDataTypes_BUFFER)),Re(Pn,"DESCRIPTOR_NAME","NumberBytesPacketDataMessage"),Re(Pn,"DESCRIPTOR",{fields:{data:{type:"uint32",id:1},data1:{type:"bytes",id:2}}});let NumberBytesPacketDataMessage=Pn;const Vn=class Vn extends PackageDataMessage{constructor(t,te){super();Re(this,"data");Re(this,"data1");this.data=t,this.data1=te}toJSON(){return{data:this.data,data1:this.data1}}static fromJSON(t){return new Vn(t.data,t.data1)}static create(t,te){return new Vn(t,te)}};Re(Vn,"TYPE",ParserUtils.getPacketType(MessageDataTypes_STRING,MessageDataTypes_BUFFER)),Re(Vn,"DESCRIPTOR_NAME","StringBytesPacketDataMessage"),Re(Vn,"DESCRIPTOR",{fields:{data:{type:"string",id:1},data1:{type:"bytes",id:2}}});let StringBytesPacketDataMessage=Vn;const Mn=class Mn extends PackageDataMessage{constructor(t,te){super();Re(this,"data");Re(this,"data1");this.data=t,this.data1=te}toJSON(){return{data:this.data,data1:this.data1}}static fromJSON(t){return new Mn(t.data,t.data1)}static create(t,te){return new Mn(t,te)}};Re(Mn,"TYPE",ParserUtils.getPacketType(MessageDataTypes_BUFFER,MessageDataTypes_BUFFER)),Re(Mn,"DESCRIPTOR_NAME","BytesBytesPacketDataMessage"),Re(Mn,"DESCRIPTOR",{fields:{data:{type:"bytes",id:1},data1:{type:"bytes",id:2}}});let BytesBytesPacketDataMessage=Mn;const Dn=class Dn extends PackageDataMessage{constructor(t,te){super();Re(this,"data");Re(this,"data1");this.data=t,this.data1=te}toJSON(){return{data:this.data,data1:this.data1?JSON.stringify(this.data1):void 0}}static fromJSON(t){return new Dn(t.data,t.data1&&JSON.parse(t.data1))}static create(t,te){return new Dn(t,te)}};Re(Dn,"TYPE",ParserUtils.getPacketType(MessageDataTypes_STRING,MessageDataTypes_OBJECT)),Re(Dn,"DESCRIPTOR_NAME","StringObjectPacketDataMessage"),Re(Dn,"DESCRIPTOR",{fields:{data:{type:"string",id:1},data1:{type:"string",id:2}}});let StringObjectPacketDataMessage=Dn;const Nn=class Nn extends PackageDataMessage{constructor(t,te){super();Re(this,"data");Re(this,"data1");this.data=t,this.data1=te}toJSON(){return{data:this.data,data1:this.data1?JSON.stringify(this.data1):void 0}}static fromJSON(t){return new Nn(t.data,t.data1&&JSON.parse(t.data1))}static create(t,te){return new Nn(t,te)}};Re(Nn,"TYPE",ParserUtils.getPacketType(MessageDataTypes_NUMBER,MessageDataTypes_OBJECT)),Re(Nn,"DESCRIPTOR_NAME","NumberObjectPacketDataMessage"),Re(Nn,"DESCRIPTOR",{fields:{data:{type:"uint32",id:1},data1:{type:"string",id:2}}});let NumberObjectPacketDataMessage=Nn;const Ln=class Ln extends PackageDataMessage{constructor(t,te){super();Re(this,"data");Re(this,"data1");this.data=t,this.data1=te}toJSON(){return{data:this.data?JSON.stringify(this.data):void 0,data1:this.data1?JSON.stringify(this.data1):void 0}}static fromJSON(t){return new Ln(t.data&&JSON.parse(t.data),t.data1&&JSON.parse(t.data1))}static create(t,te){return new Ln(t,te)}};Re(Ln,"TYPE",ParserUtils.getPacketType(MessageDataTypes_OBJECT,MessageDataTypes_OBJECT)),Re(Ln,"DESCRIPTOR_NAME","ObjectObjectPacketDataMessage"),Re(Ln,"DESCRIPTOR",{fields:{data:{type:"string",id:1},data1:{type:"string",id:2}}});let ObjectObjectPacketDataMessage=Ln;const Bn=class Bn extends PackageDataMessage{constructor(t,te){super();Re(this,"data");Re(this,"data1");this.data=t,this.data1=te}toJSON(){return{data:this.data?JSON.stringify(this.data):void 0,data1:this.data1}}static fromJSON(t){return new Bn(t.data&&JSON.parse(t.data),t.data1)}static create(t,te){return new Bn(t,te)}};Re(Bn,"TYPE",ParserUtils.getPacketType(MessageDataTypes_OBJECT,MessageDataTypes_BUFFER)),Re(Bn,"DESCRIPTOR_NAME","ObjectBufferPacketDataMessage"),Re(Bn,"DESCRIPTOR",{fields:{data:{type:"string",id:1},data1:{type:"bytes",id:2}}});let ObjectBufferPacketDataMessage=Bn;const Fn=class Fn extends PackageDataMessage{constructor(t,te){super();Re(this,"data");Re(this,"data1");this.data=t,this.data1=te}toJSON(){return{data:this.data,data1:this.data1}}static fromJSON(t){return new Fn(t.data,t.data1)}static create(t,te){return new Fn(t,te)}};Re(Fn,"TYPE",ParserUtils.getPacketType(MessageDataTypes_STRING,MessageDataTypes_STRING)),Re(Fn,"DESCRIPTOR_NAME","StringStringPacketDataMessage"),Re(Fn,"DESCRIPTOR",{fields:{data:{type:"string",id:1},data1:{type:"string",id:2}}});let StringStringPacketDataMessage=Fn;const $n=class $n extends PackageDataMessage{constructor(t,te){super();Re(this,"data");Re(this,"data1");this.data=t,this.data1=te}toJSON(){return{data:this.data,data1:this.data1}}static fromJSON(t){return new $n(t.data,t.data1)}static create(t,te){return new $n(t,te)}};Re($n,"TYPE",ParserUtils.getPacketType(MessageDataTypes_STRING,MessageDataTypes_NUMBER)),Re($n,"DESCRIPTOR_NAME","StringNumberPacketDataMessage"),Re($n,"DESCRIPTOR",{fields:{data:{type:"string",id:1},data1:{type:"uint32",id:2}}});let StringNumberPacketDataMessage=$n;const Un=class Un extends PackageDataMessage{constructor(t,te){super();Re(this,"data");Re(this,"data1");this.data=t,this.data1=te}toJSON(){return{data:this.data,data1:this.data1}}static fromJSON(t){return new Un(t.data,t.data1)}static create(t,te){return new Un(t,te)}};Re(Un,"TYPE",ParserUtils.getPacketType(MessageDataTypes_NUMBER,MessageDataTypes_NUMBER)),Re(Un,"DESCRIPTOR_NAME","NumberNumberPacketDataMessage"),Re(Un,"DESCRIPTOR",{fields:{data:{type:"uint32",id:1},data1:{type:"uint32",id:2}}});let NumberNumberPacketDataMessage=Un;const Hn=class Hn extends PackageDataMessage{constructor(t,te){super();Re(this,"data");Re(this,"data1");this.data=t,this.data1=te}toJSON(){return{data:this.data,data1:this.data1}}static fromJSON(t){return new Hn(t.data,t.data1)}static create(t,te){return new Hn(t,te)}};Re(Hn,"TYPE",ParserUtils.getPacketType(MessageDataTypes_NUMBER,MessageDataTypes_STRING)),Re(Hn,"DESCRIPTOR_NAME","NumberStringPacketDataMessage"),Re(Hn,"DESCRIPTOR",{fields:{data:{type:"uint32",id:1},data1:{type:"string",id:2}}});let NumberStringPacketDataMessage=Hn;const PACKET_DATA_MESSAGES=[NumberBytesPacketDataMessage,StringBytesPacketDataMessage,BytesBytesPacketDataMessage,StringObjectPacketDataMessage,NumberObjectPacketDataMessage,ObjectObjectPacketDataMessage,ObjectBufferPacketDataMessage,StringStringPacketDataMessage,StringNumberPacketDataMessage,NumberNumberPacketDataMessage,NumberStringPacketDataMessage].reduce((Te,we)=>(Te[we.TYPE]=we,Te),{}),Wn=class Wn extends Message{constructor(t,te,be,xe="/",ve){super();Re(this,"type");Re(this,"data");Re(this,"id");Re(this,"nsp");Re(this,"options");this.type=t,this.data=te,this.id=be,this.nsp=xe,this.options=ve??new PacketOptionsMessage}get packetData(){return this.data.data===void 0&&this.data.data1===void 0?[]:this.data.data&&this.data.data1===void 0?[this.data.data]:[this.data.data,this.data.data1]}toJSON(){const t=MessagesCompressor.encode(this.options),te=MessagesCompressor.encode(this.data);return{type:this.type+10*this.data.constructor.TYPE,id:this.id,nsp:this.nsp==="/"?void 0:this.nsp,data:te,options:t}}static fromJSON(t){const te=Math.floor(t.type/10);return new Wn(t.type-10*te,MessagesCompressor.decode(t.data,PACKET_DATA_MESSAGES[te]),t.id,t.nsp,t.options?MessagesCompressor.decode(t.options,PacketOptionsMessage):new PacketOptionsMessage)}static create(t,te={}){const be=ParserUtils.getPacketType(ParserUtils.getType(t.data[0]),ParserUtils.getType(t.data[1]??t.data[0]));return new Wn(t.type,PACKET_DATA_MESSAGES[be].create(t.data[0],t.data[1]),t.id,t.nsp,new PacketOptionsMessage(te.flags,te.rooms,te.except))}};Re(Wn,"TYPE",10),Re(Wn,"DESCRIPTOR_NAME","PacketMessage"),Re(Wn,"DESCRIPTOR",{fields:{type:{type:"uint32",id:1},id:{type:"uint32",id:2},nsp:{type:"string",id:3},data:{type:"bytes",id:4},options:{type:"bytes",id:5}}});let PacketMessage=Wn;class PacketParser{encode(we,t,te,be="/",xe={}){if(t.length>2)throw new Error("PacketParser supports only 2 elements in data");const ve={type:we,data:t,id:te,nsp:be};return MessagesCompressor.encode(PacketMessage.create(ve,xe))}decode(we){const t=MessagesCompressor.decode(we,PacketMessage);return{packet:{id:t.id,type:t.type,data:t.packetData,nsp:t.nsp},options:{flags:t.options.flags,rooms:t.options.rooms,except:t.options.except}}}}const ENCODED_TYPES=[PacketType.EVENT,PacketType.ACK,PacketType.BINARY_ACK,PacketType.BINARY_EVENT];class Encoder extends Encoder$1{constructor(t){super();Re(this,"_packetParser");this._packetParser=t??new PacketParser}encode(t){if(ENCODED_TYPES.includes(t.type))try{return[this._packetParser.encode(t.type,t.data,t.id,t.nsp)]}catch(te){console.error("Can not properly serialize or deserialize messages. Check the original error.",{originalError:{message:te.message}})}return super.encode(t)}}class Decoder extends Decoder$1{constructor(t){super();Re(this,"_packetParser");this._packetParser=t??new PacketParser}add(t){if(!ParserUtils.isBuffer(t))return super.add(t);let te;try{te=this._packetParser.decode(t).packet}catch{return super.add(t)}super.emitReserved("decoded",te)}}class WebSocketRequest{constructor(we,t){Re(this,"_context");Re(this,"_deferredPromise");Re(this,"timeout");this._context=we,this._deferredPromise=_deferPromise(),this.timeout=setTimeout(()=>this.error(new CKEditorCloudServicesError("Request timeout.",this._context)),t)}get promise(){return this._deferredPromise.promise}response(we){this._deferredPromise.resolve(we)}error(we){this._deferredPromise.reject(we)}}class WebSocketGatewayRequestsManager{constructor(we){Re(this,"_context");Re(this,"_requests");this._context=we,this._requests=new Set}async send(we,t=45e3){const te=this._createRequest(t);try{return we(te),await te.promise}finally{this._finishRequest(te)}}errorAll(we){for(const t of this._requests)t.error(we)}waitForAllRequests(we=45e3){return this._waitForRequests(we)}_createRequest(we){const t=new WebSocketRequest(this._context,we);return this._requests.add(t),t}_finishRequest(we){this._requests.delete(we),clearTimeout(we.timeout)}async _waitForRequests(we=5e3,t=0){return!this._requests.size||t>=we/500?Promise.resolve():(await new Promise(te=>{setTimeout(te,500)}),this._waitForRequests(we,t++))}}function _deferPromise(){let Te,we;const t=new Promise((te,be)=>{Te=te,we=be});return{resolve:Te,reject:we,promise:t}}const WEB_SOCKET_GATEWAY_STATES={DISCONNECTED:"disconnected",CONNECTING:"connecting",CONNECTED:"connected"},Tn=class Tn extends ObservableMixin(){constructor(t,te,be,xe,ve){super();Re(this,"_requestsManager");Re(this,"_url");Re(this,"_socket");Re(this,"_socketAuth");Re(this,"_channels");Re(this,"_connectionAttempt",0);Re(this,"_token");Re(this,"_options");Re(this,"_connectionProvider");Re(this,"_userFactory");if(this._token=te,this._options=be??{},this._connectionProvider=xe??lookup,this._userFactory=ve??User.get,this._requestsManager=new WebSocketGatewayRequestsManager(this),this._channels=new Map,!t)throw new TypeError("Api address must be provided.");if(!this._token)throw new TypeError("Token must be provided.");this._options.requestTimeout||(this._options.requestTimeout=2e4),this._url=_0x37c066(t.replace(/^(?!(?:\w+:)?\/\/)/,"https://")),this.set("state",WEB_SOCKET_GATEWAY_STATES.DISCONNECTED),this.set("socketId",void 0),this.set("me",void 0),this.on("change:state",async(ke,Ie,Ae)=>{var Se;if(this._debugEvent("ws-gw:change:state",Ae),Ae!==Tn.STATE_CONNECTED){if(Ae===Tn.STATE_DISCONNECTED)return this._requestsManager.errorAll(new CKEditorCloudServicesError("Not connected.",this))}else try{this.me=await this._userFactory.call(User,this,(Se=this._socketAuth)==null?void 0:Se.userId)}catch{}},{priority:Tn._CHANGE_STATE_EVENT_PRIORITY}),this.on("error",(ke,Ie)=>{this._options.onError?this._options.onError(Ie):console.error(Ie)})}get sessionId(){return this.socketId}waitForAllRequests(t){return this._requestsManager.waitForAllRequests(t)}disconnect(){var t;this.state!==WEB_SOCKET_GATEWAY_STATES.DISCONNECTED&&((t=this._socket)==null||t.disconnect(),this._socket=void 0,this.state=WEB_SOCKET_GATEWAY_STATES.DISCONNECTED)}async reconnect(){this._socket||this.state!==WEB_SOCKET_GATEWAY_STATES.DISCONNECTED||(await this._token.refreshToken(),await this._connect())}static async connect(t,te="local.cs.dev:443/ws-v2",be={},xe=lookup,ve=User.get){const ke=new Tn(te,t,be,xe,ve);return await ke._connect(),ke}_sendRequest(t,te,be){if(!t)throw new CKEditorCloudServicesError("`serviceName` must be provided.",this);if(this.state!==Tn.STATE_CONNECTED)throw new CKEditorCloudServicesError("Not connected.",this);if(!this._socketAuth||!this._socketAuth.isAuthenticated)throw new CKEditorCloudServicesError("Not authenticated.",this);const xe=new ArrayBuffer(be.length+2),ve=new Uint8Array(xe);return ve[0]=t,ve[1]=parseInt(te),ve.set(be,2),this._emit(1,ve)}_getChannel(t,te){const be=""+t+te;return!this._channels.has(be)&&this._socket&&this._channels.set(be,new Channel(be,this,this._socket)),this._channels.get(be)}_connect(){return new Promise((t,te)=>{const be=this._setupSocket();!this.socketId&&be.io.on("reconnect_error",()=>{this._debugEvent("reconnect_error"),this._reconnectionAttemptError(te)}),be.once("connect",async()=>{this._debugEvent("once-connect");try{await this._onConnect(),t()}catch(xe){te(xe)}}),be.connect()})}_getPortByProtocol(t){return["http:","ws:"].includes(t)?80:443}_setupSocket(){if(this._socket)return this._socket;const t=this._url.port||this._getPortByProtocol(this._url.protocol),te=(this._url.protocol||"https:")+"//"+this._url.hostname+":"+t,be=this._url.pathname.match(/^\/.*\/ws/)?this._url.pathname.split("/ws")[0]:"",xe=this._connectionProvider(te,{parser:{Encoder,Decoder},path:be+"/ws-v2/ws",transports:["websocket"],timeout:this._options.timeout!==void 0?this._options.timeout:5e3,reconnection:this._options.autoReconnect===void 0||this._options.autoReconnect,reconnectionDelay:1e3,reconnectionDelayMax:5e3,rejectUnauthorized:this._options.rejectUnauthorized===void 0||this._options.rejectUnauthorized,query:{version:"52.6.9"},agent:this._options.agent??!1,closeOnBeforeunload:!1});return this.state=WEB_SOCKET_GATEWAY_STATES.CONNECTING,xe.on("connect",()=>{this._debugEvent("connect"),this.socketId=xe.id}),xe.on("connect_error",ve=>{this._debugEvent("connect_error",ve)}),xe.on("disconnect",()=>{this._debugEvent("disconnect"),this._onDisconnect()}),xe.io.on("reconnect",async()=>{this._debugEvent("reconnect"),await this._onReconnect()}),xe.io.on("reconnect_attempt",ve=>{this._debugEvent("reconnect_attempt",ve),this.state=WEB_SOCKET_GATEWAY_STATES.CONNECTING,this._connectionAttempt=ve}),xe.on("unauthorized",ve=>{this._debugEvent("unauthorized"),this._onUnauthorized(ve)}),xe.on("authenticationRequest",async ve=>{this._debugEvent("authenticationRequest",ve.attempt),await this._onReconnect()}),this._socket=xe,xe}_emit(t,te){const be=this._socket;return this._requestsManager.send(xe=>{be.emit(t,te,(ve,ke)=>{if(ve)return xe.error(CKEditorCloudServicesServerError.fromPublicError(ve));xe.response(ke)})},this._options.requestTimeout)}_addAuthData(t,te){this._socketAuth={environmentId:t,userId:te,isAuthenticated:!0}}_removeAuthData(){this._socketAuth=void 0}async _onConnect(){await this._authenticate(this._token.value),this.state=WEB_SOCKET_GATEWAY_STATES.CONNECTED;const t=async(te,be,xe)=>{this._debugEvent("token:value:change");try{await this._authenticate(xe)}catch{}};this._token.on("change:value",t),this._socket.io.off("reconnect_error"),this.on("disconnect",()=>{this._token.off("change:value",t)})}async _onReconnect(){await this._token.refreshToken(),await this._onConnect()}_onDisconnect(){this.state=WEB_SOCKET_GATEWAY_STATES.DISCONNECTED,this._connectionAttempt=0,this.fire("disconnect");for(const t of this._channels.values())t.remove();this._channels.clear(),this._options.autoReconnect===void 0||this._options.autoReconnect||(this._socket=void 0)}_debugEvent(t,te){if(!this._isDebugModeEnabled())return;const be=te!==void 0?", data: "+te:"";console.info(new Date().toLocaleString()+" "+t+be)}_reconnectionAttemptError(t){this._connectionAttempt>=2&&(this.disconnect(),t(CKEditorCloudServicesError.fromPublicError({message:"The number of initial connection attempts exceeded.",explanation:"Three initial connection attempts failed. It can be caused by a slow, unstable, missing or blocked Internet connection.",action:"Please verify the stability of your Internet connection and ensure that no antivirus or firewall software blocks the Web Socket protocol connections."})))}_onUnauthorized({error:t}){this._removeAuthData(),this.fire("error",CKEditorCloudServicesServerError.fromPublicError(t))}async _authenticate(t){try{this._debugEvent("authenticate:start");const te=await this._emit(2,{token:t});this._debugEvent("authenticate:success","envId: "+te.environmentId+", userId: "+te.userId),this._addAuthData(te.environmentId,te.userId)}catch(te){throw this._debugEvent("authenticate:error",te.message),this._removeAuthData(),te}}_isDebugModeEnabled(){return global.window.localStorage?(global.window.localStorage.getItem("csClientDebugMode")??"false").toLowerCase()==="true":!1}};Re(Tn,"STATE_DISCONNECTED",WEB_SOCKET_GATEWAY_STATES.DISCONNECTED),Re(Tn,"STATE_CONNECTING",WEB_SOCKET_GATEWAY_STATES.CONNECTING),Re(Tn,"STATE_CONNECTED",WEB_SOCKET_GATEWAY_STATES.CONNECTED),Re(Tn,"_CHANGE_STATE_EVENT_PRIORITY",priorities.get("highest")+999999);let WebSocketGateway=Tn;const zn=class zn extends Message{constructor(t){super();Re(this,"bundleVersion");this.bundleVersion=t}toJSON(){return{bundleVersion:this.bundleVersion}}static fromJSON(t){return new zn(t.bundleVersion)}};Re(zn,"TYPE","131"),Re(zn,"READABLE_TYPE_NAME","isEditorBundleUploaded"),Re(zn,"DESCRIPTOR_NAME","IsEditorBundleUploadedMessage"),Re(zn,"DESCRIPTOR",{fields:{bundleVersion:{type:"string",id:1}}});let IsEditorBundleUploadedMessage=zn;const qi=class qi extends Message{constructor(t){super();Re(this,"isUploaded");this.isUploaded=t}toJSON(){return{isUploaded:this.isUploaded}}static fromJSON(t){return new qi(t.isUploaded)}};Re(qi,"DESCRIPTOR_NAME","IsEditorBundleUploadedResponse"),Re(qi,"DESCRIPTOR",{fields:{isUploaded:{type:"bool",id:1}}});let IsEditorBundleUploadedResponse=qi;const c0=class c0 extends EmitterMixin(){static async isBundleUploaded(we,t){const te=new IsEditorBundleUploadedMessage(t);if(we.state!==WEB_SOCKET_GATEWAY_STATES.CONNECTED)throw new CKEditorCloudServicesError("WebSocket Gateway is not connected.",we);const be=await we._sendRequest(c0._SERVICE,IsEditorBundleUploadedMessage.TYPE,MessagesCompressor.encode(te));return MessagesCompressor.decode(be,IsEditorBundleUploadedResponse).isUploaded}};Re(c0,"_SERVICE",13);let EditorService=c0;const qn=class qn extends Message{constructor(t,te){super();Re(this,"documentId");Re(this,"revisionId");this.documentId=t,this.revisionId=te}toJSON(){return{documentId:this.documentId,revisionId:this.revisionId}}static fromJSON(t){return new qn(t.documentId,t.revisionId)}};Re(qn,"TYPE","123"),Re(qn,"READABLE_TYPE_NAME","getRevision"),Re(qn,"DESCRIPTOR_NAME","RevisionHistoryGetRevisionMessage"),Re(qn,"DESCRIPTOR",{fields:{documentId:{type:"string",id:1},revisionId:{type:"string",id:2}}});let RevisionHistoryGetRevisionMessage=qn;class RevisionDescriptor extends Descriptor{static create(we){return{revisionId:we.id,name:we.name,creatorId:we.creatorId,createdAt:we.createdAt,fromVersion:we.fromVersion,toVersion:we.toVersion,isEmptyCurrent:we.isEmptyCurrent,diffData:we.diffData?JSON.stringify(we.diffData):void 0,attributes:we.attributes,authorsIds:we.authorsIds}}static toJSON(we){var t;return{revisionId:we.revisionId,name:we.name,creatorId:we.creatorId,authorsIds:we.authorsIds?JSON.stringify(we.authorsIds):void 0,diffData:we.diffData,createdAt:(t=we.createdAt)==null?void 0:t.toISOString(),attributes:we.attributes?JSON.stringify(we.attributes):void 0,toVersion:we.toVersion,fromVersion:we.fromVersion,isEmptyCurrent:we.isEmptyCurrent}}static fromJSON(we){return{revisionId:(we={...we}).revisionId,name:we.name,creatorId:we.creatorId,authorsIds:we.authorsIds?JSON.parse(we.authorsIds):void 0,diffData:we.diffData,createdAt:we.createdAt?new Date(we.createdAt):void 0,attributes:we.attributes?JSON.parse(we.attributes):void 0,toVersion:we.toVersion,fromVersion:we.fromVersion,isEmptyCurrent:we.isEmptyCurrent}}static toObject(we){return function(t){for(const[te,be]of Object.entries(t))be===void 0&&delete t[te];return t}({id:we.revisionId,name:we.name,creatorId:we.creatorId,createdAt:we.createdAt,fromVersion:we.fromVersion,toVersion:we.toVersion,isEmptyCurrent:we.isEmptyCurrent,diffData:we.diffData?JSON.parse(we.diffData):void 0,attributes:we.attributes,authorsIds:we.authorsIds})}}Re(RevisionDescriptor,"DESCRIPTOR_NAME","RevisionDescriptor"),Re(RevisionDescriptor,"DESCRIPTOR",{fields:{revisionId:{type:"string",id:1},name:{type:"string",id:2},creatorId:{type:"string",id:3},authorsIds:{type:"string",id:4},diffData:{type:"string",id:5},createdAt:{type:"string",id:6},attributes:{type:"string",id:7},toVersion:{type:"uint32",id:8},fromVersion:{type:"uint32",id:9},isEmptyCurrent:{type:"bool",id:10}}});const Mi=class Mi extends Message{constructor(t,te,be,xe,ve,ke,Ie,Ae,Se,Oe){super();Re(this,"revisionId");Re(this,"name");Re(this,"creatorId");Re(this,"authorsIds");Re(this,"createdAt");Re(this,"diffData");Re(this,"attributes");Re(this,"fromVersion");Re(this,"toVersion");Re(this,"isEmptyCurrent");this.revisionId=t,this.name=te,this.creatorId=be,this.authorsIds=xe,this.createdAt=ve,this.diffData=ke,this.attributes=Ie,this.fromVersion=Ae,this.toVersion=Se,this.isEmptyCurrent=Oe}toJSON(){return RevisionDescriptor.toJSON(this)}toObject(){return RevisionDescriptor.toObject(this)}static create(t){return new Mi(t.revisionId,t.name,t.creatorId,t.authorsIds,t.createdAt,t.diffData,t.attributes,t.fromVersion,t.toVersion,t.isEmptyCurrent)}static fromJSON(t){return new Mi(t.revisionId,t.name,t.creatorId,t.authorsIds?JSON.parse(t.authorsIds):void 0,t.createdAt?new Date(t.createdAt):void 0,t.diffData,t.attributes?JSON.parse(t.attributes):void 0,t.fromVersion,t.toVersion,t.isEmptyCurrent)}};Re(Mi,"DESCRIPTOR_NAME","RevisionHistoryGetRevisionResponse"),Re(Mi,"DESCRIPTOR",RevisionDescriptor.DESCRIPTOR);let RevisionHistoryGetRevisionResponse=Mi;const Sn=class Sn extends Message{constructor(t,te,be){super();Re(this,"documentId");Re(this,"requestId");Re(this,"revisions");this.documentId=t,this.requestId=te,this.revisions=be}toJSON(){return{documentId:this.documentId,requestId:this.requestId,revisions:this.revisions.map(RevisionDescriptor.toJSON)}}toObject(){return{documentId:this.documentId,requestId:this.requestId,revisions:this.revisions.map(RevisionDescriptor.toObject)}}static create(t){return new Sn(t.documentId,t.requestId,t.revisions.map(RevisionDescriptor.create))}static fromJSON(t){return new Sn(t.documentId,t.requestId,t.revisions.map(RevisionDescriptor.fromJSON))}};Re(Sn,"TYPE","124"),Re(Sn,"READABLE_TYPE_NAME","updateRevisions"),Re(Sn,"DESCRIPTOR_NAME","RevisionHistoryUpdateRevisionsMessage"),Re(Sn,"DESCRIPTOR",{fields:{documentId:{type:"string",id:1},requestId:{type:"uint32",id:2},revisions:{type:"RevisionDescriptor",id:3,rule:"repeated"}}});let RevisionHistoryUpdateRevisionsMessage=Sn;const Ki=class Ki extends Message{constructor(t){super();Re(this,"requestId");this.requestId=t}toJSON(){return{requestId:this.requestId}}static fromJSON(t){return new Ki(t.requestId)}};Re(Ki,"DESCRIPTOR_NAME","RevisionHistoryUpdateRevisionsResponse"),Re(Ki,"DESCRIPTOR",{fields:{requestId:{type:"uint32",id:1}}});let RevisionHistoryUpdateRevisionsResponse=Ki;const Kn=class Kn extends Message{constructor(t){super();Re(this,"documentId");this.documentId=t}toJSON(){return{documentId:this.documentId}}static fromJSON(t){return new Kn(t.documentId)}};Re(Kn,"TYPE","121"),Re(Kn,"READABLE_TYPE_NAME","connectToRevisionHistory"),Re(Kn,"DESCRIPTOR_NAME","RevisionHistoryConnectMessage"),Re(Kn,"DESCRIPTOR",{fields:{documentId:{type:"string",id:1}}});let RevisionHistoryConnectMessage=Kn;const Gi=class Gi extends Message{constructor(t,te,be){super();Re(this,"channel");Re(this,"requestId");Re(this,"revisions");this.channel=t,this.requestId=te,this.revisions=be}toJSON(){return{channel:this.channel,requestId:this.requestId,revisions:this.revisions.map(RevisionDescriptor.toJSON)}}toObject(){return{channel:this.channel,requestId:this.requestId,revisions:this.revisions.map(RevisionDescriptor.toObject)}}static fromJSON(t){return new Gi(t.channel,t.requestId,t.revisions.map(RevisionDescriptor.fromJSON))}};Re(Gi,"DESCRIPTOR_NAME","RevisionHistoryConnectResponse"),Re(Gi,"DESCRIPTOR",{fields:{channel:{type:"string",id:1},requestId:{type:"uint32",id:2},revisions:{type:"RevisionDescriptor",id:3,rule:"repeated"}}});let RevisionHistoryConnectResponse=Gi;const Gn=class Gn extends Message{constructor(t,te){super();Re(this,"documentId");Re(this,"requestId");this.documentId=t,this.requestId=te}toJSON(){return{documentId:this.documentId,requestId:this.requestId}}static fromJSON(t){return new Gn(t.documentId,t.requestId)}};Re(Gn,"TYPE","122"),Re(Gn,"READABLE_TYPE_NAME","reconnectToRevisionHistory"),Re(Gn,"DESCRIPTOR_NAME","RevisionHistoryReconnectMessage"),Re(Gn,"DESCRIPTOR",{fields:{documentId:{type:"string",id:1},requestId:{type:"uint32",id:2}}});let RevisionHistoryReconnectMessage=Gn;class ServiceNotConnectedError extends CKEditorCloudServicesError{constructor(we,t){super(we+" Service is not connected.",t)}}const l0=class l0 extends EmitterMixin(){constructor(t){super();Re(this,"_documentId");Re(this,"_isConnected");Re(this,"_wsGateway");Re(this,"_channel");this._documentId=t,this._isConnected=!1}get isConnected(){return this._isConnected}connect(t){return this._isConnected?Promise.resolve():this._connect(t,new RevisionHistoryConnectMessage(this._documentId))}disconnect(){this._isConnected&&(this._isConnected=!1,this._wsGateway&&(this.stopListening(this._wsGateway),this._wsGateway=void 0),this._channel&&(this.stopListening(this._channel),this._channel=void 0),this.fire("disconnected"),this.stopListening())}reconnect(t,te){if(this.isConnected)throw new CKEditorCloudServicesError("Cannot reconnect to already connected service.",t);return this._connect(t,new RevisionHistoryReconnectMessage(this._documentId,te))}async updateRevisions(t,te){const be=RevisionHistoryUpdateRevisionsMessage.create({documentId:this._documentId,requestId:te,revisions:t}),xe=await this._sendRequest(RevisionHistoryUpdateRevisionsMessage.TYPE,be),{requestId:ve}=MessagesCompressor.decode(xe,RevisionHistoryUpdateRevisionsResponse);return ve}async getRevision(t){const te=new RevisionHistoryGetRevisionMessage(this._documentId,t),be=await this._sendRequest(RevisionHistoryGetRevisionMessage.TYPE,te);return MessagesCompressor.decode(be,RevisionHistoryGetRevisionResponse).toObject()}async _connect(t,te){if(t.state!==WEB_SOCKET_GATEWAY_STATES.CONNECTED)throw new CKEditorCloudServicesError("WebSocket Gateway is not connected.",t);this._wsGateway=t,this.stopListening(t,"change:state");const be=await t._sendRequest(12,te.constructor.TYPE,MessagesCompressor.encode(te)),{channel:xe,requestId:ve,revisions:ke}=MessagesCompressor.decode(be,RevisionHistoryConnectResponse).toObject();return this.listenTo(t,"change:state",(Ie,Ae,Se)=>this._onWsGatewayStateChange(Se),{priority:WebSocketGateway._CHANGE_STATE_EVENT_PRIORITY}),this._connectToChannel(t,xe),this._isConnected=!0,this.fire("connected"),{revisions:ke,requestId:ve}}_connectToChannel(t,te){this._channel=t._getChannel(l0._SERVICE,te),this._channel&&this.listenTo(this._channel,this._channel.getEventName(RevisionHistoryUpdateRevisionsMessage.TYPE),(be,xe)=>{const{documentId:ve,requestId:ke,revisions:Ie}=MessagesCompressor.decode(xe,RevisionHistoryUpdateRevisionsMessage).toObject();this.fire("revisionsUpdated",{documentId:ve,requestId:ke,revisionsData:Ie})})}_onWsGatewayStateChange(t){t===WEB_SOCKET_GATEWAY_STATES.DISCONNECTED&&this.disconnect()}_sendRequest(t,te){if(!this._wsGateway||!this._isConnected)throw new ServiceNotConnectedError("Revision History",this);return this._wsGateway._sendRequest(12,t,MessagesCompressor.encode(te))}};Re(l0,"_SERVICE",12);let RevisionHistoryService=l0;const jn=class jn extends Message{constructor(t,te,be,xe={},ve=null,ke=null){super();Re(this,"id");Re(this,"documentId");Re(this,"type");Re(this,"data");Re(this,"originalSuggestionId");Re(this,"attributes");this.id=t,this.documentId=te,this.type=be,this.data=xe,this.originalSuggestionId=ve,this.attributes=ke}toJSON(){return{id:this.id,documentId:this.documentId,type:this.type,data:JSON.stringify(this.data),originalSuggestionId:this.originalSuggestionId,attributes:JSON.stringify(this.attributes)}}static fromJSON(t){return new jn(t.id,t.documentId,t.type,JSON.parse(t.data),t.originalSuggestionId??null,t.attributes?JSON.parse(t.attributes):null)}};Re(jn,"TYPE","101"),Re(jn,"READABLE_TYPE_NAME","addSuggestion"),Re(jn,"DESCRIPTOR_NAME","TrackChangesAddSuggestionMessage"),Re(jn,"DESCRIPTOR",{fields:{id:{type:"string",id:1},documentId:{type:"string",id:2},type:{type:"string",id:3},data:{type:"string",id:4},originalSuggestionId:{type:"string",id:5},attributes:{type:"string",id:6}}});let AddSuggestionMessage=jn;const ji=class ji extends Message{constructor(t,te,be,xe,ve,ke,Ie={},Ae=null){super();Re(this,"id");Re(this,"authorId");Re(this,"type");Re(this,"hasComments");Re(this,"state");Re(this,"data");Re(this,"attributes");Re(this,"createdAt");this.id=t,this.authorId=te,this.type=be,this.hasComments=ve,this.state=ke,this.data=Ie,this.attributes=Ae,this.createdAt=xe?new Date(xe):void 0}toJSON(){var t;return{id:this.id,authorId:this.authorId,type:this.type,createdAt:(t=this.createdAt)==null?void 0:t.toISOString(),data:JSON.stringify(this.data),hasComments:this.hasComments,state:this.state,attributes:JSON.stringify(this.attributes)}}static fromJSON(t){return new ji(t.id,t.authorId,t.type,t.createdAt,t.hasComments,t.state,JSON.parse(t.data),t.attributes?JSON.parse(t.attributes):null)}};Re(ji,"DESCRIPTOR_NAME","TrackChangesAddSuggestionResponse"),Re(ji,"DESCRIPTOR",{fields:{id:{type:"string",id:1},authorId:{type:"string",id:2},type:{type:"string",id:3},createdAt:{type:"string",id:4},data:{type:"string",id:5},hasComments:{type:"bool",id:6},state:{type:"string",id:7},attributes:{type:"string",id:8}}});let AddSuggestionResponse=ji;const Jn=class Jn extends Message{constructor(t,te){super();Re(this,"id");Re(this,"documentId");this.id=t,this.documentId=te}toJSON(){return{id:this.id,documentId:this.documentId}}static fromJSON(t){return new Jn(t.id,t.documentId)}};Re(Jn,"TYPE","103"),Re(Jn,"READABLE_TYPE_NAME","getSuggestion"),Re(Jn,"DESCRIPTOR_NAME","TrackChangesGetSuggestionMessage"),Re(Jn,"DESCRIPTOR",{fields:{id:{type:"string",id:1},documentId:{type:"string",id:2}}});let GetSuggestionMessage=Jn;const Ji=class Ji extends Message{constructor(t,te,be,xe,ve,ke,Ie={},Ae=null){super();Re(this,"id");Re(this,"authorId");Re(this,"type");Re(this,"hasComments");Re(this,"state");Re(this,"data");Re(this,"attributes");Re(this,"createdAt");this.id=t,this.authorId=te,this.type=be,this.hasComments=ve,this.state=ke,this.data=Ie,this.attributes=Ae,this.createdAt=new Date(xe)}toJSON(){return{id:this.id,authorId:this.authorId,type:this.type,createdAt:this.createdAt.toISOString(),data:JSON.stringify(this.data),hasComments:this.hasComments,state:this.state,attributes:JSON.stringify(this.attributes)}}static fromJSON(t){return new Ji(t.id,t.authorId,t.type,t.createdAt,t.hasComments,t.state,JSON.parse(t.data),t.attributes?JSON.parse(t.attributes):null)}};Re(Ji,"DESCRIPTOR_NAME","TrackChangesGetSuggestionResponse"),Re(Ji,"DESCRIPTOR",{fields:{id:{type:"string",id:1},authorId:{type:"string",id:2},type:{type:"string",id:3},createdAt:{type:"string",id:4},data:{type:"string",id:5},hasComments:{type:"bool",id:6},state:{type:"string",id:7},attributes:{type:"string",id:8}}});let GetSuggestionResponse=Ji;const Yn=class Yn extends Message{constructor(t){super();Re(this,"documentId");this.documentId=t}toJSON(){return{documentId:this.documentId}}static fromJSON(t){return new Yn(t.documentId)}};Re(Yn,"TYPE","102"),Re(Yn,"READABLE_TYPE_NAME","getAllSuggestions"),Re(Yn,"DESCRIPTOR_NAME","TrackChangesGetAllSuggestionMessage"),Re(Yn,"DESCRIPTOR",{fields:{documentId:{type:"string",id:1}}});let GetAllSuggestionsMessage=Yn;class SuggestionDescriptor extends Descriptor{static toJSON(we){var t;return{...we,data:we.data?JSON.stringify(we.data):we.data,attributes:we.attributes?JSON.stringify(we.attributes):we.attributes,createdAt:(t=we.createdAt)==null?void 0:t.toISOString()}}static fromJSON(we){return{...we,data:we.data?JSON.parse(we.data):we.data,attributes:we.attributes?JSON.parse(we.attributes):we.attributes,createdAt:we.createdAt?new Date(we.createdAt):void 0}}}Re(SuggestionDescriptor,"DESCRIPTOR_NAME","SuggestionDescriptor"),Re(SuggestionDescriptor,"DESCRIPTOR",{fields:{id:{id:1,type:"string"},authorId:{id:2,type:"string"},type:{id:3,type:"string"},createdAt:{id:4,type:"string"},data:{id:5,type:"string"},hasComments:{id:6,type:"bool"},state:{id:7,type:"string"},attributes:{id:8,type:"string"}}});const Yi=class Yi extends Message{constructor(t,te){super();Re(this,"_suggestions");Re(this,"_suggestionsV2");Re(this,"suggestions");this._suggestions=t,this._suggestionsV2=te,this.suggestions=te!=null&&te.length?te:t}toJSON(){var t,te;return{suggestions:(t=this._suggestions)==null?void 0:t.map(be=>JSON.stringify(be)),suggestionsV2:(te=this._suggestionsV2)==null?void 0:te.map(SuggestionDescriptor.toJSON)}}static fromJSON(t){var te,be;return new Yi((te=t.suggestions)==null?void 0:te.map(_suggestionFromString),(be=t.suggestionsV2)==null?void 0:be.map(SuggestionDescriptor.fromJSON))}};Re(Yi,"DESCRIPTOR_NAME","TrackChangesGetAllSuggestionsResponse"),Re(Yi,"DESCRIPTOR",{fields:{suggestions:{type:"string",rule:"repeated",id:1},suggestionsV2:{type:"SuggestionDescriptor",rule:"repeated",id:2}}});let GetAllSuggestionResponse=Yi;function _suggestionFromString(Te){const we=JSON.parse(Te);return we.createdAt=we.createdAt?new Date(we.createdAt):void 0,we}const Zn=class Zn extends Message{constructor(t,te,be,xe,ve,ke=null){super();Re(this,"id");Re(this,"documentId");Re(this,"hasComments");Re(this,"isHasCommentsModified");Re(this,"state");Re(this,"attributes");this.id=t,this.documentId=te,this.hasComments=be,this.isHasCommentsModified=xe,this.state=ve,this.attributes=ke}toJSON(){return{id:this.id,documentId:this.documentId,hasComments:this.hasComments,isHasCommentsModified:this.isHasCommentsModified,state:this.state,attributes:JSON.stringify(this.attributes)}}static fromJSON(t){return new Zn(t.id,t.documentId,t.hasComments,t.isHasCommentsModified,t.state,t.attributes?JSON.parse(t.attributes):null)}};Re(Zn,"TYPE","104"),Re(Zn,"READABLE_TYPE_NAME","updateSuggestion"),Re(Zn,"DESCRIPTOR_NAME","TrackChangesUpdateSuggestionMessage"),Re(Zn,"DESCRIPTOR",{fields:{id:{type:"string",id:1},documentId:{type:"string",id:2},hasComments:{type:"bool",id:3},isHasCommentsModified:{type:"bool",id:4},state:{type:"string",id:5},attributes:{type:"string",id:6}}});let UpdateSuggestionMessage=Zn;var In;let ConnectMessage$1=(In=class extends Message{constructor(t){super();Re(this,"documentId");this.documentId=t}toJSON(){return{documentId:this.documentId}}static fromJSON(t){return new In(t.documentId)}},Re(In,"TYPE","105"),Re(In,"READABLE_TYPE_NAME","connectToSuggestions"),Re(In,"DESCRIPTOR_NAME","TrackChangesConnectMessage"),Re(In,"DESCRIPTOR",{fields:{documentId:{type:"string",id:1}}}),In);var Ii;let ConnectResponse$1=(Ii=class extends Message{constructor(t,te,be){super();Re(this,"channel");Re(this,"_suggestions");Re(this,"_suggestionsV2");Re(this,"suggestions");this.channel=t,this._suggestions=te,this._suggestionsV2=be,this.suggestions=be!=null&&be.length?be:te}toJSON(){var t,te;return{channel:this.channel,suggestions:(t=this._suggestions)==null?void 0:t.map(be=>JSON.stringify(be)),suggestionsV2:(te=this._suggestionsV2)==null?void 0:te.map(SuggestionDescriptor.toJSON)}}static fromJSON(t){var te,be;return new Ii(t.channel,(te=t.suggestions)==null?void 0:te.map(xe=>JSON.parse(xe)),(be=t.suggestionsV2)==null?void 0:be.map(SuggestionDescriptor.fromJSON))}},Re(Ii,"DESCRIPTOR_NAME","TrackChangesConnectResponse"),Re(Ii,"DESCRIPTOR",{fields:{channel:{type:"string",id:1},suggestions:{type:"string",rule:"repeated",id:2},suggestionsV2:{type:"SuggestionDescriptor",rule:"repeated",id:3}}}),Ii);const Xn=class Xn extends Message{constructor(t,te,be){super();Re(this,"ids");Re(this,"documentId");Re(this,"state");this.ids=t,this.documentId=te,this.state=be}toJSON(){return{ids:this.ids,documentId:this.documentId,state:this.state}}static fromJSON(t){return new Xn(t.ids,t.documentId,t.state)}};Re(Xn,"TYPE","106"),Re(Xn,"READABLE_TYPE_NAME","batchUpdateSuggestionsState"),Re(Xn,"DESCRIPTOR_NAME","TrackChangesBatchUpdateSuggestionsStateMessage"),Re(Xn,"DESCRIPTOR",{fields:{ids:{type:"string",rule:"repeated",id:1},documentId:{type:"string",id:2},state:{type:"string",id:3}}});let BatchUpdateSuggestionsStateMessage=Xn;const d0=class d0 extends EmitterMixin(){constructor(t){super();Re(this,"_documentId");Re(this,"_isConnected");Re(this,"_wsGateway");Re(this,"_channel");this._documentId=t,this._isConnected=!1}get isConnected(){return this._isConnected}async connect(t){if(this._isConnected)return;if(t.state!==WEB_SOCKET_GATEWAY_STATES.CONNECTED)throw new CKEditorCloudServicesError("WebSocket Gateway is not connected.",t);const te=new ConnectMessage$1(this._documentId);this._wsGateway=t,this.stopListening(t,"change:state");const be=await t._sendRequest(10,ConnectMessage$1.TYPE,MessagesCompressor.encode(te)),xe=MessagesCompressor.decode(be,ConnectResponse$1);return this.listenTo(t,"change:state",(ve,ke,Ie)=>this._onWsGatewayStateChange(Ie),{priority:WebSocketGateway._CHANGE_STATE_EVENT_PRIORITY}),this._connectToChannel(t,xe.channel),this._isConnected=!0,this.fire("connected"),xe.suggestions}disconnect(){this._isConnected&&(this._isConnected=!1,this._wsGateway&&(this.stopListening(this._wsGateway),this._wsGateway=void 0),this._channel&&(this.stopListening(this._channel),this._channel=void 0),this.fire("disconnected"),this.stopListening())}async add(t,te,be,xe=null,ve){const ke=new AddSuggestionMessage(t,this._documentId,te,be,xe,ve),Ie=await this._sendRequest(AddSuggestionMessage.TYPE,ke);return MessagesCompressor.decode(Ie,AddSuggestionResponse)}async get(t,te=1){const be=new GetSuggestionMessage(t,this._documentId);try{const ve=await this._sendRequest(GetSuggestionMessage.TYPE,be);return MessagesCompressor.decode(ve,GetSuggestionResponse)}catch(ve){if(ve.name==="CKEditorCloudServicesServerError"&&ve.code==="404"&&te<5)return await(xe=100*te,new Promise(ke=>{setTimeout(ke,xe)})),this.get(t,te+1);throw ve.name==="CKEditorCloudServicesServerError"?ve:CKEditorCloudServicesServerError.fromPublicError(ve)}var xe}async getAll(){const t=new GetAllSuggestionsMessage(this._documentId),te=await this._sendRequest(GetAllSuggestionsMessage.TYPE,t),{suggestions:be}=MessagesCompressor.decode(te,GetAllSuggestionResponse);return be}async update(t,te={}){const{hasComments:be,state:xe,attributes:ve}=te,ke=be!==void 0,Ie=new UpdateSuggestionMessage(t,this._documentId,be,ke,xe,ve);await this._sendRequest(UpdateSuggestionMessage.TYPE,Ie)}async batchUpdateState(t){const te=new BatchUpdateSuggestionsStateMessage(t.ids,this._documentId,t.state);await this._sendRequest(BatchUpdateSuggestionsStateMessage.TYPE,te)}_connectToChannel(t,te){this._channel=t._getChannel(d0._SERVICE,te),this._channel&&this.listenTo(this._channel,this._channel.getEventName(UpdateSuggestionMessage.TYPE),(be,xe)=>{const ve=MessagesCompressor.decode(xe,UpdateSuggestionMessage);this.fire("suggestionUpdated",ve)})}_onWsGatewayStateChange(t){t===WEB_SOCKET_GATEWAY_STATES.DISCONNECTED&&this.disconnect()}_sendRequest(t,te){if(!this._wsGateway||!this._isConnected)throw new ServiceNotConnectedError("Track Changes",this);return this._wsGateway._sendRequest(10,t,MessagesCompressor.encode(te))}};Re(d0,"_SERVICE",10);let TrackChangesService=d0;const Zi=class Zi extends Message{constructor(t,te=[]){super();Re(this,"channel");Re(this,"sockets");this.channel=t,this.sockets=te}toJSON(){return{channel:this.channel,sockets:this.sockets.map(t=>({user:t.userId,session:t.id,role:t.role,permissions:t.permissions}))}}static fromJSON(t){return new Zi(t.channel,t.sockets.map(te=>({id:te.session,userId:te.user,role:te.role,permissions:te.permissions})))}};Re(Zi,"DESCRIPTOR_NAME","SessionsConnectResponse"),Re(Zi,"DESCRIPTOR",{fields:{channel:{type:"string",id:1},sockets:{rule:"repeated",type:"SessionsSocketDescriptor",id:2}}});let SessionsConnectResponse=Zi;const Qn=class Qn extends Message{constructor(t,te){super();Re(this,"id");Re(this,"sessionType");this.id=t,this.sessionType=te}toJSON(){return{id:this.id,sessionType:this.sessionType}}static fromJSON(t){return new Qn(t.id,t.sessionType)}};Re(Qn,"TYPE","31"),Re(Qn,"READABLE_TYPE_NAME","getConnectedSockets"),Re(Qn,"DESCRIPTOR_NAME","SessionsConnectMessage"),Re(Qn,"DESCRIPTOR",{fields:{id:{type:"string",id:1},sessionType:{type:"uint32",id:2}}});let SessionsConnectMessage=Qn;const ii=class ii extends Message{constructor(t,te,be,xe){super();Re(this,"id");Re(this,"userId");Re(this,"role");Re(this,"permissions");this.id=t,this.userId=te,this.role=be,this.permissions=xe}toJSON(){return{id:this.id,userId:this.userId??void 0,role:this.role??void 0,permissions:this.permissions??void 0}}static fromJSON(t){return new ii(t.id,t.userId,t.role,t.permissions)}};Re(ii,"TYPE","32"),Re(ii,"READABLE_TYPE_NAME","connectSocket"),Re(ii,"DESCRIPTOR_NAME","SocketConnectMessage"),Re(ii,"DESCRIPTOR",{fields:{id:{type:"string",id:1},userId:{type:"string",id:2},role:{type:"string",id:3},permissions:{rule:"repeated",type:"string",id:4}}});let SocketConnectMessage=ii;const ri=class ri extends Message{constructor(t){super();Re(this,"id");this.id=t}toJSON(){return{id:this.id}}static fromJSON(t){return new ri(t.id)}};Re(ri,"TYPE","33"),Re(ri,"READABLE_TYPE_NAME","disconnectSocket"),Re(ri,"DESCRIPTOR_NAME","SocketDisconnectMessage"),Re(ri,"DESCRIPTOR",{fields:{id:{type:"string",id:1}}});let SocketDisconnectMessage=ri;class SessionCollection extends Collection{constructor(t,te){super({idProperty:"id"});Re(this,"_id");Re(this,"_sessionType");Re(this,"_handlers");Re(this,"_channel");Re(this,"_wsGateway");Re(this,"_connected");Re(this,"_eventsQueue");Re(this,"_isRunning");this._id=t,this._sessionType=te,this._handlers=new Map,this._eventsQueue=[],this._isRunning=!1}async connect(t){this._wsGateway=t,this.stopListening(t,"change:state");const te=new SessionsConnectMessage(this._id,this._sessionType);let be;try{const ve=await this._wsGateway._sendRequest(3,SessionsConnectMessage.TYPE,MessagesCompressor.encode(te));be=MessagesCompressor.decode(ve,SessionsConnectResponse)}catch{be=new SessionsConnectResponse(this._id,[])}this._connectToChannel(this._wsGateway,be.channel,this._sessionType);const xe=await async function(ve,ke){const Ie=ke.map(Se=>Se.userId),Ae=Ie.length?await User.getMany(ve,Ie):[];return ke.map(Se=>{const Oe={id:Se.id,role:Se.role,permissions:Se.permissions};return Oe.user=Se.userId&&Ae.find(Ve=>Ve.id===Se.userId)||new User,Oe})}(this._wsGateway,be.sockets);for(const ve of xe)super.add(ve);this._connected=!0,this.fire("connected"),this.listenTo(this._wsGateway,"change:state",(ve,ke,Ie)=>this._onWsGatewayStateChange(Ie),{priority:WebSocketGateway._CHANGE_STATE_EVENT_PRIORITY}),await this._runQueue()}disconnect(t=!0){if(this._connected){for(this._connected=!1,this._eventsQueue=[];this.length;)super.remove(0);this._channel&&(this.stopListening(this._channel),this._channel=void 0),this._wsGateway&&t&&(this.stopListening(this._wsGateway),this._wsGateway=void 0),this.fire("disconnected"),t&&this.stopListening()}}add(t,te){throw new TypeError("The collection is read-only.")}remove(t){throw new TypeError("The collection is read-only.")}_connectToChannel(t,te,be){this._channel=t._getChannel(be,te),this._channel&&(this._addHandler(this._channel,SocketConnectMessage.TYPE,async xe=>{const ve=MessagesCompressor.decode(xe,SocketConnectMessage);if(this.getIndex(ve.id)===-1){const ke={id:ve.id,role:ve.role,permissions:ve.permissions};ve.userId&&(ke.user=await User.get(t,ve.userId)),super.add(ke)}}),this._addHandler(this._channel,SocketDisconnectMessage.TYPE,xe=>{const ve=MessagesCompressor.decode(xe,SocketDisconnectMessage);this.getIndex(ve.id)!==-1&&super.remove(ve.id)}))}async _onWsGatewayStateChange(t){t===WebSocketGateway.STATE_DISCONNECTED&&this.disconnect(!1),t===WebSocketGateway.STATE_CONNECTED&&await this.connect(this._wsGateway)}async _runQueue(){if(this._isRunning||!this._connected)return;let t;for(this._isRunning=!0;t=this._eventsQueue.shift();){const te=this._handlers.get(t.eventName);te&&await te(t.data)}this._isRunning=!1}_addHandler(t,te,be){const xe=t.getEventName(te,!0);this.listenTo(t,xe,async(ve,ke)=>{const Ie=ve.name;this._eventsQueue.push({eventName:Ie,data:ke}),await this._runQueue()}),this._handlers.set(xe,be)}}class Sessions{static async getConnectedSessions(we,t,te){const be=new SessionCollection(t,te);return await be.connect(we),be}}const xi=class xi extends Message{constructor(t,te,be,xe,ve=""){super();Re(this,"id");Re(this,"buffers");Re(this,"types");Re(this,"bundleVersion");Re(this,"lastOperationId");this.id=t,this.buffers=te,this.types=be,this.bundleVersion=xe,this.lastOperationId=ve}toJSON(){return{id:this.id,buffers:this.buffers,types:this.types,bundleVersion:this.bundleVersion,lastOperationId:this.lastOperationId}}static fromJSON(t){return new xi(t.id,t.buffers,t.types,t.bundleVersion,t.lastOperationId)}};Re(xi,"TYPE","11"),Re(xi,"READABLE_TYPE_NAME","connectToDocument"),Re(xi,"DESCRIPTOR_NAME","CollaborativeEditingConnectMessage"),Re(xi,"DESCRIPTOR",{fields:{id:{type:"string",id:1},bundleVersion:{type:"string",id:2},buffers:{rule:"repeated",type:"bytes",id:3},types:{rule:"repeated",type:"uint32",id:4},lastOperationId:{type:"string",id:5}}});let CollaborativeEditingConnectMessage=xi;class OperationMetadataHelpers{static prepareMetadataForOperations(we,t){if(!(we&&we.length&&t&&t.length))return[];const te=[];let be=0;for(const xe of we)if(xe!==0){if(!t[be])throw new Error("Missing metadata for a operation");te.push(t[be]),be++}else te.push(te[te.length-1]);return te}static removeUnnecessaryMetadata(we,t){if(!(we&&we.length&&t&&t.length))return[];const te=[];for(let be=0;be<we.length;be++)if(we[be]!==0){if(!t[be])throw new Error("Missing metadata for a operation");te.push(t[be])}return te}}class OperationMetadataDescriptor extends Descriptor{static toJSON({createdAt:we,...t}){const te={...t};return we!=null&&we.toISOString&&(te.createdAt=we.toISOString()),te}static fromJSON({createdAt:we,...t}){const te={...t};return we&&(te.createdAt=new Date(we)),te}}Re(OperationMetadataDescriptor,"DESCRIPTOR_NAME","OperationMetadataDescriptor"),Re(OperationMetadataDescriptor,"DESCRIPTOR",{fields:{userId:{type:"string",id:1},type:{type:"string",id:2},createdAt:{type:"string",id:3}}});const li=class li extends Message{constructor(t,te,be,xe,ve=[],ke=""){super();Re(this,"id");Re(this,"buffers");Re(this,"types");Re(this,"baseVersion");Re(this,"metadata");Re(this,"lastOperationId");this.id=t,this.buffers=te,this.types=be,this.baseVersion=xe,this.metadata=ve,this.lastOperationId=ke}get data(){return{buffers:this.buffers,types:this.types,baseVersion:this.baseVersion,lastOperationId:this.lastOperationId}}toJSON(){return{id:this.id,buffers:this.buffers,types:this.types,baseVersion:this.baseVersion,metadata:OperationMetadataHelpers.removeUnnecessaryMetadata(this.types,this.metadata).map(OperationMetadataDescriptor.toJSON),lastOperationId:this.lastOperationId}}static fromJSON(t){return new li(t.id,t.buffers,t.types,t.baseVersion,OperationMetadataHelpers.prepareMetadataForOperations(t.types,t.metadata).map(OperationMetadataDescriptor.fromJSON),t.lastOperationId)}};Re(li,"TYPE","13"),Re(li,"READABLE_TYPE_NAME","updateDocument"),Re(li,"DESCRIPTOR_NAME","CollaborativeEditingUpdateMessage"),Re(li,"DESCRIPTOR",{fields:{id:{type:"string",id:1},baseVersion:{type:"uint32",id:2},buffers:{rule:"repeated",type:"bytes",id:3},types:{rule:"repeated",type:"uint32",id:4},metadata:{rule:"repeated",type:"OperationMetadataDescriptor",id:6},lastOperationId:{type:"string",id:7}}});let CollaborativeEditingUpdateMessage=li;const ui=class ui extends Message{constructor(t,te,be){super();Re(this,"id");Re(this,"lastKnowVersion");Re(this,"bundleVersion");this.id=t,this.lastKnowVersion=te,this.bundleVersion=be}toJSON(){return{id:this.id,bundleVersion:this.bundleVersion,lastKnowVersion:this.lastKnowVersion}}static fromJSON(t){return new ui(t.id,t.lastKnowVersion,t.bundleVersion)}};Re(ui,"TYPE","12"),Re(ui,"READABLE_TYPE_NAME","reconnectToDocument"),Re(ui,"DESCRIPTOR_NAME","CollaborativeEditingReconnectMessage"),Re(ui,"DESCRIPTOR",{fields:{id:{type:"string",id:1},bundleVersion:{type:"string",id:2},lastKnowVersion:{type:"uint32",id:3}}});let CollaborativeEditingReconnectMessage=ui;const Di=class Di extends Message{constructor(t,te=[],be=[],xe=[],ve="",ke=null){super();Re(this,"version");Re(this,"buffers");Re(this,"types");Re(this,"metadata");Re(this,"lastOperationId");Re(this,"lastOperationAcceptedAt");this.version=t,this.buffers=te,this.types=be,this.metadata=xe,this.lastOperationId=ve,this.lastOperationAcceptedAt=ke}get data(){return{buffers:this.buffers,types:this.types,baseVersion:this.version-this.types.length,lastOperationId:this.lastOperationId,lastOperationAcceptedAt:this.lastOperationAcceptedAt}}get wereChangesApplied(){var t;return!((t=this.types)!=null&&t.length)}toJSON(){return{version:this.version,buffers:this.buffers,types:this.types,metadata:OperationMetadataHelpers.removeUnnecessaryMetadata(this.types,this.metadata).map(OperationMetadataDescriptor.toJSON),lastOperationId:this.lastOperationId,lastOperationAcceptedAt:this.lastOperationAcceptedAt instanceof Date?this.lastOperationAcceptedAt.toISOString():this.lastOperationAcceptedAt}}static fromJSON(t){return new Di(t.version,t.buffers,t.types,OperationMetadataHelpers.prepareMetadataForOperations(t.types,t.metadata).map(OperationMetadataDescriptor.fromJSON),t.lastOperationId,t.lastOperationAcceptedAt?new Date(t.lastOperationAcceptedAt):null)}static create(t){return new Di(t.version,t.buffers,t.types,t.metadata,t.lastOperationId,t.lastOperationAcceptedAt?new Date(t.lastOperationAcceptedAt):null)}};Re(Di,"DESCRIPTOR_NAME","CollaborativeEditingResponse"),Re(Di,"DESCRIPTOR",{fields:{version:{type:"uint32",id:1},buffers:{rule:"repeated",type:"bytes",id:2},types:{rule:"repeated",type:"uint32",id:3},metadata:{rule:"repeated",type:"OperationMetadataDescriptor",id:5},lastOperationId:{type:"string",id:6},lastOperationAcceptedAt:{type:"string",id:7}}});let CollaborativeEditingResponse=Di;const Ni=class Ni extends Message{constructor(t,te,be=[],xe=[],ve=0,ke=[],Ie=null,Ae="",Se="",Oe=null){super();Re(this,"channel");Re(this,"version");Re(this,"buffers");Re(this,"types");Re(this,"offset");Re(this,"metadata");Re(this,"initData");Re(this,"sessionId");Re(this,"lastOperationId");Re(this,"sessionCreatedAt");this.channel=t,this.version=te,this.buffers=be,this.types=xe,this.offset=ve,this.metadata=ke,this.initData=Ie,this.sessionId=Ae,this.lastOperationId=Se,this.sessionCreatedAt=Oe}get data(){return{buffers:this.buffers,types:this.types,baseVersion:this.version-this.types.length,lastOperationId:this.lastOperationId,sessionCreatedAt:this.sessionCreatedAt}}get wereChangesApplied(){var t;return!((t=this.types)!=null&&t.length)&&this.initData===null}toJSON(){return{channel:this.channel,version:this.version,sessionId:this.sessionId,buffers:this.buffers,types:this.types,offset:this.offset,metadata:OperationMetadataHelpers.removeUnnecessaryMetadata(this.types,this.metadata).map(OperationMetadataDescriptor.toJSON),initData:this.initData??"",isInitialized:typeof this.initData=="string",lastOperationId:this.lastOperationId,sessionCreatedAt:this.sessionCreatedAt?this.sessionCreatedAt.toISOString():null}}static create(t){return new Ni(t.channel,t.version,t.buffers,t.types,t.offset,t.metadata,t.initData,t.sessionId,t.lastOperationId,t.sessionCreatedAt)}static fromJSON(t){let te=null;return t.isInitialized===!0?te=t.initData??"":typeof t.isInitialized!="boolean"&&t.initData&&(te=t.initData),Ni.create({channel:t.channel,version:t.version,buffers:t.buffers,types:t.types,offset:t.offset,metadata:OperationMetadataHelpers.prepareMetadataForOperations(t.types,t.metadata).map(OperationMetadataDescriptor.fromJSON),initData:te,sessionId:t.sessionId,lastOperationId:t.lastOperationId,sessionCreatedAt:t.sessionCreatedAt?new Date(t.sessionCreatedAt):null})}};Re(Ni,"DESCRIPTOR_NAME","CollaborativeEditingConnectResponse"),Re(Ni,"DESCRIPTOR",{fields:{channel:{type:"string",id:1},offset:{type:"uint32",id:2},version:{type:"uint32",id:3},buffers:{rule:"repeated",type:"bytes",id:4},types:{rule:"repeated",type:"uint32",id:5},metadata:{rule:"repeated",type:OperationMetadataDescriptor.DESCRIPTOR_NAME,id:7},initData:{type:"string",id:8},isInitialized:{type:"bool",id:9},sessionId:{type:"string",id:10},lastOperationId:{type:"string",id:11},sessionCreatedAt:{type:"string",id:12}}});let CollaborativeEditingConnectResponse=Ni;const Xi=class Xi extends Message{constructor(t,te){super();Re(this,"lastDocumentSession");Re(this,"currentDocumentSession");this.lastDocumentSession=t,this.currentDocumentSession=te}get data(){var t,te,be,xe,ve;return{lastDocumentSessionId:(t=this.lastDocumentSession)==null?void 0:t.id,lastDocumentSessionOperationId:(te=this.lastDocumentSession)==null?void 0:te.lastOperationId,currentDocumentSessionId:(be=this.currentDocumentSession)==null?void 0:be.id,currentDocumentSessionVersion:(xe=this.currentDocumentSession)==null?void 0:xe.version,currentDocumentSessionOperationId:(ve=this.currentDocumentSession)==null?void 0:ve.lastOperationId}}toJSON(){var t,te,be,xe,ve;return{lastDocumentSessionId:(t=this.lastDocumentSession)==null?void 0:t.id,lastDocumentSessionOperationId:(te=this.lastDocumentSession)==null?void 0:te.lastOperationId,currentDocumentSessionId:(be=this.currentDocumentSession)==null?void 0:be.id,currentDocumentSessionVersion:(xe=this.currentDocumentSession)==null?void 0:xe.version,currentDocumentSessionOperationId:(ve=this.currentDocumentSession)==null?void 0:ve.lastOperationId}}static fromJSON(t){const te=t.lastDocumentSessionId?{id:t.lastDocumentSessionId,lastOperationId:t.lastDocumentSessionOperationId}:void 0,be=t.currentDocumentSessionId?{lastOperationId:t.currentDocumentSessionOperationId,version:t.currentDocumentSessionVersion,id:t.currentDocumentSessionId}:void 0;return new Xi(te,be)}};Re(Xi,"DESCRIPTOR_NAME","GetDocumentDetailsResponse"),Re(Xi,"DESCRIPTOR",{fields:{lastDocumentSessionId:{type:"string",id:1},lastDocumentSessionOperationId:{type:"string",id:2},currentDocumentSessionId:{type:"string",id:3},currentDocumentSessionVersion:{type:"uint32",id:4},currentDocumentSessionOperationId:{type:"string",id:5}}});let GetDocumentDetailsResponse=Xi;const fi=class fi extends Message{constructor(t){super();Re(this,"documentId");this.documentId=t}get data(){return{documentId:this.documentId}}toJSON(){return{documentId:this.documentId}}static fromJSON(t){return new fi(t.documentId)}};Re(fi,"TYPE","14"),Re(fi,"READABLE_TYPE_NAME","getDocumentDetails"),Re(fi,"DESCRIPTOR_NAME","GetDocumentDetailsMessage"),Re(fi,"DESCRIPTOR",{fields:{documentId:{type:"string",id:1},environmentId:{type:"string",id:2}}});let GetDocumentDetailsMessage=fi;class CollaborativeEditingService extends EmitterMixin(){constructor(t,te){super();Re(this,"_bundleVersion");Re(this,"_id");Re(this,"_isConnected");Re(this,"_wsGateway");Re(this,"_channel");Re(this,"_connectedSessions");if(!t)throw new TypeError('Param "bundleVersion" must be provided.');this._id=te??v4(),this._isConnected=!1,this._bundleVersion=t}getId(){return this._id}isConnected(){return this._isConnected}connect(t,te={buffers:[],types:[]},be){const xe=new CollaborativeEditingConnectMessage(this.getId(),te.buffers,te.types,this._bundleVersion,be);return this._connect(t,xe)}reconnect(t,te){if(this.isConnected())throw new CKEditorCloudServicesError("Cannot reconnect to already connected service.",t);return this._connect(t,new CollaborativeEditingReconnectMessage(this.getId(),te,this._bundleVersion))}disconnect(){this._isConnected&&(this._isConnected=!1,this._wsGateway&&(this.stopListening(this._wsGateway),this._wsGateway=void 0),this._channel&&(this.stopListening(this._channel),this._channel=void 0),this._connectedSessions&&(this._connectedSessions.disconnect(),this._connectedSessions=void 0),this.fire("disconnected"),this.stopListening())}async getDocumentDetails(){const t=new GetDocumentDetailsMessage(this.getId());if(!this._wsGateway)throw new ServiceNotConnectedError("Collaborative Editing",this);const te=await this._wsGateway._sendRequest(1,GetDocumentDetailsMessage.TYPE,MessagesCompressor.encode(t));return MessagesCompressor.decode(te,GetDocumentDetailsResponse)}async sendOperations(t,te,be){if(!t||!t.types||!t.types.length)throw new CKEditorCloudServicesError("Cannot send empty update.",this._wsGateway);const xe=typeof te=="number"?te:parseInt(te);if(!Number.isInteger(xe)||xe<0)throw new CKEditorCloudServicesError("Base version not provided.",this._wsGateway);const ve=new CollaborativeEditingUpdateMessage(this.getId(),t.buffers,t.types,xe,[],be);if(!this._wsGateway||!this._isConnected)throw new ServiceNotConnectedError("Collaborative Editing",this);const ke=await this._wsGateway._sendRequest(1,CollaborativeEditingUpdateMessage.TYPE,MessagesCompressor.encode(ve));return MessagesCompressor.decode(ke,CollaborativeEditingResponse)}async getConnectedSessions(){if(!this._isConnected)throw new ServiceNotConnectedError("Collaborative Editing",this);return this._connectedSessions||(this._connectedSessions=await Sessions.getConnectedSessions(this._wsGateway,this._id,1)),this._connectedSessions}static getConnectedSessions(t,te){return Sessions.getConnectedSessions(t,te,1)}async _connect(t,te){if(this.isConnected())return;if(t.state!==WebSocketGateway.STATE_CONNECTED)throw new CKEditorCloudServicesError("WebSocket Gateway is not connected.",t);this._wsGateway=t,this.stopListening(t,"change:state");const be=await t._sendRequest(1,te.constructor.TYPE,MessagesCompressor.encode(te)),xe=MessagesCompressor.decode(be,CollaborativeEditingConnectResponse);return this.listenTo(t,"change:state",(ve,ke,Ie)=>this._onWsGatewayStateChange(Ie),{priority:WebSocketGateway._CHANGE_STATE_EVENT_PRIORITY}),this._connectToChannel(t,xe.channel),this._isConnected=!0,this.fire("connected"),xe}_connectToChannel(t,te){this._channel=t._getChannel(1,te),this.listenTo(this._channel,this._channel.getEventName(CollaborativeEditingUpdateMessage.TYPE),(be,xe)=>{const ve=MessagesCompressor.decode(xe,CollaborativeEditingUpdateMessage);this.fire("operationsReceived",ve.baseVersion,ve.data,ve.metadata)})}_onWsGatewayStateChange(t){t===WebSocketGateway.STATE_DISCONNECTED&&this.disconnect()}}Re(CollaborativeEditingService,"_SERVICE",1);class CommentDescriptor extends Descriptor{static toJSON(we){var t;return{...we,createdAt:(t=we.createdAt)==null?void 0:t.toISOString(),attributes:we.attributes?JSON.stringify(we.attributes):null}}static fromJSON(we){return{...we,createdAt:new Date(we.createdAt),attributes:we.attributes?JSON.parse(we.attributes):null}}}Re(CommentDescriptor,"DESCRIPTOR_NAME","CommentDescriptor"),Re(CommentDescriptor,"DESCRIPTOR",{fields:{commentId:{id:1,type:"string"},commentThreadId:{id:2,type:"string"},userId:{id:3,type:"string"},content:{id:4,type:"string"},documentId:{id:5,type:"string"},createdAt:{id:6,type:"string"},attributes:{id:7,type:"string"}}});class CommentsThreadDescriptor extends Descriptor{static toJSON(we){var t,te,be,xe,ve;return{...we,createdAt:(t=we.createdAt)==null?void 0:t.toISOString(),deletedAt:(te=we.deletedAt)==null?void 0:te.toISOString(),resolvedAt:(be=we.resolvedAt)==null?void 0:be.toISOString(),attributes:we.attributes?JSON.stringify(we.attributes):null,context:we.context?JSON.stringify(we.context):we.context,comments:(xe=we.comments)==null?void 0:xe.map(CommentDescriptor.toJSON),unlinkedAt:(ve=we.unlinkedAt)==null?void 0:ve.toISOString()}}static fromJSON(we){var t;return{...we,createdAt:we.createdAt?new Date(we.createdAt):void 0,deletedAt:we.deletedAt?new Date(we.deletedAt):void 0,resolvedAt:we.resolvedAt?new Date(we.resolvedAt):void 0,attributes:we.attributes?JSON.parse(we.attributes):null,context:we.context?JSON.parse(we.context):void 0,comments:(t=we.comments)==null?void 0:t.map(CommentDescriptor.fromJSON),unlinkedAt:we.unlinkedAt?new Date(we.unlinkedAt):void 0}}}Re(CommentsThreadDescriptor,"DESCRIPTOR_NAME","CommentsThreadDescriptor"),Re(CommentsThreadDescriptor,"DESCRIPTOR",{fields:{commentThreadId:{type:"string",id:1},comments:{type:"CommentDescriptor",rule:"repeated",id:2},resolvedAt:{type:"string",id:3},resolvedBy:{type:"string",id:4},context:{type:"string",id:5},createdAt:{type:"string",id:6},deletedAt:{type:"string",id:7},attributes:{type:"string",id:8},unlinkedAt:{type:"string",id:9}}});const hi=class hi extends Message{constructor(t,te,be,xe="",ve,ke="",Ie=null,Ae){super();Re(this,"documentId");Re(this,"commentThreadId");Re(this,"content");Re(this,"commentId");Re(this,"userId");Re(this,"attributes");Re(this,"commentThread");Re(this,"createdAt");this.documentId=t,this.commentThreadId=te,this.content=be,this.commentId=xe,this.userId=ke,this.attributes=Ie,this.commentThread=Ae,this.createdAt=ve?new Date(ve):""}toJSON(){return{commentThreadId:this.commentThreadId,content:this.content,documentId:this.documentId,commentId:this.commentId,createdAt:this.createdAt instanceof Date?this.createdAt.toISOString():this.createdAt,userId:this.userId,attributes:JSON.stringify(this.attributes),commentThread:this.commentThread?CommentsThreadDescriptor.toJSON(this.commentThread):void 0}}static fromJSON(t){return new hi(t.documentId,t.commentThreadId,t.content,t.commentId?t.commentId:void 0,t.createdAt?new Date(t.createdAt):void 0,t.userId?t.userId:void 0,t.attributes?JSON.parse(t.attributes):{},t.commentThread?CommentsThreadDescriptor.fromJSON(t.commentThread):void 0)}};Re(hi,"TYPE","91"),Re(hi,"READABLE_TYPE_NAME","addComment"),Re(hi,"DESCRIPTOR_NAME","CommentsV2AddCommentMessage"),Re(hi,"DESCRIPTOR",{fields:{commentThreadId:{type:"string",id:1},content:{type:"string",id:2},documentId:{type:"string",id:3},commentId:{type:"string",id:4},createdAt:{type:"string",id:5},userId:{type:"string",id:6},attributes:{type:"string",id:7},commentThread:{type:"CommentsThreadDescriptor",id:8}}});let AddCommentMessage=hi;const Qi=class Qi extends Message{constructor(t,te,be){super();Re(this,"commentThreadId");Re(this,"commentId");Re(this,"createdAt");this.commentThreadId=t,this.commentId=te,this.createdAt=new Date(be)}toJSON(){return{commentThreadId:this.commentThreadId,commentId:this.commentId,createdAt:this.createdAt.toISOString()}}static fromJSON(t){return new Qi(t.commentThreadId,t.commentId,t.createdAt)}};Re(Qi,"DESCRIPTOR_NAME","CommentsV2AddCommentResponse"),Re(Qi,"DESCRIPTOR",{fields:{commentThreadId:{type:"string",id:1},commentId:{type:"string",id:2},createdAt:{type:"string",id:3}}});let AddCommentResponse=Qi;const gi=class gi extends Message{constructor(t){super();Re(this,"documentId");this.documentId=t}toJSON(){return{documentId:this.documentId}}static fromJSON(t){return new gi(t.documentId)}};Re(gi,"TYPE","92"),Re(gi,"READABLE_TYPE_NAME","connectToComment"),Re(gi,"DESCRIPTOR_NAME","CommentsV2ConnectMessage"),Re(gi,"DESCRIPTOR",{fields:{documentId:{type:"string",id:1}}});let ConnectMessage=gi;const e0=class e0 extends Message{constructor(t,te,be){super();Re(this,"channel");Re(this,"_threads");Re(this,"_threadsV2");Re(this,"threads");this.channel=t,this._threads=te,this._threadsV2=be,this.threads=be!=null&&be.length?be:te}toJSON(){var t,te;return{channel:this.channel,threads:(t=this._threads)==null?void 0:t.map(be=>JSON.stringify(be)),threadsV2:(te=this._threadsV2)==null?void 0:te.map(CommentsThreadDescriptor.toJSON)}}static fromJSON(t){var te,be;return new e0(t.channel,(te=t.threads)==null?void 0:te.map(xe=>JSON.parse(xe)),(be=t.threadsV2)==null?void 0:be.map(CommentsThreadDescriptor.fromJSON))}};Re(e0,"DESCRIPTOR_NAME","CommentsV2ConnectResponse"),Re(e0,"DESCRIPTOR",{fields:{channel:{type:"string",id:1},threads:{type:"string",rule:"repeated",id:2},threadsV2:{type:"CommentsThreadDescriptor",rule:"repeated",id:3}}});let ConnectResponse=e0;const bi=class bi extends Message{constructor(t,te,be){super();Re(this,"documentId");Re(this,"commentThreadId");Re(this,"commentId");this.documentId=t,this.commentThreadId=te,this.commentId=be}toJSON(){return{documentId:this.documentId,commentThreadId:this.commentThreadId,commentId:this.commentId}}static fromJSON(t){return new bi(t.documentId,t.commentThreadId,t.commentId)}};Re(bi,"TYPE","95"),Re(bi,"READABLE_TYPE_NAME","removeComment"),Re(bi,"DESCRIPTOR_NAME","CommentsV2RemoveCommentMessage"),Re(bi,"DESCRIPTOR",{fields:{commentThreadId:{type:"string",id:1},commentId:{type:"string",id:2},documentId:{type:"string",id:3}}});let RemoveCommentMessage=bi;const pi=class pi extends Message{constructor(t,te){super();Re(this,"documentId");Re(this,"commentThreadId");this.documentId=t,this.commentThreadId=te}toJSON(){return{documentId:this.documentId,commentThreadId:this.commentThreadId}}static fromJSON(t){return new pi(t.documentId,t.commentThreadId)}};Re(pi,"TYPE","97"),Re(pi,"READABLE_TYPE_NAME","removeCommentThread"),Re(pi,"DESCRIPTOR_NAME","CommentsV2RemoveCommentThreadMessage"),Re(pi,"DESCRIPTOR",{fields:{commentThreadId:{type:"string",id:1},documentId:{type:"string",id:2}}});let RemoveCommentThreadMessage=pi;const wi=class wi extends Message{constructor(t,te,be,xe,ve=null,ke=!1,Ie){super();Re(this,"documentId");Re(this,"commentThreadId");Re(this,"commentId");Re(this,"content");Re(this,"attributes");Re(this,"isAttributesUpdated");Re(this,"commentThread");this.documentId=t,this.commentThreadId=te,this.commentId=be,this.content=xe,this.attributes=ve,this.isAttributesUpdated=ke,this.commentThread=Ie}toJSON(){return{documentId:this.documentId,commentThreadId:this.commentThreadId,commentId:this.commentId,content:this.content,attributes:this.attributes?JSON.stringify(this.attributes):null,isAttributesUpdated:this.isAttributesUpdated,commentThread:this.commentThread?CommentsThreadDescriptor.toJSON(this.commentThread):void 0}}static fromJSON(t){return new wi(t.documentId,t.commentThreadId,t.commentId,t.content,t.attributes?JSON.parse(t.attributes):null,t.isAttributesUpdated,t.commentThread?CommentsThreadDescriptor.fromJSON(t.commentThread):void 0)}};Re(wi,"TYPE","96"),Re(wi,"READABLE_TYPE_NAME","updateComment"),Re(wi,"DESCRIPTOR_NAME","CommentsV2UpdateCommentMessage"),Re(wi,"DESCRIPTOR",{fields:{commentThreadId:{type:"string",id:1},commentId:{type:"string",id:2},content:{type:"string",id:3},documentId:{type:"string",id:4},attributes:{type:"string",id:5},isAttributesUpdated:{type:"bool",id:6},commentThread:{type:"CommentsThreadDescriptor",id:7}}});let UpdateCommentMessage=wi;const yi=class yi extends Message{constructor(t,te){super();Re(this,"commentThreadId");Re(this,"documentId");this.commentThreadId=t,this.documentId=te}toJSON(){return{commentThreadId:this.commentThreadId,documentId:this.documentId}}static fromJSON(t){return new yi(t.commentThreadId,t.documentId)}};Re(yi,"TYPE","93"),Re(yi,"READABLE_TYPE_NAME","getComment"),Re(yi,"DESCRIPTOR_NAME","CommentsV2GetCommentThreadMessage"),Re(yi,"DESCRIPTOR",{fields:{commentThreadId:{type:"string",id:1},documentId:{type:"string",id:2}}});let GetCommentThreadMessage=yi;const t0=class t0 extends Message{constructor(t,te,be,xe,ve,ke,Ie,Ae,Se,Oe){super();Re(this,"commentThreadId");Re(this,"_comments");Re(this,"_commentsV2");Re(this,"resolvedBy");Re(this,"comments");Re(this,"createdAt");Re(this,"deletedAt");Re(this,"resolvedAt");Re(this,"attributes");Re(this,"context");Re(this,"unlinkedAt");this.commentThreadId=t,this._comments=te,this._commentsV2=be,this.resolvedBy=ve,this.comments=be!=null&&be.length?be:te,this.createdAt=Ie?new Date(Ie):void 0,this.deletedAt=typeof Ae=="string"?new Date(Ae):Ae,this.resolvedAt=typeof Se=="string"?new Date(Se):Se,this.unlinkedAt=typeof Oe=="string"?new Date(Oe):Oe,this.attributes=typeof xe=="string"?JSON.parse(xe):xe,this.context=typeof ke=="string"?JSON.parse(ke):ke}toJSON(){var t,te,be,xe,ve,ke;return{commentThreadId:this.commentThreadId,comments:(t=this._comments)==null?void 0:t.map(Ie=>JSON.stringify(Ie)),commentsV2:(te=this._commentsV2)==null?void 0:te.map(CommentDescriptor.toJSON),attributes:this.attributes?JSON.stringify(this.attributes):this.attributes,context:this.context?JSON.stringify(this.context):this.context,resolvedBy:this.resolvedBy,createdAt:(be=this.createdAt)==null?void 0:be.toISOString(),deletedAt:(xe=this.deletedAt)==null?void 0:xe.toISOString(),resolvedAt:(ve=this.resolvedAt)==null?void 0:ve.toISOString(),unlinkedAt:(ke=this.unlinkedAt)==null?void 0:ke.toISOString()}}static fromJSON(t){var te,be;return new t0(t.commentThreadId,(te=t.comments)==null?void 0:te.map(xe=>function(ve){const ke=JSON.parse(ve);return{...ke,createdAt:new Date(ke.createdAt)}}(xe)),(be=t.commentsV2)==null?void 0:be.map(CommentDescriptor.fromJSON),t.attributes?JSON.parse(t.attributes):t.attributes,t.resolvedBy,t.context?JSON.parse(t.context):t.context,t.createdAt,t.deletedAt,t.resolvedAt,t.unlinkedAt)}};Re(t0,"DESCRIPTOR_NAME","CommentsV2GetCommentThreadResponse"),Re(t0,"DESCRIPTOR",{fields:{commentThreadId:{type:"string",id:1},comments:{type:"string",rule:"repeated",id:2},commentsV2:{type:"CommentDescriptor",rule:"repeated",id:3},resolvedAt:{type:"string",id:4},resolvedBy:{type:"string",id:5},context:{type:"string",id:6},createdAt:{type:"string",id:7},deletedAt:{type:"string",id:8},attributes:{type:"string",id:9},unlinkedAt:{type:"string",id:10}}});let GetCommentThreadResponse=t0;const vi=class vi extends Message{constructor(t){super();Re(this,"documentId");this.documentId=t}toJSON(){return{documentId:this.documentId}}static fromJSON(t){return new vi(t.documentId)}};Re(vi,"TYPE","94"),Re(vi,"READABLE_TYPE_NAME","getDocumentThreads"),Re(vi,"DESCRIPTOR_NAME","CommentsV2GetDocumentThreadsMessage"),Re(vi,"DESCRIPTOR",{fields:{documentId:{type:"string",id:1}}});let GetDocumentThreadsMessage=vi;const n0=class n0 extends Message{constructor(t,te){super();Re(this,"_threads");Re(this,"_threadsV2");Re(this,"threads");this._threads=t,this._threadsV2=te,this.threads=te!=null&&te.length?te:t}toJSON(){var t,te;return{threads:(t=this._threads)==null?void 0:t.map(be=>JSON.stringify(be)),threadsV2:(te=this._threadsV2)==null?void 0:te.map(CommentsThreadDescriptor.toJSON)}}static fromJSON(t){var te,be;return new n0((te=t.threads)==null?void 0:te.map(xe=>function(ve){var Ae;const ke=JSON.parse(ve),Ie={...ke};return ke.comments&&(Ie.comments=(Ae=ke.comments)==null?void 0:Ae.map(Se=>({...Se,createdAt:new Date(Se.createdAt)}))),Ie}(xe)),(be=t.threadsV2)==null?void 0:be.map(CommentsThreadDescriptor.fromJSON))}};Re(n0,"DESCRIPTOR_NAME","CommentsV2GetDocumentThreadsResponse"),Re(n0,"DESCRIPTOR",{fields:{threads:{type:"string",rule:"repeated",id:1},threadsV2:{type:"CommentsThreadDescriptor",rule:"repeated",id:2}}});let GetDocumentThreadsResponse=n0;class CommentThreadAddedCommentDescriptor extends Descriptor{static toJSON(we){var t;return{commentId:we.commentId,createdAt:(t=we.createdAt)==null?void 0:t.toISOString()}}static fromJSON(we){return{commentId:we.commentId,createdAt:new Date(we.createdAt)}}}Re(CommentThreadAddedCommentDescriptor,"DESCRIPTOR_NAME","CommentThreadAddedCommentDescriptor"),Re(CommentThreadAddedCommentDescriptor,"DESCRIPTOR",{fields:{commentId:{id:1,type:"string"},createdAt:{id:2,type:"string"}}});const i0=class i0 extends Message{constructor(t,te,be=[]){super();Re(this,"commentThreadId");Re(this,"comments");Re(this,"createdAt");this.commentThreadId=t,this.comments=be,this.createdAt=new Date(te)}toJSON(){return{commentThreadId:this.commentThreadId,createdAt:this.createdAt.toISOString(),comments:this.comments.map(t=>CommentThreadAddedCommentDescriptor.toJSON(t))}}static fromJSON(t){return new i0(t.commentThreadId,t.createdAt,t.comments.map(te=>CommentThreadAddedCommentDescriptor.fromJSON(te)))}};Re(i0,"DESCRIPTOR_NAME","CommentsV2AddCommentThreadResponse"),Re(i0,"DESCRIPTOR",{fields:{commentThreadId:{type:"string",id:1},createdAt:{type:"string",id:2},comments:{type:"CommentThreadAddedCommentDescriptor",rule:"repeated",id:3}}});let AddCommentThreadResponse=i0;const Ci=class Ci extends Message{constructor(t,te,be=[],xe,ve=null,ke=null,Ie=null,Ae=null,Se=null){super();Re(this,"documentId");Re(this,"commentThreadId");Re(this,"comments");Re(this,"context");Re(this,"resolvedBy");Re(this,"attributes");Re(this,"createdAt");Re(this,"resolvedAt");Re(this,"deletedAt");this.documentId=t,this.commentThreadId=te,this.comments=be,this.context=xe,this.resolvedBy=ve,this.attributes=Se,this.createdAt=ke?new Date(ke):"",this.resolvedAt=Ie?new Date(Ie):"",this.deletedAt=Ae?new Date(Ae):""}toJSON(){var t;return{commentThreadId:this.commentThreadId,context:this.context?JSON.stringify(this.context):this.context,documentId:this.documentId,resolvedBy:this.resolvedBy,resolvedAt:this.resolvedAt instanceof Date?this.resolvedAt.toISOString():this.resolvedAt,deletedAt:this.deletedAt instanceof Date?this.deletedAt.toISOString():this.deletedAt,createdAt:this.createdAt instanceof Date?this.createdAt.toISOString():this.createdAt,attributes:this.attributes?JSON.stringify(this.attributes):this.attributes,comments:(t=this.comments)==null?void 0:t.map(te=>CommentDescriptor.toJSON(te))}}static fromJSON(t){var te;return new Ci(t.documentId,t.commentThreadId,(te=t.comments)==null?void 0:te.map(be=>CommentDescriptor.fromJSON({...be,documentId:t.documentId,commentThreadId:t.commentThreadId})),t.context?JSON.parse(t.context):t.context,t.resolvedBy,t.createdAt?new Date(t.createdAt):void 0,t.resolvedAt?new Date(t.resolvedAt):void 0,t.deletedAt?new Date(t.deletedAt):void 0,t.attributes?JSON.parse(t.attributes):t.attributes)}};Re(Ci,"TYPE","140"),Re(Ci,"READABLE_TYPE_NAME","addCommentThread"),Re(Ci,"DESCRIPTOR_NAME","CommentsV2AddCommentThreadMessage"),Re(Ci,"DESCRIPTOR",{fields:{documentId:{type:"string",id:1},commentThreadId:{type:"string",id:2},context:{type:"string",id:3},createdAt:{type:"string",id:4},resolvedAt:{type:"string",id:5},resolvedBy:{type:"string",id:6},attributes:{type:"string",id:7},deletedAt:{type:"string",id:8},comments:{type:"CommentDescriptor",rule:"repeated",id:9}}});let AddCommentThreadMessage=Ci;const Ti=class Ti extends Message{constructor(t,te,be,xe){super();Re(this,"commentThreadId");Re(this,"documentId");Re(this,"resolvedBy");Re(this,"resolvedAt");this.commentThreadId=t,this.documentId=te,this.resolvedBy=be,this.resolvedAt=xe?new Date(xe):void 0}toJSON(){var t;return{documentId:this.documentId,commentThreadId:this.commentThreadId,resolvedBy:this.resolvedBy,resolvedAt:(t=this.resolvedAt)==null?void 0:t.toISOString()}}static fromJSON(t){return new Ti(t.commentThreadId,t.documentId,t.resolvedBy,t.resolvedAt)}};Re(Ti,"TYPE","142"),Re(Ti,"READABLE_TYPE_NAME","resolveCommentThread"),Re(Ti,"DESCRIPTOR_NAME","CommentsV2ResolveCommentThreadMessage"),Re(Ti,"DESCRIPTOR",{fields:{commentThreadId:{type:"string",id:1},documentId:{type:"string",id:2},resolvedBy:{type:"string",id:3},resolvedAt:{type:"string",id:4}}});let ResolveCommentThreadMessage=Ti;const ki=class ki extends Message{constructor(t,te){super();Re(this,"commentThreadId");Re(this,"documentId");this.commentThreadId=t,this.documentId=te}toJSON(){return{documentId:this.documentId,commentThreadId:this.commentThreadId}}static fromJSON(t){return new ki(t.commentThreadId,t.documentId)}};Re(ki,"TYPE","141"),Re(ki,"READABLE_TYPE_NAME","reopenCommentThread"),Re(ki,"DESCRIPTOR_NAME","CommentsV2ReopenCommentThreadMessage"),Re(ki,"DESCRIPTOR",{fields:{commentThreadId:{type:"string",id:1},documentId:{type:"string",id:2}}});let ReopenCommentThreadMessage=ki;const Ei=class Ei extends Message{constructor(t,te,be,xe=null,ve=null){super();Re(this,"commentThreadId");Re(this,"documentId");Re(this,"context");Re(this,"attributes");Re(this,"unlinkedAt");this.commentThreadId=t,this.documentId=te,this.context=be,this.attributes=xe,this.unlinkedAt=ve?new Date(ve):""}toJSON(){return{documentId:this.documentId,commentThreadId:this.commentThreadId,context:this.context?JSON.stringify(this.context):this.context,attributes:this.attributes?JSON.stringify(this.attributes):null,unlinkedAt:this.unlinkedAt instanceof Date?this.unlinkedAt.toISOString():this.unlinkedAt}}static fromJSON(t){return new Ei(t.commentThreadId,t.documentId,t.context?JSON.parse(t.context):t.context,t.attributes?JSON.parse(t.attributes):null,t.unlinkedAt?new Date(t.unlinkedAt):null)}};Re(Ei,"TYPE","143"),Re(Ei,"READABLE_TYPE_NAME","updateCommentThread"),Re(Ei,"DESCRIPTOR_NAME","CommentsV2UpdateCommentThreadMessage"),Re(Ei,"DESCRIPTOR",{fields:{commentThreadId:{type:"string",id:1},documentId:{type:"string",id:2},context:{type:"string",id:3},attributes:{type:"string",id:4},unlinkedAt:{type:"string",id:5}}});let UpdateCommentThreadMessage=Ei;const s0=class s0 extends Message{constructor(t,te,be,xe){super();Re(this,"commentThreadId");Re(this,"documentId");Re(this,"resolvedBy");Re(this,"resolvedAt");this.commentThreadId=t,this.documentId=te,this.resolvedBy=be,this.resolvedAt=new Date(xe)}toJSON(){return{commentThreadId:this.commentThreadId,documentId:this.documentId,resolvedBy:this.resolvedBy,resolvedAt:this.resolvedAt.toISOString()}}static fromJSON(t){return new s0(t.commentThreadId,t.documentId,t.resolvedBy,t.resolvedAt)}};Re(s0,"DESCRIPTOR_NAME","CommentsV2ResolveCommentThreadResponse"),Re(s0,"DESCRIPTOR",{fields:{commentThreadId:{type:"string",id:1},documentId:{type:"string",id:2},resolvedAt:{type:"string",id:3},resolvedBy:{type:"string",id:4}}});let ResolveCommentThreadResponse=s0;const u0=class u0 extends EmitterMixin(){constructor(t){super();Re(this,"_documentId");Re(this,"_isConnected");Re(this,"_wsGateway");Re(this,"_channel");Re(this,"_connectedSessions");this._documentId=t,this._isConnected=!1}get isConnected(){return this._isConnected}async connect(t){if(this._isConnected)return;if(t.state!==WEB_SOCKET_GATEWAY_STATES.CONNECTED)throw new CKEditorCloudServicesError("WebSocket Gateway is not connected.",t);const te=new ConnectMessage(this._documentId);this._wsGateway=t,this.stopListening(t,"change:state");const be=await t._sendRequest(9,ConnectMessage.TYPE,MessagesCompressor.encode(te)),{channel:xe,threads:ve}=MessagesCompressor.decode(be,ConnectResponse);return this.listenTo(t,"change:state",(ke,Ie,Ae)=>this._onWsGatewayStateChange(Ae),{priority:WebSocketGateway._CHANGE_STATE_EVENT_PRIORITY}),this._connectToChannel(t,xe),this._isConnected=!0,this.fire("connected"),ve}disconnect(){this._isConnected&&(this._isConnected=!1,this._wsGateway&&(this.stopListening(this._wsGateway),this._wsGateway=void 0),this._channel&&(this.stopListening(this._channel),this._channel=void 0),this._connectedSessions&&(this._connectedSessions.disconnect(),this._connectedSessions=void 0),this.fire("disconnected"),this.stopListening())}async addComment(t,te,be,xe){const ve=new AddCommentMessage(this._documentId,t,be,te,void 0,void 0,xe),ke=await this._sendRequest(AddCommentMessage.TYPE,ve);return MessagesCompressor.decode(ke,AddCommentResponse)}async updateComment(t,te,be,xe){const ve=xe!==void 0,ke=new UpdateCommentMessage(this._documentId,t,te,be,xe,ve);await this._sendRequest(UpdateCommentMessage.TYPE,ke)}async removeComment(t,te){const be=new RemoveCommentMessage(this._documentId,t,te);await this._sendRequest(RemoveCommentMessage.TYPE,be)}async removeCommentThread(t){const te=new RemoveCommentThreadMessage(this._documentId,t);await this._sendRequest(RemoveCommentThreadMessage.TYPE,te)}async addCommentThread(t){var xe;const te=new AddCommentThreadMessage(this._documentId,t.commentThreadId,(xe=t.comments)==null?void 0:xe.map(ve=>({...ve,documentId:this._documentId,commentThreadId:t.commentThreadId})),t.context,t.resolvedBy,t.createdAt,t.resolvedAt,t.deletedAt,t.attributes),be=await this._sendRequest(AddCommentThreadMessage.TYPE,te);return MessagesCompressor.decode(be,AddCommentThreadResponse)}async resolveCommentThread(t){const te=new ResolveCommentThreadMessage(t,this._documentId),be=await this._sendRequest(ResolveCommentThreadMessage.TYPE,te);return MessagesCompressor.decode(be,ResolveCommentThreadResponse)}async reopenCommentThread(t){const te=new ReopenCommentThreadMessage(t,this._documentId);await this._sendRequest(ReopenCommentThreadMessage.TYPE,te)}async updateCommentThread(t){const te=new UpdateCommentThreadMessage(t.commentThreadId,this._documentId,t.context,t.attributes,t.unlinkedAt);await this._sendRequest(UpdateCommentThreadMessage.TYPE,te)}async getCommentThread(t,te=1){const be=new GetCommentThreadMessage(t,this._documentId);try{const ve=await this._sendRequest(GetCommentThreadMessage.TYPE,be),ke=MessagesCompressor.decode(ve,GetCommentThreadResponse);return{commentThreadId:ke.commentThreadId,comments:ke.comments,attributes:ke.attributes,context:ke.context,resolvedAt:ke.resolvedAt,resolvedBy:ke.resolvedBy,deletedAt:ke.deletedAt,unlinkedAt:ke.unlinkedAt}}catch(ve){if(ve.name==="CKEditorCloudServicesServerError"&&ve.code==="404"&&te<5)return await(xe=100*te,new Promise(ke=>{setTimeout(ke,xe)})),this.getCommentThread(t,te+1);throw ve.name==="CKEditorCloudServicesServerError"?ve:CKEditorCloudServicesServerError.fromPublicError(ve)}var xe}async getDocumentThreads(){const t=new GetDocumentThreadsMessage(this._documentId),te=await this._sendRequest(GetDocumentThreadsMessage.TYPE,t),{threads:be}=MessagesCompressor.decode(te,GetDocumentThreadsResponse);return{threads:be}}async getConnectedSessions(){if(!this._isConnected)throw new ServiceNotConnectedError("Comments",this);return this._connectedSessions||(this._connectedSessions=await Sessions.getConnectedSessions(this._wsGateway,this._documentId,9)),this._connectedSessions}_connectToChannel(t,te){this._channel=t._getChannel(u0._SERVICE,te),this._channel&&(this.listenTo(this._channel,this._channel.getEventName(AddCommentMessage.TYPE),(be,xe)=>{const ve=MessagesCompressor.decode(xe,AddCommentMessage);this.fire("commentAdded",ve)}),this.listenTo(this._channel,this._channel.getEventName(RemoveCommentMessage.TYPE),(be,xe)=>{const ve=MessagesCompressor.decode(xe,RemoveCommentMessage);this.fire("commentRemoved",ve)}),this.listenTo(this._channel,this._channel.getEventName(UpdateCommentMessage.TYPE),(be,xe)=>{const ve=MessagesCompressor.decode(xe,UpdateCommentMessage);this.fire("commentUpdated",ve)}),this.listenTo(this._channel,this._channel.getEventName(RemoveCommentThreadMessage.TYPE),(be,xe)=>{const ve=MessagesCompressor.decode(xe,RemoveCommentThreadMessage);this.fire("commentThreadRemoved",ve)}),this.listenTo(this._channel,this._channel.getEventName(AddCommentThreadMessage.TYPE),(be,xe)=>{const ve=MessagesCompressor.decode(xe,AddCommentThreadMessage);this.fire("commentThreadAdded",ve)}),this.listenTo(this._channel,this._channel.getEventName(UpdateCommentThreadMessage.TYPE),(be,xe)=>{const ve=MessagesCompressor.decode(xe,UpdateCommentThreadMessage);this.fire("commentThreadUpdated",ve)}),this.listenTo(this._channel,this._channel.getEventName(ResolveCommentThreadMessage.TYPE),(be,xe)=>{const ve=MessagesCompressor.decode(xe,ResolveCommentThreadMessage);this.fire("commentThreadResolved",ve)}),this.listenTo(this._channel,this._channel.getEventName(ReopenCommentThreadMessage.TYPE),(be,xe)=>{const ve=MessagesCompressor.decode(xe,ReopenCommentThreadMessage);this.fire("commentThreadReopened",ve)}))}_onWsGatewayStateChange(t){t===WEB_SOCKET_GATEWAY_STATES.DISCONNECTED&&this.disconnect()}_sendRequest(t,te){if(!this._wsGateway||!this._isConnected)throw new ServiceNotConnectedError("Comments",this);return this._wsGateway._sendRequest(9,t,MessagesCompressor.encode(te))}};Re(u0,"_SERVICE",9);let CommentsService=u0;const u$2=(()=>{var Te=_0x462d7f.Reader,we=_0x462d7f.Writer,t=_0x462d7f.util,te=_0x462d7f.roots.default||(_0x462d7f.roots.default={});return te.AttributeOperation=function(){function be(xe){if(xe)for(var ve=Object.keys(xe),ke=0;ke<ve.length;++ke)xe[ve[ke]]!=null&&(this[ve[ke]]=xe[ve[ke]])}return be.prototype.range=null,be.prototype.key="",be.prototype.oldValueBoolean=!1,be.prototype.oldValueJson="",be.prototype.newValueBoolean=!1,be.prototype.newValueJson="",be.prototype.wasUndone=!1,be.create=function(xe){return new be(xe)},be.encode=function(xe,ve){return ve||(ve=we.create()),xe.range!=null&&Object.hasOwnProperty.call(xe,"range")&&te.Range.encode(xe.range,ve.uint32(10).fork()).ldelim(),xe.key!=null&&Object.hasOwnProperty.call(xe,"key")&&ve.uint32(18).string(xe.key),xe.oldValueBoolean!=null&&Object.hasOwnProperty.call(xe,"oldValueBoolean")&&ve.uint32(24).bool(xe.oldValueBoolean),xe.oldValueJson!=null&&Object.hasOwnProperty.call(xe,"oldValueJson")&&ve.uint32(34).string(xe.oldValueJson),xe.newValueBoolean!=null&&Object.hasOwnProperty.call(xe,"newValueBoolean")&&ve.uint32(40).bool(xe.newValueBoolean),xe.newValueJson!=null&&Object.hasOwnProperty.call(xe,"newValueJson")&&ve.uint32(50).string(xe.newValueJson),xe.wasUndone!=null&&Object.hasOwnProperty.call(xe,"wasUndone")&&ve.uint32(56).bool(xe.wasUndone),ve},be.encodeDelimited=function(xe,ve){return this.encode(xe,ve).ldelim()},be.decode=function(xe,ve){xe instanceof Te||(xe=Te.create(xe));for(var ke=ve===void 0?xe.len:xe.pos+ve,Ie=new te.AttributeOperation;xe.pos<ke;){var Ae=xe.uint32();switch(Ae>>>3){case 1:Ie.range=te.Range.decode(xe,xe.uint32());break;case 2:Ie.key=xe.string();break;case 3:Ie.oldValueBoolean=xe.bool();break;case 4:Ie.oldValueJson=xe.string();break;case 5:Ie.newValueBoolean=xe.bool();break;case 6:Ie.newValueJson=xe.string();break;case 7:Ie.wasUndone=xe.bool();break;default:xe.skipType(7&Ae)}}return Ie},be.decodeDelimited=function(xe){return xe instanceof Te||(xe=new Te(xe)),this.decode(xe,xe.uint32())},be.verify=function(xe){if(typeof xe!="object"||xe===null)return"object expected";if(xe.range!=null&&xe.hasOwnProperty("range")){var ve=te.Range.verify(xe.range);if(ve)return"range."+ve}return xe.key!=null&&xe.hasOwnProperty("key")&&!t.isString(xe.key)?"key: string expected":xe.oldValueBoolean!=null&&xe.hasOwnProperty("oldValueBoolean")&&typeof xe.oldValueBoolean!="boolean"?"oldValueBoolean: boolean expected":xe.oldValueJson!=null&&xe.hasOwnProperty("oldValueJson")&&!t.isString(xe.oldValueJson)?"oldValueJson: string expected":xe.newValueBoolean!=null&&xe.hasOwnProperty("newValueBoolean")&&typeof xe.newValueBoolean!="boolean"?"newValueBoolean: boolean expected":xe.newValueJson!=null&&xe.hasOwnProperty("newValueJson")&&!t.isString(xe.newValueJson)?"newValueJson: string expected":xe.wasUndone!=null&&xe.hasOwnProperty("wasUndone")&&typeof xe.wasUndone!="boolean"?"wasUndone: boolean expected":null},be.fromObject=function(xe){if(xe instanceof te.AttributeOperation)return xe;var ve=new te.AttributeOperation;if(xe.range!=null){if(typeof xe.range!="object")throw TypeError(".AttributeOperation.range: object expected");ve.range=te.Range.fromObject(xe.range)}return xe.key!=null&&(ve.key=String(xe.key)),xe.oldValueBoolean!=null&&(ve.oldValueBoolean=!!xe.oldValueBoolean),xe.oldValueJson!=null&&(ve.oldValueJson=String(xe.oldValueJson)),xe.newValueBoolean!=null&&(ve.newValueBoolean=!!xe.newValueBoolean),xe.newValueJson!=null&&(ve.newValueJson=String(xe.newValueJson)),xe.wasUndone!=null&&(ve.wasUndone=!!xe.wasUndone),ve},be.toObject=function(xe,ve){ve||(ve={});var ke={};return ve.defaults&&(ke.range=null,ke.key="",ke.oldValueBoolean=!1,ke.oldValueJson="",ke.newValueBoolean=!1,ke.newValueJson="",ke.wasUndone=!1),xe.range!=null&&xe.hasOwnProperty("range")&&(ke.range=te.Range.toObject(xe.range,ve)),xe.key!=null&&xe.hasOwnProperty("key")&&(ke.key=xe.key),xe.oldValueBoolean!=null&&xe.hasOwnProperty("oldValueBoolean")&&(ke.oldValueBoolean=xe.oldValueBoolean),xe.oldValueJson!=null&&xe.hasOwnProperty("oldValueJson")&&(ke.oldValueJson=xe.oldValueJson),xe.newValueBoolean!=null&&xe.hasOwnProperty("newValueBoolean")&&(ke.newValueBoolean=xe.newValueBoolean),xe.newValueJson!=null&&xe.hasOwnProperty("newValueJson")&&(ke.newValueJson=xe.newValueJson),xe.wasUndone!=null&&xe.hasOwnProperty("wasUndone")&&(ke.wasUndone=xe.wasUndone),ke},be.prototype.toJSON=function(){return this.constructor.toObject(this,_0x462d7f.util.toJSONOptions)},be.getTypeUrl=function(xe){return xe===void 0&&(xe="type.googleapis.com"),xe+"/AttributeOperation"},be}(),te.InsertOperation=function(){function be(xe){if(this.nodes=[],xe)for(var ve=Object.keys(xe),ke=0;ke<ve.length;++ke)xe[ve[ke]]!=null&&(this[ve[ke]]=xe[ve[ke]])}return be.prototype.position=null,be.prototype.nodes=t.emptyArray,be.prototype.shouldReceiveAttributes=!1,be.prototype.wasUndone=!1,be.create=function(xe){return new be(xe)},be.encode=function(xe,ve){if(ve||(ve=we.create()),xe.position!=null&&Object.hasOwnProperty.call(xe,"position")&&te.Position.encode(xe.position,ve.uint32(10).fork()).ldelim(),xe.nodes!=null&&xe.nodes.length)for(var ke=0;ke<xe.nodes.length;++ke)te.Element.encode(xe.nodes[ke],ve.uint32(18).fork()).ldelim();return xe.shouldReceiveAttributes!=null&&Object.hasOwnProperty.call(xe,"shouldReceiveAttributes")&&ve.uint32(24).bool(xe.shouldReceiveAttributes),xe.wasUndone!=null&&Object.hasOwnProperty.call(xe,"wasUndone")&&ve.uint32(32).bool(xe.wasUndone),ve},be.encodeDelimited=function(xe,ve){return this.encode(xe,ve).ldelim()},be.decode=function(xe,ve){xe instanceof Te||(xe=Te.create(xe));for(var ke=ve===void 0?xe.len:xe.pos+ve,Ie=new te.InsertOperation;xe.pos<ke;){var Ae=xe.uint32();switch(Ae>>>3){case 1:Ie.position=te.Position.decode(xe,xe.uint32());break;case 2:Ie.nodes&&Ie.nodes.length||(Ie.nodes=[]),Ie.nodes.push(te.Element.decode(xe,xe.uint32()));break;case 3:Ie.shouldReceiveAttributes=xe.bool();break;case 4:Ie.wasUndone=xe.bool();break;default:xe.skipType(7&Ae)}}return Ie},be.decodeDelimited=function(xe){return xe instanceof Te||(xe=new Te(xe)),this.decode(xe,xe.uint32())},be.verify=function(xe){if(typeof xe!="object"||xe===null)return"object expected";if(xe.position!=null&&xe.hasOwnProperty("position")&&(ke=te.Position.verify(xe.position)))return"position."+ke;if(xe.nodes!=null&&xe.hasOwnProperty("nodes")){if(!Array.isArray(xe.nodes))return"nodes: array expected";for(var ve=0;ve<xe.nodes.length;++ve){var ke;if(ke=te.Element.verify(xe.nodes[ve]))return"nodes."+ke}}return xe.shouldReceiveAttributes!=null&&xe.hasOwnProperty("shouldReceiveAttributes")&&typeof xe.shouldReceiveAttributes!="boolean"?"shouldReceiveAttributes: boolean expected":xe.wasUndone!=null&&xe.hasOwnProperty("wasUndone")&&typeof xe.wasUndone!="boolean"?"wasUndone: boolean expected":null},be.fromObject=function(xe){if(xe instanceof te.InsertOperation)return xe;var ve=new te.InsertOperation;if(xe.position!=null){if(typeof xe.position!="object")throw TypeError(".InsertOperation.position: object expected");ve.position=te.Position.fromObject(xe.position)}if(xe.nodes){if(!Array.isArray(xe.nodes))throw TypeError(".InsertOperation.nodes: array expected");ve.nodes=[];for(var ke=0;ke<xe.nodes.length;++ke){if(typeof xe.nodes[ke]!="object")throw TypeError(".InsertOperation.nodes: object expected");ve.nodes[ke]=te.Element.fromObject(xe.nodes[ke])}}return xe.shouldReceiveAttributes!=null&&(ve.shouldReceiveAttributes=!!xe.shouldReceiveAttributes),xe.wasUndone!=null&&(ve.wasUndone=!!xe.wasUndone),ve},be.toObject=function(xe,ve){ve||(ve={});var ke={};if((ve.arrays||ve.defaults)&&(ke.nodes=[]),ve.defaults&&(ke.position=null,ke.shouldReceiveAttributes=!1,ke.wasUndone=!1),xe.position!=null&&xe.hasOwnProperty("position")&&(ke.position=te.Position.toObject(xe.position,ve)),xe.nodes&&xe.nodes.length){ke.nodes=[];for(var Ie=0;Ie<xe.nodes.length;++Ie)ke.nodes[Ie]=te.Element.toObject(xe.nodes[Ie],ve)}return xe.shouldReceiveAttributes!=null&&xe.hasOwnProperty("shouldReceiveAttributes")&&(ke.shouldReceiveAttributes=xe.shouldReceiveAttributes),xe.wasUndone!=null&&xe.hasOwnProperty("wasUndone")&&(ke.wasUndone=xe.wasUndone),ke},be.prototype.toJSON=function(){return this.constructor.toObject(this,_0x462d7f.util.toJSONOptions)},be.getTypeUrl=function(xe){return xe===void 0&&(xe="type.googleapis.com"),xe+"/InsertOperation"},be}(),te.MarkerOperation=function(){function be(xe){if(xe)for(var ve=Object.keys(xe),ke=0;ke<ve.length;++ke)xe[ve[ke]]!=null&&(this[ve[ke]]=xe[ve[ke]])}return be.prototype.name="",be.prototype.oldRange=null,be.prototype.newRange=null,be.prototype.affectsData=!1,be.prototype.wasUndone=!1,be.create=function(xe){return new be(xe)},be.encode=function(xe,ve){return ve||(ve=we.create()),xe.name!=null&&Object.hasOwnProperty.call(xe,"name")&&ve.uint32(10).string(xe.name),xe.oldRange!=null&&Object.hasOwnProperty.call(xe,"oldRange")&&te.Range.encode(xe.oldRange,ve.uint32(18).fork()).ldelim(),xe.newRange!=null&&Object.hasOwnProperty.call(xe,"newRange")&&te.Range.encode(xe.newRange,ve.uint32(26).fork()).ldelim(),xe.affectsData!=null&&Object.hasOwnProperty.call(xe,"affectsData")&&ve.uint32(32).bool(xe.affectsData),xe.wasUndone!=null&&Object.hasOwnProperty.call(xe,"wasUndone")&&ve.uint32(40).bool(xe.wasUndone),ve},be.encodeDelimited=function(xe,ve){return this.encode(xe,ve).ldelim()},be.decode=function(xe,ve){xe instanceof Te||(xe=Te.create(xe));for(var ke=ve===void 0?xe.len:xe.pos+ve,Ie=new te.MarkerOperation;xe.pos<ke;){var Ae=xe.uint32();switch(Ae>>>3){case 1:Ie.name=xe.string();break;case 2:Ie.oldRange=te.Range.decode(xe,xe.uint32());break;case 3:Ie.newRange=te.Range.decode(xe,xe.uint32());break;case 4:Ie.affectsData=xe.bool();break;case 5:Ie.wasUndone=xe.bool();break;default:xe.skipType(7&Ae)}}return Ie},be.decodeDelimited=function(xe){return xe instanceof Te||(xe=new Te(xe)),this.decode(xe,xe.uint32())},be.verify=function(xe){if(typeof xe!="object"||xe===null)return"object expected";if(xe.name!=null&&xe.hasOwnProperty("name")&&!t.isString(xe.name))return"name: string expected";var ve;return xe.oldRange!=null&&xe.hasOwnProperty("oldRange")&&(ve=te.Range.verify(xe.oldRange))?"oldRange."+ve:xe.newRange!=null&&xe.hasOwnProperty("newRange")&&(ve=te.Range.verify(xe.newRange))?"newRange."+ve:xe.affectsData!=null&&xe.hasOwnProperty("affectsData")&&typeof xe.affectsData!="boolean"?"affectsData: boolean expected":xe.wasUndone!=null&&xe.hasOwnProperty("wasUndone")&&typeof xe.wasUndone!="boolean"?"wasUndone: boolean expected":null},be.fromObject=function(xe){if(xe instanceof te.MarkerOperation)return xe;var ve=new te.MarkerOperation;if(xe.name!=null&&(ve.name=String(xe.name)),xe.oldRange!=null){if(typeof xe.oldRange!="object")throw TypeError(".MarkerOperation.oldRange: object expected");ve.oldRange=te.Range.fromObject(xe.oldRange)}if(xe.newRange!=null){if(typeof xe.newRange!="object")throw TypeError(".MarkerOperation.newRange: object expected");ve.newRange=te.Range.fromObject(xe.newRange)}return xe.affectsData!=null&&(ve.affectsData=!!xe.affectsData),xe.wasUndone!=null&&(ve.wasUndone=!!xe.wasUndone),ve},be.toObject=function(xe,ve){ve||(ve={});var ke={};return ve.defaults&&(ke.name="",ke.oldRange=null,ke.newRange=null,ke.affectsData=!1,ke.wasUndone=!1),xe.name!=null&&xe.hasOwnProperty("name")&&(ke.name=xe.name),xe.oldRange!=null&&xe.hasOwnProperty("oldRange")&&(ke.oldRange=te.Range.toObject(xe.oldRange,ve)),xe.newRange!=null&&xe.hasOwnProperty("newRange")&&(ke.newRange=te.Range.toObject(xe.newRange,ve)),xe.affectsData!=null&&xe.hasOwnProperty("affectsData")&&(ke.affectsData=xe.affectsData),xe.wasUndone!=null&&xe.hasOwnProperty("wasUndone")&&(ke.wasUndone=xe.wasUndone),ke},be.prototype.toJSON=function(){return this.constructor.toObject(this,_0x462d7f.util.toJSONOptions)},be.getTypeUrl=function(xe){return xe===void 0&&(xe="type.googleapis.com"),xe+"/MarkerOperation"},be}(),te.MergeOperation=function(){function be(xe){if(xe)for(var ve=Object.keys(xe),ke=0;ke<ve.length;++ke)xe[ve[ke]]!=null&&(this[ve[ke]]=xe[ve[ke]])}return be.prototype.sourcePosition=null,be.prototype.targetPosition=null,be.prototype.graveyardPosition=null,be.prototype.howMany=0,be.prototype.wasUndone=!1,be.create=function(xe){return new be(xe)},be.encode=function(xe,ve){return ve||(ve=we.create()),xe.sourcePosition!=null&&Object.hasOwnProperty.call(xe,"sourcePosition")&&te.Position.encode(xe.sourcePosition,ve.uint32(10).fork()).ldelim(),xe.targetPosition!=null&&Object.hasOwnProperty.call(xe,"targetPosition")&&te.Position.encode(xe.targetPosition,ve.uint32(18).fork()).ldelim(),xe.graveyardPosition!=null&&Object.hasOwnProperty.call(xe,"graveyardPosition")&&te.Position.encode(xe.graveyardPosition,ve.uint32(26).fork()).ldelim(),xe.howMany!=null&&Object.hasOwnProperty.call(xe,"howMany")&&ve.uint32(32).uint32(xe.howMany),xe.wasUndone!=null&&Object.hasOwnProperty.call(xe,"wasUndone")&&ve.uint32(40).bool(xe.wasUndone),ve},be.encodeDelimited=function(xe,ve){return this.encode(xe,ve).ldelim()},be.decode=function(xe,ve){xe instanceof Te||(xe=Te.create(xe));for(var ke=ve===void 0?xe.len:xe.pos+ve,Ie=new te.MergeOperation;xe.pos<ke;){var Ae=xe.uint32();switch(Ae>>>3){case 1:Ie.sourcePosition=te.Position.decode(xe,xe.uint32());break;case 2:Ie.targetPosition=te.Position.decode(xe,xe.uint32());break;case 3:Ie.graveyardPosition=te.Position.decode(xe,xe.uint32());break;case 4:Ie.howMany=xe.uint32();break;case 5:Ie.wasUndone=xe.bool();break;default:xe.skipType(7&Ae)}}return Ie},be.decodeDelimited=function(xe){return xe instanceof Te||(xe=new Te(xe)),this.decode(xe,xe.uint32())},be.verify=function(xe){if(typeof xe!="object"||xe===null)return"object expected";var ve;return xe.sourcePosition!=null&&xe.hasOwnProperty("sourcePosition")&&(ve=te.Position.verify(xe.sourcePosition))?"sourcePosition."+ve:xe.targetPosition!=null&&xe.hasOwnProperty("targetPosition")&&(ve=te.Position.verify(xe.targetPosition))?"targetPosition."+ve:xe.graveyardPosition!=null&&xe.hasOwnProperty("graveyardPosition")&&(ve=te.Position.verify(xe.graveyardPosition))?"graveyardPosition."+ve:xe.howMany!=null&&xe.hasOwnProperty("howMany")&&!t.isInteger(xe.howMany)?"howMany: integer expected":xe.wasUndone!=null&&xe.hasOwnProperty("wasUndone")&&typeof xe.wasUndone!="boolean"?"wasUndone: boolean expected":null},be.fromObject=function(xe){if(xe instanceof te.MergeOperation)return xe;var ve=new te.MergeOperation;if(xe.sourcePosition!=null){if(typeof xe.sourcePosition!="object")throw TypeError(".MergeOperation.sourcePosition: object expected");ve.sourcePosition=te.Position.fromObject(xe.sourcePosition)}if(xe.targetPosition!=null){if(typeof xe.targetPosition!="object")throw TypeError(".MergeOperation.targetPosition: object expected");ve.targetPosition=te.Position.fromObject(xe.targetPosition)}if(xe.graveyardPosition!=null){if(typeof xe.graveyardPosition!="object")throw TypeError(".MergeOperation.graveyardPosition: object expected");ve.graveyardPosition=te.Position.fromObject(xe.graveyardPosition)}return xe.howMany!=null&&(ve.howMany=xe.howMany>>>0),xe.wasUndone!=null&&(ve.wasUndone=!!xe.wasUndone),ve},be.toObject=function(xe,ve){ve||(ve={});var ke={};return ve.defaults&&(ke.sourcePosition=null,ke.targetPosition=null,ke.graveyardPosition=null,ke.howMany=0,ke.wasUndone=!1),xe.sourcePosition!=null&&xe.hasOwnProperty("sourcePosition")&&(ke.sourcePosition=te.Position.toObject(xe.sourcePosition,ve)),xe.targetPosition!=null&&xe.hasOwnProperty("targetPosition")&&(ke.targetPosition=te.Position.toObject(xe.targetPosition,ve)),xe.graveyardPosition!=null&&xe.hasOwnProperty("graveyardPosition")&&(ke.graveyardPosition=te.Position.toObject(xe.graveyardPosition,ve)),xe.howMany!=null&&xe.hasOwnProperty("howMany")&&(ke.howMany=xe.howMany),xe.wasUndone!=null&&xe.hasOwnProperty("wasUndone")&&(ke.wasUndone=xe.wasUndone),ke},be.prototype.toJSON=function(){return this.constructor.toObject(this,_0x462d7f.util.toJSONOptions)},be.getTypeUrl=function(xe){return xe===void 0&&(xe="type.googleapis.com"),xe+"/MergeOperation"},be}(),te.MoveOperation=function(){function be(xe){if(xe)for(var ve=Object.keys(xe),ke=0;ke<ve.length;++ke)xe[ve[ke]]!=null&&(this[ve[ke]]=xe[ve[ke]])}return be.prototype.sourcePosition=null,be.prototype.howMany=0,be.prototype.targetPosition=null,be.prototype.wasUndone=!1,be.create=function(xe){return new be(xe)},be.encode=function(xe,ve){return ve||(ve=we.create()),xe.sourcePosition!=null&&Object.hasOwnProperty.call(xe,"sourcePosition")&&te.Position.encode(xe.sourcePosition,ve.uint32(10).fork()).ldelim(),xe.howMany!=null&&Object.hasOwnProperty.call(xe,"howMany")&&ve.uint32(16).uint32(xe.howMany),xe.targetPosition!=null&&Object.hasOwnProperty.call(xe,"targetPosition")&&te.Position.encode(xe.targetPosition,ve.uint32(26).fork()).ldelim(),xe.wasUndone!=null&&Object.hasOwnProperty.call(xe,"wasUndone")&&ve.uint32(32).bool(xe.wasUndone),ve},be.encodeDelimited=function(xe,ve){return this.encode(xe,ve).ldelim()},be.decode=function(xe,ve){xe instanceof Te||(xe=Te.create(xe));for(var ke=ve===void 0?xe.len:xe.pos+ve,Ie=new te.MoveOperation;xe.pos<ke;){var Ae=xe.uint32();switch(Ae>>>3){case 1:Ie.sourcePosition=te.Position.decode(xe,xe.uint32());break;case 2:Ie.howMany=xe.uint32();break;case 3:Ie.targetPosition=te.Position.decode(xe,xe.uint32());break;case 4:Ie.wasUndone=xe.bool();break;default:xe.skipType(7&Ae)}}return Ie},be.decodeDelimited=function(xe){return xe instanceof Te||(xe=new Te(xe)),this.decode(xe,xe.uint32())},be.verify=function(xe){if(typeof xe!="object"||xe===null)return"object expected";var ve;return xe.sourcePosition!=null&&xe.hasOwnProperty("sourcePosition")&&(ve=te.Position.verify(xe.sourcePosition))?"sourcePosition."+ve:xe.howMany!=null&&xe.hasOwnProperty("howMany")&&!t.isInteger(xe.howMany)?"howMany: integer expected":xe.targetPosition!=null&&xe.hasOwnProperty("targetPosition")&&(ve=te.Position.verify(xe.targetPosition))?"targetPosition."+ve:xe.wasUndone!=null&&xe.hasOwnProperty("wasUndone")&&typeof xe.wasUndone!="boolean"?"wasUndone: boolean expected":null},be.fromObject=function(xe){if(xe instanceof te.MoveOperation)return xe;var ve=new te.MoveOperation;if(xe.sourcePosition!=null){if(typeof xe.sourcePosition!="object")throw TypeError(".MoveOperation.sourcePosition: object expected");ve.sourcePosition=te.Position.fromObject(xe.sourcePosition)}if(xe.howMany!=null&&(ve.howMany=xe.howMany>>>0),xe.targetPosition!=null){if(typeof xe.targetPosition!="object")throw TypeError(".MoveOperation.targetPosition: object expected");ve.targetPosition=te.Position.fromObject(xe.targetPosition)}return xe.wasUndone!=null&&(ve.wasUndone=!!xe.wasUndone),ve},be.toObject=function(xe,ve){ve||(ve={});var ke={};return ve.defaults&&(ke.sourcePosition=null,ke.howMany=0,ke.targetPosition=null,ke.wasUndone=!1),xe.sourcePosition!=null&&xe.hasOwnProperty("sourcePosition")&&(ke.sourcePosition=te.Position.toObject(xe.sourcePosition,ve)),xe.howMany!=null&&xe.hasOwnProperty("howMany")&&(ke.howMany=xe.howMany),xe.targetPosition!=null&&xe.hasOwnProperty("targetPosition")&&(ke.targetPosition=te.Position.toObject(xe.targetPosition,ve)),xe.wasUndone!=null&&xe.hasOwnProperty("wasUndone")&&(ke.wasUndone=xe.wasUndone),ke},be.prototype.toJSON=function(){return this.constructor.toObject(this,_0x462d7f.util.toJSONOptions)},be.getTypeUrl=function(xe){return xe===void 0&&(xe="type.googleapis.com"),xe+"/MoveOperation"},be}(),te.RenameOperation=function(){function be(xe){if(xe)for(var ve=Object.keys(xe),ke=0;ke<ve.length;++ke)xe[ve[ke]]!=null&&(this[ve[ke]]=xe[ve[ke]])}return be.prototype.position=null,be.prototype.oldName="",be.prototype.newName="",be.prototype.wasUndone=!1,be.create=function(xe){return new be(xe)},be.encode=function(xe,ve){return ve||(ve=we.create()),xe.position!=null&&Object.hasOwnProperty.call(xe,"position")&&te.Position.encode(xe.position,ve.uint32(10).fork()).ldelim(),xe.oldName!=null&&Object.hasOwnProperty.call(xe,"oldName")&&ve.uint32(18).string(xe.oldName),xe.newName!=null&&Object.hasOwnProperty.call(xe,"newName")&&ve.uint32(26).string(xe.newName),xe.wasUndone!=null&&Object.hasOwnProperty.call(xe,"wasUndone")&&ve.uint32(32).bool(xe.wasUndone),ve},be.encodeDelimited=function(xe,ve){return this.encode(xe,ve).ldelim()},be.decode=function(xe,ve){xe instanceof Te||(xe=Te.create(xe));for(var ke=ve===void 0?xe.len:xe.pos+ve,Ie=new te.RenameOperation;xe.pos<ke;){var Ae=xe.uint32();switch(Ae>>>3){case 1:Ie.position=te.Position.decode(xe,xe.uint32());break;case 2:Ie.oldName=xe.string();break;case 3:Ie.newName=xe.string();break;case 4:Ie.wasUndone=xe.bool();break;default:xe.skipType(7&Ae)}}return Ie},be.decodeDelimited=function(xe){return xe instanceof Te||(xe=new Te(xe)),this.decode(xe,xe.uint32())},be.verify=function(xe){if(typeof xe!="object"||xe===null)return"object expected";if(xe.position!=null&&xe.hasOwnProperty("position")){var ve=te.Position.verify(xe.position);if(ve)return"position."+ve}return xe.oldName!=null&&xe.hasOwnProperty("oldName")&&!t.isString(xe.oldName)?"oldName: string expected":xe.newName!=null&&xe.hasOwnProperty("newName")&&!t.isString(xe.newName)?"newName: string expected":xe.wasUndone!=null&&xe.hasOwnProperty("wasUndone")&&typeof xe.wasUndone!="boolean"?"wasUndone: boolean expected":null},be.fromObject=function(xe){if(xe instanceof te.RenameOperation)return xe;var ve=new te.RenameOperation;if(xe.position!=null){if(typeof xe.position!="object")throw TypeError(".RenameOperation.position: object expected");ve.position=te.Position.fromObject(xe.position)}return xe.oldName!=null&&(ve.oldName=String(xe.oldName)),xe.newName!=null&&(ve.newName=String(xe.newName)),xe.wasUndone!=null&&(ve.wasUndone=!!xe.wasUndone),ve},be.toObject=function(xe,ve){ve||(ve={});var ke={};return ve.defaults&&(ke.position=null,ke.oldName="",ke.newName="",ke.wasUndone=!1),xe.position!=null&&xe.hasOwnProperty("position")&&(ke.position=te.Position.toObject(xe.position,ve)),xe.oldName!=null&&xe.hasOwnProperty("oldName")&&(ke.oldName=xe.oldName),xe.newName!=null&&xe.hasOwnProperty("newName")&&(ke.newName=xe.newName),xe.wasUndone!=null&&xe.hasOwnProperty("wasUndone")&&(ke.wasUndone=xe.wasUndone),ke},be.prototype.toJSON=function(){return this.constructor.toObject(this,_0x462d7f.util.toJSONOptions)},be.getTypeUrl=function(xe){return xe===void 0&&(xe="type.googleapis.com"),xe+"/RenameOperation"},be}(),te.RootAttributeOperation=function(){function be(xe){if(xe)for(var ve=Object.keys(xe),ke=0;ke<ve.length;++ke)xe[ve[ke]]!=null&&(this[ve[ke]]=xe[ve[ke]])}return be.prototype.root="",be.prototype.key="",be.prototype.oldValueBoolean=!1,be.prototype.oldValueJson="",be.prototype.newValueBoolean=!1,be.prototype.newValueJson="",be.prototype.wasUndone=!1,be.create=function(xe){return new be(xe)},be.encode=function(xe,ve){return ve||(ve=we.create()),xe.root!=null&&Object.hasOwnProperty.call(xe,"root")&&ve.uint32(10).string(xe.root),xe.key!=null&&Object.hasOwnProperty.call(xe,"key")&&ve.uint32(18).string(xe.key),xe.oldValueBoolean!=null&&Object.hasOwnProperty.call(xe,"oldValueBoolean")&&ve.uint32(24).bool(xe.oldValueBoolean),xe.oldValueJson!=null&&Object.hasOwnProperty.call(xe,"oldValueJson")&&ve.uint32(34).string(xe.oldValueJson),xe.newValueBoolean!=null&&Object.hasOwnProperty.call(xe,"newValueBoolean")&&ve.uint32(40).bool(xe.newValueBoolean),xe.newValueJson!=null&&Object.hasOwnProperty.call(xe,"newValueJson")&&ve.uint32(50).string(xe.newValueJson),xe.wasUndone!=null&&Object.hasOwnProperty.call(xe,"wasUndone")&&ve.uint32(56).bool(xe.wasUndone),ve},be.encodeDelimited=function(xe,ve){return this.encode(xe,ve).ldelim()},be.decode=function(xe,ve){xe instanceof Te||(xe=Te.create(xe));for(var ke=ve===void 0?xe.len:xe.pos+ve,Ie=new te.RootAttributeOperation;xe.pos<ke;){var Ae=xe.uint32();switch(Ae>>>3){case 1:Ie.root=xe.string();break;case 2:Ie.key=xe.string();break;case 3:Ie.oldValueBoolean=xe.bool();break;case 4:Ie.oldValueJson=xe.string();break;case 5:Ie.newValueBoolean=xe.bool();break;case 6:Ie.newValueJson=xe.string();break;case 7:Ie.wasUndone=xe.bool();break;default:xe.skipType(7&Ae)}}return Ie},be.decodeDelimited=function(xe){return xe instanceof Te||(xe=new Te(xe)),this.decode(xe,xe.uint32())},be.verify=function(xe){return typeof xe!="object"||xe===null?"object expected":xe.root!=null&&xe.hasOwnProperty("root")&&!t.isString(xe.root)?"root: string expected":xe.key!=null&&xe.hasOwnProperty("key")&&!t.isString(xe.key)?"key: string expected":xe.oldValueBoolean!=null&&xe.hasOwnProperty("oldValueBoolean")&&typeof xe.oldValueBoolean!="boolean"?"oldValueBoolean: boolean expected":xe.oldValueJson!=null&&xe.hasOwnProperty("oldValueJson")&&!t.isString(xe.oldValueJson)?"oldValueJson: string expected":xe.newValueBoolean!=null&&xe.hasOwnProperty("newValueBoolean")&&typeof xe.newValueBoolean!="boolean"?"newValueBoolean: boolean expected":xe.newValueJson!=null&&xe.hasOwnProperty("newValueJson")&&!t.isString(xe.newValueJson)?"newValueJson: string expected":xe.wasUndone!=null&&xe.hasOwnProperty("wasUndone")&&typeof xe.wasUndone!="boolean"?"wasUndone: boolean expected":null},be.fromObject=function(xe){if(xe instanceof te.RootAttributeOperation)return xe;var ve=new te.RootAttributeOperation;return xe.root!=null&&(ve.root=String(xe.root)),xe.key!=null&&(ve.key=String(xe.key)),xe.oldValueBoolean!=null&&(ve.oldValueBoolean=!!xe.oldValueBoolean),xe.oldValueJson!=null&&(ve.oldValueJson=String(xe.oldValueJson)),xe.newValueBoolean!=null&&(ve.newValueBoolean=!!xe.newValueBoolean),xe.newValueJson!=null&&(ve.newValueJson=String(xe.newValueJson)),xe.wasUndone!=null&&(ve.wasUndone=!!xe.wasUndone),ve},be.toObject=function(xe,ve){ve||(ve={});var ke={};return ve.defaults&&(ke.root="",ke.key="",ke.oldValueBoolean=!1,ke.oldValueJson="",ke.newValueBoolean=!1,ke.newValueJson="",ke.wasUndone=!1),xe.root!=null&&xe.hasOwnProperty("root")&&(ke.root=xe.root),xe.key!=null&&xe.hasOwnProperty("key")&&(ke.key=xe.key),xe.oldValueBoolean!=null&&xe.hasOwnProperty("oldValueBoolean")&&(ke.oldValueBoolean=xe.oldValueBoolean),xe.oldValueJson!=null&&xe.hasOwnProperty("oldValueJson")&&(ke.oldValueJson=xe.oldValueJson),xe.newValueBoolean!=null&&xe.hasOwnProperty("newValueBoolean")&&(ke.newValueBoolean=xe.newValueBoolean),xe.newValueJson!=null&&xe.hasOwnProperty("newValueJson")&&(ke.newValueJson=xe.newValueJson),xe.wasUndone!=null&&xe.hasOwnProperty("wasUndone")&&(ke.wasUndone=xe.wasUndone),ke},be.prototype.toJSON=function(){return this.constructor.toObject(this,_0x462d7f.util.toJSONOptions)},be.getTypeUrl=function(xe){return xe===void 0&&(xe="type.googleapis.com"),xe+"/RootAttributeOperation"},be}(),te.RootOperation=function(){function be(xe){if(xe)for(var ve=Object.keys(xe),ke=0;ke<ve.length;++ke)xe[ve[ke]]!=null&&(this[ve[ke]]=xe[ve[ke]])}return be.prototype.rootName="",be.prototype.elementName="",be.prototype.isAdd=!1,be.prototype.wasUndone=!1,be.create=function(xe){return new be(xe)},be.encode=function(xe,ve){return ve||(ve=we.create()),xe.rootName!=null&&Object.hasOwnProperty.call(xe,"rootName")&&ve.uint32(10).string(xe.rootName),xe.elementName!=null&&Object.hasOwnProperty.call(xe,"elementName")&&ve.uint32(18).string(xe.elementName),xe.isAdd!=null&&Object.hasOwnProperty.call(xe,"isAdd")&&ve.uint32(24).bool(xe.isAdd),xe.wasUndone!=null&&Object.hasOwnProperty.call(xe,"wasUndone")&&ve.uint32(32).bool(xe.wasUndone),ve},be.encodeDelimited=function(xe,ve){return this.encode(xe,ve).ldelim()},be.decode=function(xe,ve){xe instanceof Te||(xe=Te.create(xe));for(var ke=ve===void 0?xe.len:xe.pos+ve,Ie=new te.RootOperation;xe.pos<ke;){var Ae=xe.uint32();switch(Ae>>>3){case 1:Ie.rootName=xe.string();break;case 2:Ie.elementName=xe.string();break;case 3:Ie.isAdd=xe.bool();break;case 4:Ie.wasUndone=xe.bool();break;default:xe.skipType(7&Ae)}}return Ie},be.decodeDelimited=function(xe){return xe instanceof Te||(xe=new Te(xe)),this.decode(xe,xe.uint32())},be.verify=function(xe){return typeof xe!="object"||xe===null?"object expected":xe.rootName!=null&&xe.hasOwnProperty("rootName")&&!t.isString(xe.rootName)?"rootName: string expected":xe.elementName!=null&&xe.hasOwnProperty("elementName")&&!t.isString(xe.elementName)?"elementName: string expected":xe.isAdd!=null&&xe.hasOwnProperty("isAdd")&&typeof xe.isAdd!="boolean"?"isAdd: boolean expected":xe.wasUndone!=null&&xe.hasOwnProperty("wasUndone")&&typeof xe.wasUndone!="boolean"?"wasUndone: boolean expected":null},be.fromObject=function(xe){if(xe instanceof te.RootOperation)return xe;var ve=new te.RootOperation;return xe.rootName!=null&&(ve.rootName=String(xe.rootName)),xe.elementName!=null&&(ve.elementName=String(xe.elementName)),xe.isAdd!=null&&(ve.isAdd=!!xe.isAdd),xe.wasUndone!=null&&(ve.wasUndone=!!xe.wasUndone),ve},be.toObject=function(xe,ve){ve||(ve={});var ke={};return ve.defaults&&(ke.rootName="",ke.elementName="",ke.isAdd=!1,ke.wasUndone=!1),xe.rootName!=null&&xe.hasOwnProperty("rootName")&&(ke.rootName=xe.rootName),xe.elementName!=null&&xe.hasOwnProperty("elementName")&&(ke.elementName=xe.elementName),xe.isAdd!=null&&xe.hasOwnProperty("isAdd")&&(ke.isAdd=xe.isAdd),xe.wasUndone!=null&&xe.hasOwnProperty("wasUndone")&&(ke.wasUndone=xe.wasUndone),ke},be.prototype.toJSON=function(){return this.constructor.toObject(this,_0x462d7f.util.toJSONOptions)},be.getTypeUrl=function(xe){return xe===void 0&&(xe="type.googleapis.com"),xe+"/RootOperation"},be}(),te.SplitOperation=function(){function be(xe){if(xe)for(var ve=Object.keys(xe),ke=0;ke<ve.length;++ke)xe[ve[ke]]!=null&&(this[ve[ke]]=xe[ve[ke]])}return be.prototype.splitPosition=null,be.prototype.graveyardPosition=null,be.prototype.howMany=0,be.prototype.insertionPosition=null,be.prototype.wasUndone=!1,be.create=function(xe){return new be(xe)},be.encode=function(xe,ve){return ve||(ve=we.create()),xe.splitPosition!=null&&Object.hasOwnProperty.call(xe,"splitPosition")&&te.Position.encode(xe.splitPosition,ve.uint32(10).fork()).ldelim(),xe.graveyardPosition!=null&&Object.hasOwnProperty.call(xe,"graveyardPosition")&&te.Position.encode(xe.graveyardPosition,ve.uint32(18).fork()).ldelim(),xe.howMany!=null&&Object.hasOwnProperty.call(xe,"howMany")&&ve.uint32(24).uint32(xe.howMany),xe.insertionPosition!=null&&Object.hasOwnProperty.call(xe,"insertionPosition")&&te.Position.encode(xe.insertionPosition,ve.uint32(34).fork()).ldelim(),xe.wasUndone!=null&&Object.hasOwnProperty.call(xe,"wasUndone")&&ve.uint32(40).bool(xe.wasUndone),ve},be.encodeDelimited=function(xe,ve){return this.encode(xe,ve).ldelim()},be.decode=function(xe,ve){xe instanceof Te||(xe=Te.create(xe));for(var ke=ve===void 0?xe.len:xe.pos+ve,Ie=new te.SplitOperation;xe.pos<ke;){var Ae=xe.uint32();switch(Ae>>>3){case 1:Ie.splitPosition=te.Position.decode(xe,xe.uint32());break;case 2:Ie.graveyardPosition=te.Position.decode(xe,xe.uint32());break;case 3:Ie.howMany=xe.uint32();break;case 4:Ie.insertionPosition=te.Position.decode(xe,xe.uint32());break;case 5:Ie.wasUndone=xe.bool();break;default:xe.skipType(7&Ae)}}return Ie},be.decodeDelimited=function(xe){return xe instanceof Te||(xe=new Te(xe)),this.decode(xe,xe.uint32())},be.verify=function(xe){if(typeof xe!="object"||xe===null)return"object expected";var ve;return xe.splitPosition!=null&&xe.hasOwnProperty("splitPosition")&&(ve=te.Position.verify(xe.splitPosition))?"splitPosition."+ve:xe.graveyardPosition!=null&&xe.hasOwnProperty("graveyardPosition")&&(ve=te.Position.verify(xe.graveyardPosition))?"graveyardPosition."+ve:xe.howMany!=null&&xe.hasOwnProperty("howMany")&&!t.isInteger(xe.howMany)?"howMany: integer expected":xe.insertionPosition!=null&&xe.hasOwnProperty("insertionPosition")&&(ve=te.Position.verify(xe.insertionPosition))?"insertionPosition."+ve:xe.wasUndone!=null&&xe.hasOwnProperty("wasUndone")&&typeof xe.wasUndone!="boolean"?"wasUndone: boolean expected":null},be.fromObject=function(xe){if(xe instanceof te.SplitOperation)return xe;var ve=new te.SplitOperation;if(xe.splitPosition!=null){if(typeof xe.splitPosition!="object")throw TypeError(".SplitOperation.splitPosition: object expected");ve.splitPosition=te.Position.fromObject(xe.splitPosition)}if(xe.graveyardPosition!=null){if(typeof xe.graveyardPosition!="object")throw TypeError(".SplitOperation.graveyardPosition: object expected");ve.graveyardPosition=te.Position.fromObject(xe.graveyardPosition)}if(xe.howMany!=null&&(ve.howMany=xe.howMany>>>0),xe.insertionPosition!=null){if(typeof xe.insertionPosition!="object")throw TypeError(".SplitOperation.insertionPosition: object expected");ve.insertionPosition=te.Position.fromObject(xe.insertionPosition)}return xe.wasUndone!=null&&(ve.wasUndone=!!xe.wasUndone),ve},be.toObject=function(xe,ve){ve||(ve={});var ke={};return ve.defaults&&(ke.splitPosition=null,ke.graveyardPosition=null,ke.howMany=0,ke.insertionPosition=null,ke.wasUndone=!1),xe.splitPosition!=null&&xe.hasOwnProperty("splitPosition")&&(ke.splitPosition=te.Position.toObject(xe.splitPosition,ve)),xe.graveyardPosition!=null&&xe.hasOwnProperty("graveyardPosition")&&(ke.graveyardPosition=te.Position.toObject(xe.graveyardPosition,ve)),xe.howMany!=null&&xe.hasOwnProperty("howMany")&&(ke.howMany=xe.howMany),xe.insertionPosition!=null&&xe.hasOwnProperty("insertionPosition")&&(ke.insertionPosition=te.Position.toObject(xe.insertionPosition,ve)),xe.wasUndone!=null&&xe.hasOwnProperty("wasUndone")&&(ke.wasUndone=xe.wasUndone),ke},be.prototype.toJSON=function(){return this.constructor.toObject(this,_0x462d7f.util.toJSONOptions)},be.getTypeUrl=function(xe){return xe===void 0&&(xe="type.googleapis.com"),xe+"/SplitOperation"},be}(),te.Position=function(){function be(xe){if(this.path=[],xe)for(var ve=Object.keys(xe),ke=0;ke<ve.length;++ke)xe[ve[ke]]!=null&&(this[ve[ke]]=xe[ve[ke]])}return be.prototype.root="",be.prototype.rootMain=!1,be.prototype.rootGraveyard=!1,be.prototype.path=t.emptyArray,be.prototype.stickiness="",be.create=function(xe){return new be(xe)},be.encode=function(xe,ve){if(ve||(ve=we.create()),xe.root!=null&&Object.hasOwnProperty.call(xe,"root")&&ve.uint32(10).string(xe.root),xe.rootMain!=null&&Object.hasOwnProperty.call(xe,"rootMain")&&ve.uint32(16).bool(xe.rootMain),xe.rootGraveyard!=null&&Object.hasOwnProperty.call(xe,"rootGraveyard")&&ve.uint32(24).bool(xe.rootGraveyard),xe.path!=null&&xe.path.length){ve.uint32(34).fork();for(var ke=0;ke<xe.path.length;++ke)ve.uint32(xe.path[ke]);ve.ldelim()}return xe.stickiness!=null&&Object.hasOwnProperty.call(xe,"stickiness")&&ve.uint32(42).string(xe.stickiness),ve},be.encodeDelimited=function(xe,ve){return this.encode(xe,ve).ldelim()},be.decode=function(xe,ve){xe instanceof Te||(xe=Te.create(xe));for(var ke=ve===void 0?xe.len:xe.pos+ve,Ie=new te.Position;xe.pos<ke;){var Ae=xe.uint32();switch(Ae>>>3){case 1:Ie.root=xe.string();break;case 2:Ie.rootMain=xe.bool();break;case 3:Ie.rootGraveyard=xe.bool();break;case 4:if(Ie.path&&Ie.path.length||(Ie.path=[]),(7&Ae)==2)for(var Se=xe.uint32()+xe.pos;xe.pos<Se;)Ie.path.push(xe.uint32());else Ie.path.push(xe.uint32());break;case 5:Ie.stickiness=xe.string();break;default:xe.skipType(7&Ae)}}return Ie},be.decodeDelimited=function(xe){return xe instanceof Te||(xe=new Te(xe)),this.decode(xe,xe.uint32())},be.verify=function(xe){if(typeof xe!="object"||xe===null)return"object expected";if(xe.root!=null&&xe.hasOwnProperty("root")&&!t.isString(xe.root))return"root: string expected";if(xe.rootMain!=null&&xe.hasOwnProperty("rootMain")&&typeof xe.rootMain!="boolean")return"rootMain: boolean expected";if(xe.rootGraveyard!=null&&xe.hasOwnProperty("rootGraveyard")&&typeof xe.rootGraveyard!="boolean")return"rootGraveyard: boolean expected";if(xe.path!=null&&xe.hasOwnProperty("path")){if(!Array.isArray(xe.path))return"path: array expected";for(var ve=0;ve<xe.path.length;++ve)if(!t.isInteger(xe.path[ve]))return"path: integer[] expected"}return xe.stickiness!=null&&xe.hasOwnProperty("stickiness")&&!t.isString(xe.stickiness)?"stickiness: string expected":null},be.fromObject=function(xe){if(xe instanceof te.Position)return xe;var ve=new te.Position;if(xe.root!=null&&(ve.root=String(xe.root)),xe.rootMain!=null&&(ve.rootMain=!!xe.rootMain),xe.rootGraveyard!=null&&(ve.rootGraveyard=!!xe.rootGraveyard),xe.path){if(!Array.isArray(xe.path))throw TypeError(".Position.path: array expected");ve.path=[];for(var ke=0;ke<xe.path.length;++ke)ve.path[ke]=xe.path[ke]>>>0}return xe.stickiness!=null&&(ve.stickiness=String(xe.stickiness)),ve},be.toObject=function(xe,ve){ve||(ve={});var ke={};if((ve.arrays||ve.defaults)&&(ke.path=[]),ve.defaults&&(ke.root="",ke.rootMain=!1,ke.rootGraveyard=!1,ke.stickiness=""),xe.root!=null&&xe.hasOwnProperty("root")&&(ke.root=xe.root),xe.rootMain!=null&&xe.hasOwnProperty("rootMain")&&(ke.rootMain=xe.rootMain),xe.rootGraveyard!=null&&xe.hasOwnProperty("rootGraveyard")&&(ke.rootGraveyard=xe.rootGraveyard),xe.path&&xe.path.length){ke.path=[];for(var Ie=0;Ie<xe.path.length;++Ie)ke.path[Ie]=xe.path[Ie]}return xe.stickiness!=null&&xe.hasOwnProperty("stickiness")&&(ke.stickiness=xe.stickiness),ke},be.prototype.toJSON=function(){return this.constructor.toObject(this,_0x462d7f.util.toJSONOptions)},be.getTypeUrl=function(xe){return xe===void 0&&(xe="type.googleapis.com"),xe+"/Position"},be}(),te.Range=function(){function be(xe){if(xe)for(var ve=Object.keys(xe),ke=0;ke<ve.length;++ke)xe[ve[ke]]!=null&&(this[ve[ke]]=xe[ve[ke]])}return be.prototype.start=null,be.prototype.end=null,be.create=function(xe){return new be(xe)},be.encode=function(xe,ve){return ve||(ve=we.create()),xe.start!=null&&Object.hasOwnProperty.call(xe,"start")&&te.Position.encode(xe.start,ve.uint32(10).fork()).ldelim(),xe.end!=null&&Object.hasOwnProperty.call(xe,"end")&&te.Position.encode(xe.end,ve.uint32(18).fork()).ldelim(),ve},be.encodeDelimited=function(xe,ve){return this.encode(xe,ve).ldelim()},be.decode=function(xe,ve){xe instanceof Te||(xe=Te.create(xe));for(var ke=ve===void 0?xe.len:xe.pos+ve,Ie=new te.Range;xe.pos<ke;){var Ae=xe.uint32();switch(Ae>>>3){case 1:Ie.start=te.Position.decode(xe,xe.uint32());break;case 2:Ie.end=te.Position.decode(xe,xe.uint32());break;default:xe.skipType(7&Ae)}}return Ie},be.decodeDelimited=function(xe){return xe instanceof Te||(xe=new Te(xe)),this.decode(xe,xe.uint32())},be.verify=function(xe){if(typeof xe!="object"||xe===null)return"object expected";var ve;return xe.start!=null&&xe.hasOwnProperty("start")&&(ve=te.Position.verify(xe.start))?"start."+ve:xe.end!=null&&xe.hasOwnProperty("end")&&(ve=te.Position.verify(xe.end))?"end."+ve:null},be.fromObject=function(xe){if(xe instanceof te.Range)return xe;var ve=new te.Range;if(xe.start!=null){if(typeof xe.start!="object")throw TypeError(".Range.start: object expected");ve.start=te.Position.fromObject(xe.start)}if(xe.end!=null){if(typeof xe.end!="object")throw TypeError(".Range.end: object expected");ve.end=te.Position.fromObject(xe.end)}return ve},be.toObject=function(xe,ve){ve||(ve={});var ke={};return ve.defaults&&(ke.start=null,ke.end=null),xe.start!=null&&xe.hasOwnProperty("start")&&(ke.start=te.Position.toObject(xe.start,ve)),xe.end!=null&&xe.hasOwnProperty("end")&&(ke.end=te.Position.toObject(xe.end,ve)),ke},be.prototype.toJSON=function(){return this.constructor.toObject(this,_0x462d7f.util.toJSONOptions)},be.getTypeUrl=function(xe){return xe===void 0&&(xe="type.googleapis.com"),xe+"/Range"},be}(),te.Element=function(){function be(xe){if(this.children=[],this.attributesBoolean={},xe)for(var ve=Object.keys(xe),ke=0;ke<ve.length;++ke)xe[ve[ke]]!=null&&(this[ve[ke]]=xe[ve[ke]])}return be.prototype.name="",be.prototype.children=t.emptyArray,be.prototype.data="",be.prototype.attributesBoolean=t.emptyObject,be.prototype.attributesJson="",be.create=function(xe){return new be(xe)},be.encode=function(xe,ve){if(ve||(ve=we.create()),xe.name!=null&&Object.hasOwnProperty.call(xe,"name")&&ve.uint32(10).string(xe.name),xe.children!=null&&xe.children.length)for(var ke=0;ke<xe.children.length;++ke)te.Element.encode(xe.children[ke],ve.uint32(18).fork()).ldelim();if(xe.data!=null&&Object.hasOwnProperty.call(xe,"data")&&ve.uint32(26).string(xe.data),xe.attributesBoolean!=null&&Object.hasOwnProperty.call(xe,"attributesBoolean")){var Ie=Object.keys(xe.attributesBoolean);for(ke=0;ke<Ie.length;++ke)ve.uint32(34).fork().uint32(10).string(Ie[ke]).uint32(16).bool(xe.attributesBoolean[Ie[ke]]).ldelim()}return xe.attributesJson!=null&&Object.hasOwnProperty.call(xe,"attributesJson")&&ve.uint32(42).string(xe.attributesJson),ve},be.encodeDelimited=function(xe,ve){return this.encode(xe,ve).ldelim()},be.decode=function(xe,ve){xe instanceof Te||(xe=Te.create(xe));for(var ke,Ie,Ae=ve===void 0?xe.len:xe.pos+ve,Se=new te.Element;xe.pos<Ae;){var Oe=xe.uint32();switch(Oe>>>3){case 1:Se.name=xe.string();break;case 2:Se.children&&Se.children.length||(Se.children=[]),Se.children.push(te.Element.decode(xe,xe.uint32()));break;case 3:Se.data=xe.string();break;case 4:Se.attributesBoolean===t.emptyObject&&(Se.attributesBoolean={});var Ve=xe.uint32()+xe.pos;for(ke="",Ie=!1;xe.pos<Ve;){var Me=xe.uint32();switch(Me>>>3){case 1:ke=xe.string();break;case 2:Ie=xe.bool();break;default:xe.skipType(7&Me)}}Se.attributesBoolean[ke]=Ie;break;case 5:Se.attributesJson=xe.string();break;default:xe.skipType(7&Oe)}}return Se},be.decodeDelimited=function(xe){return xe instanceof Te||(xe=new Te(xe)),this.decode(xe,xe.uint32())},be.verify=function(xe){if(typeof xe!="object"||xe===null)return"object expected";if(xe.name!=null&&xe.hasOwnProperty("name")&&!t.isString(xe.name))return"name: string expected";if(xe.children!=null&&xe.hasOwnProperty("children")){if(!Array.isArray(xe.children))return"children: array expected";for(var ve=0;ve<xe.children.length;++ve){var ke=te.Element.verify(xe.children[ve]);if(ke)return"children."+ke}}if(xe.data!=null&&xe.hasOwnProperty("data")&&!t.isString(xe.data))return"data: string expected";if(xe.attributesBoolean!=null&&xe.hasOwnProperty("attributesBoolean")){if(!t.isObject(xe.attributesBoolean))return"attributesBoolean: object expected";var Ie=Object.keys(xe.attributesBoolean);for(ve=0;ve<Ie.length;++ve)if(typeof xe.attributesBoolean[Ie[ve]]!="boolean")return"attributesBoolean: boolean{k:string} expected"}return xe.attributesJson!=null&&xe.hasOwnProperty("attributesJson")&&!t.isString(xe.attributesJson)?"attributesJson: string expected":null},be.fromObject=function(xe){if(xe instanceof te.Element)return xe;var ve=new te.Element;if(xe.name!=null&&(ve.name=String(xe.name)),xe.children){if(!Array.isArray(xe.children))throw TypeError(".Element.children: array expected");ve.children=[];for(var ke=0;ke<xe.children.length;++ke){if(typeof xe.children[ke]!="object")throw TypeError(".Element.children: object expected");ve.children[ke]=te.Element.fromObject(xe.children[ke])}}if(xe.data!=null&&(ve.data=String(xe.data)),xe.attributesBoolean){if(typeof xe.attributesBoolean!="object")throw TypeError(".Element.attributesBoolean: object expected");ve.attributesBoolean={};var Ie=Object.keys(xe.attributesBoolean);for(ke=0;ke<Ie.length;++ke)ve.attributesBoolean[Ie[ke]]=!!xe.attributesBoolean[Ie[ke]]}return xe.attributesJson!=null&&(ve.attributesJson=String(xe.attributesJson)),ve},be.toObject=function(xe,ve){ve||(ve={});var ke,Ie={};if((ve.arrays||ve.defaults)&&(Ie.children=[]),(ve.objects||ve.defaults)&&(Ie.attributesBoolean={}),ve.defaults&&(Ie.name="",Ie.data="",Ie.attributesJson=""),xe.name!=null&&xe.hasOwnProperty("name")&&(Ie.name=xe.name),xe.children&&xe.children.length){Ie.children=[];for(var Ae=0;Ae<xe.children.length;++Ae)Ie.children[Ae]=te.Element.toObject(xe.children[Ae],ve)}if(xe.data!=null&&xe.hasOwnProperty("data")&&(Ie.data=xe.data),xe.attributesBoolean&&(ke=Object.keys(xe.attributesBoolean)).length)for(Ie.attributesBoolean={},Ae=0;Ae<ke.length;++Ae)Ie.attributesBoolean[ke[Ae]]=xe.attributesBoolean[ke[Ae]];return xe.attributesJson!=null&&xe.hasOwnProperty("attributesJson")&&(Ie.attributesJson=xe.attributesJson),Ie},be.prototype.toJSON=function(){return this.constructor.toObject(this,_0x462d7f.util.toJSONOptions)},be.getTypeUrl=function(xe){return xe===void 0&&(xe="type.googleapis.com"),xe+"/Element"},be}(),te})();let r$3=class{constructor(){Re(this,"_protobufRoot");this._protobufRoot=u$2}getDescriptor(we){return new y$2(this._protobufRoot[we])}},y$2=class{constructor(we){Re(this,"_protobuf");this._protobuf=we}compress(we){const t=this._protobuf.verify(we);if(t)throw Error(t);return this._protobuf.encode(this._protobuf.create(we)).finish()}decompress(we){return this._protobuf.toObject(this._protobuf.decode(we),{oneofs:!0})}};function _$1(Te,we){const t=cloneDeep(Te);return t.path[t.path.length-1]+=we,t}function O$1(Te,we){return Te.root===we.root&&isEqual(Te.path,we.path)}function $$1(Te){P$1(Te,we=>(we.root=="main"?(we.rootMain=!0,delete we.root):we.root=="$graveyard"&&(we.rootGraveyard=!0,delete we.root),we))}function J$3(Te){P$1(Te,we=>(we.rootMain?(we.root="main",delete we.rootMain):we.rootGraveyard&&(we.root="$graveyard",delete we.rootGraveyard),we))}function P$1(Te,we){for(const t in Te){const te=Te[t];t!=="nodes"&&isObject$2(te)&&(te.path&&(te.root||te.rootMain||te.rootGraveyard)?Te[t]=we(te):P$1(te,we))}return Te}let e$1=class{constructor(we,t,te){Re(this,"_id");Re(this,"_operationName");Re(this,"_protobufDescriptor");this._id=we,this._operationName=t,this._protobufDescriptor=te}compress(we,t){const te=t.shift();return $$1(te),we.buffers.push(this._protobufDescriptor.compress(te)),we.types.push(this._id),!0}decompress(we,t){t.types.shift();const te=this._protobufDescriptor.decompress(t.buffers.shift());J$3(te),te.__className=this._operationName,we.push(te)}},s$3=class extends e$1{compress(we,t){const te=t.shift();return this._serializeOneOf("oldValue",te),this._serializeOneOf("newValue",te),$$1(te),we.buffers.push(this._protobufDescriptor.compress(te)),we.types.push(this._id),!0}decompress(we,t){const{types:te,buffers:be}=t,xe=this._protobufDescriptor.decompress(be.shift());te.shift(),this._deserializeOneOf("oldValue",xe),this._deserializeOneOf("newValue",xe),J$3(xe),xe.__className=this._operationName,we.push(xe)}_serializeOneOf(we,t){const te=t[we];typeof te=="boolean"?t[we+"Boolean"]=te:t[we+"Json"]=JSON.stringify(te)}_deserializeOneOf(we,t){const te=we+"Json";t[te]?(t[we]=JSON.parse(t[te]),delete t[te]):(t[we]=t[we+"Boolean"],delete t[we+"Boolean"])}},i$2=class extends e$1{compress(we,t){const te=t.shift();return this._serializeNodesAttributes(te.nodes),$$1(te),we.buffers.push(this._protobufDescriptor.compress(te)),we.types.push(this._id),!0}decompress(we,t){const{types:te,buffers:be}=t,xe=this._protobufDescriptor.decompress(be.shift());te.shift(),xe.nodes||(xe.nodes=[]),this._deserializeNodesAttributes(xe.nodes),J$3(xe),xe.__className=this._operationName,we.push(xe)}_serializeNodesAttributes(we){for(const t of we){if(t.attributes){const te=t.attributes;this._areValuesBoolean(te)?t.attributesBoolean=te:t.attributesJson=JSON.stringify(te)}t.children&&this._serializeNodesAttributes(t.children)}}_deserializeNodesAttributes(we){for(const t of we)(t.attributesBoolean||t.attributesJson)&&(t.attributesBoolean?(t.attributes=t.attributesBoolean,delete t.attributesBoolean):(t.attributes=JSON.parse(t.attributesJson),delete t.attributesJson)),t.children&&this._deserializeNodesAttributes(t.children)}_areValuesBoolean(we){return Object.keys(we).every(t=>typeof we[t]=="boolean")}},n$2=class extends e$1{decompress(we,t){super.decompress(we,t);const te=we[we.length-1];te.oldRange||(te.oldRange=null),te.newRange||(te.newRange=null)}},p$3=class extends e$1{compress(we,t){return t.shift(),we.types.push(this._id),!0}decompress(we,t){t.types.shift(),we.push({__className:this._operationName})}},a$2=class extends n$2{constructor(t,te,be,xe){super(t,te,be);Re(this,"_omittedNamespace");this._omittedNamespace=xe+":"}compress(t,te){return!(te[0].__className!="MarkerOperation"||!te[0].name.startsWith(this._omittedNamespace))&&(te[0].name=te[0].name.replace(new RegExp("^"+this._omittedNamespace),""),super.compress(t,te),!0)}decompress(t,te){super.decompress(t,te);const be=t[t.length-1];be.name=this._omittedNamespace+be.name}},b$1=class{constructor(we,t){Re(this,"_id");Re(this,"_context");this._id=we,this._context=t}compress(we,t){let te;for(;t.length>1&&this._compareOperations(t[0],t[1]);)te?(te=this._combineNext(t.shift(),te),we.types.push(0)):(te=cloneDeep(t.shift()),we.types.push(this._id));return!!te&&(te=this._combineNext(t.shift(),te),we.types.push(0),we.buffers.push(this._compressSingleOperation(te)),!0)}decompress(we,t){const te=this._decompressSingleOperation(t);for(;t.types[0]==0;)t.types.shift(),we.push(this._splitCurrent(te));we.push(te)}},m$5=class extends b$1{_combineNext(we,t){return t.nodes[0].data+=we.nodes[0].data,t}_splitCurrent(we){const t=cloneDeep(we),te=t.nodes[0],be=we.nodes[0],xe=be.data[Symbol.iterator]().next().value,ve=xe.length;return te.data=xe,be.data=be.data.substr(ve),we.position=_$1(we.position,ve),t}_compareOperations(we,t){if(this._checkOperation(we)&&this._checkOperation(t)){const te=we.nodes[0].data.length,be=O$1(_$1(we.position,te),t.position),xe=we.nodes[0],ve=t.nodes[0];return be&&this._compareAttributes(xe,ve)}return!1}_compressSingleOperation(we){const t={types:[],buffers:[],baseVersion:0};return this._context._getCompressorByName("InsertOperation").compress(t,[we]),t.buffers[0]}_decompressSingleOperation(we){const t=[];return this._context._getCompressorByName("InsertOperation").decompress(t,we),t[0]}_checkOperation(we){return we.__className=="InsertOperation"&&we.nodes.length==1&&we.nodes[0].data&&!we.wasUndone&&Array.from(we.nodes[0].data).length==1}_compareAttributes(we,t){const te=Object.keys(we.attributes||{}),be=Object.keys(t.attributes||{});return te.length===be.length&&te.every(xe=>t.attributes[xe]&&t.attributes[xe]===we.attributes[xe])}},c$3=class extends b$1{_combineNext(we,t){return t.howMany++,t.sourcePosition=cloneDeep(we.sourcePosition),t}_splitCurrent(we){const t=cloneDeep(we);return we.howMany--,t.howMany=1,t.sourcePosition=_$1(t.sourcePosition,we.howMany),t}_compareOperations(we,t){return!(!this._checkOperation(we)||!this._checkOperation(t))&&O$1(_$1(we.sourcePosition,-1),t.sourcePosition)&&O$1(we.targetPosition,t.targetPosition)}_compressSingleOperation(we){const t={types:[],buffers:[],baseVersion:0};return this._context._getCompressorByName("MoveOperation").compress(t,[we]),t.buffers[0]}_decompressSingleOperation(we){const t=[];return this._context._getCompressorByName("MoveOperation").decompress(t,we),t[0]}_checkOperation(we){return we.__className=="MoveOperation"&&we.targetPosition.root=="$graveyard"&&we.howMany==1&&!we.wasUndone}},h$1=class extends b$1{_combineNext(we,t){return t.howMany++,t}_splitCurrent(we){const t=cloneDeep(we);return t.howMany=1,we.howMany--,t}_compareOperations(we,t){return!(!this._checkOperation(we)||!this._checkOperation(t))&&O$1(we.sourcePosition,t.sourcePosition)&&O$1(we.targetPosition,t.targetPosition)}_compressSingleOperation(we){const t={types:[],buffers:[],baseVersion:0};return this._context._getCompressorByName("MoveOperation").compress(t,[we]),t.buffers[0]}_decompressSingleOperation(we){const t=[];return this._context._getCompressorByName("MoveOperation").decompress(t,we),t[0]}_checkOperation(we){return we.__className=="MoveOperation"&&we.targetPosition.root=="$graveyard"&&we.howMany==1&&!we.wasUndone}},f$3=class extends b$1{compress(we,t){if(!this._compareOperations(t[0],t[1]))return!1;const te=t.shift();return te.oldRange=null,te.newRange&&O$1(te.newRange.start,te.newRange.end)&&(te.newRange.end=null),t.shift(),we.types.push(this._id),we.types.push(0),we.buffers.push(this._compressSingleOperation(te)),!0}decompress(we,t){const te=this._decompressSingleOperation(t);te.newRange&&!te.newRange.end&&(te.newRange.end=cloneDeep(te.newRange.start));const be=cloneDeep(te);be.newRange&&(be.newRange.start.stickiness="toNone",be.newRange.end=cloneDeep(be.newRange.start)),be.name="user:position:"+be.name.split(":")[2],t.types.shift(),we.push(te),we.push(be)}_compressSingleOperation(we){const t={types:[],buffers:[],baseVersion:0};return this._context._getCompressorByName("MarkerOperation").compress(t,[we]),t.buffers[0]}_decompressSingleOperation(we){const t=[];return this._context._getCompressorByName("MarkerOperation").decompress(t,we),t[0]}_compareOperations(we,t){return!(!we||!t)&&we.__className=="MarkerOperation"&&t.__className=="MarkerOperation"&&!(!we.name.startsWith("user:")||!t.name.startsWith("user:")||we.name==t.name)}},g$1=class{constructor(){Re(this,"_compressorById");Re(this,"_compressorByName");Re(this,"_protobufFactory");this._compressorById=new Map,this._compressorByName=new Map,this._protobufFactory=new r$3;const we=this._protobufFactory.getDescriptor("MarkerOperation");this._registerCompressor(1,"NoOperation",new p$3(1,"NoOperation",void 0)),this._registerOperationCompressor(10,"AttributeOperation",s$3),this._registerOperationCompressor(11,"InsertOperation",i$2),this._registerOperationCompressor(12,"MarkerOperation",n$2),this._registerOperationCompressor(13,"MergeOperation",e$1),this._registerOperationCompressor(14,"MoveOperation",e$1),this._registerOperationCompressor(15,"RenameOperation",e$1),this._registerOperationCompressor(16,"RootAttributeOperation",s$3),this._registerOperationCompressor(17,"SplitOperation",e$1),this._registerCompressor(18,"CommentMarkerOperation",new a$2(18,"MarkerOperation",we,"comment")),this._registerCompressor(19,"SuggestionMarkerOperation",new a$2(19,"MarkerOperation",we,"suggestion")),this._registerOperationCompressor(20,"RootOperation",e$1),this._registerActionCompressor(100,"TypingAction",m$5),this._registerActionCompressor(101,"DeletingAction",c$3),this._registerActionCompressor(102,"ForwardDeletingAction",h$1),this._registerActionCompressor(103,"UserSelectionAction",f$3)}compress(we){if(!we||!we[0])throw new CKEditorError("no-operations-provided",this);const t={types:[],buffers:[],baseVersion:we[0].baseVersion};for(;we.length;)this._getCompressorByName("UserSelectionAction").compress(t,we)||this._getCompressorByName("TypingAction").compress(t,we)||this._getCompressorByName("DeletingAction").compress(t,we)||this._getCompressorByName("ForwardDeletingAction").compress(t,we)||this._getCompressorByName("CommentMarkerOperation").compress(t,we)||this._getCompressorByName("SuggestionMarkerOperation").compress(t,we)||this._getCompressorByName(we[0].__className).compress(t,we);return t}decompress(we){const t=[];for(;we.types.length;)this._compressorById.get(we.types[0]).decompress(t,we);return t.forEach((te,be)=>te.baseVersion=we.baseVersion+be),t}_getCompressorByName(we){return this._compressorByName.get(we)}_registerOperationCompressor(we,t,te){const be=new te(we,t,this._protobufFactory.getDescriptor(t));this._registerCompressor(we,t,be)}_registerActionCompressor(we,t,te){const be=new te(we,this);this._registerCompressor(we,t,be)}_registerCompressor(we,t,te){this._compressorById.set(we,te),this._compressorByName.set(t,te)}};var Ai;let c$2=(Ai=class extends ContextPlugin{constructor(t){super(t);Re(this,"connection");Re(this,"_reconnectionStack");Re(this,"_shouldPluginsReconnect");Re(this,"_domEmitter");this.set("state",WEB_SOCKET_GATEWAY_STATES.CONNECTED),this.set("_isBrowserOffline",!1),this._reconnectionStack=new Set,this._shouldPluginsReconnect=!1,this._domEmitter=Object.create(DomEmitterMixin)}static get requires(){return["CloudServices",Notification]}static get pluginName(){return"WebSocketGateway"}init(){const t=this.context,te=t.plugins.get("CloudServices"),be=t.plugins.get(Notification);if(!te.token)throw new CKEditorError("websocketgateway-missing-token",this);if(!te.webSocketUrl)throw new CKEditorError("websocketgateway-missing-websocket-url",this);return this._domEmitter.listenTo(window,"offline",()=>this._isBrowserOffline=!0),this._domEmitter.listenTo(window,"online",()=>this._isBrowserOffline=!1),this.context.config.define("cloudServices.connectionTimeout",10),this.context.config.define("cloudServices.requestTimeout",20),Ai.WebSocketGateway.connect(te.token,te.webSocketUrl,{timeout:1e3*this.context.config.get("cloudServices.connectionTimeout"),requestTimeout:1e3*this.context.config.get("cloudServices.requestTimeout")}).then(xe=>{if(this.connection=xe,this.bind("state").to(xe,"state",this,"_isBrowserOffline",(ve,ke)=>(ve!=="connected"&&(this._shouldPluginsReconnect=!0),ke||ve!==WEB_SOCKET_GATEWAY_STATES.CONNECTED?WEB_SOCKET_GATEWAY_STATES.DISCONNECTED:this.state==WEB_SOCKET_GATEWAY_STATES.DISCONNECTED&&this._shouldPluginsReconnect?(this._shouldPluginsReconnect=!1,this._reconnect(),WEB_SOCKET_GATEWAY_STATES.CONNECTING):WEB_SOCKET_GATEWAY_STATES.CONNECTED)),this.connection.on("error",(ve,ke)=>{if(ke.code!=="limitExceeded")throw console.error(ke),new CKEditorError("cloudservices-init",null,{originalError:ke});be.showWarning("The limit of maximum concurrent connections that the collaboration server can handle has been reached. Try opening the document again in a few minutes. Please contact your system administrator if the problem persists.",{title:"Connected users limit exceeded",namespace:"real-time-collaboration"})}),!xe.me)return new Promise(ve=>xe.on("change:me",ve))}).catch(xe=>{throw console.error(xe),new CKEditorError("cloudservices-init",null,{originalError:xe})})}addToReconnectionStack(t){if(typeof t.reconnect!="function")throw new CKEditorError("websocketgateway-invalid-plugin-interface",this);if(this.isInReconnectionStack(t))throw new CKEditorError("websocketgateway-plugin-already-registered",this,{name:t.constructor.pluginName});this._reconnectionStack.add(t)}removeFromReconnectionStack(t){this._reconnectionStack.delete(t)}isInReconnectionStack(t){return this._reconnectionStack.has(t)}_reconnect(){return this.connection.reconnect().then(()=>Promise.all(Array.from(this._reconnectionStack,t=>t.reconnect()))).then(()=>this.state=WEB_SOCKET_GATEWAY_STATES.CONNECTED).catch(t=>{throw console.error(t),new CKEditorError("cloudservices-reconnection-error",this.context)})}destroy(){this.connection&&this.connection.disconnect(),this.state=WEB_SOCKET_GATEWAY_STATES.DISCONNECTED,this._domEmitter.stopListening(),super.destroy()}},Re(Ai,"WebSocketGateway",WebSocketGateway),Re(Ai,"initialReconnectionInterval",1e3),Ai),r$2=class extends ContextPlugin{constructor(t){super(t);Re(this,"channelSessions");Re(this,"channelConnectedUsers");Re(this,"allConnectedUsers");Re(this,"_registeredSessions");Re(this,"_uniqueUsersCount");Re(this,"_users");this.channelSessions=new Map,this.channelConnectedUsers=new Map,this.allConnectedUsers=new Collection,this._registeredSessions=new Map,this._uniqueUsersCount=0,this._users=this.context.plugins.get(l$8)}static get pluginName(){return"Sessions"}static get requires(){return[c$2,l$8]}init(){const t=this.context.plugins.get(c$2);this.listenTo(t,"change:state",(te,be,xe)=>{if(xe!=="connected")this.channelSessions.forEach(ve=>ve.clear()),this.channelConnectedUsers.forEach(ve=>ve.clear()),this.allConnectedUsers.clear();else for(const[ve,ke]of this._registeredSessions)for(const Ie of ke)this._handleSessionAdd(ve,Ie)}),this._createUser(t.connection.me,!0)}register(t,te){if(this._registeredSessions.has(t))throw new CKEditorError("sessions-register-already-registered",null,{channelId:t});this._registeredSessions.set(t,te),this.channelSessions.set(t,new Collection),this.channelConnectedUsers.set(t,new Collection),this.listenTo(te,"add",(be,xe)=>this._handleSessionAdd(t,xe)),this.listenTo(te,"remove",(be,xe)=>this._handleSessionRemove(t,xe));for(const be of te)this._handleSessionAdd(t,be)}unregister(t){if(!this._registeredSessions.has(t))throw new CKEditorError("sessions-unregister-not-exist",null,{channelId:t});const te=this._registeredSessions.get(t);this.stopListening(te);for(const be of te)this.context.plugins.get(c$2).state==="connected"&&this._handleSessionRemove(t,be);this._registeredSessions.delete(t),this.channelSessions.delete(t),this.channelConnectedUsers.delete(t)}get mySessionId(){return this.context.plugins.get(c$2).connection.sessionId}getUserBySessionId(t){for(const te of this.channelSessions.values())for(const be of te)if(be.id===t)return be.user}getUserSessions(t,te){const be=te?[this.channelSessions.get(te)]:this.channelSessions.values(),xe=new Set;for(const ve of be)for(const ke of ve)ke.user.id===t.id&&xe.add(ke.id);return xe}getUserRole(t){for(const te of this.channelSessions.values())for(const be of te)if(be.user===t)return be.role}_handleSessionAdd(t,te){if(this.context.plugins.get(c$2).state!=="connected")return;const be=te.user,xe=this._users.getUser(be.id)||this._createUser(be),ve=Object.assign({},te,{user:xe});this.channelSessions.get(t).add(ve);const ke=this.channelConnectedUsers.get(t);ke.has(xe.id)||ke.add(xe),this.allConnectedUsers.has(xe.id)||this.allConnectedUsers.add(xe,xe.isMe?0:void 0),this.fire("sessionAdd:"+t,{channelId:t,session:ve})}_handleSessionRemove(t,te){if(this.context.plugins.get(c$2).state!=="connected")return;const be=this.channelConnectedUsers.get(t),xe=te.user;xe.id&&(this.channelSessions.get(t).remove(te.id),be.has(xe.id)&&!this.getUserSessions(xe,t).size&&be.remove(xe.id),this.allConnectedUsers.get(xe.id)&&!this.getUserSessions(xe).size&&this.allConnectedUsers.remove(xe.id))}_createUser(t,te){const be=this._users.addUser(t);return te&&this._users.defineMe(t.id),be.orderNumber=this._uniqueUsersCount++,be}},H$2=class extends Plugin{constructor(){super(...arguments);Re(this,"_domEmitter",new(DomEmitterMixin()))}static get requires(){return[r$2]}static get pluginName(){return"UserMarkers"}init(){const t=this.editor,te=t.plugins.get(r$2);t.conversion.for("editingDowncast").markerToElement({model:"user:position",view:(be,{writer:xe})=>function(ve,ke,Ie,Ae){const Se=ve.markerName.split(":")[2],Oe=Ie.getUserBySessionId(Se);if(!Oe||Se===Ie.mySessionId||!Ae.model.schema.checkChild(ve.markerRange.start,"$text"))return;const Ve={class:"ck-user__marker "+Oe.color.getMarkerClass(),"data-name":Oe.name,"data-session-id":Se},Me=Ae.model.markers.get(ve.markerName),De=Me.getStart(),Fe=De.nodeAfter,Be=Ae.model.schema;if(Fe&&Be.isObject(Fe)&&Be.isInline(Fe)&&!Ae.model.markers.get("user:range:"+Se).getRange().isCollapsed)return;const $e=De.parent;return Ae.model.schema.isLimit($e)&&!Ae.model.hasContent($e)&&(Ve.contenteditable=!1),function(Ue,He,ze){const qe=Ue.createUIElement("span",He);return Ue.setCustomProperty("userPositionMarker",!0,qe),qe.render=function(Ke){const Qe=this.toDomElement(Ke);return Qe.innerHTML='⁠<span class="ck-user__marker-line" contenteditable="false"><span class="ck-user__marker-dot"></span></span><span class="ck-user__marker-tooltip" contenteditable="false" spellcheck="false">'+ze.name+"</span>⁠",Qe.addEventListener("mouseenter",()=>{Qe.classList.add("ck-user__marker_hovered")}),Qe.addEventListener("mouseleave",()=>{Qe.classList.remove("ck-user__marker_hovered")}),Qe},qe.isSimilar=function(Ke){return!(!this.getCustomProperty("userPositionMarker")||!Ke.getCustomProperty("userPositionMarker")||this.getAttribute("data-session-id")!=Ke.getAttribute("data-session-id"))},qe}(ke,Ve,Oe)}(be,xe,te,t)}),t.conversion.for("editingDowncast").markerToHighlight({model:"user:range",view:be=>function(xe,ve){const ke=xe.markerName.split(":")[2];if(ke===ve.mySessionId)return null;const Ie=ve.getUserBySessionId(ke);return Ie?{id:ke,classes:["ck-user__selection",Ie.color.getSelectionClass()],attributes:{"data-session-id":ke},priority:2e3+Ie.orderNumber}:{id:ke,classes:[]}}(be,te)}),function(be){const xe=be.model,ve=new Map,ke=be.plugins.get(r$2);xe.markers.on("update:user:range",(Ie,Ae,Se,Oe)=>{if(!Oe&&ve.get(Ae.name))return ve.get(Ae.name).detach(),void ve.delete(Ae.name);const Ve=Ae.name.split(":")[2];if(Ve===ke.mySessionId)return;const Me="user:position:"+Ve;xe.markers.has(Me)&&be.editing.reconvertMarker(Me),Ae.on("change:range",(De,Fe,Be)=>{if(Fe.root.rootName!="$graveyard"&&Ae.getRange().root.rootName=="$graveyard"&&!ve.has(Ae.name)){const $e=xe.schema.getNearestSelectionRange(Be.deletionPosition);if($e){const Ue=LiveRange.fromRange($e);ve.set(Ae.name,Ue),Ue.on("change:range",(He,ze,qe)=>{if(Ue.root.rootName=="$graveyard"){const Ke=xe.schema.getNearestSelectionRange(qe.deletionPosition);Ke?(Ue.start=Ke.start,Ue.end=Ke.end):(ve.delete(Ae.name),Ue.detach())}})}}})}),xe.document.on("change",()=>{ve.size>0&&xe.enqueueChange({isUndoable:!1},Ie=>{for(const[Ae,Se]of ve)xe.markers.get(Ae).getRange().root.rootName=="$graveyard"&&(re(Ae.split(":")[2],Se.toRange(),xe,Ie),Se.detach());ve.clear()})})}(t),this._domEmitter.listenTo(global.document,"keydown",(be,{key:xe})=>{xe==="Escape"&&function(ve){ve.editing.view.change(ke=>{for(const Ie of ve.model.markers){if(!Ie.name.startsWith("user:position"))continue;const Ae=ve.editing.mapper.markerNameToElements(Ie.name);if(Ae)for(const Se of Ae)ke.removeClass("ck-user__marker_hovered",Se)}})}(t)},{useCapture:!0})}afterInit(){const t=this.editor,te=t.commands.get("undo");te&&t.model.on("applyOperation",(be,xe)=>{const ve=xe[0];if(ve.type!="marker"||!ve.name.startsWith("user:"))return;const ke=ve.batch;te._createdBatches.has(ke)&&(ve.newRange=ve.oldRange?t.model.createRange(ve.oldRange.start,ve.oldRange.end):null)},{priority:"highest"})}destroy(){return this._domEmitter.stopListening(),super.destroy()}createUserMarkerOperations(){const t=this.editor,te=t.model.document,be=t.plugins.get(r$2);t.model.enqueueChange({isUndoable:!1},xe=>{const ve="user:range:"+be.mySessionId,ke="user:position:"+be.mySessionId,Ie=t.model.markers.has(ve);t.editing.view.hasDomSelection?re(be.mySessionId,te.selection.getFirstRange(),t.model,xe):Ie&&(xe.removeMarker(ve),xe.removeMarker(ke))})}};function re(Te,we,t,te){const be="user:range:"+Te,xe="user:position:"+Te,ve=we.getContainedElement();let ke=we.start;ve&&ve.is("element","tableCell")&&(ke=function(Ae,Se){for(const Oe of Ae.getPositions())if(Se.schema.checkChild(Oe,"$text"))return Oe}(we,t),we=te.createRange(ke));const Ie=te.createRange(ke);t.markers.has(be)?(te.updateMarker(be,{range:we}),te.updateMarker(xe,{range:Ie})):(te.addMarker(be,{range:we,usingOperation:!0}),te.addMarker(xe,{range:Ie,usingOperation:!0}))}function q$2(Te,we,t){const te=Te.t;switch(we){case"PENDING_ACTION_SENDING_DATA":return te({string:"Sending data to the server.",id:"PENDING_ACTION_SENDING_DATA"});case"The local document and server document differ and merging them can cause unexpected behavior. To not lose your content save it locally and refresh the editor.":return te("The local document and server document differ and merging them can cause unexpected behavior. To not lose your content save it locally and refresh the editor.");case"The document cannot be connected back to the server. To not lose your content save it locally and refresh the editor.":return te("The document cannot be connected back to the server. To not lose your content save it locally and refresh the editor.");case"The document details could not be taken during the reconnection. To not lose your content save it locally and refresh the editor.":return te("The document details could not be taken during the reconnection. To not lose your content save it locally and refresh the editor.");case"The last saved version of the document does not match the local version. To not lose your content save it locally and refresh the editor.":return te("The last saved version of the document does not match the local version. To not lose your content save it locally and refresh the editor.");case"Synchronization issue":return te("Synchronization issue");case"PENDING_ACTION_REVISION_HISTORY":return te({string:"Unsaved change in revision history.",id:"PENDING_ACTION_REVISION_HISTORY"});case"CONNECTED_USERS":return te({string:"1 connected user (me)",plural:"%0 connected users",id:"CONNECTED_USERS"},t);default:return""}}let K$1=1;var Si;let l$2=(Si=class extends Plugin{constructor(t){super(t);Re(this,"_offset");Re(this,"sessionId");Re(this,"serverHistory");Re(this,"_channelId");Re(this,"_service");Re(this,"_document");Re(this,"_compressor");Re(this,"_bufferedOperations");Re(this,"_knownOperations");Re(this,"_knownRootNames");Re(this,"_pendingAction");Re(this,"_hasSelectionChanged");Re(this,"_sendBufferedOperationsDelayId");Re(this,"_baseBufferDelay");Re(this,"_currentBufferDelay");Re(this,"_lastSyncedOperationId");Re(this,"_disconnectionOperations");Re(this,"_operationIdentifier");if(this._offset=0,this.sessionId=null,this.serverHistory=new History,this.editor.config.define("collaboration",{}),this._channelId=this.editor.config.get("collaboration.channelId"),!this._channelId)throw new CKEditorError("collaboration-missing-channelid",this);const te=t.config.get("cloudServices.bundleVersion")||version;this._service=new Si.CollaborativeEditingService(te,this._channelId),this._document=this.editor.model.document,this._compressor=new g$1,this._bufferedOperations=[],this._knownOperations=new WeakSet,this._knownRootNames=new Set,this.set("_isPendingUpdate",!1),this.set("_hasSynchronizationProblem",!1),this._pendingAction=null,this._hasSelectionChanged=!1,this._sendBufferedOperationsDelayId=null,this._baseBufferDelay=300,this._currentBufferDelay=this._baseBufferDelay,this._lastSyncedOperationId=null,this._disconnectionOperations=new WeakSet,this._operationIdentifier=new X$1(this._disconnectionOperations)}static get requires(){return[c$2,r$2,H$2,PendingActions,l$8,Notification]}static get pluginName(){return"RealTimeCollaborationClient"}get cloudDocumentVersion(){return this._lastServerVersion+this._offset}get _lastServerVersion(){return this.serverHistory.version-this._offset}get lastSyncVersion(){const t=this.serverHistory.getOperations();for(let te=t.length-1;te>=0;te--){const be=t[te];if(!this._disconnectionOperations.has(be))return be.baseVersion+1-this._offset}return 0}init(){const t=this.editor,te=t.plugins.get(l$8),be=t.plugins.get(c$2);this.listenTo(te,"getOperationAuthor",(xe,ve)=>{const ke=ve[0];ke._authorId&&(xe.return=te.getUser(ke._authorId),xe.stop()),ke._authorId===null&&(xe.return=null,xe.stop())},{priority:"high"}),this.listenTo(t.model.document.selection,"change:range",(xe,ve)=>{ve.directChange&&this._refreshUserSelectionMarkers()}),this.listenTo(t.editing.view,"change:hasDomSelection",()=>{this._refreshUserSelectionMarkers()}),this._initThrowingOnDataSet(),t.model.on("applyOperation",(xe,ve)=>{const ke=ve[0];ke.isDocumentOperation&&(this._saveOperationInBuffer(ke),this._shouldSendUpdate()&&this._sendBufferedOperationsDelayed())}),this._setUpDataInit(),this.bind("_isEditingAllowed").to(be,"state",this,"_hasSynchronizationProblem",(xe,ve)=>xe==="connected"&&!ve),this.on("change:_isEditingAllowed",()=>{this._isEditingAllowed?t.disableReadOnlyMode("rtc-offline"):t.enableReadOnlyMode("rtc-offline")}),this._isEditingAllowed?t.disableReadOnlyMode("rtc-offline"):t.enableReadOnlyMode("rtc-offline"),this.set("_isConnected",!1)}async reconnect(){const t=this.editor.plugins.get(r$2),te=this.editor.plugins.get(c$2);try{this._isPendingUpdate=!0,t.unregister(this._channelId);const be=await this._service.reconnect(te.connection,this.lastSyncVersion);await this._handleReconnectionResponse(be)&&(this._isPendingUpdate=!1,this._clearPendingAction());const xe=await this._service.getConnectedSessions();t.register(this._channelId,xe),this._handleSendingSelectionMarkers(),this._isConnected=!0}catch(be){if(function(xe){return xe.code==="404"}(be)&&this.sessionId)await this._connectAfterSessionHasBeenFlushed();else if(function(xe){return xe.code==="409"}(be)){const xe=q$2(this.editor.locale,"The document cannot be connected back to the server. To not lose your content save it locally and refresh the editor.");this._handleReconnectionError(xe)}else{if(!(be instanceof J$2))throw be;this._handleReconnectionError()}}}destroy(){const t=this.editor.plugins.get(c$2),te=this.editor.plugins.get(r$2);this.editor.enableReadOnlyMode("rtc-destroyed"),te.channelSessions.has(this._channelId)&&te.unregister(this._channelId),t.removeFromReconnectionStack(this),this._disconnectService(),super.destroy()}async _handleReconnectionResponse(t){if(this.sessionId!==t.sessionId&&this._lastSyncedOperationId!==t.lastOperationId)throw new J$2;return this.sessionId=t.sessionId,this._handleServerResponse([],{...t,wereChangesApplied:!1,data:t.data},"reconnect")}async _connectService(t,te=!1){const{connection:be}=this.editor.plugins.get(c$2);Si.CollaborativeEditingService.getConnectedSessions(be,this._channelId).then(ke=>this._initSessionsHandling(ke)).catch(ke=>{this._crash("realtimecollaborationclient-init-session-connection-error",ke)}),this.listenTo(this._service,"operationsReceived",this._handleReceivedOperations.bind(this)),this.listenTo(this._service,"error",(ke,Ie)=>{this._crash("realtimecollaborationclient-initservice-internal-error",Ie)}),this.listenTo(this._service,"disconnected",()=>{this._isConnected=!1});const xe=this._operationIdentifier.getIdOfTheLastOperation(t);this._isPendingUpdate=!0;const ve=await this._service.connect(be,this._compressOperations(t),xe);if(this.sessionId=ve.sessionId,te){if(!ve.wereChangesApplied)return void this._handleReconnectionError();this._isPendingUpdate=!1,this._clearPendingAction(),this.serverHistory.reset(),this._offset=ve.offset,this.serverHistory.version=this._offset,await this._handleServerResponse(t,ve,"reconnection: flushed session")}else await this._handleInitialConnectionData(ve,t);this._handleSendingSelectionMarkers(),this._isConnected=!0}_handleSendingSelectionMarkers(){const t=this.editor.plugins.get(r$2),te=this.editor.plugins.get(H$2),be=t.channelSessions.get(this._channelId);be&&be.length>1?te.createUserMarkerOperations():this.listenTo(t,"sessionAdd:"+this._channelId,()=>{t.channelSessions.get(this._channelId).length===2&&te.createUserMarkerOperations()})}async _handleReceivedOperations(t,te,be,xe){if(!this._isPendingUpdate&&this._document.version==te){const ve=this._decompressOperations(be,xe);await this._fetchMissingUsers(ve),this._handleExternalOperations(ve,te,be.lastOperationId)||this._crash("realtimecollaborationclient-initservice-incorrect-server-operation")}}async _connectAfterSessionHasBeenFlushed(){this._disconnectService();const{locale:t}=this.editor;let te;try{te=await this._service.getDocumentDetails()}catch{const ve=q$2(t,"The document details could not be taken during the reconnection. To not lose your content save it locally and refresh the editor.");return void this._handleReconnectionError(ve)}const be=te.currentDocumentSession||te.lastDocumentSession;if(this._lastSyncedOperationId===be.lastOperationId)await this._connectService(this.editor.model.document.history.getOperations(),!0);else{const xe=q$2(t,"The last saved version of the document does not match the local version. To not lose your content save it locally and refresh the editor.");this._handleReconnectionError(xe)}}_disconnectService(){this._service.disconnect(),this._bufferedOperations=[],clearTimeout(this._sendBufferedOperationsDelayId),this.stopListening(this._service)}_initSessionsHandling(t){const te=this.editor.plugins.get(r$2);this.listenTo(te,"sessionAdd:"+this._channelId,(be,{session:xe})=>{if(xe.id===te.mySessionId){be.off();const ve=this.editor.plugins.has("CommentsOnly")&&this.editor.plugins.get("CommentsOnly");let ke=xe.permissions;ve&&ve.isEnabled&&(ke=ke.filter(Ie=>Ie!=="document:write")),this.editor.plugins.get("Permissions").setPermissions(ke,this._channelId)}}),te.register(this._channelId,t)}_initThrowingOnDataSet(){const t=this.editor.data.set;this.editor.data.set=(...te)=>{if(!te[te.length-1].suppressErrorInCollaboration)throw new CKEditorError("realtimecollaborationclient-editor-setdata-and-editor-data-set-are-forbidden-in-real-time-collaboration",this);t.apply(this.editor.data,te)}}_setUpDataInit(){this.editor.data.on("init",(t,[te])=>{if(this._document.version)throw new CKEditorError("realtimecollaborationclient-init-document-already-initialized",this);t.stop(),this._setPendingAction();const be=this.editor.config.get("rootsAttributes"),xe=this._getOperationsFromInitData(te,be);xe.length==0&&xe.push(new NoOperation(0)),t.return=this._connectService(xe).then(()=>{this.editor.plugins.get(c$2).addToReconnectionStack(this),this.editor.data.fire("ready")}).catch(ve=>this._crash("realtimecollaborationclient-init-connection-failed",ve)).finally(()=>this._clearPendingAction())},{priority:"high"}),this.editor.on("loadRoot",async(t,[te,be])=>{t.stop();const xe=this.editor.model.document.getRoot(te);if(!this._knownRootNames.has(te)){const ve=be&&be.data?be.data:"",ke=be&&be.attributes?be.attributes:{};await this._loadRoot(te,ve,ke)}this.editor.model.enqueueChange({isUndoable:!1},()=>{xe._isLoaded=!0,this.editor.model.document.differ._bufferRootLoad(xe)})},{priority:"high"})}async _fetchMissingUsers(t){const te=this.editor.plugins.get(l$8),{connection:be}=this.editor.plugins.get(c$2),xe=new Set;for(const ke of t){const Ie=ke._authorId;Ie&&!te.getUser(Ie)&&xe.add(Ie)}if(xe.size===0)return;const ve=await User.getMany(be,Array.from(xe));for(const ke of ve)te.getUser(ke.id)||te.addUser(ke)}_getOperationsFromInitData(t,te={}){const be=this.editor.model,xe=[];let ve=0;const ke=typeof t=="string"?{main:t}:t;for(const Ie of Object.keys(ke)){if(!this._document.roots.has(Ie))throw new CKEditorError("realtimecollaborationclient-init-non-existent-root",this);const Ae=this.editor.data.parse(ke[Ie]),Se=this._document.getRoot(Ie),Oe=new InsertOperation(be.createPositionAt(Se,0),Ae,ve++);xe.push(Oe);for(const[Ve,Me]of Ae.markers){const De=be.createRange(be.createPositionFromPath(Se,Me.start.path.slice()),be.createPositionFromPath(Se,Me.end.path.slice())),Fe=new MarkerOperation(Ve,null,De,be.markers,!0,ve++);xe.push(Fe)}}if(te)for(const[Ie,Ae]of Object.entries(te)){const Se=be.document.getRoot(Ie);if(!Se)throw new CKEditorError("multi-root-editor-root-attributes-no-root",null);for(const[Oe,Ve]of Object.entries(Ae))if(Ve!==null){const Me=new RootAttributeOperation(Se,Oe,null,Ve,ve++);xe.push(Me)}}return xe}async _loadRoot(t,te,be){this._getOperationsFromInitData({[t]:te},{[t]:be}).forEach((xe,ve)=>{xe.baseVersion=this._document.version+ve,xe._isInit=!0,this._saveOperationInBuffer(xe)}),this._sendBufferedOperationsDelayed(),await this._waitUntilSynced()}async _handleInitialConnectionData(t,te){let be;this._offset=t.offset;const xe=t.wereChangesApplied&&!t.initData,ve=xe?0:t.data.baseVersion;if(te.forEach(ke=>{ke._isInit=!0,ke.createdAt=t.sessionCreatedAt,ke._authorId=null}),xe)be=te,this._applyOperationsSet(be,xe);else{if(t.initData){const ke=this._getOperationsFromInitData(t.initData);this._document.history.version=-ke.length,ke.forEach(Ie=>{Ie.baseVersion-=ke.length,Ie.createdAt=t.sessionCreatedAt,Ie._isInit=!0,Ie._authorId=null}),this._applyOperationsSet(ke,!0),this.serverHistory.version=-ke.length+this._offset,this._updateServerHistory(ke)}this._document.history.version=ve,be=this._decompressOperations(t.data,t.metadata),await this._fetchMissingUsers(be),this._applyOperationsSet(be,xe)}t.lastOperationId&&(this._operationIdentifier.setIdForTheLastOperation(be,t.lastOperationId),this._lastSyncedOperationId=t.lastOperationId),this.serverHistory.version=ve+this._offset,this._updateServerHistory(be),te.filter(ke=>{const Ie=this._getAffectedRoot(ke);return Ie&&!this._knownRootNames.has(Ie)}).forEach((ke,Ie)=>{ke.baseVersion=this._document.version+Ie,this._saveOperationInBuffer(ke)}),this._shouldSendUpdate()?(this._currentBufferDelay=0,this._sendBufferedOperationsDelayed(!0),await this._waitUntilSynced()):(this._isPendingUpdate=!1,this._clearPendingAction())}_crash(t,te){throw this._isPendingUpdate=!0,te&&console.error(te),new CKEditorError(t,this.editor)}_saveOperationInBuffer(t){this._knownOperations.has(t)||(this._knownOperations.add(t),this._bufferedOperations.push(t),this._pendingAction||t.type=="marker"&&!t.affectsData||this._setPendingAction())}_sendBufferedOperationsDelayed(t=!1){!t&&this._isPendingUpdate||(this._isPendingUpdate=!0,clearTimeout(this._sendBufferedOperationsDelayId),this._sendBufferedOperationsDelayId=setTimeout(()=>{this._sendBufferedOperations().then(te=>{te&&(this._clearPendingAction(),this._isPendingUpdate=!1)}).catch(te=>{if(this._clearPendingAction(),this._isPendingUpdate=!1,!function(be){return be.message.startsWith("cloud-services-internal-error: Not connected.")||be.message.startsWith("cloud-services-internal-error: Collaborative Editing Service is not connected.")||be.message.startsWith("cloud-services-internal-error: Request timeout.")}(te))throw te})},this._currentBufferDelay))}_waitUntilSynced(){return new Promise(t=>{this.on("change:_isPendingUpdate",()=>{t()})})}async _sendBufferedOperations(){const t=this.editor.plugins.get(H$2);if(this._shouldSendSelectionUpdate()&&(t.createUserMarkerOperations(),this._hasSelectionChanged=!1),!this._shouldSendUpdate())return!0;const te=[...this._bufferedOperations];for(const Ie of te)Ie.wasUndone=this._document.history.isUndoneOperation(Ie);const be=this._operationIdentifier.getIdOfTheLastOperation(te),xe=K$1++,ve=this._compressOperations(te),ke=await this._service.sendOperations(ve,ve.baseVersion,be);try{return await this._handleServerResponse(te,ke,xe)}catch(Ie){return this._crash("realtimecollaborationclient-sendbufferedoperations",Ie)}}async _handleServerResponse(t,te,be){if("error"in te)throw te.error;let xe=!1;if(te.wereChangesApplied){te.lastOperationId&&(this._lastSyncedOperationId=te.lastOperationId),this._bufferedOperations=this._bufferedOperations.filter(ke=>!t.includes(ke));for(const ke of t)ke.createdAt="lastOperationAcceptedAt"in te&&te.lastOperationAcceptedAt||void 0;Q$1(t,te.version-t.length),this._updateServerHistory(t);const ve=t.filter(ke=>{if(!ke._isInit)return!1;const Ie=this._getAffectedRoot(ke);return Ie&&!this._knownRootNames.has(Ie)});Q$1(ve,this._document.version),this._applyOperationsSet(ve),xe=!0,this._currentBufferDelay=this._baseBufferDelay}else{const ve=this._decompressOperations(te.data,te.metadata).filter(ke=>ke.baseVersion>=this._lastServerVersion);ve.forEach(ke=>this._addKnownRoot(ke)),this._bufferedOperations=this._bufferedOperations.filter(ke=>!ke._isInit||!this._knownRootNames.has(this._getAffectedRoot(ke))),this._bufferedOperations.length&&Q$1(this._bufferedOperations,this._bufferedOperations[0].baseVersion),await this._fetchMissingUsers(ve),xe=this._handleExternalOperations(ve,te.version,te.lastOperationId),this._currentBufferDelay=Math.round(this._currentBufferDelay/2)}return xe?!this._shouldSendUpdate()||(this._sendBufferedOperationsDelayed(!0),!1):this._crash("realtimecollaborationclient-handleserverresponse")}_handleExternalOperations(t,te,be){try{const xe={document:this._document,useRelations:!1,padWithNoOps:!0},{operationsA:ve,operationsB:ke,originalOperations:Ie}=transformSets(t,this._bufferedOperations,xe);Q$1(ve,this._document.version),Q$1(ke,te);for(const Ae of ve){const Se=Ie.get(Ae);Ae._authorId=Se?Se._authorId:null}be&&(this._operationIdentifier.setIdForTheLastOperation(t,be),this._lastSyncedOperationId=be),this._bufferedOperations=[...ke],this._applyOperationsSet(ve),this._updateServerHistory(t)}catch(xe){return console.error(xe),!1}return!0}_applyOperationsSet(t,te=!1){this.editor.model.enqueueChange({isUndoable:!1,isLocal:!1},be=>{for(const xe of t)this._knownOperations.add(xe),this._addKnownRoot(xe),be.batch.addOperation(xe),this.editor.model.applyOperation(xe)})}_addKnownRoot(t){const te=this._getAffectedRoot(t);te&&this._knownRootNames.add(te)}_getAffectedRoot(t){let te,be;switch(t.type){case"insert":te=t.position.root;break;case"marker":if(be=t.newRange,!be)return null;te=be.root;break;case"addRootAttribute":te=t.root;break;case"addRoot":te=t.affectedSelectable;break;case"move":te=t.targetPosition.root;break;default:return null}return te.rootName}_updateServerHistory(t){t.forEach(te=>{const be=te.clone();be._authorId=te._authorId,be._isInit=!!te._isInit,be.createdAt=te.createdAt,be.baseVersion+=this._offset,te._isDisconnection&&this._disconnectionOperations.add(be),this.serverHistory.addOperation(be)})}_handleReconnectionError(t){const te=this.editor.plugins.get("Notification"),be=this.editor.locale;t||(t=q$2(be,"The local document and server document differ and merging them can cause unexpected behavior. To not lose your content save it locally and refresh the editor.")),te.showWarning(t,{title:q$2(be,"Synchronization issue"),namespace:"real-time-collaboration"}),this._hasSynchronizationProblem=!0,clearTimeout(this._sendBufferedOperationsDelayId),this._bufferedOperations=[],this.editor.plugins.get(c$2).destroy()}_setPendingAction(){this._pendingAction||(this._pendingAction=this.editor.plugins.get(PendingActions).add(q$2(this.editor.locale,"PENDING_ACTION_SENDING_DATA")))}_clearPendingAction(){this._pendingAction&&(this.editor.plugins.get(PendingActions).remove(this._pendingAction),this._pendingAction=null)}_compressOperations(t){const te=t.map(be=>be.toJSON());return this._compressor.compress(te)}_decompressOperations(t,te){return this._compressor.decompress(t).map((be,xe)=>{const ve=te[xe].type=="init";if(be.__className=="InsertOperation"){const Ie=be.position.root;!this._document.getRoot(Ie)&&(this._document.createRoot("$root",Ie)._isAttached=!1)}const ke=OperationFactory.fromJSON(be,this._document);return ke.wasUndone=be.wasUndone,ke._isInit=ve,ke._authorId=ve?null:te[xe].userId,ke._isDisconnection=te[xe].type==="cs:removeUser",ke.createdAt=te[xe].createdAt,ke})}_refreshUserSelectionMarkers(){this._hasSelectionChanged=!0,this._shouldSendSelectionUpdate()?this._sendBufferedOperationsDelayed():this._hasSelectionChanged=!1}_shouldSendSelectionUpdate(){const t=this.editor.plugins.get(r$2).channelSessions.get(this._channelId);return!this.editor.isReadOnly&&!!t&&t.length>1&&this._hasSelectionChanged}_shouldSendUpdate(){return this._bufferedOperations.length>0||this._shouldSendSelectionUpdate()}},Re(Si,"CollaborativeEditingService",CollaborativeEditingService),Si),J$2=class extends Error{};function Q$1(Te,we){for(const t of Te)t.baseVersion=we++}let X$1=class{constructor(we){Re(this,"_ignoredOperations");Re(this,"_operationToId");this._ignoredOperations=we,this._operationToId=new WeakMap}getIdOfTheLastOperation(we){let t=we.length;for(;t--;){const te=we[t];if(!this._ignoredOperations.has(te)){if(!this._operationToId.has(te)){const be=uid().slice(1,18);this._operationToId.set(te,be)}return this._operationToId.get(te)}}}setIdForTheLastOperation(we,t){if(!t)return;let te=we.length;for(;te--;){const be=we[te];this._ignoredOperations.has(be)||this._operationToId.set(be,t)}}},n$1=class extends Plugin{static get requires(){return[l$2]}static get pluginName(){return"RealTimeCollaborativeEditing"}};var Fi;let a$1=(Fi=class extends ContextPlugin{constructor(t){super(t);Re(this,"_services");this._services=new Map}static get requires(){return[c$2,"CommentsRepository",r$2,l$8]}static get pluginName(){return"CloudServicesCommentsAdapter"}async init(){const t=this.context,te=t.plugins.get("CommentsRepository");if(t.plugins.get(c$2).addToReconnectionStack(this),te.adapter={addCommentThread:async({channelId:be,threadId:xe,comments:ve,resolvedAt:ke,resolvedBy:Ie,context:Ae,attributes:Se})=>{const Oe=await this._getService(be).addCommentThread({commentThreadId:xe,comments:ve.map(Ve=>function(Me,De,Fe){return{commentThreadId:Fe,commentId:Me.commentId,userId:Me.authorId,content:Me.content,documentId:De,createdAt:Me.createdAt,attributes:Me.attributes||{}}}(Ve,be,xe)),resolvedAt:ke,resolvedBy:Ie,context:Ae,attributes:Se}).catch(lt$1);return{threadId:Oe.commentThreadId,comments:Oe.comments}},getCommentThread:async({channelId:be,threadId:xe})=>{const ve=await this._getService(be).getCommentThread(xe).catch(lt$1);return await this._fetchMissingUsersForThreads([ve]),{threadId:ve.commentThreadId,comments:ve.comments.map(R$2),context:ve.context,resolvedAt:ve.resolvedAt,resolvedBy:ve.resolvedBy,attributes:ve.attributes||{}}},updateCommentThread:async({channelId:be,threadId:xe,context:ve,unlinkedAt:ke,attributes:Ie})=>this._getService(be).updateCommentThread({commentThreadId:xe,context:ve,attributes:Ie,unlinkedAt:ke}).catch(F$2).catch(lt$1),resolveCommentThread:async({channelId:be,threadId:xe})=>{const ve=await this._getService(be).resolveCommentThread(xe).catch(F$2).catch(lt$1);return{threadId:ve.commentThreadId,resolvedAt:ve.resolvedAt,resolvedBy:ve.resolvedBy}},reopenCommentThread:async({channelId:be,threadId:xe})=>this._getService(be).reopenCommentThread(xe).catch(F$2).catch(lt$1),removeCommentThread:({channelId:be,threadId:xe})=>this._getService(be).removeCommentThread(xe).catch(F$2).catch(lt$1),addComment:({channelId:be,threadId:xe,commentId:ve,content:ke,attributes:Ie})=>this._getService(be).addComment(xe,ve,ke,Ie).catch(lt$1),updateComment:({channelId:be,threadId:xe,commentId:ve,content:ke,attributes:Ie})=>this._getService(be).updateComment(xe,ve,ke,Ie).catch(F$2).catch(lt$1),removeComment:({channelId:be,threadId:xe,commentId:ve})=>this._getService(be).removeComment(xe,ve).catch(F$2).catch(lt$1)},t instanceof Context){const be=t.config.get("collaboration.channelId"),xe=t.plugins.get(r$2);await this._setUpService(be);const ve=await this._services.get(be).getConnectedSessions();this.listenTo(xe,"sessionAdd:"+be,(ke,{session:Ie})=>{Ie.id===xe.mySessionId&&(ke.off(),this.context.plugins.get("Permissions").setPermissions(Ie.permissions,be))}),xe.register(be,ve)}}async _setUpService(t){if(this._services.has(t))throw new CKEditorError("cloudservicescommentsadapter-connect-already-connected",null,{channelId:t});const te=this.context.plugins.get("CommentsRepository"),be=new Fi.CommentsService(t);this._services.set(t,be),this.listenTo(be,"commentThreadAdded",(xe,ve)=>{const{commentThreadId:ke,documentId:Ie,context:Ae,attributes:Se,resolvedAt:Oe,resolvedBy:Ve,comments:Me}=ve;te.getCommentThread(ke)||te.addCommentThread({threadId:ke,channelId:Ie,comments:Me?Me.map(R$2):[],context:Ae,attributes:Se,resolvedAt:Oe,resolvedBy:Ve,isFromAdapter:!0})}),this.listenTo(be,"commentThreadUpdated",(xe,{commentThreadId:ve,documentId:ke,context:Ie,unlinkedAt:Ae,attributes:Se})=>{te.getCommentThread(ve)&&te.updateCommentThread({threadId:ve,channelId:ke,context:Ie,unlinkedAt:Ae,attributes:Se,isFromAdapter:!0})}),this.listenTo(be,"commentThreadResolved",(xe,{commentThreadId:ve,resolvedBy:ke,resolvedAt:Ie})=>{const Ae=te.getCommentThread(ve);Ae&&Ae.resolve({resolvedBy:ke,resolvedAt:Ie,isFromAdapter:!0})}),this.listenTo(be,"commentThreadReopened",(xe,{commentThreadId:ve})=>{const ke=te.getCommentThread(ve);ke&&ke.reopen({isFromAdapter:!0})}),this.listenTo(be,"commentThreadRemoved",(xe,{commentThreadId:ve})=>{const ke=te.getCommentThread(ve);ke&&ke.remove({isFromAdapter:!0})}),this.listenTo(be,"commentAdded",(xe,ve)=>{const ke=ve.commentThreadId,Ie=te.getCommentThread(ke);Ie&&Ie.addComment({...R$2(ve),isFromAdapter:!0})}),this.listenTo(be,"commentUpdated",(xe,{commentThreadId:ve,commentId:ke,content:Ie,attributes:Ae})=>{const Se=te.getCommentThread(ve);if(Se){const Oe=Se.getComment(ke);Oe&&Oe.update({content:Ie,attributes:Ae,isFromAdapter:!0})}}),this.listenTo(be,"commentRemoved",(xe,{commentThreadId:ve,commentId:ke})=>{const Ie=te.getCommentThread(ve);if(Ie){const Ae=Ie.getComment(ke);Ae&&Ae.remove({isFromAdapter:!0})}}),await this._connectService(t)}destroy(){if(this.context instanceof Context){const t=this.context.config.get("collaboration.channelId");this._terminateService(t)}}_terminateService(t){if(!this._services.has(t))throw new CKEditorError("cloudservicescommentsadapter-disconnect-not-exist",null,{channelId:t});this._getService(t).disconnect(),this._services.delete(t)}async reconnect(){for(const t of this._services.keys())await this._connectService(t);if(this.context instanceof Context){const t=this.context.config.get("collaboration.channelId"),te=this.context.plugins.get(r$2);te.unregister(t);const be=await this._services.get(t).getConnectedSessions();te.register(t,be)}}async _connectService(t){const{connection:te}=this.context.plugins.get(c$2),be=this.context.plugins.get("CommentsRepository"),xe=this._services.get(t),ve=await xe.connect(te);await this._fetchMissingUsersForThreads(ve);const ke=new Set(Array.from(be.getCommentThreads({channelId:t}),Ie=>Ie.id));for(const Ie of ve)Ie.deletedAt||ke.delete(Ie.commentThreadId);for(const Ie of ke)be.getCommentThread(Ie).remove({isFromAdapter:!0});for(const Ie of ve){let Ae=be.getCommentThread(Ie.commentThreadId);const{commentThreadId:Se,context:Oe,attributes:Ve,resolvedBy:Me,resolvedAt:De,unlinkedAt:Fe,deletedAt:Be}=Ie;if(Be)continue;Ae||(Ae=be.addCommentThread({channelId:t,threadId:Se,context:Oe,attributes:Ve||{},resolvedBy:Me,resolvedAt:De,unlinkedAt:Fe,isFromAdapter:!0}));const $e=new Set(Array.from(Ae.comments,Ue=>Ue.id));for(const Ue of Ie.comments)$e.delete(Ue.commentId);for(const Ue of $e)Ae.getComment(Ue).remove({isFromAdapter:!0});for(const Ue of Ie.comments){const He=Ae.getComment(Ue.commentId);He?He.content!==Ue.content&&He.update({content:Ue.content,isFromAdapter:!0}):Ae.addComment(Object.assign(R$2(Ue),{isFromAdapter:!0}))}}}_getService(t){if(!this._services.has(t))throw new CKEditorError("cloudservicescommentsadapter-service-not-exist",null,{channelId:t});return this._services.get(t)}async _fetchMissingUsersForThreads(t){const te=this.context.plugins.get(l$8),{connection:be}=this.context.plugins.get(c$2),xe=new Set;for(const{resolvedBy:ke,comments:Ie}of t){ke&&!te.getUser(ke)&&xe.add(ke);for(const{userId:Ae}of Ie)te.getUser(Ae)||xe.add(Ae)}if(xe.size===0)return;const ve=await User.getMany(be,Array.from(xe));for(const ke of ve)te.getUser(ke.id)||te.addUser(ke)}},Re(Fi,"CommentsService",CommentsService),Fi);async function F$2(Te){if(Te.code!=="404")throw Te}function lt$1(Te){if((we=Te).message.startsWith("cloud-services-internal-error: Comments Service is not connected.")||we.message.startsWith("cloud-services-internal-error: Not connected.")||we.message.startsWith("cloud-services-internal-error: Request timeout."))return new Promise(()=>{});var we;throw Te}function R$2(Te){return{threadId:Te.commentThreadId,commentId:Te.commentId,content:Te.content,createdAt:Te.createdAt,authorId:Te.userId,attributes:Te.attributes||{}}}const f0=class f0 extends Plugin{constructor(t){super(t);Re(this,"_bufferedRequests");Re(this,"_trackChangesService");const te=this.editor.config.get("collaboration.channelId");this._bufferedRequests=new Map,this._trackChangesService=new f0.TrackChangesService(te)}static get requires(){return[a$1,"TrackChangesEditing",c$2]}init(){const t=this.editor.plugins.get(c$2),te=this.editor.plugins.get("TrackChangesEditing");return te.adapter={getSuggestion:async be=>{await this._waitForServiceReady();const xe=await this._trackChangesService.get(be).catch(B$2);return await this._fetchMissingUsersForThreads([xe]),xe},addSuggestion:async({id:be,type:xe,data:ve,originalSuggestionId:ke,attributes:Ie})=>{await this._waitForServiceReady();const Ae={id:be,type:xe,data:ve,originalSuggestionId:ke,attributes:Ie},Se=await this._trackChangesService.add(be,xe,ve,ke,Ie).catch(Oe=>{if(ut$1(Oe))return new Promise(Ve=>{this._bufferedRequests.set(be,{resolve:Ve,suggestionData:Ae})});throw Oe});return this._bufferedRequests.delete(be),Se},updateSuggestion:async(be,xe)=>{if(await this._waitForServiceReady(),xe.state!=="open")return this._trackChangesService.update(be,xe).catch(B$2)}},this.listenTo(this._trackChangesService,"suggestionUpdated",(be,xe)=>{te.hasSuggestion(xe.id)&&(te.getSuggestion(xe.id).attributes=xe.attributes)}),this._trackChangesService.connect(t.connection).then(be=>(t.addToReconnectionStack(this),this._fetchMissingUsersForThreads(be).then(()=>{for(const xe of be)te.addSuggestionData(xe)._saved=!0})))}async reconnect(){const t=this.editor.plugins.get("TrackChangesEditing"),{connection:te}=this.editor.plugins.get(c$2),be=await this._trackChangesService.connect(te);await this._fetchMissingUsersForThreads(be);for(const{suggestionData:xe,resolve:ve}of this._bufferedRequests.values()){let ke=be.find(Ie=>Ie.id===xe.id);ke||(ke=await this._trackChangesService.add(xe.id,xe.type,xe.data,xe.originalSuggestionId)),ve(ke)}for(const xe of be)t.hasSuggestion(xe.id)||t.addSuggestionData(xe)}async _waitForServiceReady(){this._trackChangesService.isConnected||await new Promise(t=>{this.listenTo(this._trackChangesService,"connected",te=>{te.off(),t()})})}async _fetchMissingUsersForThreads(t){const te=this.editor.plugins.get(l$8),{connection:be}=this.editor.plugins.get(c$2),xe=new Set;for(const{authorId:ke}of t)te.getUser(ke)||xe.add(ke);if(xe.size===0)return;const ve=await User.getMany(be,Array.from(xe));for(const ke of ve)te.getUser(ke.id)||te.addUser(ke)}};Re(f0,"TrackChangesService",TrackChangesService);let g=f0;function B$2(Te){if(ut$1(Te))return new Promise(()=>{});throw Te}function ut$1(Te){return Te.message.startsWith("cloud-services-internal-error: Not connected.")||Te.message.startsWith("cloud-services-internal-error: Request timeout.")}let m$4=class extends Plugin{static get requires(){return["Comments",a$1,n$1,c$2]}static get pluginName(){return"RealTimeCollaborativeComments"}init(){const we=this.editor.plugins.get(c$2),t=this.editor.plugins.get("CommentsEditing"),te=this.editor.plugins.get(a$1);return this.editor.data.once("ready",()=>{this.listenTo(we,"change:state",(be,xe,ve)=>{t.isThreadsLoadingPaused=ve!=="connected"})}),this.listenTo(we,"change:state",(be,xe,ve)=>{this.editor.plugins.get("CommentsRepository").switchReadOnly(ve!=="connected")}),te._setUpService(this.editor.config.get("collaboration.channelId"))}destroy(){this.editor.plugins.get(a$1)._terminateService(this.editor.config.get("collaboration.channelId")),super.destroy()}},p$2=class extends Plugin{static get requires(){return[m$4,g,"TrackChanges"]}static get pluginName(){return"RealTimeCollaborativeTrackChanges"}};var $i;let v$2=($i=class extends Plugin{constructor(t){super(t);Re(this,"_lastRequestId");Re(this,"_revisionTracker");Re(this,"_revisionHistoryService");Re(this,"_oldOffset");const te=this.editor.config.get("collaboration.channelId");this._lastRequestId=null,this._revisionTracker=this.editor.plugins.get("RevisionTracker"),this._revisionHistoryService=new $i.RevisionHistoryService(te)}static get requires(){return[c$2,l$2,"RevisionTracker",r$2,l$8]}async init(){const t=this.editor.plugins.get(l$2),te=t.serverHistory,be=this.editor.plugins.get(c$2);this._revisionTracker.setSource({history:te,getLatestVersion:()=>this._getLatestVersion(),getCurrentRevisionId:()=>t.sessionId});const xe=this.editor.config.get("cloudServices.bundleVersion")||version,ve=await EditorService.isBundleUploaded(be.connection,xe);this._revisionTracker.adapter={getRevision:async({revisionId:Ae})=>(await this._waitForServiceReady(),await this._revisionHistoryService.getRevision(Ae)),updateRevisions:async Ae=>{await this._waitForServiceReady();const Se=this._revisionTracker.currentRevision;if(ve&&Ae.length===1&&Ae[0].id===Se.id)return Ae;for(const Oe of Ae)Oe.id===Se.id&&(Oe.isEmptyCurrent=Oe.fromVersion===Oe.toVersion);return this._revisionHistoryService.updateRevisions(Ae,this._lastRequestId).then(Oe=>(this._lastRequestId=Oe,Ae)).catch(Oe=>{if(st$2(Oe)||Oe.code==="400"&&Oe.data.wrongRequestId!==void 0){for(const Ve of Ae)!this._revisionTracker.repository.getRevision(Ve.id)||this._revisionTracker._bufferUpdate(Ve.id,Ve,!1);if(st$2(Oe))throw Oe;return Ae}throw Oe})}},this.listenTo(this._revisionHistoryService,"revisionsUpdated",(Ae,{revisionsData:Se,requestId:Oe})=>{Math.max(...Se.map(Ve=>Ve.toVersion))>this._getLatestVersionFromServerOperations()-1?this._getLatestVersion().then(()=>{this._handleRevisionsUpdate(Se,Oe)}):this._handleRevisionsUpdate(Se,Oe)});const{revisions:ke,requestId:Ie}=await this._revisionHistoryService.connect(be.connection);be.addToReconnectionStack(this),this._lastRequestId=Ie,await this._fetchMissingUsers(ke);for(const Ae of ke)this._revisionTracker.addRevisionData(Ae);this.listenTo(t,"change:_isConnected",(Ae,Se,Oe)=>{Oe&&(this._oldOffset=t._offset,Ae.off())}),this._revisionTracker.bind("isEnabled").to(be,"state",Ae=>Ae===WEB_SOCKET_GATEWAY_STATES.CONNECTED)}async reconnect(){const t=this.editor.plugins.get(c$2),te=this.editor.plugins.get(l$2),be=async()=>{const xe=this._revisionTracker.currentRevision,ve=xe.id,ke=ve!==te.sessionId;if(ke){const Se=te._offset-this._oldOffset,Oe=this._getLatestVersionFromServerOperations();if(this._revisionTracker._revisionDataBuilder.reInit(),xe.toVersion+Se!==Oe){const Ve=xe.fromVersion+Se,Me=this.editor.plugins.get(l$8),De=this._revisionTracker.buildRevisionData({revision:xe,from:Ve,to:Oe});De.id=xe.id;const Fe=De.authorsIds.map(Be=>Me.getUser(Be));xe._update({...De,authors:Fe},!0),this._revisionTracker._bufferUpdate(xe.id,De,!0)}this._revisionTracker._startingVersion=Oe,xe.toVersion===xe.fromVersion&&!this._revisionTracker._bufferedUpdates.has(ve)&&this._revisionTracker.repository._revisions.remove(ve),this._revisionTracker._createCurrentRevision(Oe)}const{revisions:Ie,requestId:Ae}=await this._revisionHistoryService.reconnect(t.connection,this._lastRequestId);ke&&Ie.length>0?te._handleReconnectionError():(await this._fetchMissingUsers(Ie),this._handleRevisionsUpdate(Ie,Ae),this._revisionTracker.sendBufferedUpdates())};return te._isConnected?be():new Promise((xe,ve)=>{te.once("change:_isConnected",()=>{be().then(xe).catch(ve)})})}destroy(){super.destroy()}async _waitForServiceReady(){this._revisionHistoryService.isConnected||await new Promise(t=>{this.listenTo(this._revisionHistoryService,"connected",te=>{te.off(),t()})})}_getLatestVersionFromServerOperations(){const t=this.editor.plugins.get(l$2).serverHistory.getOperations().reverse();for(const te of t)if(te.type!=="marker"||te.affectsData)return te.baseVersion+1}_getLatestVersion(){const t=this.editor.plugins.get(l$2);return new Promise(te=>{t._isPendingUpdate?t.once("change:_isPendingUpdate",()=>{te(this._getLatestVersionFromServerOperations())}):te(this._getLatestVersionFromServerOperations())})}_handleRevisionsUpdate(t,te){const be=this._revisionTracker.repository;this._lastRequestId=te;for(const ve of t){const ke=be.getRevision(ve.id);if(ke){if((ve.fromVersion||ve.toVersion)&&(ve.diffData=null),ke===this._revisionTracker.currentRevision){const Ie=Math.max(ke.toVersion,ve.toVersion),Ae=Math.max(ke.fromVersion,ve.fromVersion);let Se;ke.toVersion===ve.toVersion&&ke.fromVersion===ve.fromVersion?(Se=!0,this._preventResendingRevisionData(ve)):ve.toVersion===Ie&&ve.fromVersion===Ae?Se=!1:(ke.toVersion===Ie&&ke.fromVersion===Ae||this._fixRevision({revision:ke,from:Ae,to:Ie}),Se=!0),Se&&(delete ve.fromVersion,delete ve.toVersion,delete ve.diffData,delete ve.createdAt,delete ve.authorsIds)}this._revisionTracker.setRevisionData(ve),this._preventResendingRevisionData(ve)}else this._revisionTracker.addRevisionData(ve)}const xe=be.getRevisions();xe.reverse();for(let ve=0;ve<xe.length-1;ve++){const ke=xe[ve],Ie=xe[ve+1];if(ke.fromVersion<Ie.toVersion){const Ae=Ie.toVersion,Se=Math.max(Ae,ke.toVersion);this._fixRevision({revision:ke,from:Ae,to:Se})}}}_fixRevision({revision:t,from:te,to:be}={}){const xe=this.editor.plugins.get(l$8),ve=this._revisionTracker.buildRevisionData({revision:t,from:te,to:be});ve.authors=ve.authorsIds.map(ke=>xe.getUser(ke)),t._update(ve)}_preventResendingRevisionData(t){const te={};te.id=t.id;for(const be of Object.keys(t))be!=="id"&&(te[be]=void 0);this._revisionTracker._bufferUpdate(te.id,te,!0)}async _fetchMissingUsers(t){const te=this.editor.plugins.get(l$8),{connection:be}=this.editor.plugins.get(c$2),xe=new Set;for(const Ie of t){for(const Ae of Ie.authorsIds)ke(Ae);Ie.creatorId&&ke(Ie.creatorId)}if(xe.size===0)return;const ve=await User.getMany(be,Array.from(xe));for(const Ie of ve)te.getUser(Ie.id)||te.addUser(Ie);function ke(Ie){te.getUser(Ie)||xe.add(Ie)}}},Re($i,"RevisionHistoryService",RevisionHistoryService),$i);function st$2(Te){return Te.message.startsWith("cloud-services-internal-error: Revision History Service is not connected.")||Te.message.startsWith("cloud-services-internal-error: Not connected.")||Te.message.startsWith("cloud-services-internal-error: Request timeout.")}let d$4=class extends Plugin{static get requires(){return["RevisionHistory",v$2,n$1]}static get pluginName(){return"RealTimeCollaborativeRevisionHistory"}};class ts extends View{constructor(we){super(we);const t=this.bindTemplate;this.set("usersCount",0),this.set("isHidden",!0),this.setTemplate({tag:"div",attributes:{class:["ck","ck-presence-list__counter",t.if("isHidden","ck-presence-list__counter--hidden")]},children:[{text:t.to("usersCount",te=>q$2(we,"CONNECTED_USERS",te))}]})}}let rt$1=class extends View{constructor(t){super(t);Re(this,"items");this.items=this.createCollection();const te=this.bindTemplate;this.setTemplate({tag:"div",attributes:{class:["ck","ck-presence-list__list"]},children:this.items,on:{click:te.to(()=>this.fire("execute"))}})}},k$2=class extends View{constructor(t){super(t);Re(this,"counterView");Re(this,"inlineListView");const te=this.bindTemplate;this.set("isCollapsed",!0),this.counterView=new ts(this.locale),this.inlineListView=new rt$1(t),this.listenTo(this.inlineListView.items,"change",()=>{for(const be of this.inlineListView.items)be.tooltipPosition="s";this.inlineListView.items.first&&(this.inlineListView.items.first.tooltipPosition="se")}),this.setTemplate({tag:"div",attributes:{class:["ck","ck-presence-list","ck-reset","ck-rounded-corners",te.if("isCollapsed","ck-presence-list--collapsed")]},children:[this.counterView,this.inlineListView]})}},x$1=class extends View{constructor(t){super(t);Re(this,"items");this.items=this.createCollection(),this.setTemplate({tag:"div",attributes:{class:["ck","ck-presence-list__dropdown-list"]},children:[{tag:"div",attributes:{class:["ck","ck-presence-list__dropdown-list-wrapper"]},children:this.items}]})}},y$1=class extends View{constructor(t,te,be){super(t);Re(this,"userView");const xe=this.bindTemplate;this.userView=new E$4(t,te);const ve={tag:"div",attributes:{class:["ck","ck-presence-list__dropdown-list-item"]},children:[this.userView,{tag:"span",attributes:{class:["ck","ck-user__full-name"]},children:[{text:te.name}]},{tag:"span",attributes:{class:["ck","ck-presence-list__marker",te.color.getBackgroundColorClass()],"aria-hidden":"true"}}]};be&&(ve.tag="button",ve.on={click:xe.to(()=>this.fire("execute"))}),this.setTemplate(ve)}},A$1=class extends View{constructor(t,te,be){super(t);Re(this,"userView");Re(this,"markerView");const xe=this.bindTemplate;this.set("hasTooltip",!0),this.set("tooltipPosition",""),this.userView=new E$4(t,te),this.markerView=new ot$2(t,te);const ve={tag:"div",attributes:{class:["ck","ck-presence-list__list-item"],"data-cke-tooltip-text":this.userView.name,"data-cke-tooltip-position":xe.to("tooltipPosition"),"data-cke-tooltip-disabled":xe.to("hasTooltip",ke=>!ke),"data-cke-tooltip-class":"ck-presence-list__list-item__tooltip"},children:[this.userView,this.markerView]};be&&(ve.tag="button",ve.on={click:xe.to(()=>this.fire("execute"))}),this.setTemplate(ve)}},ot$2=class extends View{constructor(we,t){super(we),this.setTemplate({tag:"span",attributes:{class:["ck","ck-presence-list__marker",t.color.getBackgroundColorClass()],"aria-hidden":"true"}})}};const _={collapseAt:6,displayMe:!0};let s$2=class extends ContextPlugin{constructor(t){super(t);Re(this,"currentDisplayedUsers");Re(this,"balloonPanelView");Re(this,"view");Re(this,"presenceDropdownView");Re(this,"_bodyCollection");this.context.config.define("presenceList",_);const te=t.config.get("presenceList.collapseAt");if(typeof te!="number")throw new CKEditorError("presencelist-collapseat-invalid-format",this);if(te<1)throw new CKEditorError("presencelist-collapseat-invalid-format",this);this._allConnectedUsers=this.context.plugins.get(r$2).allConnectedUsers,this.set("usersCount",0),this.currentDisplayedUsers=new Collection,this.balloonPanelView=new BalloonPanelView,this.balloonPanelView.class="ck ck-presence-list__balloon",this.view=this._createView(),this.presenceDropdownView=void 0}static get requires(){return[r$2]}init(){for(const t of this._allConnectedUsers)this._handleUserAdd(t);this.listenTo(this._allConnectedUsers,"add",(t,te)=>{this._handleUserAdd(te)}),this.listenTo(this._allConnectedUsers,"remove",(t,te)=>{this._handleUserRemove(te)})}_createView(){const t=this.context,te=new k$2(this.context.locale),be=this.balloonPanelView;if(!isElement$1(t.config.get("presenceList.container")))throw new CKEditorError("presencelist-missing-container",this);return te.counterView.bind("usersCount").to(this),te.bind("isCollapsed").to(this,"usersCount",xe=>{const{collapseAt:ve,displayMe:ke}=t.config.get("presenceList"),Ie=xe>=ve;return te.counterView.isHidden=!(xe==1&&ke||Ie),Ie||this.hideDropdown(),Ie}),te.inlineListView.items.bindTo(this.currentDisplayedUsers).using(xe=>{const ve=t.config.get("presenceList"),ke=new A$1(t.locale,xe,!!ve.onClick);return ke.bind("hasTooltip").to(te,"isCollapsed",Ie=>!Ie),ve.onClick&&this.listenTo(ke,"execute",()=>{this.view.isCollapsed||ve.onClick(xe,ke.element)}),ke}),this.listenTo(te.inlineListView,"execute",()=>{this.presenceDropdownView?this.hideDropdown():this.view.isCollapsed&&this.showDropdown()}),te.render(),be.render(),clickOutsideHandler({emitter:te,activator:()=>be.isVisible,contextElements:[be.element,te.inlineListView.element],callback:()=>this.hideDropdown()}),t.config.get("presenceList.container").appendChild(te.element),this._bodyCollection=new BodyCollection(this.context.locale),this._bodyCollection.attachToDom(),this._bodyCollection.add(be),te}_handleUserAdd(t){if(!this.context.config.get("presenceList.displayMe")&&t.isMe)return;const te=this.context.config.get("presenceList.collapseAt")-1;this.usersCount++,this.currentDisplayedUsers.length==te&&this.currentDisplayedUsers.remove(0);const be=this._calculateNewUserPosition(t);this.currentDisplayedUsers.add(t,be)}_handleUserRemove(t){if(this.usersCount--,this.currentDisplayedUsers.get(t.id)&&(this.currentDisplayedUsers.remove(t.id),this.currentDisplayedUsers.length<this.usersCount)){for(const te of Array.from(this._allConnectedUsers).reverse())if(!this.currentDisplayedUsers.get(te.id))return void this.currentDisplayedUsers.add(te,0)}}_calculateNewUserPosition(t){return this.currentDisplayedUsers.last&&this.currentDisplayedUsers.last.isMe&&!t.isMe?this.currentDisplayedUsers.length-1:this.currentDisplayedUsers.length}showDropdown(){if(this.presenceDropdownView)return;this.presenceDropdownView=new x$1(this.context.locale);const t=this.context.config.get("presenceList");this.presenceDropdownView.items.bindTo(this._allConnectedUsers).using(te=>{if(!t.displayMe&&te.isMe)return null;const be=new y$1(this.context.locale,te,!!t.onClick);return t.onClick&&this.listenTo(be,"execute",()=>{t.onClick(te,be.element)}),be}),this.balloonPanelView.content.add(this.presenceDropdownView),this.balloonPanelView.pin({target:this.view.inlineListView.element})}hideDropdown(){this.presenceDropdownView&&(this.balloonPanelView.unpin(),this.balloonPanelView.content.remove(this.presenceDropdownView),this.presenceDropdownView.destroy(),this.presenceDropdownView=void 0)}destroy(){super.destroy(),this.view&&this.view.isRendered&&this.view.destroy(),this._bodyCollection&&this._bodyCollection.detachFromDom()}},i$1=class extends ContextPlugin{static get requires(){return[r$2,s$2]}static get pluginName(){return"PresenceList"}};class LuxonError extends Error{}class InvalidDateTimeError extends LuxonError{constructor(we){super(`Invalid DateTime: ${we.toMessage()}`)}}class InvalidIntervalError extends LuxonError{constructor(we){super(`Invalid Interval: ${we.toMessage()}`)}}class InvalidDurationError extends LuxonError{constructor(we){super(`Invalid Duration: ${we.toMessage()}`)}}class ConflictingSpecificationError extends LuxonError{}class InvalidUnitError extends LuxonError{constructor(we){super(`Invalid unit ${we}`)}}class InvalidArgumentError extends LuxonError{}class ZoneIsAbstractError extends LuxonError{constructor(){super("Zone is an abstract class")}}const n="numeric",s$1="short",l$1="long",DATE_SHORT={year:n,month:n,day:n},DATE_MED={year:n,month:s$1,day:n},DATE_MED_WITH_WEEKDAY={year:n,month:s$1,day:n,weekday:s$1},DATE_FULL={year:n,month:l$1,day:n},DATE_HUGE={year:n,month:l$1,day:n,weekday:l$1},TIME_SIMPLE={hour:n,minute:n},TIME_WITH_SECONDS={hour:n,minute:n,second:n},TIME_WITH_SHORT_OFFSET={hour:n,minute:n,second:n,timeZoneName:s$1},TIME_WITH_LONG_OFFSET={hour:n,minute:n,second:n,timeZoneName:l$1},TIME_24_SIMPLE={hour:n,minute:n,hour12:!1},TIME_24_WITH_SECONDS={hour:n,minute:n,second:n,hour12:!1},TIME_24_WITH_SHORT_OFFSET={hour:n,minute:n,second:n,hour12:!1,timeZoneName:s$1},TIME_24_WITH_LONG_OFFSET={hour:n,minute:n,second:n,hour12:!1,timeZoneName:l$1},DATETIME_SHORT={year:n,month:n,day:n,hour:n,minute:n},DATETIME_SHORT_WITH_SECONDS={year:n,month:n,day:n,hour:n,minute:n,second:n},DATETIME_MED={year:n,month:s$1,day:n,hour:n,minute:n},DATETIME_MED_WITH_SECONDS={year:n,month:s$1,day:n,hour:n,minute:n,second:n},DATETIME_MED_WITH_WEEKDAY={year:n,month:s$1,day:n,weekday:s$1,hour:n,minute:n},DATETIME_FULL={year:n,month:l$1,day:n,hour:n,minute:n,timeZoneName:s$1},DATETIME_FULL_WITH_SECONDS={year:n,month:l$1,day:n,hour:n,minute:n,second:n,timeZoneName:s$1},DATETIME_HUGE={year:n,month:l$1,day:n,weekday:l$1,hour:n,minute:n,timeZoneName:l$1},DATETIME_HUGE_WITH_SECONDS={year:n,month:l$1,day:n,weekday:l$1,hour:n,minute:n,second:n,timeZoneName:l$1};function isUndefined(Te){return typeof Te>"u"}function isNumber(Te){return typeof Te=="number"}function isInteger(Te){return typeof Te=="number"&&Te%1===0}function isString(Te){return typeof Te=="string"}function isDate(Te){return Object.prototype.toString.call(Te)==="[object Date]"}function hasIntl(){try{return typeof Intl<"u"&&Intl.DateTimeFormat}catch{return!1}}function hasFormatToParts(){return!isUndefined(Intl.DateTimeFormat.prototype.formatToParts)}function hasRelative(){try{return typeof Intl<"u"&&!!Intl.RelativeTimeFormat}catch{return!1}}function maybeArray(Te){return Array.isArray(Te)?Te:[Te]}function bestBy(Te,we,t){if(Te.length!==0)return Te.reduce((te,be)=>{const xe=[we(be),be];return te&&t(te[0],xe[0])===te[0]?te:xe},null)[1]}function pick(Te,we){return we.reduce((t,te)=>(t[te]=Te[te],t),{})}function hasOwnProperty(Te,we){return Object.prototype.hasOwnProperty.call(Te,we)}function integerBetween(Te,we,t){return isInteger(Te)&&Te>=we&&Te<=t}function floorMod(Te,we){return Te-we*Math.floor(Te/we)}function padStart(Te,we=2){const t=Te<0?"-":"",te=t?Te*-1:Te;let be;return te.toString().length<we?be=("0".repeat(we)+te).slice(-we):be=te.toString(),`${t}${be}`}function parseInteger(Te){if(!(isUndefined(Te)||Te===null||Te===""))return parseInt(Te,10)}function parseMillis(Te){if(!(isUndefined(Te)||Te===null||Te==="")){const we=parseFloat("0."+Te)*1e3;return Math.floor(we)}}function roundTo(Te,we,t=!1){const te=10**we;return(t?Math.trunc:Math.round)(Te*te)/te}function isLeapYear(Te){return Te%4===0&&(Te%100!==0||Te%400===0)}function daysInYear(Te){return isLeapYear(Te)?366:365}function daysInMonth(Te,we){const t=floorMod(we-1,12)+1,te=Te+(we-t)/12;return t===2?isLeapYear(te)?29:28:[31,null,31,30,31,30,31,31,30,31,30,31][t-1]}function objToLocalTS(Te){let we=Date.UTC(Te.year,Te.month-1,Te.day,Te.hour,Te.minute,Te.second,Te.millisecond);return Te.year<100&&Te.year>=0&&(we=new Date(we),we.setUTCFullYear(we.getUTCFullYear()-1900)),+we}function weeksInWeekYear(Te){const we=(Te+Math.floor(Te/4)-Math.floor(Te/100)+Math.floor(Te/400))%7,t=Te-1,te=(t+Math.floor(t/4)-Math.floor(t/100)+Math.floor(t/400))%7;return we===4||te===3?53:52}function untruncateYear(Te){return Te>99?Te:Te>60?1900+Te:2e3+Te}function parseZoneInfo(Te,we,t,te=null){const be=new Date(Te),xe={hour12:!1,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"};te&&(xe.timeZone=te);const ve=Object.assign({timeZoneName:we},xe),ke=hasIntl();if(ke&&hasFormatToParts()){const Ie=new Intl.DateTimeFormat(t,ve).formatToParts(be).find(Ae=>Ae.type.toLowerCase()==="timezonename");return Ie?Ie.value:null}else if(ke){const Ie=new Intl.DateTimeFormat(t,xe).format(be);return new Intl.DateTimeFormat(t,ve).format(be).substring(Ie.length).replace(/^[, \u200e]+/,"")}else return null}function signedOffset(Te,we){let t=parseInt(Te,10);Number.isNaN(t)&&(t=0);const te=parseInt(we,10)||0,be=t<0||Object.is(t,-0)?-te:te;return t*60+be}function asNumber(Te){const we=Number(Te);if(typeof Te=="boolean"||Te===""||Number.isNaN(we))throw new InvalidArgumentError(`Invalid unit value ${Te}`);return we}function normalizeObject(Te,we,t){const te={};for(const be in Te)if(hasOwnProperty(Te,be)){if(t.indexOf(be)>=0)continue;const xe=Te[be];if(xe==null)continue;te[we(be)]=asNumber(xe)}return te}function formatOffset(Te,we){const t=Math.trunc(Math.abs(Te/60)),te=Math.trunc(Math.abs(Te%60)),be=Te>=0?"+":"-";switch(we){case"short":return`${be}${padStart(t,2)}:${padStart(te,2)}`;case"narrow":return`${be}${t}${te>0?`:${te}`:""}`;case"techie":return`${be}${padStart(t,2)}${padStart(te,2)}`;default:throw new RangeError(`Value format ${we} is out of range for property format`)}}function timeObject(Te){return pick(Te,["hour","minute","second","millisecond"])}const ianaRegex=/[A-Za-z_+-]{1,256}(:?\/[A-Za-z_+-]{1,256}(\/[A-Za-z_+-]{1,256})?)?/;function stringify(Te){return JSON.stringify(Te,Object.keys(Te).sort())}const monthsLong=["January","February","March","April","May","June","July","August","September","October","November","December"],monthsShort=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],monthsNarrow=["J","F","M","A","M","J","J","A","S","O","N","D"];function months(Te){switch(Te){case"narrow":return[...monthsNarrow];case"short":return[...monthsShort];case"long":return[...monthsLong];case"numeric":return["1","2","3","4","5","6","7","8","9","10","11","12"];case"2-digit":return["01","02","03","04","05","06","07","08","09","10","11","12"];default:return null}}const weekdaysLong=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],weekdaysShort=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],weekdaysNarrow=["M","T","W","T","F","S","S"];function weekdays(Te){switch(Te){case"narrow":return[...weekdaysNarrow];case"short":return[...weekdaysShort];case"long":return[...weekdaysLong];case"numeric":return["1","2","3","4","5","6","7"];default:return null}}const meridiems=["AM","PM"],erasLong=["Before Christ","Anno Domini"],erasShort=["BC","AD"],erasNarrow=["B","A"];function eras(Te){switch(Te){case"narrow":return[...erasNarrow];case"short":return[...erasShort];case"long":return[...erasLong];default:return null}}function meridiemForDateTime(Te){return meridiems[Te.hour<12?0:1]}function weekdayForDateTime(Te,we){return weekdays(we)[Te.weekday-1]}function monthForDateTime(Te,we){return months(we)[Te.month-1]}function eraForDateTime(Te,we){return eras(we)[Te.year<0?0:1]}function formatRelativeTime(Te,we,t="always",te=!1){const be={years:["year","yr."],quarters:["quarter","qtr."],months:["month","mo."],weeks:["week","wk."],days:["day","day","days"],hours:["hour","hr."],minutes:["minute","min."],seconds:["second","sec."]},xe=["hours","minutes","seconds"].indexOf(Te)===-1;if(t==="auto"&&xe){const Oe=Te==="days";switch(we){case 1:return Oe?"tomorrow":`next ${be[Te][0]}`;case-1:return Oe?"yesterday":`last ${be[Te][0]}`;case 0:return Oe?"today":`this ${be[Te][0]}`}}const ve=Object.is(we,-0)||we<0,ke=Math.abs(we),Ie=ke===1,Ae=be[Te],Se=te?Ie?Ae[1]:Ae[2]||Ae[1]:Ie?be[Te][0]:Te;return ve?`${ke} ${Se} ago`:`in ${ke} ${Se}`}function formatString(Te){const we=pick(Te,["weekday","era","year","month","day","hour","minute","second","timeZoneName","hour12"]),t=stringify(we),te="EEEE, LLLL d, yyyy, h:mm a";switch(t){case stringify(DATE_SHORT):return"M/d/yyyy";case stringify(DATE_MED):return"LLL d, yyyy";case stringify(DATE_MED_WITH_WEEKDAY):return"EEE, LLL d, yyyy";case stringify(DATE_FULL):return"LLLL d, yyyy";case stringify(DATE_HUGE):return"EEEE, LLLL d, yyyy";case stringify(TIME_SIMPLE):return"h:mm a";case stringify(TIME_WITH_SECONDS):return"h:mm:ss a";case stringify(TIME_WITH_SHORT_OFFSET):return"h:mm a";case stringify(TIME_WITH_LONG_OFFSET):return"h:mm a";case stringify(TIME_24_SIMPLE):return"HH:mm";case stringify(TIME_24_WITH_SECONDS):return"HH:mm:ss";case stringify(TIME_24_WITH_SHORT_OFFSET):return"HH:mm";case stringify(TIME_24_WITH_LONG_OFFSET):return"HH:mm";case stringify(DATETIME_SHORT):return"M/d/yyyy, h:mm a";case stringify(DATETIME_MED):return"LLL d, yyyy, h:mm a";case stringify(DATETIME_FULL):return"LLLL d, yyyy, h:mm a";case stringify(DATETIME_HUGE):return te;case stringify(DATETIME_SHORT_WITH_SECONDS):return"M/d/yyyy, h:mm:ss a";case stringify(DATETIME_MED_WITH_SECONDS):return"LLL d, yyyy, h:mm:ss a";case stringify(DATETIME_MED_WITH_WEEKDAY):return"EEE, d LLL yyyy, h:mm a";case stringify(DATETIME_FULL_WITH_SECONDS):return"LLLL d, yyyy, h:mm:ss a";case stringify(DATETIME_HUGE_WITH_SECONDS):return"EEEE, LLLL d, yyyy, h:mm:ss a";default:return te}}function stringifyTokens(Te,we){let t="";for(const te of Te)te.literal?t+=te.val:t+=we(te.val);return t}const macroTokenToFormatOpts={D:DATE_SHORT,DD:DATE_MED,DDD:DATE_FULL,DDDD:DATE_HUGE,t:TIME_SIMPLE,tt:TIME_WITH_SECONDS,ttt:TIME_WITH_SHORT_OFFSET,tttt:TIME_WITH_LONG_OFFSET,T:TIME_24_SIMPLE,TT:TIME_24_WITH_SECONDS,TTT:TIME_24_WITH_SHORT_OFFSET,TTTT:TIME_24_WITH_LONG_OFFSET,f:DATETIME_SHORT,ff:DATETIME_MED,fff:DATETIME_FULL,ffff:DATETIME_HUGE,F:DATETIME_SHORT_WITH_SECONDS,FF:DATETIME_MED_WITH_SECONDS,FFF:DATETIME_FULL_WITH_SECONDS,FFFF:DATETIME_HUGE_WITH_SECONDS};class Formatter{static create(we,t={}){return new Formatter(we,t)}static parseFormat(we){let t=null,te="",be=!1;const xe=[];for(let ve=0;ve<we.length;ve++){const ke=we.charAt(ve);ke==="'"?(te.length>0&&xe.push({literal:be,val:te}),t=null,te="",be=!be):be||ke===t?te+=ke:(te.length>0&&xe.push({literal:!1,val:te}),te=ke,t=ke)}return te.length>0&&xe.push({literal:be,val:te}),xe}static macroTokenToFormatOpts(we){return macroTokenToFormatOpts[we]}constructor(we,t){this.opts=t,this.loc=we,this.systemLoc=null}formatWithSystemDefault(we,t){return this.systemLoc===null&&(this.systemLoc=this.loc.redefaultToSystem()),this.systemLoc.dtFormatter(we,Object.assign({},this.opts,t)).format()}formatDateTime(we,t={}){return this.loc.dtFormatter(we,Object.assign({},this.opts,t)).format()}formatDateTimeParts(we,t={}){return this.loc.dtFormatter(we,Object.assign({},this.opts,t)).formatToParts()}resolvedOptions(we,t={}){return this.loc.dtFormatter(we,Object.assign({},this.opts,t)).resolvedOptions()}num(we,t=0){if(this.opts.forceSimple)return padStart(we,t);const te=Object.assign({},this.opts);return t>0&&(te.padTo=t),this.loc.numberFormatter(te).format(we)}formatDateTimeFromString(we,t){const te=this.loc.listingMode()==="en",be=this.loc.outputCalendar&&this.loc.outputCalendar!=="gregory"&&hasFormatToParts(),xe=(Me,De)=>this.loc.extract(we,Me,De),ve=Me=>we.isOffsetFixed&&we.offset===0&&Me.allowZ?"Z":we.isValid?we.zone.formatOffset(we.ts,Me.format):"",ke=()=>te?meridiemForDateTime(we):xe({hour:"numeric",hour12:!0},"dayperiod"),Ie=(Me,De)=>te?monthForDateTime(we,Me):xe(De?{month:Me}:{month:Me,day:"numeric"},"month"),Ae=(Me,De)=>te?weekdayForDateTime(we,Me):xe(De?{weekday:Me}:{weekday:Me,month:"long",day:"numeric"},"weekday"),Se=Me=>{const De=Formatter.macroTokenToFormatOpts(Me);return De?this.formatWithSystemDefault(we,De):Me},Oe=Me=>te?eraForDateTime(we,Me):xe({era:Me},"era"),Ve=Me=>{switch(Me){case"S":return this.num(we.millisecond);case"u":case"SSS":return this.num(we.millisecond,3);case"s":return this.num(we.second);case"ss":return this.num(we.second,2);case"m":return this.num(we.minute);case"mm":return this.num(we.minute,2);case"h":return this.num(we.hour%12===0?12:we.hour%12);case"hh":return this.num(we.hour%12===0?12:we.hour%12,2);case"H":return this.num(we.hour);case"HH":return this.num(we.hour,2);case"Z":return ve({format:"narrow",allowZ:this.opts.allowZ});case"ZZ":return ve({format:"short",allowZ:this.opts.allowZ});case"ZZZ":return ve({format:"techie",allowZ:this.opts.allowZ});case"ZZZZ":return we.zone.offsetName(we.ts,{format:"short",locale:this.loc.locale});case"ZZZZZ":return we.zone.offsetName(we.ts,{format:"long",locale:this.loc.locale});case"z":return we.zoneName;case"a":return ke();case"d":return be?xe({day:"numeric"},"day"):this.num(we.day);case"dd":return be?xe({day:"2-digit"},"day"):this.num(we.day,2);case"c":return this.num(we.weekday);case"ccc":return Ae("short",!0);case"cccc":return Ae("long",!0);case"ccccc":return Ae("narrow",!0);case"E":return this.num(we.weekday);case"EEE":return Ae("short",!1);case"EEEE":return Ae("long",!1);case"EEEEE":return Ae("narrow",!1);case"L":return be?xe({month:"numeric",day:"numeric"},"month"):this.num(we.month);case"LL":return be?xe({month:"2-digit",day:"numeric"},"month"):this.num(we.month,2);case"LLL":return Ie("short",!0);case"LLLL":return Ie("long",!0);case"LLLLL":return Ie("narrow",!0);case"M":return be?xe({month:"numeric"},"month"):this.num(we.month);case"MM":return be?xe({month:"2-digit"},"month"):this.num(we.month,2);case"MMM":return Ie("short",!1);case"MMMM":return Ie("long",!1);case"MMMMM":return Ie("narrow",!1);case"y":return be?xe({year:"numeric"},"year"):this.num(we.year);case"yy":return be?xe({year:"2-digit"},"year"):this.num(we.year.toString().slice(-2),2);case"yyyy":return be?xe({year:"numeric"},"year"):this.num(we.year,4);case"yyyyyy":return be?xe({year:"numeric"},"year"):this.num(we.year,6);case"G":return Oe("short");case"GG":return Oe("long");case"GGGGG":return Oe("narrow");case"kk":return this.num(we.weekYear.toString().slice(-2),2);case"kkkk":return this.num(we.weekYear,4);case"W":return this.num(we.weekNumber);case"WW":return this.num(we.weekNumber,2);case"o":return this.num(we.ordinal);case"ooo":return this.num(we.ordinal,3);case"q":return this.num(we.quarter);case"qq":return this.num(we.quarter,2);case"X":return this.num(Math.floor(we.ts/1e3));case"x":return this.num(we.ts);default:return Se(Me)}};return stringifyTokens(Formatter.parseFormat(t),Ve)}formatDurationFromString(we,t){const te=Ie=>{switch(Ie[0]){case"S":return"millisecond";case"s":return"second";case"m":return"minute";case"h":return"hour";case"d":return"day";case"M":return"month";case"y":return"year";default:return null}},be=Ie=>Ae=>{const Se=te(Ae);return Se?this.num(Ie.get(Se),Ae.length):Ae},xe=Formatter.parseFormat(t),ve=xe.reduce((Ie,{literal:Ae,val:Se})=>Ae?Ie:Ie.concat(Se),[]),ke=we.shiftTo(...ve.map(te).filter(Ie=>Ie));return stringifyTokens(xe,be(ke))}}class Invalid{constructor(we,t){this.reason=we,this.explanation=t}toMessage(){return this.explanation?`${this.reason}: ${this.explanation}`:this.reason}}class Zone{get type(){throw new ZoneIsAbstractError}get name(){throw new ZoneIsAbstractError}get universal(){throw new ZoneIsAbstractError}offsetName(we,t){throw new ZoneIsAbstractError}formatOffset(we,t){throw new ZoneIsAbstractError}offset(we){throw new ZoneIsAbstractError}equals(we){throw new ZoneIsAbstractError}get isValid(){throw new ZoneIsAbstractError}}let singleton$1=null;class LocalZone extends Zone{static get instance(){return singleton$1===null&&(singleton$1=new LocalZone),singleton$1}get type(){return"local"}get name(){return hasIntl()?new Intl.DateTimeFormat().resolvedOptions().timeZone:"local"}get universal(){return!1}offsetName(we,{format:t,locale:te}){return parseZoneInfo(we,t,te)}formatOffset(we,t){return formatOffset(this.offset(we),t)}offset(we){return-new Date(we).getTimezoneOffset()}equals(we){return we.type==="local"}get isValid(){return!0}}const matchingRegex=RegExp(`^${ianaRegex.source}$`);let dtfCache={};function makeDTF(Te){return dtfCache[Te]||(dtfCache[Te]=new Intl.DateTimeFormat("en-US",{hour12:!1,timeZone:Te,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"})),dtfCache[Te]}const typeToPos={year:0,month:1,day:2,hour:3,minute:4,second:5};function hackyOffset(Te,we){const t=Te.format(we).replace(/\u200E/g,""),te=/(\d+)\/(\d+)\/(\d+),? (\d+):(\d+):(\d+)/.exec(t),[,be,xe,ve,ke,Ie,Ae]=te;return[ve,be,xe,ke,Ie,Ae]}function partsOffset(Te,we){const t=Te.formatToParts(we),te=[];for(let be=0;be<t.length;be++){const{type:xe,value:ve}=t[be],ke=typeToPos[xe];isUndefined(ke)||(te[ke]=parseInt(ve,10))}return te}let ianaZoneCache={};class IANAZone extends Zone{static create(we){return ianaZoneCache[we]||(ianaZoneCache[we]=new IANAZone(we)),ianaZoneCache[we]}static resetCache(){ianaZoneCache={},dtfCache={}}static isValidSpecifier(we){return!!(we&&we.match(matchingRegex))}static isValidZone(we){try{return new Intl.DateTimeFormat("en-US",{timeZone:we}).format(),!0}catch{return!1}}static parseGMTOffset(we){if(we){const t=we.match(/^Etc\/GMT(0|[+-]\d{1,2})$/i);if(t)return-60*parseInt(t[1])}return null}constructor(we){super(),this.zoneName=we,this.valid=IANAZone.isValidZone(we)}get type(){return"iana"}get name(){return this.zoneName}get universal(){return!1}offsetName(we,{format:t,locale:te}){return parseZoneInfo(we,t,te,this.name)}formatOffset(we,t){return formatOffset(this.offset(we),t)}offset(we){const t=new Date(we);if(isNaN(t))return NaN;const te=makeDTF(this.name),[be,xe,ve,ke,Ie,Ae]=te.formatToParts?partsOffset(te,t):hackyOffset(te,t),Oe=objToLocalTS({year:be,month:xe,day:ve,hour:ke===24?0:ke,minute:Ie,second:Ae,millisecond:0});let Ve=+t;const Me=Ve%1e3;return Ve-=Me>=0?Me:1e3+Me,(Oe-Ve)/(60*1e3)}equals(we){return we.type==="iana"&&we.name===this.name}get isValid(){return this.valid}}let singleton=null;class FixedOffsetZone extends Zone{static get utcInstance(){return singleton===null&&(singleton=new FixedOffsetZone(0)),singleton}static instance(we){return we===0?FixedOffsetZone.utcInstance:new FixedOffsetZone(we)}static parseSpecifier(we){if(we){const t=we.match(/^utc(?:([+-]\d{1,2})(?::(\d{2}))?)?$/i);if(t)return new FixedOffsetZone(signedOffset(t[1],t[2]))}return null}constructor(we){super(),this.fixed=we}get type(){return"fixed"}get name(){return this.fixed===0?"UTC":`UTC${formatOffset(this.fixed,"narrow")}`}offsetName(){return this.name}formatOffset(we,t){return formatOffset(this.fixed,t)}get universal(){return!0}offset(){return this.fixed}equals(we){return we.type==="fixed"&&we.fixed===this.fixed}get isValid(){return!0}}class InvalidZone extends Zone{constructor(we){super(),this.zoneName=we}get type(){return"invalid"}get name(){return this.zoneName}get universal(){return!1}offsetName(){return null}formatOffset(){return""}offset(){return NaN}equals(){return!1}get isValid(){return!1}}function normalizeZone(Te,we){let t;if(isUndefined(Te)||Te===null)return we;if(Te instanceof Zone)return Te;if(isString(Te)){const te=Te.toLowerCase();return te==="local"?we:te==="utc"||te==="gmt"?FixedOffsetZone.utcInstance:(t=IANAZone.parseGMTOffset(Te))!=null?FixedOffsetZone.instance(t):IANAZone.isValidSpecifier(te)?IANAZone.create(Te):FixedOffsetZone.parseSpecifier(te)||new InvalidZone(Te)}else return isNumber(Te)?FixedOffsetZone.instance(Te):typeof Te=="object"&&Te.offset&&typeof Te.offset=="number"?Te:new InvalidZone(Te)}let now=()=>Date.now(),defaultZone=null,defaultLocale=null,defaultNumberingSystem=null,defaultOutputCalendar=null,throwOnInvalid=!1;class Settings{static get now(){return now}static set now(we){now=we}static get defaultZoneName(){return Settings.defaultZone.name}static set defaultZoneName(we){we?defaultZone=normalizeZone(we):defaultZone=null}static get defaultZone(){return defaultZone||LocalZone.instance}static get defaultLocale(){return defaultLocale}static set defaultLocale(we){defaultLocale=we}static get defaultNumberingSystem(){return defaultNumberingSystem}static set defaultNumberingSystem(we){defaultNumberingSystem=we}static get defaultOutputCalendar(){return defaultOutputCalendar}static set defaultOutputCalendar(we){defaultOutputCalendar=we}static get throwOnInvalid(){return throwOnInvalid}static set throwOnInvalid(we){throwOnInvalid=we}static resetCaches(){Locale.resetCache(),IANAZone.resetCache()}}let intlDTCache={};function getCachedDTF(Te,we={}){const t=JSON.stringify([Te,we]);let te=intlDTCache[t];return te||(te=new Intl.DateTimeFormat(Te,we),intlDTCache[t]=te),te}let intlNumCache={};function getCachedINF(Te,we={}){const t=JSON.stringify([Te,we]);let te=intlNumCache[t];return te||(te=new Intl.NumberFormat(Te,we),intlNumCache[t]=te),te}let intlRelCache={};function getCachedRTF(Te,we={}){const{base:t,...te}=we,be=JSON.stringify([Te,te]);let xe=intlRelCache[be];return xe||(xe=new Intl.RelativeTimeFormat(Te,we),intlRelCache[be]=xe),xe}let sysLocaleCache=null;function systemLocale(){if(sysLocaleCache)return sysLocaleCache;if(hasIntl()){const Te=new Intl.DateTimeFormat().resolvedOptions().locale;return sysLocaleCache=!Te||Te==="und"?"en-US":Te,sysLocaleCache}else return sysLocaleCache="en-US",sysLocaleCache}function parseLocaleString(Te){const we=Te.indexOf("-u-");if(we===-1)return[Te];{let t;const te=Te.substring(0,we);try{t=getCachedDTF(Te).resolvedOptions()}catch{t=getCachedDTF(te).resolvedOptions()}const{numberingSystem:be,calendar:xe}=t;return[te,be,xe]}}function intlConfigString(Te,we,t){return hasIntl()?((t||we)&&(Te+="-u",t&&(Te+=`-ca-${t}`),we&&(Te+=`-nu-${we}`)),Te):[]}function mapMonths(Te){const we=[];for(let t=1;t<=12;t++){const te=DateTime.utc(2016,t,1);we.push(Te(te))}return we}function mapWeekdays(Te){const we=[];for(let t=1;t<=7;t++){const te=DateTime.utc(2016,11,13+t);we.push(Te(te))}return we}function listStuff(Te,we,t,te,be){const xe=Te.listingMode(t);return xe==="error"?null:xe==="en"?te(we):be(we)}function supportsFastNumbers(Te){return Te.numberingSystem&&Te.numberingSystem!=="latn"?!1:Te.numberingSystem==="latn"||!Te.locale||Te.locale.startsWith("en")||hasIntl()&&new Intl.DateTimeFormat(Te.intl).resolvedOptions().numberingSystem==="latn"}class PolyNumberFormatter{constructor(we,t,te){if(this.padTo=te.padTo||0,this.floor=te.floor||!1,!t&&hasIntl()){const be={useGrouping:!1};te.padTo>0&&(be.minimumIntegerDigits=te.padTo),this.inf=getCachedINF(we,be)}}format(we){if(this.inf){const t=this.floor?Math.floor(we):we;return this.inf.format(t)}else{const t=this.floor?Math.floor(we):roundTo(we,3);return padStart(t,this.padTo)}}}class PolyDateFormatter{constructor(we,t,te){this.opts=te,this.hasIntl=hasIntl();let be;if(we.zone.universal&&this.hasIntl){const xe=-1*(we.offset/60),ve=xe>=0?`Etc/GMT+${xe}`:`Etc/GMT${xe}`,ke=IANAZone.isValidZone(ve);we.offset!==0&&ke?(be=ve,this.dt=we):(be="UTC",te.timeZoneName?this.dt=we:this.dt=we.offset===0?we:DateTime.fromMillis(we.ts+we.offset*60*1e3))}else we.zone.type==="local"?this.dt=we:(this.dt=we,be=we.zone.name);if(this.hasIntl){const xe=Object.assign({},this.opts);be&&(xe.timeZone=be),this.dtf=getCachedDTF(t,xe)}}format(){if(this.hasIntl)return this.dtf.format(this.dt.toJSDate());{const we=formatString(this.opts),t=Locale.create("en-US");return Formatter.create(t).formatDateTimeFromString(this.dt,we)}}formatToParts(){return this.hasIntl&&hasFormatToParts()?this.dtf.formatToParts(this.dt.toJSDate()):[]}resolvedOptions(){return this.hasIntl?this.dtf.resolvedOptions():{locale:"en-US",numberingSystem:"latn",outputCalendar:"gregory"}}}class PolyRelFormatter{constructor(we,t,te){this.opts=Object.assign({style:"long"},te),!t&&hasRelative()&&(this.rtf=getCachedRTF(we,te))}format(we,t){return this.rtf?this.rtf.format(we,t):formatRelativeTime(t,we,this.opts.numeric,this.opts.style!=="long")}formatToParts(we,t){return this.rtf?this.rtf.formatToParts(we,t):[]}}class Locale{static fromOpts(we){return Locale.create(we.locale,we.numberingSystem,we.outputCalendar,we.defaultToEN)}static create(we,t,te,be=!1){const xe=we||Settings.defaultLocale,ve=xe||(be?"en-US":systemLocale()),ke=t||Settings.defaultNumberingSystem,Ie=te||Settings.defaultOutputCalendar;return new Locale(ve,ke,Ie,xe)}static resetCache(){sysLocaleCache=null,intlDTCache={},intlNumCache={},intlRelCache={}}static fromObject({locale:we,numberingSystem:t,outputCalendar:te}={}){return Locale.create(we,t,te)}constructor(we,t,te,be){const[xe,ve,ke]=parseLocaleString(we);this.locale=xe,this.numberingSystem=t||ve||null,this.outputCalendar=te||ke||null,this.intl=intlConfigString(this.locale,this.numberingSystem,this.outputCalendar),this.weekdaysCache={format:{},standalone:{}},this.monthsCache={format:{},standalone:{}},this.meridiemCache=null,this.eraCache={},this.specifiedLocale=be,this.fastNumbersCached=null}get fastNumbers(){return this.fastNumbersCached==null&&(this.fastNumbersCached=supportsFastNumbers(this)),this.fastNumbersCached}listingMode(we=!0){const t=hasIntl(),te=t&&hasFormatToParts(),be=this.isEnglish(),xe=(this.numberingSystem===null||this.numberingSystem==="latn")&&(this.outputCalendar===null||this.outputCalendar==="gregory");return!te&&!(be&&xe)&&!we?"error":!te||be&&xe?"en":"intl"}clone(we){return!we||Object.getOwnPropertyNames(we).length===0?this:Locale.create(we.locale||this.specifiedLocale,we.numberingSystem||this.numberingSystem,we.outputCalendar||this.outputCalendar,we.defaultToEN||!1)}redefaultToEN(we={}){return this.clone(Object.assign({},we,{defaultToEN:!0}))}redefaultToSystem(we={}){return this.clone(Object.assign({},we,{defaultToEN:!1}))}months(we,t=!1,te=!0){return listStuff(this,we,te,months,()=>{const be=t?{month:we,day:"numeric"}:{month:we},xe=t?"format":"standalone";return this.monthsCache[xe][we]||(this.monthsCache[xe][we]=mapMonths(ve=>this.extract(ve,be,"month"))),this.monthsCache[xe][we]})}weekdays(we,t=!1,te=!0){return listStuff(this,we,te,weekdays,()=>{const be=t?{weekday:we,year:"numeric",month:"long",day:"numeric"}:{weekday:we},xe=t?"format":"standalone";return this.weekdaysCache[xe][we]||(this.weekdaysCache[xe][we]=mapWeekdays(ve=>this.extract(ve,be,"weekday"))),this.weekdaysCache[xe][we]})}meridiems(we=!0){return listStuff(this,void 0,we,()=>meridiems,()=>{if(!this.meridiemCache){const t={hour:"numeric",hour12:!0};this.meridiemCache=[DateTime.utc(2016,11,13,9),DateTime.utc(2016,11,13,19)].map(te=>this.extract(te,t,"dayperiod"))}return this.meridiemCache})}eras(we,t=!0){return listStuff(this,we,t,eras,()=>{const te={era:we};return this.eraCache[we]||(this.eraCache[we]=[DateTime.utc(-40,1,1),DateTime.utc(2017,1,1)].map(be=>this.extract(be,te,"era"))),this.eraCache[we]})}extract(we,t,te){const be=this.dtFormatter(we,t),xe=be.formatToParts(),ve=xe.find(ke=>ke.type.toLowerCase()===te);return ve?ve.value:null}numberFormatter(we={}){return new PolyNumberFormatter(this.intl,we.forceSimple||this.fastNumbers,we)}dtFormatter(we,t={}){return new PolyDateFormatter(we,this.intl,t)}relFormatter(we={}){return new PolyRelFormatter(this.intl,this.isEnglish(),we)}isEnglish(){return this.locale==="en"||this.locale.toLowerCase()==="en-us"||hasIntl()&&new Intl.DateTimeFormat(this.intl).resolvedOptions().locale.startsWith("en-us")}equals(we){return this.locale===we.locale&&this.numberingSystem===we.numberingSystem&&this.outputCalendar===we.outputCalendar}}function combineRegexes(...Te){const we=Te.reduce((t,te)=>t+te.source,"");return RegExp(`^${we}$`)}function combineExtractors(...Te){return we=>Te.reduce(([t,te,be],xe)=>{const[ve,ke,Ie]=xe(we,be);return[Object.assign(t,ve),te||ke,Ie]},[{},null,1]).slice(0,2)}function parse(Te,...we){if(Te==null)return[null,null];for(const[t,te]of we){const be=t.exec(Te);if(be)return te(be)}return[null,null]}function simpleParse(...Te){return(we,t)=>{const te={};let be;for(be=0;be<Te.length;be++)te[Te[be]]=parseInteger(we[t+be]);return[te,null,t+be]}}const offsetRegex=/(?:(Z)|([+-]\d\d)(?::?(\d\d))?)/,isoTimeBaseRegex=/(\d\d)(?::?(\d\d)(?::?(\d\d)(?:[.,](\d{1,30}))?)?)?/,isoTimeRegex=RegExp(`${isoTimeBaseRegex.source}${offsetRegex.source}?`),isoTimeExtensionRegex=RegExp(`(?:T${isoTimeRegex.source})?`),isoYmdRegex=/([+-]\d{6}|\d{4})(?:-?(\d\d)(?:-?(\d\d))?)?/,isoWeekRegex=/(\d{4})-?W(\d\d)(?:-?(\d))?/,isoOrdinalRegex=/(\d{4})-?(\d{3})/,extractISOWeekData=simpleParse("weekYear","weekNumber","weekDay"),extractISOOrdinalData=simpleParse("year","ordinal"),sqlYmdRegex=/(\d{4})-(\d\d)-(\d\d)/,sqlTimeRegex=RegExp(`${isoTimeBaseRegex.source} ?(?:${offsetRegex.source}|(${ianaRegex.source}))?`),sqlTimeExtensionRegex=RegExp(`(?: ${sqlTimeRegex.source})?`);function int(Te,we,t){const te=Te[we];return isUndefined(te)?t:parseInteger(te)}function extractISOYmd(Te,we){return[{year:int(Te,we),month:int(Te,we+1,1),day:int(Te,we+2,1)},null,we+3]}function extractISOTime(Te,we){return[{hours:int(Te,we,0),minutes:int(Te,we+1,0),seconds:int(Te,we+2,0),milliseconds:parseMillis(Te[we+3])},null,we+4]}function extractISOOffset(Te,we){const t=!Te[we]&&!Te[we+1],te=signedOffset(Te[we+1],Te[we+2]),be=t?null:FixedOffsetZone.instance(te);return[{},be,we+3]}function extractIANAZone(Te,we){const t=Te[we]?IANAZone.create(Te[we]):null;return[{},t,we+1]}const isoTimeOnly=RegExp(`^T?${isoTimeBaseRegex.source}$`),isoDuration=/^-?P(?:(?:(-?\d{1,9})Y)?(?:(-?\d{1,9})M)?(?:(-?\d{1,9})W)?(?:(-?\d{1,9})D)?(?:T(?:(-?\d{1,9})H)?(?:(-?\d{1,9})M)?(?:(-?\d{1,20})(?:[.,](-?\d{1,9}))?S)?)?)$/;function extractISODuration(Te){const[we,t,te,be,xe,ve,ke,Ie,Ae]=Te,Se=we[0]==="-",Oe=Ie&&Ie[0]==="-",Ve=(Me,De=!1)=>Me!==void 0&&(De||Me&&Se)?-Me:Me;return[{years:Ve(parseInteger(t)),months:Ve(parseInteger(te)),weeks:Ve(parseInteger(be)),days:Ve(parseInteger(xe)),hours:Ve(parseInteger(ve)),minutes:Ve(parseInteger(ke)),seconds:Ve(parseInteger(Ie),Ie==="-0"),milliseconds:Ve(parseMillis(Ae),Oe)}]}const obsOffsets={GMT:0,EDT:-4*60,EST:-5*60,CDT:-5*60,CST:-6*60,MDT:-6*60,MST:-7*60,PDT:-7*60,PST:-8*60};function fromStrings(Te,we,t,te,be,xe,ve){const ke={year:we.length===2?untruncateYear(parseInteger(we)):parseInteger(we),month:monthsShort.indexOf(t)+1,day:parseInteger(te),hour:parseInteger(be),minute:parseInteger(xe)};return ve&&(ke.second=parseInteger(ve)),Te&&(ke.weekday=Te.length>3?weekdaysLong.indexOf(Te)+1:weekdaysShort.indexOf(Te)+1),ke}const rfc2822=/^(?:(Mon|Tue|Wed|Thu|Fri|Sat|Sun),\s)?(\d{1,2})\s(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s(\d{2,4})\s(\d\d):(\d\d)(?::(\d\d))?\s(?:(UT|GMT|[ECMP][SD]T)|([Zz])|(?:([+-]\d\d)(\d\d)))$/;function extractRFC2822(Te){const[,we,t,te,be,xe,ve,ke,Ie,Ae,Se,Oe]=Te,Ve=fromStrings(we,be,te,t,xe,ve,ke);let Me;return Ie?Me=obsOffsets[Ie]:Ae?Me=0:Me=signedOffset(Se,Oe),[Ve,new FixedOffsetZone(Me)]}function preprocessRFC2822(Te){return Te.replace(/\([^()]*\)|[\n\t]/g," ").replace(/(\s\s+)/g," ").trim()}const rfc1123=/^(Mon|Tue|Wed|Thu|Fri|Sat|Sun), (\d\d) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) (\d{4}) (\d\d):(\d\d):(\d\d) GMT$/,rfc850=/^(Monday|Tuesday|Wedsday|Thursday|Friday|Saturday|Sunday), (\d\d)-(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)-(\d\d) (\d\d):(\d\d):(\d\d) GMT$/,ascii=/^(Mon|Tue|Wed|Thu|Fri|Sat|Sun) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) ( \d|\d\d) (\d\d):(\d\d):(\d\d) (\d{4})$/;function extractRFC1123Or850(Te){const[,we,t,te,be,xe,ve,ke]=Te;return[fromStrings(we,be,te,t,xe,ve,ke),FixedOffsetZone.utcInstance]}function extractASCII(Te){const[,we,t,te,be,xe,ve,ke]=Te;return[fromStrings(we,ke,t,te,be,xe,ve),FixedOffsetZone.utcInstance]}const isoYmdWithTimeExtensionRegex=combineRegexes(isoYmdRegex,isoTimeExtensionRegex),isoWeekWithTimeExtensionRegex=combineRegexes(isoWeekRegex,isoTimeExtensionRegex),isoOrdinalWithTimeExtensionRegex=combineRegexes(isoOrdinalRegex,isoTimeExtensionRegex),isoTimeCombinedRegex=combineRegexes(isoTimeRegex),extractISOYmdTimeAndOffset=combineExtractors(extractISOYmd,extractISOTime,extractISOOffset),extractISOWeekTimeAndOffset=combineExtractors(extractISOWeekData,extractISOTime,extractISOOffset),extractISOOrdinalDateAndTime=combineExtractors(extractISOOrdinalData,extractISOTime,extractISOOffset),extractISOTimeAndOffset=combineExtractors(extractISOTime,extractISOOffset);function parseISODate(Te){return parse(Te,[isoYmdWithTimeExtensionRegex,extractISOYmdTimeAndOffset],[isoWeekWithTimeExtensionRegex,extractISOWeekTimeAndOffset],[isoOrdinalWithTimeExtensionRegex,extractISOOrdinalDateAndTime],[isoTimeCombinedRegex,extractISOTimeAndOffset])}function parseRFC2822Date(Te){return parse(preprocessRFC2822(Te),[rfc2822,extractRFC2822])}function parseHTTPDate(Te){return parse(Te,[rfc1123,extractRFC1123Or850],[rfc850,extractRFC1123Or850],[ascii,extractASCII])}function parseISODuration(Te){return parse(Te,[isoDuration,extractISODuration])}const extractISOTimeOnly=combineExtractors(extractISOTime);function parseISOTimeOnly(Te){return parse(Te,[isoTimeOnly,extractISOTimeOnly])}const sqlYmdWithTimeExtensionRegex=combineRegexes(sqlYmdRegex,sqlTimeExtensionRegex),sqlTimeCombinedRegex=combineRegexes(sqlTimeRegex),extractISOYmdTimeOffsetAndIANAZone=combineExtractors(extractISOYmd,extractISOTime,extractISOOffset,extractIANAZone),extractISOTimeOffsetAndIANAZone=combineExtractors(extractISOTime,extractISOOffset,extractIANAZone);function parseSQL(Te){return parse(Te,[sqlYmdWithTimeExtensionRegex,extractISOYmdTimeOffsetAndIANAZone],[sqlTimeCombinedRegex,extractISOTimeOffsetAndIANAZone])}const INVALID$2="Invalid Duration",lowOrderMatrix={weeks:{days:7,hours:7*24,minutes:7*24*60,seconds:7*24*60*60,milliseconds:7*24*60*60*1e3},days:{hours:24,minutes:24*60,seconds:24*60*60,milliseconds:24*60*60*1e3},hours:{minutes:60,seconds:60*60,milliseconds:60*60*1e3},minutes:{seconds:60,milliseconds:60*1e3},seconds:{milliseconds:1e3}},casualMatrix=Object.assign({years:{quarters:4,months:12,weeks:52,days:365,hours:365*24,minutes:365*24*60,seconds:365*24*60*60,milliseconds:365*24*60*60*1e3},quarters:{months:3,weeks:13,days:91,hours:91*24,minutes:91*24*60,seconds:91*24*60*60,milliseconds:91*24*60*60*1e3},months:{weeks:4,days:30,hours:30*24,minutes:30*24*60,seconds:30*24*60*60,milliseconds:30*24*60*60*1e3}},lowOrderMatrix),daysInYearAccurate=146097/400,daysInMonthAccurate=146097/4800,accurateMatrix=Object.assign({years:{quarters:4,months:12,weeks:daysInYearAccurate/7,days:daysInYearAccurate,hours:daysInYearAccurate*24,minutes:daysInYearAccurate*24*60,seconds:daysInYearAccurate*24*60*60,milliseconds:daysInYearAccurate*24*60*60*1e3},quarters:{months:3,weeks:daysInYearAccurate/28,days:daysInYearAccurate/4,hours:daysInYearAccurate*24/4,minutes:daysInYearAccurate*24*60/4,seconds:daysInYearAccurate*24*60*60/4,milliseconds:daysInYearAccurate*24*60*60*1e3/4},months:{weeks:daysInMonthAccurate/7,days:daysInMonthAccurate,hours:daysInMonthAccurate*24,minutes:daysInMonthAccurate*24*60,seconds:daysInMonthAccurate*24*60*60,milliseconds:daysInMonthAccurate*24*60*60*1e3}},lowOrderMatrix),orderedUnits$1=["years","quarters","months","weeks","days","hours","minutes","seconds","milliseconds"],reverseUnits=orderedUnits$1.slice(0).reverse();function clone$1(Te,we,t=!1){const te={values:t?we.values:Object.assign({},Te.values,we.values||{}),loc:Te.loc.clone(we.loc),conversionAccuracy:we.conversionAccuracy||Te.conversionAccuracy};return new Duration(te)}function antiTrunc(Te){return Te<0?Math.floor(Te):Math.ceil(Te)}function convert(Te,we,t,te,be){const xe=Te[be][t],ve=we[t]/xe,ke=Math.sign(ve)===Math.sign(te[be]),Ie=!ke&&te[be]!==0&&Math.abs(ve)<=1?antiTrunc(ve):Math.trunc(ve);te[be]+=Ie,we[t]-=Ie*xe}function normalizeValues(Te,we){reverseUnits.reduce((t,te)=>isUndefined(we[te])?t:(t&&convert(Te,we,t,we,te),te),null)}class Duration{constructor(we){const t=we.conversionAccuracy==="longterm"||!1;this.values=we.values,this.loc=we.loc||Locale.create(),this.conversionAccuracy=t?"longterm":"casual",this.invalid=we.invalid||null,this.matrix=t?accurateMatrix:casualMatrix,this.isLuxonDuration=!0}static fromMillis(we,t){return Duration.fromObject(Object.assign({milliseconds:we},t))}static fromObject(we){if(we==null||typeof we!="object")throw new InvalidArgumentError(`Duration.fromObject: argument expected to be an object, got ${we===null?"null":typeof we}`);return new Duration({values:normalizeObject(we,Duration.normalizeUnit,["locale","numberingSystem","conversionAccuracy","zone"]),loc:Locale.fromObject(we),conversionAccuracy:we.conversionAccuracy})}static fromISO(we,t){const[te]=parseISODuration(we);if(te){const be=Object.assign(te,t);return Duration.fromObject(be)}else return Duration.invalid("unparsable",`the input "${we}" can't be parsed as ISO 8601`)}static fromISOTime(we,t){const[te]=parseISOTimeOnly(we);if(te){const be=Object.assign(te,t);return Duration.fromObject(be)}else return Duration.invalid("unparsable",`the input "${we}" can't be parsed as ISO 8601`)}static invalid(we,t=null){if(!we)throw new InvalidArgumentError("need to specify a reason the Duration is invalid");const te=we instanceof Invalid?we:new Invalid(we,t);if(Settings.throwOnInvalid)throw new InvalidDurationError(te);return new Duration({invalid:te})}static normalizeUnit(we){const t={year:"years",years:"years",quarter:"quarters",quarters:"quarters",month:"months",months:"months",week:"weeks",weeks:"weeks",day:"days",days:"days",hour:"hours",hours:"hours",minute:"minutes",minutes:"minutes",second:"seconds",seconds:"seconds",millisecond:"milliseconds",milliseconds:"milliseconds"}[we&&we.toLowerCase()];if(!t)throw new InvalidUnitError(we);return t}static isDuration(we){return we&&we.isLuxonDuration||!1}get locale(){return this.isValid?this.loc.locale:null}get numberingSystem(){return this.isValid?this.loc.numberingSystem:null}toFormat(we,t={}){const te=Object.assign({},t,{floor:t.round!==!1&&t.floor!==!1});return this.isValid?Formatter.create(this.loc,te).formatDurationFromString(this,we):INVALID$2}toObject(we={}){if(!this.isValid)return{};const t=Object.assign({},this.values);return we.includeConfig&&(t.conversionAccuracy=this.conversionAccuracy,t.numberingSystem=this.loc.numberingSystem,t.locale=this.loc.locale),t}toISO(){if(!this.isValid)return null;let we="P";return this.years!==0&&(we+=this.years+"Y"),(this.months!==0||this.quarters!==0)&&(we+=this.months+this.quarters*3+"M"),this.weeks!==0&&(we+=this.weeks+"W"),this.days!==0&&(we+=this.days+"D"),(this.hours!==0||this.minutes!==0||this.seconds!==0||this.milliseconds!==0)&&(we+="T"),this.hours!==0&&(we+=this.hours+"H"),this.minutes!==0&&(we+=this.minutes+"M"),(this.seconds!==0||this.milliseconds!==0)&&(we+=roundTo(this.seconds+this.milliseconds/1e3,3)+"S"),we==="P"&&(we+="T0S"),we}toISOTime(we={}){if(!this.isValid)return null;const t=this.toMillis();if(t<0||t>=864e5)return null;we=Object.assign({suppressMilliseconds:!1,suppressSeconds:!1,includePrefix:!1,format:"extended"},we);const te=this.shiftTo("hours","minutes","seconds","milliseconds");let be=we.format==="basic"?"hhmm":"hh:mm";(!we.suppressSeconds||te.seconds!==0||te.milliseconds!==0)&&(be+=we.format==="basic"?"ss":":ss",(!we.suppressMilliseconds||te.milliseconds!==0)&&(be+=".SSS"));let xe=te.toFormat(be);return we.includePrefix&&(xe="T"+xe),xe}toJSON(){return this.toISO()}toString(){return this.toISO()}toMillis(){return this.as("milliseconds")}valueOf(){return this.toMillis()}plus(we){if(!this.isValid)return this;const t=friendlyDuration(we),te={};for(const be of orderedUnits$1)(hasOwnProperty(t.values,be)||hasOwnProperty(this.values,be))&&(te[be]=t.get(be)+this.get(be));return clone$1(this,{values:te},!0)}minus(we){if(!this.isValid)return this;const t=friendlyDuration(we);return this.plus(t.negate())}mapUnits(we){if(!this.isValid)return this;const t={};for(const te of Object.keys(this.values))t[te]=asNumber(we(this.values[te],te));return clone$1(this,{values:t},!0)}get(we){return this[Duration.normalizeUnit(we)]}set(we){if(!this.isValid)return this;const t=Object.assign(this.values,normalizeObject(we,Duration.normalizeUnit,[]));return clone$1(this,{values:t})}reconfigure({locale:we,numberingSystem:t,conversionAccuracy:te}={}){const be=this.loc.clone({locale:we,numberingSystem:t}),xe={loc:be};return te&&(xe.conversionAccuracy=te),clone$1(this,xe)}as(we){return this.isValid?this.shiftTo(we).get(we):NaN}normalize(){if(!this.isValid)return this;const we=this.toObject();return normalizeValues(this.matrix,we),clone$1(this,{values:we},!0)}shiftTo(...we){if(!this.isValid)return this;if(we.length===0)return this;we=we.map(ve=>Duration.normalizeUnit(ve));const t={},te={},be=this.toObject();let xe;for(const ve of orderedUnits$1)if(we.indexOf(ve)>=0){xe=ve;let ke=0;for(const Ae in te)ke+=this.matrix[Ae][ve]*te[Ae],te[Ae]=0;isNumber(be[ve])&&(ke+=be[ve]);const Ie=Math.trunc(ke);t[ve]=Ie,te[ve]=ke-Ie;for(const Ae in be)orderedUnits$1.indexOf(Ae)>orderedUnits$1.indexOf(ve)&&convert(this.matrix,be,Ae,t,ve)}else isNumber(be[ve])&&(te[ve]=be[ve]);for(const ve in te)te[ve]!==0&&(t[xe]+=ve===xe?te[ve]:te[ve]/this.matrix[xe][ve]);return clone$1(this,{values:t},!0).normalize()}negate(){if(!this.isValid)return this;const we={};for(const t of Object.keys(this.values))we[t]=-this.values[t];return clone$1(this,{values:we},!0)}get years(){return this.isValid?this.values.years||0:NaN}get quarters(){return this.isValid?this.values.quarters||0:NaN}get months(){return this.isValid?this.values.months||0:NaN}get weeks(){return this.isValid?this.values.weeks||0:NaN}get days(){return this.isValid?this.values.days||0:NaN}get hours(){return this.isValid?this.values.hours||0:NaN}get minutes(){return this.isValid?this.values.minutes||0:NaN}get seconds(){return this.isValid?this.values.seconds||0:NaN}get milliseconds(){return this.isValid?this.values.milliseconds||0:NaN}get isValid(){return this.invalid===null}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}equals(we){if(!this.isValid||!we.isValid||!this.loc.equals(we.loc))return!1;function t(te,be){return te===void 0||te===0?be===void 0||be===0:te===be}for(const te of orderedUnits$1)if(!t(this.values[te],we.values[te]))return!1;return!0}}function friendlyDuration(Te){if(isNumber(Te))return Duration.fromMillis(Te);if(Duration.isDuration(Te))return Te;if(typeof Te=="object")return Duration.fromObject(Te);throw new InvalidArgumentError(`Unknown duration argument ${Te} of type ${typeof Te}`)}const INVALID$1="Invalid Interval";function validateStartEnd(Te,we){return!Te||!Te.isValid?Interval.invalid("missing or invalid start"):!we||!we.isValid?Interval.invalid("missing or invalid end"):we<Te?Interval.invalid("end before start",`The end of an interval must be after its start, but you had start=${Te.toISO()} and end=${we.toISO()}`):null}class Interval{constructor(we){this.s=we.start,this.e=we.end,this.invalid=we.invalid||null,this.isLuxonInterval=!0}static invalid(we,t=null){if(!we)throw new InvalidArgumentError("need to specify a reason the Interval is invalid");const te=we instanceof Invalid?we:new Invalid(we,t);if(Settings.throwOnInvalid)throw new InvalidIntervalError(te);return new Interval({invalid:te})}static fromDateTimes(we,t){const te=friendlyDateTime(we),be=friendlyDateTime(t),xe=validateStartEnd(te,be);return xe??new Interval({start:te,end:be})}static after(we,t){const te=friendlyDuration(t),be=friendlyDateTime(we);return Interval.fromDateTimes(be,be.plus(te))}static before(we,t){const te=friendlyDuration(t),be=friendlyDateTime(we);return Interval.fromDateTimes(be.minus(te),be)}static fromISO(we,t){const[te,be]=(we||"").split("/",2);if(te&&be){let xe,ve;try{xe=DateTime.fromISO(te,t),ve=xe.isValid}catch{ve=!1}let ke,Ie;try{ke=DateTime.fromISO(be,t),Ie=ke.isValid}catch{Ie=!1}if(ve&&Ie)return Interval.fromDateTimes(xe,ke);if(ve){const Ae=Duration.fromISO(be,t);if(Ae.isValid)return Interval.after(xe,Ae)}else if(Ie){const Ae=Duration.fromISO(te,t);if(Ae.isValid)return Interval.before(ke,Ae)}}return Interval.invalid("unparsable",`the input "${we}" can't be parsed as ISO 8601`)}static isInterval(we){return we&&we.isLuxonInterval||!1}get start(){return this.isValid?this.s:null}get end(){return this.isValid?this.e:null}get isValid(){return this.invalidReason===null}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}length(we="milliseconds"){return this.isValid?this.toDuration(we).get(we):NaN}count(we="milliseconds"){if(!this.isValid)return NaN;const t=this.start.startOf(we),te=this.end.startOf(we);return Math.floor(te.diff(t,we).get(we))+1}hasSame(we){return this.isValid?this.isEmpty()||this.e.minus(1).hasSame(this.s,we):!1}isEmpty(){return this.s.valueOf()===this.e.valueOf()}isAfter(we){return this.isValid?this.s>we:!1}isBefore(we){return this.isValid?this.e<=we:!1}contains(we){return this.isValid?this.s<=we&&this.e>we:!1}set({start:we,end:t}={}){return this.isValid?Interval.fromDateTimes(we||this.s,t||this.e):this}splitAt(...we){if(!this.isValid)return[];const t=we.map(friendlyDateTime).filter(ve=>this.contains(ve)).sort(),te=[];let{s:be}=this,xe=0;for(;be<this.e;){const ve=t[xe]||this.e,ke=+ve>+this.e?this.e:ve;te.push(Interval.fromDateTimes(be,ke)),be=ke,xe+=1}return te}splitBy(we){const t=friendlyDuration(we);if(!this.isValid||!t.isValid||t.as("milliseconds")===0)return[];let{s:te}=this,be=1,xe;const ve=[];for(;te<this.e;){const ke=this.start.plus(t.mapUnits(Ie=>Ie*be));xe=+ke>+this.e?this.e:ke,ve.push(Interval.fromDateTimes(te,xe)),te=xe,be+=1}return ve}divideEqually(we){return this.isValid?this.splitBy(this.length()/we).slice(0,we):[]}overlaps(we){return this.e>we.s&&this.s<we.e}abutsStart(we){return this.isValid?+this.e==+we.s:!1}abutsEnd(we){return this.isValid?+we.e==+this.s:!1}engulfs(we){return this.isValid?this.s<=we.s&&this.e>=we.e:!1}equals(we){return!this.isValid||!we.isValid?!1:this.s.equals(we.s)&&this.e.equals(we.e)}intersection(we){if(!this.isValid)return this;const t=this.s>we.s?this.s:we.s,te=this.e<we.e?this.e:we.e;return t>=te?null:Interval.fromDateTimes(t,te)}union(we){if(!this.isValid)return this;const t=this.s<we.s?this.s:we.s,te=this.e>we.e?this.e:we.e;return Interval.fromDateTimes(t,te)}static merge(we){const[t,te]=we.sort((be,xe)=>be.s-xe.s).reduce(([be,xe],ve)=>xe?xe.overlaps(ve)||xe.abutsStart(ve)?[be,xe.union(ve)]:[be.concat([xe]),ve]:[be,ve],[[],null]);return te&&t.push(te),t}static xor(we){let t=null,te=0;const be=[],xe=we.map(Ie=>[{time:Ie.s,type:"s"},{time:Ie.e,type:"e"}]),ve=Array.prototype.concat(...xe),ke=ve.sort((Ie,Ae)=>Ie.time-Ae.time);for(const Ie of ke)te+=Ie.type==="s"?1:-1,te===1?t=Ie.time:(t&&+t!=+Ie.time&&be.push(Interval.fromDateTimes(t,Ie.time)),t=null);return Interval.merge(be)}difference(...we){return Interval.xor([this].concat(we)).map(t=>this.intersection(t)).filter(t=>t&&!t.isEmpty())}toString(){return this.isValid?`[${this.s.toISO()} – ${this.e.toISO()})`:INVALID$1}toISO(we){return this.isValid?`${this.s.toISO(we)}/${this.e.toISO(we)}`:INVALID$1}toISODate(){return this.isValid?`${this.s.toISODate()}/${this.e.toISODate()}`:INVALID$1}toISOTime(we){return this.isValid?`${this.s.toISOTime(we)}/${this.e.toISOTime(we)}`:INVALID$1}toFormat(we,{separator:t=" – "}={}){return this.isValid?`${this.s.toFormat(we)}${t}${this.e.toFormat(we)}`:INVALID$1}toDuration(we,t){return this.isValid?this.e.diff(this.s,we,t):Duration.invalid(this.invalidReason)}mapEndpoints(we){return Interval.fromDateTimes(we(this.s),we(this.e))}}class Info{static hasDST(we=Settings.defaultZone){const t=DateTime.now().setZone(we).set({month:12});return!we.universal&&t.offset!==t.set({month:6}).offset}static isValidIANAZone(we){return IANAZone.isValidSpecifier(we)&&IANAZone.isValidZone(we)}static normalizeZone(we){return normalizeZone(we,Settings.defaultZone)}static months(we="long",{locale:t=null,numberingSystem:te=null,locObj:be=null,outputCalendar:xe="gregory"}={}){return(be||Locale.create(t,te,xe)).months(we)}static monthsFormat(we="long",{locale:t=null,numberingSystem:te=null,locObj:be=null,outputCalendar:xe="gregory"}={}){return(be||Locale.create(t,te,xe)).months(we,!0)}static weekdays(we="long",{locale:t=null,numberingSystem:te=null,locObj:be=null}={}){return(be||Locale.create(t,te,null)).weekdays(we)}static weekdaysFormat(we="long",{locale:t=null,numberingSystem:te=null,locObj:be=null}={}){return(be||Locale.create(t,te,null)).weekdays(we,!0)}static meridiems({locale:we=null}={}){return Locale.create(we).meridiems()}static eras(we="short",{locale:t=null}={}){return Locale.create(t,null,"gregory").eras(we)}static features(){let we=!1,t=!1,te=!1,be=!1;if(hasIntl()){we=!0,t=hasFormatToParts(),be=hasRelative();try{te=new Intl.DateTimeFormat("en",{timeZone:"America/New_York"}).resolvedOptions().timeZone==="America/New_York"}catch{te=!1}}return{intl:we,intlTokens:t,zones:te,relative:be}}}function dayDiff(Te,we){const t=be=>be.toUTC(0,{keepLocalTime:!0}).startOf("day").valueOf(),te=t(we)-t(Te);return Math.floor(Duration.fromMillis(te).as("days"))}function highOrderDiffs(Te,we,t){const te=[["years",(ke,Ie)=>Ie.year-ke.year],["quarters",(ke,Ie)=>Ie.quarter-ke.quarter],["months",(ke,Ie)=>Ie.month-ke.month+(Ie.year-ke.year)*12],["weeks",(ke,Ie)=>{const Ae=dayDiff(ke,Ie);return(Ae-Ae%7)/7}],["days",dayDiff]],be={};let xe,ve;for(const[ke,Ie]of te)if(t.indexOf(ke)>=0){xe=ke;let Ae=Ie(Te,we);ve=Te.plus({[ke]:Ae}),ve>we?(Te=Te.plus({[ke]:Ae-1}),Ae-=1):Te=ve,be[ke]=Ae}return[Te,be,ve,xe]}function diff(Te,we,t,te){let[be,xe,ve,ke]=highOrderDiffs(Te,we,t);const Ie=we-be,Ae=t.filter(Oe=>["hours","minutes","seconds","milliseconds"].indexOf(Oe)>=0);Ae.length===0&&(ve<we&&(ve=be.plus({[ke]:1})),ve!==be&&(xe[ke]=(xe[ke]||0)+Ie/(ve-be)));const Se=Duration.fromObject(Object.assign(xe,te));return Ae.length>0?Duration.fromMillis(Ie,te).shiftTo(...Ae).plus(Se):Se}const numberingSystems={arab:"[٠-٩]",arabext:"[۰-۹]",bali:"[᭐-᭙]",beng:"[০-৯]",deva:"[०-९]",fullwide:"[０-９]",gujr:"[૦-૯]",hanidec:"[〇|一|二|三|四|五|六|七|八|九]",khmr:"[០-៩]",knda:"[೦-೯]",laoo:"[໐-໙]",limb:"[᥆-᥏]",mlym:"[൦-൯]",mong:"[᠐-᠙]",mymr:"[၀-၉]",orya:"[୦-୯]",tamldec:"[௦-௯]",telu:"[౦-౯]",thai:"[๐-๙]",tibt:"[༠-༩]",latn:"\\d"},numberingSystemsUTF16={arab:[1632,1641],arabext:[1776,1785],bali:[6992,7001],beng:[2534,2543],deva:[2406,2415],fullwide:[65296,65303],gujr:[2790,2799],khmr:[6112,6121],knda:[3302,3311],laoo:[3792,3801],limb:[6470,6479],mlym:[3430,3439],mong:[6160,6169],mymr:[4160,4169],orya:[2918,2927],tamldec:[3046,3055],telu:[3174,3183],thai:[3664,3673],tibt:[3872,3881]},hanidecChars=numberingSystems.hanidec.replace(/[\[|\]]/g,"").split("");function parseDigits(Te){let we=parseInt(Te,10);if(isNaN(we)){we="";for(let t=0;t<Te.length;t++){const te=Te.charCodeAt(t);if(Te[t].search(numberingSystems.hanidec)!==-1)we+=hanidecChars.indexOf(Te[t]);else for(const be in numberingSystemsUTF16){const[xe,ve]=numberingSystemsUTF16[be];te>=xe&&te<=ve&&(we+=te-xe)}}return parseInt(we,10)}else return we}function digitRegex({numberingSystem:Te},we=""){return new RegExp(`${numberingSystems[Te||"latn"]}${we}`)}const MISSING_FTP="missing Intl.DateTimeFormat.formatToParts support";function intUnit(Te,we=t=>t){return{regex:Te,deser:([t])=>we(parseDigits(t))}}const NBSP=" ",spaceOrNBSP=`( |${NBSP})`,spaceOrNBSPRegExp=new RegExp(spaceOrNBSP,"g");function fixListRegex(Te){return Te.replace(/\./g,"\\.?").replace(spaceOrNBSPRegExp,spaceOrNBSP)}function stripInsensitivities(Te){return Te.replace(/\./g,"").replace(spaceOrNBSPRegExp," ").toLowerCase()}function oneOf(Te,we){return Te===null?null:{regex:RegExp(Te.map(fixListRegex).join("|")),deser:([t])=>Te.findIndex(te=>stripInsensitivities(t)===stripInsensitivities(te))+we}}function offset(Te,we){return{regex:Te,deser:([,t,te])=>signedOffset(t,te),groups:we}}function simple(Te){return{regex:Te,deser:([we])=>we}}function escapeToken(Te){return Te.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function unitForToken(Te,we){const t=digitRegex(we),te=digitRegex(we,"{2}"),be=digitRegex(we,"{3}"),xe=digitRegex(we,"{4}"),ve=digitRegex(we,"{6}"),ke=digitRegex(we,"{1,2}"),Ie=digitRegex(we,"{1,3}"),Ae=digitRegex(we,"{1,6}"),Se=digitRegex(we,"{1,9}"),Oe=digitRegex(we,"{2,4}"),Ve=digitRegex(we,"{4,6}"),Me=Be=>({regex:RegExp(escapeToken(Be.val)),deser:([$e])=>$e,literal:!0}),Fe=(Be=>{if(Te.literal)return Me(Be);switch(Be.val){case"G":return oneOf(we.eras("short",!1),0);case"GG":return oneOf(we.eras("long",!1),0);case"y":return intUnit(Ae);case"yy":return intUnit(Oe,untruncateYear);case"yyyy":return intUnit(xe);case"yyyyy":return intUnit(Ve);case"yyyyyy":return intUnit(ve);case"M":return intUnit(ke);case"MM":return intUnit(te);case"MMM":return oneOf(we.months("short",!0,!1),1);case"MMMM":return oneOf(we.months("long",!0,!1),1);case"L":return intUnit(ke);case"LL":return intUnit(te);case"LLL":return oneOf(we.months("short",!1,!1),1);case"LLLL":return oneOf(we.months("long",!1,!1),1);case"d":return intUnit(ke);case"dd":return intUnit(te);case"o":return intUnit(Ie);case"ooo":return intUnit(be);case"HH":return intUnit(te);case"H":return intUnit(ke);case"hh":return intUnit(te);case"h":return intUnit(ke);case"mm":return intUnit(te);case"m":return intUnit(ke);case"q":return intUnit(ke);case"qq":return intUnit(te);case"s":return intUnit(ke);case"ss":return intUnit(te);case"S":return intUnit(Ie);case"SSS":return intUnit(be);case"u":return simple(Se);case"a":return oneOf(we.meridiems(),0);case"kkkk":return intUnit(xe);case"kk":return intUnit(Oe,untruncateYear);case"W":return intUnit(ke);case"WW":return intUnit(te);case"E":case"c":return intUnit(t);case"EEE":return oneOf(we.weekdays("short",!1,!1),1);case"EEEE":return oneOf(we.weekdays("long",!1,!1),1);case"ccc":return oneOf(we.weekdays("short",!0,!1),1);case"cccc":return oneOf(we.weekdays("long",!0,!1),1);case"Z":case"ZZ":return offset(new RegExp(`([+-]${ke.source})(?::(${te.source}))?`),2);case"ZZZ":return offset(new RegExp(`([+-]${ke.source})(${te.source})?`),2);case"z":return simple(/[a-z_+-/]{1,256}?/i);default:return Me(Be)}})(Te)||{invalidReason:MISSING_FTP};return Fe.token=Te,Fe}const partTypeStyleToTokenVal={year:{"2-digit":"yy",numeric:"yyyyy"},month:{numeric:"M","2-digit":"MM",short:"MMM",long:"MMMM"},day:{numeric:"d","2-digit":"dd"},weekday:{short:"EEE",long:"EEEE"},dayperiod:"a",dayPeriod:"a",hour:{numeric:"h","2-digit":"hh"},minute:{numeric:"m","2-digit":"mm"},second:{numeric:"s","2-digit":"ss"}};function tokenForPart(Te,we,t){const{type:te,value:be}=Te;if(te==="literal")return{literal:!0,val:be};const xe=t[te];let ve=partTypeStyleToTokenVal[te];if(typeof ve=="object"&&(ve=ve[xe]),ve)return{literal:!1,val:ve}}function buildRegex(Te){return[`^${Te.map(t=>t.regex).reduce((t,te)=>`${t}(${te.source})`,"")}$`,Te]}function match(Te,we,t){const te=Te.match(we);if(te){const be={};let xe=1;for(const ve in t)if(hasOwnProperty(t,ve)){const ke=t[ve],Ie=ke.groups?ke.groups+1:1;!ke.literal&&ke.token&&(be[ke.token.val[0]]=ke.deser(te.slice(xe,xe+Ie))),xe+=Ie}return[te,be]}else return[te,{}]}function dateTimeFromMatches(Te){const we=be=>{switch(be){case"S":return"millisecond";case"s":return"second";case"m":return"minute";case"h":case"H":return"hour";case"d":return"day";case"o":return"ordinal";case"L":case"M":return"month";case"y":return"year";case"E":case"c":return"weekday";case"W":return"weekNumber";case"k":return"weekYear";case"q":return"quarter";default:return null}};let t;return isUndefined(Te.Z)?isUndefined(Te.z)?t=null:t=IANAZone.create(Te.z):t=new FixedOffsetZone(Te.Z),isUndefined(Te.q)||(Te.M=(Te.q-1)*3+1),isUndefined(Te.h)||(Te.h<12&&Te.a===1?Te.h+=12:Te.h===12&&Te.a===0&&(Te.h=0)),Te.G===0&&Te.y&&(Te.y=-Te.y),isUndefined(Te.u)||(Te.S=parseMillis(Te.u)),[Object.keys(Te).reduce((be,xe)=>{const ve=we(xe);return ve&&(be[ve]=Te[xe]),be},{}),t]}let dummyDateTimeCache=null;function getDummyDateTime(){return dummyDateTimeCache||(dummyDateTimeCache=DateTime.fromMillis(1555555555555)),dummyDateTimeCache}function maybeExpandMacroToken(Te,we){if(Te.literal)return Te;const t=Formatter.macroTokenToFormatOpts(Te.val);if(!t)return Te;const xe=Formatter.create(we,t).formatDateTimeParts(getDummyDateTime()).map(ve=>tokenForPart(ve,we,t));return xe.includes(void 0)?Te:xe}function expandMacroTokens(Te,we){return Array.prototype.concat(...Te.map(t=>maybeExpandMacroToken(t,we)))}function explainFromTokens(Te,we,t){const te=expandMacroTokens(Formatter.parseFormat(t),Te),be=te.map(ve=>unitForToken(ve,Te)),xe=be.find(ve=>ve.invalidReason);if(xe)return{input:we,tokens:te,invalidReason:xe.invalidReason};{const[ve,ke]=buildRegex(be),Ie=RegExp(ve,"i"),[Ae,Se]=match(we,Ie,ke),[Oe,Ve]=Se?dateTimeFromMatches(Se):[null,null];if(hasOwnProperty(Se,"a")&&hasOwnProperty(Se,"H"))throw new ConflictingSpecificationError("Can't include meridiem when specifying 24-hour format");return{input:we,tokens:te,regex:Ie,rawMatches:Ae,matches:Se,result:Oe,zone:Ve}}}function parseFromTokens(Te,we,t){const{result:te,zone:be,invalidReason:xe}=explainFromTokens(Te,we,t);return[te,be,xe]}const nonLeapLadder=[0,31,59,90,120,151,181,212,243,273,304,334],leapLadder=[0,31,60,91,121,152,182,213,244,274,305,335];function unitOutOfRange(Te,we){return new Invalid("unit out of range",`you specified ${we} (of type ${typeof we}) as a ${Te}, which is invalid`)}function dayOfWeek(Te,we,t){const te=new Date(Date.UTC(Te,we-1,t)).getUTCDay();return te===0?7:te}function computeOrdinal(Te,we,t){return t+(isLeapYear(Te)?leapLadder:nonLeapLadder)[we-1]}function uncomputeOrdinal(Te,we){const t=isLeapYear(Te)?leapLadder:nonLeapLadder,te=t.findIndex(xe=>xe<we),be=we-t[te];return{month:te+1,day:be}}function gregorianToWeek(Te){const{year:we,month:t,day:te}=Te,be=computeOrdinal(we,t,te),xe=dayOfWeek(we,t,te);let ve=Math.floor((be-xe+10)/7),ke;return ve<1?(ke=we-1,ve=weeksInWeekYear(ke)):ve>weeksInWeekYear(we)?(ke=we+1,ve=1):ke=we,Object.assign({weekYear:ke,weekNumber:ve,weekday:xe},timeObject(Te))}function weekToGregorian(Te){const{weekYear:we,weekNumber:t,weekday:te}=Te,be=dayOfWeek(we,1,4),xe=daysInYear(we);let ve=t*7+te-be-3,ke;ve<1?(ke=we-1,ve+=daysInYear(ke)):ve>xe?(ke=we+1,ve-=daysInYear(we)):ke=we;const{month:Ie,day:Ae}=uncomputeOrdinal(ke,ve);return Object.assign({year:ke,month:Ie,day:Ae},timeObject(Te))}function gregorianToOrdinal(Te){const{year:we,month:t,day:te}=Te,be=computeOrdinal(we,t,te);return Object.assign({year:we,ordinal:be},timeObject(Te))}function ordinalToGregorian(Te){const{year:we,ordinal:t}=Te,{month:te,day:be}=uncomputeOrdinal(we,t);return Object.assign({year:we,month:te,day:be},timeObject(Te))}function hasInvalidWeekData(Te){const we=isInteger(Te.weekYear),t=integerBetween(Te.weekNumber,1,weeksInWeekYear(Te.weekYear)),te=integerBetween(Te.weekday,1,7);return we?t?te?!1:unitOutOfRange("weekday",Te.weekday):unitOutOfRange("week",Te.week):unitOutOfRange("weekYear",Te.weekYear)}function hasInvalidOrdinalData(Te){const we=isInteger(Te.year),t=integerBetween(Te.ordinal,1,daysInYear(Te.year));return we?t?!1:unitOutOfRange("ordinal",Te.ordinal):unitOutOfRange("year",Te.year)}function hasInvalidGregorianData(Te){const we=isInteger(Te.year),t=integerBetween(Te.month,1,12),te=integerBetween(Te.day,1,daysInMonth(Te.year,Te.month));return we?t?te?!1:unitOutOfRange("day",Te.day):unitOutOfRange("month",Te.month):unitOutOfRange("year",Te.year)}function hasInvalidTimeData(Te){const{hour:we,minute:t,second:te,millisecond:be}=Te,xe=integerBetween(we,0,23)||we===24&&t===0&&te===0&&be===0,ve=integerBetween(t,0,59),ke=integerBetween(te,0,59),Ie=integerBetween(be,0,999);return xe?ve?ke?Ie?!1:unitOutOfRange("millisecond",be):unitOutOfRange("second",te):unitOutOfRange("minute",t):unitOutOfRange("hour",we)}const INVALID="Invalid DateTime",MAX_DATE=864e13;function unsupportedZone(Te){return new Invalid("unsupported zone",`the zone "${Te.name}" is not supported`)}function possiblyCachedWeekData(Te){return Te.weekData===null&&(Te.weekData=gregorianToWeek(Te.c)),Te.weekData}function clone(Te,we){const t={ts:Te.ts,zone:Te.zone,c:Te.c,o:Te.o,loc:Te.loc,invalid:Te.invalid};return new DateTime(Object.assign({},t,we,{old:t}))}function fixOffset(Te,we,t){let te=Te-we*60*1e3;const be=t.offset(te);if(we===be)return[te,we];te-=(be-we)*60*1e3;const xe=t.offset(te);return be===xe?[te,be]:[Te-Math.min(be,xe)*60*1e3,Math.max(be,xe)]}function tsToObj(Te,we){Te+=we*60*1e3;const t=new Date(Te);return{year:t.getUTCFullYear(),month:t.getUTCMonth()+1,day:t.getUTCDate(),hour:t.getUTCHours(),minute:t.getUTCMinutes(),second:t.getUTCSeconds(),millisecond:t.getUTCMilliseconds()}}function objToTS(Te,we,t){return fixOffset(objToLocalTS(Te),we,t)}function adjustTime(Te,we){const t=Te.o,te=Te.c.year+Math.trunc(we.years),be=Te.c.month+Math.trunc(we.months)+Math.trunc(we.quarters)*3,xe=Object.assign({},Te.c,{year:te,month:be,day:Math.min(Te.c.day,daysInMonth(te,be))+Math.trunc(we.days)+Math.trunc(we.weeks)*7}),ve=Duration.fromObject({years:we.years-Math.trunc(we.years),quarters:we.quarters-Math.trunc(we.quarters),months:we.months-Math.trunc(we.months),weeks:we.weeks-Math.trunc(we.weeks),days:we.days-Math.trunc(we.days),hours:we.hours,minutes:we.minutes,seconds:we.seconds,milliseconds:we.milliseconds}).as("milliseconds"),ke=objToLocalTS(xe);let[Ie,Ae]=fixOffset(ke,t,Te.zone);return ve!==0&&(Ie+=ve,Ae=Te.zone.offset(Ie)),{ts:Ie,o:Ae}}function parseDataToDateTime(Te,we,t,te,be){const{setZone:xe,zone:ve}=t;if(Te&&Object.keys(Te).length!==0){const ke=we||ve,Ie=DateTime.fromObject(Object.assign(Te,t,{zone:ke,setZone:void 0}));return xe?Ie:Ie.setZone(ve)}else return DateTime.invalid(new Invalid("unparsable",`the input "${be}" can't be parsed as ${te}`))}function toTechFormat(Te,we,t=!0){return Te.isValid?Formatter.create(Locale.create("en-US"),{allowZ:t,forceSimple:!0}).formatDateTimeFromString(Te,we):null}function toTechTimeFormat(Te,{suppressSeconds:we=!1,suppressMilliseconds:t=!1,includeOffset:te,includePrefix:be=!1,includeZone:xe=!1,spaceZone:ve=!1,format:ke="extended"}){let Ie=ke==="basic"?"HHmm":"HH:mm";(!we||Te.second!==0||Te.millisecond!==0)&&(Ie+=ke==="basic"?"ss":":ss",(!t||Te.millisecond!==0)&&(Ie+=".SSS")),(xe||te)&&ve&&(Ie+=" "),xe?Ie+="z":te&&(Ie+=ke==="basic"?"ZZZ":"ZZ");let Ae=toTechFormat(Te,Ie);return be&&(Ae="T"+Ae),Ae}const defaultUnitValues={month:1,day:1,hour:0,minute:0,second:0,millisecond:0},defaultWeekUnitValues={weekNumber:1,weekday:1,hour:0,minute:0,second:0,millisecond:0},defaultOrdinalUnitValues={ordinal:1,hour:0,minute:0,second:0,millisecond:0},orderedUnits=["year","month","day","hour","minute","second","millisecond"],orderedWeekUnits=["weekYear","weekNumber","weekday","hour","minute","second","millisecond"],orderedOrdinalUnits=["year","ordinal","hour","minute","second","millisecond"];function normalizeUnit(Te){const we={year:"year",years:"year",month:"month",months:"month",day:"day",days:"day",hour:"hour",hours:"hour",minute:"minute",minutes:"minute",quarter:"quarter",quarters:"quarter",second:"second",seconds:"second",millisecond:"millisecond",milliseconds:"millisecond",weekday:"weekday",weekdays:"weekday",weeknumber:"weekNumber",weeksnumber:"weekNumber",weeknumbers:"weekNumber",weekyear:"weekYear",weekyears:"weekYear",ordinal:"ordinal"}[Te.toLowerCase()];if(!we)throw new InvalidUnitError(Te);return we}function quickDT(Te,we){for(const ke of orderedUnits)isUndefined(Te[ke])&&(Te[ke]=defaultUnitValues[ke]);const t=hasInvalidGregorianData(Te)||hasInvalidTimeData(Te);if(t)return DateTime.invalid(t);const te=Settings.now(),be=we.offset(te),[xe,ve]=objToTS(Te,be,we);return new DateTime({ts:xe,zone:we,o:ve})}function diffRelative(Te,we,t){const te=isUndefined(t.round)?!0:t.round,be=(ve,ke)=>(ve=roundTo(ve,te||t.calendary?0:2,!0),we.loc.clone(t).relFormatter(t).format(ve,ke)),xe=ve=>t.calendary?we.hasSame(Te,ve)?0:we.startOf(ve).diff(Te.startOf(ve),ve).get(ve):we.diff(Te,ve).get(ve);if(t.unit)return be(xe(t.unit),t.unit);for(const ve of t.units){const ke=xe(ve);if(Math.abs(ke)>=1)return be(ke,ve)}return be(Te>we?-0:0,t.units[t.units.length-1])}class DateTime{constructor(we){const t=we.zone||Settings.defaultZone;let te=we.invalid||(Number.isNaN(we.ts)?new Invalid("invalid input"):null)||(t.isValid?null:unsupportedZone(t));this.ts=isUndefined(we.ts)?Settings.now():we.ts;let be=null,xe=null;if(!te)if(we.old&&we.old.ts===this.ts&&we.old.zone.equals(t))[be,xe]=[we.old.c,we.old.o];else{const ke=t.offset(this.ts);be=tsToObj(this.ts,ke),te=Number.isNaN(be.year)?new Invalid("invalid input"):null,be=te?null:be,xe=te?null:ke}this._zone=t,this.loc=we.loc||Locale.create(),this.invalid=te,this.weekData=null,this.c=be,this.o=xe,this.isLuxonDateTime=!0}static now(){return new DateTime({})}static local(we,t,te,be,xe,ve,ke){return isUndefined(we)?DateTime.now():quickDT({year:we,month:t,day:te,hour:be,minute:xe,second:ve,millisecond:ke},Settings.defaultZone)}static utc(we,t,te,be,xe,ve,ke){return isUndefined(we)?new DateTime({ts:Settings.now(),zone:FixedOffsetZone.utcInstance}):quickDT({year:we,month:t,day:te,hour:be,minute:xe,second:ve,millisecond:ke},FixedOffsetZone.utcInstance)}static fromJSDate(we,t={}){const te=isDate(we)?we.valueOf():NaN;if(Number.isNaN(te))return DateTime.invalid("invalid input");const be=normalizeZone(t.zone,Settings.defaultZone);return be.isValid?new DateTime({ts:te,zone:be,loc:Locale.fromObject(t)}):DateTime.invalid(unsupportedZone(be))}static fromMillis(we,t={}){if(isNumber(we))return we<-MAX_DATE||we>MAX_DATE?DateTime.invalid("Timestamp out of range"):new DateTime({ts:we,zone:normalizeZone(t.zone,Settings.defaultZone),loc:Locale.fromObject(t)});throw new InvalidArgumentError(`fromMillis requires a numerical input, but received a ${typeof we} with value ${we}`)}static fromSeconds(we,t={}){if(isNumber(we))return new DateTime({ts:we*1e3,zone:normalizeZone(t.zone,Settings.defaultZone),loc:Locale.fromObject(t)});throw new InvalidArgumentError("fromSeconds requires a numerical input")}static fromObject(we){const t=normalizeZone(we.zone,Settings.defaultZone);if(!t.isValid)return DateTime.invalid(unsupportedZone(t));const te=Settings.now(),be=t.offset(te),xe=normalizeObject(we,normalizeUnit,["zone","locale","outputCalendar","numberingSystem"]),ve=!isUndefined(xe.ordinal),ke=!isUndefined(xe.year),Ie=!isUndefined(xe.month)||!isUndefined(xe.day),Ae=ke||Ie,Se=xe.weekYear||xe.weekNumber,Oe=Locale.fromObject(we);if((Ae||ve)&&Se)throw new ConflictingSpecificationError("Can't mix weekYear/weekNumber units with year/month/day or ordinals");if(Ie&&ve)throw new ConflictingSpecificationError("Can't mix ordinal dates with month/day");const Ve=Se||xe.weekday&&!Ae;let Me,De,Fe=tsToObj(te,be);Ve?(Me=orderedWeekUnits,De=defaultWeekUnitValues,Fe=gregorianToWeek(Fe)):ve?(Me=orderedOrdinalUnits,De=defaultOrdinalUnitValues,Fe=gregorianToOrdinal(Fe)):(Me=orderedUnits,De=defaultUnitValues);let Be=!1;for(const Qe of Me){const je=xe[Qe];isUndefined(je)?Be?xe[Qe]=De[Qe]:xe[Qe]=Fe[Qe]:Be=!0}const $e=Ve?hasInvalidWeekData(xe):ve?hasInvalidOrdinalData(xe):hasInvalidGregorianData(xe),Ue=$e||hasInvalidTimeData(xe);if(Ue)return DateTime.invalid(Ue);const He=Ve?weekToGregorian(xe):ve?ordinalToGregorian(xe):xe,[ze,qe]=objToTS(He,be,t),Ke=new DateTime({ts:ze,zone:t,o:qe,loc:Oe});return xe.weekday&&Ae&&we.weekday!==Ke.weekday?DateTime.invalid("mismatched weekday",`you can't specify both a weekday of ${xe.weekday} and a date of ${Ke.toISO()}`):Ke}static fromISO(we,t={}){const[te,be]=parseISODate(we);return parseDataToDateTime(te,be,t,"ISO 8601",we)}static fromRFC2822(we,t={}){const[te,be]=parseRFC2822Date(we);return parseDataToDateTime(te,be,t,"RFC 2822",we)}static fromHTTP(we,t={}){const[te,be]=parseHTTPDate(we);return parseDataToDateTime(te,be,t,"HTTP",t)}static fromFormat(we,t,te={}){if(isUndefined(we)||isUndefined(t))throw new InvalidArgumentError("fromFormat requires an input string and a format");const{locale:be=null,numberingSystem:xe=null}=te,ve=Locale.fromOpts({locale:be,numberingSystem:xe,defaultToEN:!0}),[ke,Ie,Ae]=parseFromTokens(ve,we,t);return Ae?DateTime.invalid(Ae):parseDataToDateTime(ke,Ie,te,`format ${t}`,we)}static fromString(we,t,te={}){return DateTime.fromFormat(we,t,te)}static fromSQL(we,t={}){const[te,be]=parseSQL(we);return parseDataToDateTime(te,be,t,"SQL",we)}static invalid(we,t=null){if(!we)throw new InvalidArgumentError("need to specify a reason the DateTime is invalid");const te=we instanceof Invalid?we:new Invalid(we,t);if(Settings.throwOnInvalid)throw new InvalidDateTimeError(te);return new DateTime({invalid:te})}static isDateTime(we){return we&&we.isLuxonDateTime||!1}get(we){return this[we]}get isValid(){return this.invalid===null}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}get locale(){return this.isValid?this.loc.locale:null}get numberingSystem(){return this.isValid?this.loc.numberingSystem:null}get outputCalendar(){return this.isValid?this.loc.outputCalendar:null}get zone(){return this._zone}get zoneName(){return this.isValid?this.zone.name:null}get year(){return this.isValid?this.c.year:NaN}get quarter(){return this.isValid?Math.ceil(this.c.month/3):NaN}get month(){return this.isValid?this.c.month:NaN}get day(){return this.isValid?this.c.day:NaN}get hour(){return this.isValid?this.c.hour:NaN}get minute(){return this.isValid?this.c.minute:NaN}get second(){return this.isValid?this.c.second:NaN}get millisecond(){return this.isValid?this.c.millisecond:NaN}get weekYear(){return this.isValid?possiblyCachedWeekData(this).weekYear:NaN}get weekNumber(){return this.isValid?possiblyCachedWeekData(this).weekNumber:NaN}get weekday(){return this.isValid?possiblyCachedWeekData(this).weekday:NaN}get ordinal(){return this.isValid?gregorianToOrdinal(this.c).ordinal:NaN}get monthShort(){return this.isValid?Info.months("short",{locObj:this.loc})[this.month-1]:null}get monthLong(){return this.isValid?Info.months("long",{locObj:this.loc})[this.month-1]:null}get weekdayShort(){return this.isValid?Info.weekdays("short",{locObj:this.loc})[this.weekday-1]:null}get weekdayLong(){return this.isValid?Info.weekdays("long",{locObj:this.loc})[this.weekday-1]:null}get offset(){return this.isValid?+this.o:NaN}get offsetNameShort(){return this.isValid?this.zone.offsetName(this.ts,{format:"short",locale:this.locale}):null}get offsetNameLong(){return this.isValid?this.zone.offsetName(this.ts,{format:"long",locale:this.locale}):null}get isOffsetFixed(){return this.isValid?this.zone.universal:null}get isInDST(){return this.isOffsetFixed?!1:this.offset>this.set({month:1}).offset||this.offset>this.set({month:5}).offset}get isInLeapYear(){return isLeapYear(this.year)}get daysInMonth(){return daysInMonth(this.year,this.month)}get daysInYear(){return this.isValid?daysInYear(this.year):NaN}get weeksInWeekYear(){return this.isValid?weeksInWeekYear(this.weekYear):NaN}resolvedLocaleOpts(we={}){const{locale:t,numberingSystem:te,calendar:be}=Formatter.create(this.loc.clone(we),we).resolvedOptions(this);return{locale:t,numberingSystem:te,outputCalendar:be}}toUTC(we=0,t={}){return this.setZone(FixedOffsetZone.instance(we),t)}toLocal(){return this.setZone(Settings.defaultZone)}setZone(we,{keepLocalTime:t=!1,keepCalendarTime:te=!1}={}){if(we=normalizeZone(we,Settings.defaultZone),we.equals(this.zone))return this;if(we.isValid){let be=this.ts;if(t||te){const xe=we.offset(this.ts),ve=this.toObject();[be]=objToTS(ve,xe,we)}return clone(this,{ts:be,zone:we})}else return DateTime.invalid(unsupportedZone(we))}reconfigure({locale:we,numberingSystem:t,outputCalendar:te}={}){const be=this.loc.clone({locale:we,numberingSystem:t,outputCalendar:te});return clone(this,{loc:be})}setLocale(we){return this.reconfigure({locale:we})}set(we){if(!this.isValid)return this;const t=normalizeObject(we,normalizeUnit,[]),te=!isUndefined(t.weekYear)||!isUndefined(t.weekNumber)||!isUndefined(t.weekday),be=!isUndefined(t.ordinal),xe=!isUndefined(t.year),ve=!isUndefined(t.month)||!isUndefined(t.day),ke=xe||ve,Ie=t.weekYear||t.weekNumber;if((ke||be)&&Ie)throw new ConflictingSpecificationError("Can't mix weekYear/weekNumber units with year/month/day or ordinals");if(ve&&be)throw new ConflictingSpecificationError("Can't mix ordinal dates with month/day");let Ae;te?Ae=weekToGregorian(Object.assign(gregorianToWeek(this.c),t)):isUndefined(t.ordinal)?(Ae=Object.assign(this.toObject(),t),isUndefined(t.day)&&(Ae.day=Math.min(daysInMonth(Ae.year,Ae.month),Ae.day))):Ae=ordinalToGregorian(Object.assign(gregorianToOrdinal(this.c),t));const[Se,Oe]=objToTS(Ae,this.o,this.zone);return clone(this,{ts:Se,o:Oe})}plus(we){if(!this.isValid)return this;const t=friendlyDuration(we);return clone(this,adjustTime(this,t))}minus(we){if(!this.isValid)return this;const t=friendlyDuration(we).negate();return clone(this,adjustTime(this,t))}startOf(we){if(!this.isValid)return this;const t={},te=Duration.normalizeUnit(we);switch(te){case"years":t.month=1;case"quarters":case"months":t.day=1;case"weeks":case"days":t.hour=0;case"hours":t.minute=0;case"minutes":t.second=0;case"seconds":t.millisecond=0;break}if(te==="weeks"&&(t.weekday=1),te==="quarters"){const be=Math.ceil(this.month/3);t.month=(be-1)*3+1}return this.set(t)}endOf(we){return this.isValid?this.plus({[we]:1}).startOf(we).minus(1):this}toFormat(we,t={}){return this.isValid?Formatter.create(this.loc.redefaultToEN(t)).formatDateTimeFromString(this,we):INVALID}toLocaleString(we=DATE_SHORT){return this.isValid?Formatter.create(this.loc.clone(we),we).formatDateTime(this):INVALID}toLocaleParts(we={}){return this.isValid?Formatter.create(this.loc.clone(we),we).formatDateTimeParts(this):[]}toISO(we={}){return this.isValid?`${this.toISODate(we)}T${this.toISOTime(we)}`:null}toISODate({format:we="extended"}={}){let t=we==="basic"?"yyyyMMdd":"yyyy-MM-dd";return this.year>9999&&(t="+"+t),toTechFormat(this,t)}toISOWeekDate(){return toTechFormat(this,"kkkk-'W'WW-c")}toISOTime({suppressMilliseconds:we=!1,suppressSeconds:t=!1,includeOffset:te=!0,includePrefix:be=!1,format:xe="extended"}={}){return toTechTimeFormat(this,{suppressSeconds:t,suppressMilliseconds:we,includeOffset:te,includePrefix:be,format:xe})}toRFC2822(){return toTechFormat(this,"EEE, dd LLL yyyy HH:mm:ss ZZZ",!1)}toHTTP(){return toTechFormat(this.toUTC(),"EEE, dd LLL yyyy HH:mm:ss 'GMT'")}toSQLDate(){return toTechFormat(this,"yyyy-MM-dd")}toSQLTime({includeOffset:we=!0,includeZone:t=!1}={}){return toTechTimeFormat(this,{includeOffset:we,includeZone:t,spaceZone:!0})}toSQL(we={}){return this.isValid?`${this.toSQLDate()} ${this.toSQLTime(we)}`:null}toString(){return this.isValid?this.toISO():INVALID}valueOf(){return this.toMillis()}toMillis(){return this.isValid?this.ts:NaN}toSeconds(){return this.isValid?this.ts/1e3:NaN}toJSON(){return this.toISO()}toBSON(){return this.toJSDate()}toObject(we={}){if(!this.isValid)return{};const t=Object.assign({},this.c);return we.includeConfig&&(t.outputCalendar=this.outputCalendar,t.numberingSystem=this.loc.numberingSystem,t.locale=this.loc.locale),t}toJSDate(){return new Date(this.isValid?this.ts:NaN)}diff(we,t="milliseconds",te={}){if(!this.isValid||!we.isValid)return Duration.invalid(this.invalid||we.invalid,"created by diffing an invalid DateTime");const be=Object.assign({locale:this.locale,numberingSystem:this.numberingSystem},te),xe=maybeArray(t).map(Duration.normalizeUnit),ve=we.valueOf()>this.valueOf(),ke=ve?this:we,Ie=ve?we:this,Ae=diff(ke,Ie,xe,be);return ve?Ae.negate():Ae}diffNow(we="milliseconds",t={}){return this.diff(DateTime.now(),we,t)}until(we){return this.isValid?Interval.fromDateTimes(this,we):this}hasSame(we,t){if(!this.isValid)return!1;const te=we.valueOf(),be=this.setZone(we.zone,{keepLocalTime:!0});return be.startOf(t)<=te&&te<=be.endOf(t)}equals(we){return this.isValid&&we.isValid&&this.valueOf()===we.valueOf()&&this.zone.equals(we.zone)&&this.loc.equals(we.loc)}toRelative(we={}){if(!this.isValid)return null;const t=we.base||DateTime.fromObject({zone:this.zone}),te=we.padding?this<t?-we.padding:we.padding:0;let be=["years","months","days","hours","minutes","seconds"],xe=we.unit;return Array.isArray(we.unit)&&(be=we.unit,xe=void 0),diffRelative(t,this.plus(te),Object.assign(we,{numeric:"always",units:be,unit:xe}))}toRelativeCalendar(we={}){return this.isValid?diffRelative(we.base||DateTime.fromObject({zone:this.zone}),this,Object.assign(we,{numeric:"auto",units:["years","months","days"],calendary:!0})):null}static min(...we){if(!we.every(DateTime.isDateTime))throw new InvalidArgumentError("min requires all arguments be DateTimes");return bestBy(we,t=>t.valueOf(),Math.min)}static max(...we){if(!we.every(DateTime.isDateTime))throw new InvalidArgumentError("max requires all arguments be DateTimes");return bestBy(we,t=>t.valueOf(),Math.max)}static fromFormatExplain(we,t,te={}){const{locale:be=null,numberingSystem:xe=null}=te,ve=Locale.fromOpts({locale:be,numberingSystem:xe,defaultToEN:!0});return explainFromTokens(ve,we,t)}static fromStringExplain(we,t,te={}){return DateTime.fromFormatExplain(we,t,te)}static get DATE_SHORT(){return DATE_SHORT}static get DATE_MED(){return DATE_MED}static get DATE_MED_WITH_WEEKDAY(){return DATE_MED_WITH_WEEKDAY}static get DATE_FULL(){return DATE_FULL}static get DATE_HUGE(){return DATE_HUGE}static get TIME_SIMPLE(){return TIME_SIMPLE}static get TIME_WITH_SECONDS(){return TIME_WITH_SECONDS}static get TIME_WITH_SHORT_OFFSET(){return TIME_WITH_SHORT_OFFSET}static get TIME_WITH_LONG_OFFSET(){return TIME_WITH_LONG_OFFSET}static get TIME_24_SIMPLE(){return TIME_24_SIMPLE}static get TIME_24_WITH_SECONDS(){return TIME_24_WITH_SECONDS}static get TIME_24_WITH_SHORT_OFFSET(){return TIME_24_WITH_SHORT_OFFSET}static get TIME_24_WITH_LONG_OFFSET(){return TIME_24_WITH_LONG_OFFSET}static get DATETIME_SHORT(){return DATETIME_SHORT}static get DATETIME_SHORT_WITH_SECONDS(){return DATETIME_SHORT_WITH_SECONDS}static get DATETIME_MED(){return DATETIME_MED}static get DATETIME_MED_WITH_SECONDS(){return DATETIME_MED_WITH_SECONDS}static get DATETIME_MED_WITH_WEEKDAY(){return DATETIME_MED_WITH_WEEKDAY}static get DATETIME_FULL(){return DATETIME_FULL}static get DATETIME_FULL_WITH_SECONDS(){return DATETIME_FULL_WITH_SECONDS}static get DATETIME_HUGE(){return DATETIME_HUGE}static get DATETIME_HUGE_WITH_SECONDS(){return DATETIME_HUGE_WITH_SECONDS}}function friendlyDateTime(Te){if(DateTime.isDateTime(Te))return Te;if(Te&&Te.valueOf&&isNumber(Te.valueOf()))return DateTime.fromJSDate(Te);if(Te&&typeof Te=="object")return DateTime.fromObject(Te);throw new InvalidArgumentError(`Unknown datetime argument: ${Te}, of type ${typeof Te}`)}class a extends ObservableMixin(){constructor(t){super();Re(this,"id");Re(this,"creator");Re(this,"authors");Re(this,"diffData");Re(this,"toVersion");Re(this,"fromVersion");Re(this,"model");this.id=t.id||uid(),this.creator=t.creator||null,this.authors=t.authors||[],this.diffData=t.diffData||null,this.toVersion=t.toVersion||0,this.fromVersion=t.fromVersion||0,this.set("name",t.name||""),this.set("createdAt",t.createdAt||new Date),this.set("attributes",t.attributes||{})}setName(t){this._update({name:t})}setAttribute(t,te){const be=cloneDeep(this.attributes);set$1(be,t,te),this._update({attributes:be})}removeAttribute(t){const te=cloneDeep(this.attributes);unset(te,t),this._update({attributes:te})}_update(t,te=!1){let be=!1;const xe={id:this.id},ve=["name","createdAt","diffData","authors","attributes","toVersion","fromVersion","creatorId"];for(const ke of ve){const Ie=t[ke];Ie!==void 0&&Ie!==this[ke]&&(this[ke]=Ie,xe[ke]=Ie,be=!0)}be&&(xe.authors&&(xe.authorsIds=xe.authors.map(ke=>ke.id),delete xe.authors),this.fire("_update",xe,te))}toJSON(){return{id:this.id,name:this.name,creatorId:this.creator?this.creator.id:null,authorsIds:this.authors.map(t=>t.id),diffData:this.diffData,createdAt:this.createdAt,attributes:this.attributes,fromVersion:this.fromVersion,toVersion:this.toVersion}}}class A extends Plugin{constructor(t){super(t);Re(this,"_revisions");this._revisions=new Collection}static get requires(){return[l$8]}static get pluginName(){return"RevisionsRepository"}get length(){return this._revisions.length}afterInit(){(function(t){function te(xe,ve,ke){const Ie={};Ie[be([110,117,109,98,101,114,79,102,82,111,117,110,100,115])]={16:10,24:12,32:14},Ie[be([114,99,111,110])]=[1,2,4,8,16,32,64,128,27,54,108,216,171,77,154,47,94,188,99,198,151,53,106,212,179,125,250,239,197,145],Ie[be([83])]=[99,124,119,123,242,107,111,197,48,1,103,43,254,215,171,118,202,130,201,125,250,89,71,240,173,212,162,175,156,164,114,192,183,253,147,38,54,63,247,204,52,165,229,241,113,216,49,21,4,199,35,195,24,150,5,154,7,18,128,226,235,39,178,117,9,131,44,26,27,110,90,160,82,59,214,179,41,227,47,132,83,209,0,237,32,252,177,91,106,203,190,57,74,76,88,207,208,239,170,251,67,77,51,133,69,249,2,127,80,60,159,168,81,163,64,143,146,157,56,245,188,182,218,33,16,255,243,210,205,12,19,236,95,151,68,23,196,167,126,61,100,93,25,115,96,129,79,220,34,42,144,136,70,238,184,20,222,94,11,219,224,50,58,10,73,6,36,92,194,211,172,98,145,149,228,121,231,200,55,109,141,213,78,169,108,86,244,234,101,122,174,8,186,120,37,46,28,166,180,198,232,221,116,31,75,189,139,138,112,62,181,102,72,3,246,14,97,53,87,185,134,193,29,158,225,248,152,17,105,217,142,148,155,30,135,233,206,85,40,223,140,161,137,13,191,230,66,104,65,153,45,15,176,84,187,22],Ie[be([84,49])]=[3328402341,4168907908,4000806809,4135287693,4294111757,3597364157,3731845041,2445657428,1613770832,33620227,3462883241,1445669757,3892248089,3050821474,1303096294,3967186586,2412431941,528646813,2311702848,4202528135,4026202645,2992200171,2387036105,4226871307,1101901292,3017069671,1604494077,1169141738,597466303,1403299063,3832705686,2613100635,1974974402,3791519004,1033081774,1277568618,1815492186,2118074177,4126668546,2211236943,1748251740,1369810420,3521504564,4193382664,3799085459,2883115123,1647391059,706024767,134480908,2512897874,1176707941,2646852446,806885416,932615841,168101135,798661301,235341577,605164086,461406363,3756188221,3454790438,1311188841,2142417613,3933566367,302582043,495158174,1479289972,874125870,907746093,3698224818,3025820398,1537253627,2756858614,1983593293,3084310113,2108928974,1378429307,3722699582,1580150641,327451799,2790478837,3117535592,0,3253595436,1075847264,3825007647,2041688520,3059440621,3563743934,2378943302,1740553945,1916352843,2487896798,2555137236,2958579944,2244988746,3151024235,3320835882,1336584933,3992714006,2252555205,2588757463,1714631509,293963156,2319795663,3925473552,67240454,4269768577,2689618160,2017213508,631218106,1269344483,2723238387,1571005438,2151694528,93294474,1066570413,563977660,1882732616,4059428100,1673313503,2008463041,2950355573,1109467491,537923632,3858759450,4260623118,3218264685,2177748300,403442708,638784309,3287084079,3193921505,899127202,2286175436,773265209,2479146071,1437050866,4236148354,2050833735,3362022572,3126681063,840505643,3866325909,3227541664,427917720,2655997905,2749160575,1143087718,1412049534,999329963,193497219,2353415882,3354324521,1807268051,672404540,2816401017,3160301282,369822493,2916866934,3688947771,1681011286,1949973070,336202270,2454276571,201721354,1210328172,3093060836,2680341085,3184776046,1135389935,3294782118,965841320,831886756,3554993207,4068047243,3588745010,2345191491,1849112409,3664604599,26054028,2983581028,2622377682,1235855840,3630984372,2891339514,4092916743,3488279077,3395642799,4101667470,1202630377,268961816,1874508501,4034427016,1243948399,1546530418,941366308,1470539505,1941222599,2546386513,3421038627,2715671932,3899946140,1042226977,2521517021,1639824860,227249030,260737669,3765465232,2084453954,1907733956,3429263018,2420656344,100860677,4160157185,470683154,3261161891,1781871967,2924959737,1773779408,394692241,2579611992,974986535,664706745,3655459128,3958962195,731420851,571543859,3530123707,2849626480,126783113,865375399,765172662,1008606754,361203602,3387549984,2278477385,2857719295,1344809080,2782912378,59542671,1503764984,160008576,437062935,1707065306,3622233649,2218934982,3496503480,2185314755,697932208,1512910199,504303377,2075177163,2824099068,1841019862,739644986],Ie[be([84,50])]=[2781242211,2230877308,2582542199,2381740923,234877682,3184946027,2984144751,1418839493,1348481072,50462977,2848876391,2102799147,434634494,1656084439,3863849899,2599188086,1167051466,2636087938,1082771913,2281340285,368048890,3954334041,3381544775,201060592,3963727277,1739838676,4250903202,3930435503,3206782108,4149453988,2531553906,1536934080,3262494647,484572669,2923271059,1783375398,1517041206,1098792767,49674231,1334037708,1550332980,4098991525,886171109,150598129,2481090929,1940642008,1398944049,1059722517,201851908,1385547719,1699095331,1587397571,674240536,2704774806,252314885,3039795866,151914247,908333586,2602270848,1038082786,651029483,1766729511,3447698098,2682942837,454166793,2652734339,1951935532,775166490,758520603,3000790638,4004797018,4217086112,4137964114,1299594043,1639438038,3464344499,2068982057,1054729187,1901997871,2534638724,4121318227,1757008337,0,750906861,1614815264,535035132,3363418545,3988151131,3201591914,1183697867,3647454910,1265776953,3734260298,3566750796,3903871064,1250283471,1807470800,717615087,3847203498,384695291,3313910595,3617213773,1432761139,2484176261,3481945413,283769337,100925954,2180939647,4037038160,1148730428,3123027871,3813386408,4087501137,4267549603,3229630528,2315620239,2906624658,3156319645,1215313976,82966005,3747855548,3245848246,1974459098,1665278241,807407632,451280895,251524083,1841287890,1283575245,337120268,891687699,801369324,3787349855,2721421207,3431482436,959321879,1469301956,4065699751,2197585534,1199193405,2898814052,3887750493,724703513,2514908019,2696962144,2551808385,3516813135,2141445340,1715741218,2119445034,2872807568,2198571144,3398190662,700968686,3547052216,1009259540,2041044702,3803995742,487983883,1991105499,1004265696,1449407026,1316239930,504629770,3683797321,168560134,1816667172,3837287516,1570751170,1857934291,4014189740,2797888098,2822345105,2754712981,936633572,2347923833,852879335,1133234376,1500395319,3084545389,2348912013,1689376213,3533459022,3762923945,3034082412,4205598294,133428468,634383082,2949277029,2398386810,3913789102,403703816,3580869306,2297460856,1867130149,1918643758,607656988,4049053350,3346248884,1368901318,600565992,2090982877,2632479860,557719327,3717614411,3697393085,2249034635,2232388234,2430627952,1115438654,3295786421,2865522278,3633334344,84280067,33027830,303828494,2747425121,1600795957,4188952407,3496589753,2434238086,1486471617,658119965,3106381470,953803233,334231800,3005978776,857870609,3151128937,1890179545,2298973838,2805175444,3056442267,574365214,2450884487,550103529,1233637070,4289353045,2018519080,2057691103,2399374476,4166623649,2148108681,387583245,3664101311,836232934,3330556482,3100665960,3280093505,2955516313,2002398509,287182607,3413881008,4238890068,3597515707,975967766],Ie[be([84,51])]=[1671808611,2089089148,2006576759,2072901243,4061003762,1807603307,1873927791,3310653893,810573872,16974337,1739181671,729634347,4263110654,3613570519,2883997099,1989864566,3393556426,2191335298,3376449993,2106063485,4195741690,1508618841,1204391495,4027317232,2917941677,3563566036,2734514082,2951366063,2629772188,2767672228,1922491506,3227229120,3082974647,4246528509,2477669779,644500518,911895606,1061256767,4144166391,3427763148,878471220,2784252325,3845444069,4043897329,1905517169,3631459288,827548209,356461077,67897348,3344078279,593839651,3277757891,405286936,2527147926,84871685,2595565466,118033927,305538066,2157648768,3795705826,3945188843,661212711,2999812018,1973414517,152769033,2208177539,745822252,439235610,455947803,1857215598,1525593178,2700827552,1391895634,994932283,3596728278,3016654259,695947817,3812548067,795958831,2224493444,1408607827,3513301457,0,3979133421,543178784,4229948412,2982705585,1542305371,1790891114,3410398667,3201918910,961245753,1256100938,1289001036,1491644504,3477767631,3496721360,4012557807,2867154858,4212583931,1137018435,1305975373,861234739,2241073541,1171229253,4178635257,33948674,2139225727,1357946960,1011120188,2679776671,2833468328,1374921297,2751356323,1086357568,2408187279,2460827538,2646352285,944271416,4110742005,3168756668,3066132406,3665145818,560153121,271589392,4279952895,4077846003,3530407890,3444343245,202643468,322250259,3962553324,1608629855,2543990167,1154254916,389623319,3294073796,2817676711,2122513534,1028094525,1689045092,1575467613,422261273,1939203699,1621147744,2174228865,1339137615,3699352540,577127458,712922154,2427141008,2290289544,1187679302,3995715566,3100863416,339486740,3732514782,1591917662,186455563,3681988059,3762019296,844522546,978220090,169743370,1239126601,101321734,611076132,1558493276,3260915650,3547250131,2901361580,1655096418,2443721105,2510565781,3828863972,2039214713,3878868455,3359869896,928607799,1840765549,2374762893,3580146133,1322425422,2850048425,1823791212,1459268694,4094161908,3928346602,1706019429,2056189050,2934523822,135794696,3134549946,2022240376,628050469,779246638,472135708,2800834470,3032970164,3327236038,3894660072,3715932637,1956440180,522272287,1272813131,3185336765,2340818315,2323976074,1888542832,1044544574,3049550261,1722469478,1222152264,50660867,4127324150,236067854,1638122081,895445557,1475980887,3117443513,2257655686,3243809217,489110045,2662934430,3778599393,4162055160,2561878936,288563729,1773916777,3648039385,2391345038,2493985684,2612407707,505560094,2274497927,3911240169,3460925390,1442818645,678973480,3749357023,2358182796,2717407649,2306869641,219617805,3218761151,3862026214,1120306242,1756942440,1103331905,2578459033,762796589,252780047,2966125488,1425844308,3151392187,372911126],Ie[be([84,52])]=[1667474886,2088535288,2004326894,2071694838,4075949567,1802223062,1869591006,3318043793,808472672,16843522,1734846926,724270422,4278065639,3621216949,2880169549,1987484396,3402253711,2189597983,3385409673,2105378810,4210693615,1499065266,1195886990,4042263547,2913856577,3570689971,2728590687,2947541573,2627518243,2762274643,1920112356,3233831835,3082273397,4261223649,2475929149,640051788,909531756,1061110142,4160160501,3435941763,875846760,2779116625,3857003729,4059105529,1903268834,3638064043,825316194,353713962,67374088,3351728789,589522246,3284360861,404236336,2526454071,84217610,2593830191,117901582,303183396,2155911963,3806477791,3958056653,656894286,2998062463,1970642922,151591698,2206440989,741110872,437923380,454765878,1852748508,1515908788,2694904667,1381168804,993742198,3604373943,3014905469,690584402,3823320797,791638366,2223281939,1398011302,3520161977,0,3991743681,538992704,4244381667,2981218425,1532751286,1785380564,3419096717,3200178535,960056178,1246420628,1280103576,1482221744,3486468741,3503319995,4025428677,2863326543,4227536621,1128514950,1296947098,859002214,2240123921,1162203018,4193849577,33687044,2139062782,1347481760,1010582648,2678045221,2829640523,1364325282,2745433693,1077985408,2408548869,2459086143,2644360225,943212656,4126475505,3166494563,3065430391,3671750063,555836226,269496352,4294908645,4092792573,3537006015,3452783745,202118168,320025894,3974901699,1600119230,2543297077,1145359496,387397934,3301201811,2812801621,2122220284,1027426170,1684319432,1566435258,421079858,1936954854,1616945344,2172753945,1330631070,3705438115,572679748,707427924,2425400123,2290647819,1179044492,4008585671,3099120491,336870440,3739122087,1583276732,185277718,3688593069,3772791771,842159716,976899700,168435220,1229577106,101059084,606366792,1549591736,3267517855,3553849021,2897014595,1650632388,2442242105,2509612081,3840161747,2038008818,3890688725,3368567691,926374254,1835907034,2374863873,3587531953,1313788572,2846482505,1819063512,1448540844,4109633523,3941213647,1701162954,2054852340,2930698567,134748176,3132806511,2021165296,623210314,774795868,471606328,2795958615,3031746419,3334885783,3907527627,3722280097,1953799400,522133822,1263263126,3183336545,2341176845,2324333839,1886425312,1044267644,3048588401,1718004428,1212733584,50529542,4143317495,235803164,1633788866,892690282,1465383342,3115962473,2256965911,3250673817,488449850,2661202215,3789633753,4177007595,2560144171,286339874,1768537042,3654906025,2391705863,2492770099,2610673197,505291324,2273808917,3924369609,3469625735,1431699370,673740880,3755965093,2358021891,2711746649,2307489801,218961690,3217021541,3873845719,1111672452,1751693520,1094828930,2576986153,757954394,252645662,2964376443,1414855848,3149649517,370555436],Ie[be([85,49])]=[0,235474187,470948374,303765277,941896748,908933415,607530554,708780849,1883793496,2118214995,1817866830,1649639237,1215061108,1181045119,1417561698,1517767529,3767586992,4003061179,4236429990,4069246893,3635733660,3602770327,3299278474,3400528769,2430122216,2664543715,2362090238,2193862645,2835123396,2801107407,3035535058,3135740889,3678124923,3576870512,3341394285,3374361702,3810496343,3977675356,4279080257,4043610186,2876494627,2776292904,3076639029,3110650942,2472011535,2640243204,2403728665,2169303058,1001089995,899835584,666464733,699432150,59727847,226906860,530400753,294930682,1273168787,1172967064,1475418501,1509430414,1942435775,2110667444,1876241833,1641816226,2910219766,2743034109,2976151520,3211623147,2505202138,2606453969,2302690252,2269728455,3711829422,3543599269,3240894392,3475313331,3843699074,3943906441,4178062228,4144047775,1306967366,1139781709,1374988112,1610459739,1975683434,2076935265,1775276924,1742315127,1034867998,866637845,566021896,800440835,92987698,193195065,429456164,395441711,1984812685,2017778566,1784663195,1683407248,1315562145,1080094634,1383856311,1551037884,101039829,135050206,437757123,337553864,1042385657,807962610,573804783,742039012,2531067453,2564033334,2328828971,2227573024,2935566865,2700099354,3001755655,3168937228,3868552805,3902563182,4203181171,4102977912,3736164937,3501741890,3265478751,3433712980,1106041591,1340463100,1576976609,1408749034,2043211483,2009195472,1708848333,1809054150,832877231,1068351396,766945465,599762354,159417987,126454664,361929877,463180190,2709260871,2943682380,3178106961,3009879386,2572697195,2538681184,2236228733,2336434550,3509871135,3745345300,3441850377,3274667266,3910161971,3877198648,4110568485,4211818798,2597806476,2497604743,2261089178,2295101073,2733856160,2902087851,3202437046,2968011453,3936291284,3835036895,4136440770,4169408201,3535486456,3702665459,3467192302,3231722213,2051518780,1951317047,1716890410,1750902305,1113818384,1282050075,1584504582,1350078989,168810852,67556463,371049330,404016761,841739592,1008918595,775550814,540080725,3969562369,3801332234,4035489047,4269907996,3569255213,3669462566,3366754619,3332740144,2631065433,2463879762,2160117071,2395588676,2767645557,2868897406,3102011747,3069049960,202008497,33778362,270040487,504459436,875451293,975658646,675039627,641025152,2084704233,1917518562,1615861247,1851332852,1147550661,1248802510,1484005843,1451044056,933301370,967311729,733156972,632953703,260388950,25965917,328671808,496906059,1206477858,1239443753,1543208500,1441952575,2144161806,1908694277,1675577880,1842759443,3610369226,3644379585,3408119516,3307916247,4011190502,3776767469,4077384432,4245618683,2809771154,2842737049,3144396420,3043140495,2673705150,2438237621,2203032232,2370213795],Ie[be([85,50])]=[0,185469197,370938394,487725847,741876788,657861945,975451694,824852259,1483753576,1400783205,1315723890,1164071807,1950903388,2135319889,1649704518,1767536459,2967507152,3152976349,2801566410,2918353863,2631447780,2547432937,2328143614,2177544179,3901806776,3818836405,4270639778,4118987695,3299409036,3483825537,3535072918,3652904859,2077965243,1893020342,1841768865,1724457132,1474502543,1559041666,1107234197,1257309336,598438867,681933534,901210569,1052338372,261314535,77422314,428819965,310463728,3409685355,3224740454,3710368113,3593056380,3875770207,3960309330,4045380933,4195456072,2471224067,2554718734,2237133081,2388260884,3212035895,3028143674,2842678573,2724322336,4138563181,4255350624,3769721975,3955191162,3667219033,3516619604,3431546947,3347532110,2933734917,2782082824,3099667487,3016697106,2196052529,2313884476,2499348523,2683765030,1179510461,1296297904,1347548327,1533017514,1786102409,1635502980,2087309459,2003294622,507358933,355706840,136428751,53458370,839224033,957055980,605657339,790073846,2373340630,2256028891,2607439820,2422494913,2706270690,2856345839,3075636216,3160175349,3573941694,3725069491,3273267108,3356761769,4181598602,4063242375,4011996048,3828103837,1033297158,915985419,730517276,545572369,296679730,446754879,129166120,213705253,1709610350,1860738147,1945798516,2029293177,1239331162,1120974935,1606591296,1422699085,4148292826,4233094615,3781033664,3931371469,3682191598,3497509347,3446004468,3328955385,2939266226,2755636671,3106780840,2988687269,2198438022,2282195339,2501218972,2652609425,1201765386,1286567175,1371368976,1521706781,1805211710,1620529459,2105887268,1988838185,533804130,350174575,164439672,46346101,870912086,954669403,636813900,788204353,2358957921,2274680428,2592523643,2441661558,2695033685,2880240216,3065962831,3182487618,3572145929,3756299780,3270937875,3388507166,4174560061,4091327024,4006521127,3854606378,1014646705,930369212,711349675,560487590,272786309,457992840,106852767,223377554,1678381017,1862534868,1914052035,2031621326,1211247597,1128014560,1580087799,1428173050,32283319,182621114,401639597,486441376,768917123,651868046,1003007129,818324884,1503449823,1385356242,1333838021,1150208456,1973745387,2125135846,1673061617,1756818940,2970356327,3120694122,2802849917,2887651696,2637442643,2520393566,2334669897,2149987652,3917234703,3799141122,4284502037,4100872472,3309594171,3460984630,3545789473,3629546796,2050466060,1899603969,1814803222,1730525723,1443857720,1560382517,1075025698,1260232239,575138148,692707433,878443390,1062597235,243256656,91341917,409198410,325965383,3403100636,3252238545,3704300486,3620022987,3874428392,3990953189,4042459122,4227665663,2460449204,2578018489,2226875310,2411029155,3198115200,3046200461,2827177882,2743944855],Ie[be([85,51])]=[0,218828297,437656594,387781147,875313188,958871085,775562294,590424639,1750626376,1699970625,1917742170,2135253587,1551124588,1367295589,1180849278,1265195639,3501252752,3720081049,3399941250,3350065803,3835484340,3919042237,4270507174,4085369519,3102249176,3051593425,2734591178,2952102595,2361698556,2177869557,2530391278,2614737639,3145456443,3060847922,2708326185,2892417312,2404901663,2187128086,2504130317,2555048196,3542330227,3727205754,3375740769,3292445032,3876557655,3926170974,4246310725,4027744588,1808481195,1723872674,1910319033,2094410160,1608975247,1391201670,1173430173,1224348052,59984867,244860394,428169201,344873464,935293895,984907214,766078933,547512796,1844882806,1627235199,2011214180,2062270317,1507497298,1423022939,1137477952,1321699145,95345982,145085239,532201772,313773861,830661914,1015671571,731183368,648017665,3175501286,2957853679,2807058932,2858115069,2305455554,2220981195,2474404304,2658625497,3575528878,3625268135,3473416636,3254988725,3778151818,3963161475,4213447064,4130281361,3599595085,3683022916,3432737375,3247465558,3802222185,4020912224,4172763771,4122762354,3201631749,3017672716,2764249623,2848461854,2331590177,2280796200,2431590963,2648976442,104699613,188127444,472615631,287343814,840019705,1058709744,671593195,621591778,1852171925,1668212892,1953757831,2037970062,1514790577,1463996600,1080017571,1297403050,3673637356,3623636965,3235995134,3454686199,4007360968,3822090177,4107101658,4190530515,2997825956,3215212461,2830708150,2779915199,2256734592,2340947849,2627016082,2443058075,172466556,122466165,273792366,492483431,1047239e3,861968209,612205898,695634755,1646252340,1863638845,2013908262,1963115311,1446242576,1530455833,1277555970,1093597963,1636604631,1820824798,2073724613,1989249228,1436590835,1487645946,1337376481,1119727848,164948639,81781910,331544205,516552836,1039717051,821288114,669961897,719700128,2973530695,3157750862,2871682645,2787207260,2232435299,2283490410,2667994737,2450346104,3647212047,3564045318,3279033885,3464042516,3980931627,3762502690,4150144569,4199882800,3070356634,3121275539,2904027272,2686254721,2200818878,2384911031,2570832044,2486224549,3747192018,3528626907,3310321856,3359936201,3950355702,3867060991,4049844452,4234721005,1739656202,1790575107,2108100632,1890328081,1402811438,1586903591,1233856572,1149249077,266959938,48394827,369057872,418672217,1002783846,919489135,567498868,752375421,209336225,24197544,376187827,459744698,945164165,895287692,574624663,793451934,1679968233,1764313568,2117360635,1933530610,1343127501,1560637892,1243112415,1192455638,3704280881,3519142200,3336358691,3419915562,3907448597,3857572124,4075877127,4294704398,3029510009,3113855344,2927934315,2744104290,2159976285,2377486676,2594734927,2544078150],Ie[be([85,52])]=[0,151849742,303699484,454499602,607398968,758720310,908999204,1059270954,1214797936,1097159550,1517440620,1400849762,1817998408,1699839814,2118541908,2001430874,2429595872,2581445614,2194319100,2345119218,3034881240,3186202582,2801699524,2951971274,3635996816,3518358430,3399679628,3283088770,4237083816,4118925222,4002861748,3885750714,1002142683,850817237,698445255,548169417,529487843,377642221,227885567,77089521,1943217067,2061379749,1640576439,1757691577,1474760595,1592394909,1174215055,1290801793,2875968315,2724642869,3111247143,2960971305,2405426947,2253581325,2638606623,2487810577,3808662347,3926825029,4044981591,4162096729,3342319475,3459953789,3576539503,3693126241,1986918061,2137062819,1685577905,1836772287,1381620373,1532285339,1078185097,1229899655,1040559837,923313619,740276417,621982671,439452389,322734571,137073913,19308535,3871163981,4021308739,4104605777,4255800159,3263785589,3414450555,3499326569,3651041127,2933202493,2815956275,3167684641,3049390895,2330014213,2213296395,2566595609,2448830231,1305906550,1155237496,1607244650,1455525988,1776460110,1626319424,2079897426,1928707164,96392454,213114376,396673818,514443284,562755902,679998e3,865136418,983426092,3708173718,3557504664,3474729866,3323011204,4180808110,4030667424,3945269170,3794078908,2507040230,2623762152,2272556026,2390325492,2975484382,3092726480,2738905026,2857194700,3973773121,3856137295,4274053469,4157467219,3371096953,3252932727,3673476453,3556361835,2763173681,2915017791,3064510765,3215307299,2156299017,2307622919,2459735317,2610011675,2081048481,1963412655,1846563261,1729977011,1480485785,1362321559,1243905413,1126790795,878845905,1030690015,645401037,796197571,274084841,425408743,38544885,188821243,3613494426,3731654548,3313212038,3430322568,4082475170,4200115116,3780097726,3896688048,2668221674,2516901860,2366882550,2216610296,3141400786,2989552604,2837966542,2687165888,1202797690,1320957812,1437280870,1554391400,1669664834,1787304780,1906247262,2022837584,265905162,114585348,499347990,349075736,736970802,585122620,972512814,821712160,2595684844,2478443234,2293045232,2174754046,3196267988,3079546586,2895723464,2777952454,3537852828,3687994002,3234156416,3385345166,4142626212,4293295786,3841024952,3992742070,174567692,57326082,410887952,292596766,777231668,660510266,1011452712,893681702,1108339068,1258480242,1343618912,1494807662,1715193156,1865862730,1948373848,2100090966,2701949495,2818666809,3004591147,3122358053,2235061775,2352307457,2535604243,2653899549,3915653703,3764988233,4219352155,4067639125,3444575871,3294430577,3746175075,3594982253,836553431,953270745,600235211,718002117,367585007,484830689,133361907,251657213,2041877159,1891211689,1806599355,1654886325,1568718495,1418573201,1335535747,1184342925];const Ae=new Uint8Array(16);for(let He=15;He>=0;--He)Ae[He]=ke%256,ke=parseInt(ke/256);let Se=null,Oe=16;const Ve=new Uint8Array(ve),Me=[],De=[];Ue();for(let He=0;He<xe[be([108,101,110,103,116,104])];He++)Oe===16&&(Se=$e(Ae),Oe=0,Be(Ae)),xe[He]^=Se[Oe++];return xe;function Fe(He){const ze=[];for(let qe=0;qe<He[be([108,101,110,103,116,104])];qe+=4)ze[be([112,117,115,104])](He[qe]<<24|He[qe+1]<<16|He[qe+2]<<8|He[qe+3]);return ze}function Be(He){for(let ze=15;ze>=0;ze--){if(He[ze]!==255){He[ze]++;break}He[ze]=0}}function $e(He){const ze=Me[be([108,101,110,103,116,104])]-1,qe=[0,0,0,0];let Ke=Fe(He);for(let Ye=0;Ye<4;Ye++)Ke[Ye]^=Me[0][Ye];for(let Ye=1;Ye<ze;Ye++){for(let ht=0;ht<4;ht++)qe[ht]=Ie[be([84,49])][Ke[ht]>>24&255]^Ie[be([84,50])][Ke[(ht+1)%4]>>16&255]^Ie[be([84,51])][Ke[(ht+2)%4]>>8&255]^Ie[be([84,52])][255&Ke[(ht+3)%4]]^Me[Ye][ht];Ke=qe[be([115,108,105,99,101])]()}const Qe=new Uint8Array(16);let je;for(let Ye=0;Ye<4;Ye++)je=Me[ze][Ye],Qe[4*Ye]=255&(Ie[be([83])][Ke[Ye]>>24&255]^je>>24),Qe[4*Ye+1]=255&(Ie[be([83])][Ke[(Ye+1)%4]>>16&255]^je>>16),Qe[4*Ye+2]=255&(Ie[be([83])][Ke[(Ye+2)%4]>>8&255]^je>>8),Qe[4*Ye+3]=255&(Ie[be([83])][255&Ke[(Ye+3)%4]]^je);return Qe}function Ue(){const He=Ie[be([110,117,109,98,101,114,79,102,82,111,117,110,100,115])][Ve[be([108,101,110,103,116,104])]];for(let Ze=0;Ze<=He;Ze++)Me[be([112,117,115,104])]([0,0,0,0]),De[be([112,117,115,104])]([0,0,0,0]);const ze=4*(He+1),qe=Ve[be([108,101,110,103,116,104])]/4,Ke=Fe(Ve);let Qe;for(let Ze=0;Ze<qe;Ze++)Qe=Ze>>2,Me[Qe][Ze%4]=Ke[Ze],De[He-Qe][Ze%4]=Ke[Ze];let je,Ye=0,ht=qe;for(;ht<ze;){je=Ke[qe-1],Ke[0]^=Ie[be([83])][je>>16&255]<<24^Ie[be([83])][je>>8&255]<<16^Ie[be([83])][255&je]<<8^Ie[be([83])][je>>24&255]^Ie[be([114,99,111,110])][Ye]<<24,Ye+=1;for(let Yt=1;Yt<qe/2;Yt++)Ke[Yt]^=Ke[Yt-1];je=Ke[qe/2-1],Ke[qe/2]^=Ie[be([83])][255&je]^Ie[be([83])][je>>8&255]<<8^Ie[be([83])][je>>16&255]<<16^Ie[be([83])][je>>24&255]<<24;for(let Yt=qe/2+1;Yt<qe;Yt++)Ke[Yt]^=Ke[Yt-1];let Ze,Bt,Jt=0;for(;Jt<qe&&ht<ze;)Ze=ht>>2,Bt=ht%4,Me[Ze][Bt]=Ke[Jt],De[He-Ze][Bt]=Ke[Jt++],ht++}for(let Ze=1;Ze<He;Ze++)for(let Bt=0;Bt<4;Bt++)je=De[Ze][Bt],De[Ze][Bt]=Ie[be([85,49])][je>>24&255]^Ie[be([85,50])][je>>16&255]^Ie[be([85,51])][je>>8&255]^Ie[be([85,52])][255&je]}}function be(xe){return xe.map(ve=>String.fromCharCode(ve)).join("")}(xe=>{function ve(){const Ne=[{[be([105,100])]:1,[be([102,101,97,116,117,114,101,78,97,109,101])]:be([67,111,109,109,101,110,116,115]),[be([112,108,117,103,105,110,78,97,109,101])]:be([67,111,109,109,101,110,116,115,82,101,112,111,115,105,116,111,114,121]),[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:be([108,105,99,101,110,115,101,75,101,121]),[be([104,97,110,100,108,101,114])]:be([99,104,101,99,107,76,105,99,101,110,115,101]),[be([99,104,101,99,107,65,108,115,111])]:[{[be([105,100])]:2,[be([102,101,97,116,117,114,101,78,97,109,101])]:be([84,114,97,99,107,32,67,104,97,110,103,101,115]),[be([112,108,117,103,105,110,78,97,109,101])]:be([84,114,97,99,107,67,104,97,110,103,101,115,69,100,105,116,105,110,103]),[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:be([108,105,99,101,110,115,101,75,101,121]),[be([104,97,110,100,108,101,114])]:be([99,104,101,99,107,76,105,99,101,110,115,101,70,111,114,84,114,97,99,107,67,104,97,110,103,101,115]),[be([111,112,116,105,111,110,115])]:{[be([97,105,119,115,103,105,99])]:!0,[be([97,105,116,99,100,103,105,108])]:!0,[be([97,105,114,118,105,105,108])]:!0}}],[be([111,112,116,105,111,110,115])]:{[be([97,105,119,115,103,105,99])]:!0,[be([97,105,116,99,100,103,105,108])]:!0,[be([97,105,114,118,105,105,108])]:!0}},{[be([105,100])]:3,[be([102,101,97,116,117,114,101,78,97,109,101])]:be([80,97,103,105,110,97,116,105,111,110]),[be([112,108,117,103,105,110,78,97,109,101])]:be([80,97,103,105,110,97,116,105,111,110,76,111,111,107,117,112]),[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:be([112,97,103,105,110,97,116,105,111,110,76,105,99,101,110,115,101,75,101,121]),[be([104,97,110,100,108,101,114])]:be([99,104,101,99,107,76,105,99,101,110,115,101])},{[be([105,100])]:4,[be([102,101,97,116,117,114,101,78,97,109,101])]:be([82,101,118,105,115,105,111,110,32,72,105,115,116,111,114,121]),[be([112,108,117,103,105,110,78,97,109,101])]:be([82,101,118,105,115,105,111,110,115,82,101,112,111,115,105,116,111,114,121]),[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:be([108,105,99,101,110,115,101,75,101,121]),[be([104,97,110,100,108,101,114])]:be([99,104,101,99,107,76,105,99,101,110,115,101,70,111,114,82,101,118,105,115,105,111,110,72,105,115,116,111,114,121]),[be([111,112,116,105,111,110,115])]:{[be([97,105,119,115,103,105,99])]:!0,[be([97,105,116,99,100,103,105,108])]:!0,[be([97,105,114,118,105,105,108])]:!0}},{[be([105,100])]:5,[be([102,101,97,116,117,114,101,78,97,109,101])]:be([68,111,99,117,109,101,110,116,32,79,117,116,108,105,110,101]),[be([112,108,117,103,105,110,78,97,109,101])]:be([68,111,99,117,109,101,110,116,79,117,116,108,105,110,101,85,73]),[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:be([100,111,99,117,109,101,110,116,79,117,116,108,105,110,101,76,105,99,101,110,115,101,75,101,121]),[be([104,97,110,100,108,101,114])]:be([99,104,101,99,107,76,105,99,101,110,115,101]),[be([111,112,116,105,111,110,115])]:{[be([102,103,105])]:[12]}},{[be([105,100])]:6,[be([102,101,97,116,117,114,101,78,97,109,101])]:be([70,111,114,109,97,116,32,80,97,105,110,116,101,114]),[be([112,108,117,103,105,110,78,97,109,101])]:be([70,111,114,109,97,116,80,97,105,110,116,101,114,85,73]),[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:be([102,111,114,109,97,116,80,97,105,110,116,101,114,76,105,99,101,110,115,101,75,101,121]),[be([104,97,110,100,108,101,114])]:be([99,104,101,99,107,76,105,99,101,110,115,101]),[be([111,112,116,105,111,110,115])]:{[be([102,103,105])]:[12]}},{[be([105,100])]:7,[be([102,101,97,116,117,114,101,78,97,109,101])]:be([83,108,97,115,104,32,67,111,109,109,97,110,100]),[be([112,108,117,103,105,110,78,97,109,101])]:be([83,108,97,115,104,67,111,109,109,97,110,100,85,73]),[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:be([115,108,97,115,104,67,111,109,109,97,110,100,76,105,99,101,110,115,101,75,101,121]),[be([104,97,110,100,108,101,114])]:be([99,104,101,99,107,76,105,99,101,110,115,101]),[be([111,112,116,105,111,110,115])]:{[be([102,103,105])]:[12]}},{[be([105,100])]:8,[be([102,101,97,116,117,114,101,78,97,109,101])]:be([84,97,98,108,101,32,111,102,32,67,111,110,116,101,110,116,115]),[be([112,108,117,103,105,110,78,97,109,101])]:be([84,97,98,108,101,79,102,67,111,110,116,101,110,116,115,69,100,105,116,105,110,103]),[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:be([116,97,98,108,101,79,102,67,111,110,116,101,110,116,115,76,105,99,101,110,115,101,75,101,121]),[be([104,97,110,100,108,101,114])]:be([99,104,101,99,107,76,105,99,101,110,115,101]),[be([111,112,116,105,111,110,115])]:{[be([102,103,105])]:[12]}},{[be([105,100])]:9,[be([102,101,97,116,117,114,101,78,97,109,101])]:be([84,101,109,112,108,97,116,101]),[be([112,108,117,103,105,110,78,97,109,101])]:be([84,101,109,112,108,97,116,101,85,73]),[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:be([116,101,109,112,108,97,116,101,76,105,99,101,110,115,101,75,101,121]),[be([104,97,110,100,108,101,114])]:be([99,104,101,99,107,76,105,99,101,110,115,101]),[be([111,112,116,105,111,110,115])]:{[be([102,103,105])]:[12,14]}},{[be([105,100])]:10,[be([102,101,97,116,117,114,101,78,97,109,101])]:be([80,97,115,116,101,32,102,114,111,109,32,79,102,102,105,99,101,32,69,110,104,97,110,99,101,100]),[be([112,108,117,103,105,110,78,97,109,101])]:be([80,97,115,116,101,70,114,111,109,79,102,102,105,99,101,69,110,104,97,110,99,101,100,73,110,108,105,110,101,114]),[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:be([112,97,115,116,101,70,114,111,109,79,102,102,105,99,101,69,110,104,97,110,99,101,100,76,105,99,101,110,115,101,75,101,121]),[be([104,97,110,100,108,101,114])]:be([99,104,101,99,107,76,105,99,101,110,115,101]),[be([111,112,116,105,111,110,115])]:{[be([102,103,105])]:[12]}},{[be([105,100])]:11,[be([102,101,97,116,117,114,101,78,97,109,101])]:be([65,73,32,65,115,115,105,115,116,97,110,116]),[be([112,108,117,103,105,110,78,97,109,101])]:be([65,73,65,115,115,105,115,116,97,110,116,85,73]),[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:be([97,105,76,105,99,101,110,115,101,75,101,121]),[be([104,97,110,100,108,101,114])]:be([99,104,101,99,107,76,105,99,101,110,115,101])},{[be([105,100])]:12,[be([102,101,97,116,117,114,101,78,97,109,101])]:be([80,114,111,100,117,99,116,105,118,105,116,121,32,112,97,99,107])},{[be([105,100])]:13,[be([102,101,97,116,117,114,101,78,97,109,101])]:be([67,97,115,101,32,67,104,97,110,103,101]),[be([112,108,117,103,105,110,78,97,109,101])]:be([67,97,115,101,67,104,97,110,103,101,85,73]),[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:be([99,97,115,101,67,104,97,110,103,101,76,105,99,101,110,115,101,75,101,121]),[be([104,97,110,100,108,101,114])]:be([99,104,101,99,107,76,105,99,101,110,115,101]),[be([111,112,116,105,111,110,115])]:{[be([102,103,105])]:[12]}},{[be([105,100])]:14,[be([102,101,97,116,117,114,101,78,97,109,101])]:be([68,114,117,112,97,108,32,112,97,99,107]),[be([102,111,114,98,105,100,100,101,110,72,97,110,100,108,101,114])]:be([102,111,114,98,105,100,100,101,110,72,97,110,100,108,101,114,70,111,114,68,114,117,112,97,108])},{[be([105,100])]:15,[be([102,101,97,116,117,114,101,78,97,109,101])]:be([77,117,108,116,105,32,76,101,118,101,108,32,76,105,115,116]),[be([112,108,117,103,105,110,78,97,109,101])]:be([77,117,108,116,105,76,101,118,101,108,76,105,115,116,69,100,105,116,105,110,103]),[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:be([109,117,108,116,105,76,101,118,101,108,76,105,115,116,76,105,99,101,110,115,101,75,101,121]),[be([104,97,110,100,108,101,114])]:be([99,104,101,99,107,76,105,99,101,110,115,101])},{[be([105,100])]:16,[be([102,101,97,116,117,114,101,78,97,109,101])]:be([77,101,114,103,101,32,70,105,101,108,100,115]),[be([112,108,117,103,105,110,78,97,109,101])]:be([77,101,114,103,101,70,105,101,108,100,115,85,73]),[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:be([109,101,114,103,101,70,105,101,108,100,115,76,105,99,101,110,115,101,75,101,121]),[be([104,97,110,100,108,101,114])]:be([99,104,101,99,107,76,105,99,101,110,115,101]),[be([111,112,116,105,111,110,115])]:{[be([102,103,105])]:[12]}}];return We(Ne),Ne;function Le(Je){return 1<<Je-1}function We(Je){Je[be([102,111,114,69,97,99,104])](Wt=>{Wt[be([112,101,114,109,105,115,115,105,111,110,77,97,115,107])]=Le(Wt[be([105,100])]),ke(Wt)&&Wt[be([99,104,101,99,107,65,108,115,111])]&&We(Wt[be([99,104,101,99,107,65,108,115,111])])})}}function ke(Ne){return be([112,108,117,103,105,110,78,97,109,101])in Ne}const Ie=[1,85,78,115,198,255,50,112,83,87,161],Ae=[127,34,6,211,167,86,146,199,132,160,18];function Se(Ne){const Le=[29,221,175,90,231,133,239,240,75,180];return Oe(Ne,new Uint8Array([...Ie,...Le,...Ae]))}function Oe(Ne,Le){const We=Ve(Ne),Je=Array[be([102,114,111,109])](Ge(We)),Wt=Je[be([112,111,112])](),nn=Je[be([112,111,112])]();return pn(te(Je,Le,nn+256*Wt))}function Ve(Ne){const Le=atob(Ne),[We,Je]=Le[be([115,112,108,105,116])](be([45]));try{if(atob(Je))return atob(We)}catch{}return Le}function Me(Ne){try{const Le=Se(Ne),We=JSON[be([112,97,114,115,101])](Le),Je=parseInt(We[be([49])]),Wt=We[be([50])]||"",nn=parseInt(We[be([51])]),cn=parseInt(We[be([52])])||0,fn=parseInt(We[be([53])])||0;return{[be([112,114,111,100,117,99,116,78,97,109,101])]:Wt,[be([97,108,108,111,119,101,100,80,108,117,103,105,110,115])]:cn,[be([101,120,112,105,114,97,116,105,111,110,68,97,116,101])]:Je,[be([105,115,84,114,105,97,108])]:nn,[be([105,115,73,110,116,101,114,110,97,108])]:fn}}catch{return null}}const De=ve(),Fe={[be([99,104,101,99,107,76,105,99,101,110,115,101])]:Qe,[be([99,104,101,99,107,76,105,99,101,110,115,101,70,111,114,84,114,97,99,107,67,104,97,110,103,101,115])]:je,[be([99,104,101,99,107,76,105,99,101,110,115,101,70,111,114,82,101,118,105,115,105,111,110,72,105,115,116,111,114,121])]:Ye},Be=xe[be([99,111,110,115,116,114,117,99,116,111,114])][be([112,108,117,103,105,110,78,97,109,101])],$e=be([99,111,110,116,101,120,116])in xe?xe.context:xe.editor,Ue=be([52,48,52,56,49,52,50,50]),He=be([65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,48,49,50,51,52,53,54,55,56,57]),ze=$e.config.get(be([108,105,99,101,110,115,101,75,101,121])),qe=De[be([102,105,108,116,101,114])](ke)[be([102,105,110,100])](Ne=>Ne[be([112,108,117,103,105,110,78,97,109,101])]===Be);function Ke(Ne,Le){Fe[Le[be([104,97,110,100,108,101,114])]](Ne,Le),Le[be([99,104,101,99,107,65,108,115,111])]&&Le[be([99,104,101,99,107,65,108,115,111])][be([102,105,108,116,101,114])](We=>Kt($e,We[be([112,108,117,103,105,110,78,97,109,101])]))[be([102,111,114,69,97,99,104])](We=>Ke(Ne,We))}function Qe(Ne,Le){Ze(ht(Ne,Le),Le)}function je(Ne,Le){function We(Je,Wt){try{if(Kt($e,be([84,114,97,99,107,67,104,97,110,103,101,115,69,100,105,116,105,110,103]))&&Je){const nn=Xt($e,be([84,114,97,99,107,67,104,97,110,103,101,115,69,100,105,116,105,110,103]))[be([95,101,120,101,99,117,116,101,83,117,103,103,101,115,116,105,111,110])];if(parseInt(nn)/2>Je[be([101,120,112,105,114,97,116,105,111,110,68,97,116,101])])return Bt(Wt[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+be([73,110,118,97,108,105,100]))}return ht(Je,Wt)}catch{return Bt(Wt[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+be([73,110,118,97,108,105,100]))}}Ze(We(Ne,Le),Le)}function Ye(Ne,Le){const We=Ae[0]*Ie[1],Je=Ae[0]*Ie[2],Wt=Ae[2]*Ie[2];Kt($e,be([87,101,98,83,111,99,107,101,116,71,97,116,101,119,97,121]))&&Xt($e,be([87,101,98,83,111,99,107,101,116,71,97,116,101,119,97,121]))[be([115,116,97,116,101])]==be([99,111,110,110,101,99,116,101,100])&&(window[Jt()]=Wt);function nn(Xe,Qt){try{return un()?Bt(Qt[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+be([86,97,108,105,100])):ht(Xe,Qt)}catch{return Bt(Qt[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+be([73,110,118,97,108,105,100]))}}function cn(Xe,Qt){if(Xe==Qt[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+be([73,110,118,97,108,105,100]))zt();else if(Xe==Qt[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+be([84,114,105,97,108])){const rn=fn();rn&&ln(rn,Qt[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]);const xn=dn();window[be([115,101,116,84,105,109,101,111,117,116])](()=>{ln(be([116,105,109,101]),Qt[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])])},xn);const wn=Xt($e,be([82,101,118,105,115,105,111,110,115,82,101,112,111,115,105,116,111,114,121]))[be([95,114,101,118,105,115,105,111,110,115])];wn[be([108,101,110,103,116,104])]>=7?ln(be([114,101,118,105,115,105,111,110,115]),Qt[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]):wn.on(be([97,100,100]),()=>{wn[be([108,101,110,103,116,104])]>=7&&ln(be([114,101,118,105,115,105,111,110,115]),Qt[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])])})}}function fn(){if(!Kt($e,be([82,101,118,105,115,105,111,110,86,105,101,119,101,114])))return!1;for(const Xe in window)if(Number.isNaN(Number(Xe))){if(window[Xe]===We)return be([116,105,109,101]);if(window[Xe]===Je)return be([114,101,118,105,115,105,111,110,115])}return!1}function un(){if(!Kt($e,be([82,101,118,105,115,105,111,110,86,105,101,119,101,114])))return!1;for(const Xe in window)if(Number.isNaN(Number(Xe))&&window[Xe]===Wt)return!0;return!1}function ln(Xe,Qt){zt(),Bt(Qt+be([84,114,105,97,108,76,105,109,105,116,58])+Xe),window[Jt()]=Xe===be([116,105,109,101])?We:Je}function dn(){let Xe=Ae[6]*Ie[8]*Ie[6];return Kt($e,be([82,101,118,105,115,105,111,110,86,105,101,119,101,114]))&&(Xe/=10),Xe}function zt(){const Xe=$e;function Qt(){Kt(Xe,be([82,101,118,105,115,105,111,110,84,114,97,99,107,101,114]))&&(Xt(Xe,be([82,101,118,105,115,105,111,110,84,114,97,99,107,101,114]))[be([117,110,98,105,110,100])](be([105,115,69,110,97,98,108,101,100])),Xt(Xe,be([82,101,118,105,115,105,111,110,84,114,97,99,107,101,114]))[be([105,115,69,110,97,98,108,101,100])]=!1,Xt(Xe,be([82,101,118,105,115,105,111,110,84,114,97,99,107,101,114]))[be([117,112,100,97,116,101])]=sn,Xt(Xe,be([82,101,118,105,115,105,111,110,84,114,97,99,107,101,114]))[be([115,97,118,101,82,101,118,105,115,105,111,110])]=sn,Xe[be([109,111,100,101,108])][be([99,104,97,110,103,101])]=sn,Xe[be([109,111,100,101,108])][be([101,110,113,117,101,117,101,67,104,97,110,103,101])]=sn,Xe[be([101,110,97,98,108,101,82,101,97,100,79,110,108,121,77,111,100,101])](be([109,111,100,101,108]))),Kt(Xe,be([82,101,118,105,115,105,111,110,86,105,101,119,101,114]))&&(Xt(Xe,be([82,101,118,105,115,105,111,110,86,105,101,119,101,114]))[be([117,110,98,105,110,100])](be([105,115,69,110,97,98,108,101,100])),Xt(Xe,be([82,101,118,105,115,105,111,110,86,105,101,119,101,114]))[be([105,115,69,110,97,98,108,101,100])]=!1,Xt(Xe,be([82,101,118,105,115,105,111,110,86,105,101,119,101,114]))[be([99,111,109,112,97,114,101])]=sn,Xt(Xe,be([82,101,118,105,115,105,111,110,86,105,101,119,101,114]))[be([95,103,101,116,68,105,102,102])]=sn)}Xe[be([115,116,97,116,101])]==be([114,101,97,100,121])?Qt():Xe[be([111,110,99,101])](be([114,101,97,100,121]),()=>{if(Kt(Xe,be([82,101,118,105,115,105,111,110,84,114,97,99,107,101,114]))&&Qt(),Kt(Xe,be([82,101,118,105,115,105,111,110,86,105,101,119,101,114]))){const an=Xt(Xe,be([82,101,118,105,115,105,111,110,115,82,101,112,111,115,105,116,111,114,121])),rn=an.getRevision(0),xn=an.getEarlierVisibleRevision(rn[be([105,100])]);Xt(Xe,be([82,101,118,105,115,105,111,110,86,105,101,119,101,114]))[be([99,111,109,112,97,114,101])](rn[be([105,100])],xn?xn[be([105,100])]:null,1).then(()=>Qt())}})}cn(nn(Ne,Le),Le)}function ht(Ne,Le){try{return tn(Le)?Bt(Le[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+be([86,97,108,105,100])):Ne&&hn(Ne[be([97,108,108,111,119,101,100,80,108,117,103,105,110,115])],Le)?Ne[be([105,115,73,110,116,101,114,110,97,108])]&&!window[be([111,112,101,110])][be([99,108,111,115,101,100])]||parseInt(Ue)/2>Ne[be([101,120,112,105,114,97,116,105,111,110,68,97,116,101])]?Bt(Le[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+be([73,110,118,97,108,105,100])):Ne[be([105,115,84,114,105,97,108])]?Bt(Le[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+be([84,114,105,97,108])):Bt(Le[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+be([86,97,108,105,100])):Bt(Le[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+be([73,110,118,97,108,105,100]))}catch{return Bt(Le[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+be([73,110,118,97,108,105,100]))}}function Ze(Ne,Le){if($e instanceof Context){const We=$e;Ne==Le[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+be([73,110,118,97,108,105,100])?Yt(We):Ne==Le[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+be([84,114,105,97,108])&&window[be([115,101,116,84,105,109,101,111,117,116])](()=>{Yt(We),Bt(Le[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+be([84,114,105,97,108,76,105,109,105,116,58,116,105,109,101]))},Ae[6]*Ie[8]*Ie[6]),We[be([101,100,105,116,111,114,115])][be([111,110])](be([97,100,100]),(Je,Wt)=>{Ne!=Le[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+be([73,110,118,97,108,105,100])&&Ne!=Le[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+be([84,114,105,97,108,76,105,109,105,116,58,116,105,109,101])&&Ne!=Le[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+be([84,114,105,97,108,76,105,109,105,116,58,111,112,101,114,97,116,105,111,110,115])||en(Wt)})}else{const We=$e;Ne==Le[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+be([73,110,118,97,108,105,100])?en(We):Ne==Le[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+be([84,114,105,97,108])&&We[be([111,110])](be([114,101,97,100,121]),()=>{let Je=0;We[be([109,111,100,101,108])][be([111,110])](be([97,112,112,108,121,79,112,101,114,97,116,105,111,110]),(Wt,nn)=>{nn[0][be([105,115,68,111,99,117,109,101,110,116,79,112,101,114,97,116,105,111,110])]&&Je++,Je===504&&(en(We),Bt(Le[be([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+be([84,114,105,97,108,76,105,109,105,116,58,111,112,101,114,97,116,105,111,110,115])),Wt[be([111,102,102])]())},{priority:be([104,105,103,104,101,115,116])})})}}function Bt(Ne){const Le=Jt();return $e[Le]=Ne,Ne}function Jt(){const Ne=String(window[be([112,101,114,102,111,114,109,97,110,99,101])][be([110,111,119])]())[be([114,101,112,108,97,99,101])](be([46]),"");let Le="";for(let We=0;We<Ne[be([108,101,110,103,116,104])];We+=2){let Je=parseInt(Ne[be([115,117,98,115,116,114,105,110,103])](We,We+2));Je>=He[be([108,101,110,103,116,104])]&&(Je-=He[be([108,101,110,103,116,104])]),Le+=He[Je]}return Le}function Yt(Ne){for(const Le of Ne[be([101,100,105,116,111,114,115])])en(Le);Xt(Ne,be([67,111,109,109,101,110,116,115,82,101,112,111,115,105,116,111,114,121]))[be([115,119,105,116,99,104,82,101,97,100,79,110,108,121])](!0),Xt(Ne,be([67,111,109,109,101,110,116,115,82,101,112,111,115,105,116,111,114,121]))[be([115,119,105,116,99,104,82,101,97,100,79,110,108,121])]=sn}function en(Ne){function Le(){Ne[be([109,111,100,101,108])][be([99,104,97,110,103,101])]=sn,Ne[be([109,111,100,101,108])][be([101,110,113,117,101,117,101,67,104,97,110,103,101])]=sn,Ne[be([101,110,97,98,108,101,82,101,97,100,79,110,108,121,77,111,100,101])](be([109,111,100,101,108]))}Ne[be([115,116,97,116,101])]==be([114,101,97,100,121])?Le():Ne[be([111,110,99,101])](be([114,101,97,100,121]),()=>Le())}function sn(){return null}function hn(Ne,Le){const We=!!(Ne&Le[be([112,101,114,109,105,115,115,105,111,110,77,97,115,107])]),Je=mn(Ne,Le);return We||Je}function mn(Ne,Le){const We=(Le[be([111,112,116,105,111,110,115])]||{})[be([102,103,105])]||null;return!!We&&De[be([102,105,108,116,101,114])](Je=>We[be([105,110,99,108,117,100,101,115])](Je[be([105,100])]))[be([102,105,108,116,101,114])](Je=>!bn(Je))[be([115,111,109,101])](Je=>!!(Ne&Je[be([112,101,114,109,105,115,115,105,111,110,77,97,115,107])]))}function bn(Ne){const Le={[be([102,111,114,98,105,100,100,101,110,72,97,110,100,108,101,114,70,111,114,68,114,117,112,97,108])]:gn};return!!Ne.forbiddenHandler&&Le[Ne.forbiddenHandler]()}function gn(){return!window[be([68,114,117,112,97,108])]||!Kt($e,be([100,114,117,112,97,108,80,111,119,101,114,101,100,66,121]))}function tn(Ne){if(!Kt($e,Ne[be([112,108,117,103,105,110,78,97,109,101])]))return!0;const Le=Ne[be([111,112,116,105,111,110,115])]||{},We=Le[be([97,105,119,115,103,105,99])]||!1,Je=Le[be([97,105,116,99,100,103,105,108])]||!1,Wt=Le[be([97,105,114,118,105,105,108])]||!1;return Kt($e,be([87,101,98,83,111,99,107,101,116,71,97,116,101,119,97,121]))&&Xt($e,be([87,101,98,83,111,99,107,101,116,71,97,116,101,119,97,121]))[be([115,116,97,116,101])]==be([99,111,110,110,101,99,116,101,100])&&We||Kt($e,be([84,114,97,99,107,67,104,97,110,103,101,115,68,97,116,97,71,101,116,116,101,114]))&&Xt($e,be([84,114,97,99,107,67,104,97,110,103,101,115,68,97,116,97,71,101,116,116,101,114]))[be([114,101,115,117,108,116])]==be([101,110,100])&&Je?!0:!(!Kt($e,be([82,101,118,105,115,105,111,110,86,105,101,119,101,114,73,110,116,101,103,114,97,116,105,111,110]))||Xt($e,be([82,101,118,105,115,105,111,110,86,105,101,119,101,114,73,110,116,101,103,114,97,116,105,111,110]))[be([114,101,115,117,108,116])]!=be([101,110,100])||!Wt)}function Kt(Ne,Le){return Ne[be([112,108,117,103,105,110,115])][be([104,97,115])](Le)}function Xt(Ne,Le){return Ne[be([112,108,117,103,105,110,115])][be([103,101,116])](Le)}function pn(Ne){let Le="";for(const We of Ne)Le+=String[be([102,114,111,109,67,104,97,114,67,111,100,101])](We);return Le}function Ge(Ne){const Le=new Uint8Array(Ne[be([108,101,110,103,116,104])]);for(let We=0;We<Ne[be([108,101,110,103,116,104])];We++)Le[We]=Ne[be([99,104,97,114,67,111,100,101,65,116])](We);return Le}qe&&Ke(Me(ze),qe)})(t)})(this)}createRevision(t){const te=this.editor.plugins.get("Users");return new a({id:t.id,name:t.name,creator:t.creatorId?te.getUser(t.creatorId):null,diffData:t.diffData||t.data,authors:t.authorsIds.map(be=>te.getUser(be)),createdAt:new Date(t.createdAt),attributes:t.attributes,fromVersion:t.fromVersion,toVersion:t.toVersion})}addRevision(t,te=0){this._revisions.add(t,te)}getRevision(t){return this._revisions.get(t)}getRevisions(t={toJSON:!1}){const te=Array.from(this._revisions);return te.reverse(),t.toJSON?te.map(be=>be.toJSON()):te}getIndex(t){return this._revisions.getIndex(t)}getEarlierVisibleRevision(t){const[,te]=this.getRevisionsIterator(t,{direction:"earlier"});return te}getLaterVisibleRevision(t){const[,te]=this.getRevisionsIterator(t,{direction:"later"});return te}getRevisionsInDiff(t){const te=[];for(const be of this.getRevisionsIterator(t.newRevisionId))if(te.push(be),be.id===t.oldRevisionId)break;return te}*getRevisionsIterator(t,{direction:te="earlier",filter:be=xe=>!0}={}){const xe=te==="earlier"?1:-1;let ve=this._revisions.get(t),ke=this.getIndex(ve);for(yield ve;ve;){if(ke+=xe,ve=this.getRevision(ke),!ve)return;be(ve)&&(yield ve)}}}function y(Te,we,t){const te=Te.t;switch(we){case"Revision history":return te("Revision history");case"Open revision history":return te("Open revision history");case"Restored":return te("Restored");case"Empty document":return te("Empty document");case"Initial revision":return te("Initial revision");case"Suggested by":return te("Suggested by");case"Added by":return te("Added by");case"Removed by":return te("Removed by");case"Show more items":return te("Show more items");case"Compare against selected":return te("Compare against selected");case"Name this revision":return te("Name this revision");case"Restore this revision":return te("Restore this revision");case"Back to editing":return te("Back to editing");case"Loading...":return te("Loading...");case"No changes":return te("No changes");case"NUMBER_OF_CHANGES":return te({string:"%0 change",plural:"%0 changes",id:"NUMBER_OF_CHANGES"},t);case"X_OF_Y_CHANGES":return te({string:"%0 of %1",id:"X_OF_Y_CHANGES"},t);case"Show previous change":return te("Show previous change");case"Show next change":return te("Show next change");case"EDIT_X_OF_Y_REVISIONS":return te({string:"Edit",id:"EDIT_X_OF_Y_REVISIONS"});case"Total":return te("Total");case"Revision creator":return te("Revision creator");case"Revision author":return te("Revision author");case"Revision name":return te("Revision name");case"Save current revision":return te("Save current revision");case"Save":return te("Save");case"Cancel":return te("Cancel");case"Name of the revision":return te("Name of the revision");case"optional":return te("optional");case"PENDING_ACTION_REVISION_HISTORY":return te({string:"Unsaved change in revision history.",id:"PENDING_ACTION_REVISION_HISTORY"});case"The revision name cannot be empty.":return te("The revision name cannot be empty.");case"Enter the revision name":return te("Enter the revision name");default:return""}}const T$1={c:ContainerElement,a:AttributeElement,e:EmptyElement,r:RawElement,u:UIElement};class l extends Plugin{constructor(t){super(t);Re(this,"adapter");Re(this,"currentRevision");Re(this,"repository");Re(this,"_revisionDataBuilder");Re(this,"_source");Re(this,"_initialRevisionId");Re(this,"_bufferedUpdates");Re(this,"_pendingAction");Re(this,"_continueCurrentRevision");Re(this,"_startingVersion");Re(this,"_loadedStateData");this.adapter=null,this.currentRevision=null,this._revisionDataBuilder=new J$1(this.editor),this._initialRevisionId=this.editor.config.get("collaboration.channelId")||"initial",this._bufferedUpdates=new Map,this._loadedStateData=null;const te=uid();this._source={history:this.editor.model.document.history,getLatestVersion:()=>Promise.resolve(this.editor.model.document.version),getCurrentRevisionId:()=>te},this.set("isReady",!1),this.set("isEnabled",!0),this.set("_isPendingUpdate",!1),this.editor.config.define("revisionHistory.resumeUnsavedRevision",!0),this.editor.conversion.for("upcast").dataToMarker({view:"revision"})}static get pluginName(){return"RevisionTracker"}static get requires(){return[l$8,A,PendingActions]}init(){this.repository=this.editor.plugins.get("RevisionsRepository"),this._setConversion(),this.editor.data.on("ready",()=>{const t=this.repository.getRevision(0),te=t&&t.creator===null?t:null;if(this._continueCurrentRevision=!!te&&this.editor.config.get("revisionHistory.resumeUnsavedRevision"),this.editor.plugins.has("RealTimeCollaborationClient")){const be=this._source.getCurrentRevisionId(),xe=this.repository.getRevision(be);if(xe)this._startingVersion=xe.fromVersion,this._continueCurrentRevision=!1;else{const ve=this._source.history._operations.find(Ie=>!Ie._isInit),ke=ve?ve.baseVersion:this._source.history.version;t?(t.toVersion<ke&&t._update({toVersion:ke}),this._continueCurrentRevision?(this._source.getCurrentRevisionId=()=>te.id,this._startingVersion=te.fromVersion):(this._startingVersion=t.toVersion,this._continueCurrentRevision=!1)):(this._startingVersion=ke,this._continueCurrentRevision=!1)}}else te&&(this.editor.model.document.history.version=Math.max(te.toVersion,this.editor.model.document.history.version),te.fromVersion===te.toVersion?(te.fromVersion!==0&&(this._source.getCurrentRevisionId=()=>te.id),this._continueCurrentRevision=!1):this._continueCurrentRevision&&(this._source.getCurrentRevisionId=()=>te.id,this._startingVersion=te.fromVersion)),this._continueCurrentRevision||(this._startingVersion=this.editor.model.document.version);this._revisionDataBuilder.init(this._source.history),this._createInitialRevision(this._startingVersion),this._createCurrentRevision(this._startingVersion),this.adapter&&this.sendBufferedUpdates()}),this.bind("isReady").to(this,"_isPendingUpdate",t=>!t)}async afterInit(){if(this.repository.length>0){const t=this.repository.getRevision(0),te=await this.getRevisionDocumentData(t),be=await this.getRevisionRootsAttributes(t);this._replaceEditorDataWithRevisionData(te,be)}}setSource(t){this._source=t}async update(){const t=await this._source.getLatestVersion();if(t>this.currentRevision.toVersion){await this._loadState();const te=this.buildRevisionData({revision:this.currentRevision,to:t});te.authors=te.authorsIds.map(be=>this.editor.plugins.get("Users").getUser(be)),this.currentRevision._update(te)}}async _loadState(){this._continueCurrentRevision&&!this._loadedStateData&&(await this._loadRevisionData(this.currentRevision),this._revisionDataBuilder.loadState(this.currentRevision),this._loadedStateData={fromVersion:this.currentRevision.fromVersion,authors:this.currentRevision.authors.slice()})}async saveRevision(t={},te=null){const be=[];await this._loadState(),this._continueCurrentRevision=!1,te>this.currentRevision.toVersion&&(te=null),te===null&&(te=await this._source.getLatestVersion());const xe=this._getFromVersion(te),ve=this.buildRevisionData({from:xe,to:te});if(this.currentRevision.toVersion<te){const Ae=this.buildRevisionData({revision:this.currentRevision,from:te,to:te});Ae.authors=[],Ae.authorsIds=[],Ae.id=this.currentRevision.id,this.currentRevision._update(Ae,!0),delete Ae.authors,be.push(Ae)}t.creatorId=this.editor.plugins.get("Users").me.id,t.name=t.name||null,t.id=t.id||uid(),t={...t,...ve};const ke=this.addRevisionData(t);be.push(t);const Ie=this.repository.getIndex(ke);if(Ie!==0){const Ae=this.repository.getRevision(Ie-1);if(Ae.fromVersion!==te){const Se=this._revisionDataBuilder.getData(te,Ae.toVersion),Oe={id:Ae.id,diffData:Se.diffData,authorsIds:Se.authorsIds,authors:Se.authorsIds.map(Ve=>this.editor.plugins.get("Users").getUser(Ve)),fromVersion:te};Ae===this.currentRevision&&(Oe.createdAt=new Date(t.createdAt.getTime()+10)),Ae._update(Oe,!0),delete Oe.authors,be.push(Oe)}}if(this.adapter){for(const Ae of be)this._bufferUpdate(Ae.id,Ae,!0);this.sendBufferedUpdates()}return ke}addRevisionData(t){const te=this.repository.createRevision(t);return this.adapter&&te.on("_update",(be,xe,ve)=>{ve||(this._bufferUpdate(xe.id,xe,!0),this.sendBufferedUpdates())}),this.repository.addRevision(te,this._findInsertionIndex(te)),te}async getRevisionDocumentData(t){await this._loadRevisionData(t);const te={};for(const be in t.diffData){if(t.diffData[be].attachChange&&!t.diffData[be].attachChange.isAttached)continue;const xe=this._removeRevisionMarkers(JSON.parse(t.diffData[be].insertions)),ve=this.editor.editing.view.document,ke=new DocumentFragment$1(ve,xe.map(Ie=>B$1(Ie,this.editor)));this.editor.data.processor.useFillerType("marked"),te[be]=this.editor.data.processor.toData(ke),this.editor.data.processor.useFillerType("default")}return te}async getRevisionRootsAttributes(t){await this._loadRevisionData(t);const te={};for(const be in t.diffData)t.diffData[be].attachChange&&!t.diffData[be].attachChange.isAttached||(te[be]=t.diffData[be].attributesAfter||{});return te}sendBufferedUpdates(){if(this._bufferedUpdates.size===0||this._isPendingUpdate)return;let t=Array.from(this._bufferedUpdates.values());this._bufferedUpdates.clear();for(let be=0;be<t.length;be++){const xe=t[be];let ve=!1;for(const ke of Object.keys(xe))xe[ke]===void 0?delete xe[ke]:ke!=="id"&&(ve=!0);ve||(t[be]=null)}if(t=t.filter(be=>be!==null),!t.length)return;for(let be=0;be<t.length;be++){const xe=t[be];xe.fromVersion!==void 0&&xe.toVersion===void 0&&(xe.toVersion=this.repository.getRevision(xe.id).toVersion),xe.toVersion!==void 0&&xe.fromVersion===void 0&&(xe.fromVersion=this.repository.getRevision(xe.id).fromVersion)}const te=this.editor.config.get("collaboration.channelId");this._isPendingUpdate=!0,this._addPendingAction(),this.adapter.updateRevisions(t,te).finally(()=>{this._isPendingUpdate=!1}).then(be=>{if(be)for(const xe of be)this.setRevisionData({id:xe.id,createdAt:xe.createdAt});this._removePendingAction(),this.sendBufferedUpdates()})}_replaceEditorDataWithRevisionData(t,te){let be=this.editor.config.get("initialData"),xe=this.editor.config.get("rootsAttributes");if(be===void 0){be={};for(const Ae of this.editor.model.document.getRootNames())be[Ae]=""}if(typeof be=="string"&&(be={main:be}),xe===void 0){xe={};for(const Ae of this.editor.model.document.getRootNames())xe[Ae]={}}let ve=!1;const ke=Object.keys(be),Ie=Object.keys(t);for(const Ae of ke){if(be[Ae]!==t[Ae]&&be[Ae].trim()!==""){ve=!0;break}if(!isEqual(xe[Ae],te[Ae])&&Object.keys(xe[Ae]).length>0){ve=!0;break}}ve||(ve=Ie.some(Ae=>!this.editor.model.document.getRoot(Ae))),ve&&logWarning("editor-initial-data-replaced-with-revision-data",{editorData:be,editorRootsAttributes:xe,revisionData:t,revisionRootsAttributes:te}),this.editor.config.set("initialData",t),this.editor.config.set("rootsAttributes",te)}_addPendingAction(){if(!this._pendingAction){const t=this.editor.plugins.get("PendingActions");this._pendingAction=t.add(y(this.editor.locale,"PENDING_ACTION_REVISION_HISTORY"))}}_removePendingAction(){this._pendingAction&&(this.editor.plugins.get("PendingActions").remove(this._pendingAction),this._pendingAction=null)}_findInsertionIndex(t){const te=this.repository.getRevisions();te.reverse();let be=0;for(;be<te.length;){const xe=te[be];if(xe===this.currentRevision){be++;continue}if(xe.id===this._initialRevisionId)break;const ve=t.toVersion-xe.toVersion||t.fromVersion-xe.fromVersion;if(ve>0)break;if(ve<0)be++;else{if(!t.creator&&xe.creator)break;if(xe.creator||!t.creator){if(t.createdAt>xe.createdAt)break;be++}else be++}}return be}setRevisionData(t){const te=this.repository.getRevision(t.id);if(t.createdAt&&(t.createdAt=new Date(t.createdAt)),t.authorsIds){const be=this.editor.plugins.get("Users");t.authors=t.authorsIds.map(xe=>be.getUser(xe))}te._update(t,!0)}buildRevisionData({revision:t=null,from:te=null,to:be=null}){te=te!==null?te:t.fromVersion,be=be!==null?be:t.toVersion;const xe=this._revisionDataBuilder.getData(te,be),ve={diffData:xe.diffData,authorsIds:xe.authorsIds,fromVersion:te,toVersion:be};if(!t||be!==t.toVersion){const ke=be-1,Ie=this._source.history.getOperation(ke);ve.createdAt=Ie&&Ie.createdAt||new Date}if(this._loadedStateData&&te===this._loadedStateData.fromVersion)for(const ke of this._loadedStateData.authors)ve.authorsIds.includes(ke.id)||ve.authorsIds.push(ke.id);return ve}_loadRevisionData(t){if(!t||t.diffData)return Promise.resolve();{const te=this.editor.config.get("collaboration.channelId");return this.adapter.getRevision({channelId:te,revisionId:t.id}).then(be=>{t.diffData=be.diffData})}}_bufferUpdate(t,te,be){if(this._bufferedUpdates.has(t)){const xe=this._bufferedUpdates.get(t);te=be?{...xe,...te}:{...te,...xe}}this._bufferedUpdates.set(t,te)}_getFromVersion(t){const te=this.repository.getRevisions();te.reverse(),te.shift();const be=te.find(xe=>xe.toVersion<=t).toVersion;return be<this._startingVersion?this._startingVersion:be}_createInitialRevision(t){const te=this.repository.getRevision(this.repository.length-1);if(te)this._initialRevisionId=te.id;else{const be=!this.editor.model.document.roots.find(ke=>this.editor.model.hasContent(ke)),xe=this.editor.plugins.get("Users").me.id,ve=y(this.editor.locale,be?"Empty document":"Initial revision");this._makeRevision({from:t,to:t,id:this._initialRevisionId,name:ve,creatorId:xe})}}_createCurrentRevision(t){const te=this._source.getCurrentRevisionId();this.currentRevision=this.repository.getRevision(te),this.currentRevision||(this.currentRevision=this._makeRevision({from:t,to:t,id:te,name:"",creatorId:null}))}_makeRevision({name:t,from:te,to:be,creatorId:xe,id:ve}){const ke=this.buildRevisionData({from:te,to:be});ke.name=t,ke.creatorId=xe,ke.id=ve;const Ie=this.addRevisionData(ke);return this.adapter&&this._bufferUpdate(ke.id,ke,!0),Ie}_setConversion(){this.editor.conversion.for("dataDowncast").markerToData({model:"revision"})}_removeRevisionMarkers(t){return(t=t.filter(te=>!te.name||te.name!=="revision-start"&&te.name!=="revision-end")).forEach(te=>{typeof te!="string"&&(te.children=this._removeRevisionMarkers(te.children),te.attributes=te.attributes.filter(be=>!be[0].startsWith("data-revision-")))}),t}}function B$1(Te,we){const t=we.editing.view.document;if(typeof Te=="string")return new Text$1(t,Te);{const te=Te.children.map(be=>B$1(be,we));return new(T$1[Te.type]||Element$1)(t,Te.name,Te.attributes,te)}}let J$1=class{constructor(we){Re(this,"editor");Re(this,"source");Re(this,"_savedMetaData");Re(this,"_lastFrom");Re(this,"_lastTo");Re(this,"_markers");Re(this,"_diffRoots");Re(this,"_diffRootsAttributes");Re(this,"_baseRoots");Re(this,"_baseRootsAttributes");Re(this,"_idsRoots");Re(this,"_baseIdsRoots");Re(this,"_touched");Re(this,"_touchedMarkers");Re(this,"_touchedRoots");Re(this,"_revisionId");Re(this,"_startingRevisionId");this.editor=we,this._savedMetaData=new Map,this._lastFrom=-1,this._lastTo=-1,this._markers=new Map,this._diffRoots=new Map,this._diffRootsAttributes=new Map,this._baseRoots=new Map,this._baseRootsAttributes=new Map,this._idsRoots=new Map,this._baseIdsRoots=new Map,this._touched=new Map,this._touchedMarkers=new Map,this._touchedRoots=new Map,this._revisionId=1}init(we){this.source=we;const t=new Map,te=new Map,be=this.editor.model.document.roots.map(Ae=>Ae.rootName);for(const Ae of be){const Se=this.editor.model.document.getRoot(Ae),Oe=q$1(Se);t.set(Ae,Oe),te.set(Ae,Object.fromEntries(Se.getAttributes()))}const xe=Array.from(this.editor.model.markers).map(Ae=>[Ae.name,Ae.getRange()]),ve=this.source.version;this._saveMetaData(ve,t,xe,te),this._startingRevisionId=this._revisionId;const ke=new Map,Ie=new Map;for(const Ae of be){const Se=G$1(Ae);ke.set(Ae,Se),Ie.set(Ae,{})}this._saveMetaData(Number.NEGATIVE_INFINITY,ke,[],Ie)}getData(we,t){if(this._lastFrom===we&&this._lastTo<=t)this._savedMetaData.size>1&&this._removeMetaData(this._lastTo),this._applyOperations(this._lastTo,t,!0);else{if(!this._savedMetaData.has(we)){const te=this._getPreviousFrom(we);this._calculateMetaData(te,we,!1)}this._calculateMetaData(we,t,!0)}return this._lastFrom=we,this._lastTo=t,this._getState()}loadState(we){this._reset(),this._lastFrom=we.fromVersion,this._lastTo=we.toVersion;for(const Ie in we.diffData){const Ae=we.diffData[Ie].attachChange,Se=cloneDeep(we.diffData[Ie].attributesBefore)||{},Oe=this._makeModelFromViewString(we.diffData[Ie].deletions);Oe.rootName=Ie,Oe._isAttached=!Ae||!Ae.isAttached,Oe.isAttached=()=>Oe._isAttached,this._baseRoots.set(Ie,Oe),this._baseRootsAttributes.set(Ie,Se),Ae&&this._touchedRoots.set(Ie,Ae);const Ve=this._makeIdsRoot(Oe);this._baseIdsRoots.set(Ie,Ve);for(const[Me,De]of Oe.markers){if(!Me.startsWith("revision:"))continue;const Fe=Me.split(":")[2];for(const Be of De.getWalker({singleCharacters:!0})){const $e=this._getVidAttributeName(Be),Ue=Be.type=="elementEnd"?Be.previousPosition.path.slice(0,-1):Be.previousPosition.path,He=Ve.getNodeByPath(Ue).getAttribute($e);this._touched.set(He,{userId:Fe})}}}this._startingRevisionId=this._revisionId;const t=[...Array(this._revisionId).keys()].slice(1).filter(Ie=>!this._touched.has(Ie));let te=0;const be=new Map;for(const Ie in we.diffData){const Ae=we.diffData[Ie].attachChange,Se=cloneDeep(we.diffData[Ie].attributesAfter)||{},Oe=this._makeModelFromViewString(we.diffData[Ie].insertions);Oe.rootName=Ie,Oe._isAttached=!Ae||Ae.isAttached,Oe.isAttached=()=>Oe._isAttached,this._diffRoots.set(Ie,Oe),this._diffRootsAttributes.set(Ie,Se);const Ve=this._makeIdsRoot(Oe,Number.NEGATIVE_INFINITY);this._idsRoots.set(Ie,Ve),be.set(Ie,Oe.isAttached()?Se:{});for(const[Me,De]of Oe.markers){if(!Me.startsWith("revision:"))continue;const Fe=Me.split(":")[2];for(const Be of De.getWalker({singleCharacters:!0})){const $e=this._getVidAttributeName(Be),Ue=this._revisionId++,He=Be.type=="elementEnd"?Be.previousPosition.path.slice(0,-1):Be.previousPosition.path;Ve.getNodeByPath(He)._setAttribute($e,Ue),this._touched.set(Ue,{userId:Fe})}}for(const Me of this.editor.model.createRangeIn(Oe).getWalker({singleCharacters:!0})){const De=this._getVidAttributeName(Me),Fe=Me.type=="elementEnd"?Me.previousPosition.path.slice(0,-1):Me.previousPosition.path,Be=Ve.getNodeByPath(Fe);Be.getAttribute(De)>0||Be._setAttribute(De,t[te++])}for(const[Me,De]of Oe.markers)Me.startsWith("revision:")||this._markers.set(Me,De)}const xe=G$1("$graveyard");this._baseRoots.set("$graveyard",xe),this._baseIdsRoots.set("$graveyard",this._makeIdsRoot(xe,1));const ve=G$1("$graveyard");this._diffRoots.set("$graveyard",ve),this._idsRoots.set("$graveyard",this._makeIdsRoot(ve,1));const ke=Array.from(this._diffRoots).map(([Ie,Ae])=>[Ie,q$1(Ae)]);this._saveMetaData(this._lastTo,ke,this._markers,be)}_makeModelFromViewString(we){const t=JSON.parse(we),te=this.editor.editing.view.document,be=new DocumentFragment$1(te,t.map(xe=>B$1(xe,this.editor)));return this.editor.data.toModel(be)}_saveMetaData(we,t,te,be){const xe=new Map(t),ve=new Map(cloneDeep(be)),ke=new Map;for(const[Ie,Ae]of te)ke.set(Ie,{start:Ae.start.clone(),end:Ae.end.clone(),rootName:Ae.root.rootName});this._savedMetaData.set(we,{roots:xe,markers:ke,rootsAttributes:ve})}_removeMetaData(we){this._savedMetaData.delete(we)}reInit(){this._reset(),this._lastFrom=-1,this._lastTo=-1,this._savedMetaData.clear(),this.init(this.source)}_reset(){this._touched.clear(),this._touchedMarkers.clear(),this._touchedRoots.clear(),this._diffRoots.clear(),this._diffRootsAttributes.clear(),this._baseRoots.clear(),this._baseRootsAttributes.clear(),this._idsRoots.clear(),this._baseIdsRoots.clear(),this._markers.clear(),this._revisionId=1,this._startingRevisionId=this._revisionId}_makeIdsRoot(we,t=null){let te=null;we.is("documentFragment")||(te=new Element(we.name,{vid_start:t===null?this._revisionId++:t++}));const be=[];for(const xe of we.getChildren())if(xe.is("element")){be.push(this._makeIdsRoot(xe,t));const ve=be[be.length-1];t!==null&&(t=ve.is("element","$text")?ve.getAttribute("vid")+1:ve.getAttribute("vid_end")+1)}else for(let ve=0;ve<xe.offsetSize;ve++)be.push(new Element("$text",{vid:t===null?this._revisionId++:t++}));if(we.is("documentFragment")){const xe=G$1(we.rootName);return xe._insertChild(0,be),xe}return te._setAttribute("vid_end",t===null?this._revisionId++:t++),te._insertChild(0,be),te}_calculateMetaData(we,t,te){this._reset();const{roots:be,markers:xe,rootsAttributes:ve}=this._savedMetaData.get(we);this._baseRoots=new Map(be),this._baseRootsAttributes=new Map(cloneDeep(ve));for(const[ke,Ie]of this._baseRoots)if(ke!=="$graveyard"&&(this._diffRoots.set(ke,q$1(Ie)),this._diffRootsAttributes=new Map(cloneDeep(ve)),te)){const Ae=this._revisionId;this._idsRoots.set(ke,this._makeIdsRoot(Ie)),this._baseIdsRoots.set(ke,this._makeIdsRoot(Ie,Ae))}this._startingRevisionId=this._revisionId,this._diffRoots.set("$graveyard",q$1(this._baseRoots.get("$graveyard"))),te&&this._idsRoots.set("$graveyard",this._makeIdsRoot(this._baseRoots.get("$graveyard")));for(const[ke,Ie]of xe){const Ae=this._baseRoots.get(Ie.rootName),Se=this._diffRoots.get(Ie.rootName),Oe=new Range(this._fixPosition(Ie.start,Ae),this._fixPosition(Ie.end,Ae)),Ve=this._fixRange(Oe,Se);Ae.markers.set(ke,Oe),this._markers.set(ke,Ve)}this._applyOperations(we,t,te)}_applyOperations(we,t,te){for(const ve of this.source.getOperations(we,t))this._handleOperation(ve,te);for(const ve of this._diffRoots.values())ve.markers.clear();for(const[ve,ke]of this._markers)this._diffRoots.get(ke.root.rootName).markers.set(ve,ke.clone());const be=new Map,xe=new Map;for(const[ve,ke]of this._diffRoots)be.set(ve,q$1(ke)),xe.set(ve,this._diffRootsAttributes.get(ve));this._saveMetaData(t,be,this._markers,xe)}_getPreviousFrom(we){const t=Array.from(this._savedMetaData.keys());t.sort((te,be)=>te-be),t.reverse();for(const te of t)if(te<we)return te;return Number.NEGATIVE_INFINITY}_copyMarkers(we,t){const te=Array.from(t.markers).map(([be,xe])=>[be,this._fixRange(xe,we)]);we.markers=new Map(te)}_transformMarkers(we){for(const t of this._markers.values()){const te=t.getTransformedByOperation(we),be=Range._createFromRanges(te);t.start=be.start,t.end=be.end}}_handleOperation(we,t){if(we.type=="addRoot"||we.type=="detachRoot")return void this._handleRootOperation(we,t);if(we.type=="insert"){const be=we.position.root.rootName;this._diffRoots.has(be)||(this._diffRoots.set(be,G$1(be,!0)),this._diffRootsAttributes.set(be,{}),t&&this._idsRoots.set(be,G$1(be,!0)))}else if(we.type=="addRootAttribute"||we.type=="removeRootAttribute"||we.type=="changeRootAttribute")return void this._handleRootAttributeOperation(we);const te=this._cloneOperation(we,this._diffRoots);if(we.type!=="marker"&&(te._execute(),this._transformMarkers(te)),t)switch(te.type){case"insert":this._handleInsertOperation(we);break;case"move":case"remove":case"reinsert":this._handleMoveOperation(we);break;case"merge":this._handleMergeOperation(we);break;case"split":this._handleSplitOperation(we);break;case"marker":this._handleMarkerOperation(we)}}_cloneOperation(we,t){const te=we.clone();return te._authorId=we._authorId,this._fixOperation(te,t),te}_getBaseVids(we){return we.map(t=>{const te=this._getVidAttributeName(t);return Number(t.item.getAttribute(te))})}_generateTape(we,t){if(we.is("element","$text"))t.push({item:we,type:"text"});else{we.is("element")&&t.push({item:we,type:"elementStart"});for(const te of we.getChildren())this._generateTape(te,t);we.is("element")&&t.push({item:we,type:"elementEnd"})}return t}_getState(){const we=new Map(this._touched),t=new Map(we),te=new Map,be={insertions:{},deletions:{}},xe={insertions:{},deletions:{}},ve=new Map,ke=new Set([...this._baseRoots.keys(),...this._diffRoots.keys()]);ke.delete("$graveyard");for(const Oe of ke){const Ve=this._diffRoots.get(Oe)||G$1(Oe,!1),Me=this._baseRoots.get(Oe)||G$1(Oe,!1);Ve.isAttached()||Me.isAttached()?(be.insertions[Oe]=q$1(Ve),be.deletions[Oe]=q$1(Me),this._copyMarkers(be.deletions[Oe],Me),this._copyMarkers(be.insertions[Oe],Ve),xe.insertions[Oe]=this._generateTape(this._idsRoots.get(Oe),[]),xe.deletions[Oe]=this._generateTape(this._baseIdsRoots.get(Oe)||G$1(Oe,!1),[])):ke.delete(Oe)}for(const Oe of ke){const Ve=xe.insertions[Oe];for(const Me of Ve){const De=this._getVidAttributeName(Me),Fe=Me.item.getAttribute(De);t.delete(Fe),Fe>=this._startingRevisionId&&te.set(Fe,we.get(Fe))}}for(const Oe of ke){const Ve=xe.insertions[Oe],Me=this._getBaseVids(xe.deletions[Oe]);let De=0;for(const Fe of Ve){const Be=this._getVidAttributeName(Fe),$e=Fe.item.getAttribute(Be);if(!te.has($e)&&!ve.has($e))if(t.has($e))De++;else{if($e!=Me[De]){const Ue=we.get($e)||we.get(Me[De]);for(;$e!=Me[De];)t.has(Me[De])||(ve.set(Me[De],Ue),we.set(Me[De],Ue)),De++}De++}}}for(const Oe of ke){const Ve=xe.insertions[Oe];for(const Me of Ve){const De=this._getVidAttributeName(Me),Fe=Me.item.getAttribute(De);if(ve.has(Fe)){const Be=ve.get(Fe);t.has(Fe)||t.set(Fe,{...Be}),te.set(Fe,{...Be})}}}for(const Oe of t.keys())Oe>=this._startingRevisionId&&t.delete(Oe);const Ie=new Map;for(const Oe of ke){let Ve=xe.insertions[Oe];for(const Me of Ve)if(Me.item.is("element","tableCell")){const De=this._getVidAttributeName(Me),Fe=Me.item.getAttribute(De);if(te.has(Fe)){const Be=Me.item.parent.parent.getAttribute("vid_start"),$e=Ie.get(Be)||new Set;$e.add(te.get(Fe).userId),Ie.set(Be,$e)}}Ve=xe.deletions[Oe];for(const Me of Ve)if(Me.item.is("element","tableCell")){const De=this._getVidAttributeName(Me),Fe=Me.item.getAttribute(De);if(t.has(Fe)){const Be=Me.item.parent.parent.getAttribute("vid_start"),$e=Ie.get(Be)||new Set;$e.add(t.get(Fe).userId),Ie.set(Be,$e)}}for(const Me of Ie.keys())(te.has(Me)||t.has(Me))&&Ie.delete(Me)}for(const Oe of ke){const Ve=xe.insertions[Oe];let Me=null,De=null;for(const Fe of Ve){const Be=this._getVidAttributeName(Fe),$e=Fe.item.getAttribute(Be),Ue=Ie.get($e);Ue&&Fe.type=="elementStart"&&(Me=Array.from(Ue)[0],De=Fe.item.getAttribute("vid_end")),Me&&(t.set($e,{userId:Me}),te.set($e,{userId:Me})),$e==De&&(Me=null,De=null)}}const Ae={},Se=new Set;for(const Oe of ke){const Ve=be.deletions[Oe],Me=be.insertions[Oe];for(const{userId:De}of this._touchedMarkers.values())De!==null&&Se.add(De);for(const{userId:De}of this._touchedRoots.values())De!==null&&Se.add(De);this._markChanges(Me,xe.insertions[Oe],te,"insertion",Se),this._markChanges(Ve,xe.deletions[Oe],t,"deletion",Se),Ae[Oe]={insertions:this._prepareViewToSave(Me),deletions:this._prepareViewToSave(Ve),attachChange:this._touchedRoots.get(Oe)||null,attributesBefore:cloneDeep(this._baseRootsAttributes.get(Oe))||{},attributesAfter:cloneDeep(this._diffRootsAttributes.get(Oe))}}return{diffData:Ae,authorsIds:Array.from(Se)}}_processRootBeforeSave(we){for(const[,t]of we.markers){const te=t.start.getAncestors().filter(be=>be.name=="tableCell");for(const be of te)be.childCount==1&&be.getChild(0).is("element","paragraph")&&be.getChild(0)._setAttribute("keepParagraph",!0)}}_prepareViewToSave(we){this._processRootBeforeSave(we);const t=this.editor.data.toView(we,{}),te=Array.from(t.getChildren()).map(be=>this._getViewJson(be));return JSON.stringify(te)}_getViewJson(we){if(we.is("$text"))return we.data;{const t=we;return{type:Object.keys(T$1).find(te=>we instanceof T$1[te]),name:t.name,attributes:Array.from(t.getAttributes()),children:Array.from(t.getChildren()).map(te=>this._getViewJson(te))}}}_markChanges(we,t,te,be,xe){let ve=null,ke=null,Ie=0;const Ae=this.editor.model;for(let Oe=0;Oe<t.length;Oe++){const Ve=this._getVidAttributeName(t[Oe]),Me=t[Oe].item.getAttribute(Ve),De=te.get(Me),Fe=Oe==t.length-1;!ve&&De&&(ve=De,ke=t[Oe]),ve&&(!De||De.userId!=ve.userId)&&(Se(De,L$1(ke,we,Ae),L$1(t[Oe],we,Ae)),ve=De||null,ke=De?t[Oe]:null),ve&&Fe&&Se(De,L$1(ke,we,Ae),W$1(t[Oe],we,Ae))}function Se(Oe,Ve,Me){const De=ve.userId,Fe="revision:"+be+":"+De+":"+Ie++,Be=Ae.createRange(Ve,Me);we.markers.set(Fe,Be),De!==null&&xe.add(De)}}_getVidAttributeName(we){switch(we.type){case"elementStart":return"vid_start";case"elementEnd":return"vid_end";default:return"vid"}}_fixOperation(we,t){we.baseVersion=null;for(const te in we){const be=we[te];if(be instanceof Position){const xe=t.get(be.root.rootName);we[te]=this._fixPosition(be,xe)}if(be instanceof Range){const xe=t.get(be.root.rootName);we[te]=this._fixRange(be,xe)}te==="root"&&(we.root=t.get(we.root.rootName))}}_fixRange(we,t){return this.editor.model.createRange(this._fixPosition(we.start,t),this._fixPosition(we.end,t))}_fixPosition(we,t){return this.editor.model.createPositionFromPath(t,we.path,we.stickiness)}_handleInsertOperation(we){const t=this._idsRoots.get(we.position.root.rootName),te=this._fixPosition(we.position,t),be=we._authorId===null?null:we._authorId||this.editor.plugins.get("Users").me.id,xe=te.parent,ve=this._revisionId,ke=[];for(const Ae of we.nodes)if(Ae.is("element"))ke.push(this._makeIdsRoot(Ae));else for(let Se=0;Se<Ae.offsetSize;Se++)ke.push(new Element("$text",{vid:this._revisionId++}));const Ie=this._revisionId;for(let Ae=ve;Ae<Ie;Ae++)this._touched.set(Ae,{userId:be});xe._insertChild(te.offset,ke)}_handleMoveOperation(we){(we=this._cloneOperation(we,this._idsRoots))._execute();const t=we._authorId===null?null:we._authorId||this.editor.plugins.get("Users").me.id,te=we.getMovedRangeStart(),be=te.parent,xe=te.offset;(function ve(ke,Ie,Ae,Se){for(let Oe=Ae;Oe<Se;Oe++){const Ve=Ie.getChild(Oe);Ve.is("element","$text")?ke.set(Ve.getAttribute("vid"),{userId:t}):(ke.set(Ve.getAttribute("vid_start"),{userId:t}),ve(ke,Ve,0,Ve.childCount),ke.set(Ve.getAttribute("vid_end"),{userId:t}))}})(this._touched,be,xe,xe+we.howMany)}_handleMergeOperation(we){const t=(we=this._cloneOperation(we,this._idsRoots))._authorId===null?null:we._authorId||this.editor.plugins.get("Users").me.id,te=we.targetPosition.parent,be=we.sourcePosition.parent,xe=te.getAttribute("vid_end"),ve=be.getAttribute("vid_start");te._setAttribute("vid_end",be.getAttribute("vid_end")),be._setAttribute("vid_end",xe),this._touched.set(ve,{userId:t}),this._touched.set(xe,{userId:t}),we._execute()}_handleSplitOperation(we){const t=(we=this._cloneOperation(we,this._idsRoots))._authorId===null?null:we._authorId||this.editor.plugins.get("Users").me.id,te=we.graveyardPosition,be=we.splitPosition.parent;we._execute();const xe=be.getAttribute("vid_end"),ve=we.insertionPosition.nodeAfter;if(te){const ke=ve.getAttribute("vid_end"),Ie=be.getAttribute("vid_end");be._setAttribute("vid_end",ke),ve._setAttribute("vid_end",Ie),this._touched.set(be.getAttribute("vid_end"),{userId:t}),this._touched.set(ve.getAttribute("vid_start"),{userId:t})}else{const ke=this._revisionId++,Ie=this._revisionId++;be._setAttribute("vid_end",ke),ve._setAttribute("vid_start",Ie),ve._setAttribute("vid_end",xe),this._touched.set(ke,{userId:t}),this._touched.set(Ie,{userId:t})}}_handleMarkerOperation(we){if(!we.affectsData)return;const t=(we=this._cloneOperation(we,this._diffRoots)).oldRange?we.oldRange.root:null,te=we.newRange?we.newRange.root:null;t&&this._markers.delete(we.name),te&&this._markers.set(we.name,we.newRange.clone());const be=we._authorId===null?null:we._authorId||this.editor.plugins.get("Users").me.id,xe=we.name;if(!this._touchedMarkers.has(xe))return void this._touchedMarkers.set(xe,{range:we.oldRange,userId:be});const ve=this._touchedMarkers.get(xe),ke=ve.range,Ie=we.newRange;ke==null&&Ie==null||ke&&Ie&&ke.isEqual(Ie)?this._touchedMarkers.delete(we.name):ve.userId=be}_handleRootOperation(we,t){this._diffRoots.has(we.rootName)?this._diffRoots.get(we.rootName)._isAttached=we.isAdd:(this._diffRoots.set(we.rootName,G$1(we.rootName,!0)),this._diffRootsAttributes.set(we.rootName,{}),t&&this._idsRoots.set(we.rootName,G$1(we.rootName,!0)));const te=we._authorId===null?null:we._authorId||this.editor.plugins.get("Users").me.id,be=this._touchedRoots.get(we.rootName);be&&be.userId===te?this._touchedRoots.delete(we.rootName):this._touchedRoots.set(we.rootName,{userId:te,isAttached:we.isAdd})}_handleRootAttributeOperation(we){const t=this._diffRootsAttributes.get(we.root.rootName);we.newValue===null?delete t[we.key]:t[we.key]=we.newValue}};function q$1(Te){const we=G$1(Te.rootName,Te.isAttached());for(const t of Te.getChildren()){const te=t._clone(!0);we._appendChild(te)}return we}function G$1(Te,we=!0){const t=new DocumentFragment;return t.rootName=Te,t._isAttached=we,t.isAttached=()=>t._isAttached,t}function L$1(Te,we,t){const te=Te.type=="elementEnd"?t.createPositionAt(Te.item,"end"):t.createPositionBefore(Te.item);return t.createPositionFromPath(we,te.path,te.stickiness)}function W$1(Te,we,t){const te=Te.type=="elementStart"?t.createPositionAt(Te.item,0):t.createPositionAfter(Te.item);return t.createPositionFromPath(we,te.path,te.stickiness)}class ns extends View{constructor(t,te){super(t);Re(this,"focusTracker");Re(this,"keystrokes");Re(this,"revisionNameInputView");this.focusTracker=new FocusTracker,this.keystrokes=new KeystrokeHandler,this.set("revisionNameInputValue",""),this.revisionNameInputView=this._createRevisionNameInput(te),this.setTemplate({tag:"form",attributes:{class:["ck","ck-revision-history-save-revision-form","ck-responsive-form"],tabindex:"-1"},children:[this.revisionNameInputView]}),injectCssTransitionDisabler(this)}render(){super.render(),submitHandler({view:this}),this.focusTracker.add(this.revisionNameInputView.element),this.keystrokes.listenTo(this.element);const t=te=>te.stopPropagation();this.keystrokes.set("arrowright",t),this.keystrokes.set("arrowleft",t),this.keystrokes.set("arrowup",t),this.keystrokes.set("arrowdown",t)}focus(){this.revisionNameInputView.focus()}get revisionName(){return this.revisionNameInputView.fieldView.element.value.trim()}set revisionName(t){this.revisionNameInputView.fieldView.element.value=t.trim()}reset(){this.revisionNameInputView.fieldView.element.value="",this.revisionNameInputView.errorText=null}_createRevisionNameInput(t){const te=new LabeledFieldView(this.locale,createLabeledInputText),be=te.fieldView;be.extendTemplate({attributes:{maxlength:"220"}});let xe=y(this.locale,"Name of the revision");return!t&&(xe+=" ("+y(this.locale,"optional")+")"),te.label=xe,be.on("input",()=>{this.revisionNameInputValue=be.element.value.trim()}),te}}let u$1=class extends Plugin{constructor(){super(...arguments);Re(this,"_saveRevisionFormView")}static get pluginName(){return"RevisionHistoryUI"}static get requires(){return[l]}init(){const t=this.editor,te=t.plugins.get("RevisionTracker");t.ui.componentFactory.add("revisionHistory",be=>{const xe=createDropdown(be),ve=xe.panelView.children,ke=new ListView(be),Ie=new ListItemView(be),Ae=new ButtonView(be),Se=new ListItemView(be),Oe=new ButtonView(be);return xe.bind("isEnabled").to(te,"isReady",te,"isEnabled",t,"isReadOnly",(Ve,Me,De)=>Ve&&Me&&!De),xe.buttonView.set({icon:icons.history,label:y(be,"Revision history"),tooltip:!0}),Ae.set({label:y(be,"Save current revision"),withText:!0,role:"menuitem"}),Ae.bind("isEnabled").to(te,"isReady",te,"isEnabled",t,"isReadOnly",(Ve,Me,De)=>Ve&&Me&&!De),Ae.on("execute",()=>this._showDialog()),Oe.set({label:y(be,"Open revision history"),withText:!0,role:"menuitem"}),Oe.bind("isEnabled").to(te,"isReady",t,"isReadOnly",(Ve,Me)=>Ve&&!Me),Oe.on("execute",()=>{t.config.get("revisionHistory").showRevisionViewerCallback(),xe.isOpen=!1,t.editing.view.focus()}),Ie.children.add(Ae),Se.children.add(Oe),ke.role="menu",ke.items.addMany([Ie,Se]),ve.add(ke),xe}),t.ui.componentFactory.add("menuBar:revisionHistory",()=>this._registerMenuComponent())}_registerMenuComponent(){const t=this.editor,te=t.locale,be=new MenuBarMenuView(te),xe=new MenuBarMenuListView(te);be.buttonView.set({icon:icons.history,label:y(te,"Revision history")});const ve=new MenuBarMenuListItemView(te,be),ke=new MenuBarMenuListItemButtonView(te);ke.set({label:y(te,"Save current revision")}),ke.delegate("execute").to(be),ke.on("execute",()=>{this._showDialog()}),ve.children.add(ke),xe.items.add(ve);const Ie=new MenuBarMenuListItemView(te,be),Ae=new MenuBarMenuListItemButtonView(te);return Ae.set({label:y(te,"Open revision history")}),Ae.delegate("execute").to(be),Ae.on("execute",()=>{t.config.get("revisionHistory").showRevisionViewerCallback()}),Ie.children.add(Ae),xe.items.add(Ie),be.panelView.children.add(xe),be}_showDialog(){const t=this.editor,te=t.locale,be=te.t,xe=t.plugins.get("Dialog"),ve=t.plugins.get("RevisionTracker");function ke(Ie){t.config.get("revisionHistory.requireRevisionName")&&Ie.revisionName===""?Ie.revisionNameInputView.errorText=y(te,"The revision name cannot be empty."):(t.plugins.get(l).saveRevision({name:Ie.revisionName}),xe.hide())}this._saveRevisionFormView||(this._createSaveRevisionFormView(),this._saveRevisionFormView.on("submit",()=>ke(this._saveRevisionFormView))),this._saveRevisionFormView.reset(),xe.show({id:"revisionSave",title:y(te,"Save current revision"),isModal:!0,content:this._saveRevisionFormView,actionButtons:[{label:be("Cancel"),withText:!0,onExecute:()=>xe.hide()},{label:be("Accept"),class:"ck-button-action",withText:!0,onCreate(Ie){Ie.bind("isEnabled").to(ve,"isReady",ve,"isEnabled",t,"isReadOnly",(Ae,Se,Oe)=>Ae&&Se&&!Oe)},onExecute:()=>ke(this._saveRevisionFormView)}]})}_createSaveRevisionFormView(){const t=this.editor,te=t.locale;this._saveRevisionFormView=new ns(te,t.config.get("revisionHistory.requireRevisionName")),this._saveRevisionFormView.render()}},Z$1=class extends View{constructor(t,te){super(t);Re(this,"changeId");Re(this,"_model");this._model=te,this.changeId=te.id;const be=this.bindTemplate,xe=y(t,te.data.isSuggestion?"Suggested by":te.type=="add"?"Added by":"Removed by");this.set("type",te.type),this.setTemplate({tag:"div",attributes:{class:["ck-annotation","ck-revision-change",be.to("type",ve=>"ck-revision-change__"+ve)],tabindex:-1},children:[{tag:"span",children:[{tag:"span",attributes:{class:["ck-revision-change__label"]},children:[{text:xe}]},{text:" "+te.author.name}]}]})}focus(){this.element.focus()}},r$1=class extends ObservableMixin(){constructor(t){super();Re(this,"id");Re(this,"author");Re(this,"type");Re(this,"data");Re(this,"rootName");this.id=t.id||uid(),this.author=t.author,this.type=t.type,this.data=t.data||{},this.rootName=t.rootName,this.set("createdAt",t.createdAt)}toJSON(){return{id:this.id,authorId:this.author.id,type:this.type,data:this.data,createdAt:this.createdAt}}},f$2=class{constructor(we,t){Re(this,"newRevisionId");Re(this,"oldRevisionId");Re(this,"changes");this.newRevisionId=we,this.oldRevisionId=t,this.changes=new Collection}_setChanges(we){for(const t of we)this.changes.add(t)}};const tt$1={c:ContainerElement,a:AttributeElement,e:EmptyElement,r:RawElement,u:UIElement};let d$3=class extends Plugin{constructor(t){super(t);Re(this,"repository");Re(this,"adapter");Re(this,"_activeViewTarget");Re(this,"_changeView");Re(this,"_changeIdToChange");Re(this,"_balloon");this.repository=this.editor.plugins.get("RevisionsRepository"),this.set("activeChange",null),this.set("activeView",null),this._activeViewTarget=null,this.set("diff",null),this.set("isReady",!1),this.set("isEnabled",!0),this.on("change:isEnabled",(te,be,xe)=>{this.activeChange=null,this.activeView=null,this.editor.editing.view.change(ve=>{for(const ke of this.editor.editing.view.document.roots)xe?ve.removeClass("ck-editor__editable__overlay",ke):ve.addClass("ck-editor__editable__overlay",ke)})}),this.bind("isNavigationMode").to(this,"activeChange",te=>te!==null),this.bind("currentChangeNumber").to(this,"isReady",this,"diff",this,"activeChange",(te,be,xe)=>te&&xe?be.changes.getIndex(xe):0),this.bind("numberOfChanges").to(this,"isReady",this,"diff",(te,be)=>te?be.changes.length:0),this._changeView=null,this._changeIdToChange=new Map,this.adapter=null,this._balloon=this.editor.plugins.get(ContextualBalloon)}static get pluginName(){return"RevisionViewer"}static get requires(){return[l$8,ContextualBalloon,A]}init(){const t=this.editor,te=new yt$1(t,{direction:"backward"}),be=new yt$1(t,{direction:"forward"});t.commands.add("showPreviousChange",te),t.commands.add("showNextChange",be),t.commands.add("restoreRevision",new bt$1(t)),this.on("change:numberOfChanges",()=>{te.refresh(),be.refresh()}),this._setConversion(),this._initInteractions(),t.enableReadOnlyMode("revision-viewer"),t.plugins.has("WidgetToolbarRepository")&&t.plugins.get("WidgetToolbarRepository").forceDisabled("revision-viewer")}async getRevisionData(t){await this.loadRevisionData(t);const te={};for(const be in t.diffData){if(t.diffData[be].attachChange&&!t.diffData[be].attachChange.isAttached)continue;const xe=this._removeRevisionMarkers(JSON.parse(t.diffData[be].insertions)),ve=this.editor.editing.view.document,ke=new DocumentFragment$1(ve,xe.map(Ie=>this._getViewObj(Ie)));this.editor.data.processor.useFillerType("marked"),te[be]=this.editor.data.processor.toData(ke),this.editor.data.processor.useFillerType("default")}return te}async getRevisionRootsAttributes(t){await this.loadRevisionData(t);const te={};for(const be in t.diffData)t.diffData[be].attachChange&&!t.diffData[be].attachChange.isAttached||(te[be]=t.diffData[be].attributesAfter||{});return te}_removeRevisionMarkers(t){return(t=t.filter(te=>!te.name||te.name!=="revision-start"&&te.name!=="revision-end")).forEach(te=>{typeof te!="string"&&(te.children=this._removeRevisionMarkers(te.children),te.attributes=te.attributes.filter(be=>!be[0].startsWith("data-revision-")))}),t}async compare(t,te,be=!1){if(!this.isEnabled)return;const xe=this.diff,ve=this.repository,ke=typeof t=="string"?ve.getRevision(t):t,Ie=typeof te=="string"?ve.getRevision(te):te,Ae=ke.id,Se=Ie?Ie.id:null;if(!be&&this.diff&&this.diff.newRevisionId===Ae&&this.diff.oldRevisionId===Se)return Promise.resolve();this.isReady=!1,this.activeView=null,this.activeChange=null,this.diff=new f$2(Ae,Se);const Oe=this._getRevisionsRange(ke,Ie,!0).map(Ve=>this.loadRevisionData(Ve));return Oe.push(new Promise(Ve=>{setTimeout(Ve,20)})),Promise.all(Oe).then(()=>{if(!this.isEnabled)return;this._cleanUp();const Ve=this._getDiff(Ae,Se);for(const Me of Ve.changes)this._changeIdToChange.set(Me.id,Me);this.editor.model.enqueueChange({isUndoable:!1},Me=>{for(const De of this.editor.model.document.getRootNames())Me.detachRoot(De);for(const De of Object.keys(Ve.model)){const Fe=Me.addRoot(De);for(const Be of Object.keys(Ve.attributes[De]))Me.setAttribute(Be,Ve.attributes[De][Be],Fe);Me.insert(Ve.model[De],Fe,0)}}),this.diff._setChanges(this._sortAndFilterDiffChanges(Ve.changes)),this.isReady=!0}).catch(Ve=>{console.error(Ve),this._cleanUp(),xe&&(this.diff=xe),this.isReady=!0})}addRevisionData(t,te){const be=this.repository.createRevision(t);return be.on("_update",(xe,ve,ke)=>te(ve,ke,be)),this.repository.addRevision(be),be}loadRevisionData(t){if(!t||t.diffData)return Promise.resolve();{const te=this.editor.config.get("collaboration.channelId");return this.adapter.getRevision({channelId:te,revisionId:t.id}).then(be=>{t._update({diffData:be.diffData},!0)})}}_cleanUp(){this.activeChange=null,this._cleanMarkers(),this._changeView&&this._changeView.destroy(),this._changeView=null,this._changeIdToChange.clear(),this.editor.model.enqueueChange({isUndoable:!1},t=>{for(const te of this.editor.model.document.getRootNames())t.detachRoot(te)})}_sortAndFilterDiffChanges(t){const te=[],be=new Map;for(const xe of this.editor.model.document.getRootNames()){const ve=this.editor.editing.view.getDomRoot(xe);if(!ve)continue;const ke=ve.getClientRects().item(0);ke&&(te.push(xe),be.set(xe,ke))}return te.sort((xe,ve)=>{const ke=be.get(xe),Ie=be.get(ve);return ke.y-Ie.y||ke.x-Ie.x}),(t=t.filter(xe=>te.includes(xe.rootName))).sort((xe,ve)=>te.indexOf(xe.rootName)-te.indexOf(ve.rootName)),t}_makeTape(t){const te=Array.from(t.markers).filter(([xe,ve])=>xe.startsWith("revision:")&&!ve.isCollapsed),be=Array.from(this.editor.model.createRangeIn(t).getWalker({singleCharacters:!0}));if(te.length!=0)for(const xe of be){const[ve,ke]=te[0],[,Ie,Ae]=ve.split(":");if(ke.end.isEqual(xe.nextPosition)&&te.shift(),(xe.previousPosition.isEqual(ke.start)||xe.previousPosition.isAfter(ke.start))&&(Ie=="insertion"?xe.isAdded={userId:Ae}:Ie=="deletion"&&(xe.isRemoved={userId:Ae})),te.length==0)break}return be}_refreshStartEndIndex(t){const te=new Map;for(let be=0;be<t.length;be++)t[be].type==="text"?(t[be].item.startIndex=be,t[be].item.endIndex=be):(t[be].type==="elementStart"?t[be].item.startIndex=be:t[be].type==="elementEnd"&&(t[be].item.endIndex=be),te.set(t[be].id,be));for(const be of te.values())t[be].type==="elementStart"?t[be].item.endIndex=te.get(t[be].pairId):t[be].type==="elementEnd"&&(t[be].item.startIndex=te.get(t[be].pairId))}_processTape(t){for(let te=0;te<t.length;te++){if(t[te].type==="elementStart")t[te].item.startIndex=te;else if(t[te].type==="elementEnd"){t[te].item.endIndex=te;const be=t[te].item.startIndex;t[be].pairId=t[te].id,t[te].pairId=t[be].id}else t[te].item.startIndex=te,t[te].item.endIndex=te,t[te].pairId=null;t[te].markersStart||(t[te].markersStart=[],t[te].markersEnd=[])}}_markInsertions(t,te){const be=t.filter(xe=>!xe.isAdded);for(let xe=0;xe<te.length;xe++)te[xe].isAdded&&(be[xe].isAdded=te[xe].isAdded)}_makeModelFromViewString(t){const te=JSON.parse(t),be=this.editor.editing.view.document,xe=new DocumentFragment$1(be,te.map(ve=>this._getViewObj(ve)));return this.editor.data.toModel(xe)}_getViewObj(t){const te=this.editor.editing.view.document;if(typeof t=="string")return new Text$1(te,t);{const be=t.children.map(xe=>this._getViewObj(xe));return new(tt$1[t.type]||Element$1)(te,t.name,t.attributes,be)}}_getDiff(t,te=null){const be=this.repository.getRevision(t),xe=te?this.repository.getRevision(te):null,ve=this._getRevisionsRange(be,xe),ke=ve[ve.length-1],Ie=new Map,Ae={model:{},attributes:{},changes:[]},Se=new Set,Oe=new Map;for(let Ve=ve.length-1;Ve>=0;Ve--){const Me=ve[Ve];for(const De of Object.keys(Me.diffData))if(Me.diffData[De].attachChange){const Fe=Me.diffData[De].attachChange;Fe.isAttached?(Se.add(De),Oe.has(De)&&Oe.get(De).userId==Fe.userId?Oe.delete(De):Oe.set(De,Fe)):Oe.has(De)?(Se.delete(De),Oe.delete(De)):(Se.add(De),Oe.set(De,Fe))}else Se.add(De)}for(const Ve of Se){const Me=Oe.has(Ve)&&!Oe.get(Ve).isAttached;let De=Me?ve.length-1:0;const Fe=Me?-1:1;for(;ve[De];){const Be=ve[De];if(Be.diffData[Ve]){const $e=Me?Be.diffData[Ve].attributesBefore:Be.diffData[Ve].attributesAfter;Ae.attributes[Ve]=$e?cloneDeep($e):{};break}De+=Fe}}for(const Ve of ve){Ve.model={};for(const Me of Ve.authors)Ie.set(Me.id,Me);for(const Me of Se){const De=Ve.diffData[Me]?Ve.diffData[Me].insertions:"[]",Fe=Ve.diffData[Me]?Ve.diffData[Me].deletions:"[]";Ve.model[Me]={insertions:this._makeModelFromViewString(De),deletions:this._makeModelFromViewString(Fe)}}}for(const Ve of Se){let Me=null,De=0;const Fe=new Map(Array.from(be.model[Ve].insertions.markers).filter(([Ke])=>!Ke.startsWith("revision:")));let Be=0;for(const Ke of ve){const Qe=this._makeTape(Ke.model[Ve].insertions);Ke==be?(Me=Qe,De=Me.length,Me.forEach(Ze=>{Ze.id=Be++}),this._processTape(Me)):this._markInsertions(Me,Qe);const je=Me.filter(Ze=>!Ze.isAdded).map(Ze=>Ze.id);let Ye=0;const ht=this._makeTape(Ke.model[Ve].deletions);ht.forEach(Ze=>{Ze.isRemoved?Ze.id=De++:Ze.id=je[Ye++]}),this._processTape(ht),this._setDistance(Me,"isAdded"),this._setDistance(ht,"isRemoved"),Ke==be&&this._markMarkers(Me,Fe),Me=this._joinTapes(Me,ht),this._refreshStartEndIndex(Me),this._setDistance(Me,"isRemoved")}Me=Me.filter(Ke=>!(Ke.isAdded&&Ke.isRemoved));const $e=new Map(ke.model[Ve].deletions.markers),Ue=new Set(Fe.keys());for(const Ke of $e.keys())Ue.delete(Ke);this._markSuggestions(Me,Ue),this._fixObsoleteTags(Me),Me=this._removeMissingPairs(Me),Me=this._markMismatchedRemovedTags(Me),Me=this._removeUnsupportedChanges(Me);const{root:He,changes:ze}=this._makeModelFromTape(Me,Ie,Ve);Ae.model[Ve]=He;const qe=Oe.get(Ve);if(qe){const Ke=Ie.get(qe.userId),Qe=new r$1({author:Ke,type:qe.isAttached?"add":"remove",data:{isOnRoot:!0},createdAt:new Date,rootName:Ve});ze.unshift(Qe),Ae.attributes[Ve].revisionHistoryAttachChange=Qe.id}Ae.changes=Ae.changes.concat(ze)}return Ae}_markMarkers(t,te){for(let be=0;be<t.length;be++)for(const[xe,ve]of te)ve.start.isEqual(t[be].previousPosition)&&t[be].markersStart.push(xe),ve.end.isEqual(t[be].nextPosition)&&t[be].markersEnd.push(xe)}_joinTapes(t,te){let be=[],xe=0,ve=0;for(;xe<t.length||ve<te.length;){const ke=t[xe]||{},Ie=te[ve]||{};if(ke.id==Ie.id)xe++,ve++,be.push(ke);else if(Ie.isRemoved&&ke.isAdded){const{commonTape:Ae,iEnd:Se,jEnd:Oe}=this._threeWayMerge(t,xe,te,ve);be=be.concat(Ae),xe=Se,ve=Oe}else Ie.isRemoved?(ve++,be.push(Ie)):(xe++,be.push(ke))}return be}_markSuggestions(t,te){const be=[];for(let ke=0;ke<t.length;ke++){for(let Ie=0;Ie<t[ke].markersStart.length;Ie++){const Ae=t[ke].markersStart[Ie];if(!te.has(Ae))continue;const{group:Se,type:Oe,authorId:Ve}=xe(Ae);Se!="revision-suggestion"||Oe!="insertion"&&Oe!="deletion"||(be.unshift({type:Oe,name:Ae,userId:Ve}),t[ke].markersStart.splice(Ie,1),Ie--)}ve(t[ke]);for(let Ie=0;Ie<t[ke].markersEnd.length;Ie++){const Ae=t[ke].markersEnd[Ie];if(!te.has(Ae))continue;const{group:Se,type:Oe}=xe(Ae);if(Se!="revision-suggestion"||Oe!="insertion"&&Oe!="deletion")continue;t[ke].markersEnd.splice(Ie,1),Ie--;const Ve=be.findIndex(Me=>Me.name==Ae);Ve>-1&&be.splice(Ve,1)}}function xe(ke){const Ie=ke.split(":");return{group:Ie[0],type:Ie[1],subType:Ie.length>=5?Ie[2]:null,id:Ie.length<5?Ie[2]:Ie[3],authorId:Ie.length<5?Ie[3]:Ie[4],markerCount:Ie.length==6?Ie[5]:null}}function ve(ke){for(let Ie=0;Ie<be.length;Ie++){if(ke.isAdded&&be[Ie].type=="insertion")return ke.isAddSuggestion=be[Ie],void delete ke.isAdded;if(!ke.isAdded&&!ke.isRemoved&&be[Ie].type=="deletion")return void(ke.isRemoveSuggestion=be[Ie])}}}_setDistance(t,te){let be=0,xe=!1;const ve=new Map;for(const ke of t)ke[te]?xe&&(be++,xe=!1):(be++,xe=!0),ve.set(ke.id,be);for(let ke=0;ke<t.length;ke++){if(te=="isRemoved"&&t[ke].isAdded||te=="isAdded"&&t[ke].isRemoved)continue;if(t[ke].type=="text"){t[ke].distance=0;continue}const Ie=ve.get(t[ke].pairId),Ae=ve.get(t[ke].id);t[ke].distance=Ie-Ae}}_getRevisionsRange(t,te,be=!1){const xe=[];let ve=this.repository.getIndex(t),ke=this.repository.getIndex(te);for(ke==-1&&(ke=this.repository._revisions.length,be=!1);ve<ke;)xe.push(this.repository.getRevision(ve)),ve++;return be&&xe.push(this.repository.getRevision(ve)),xe}_threeWayMerge(t,te,be,xe){const ve=this.editor.model.schema;let ke=te;for(;t[ke]&&t[ke].isAdded;)ke++;let Ie=xe;for(;be[Ie]&&be[Ie].isRemoved;)Ie++;Se(t,te,ke),Se(be,xe,Ie);const Ae=be.slice(xe,Ie).concat(t.slice(te,ke));return Ae.sort((Oe,Ve)=>Oe.side!=Ve.side?Oe.side-Ve.side:Oe.level!=Ve.level?Oe.level-Ve.level:Oe.distance!=Ve.distance?Ve.distance-Oe.distance:!!Oe.isAdded!=!!Ve.isAdded?Oe.side==-1||Oe.side==0?Oe.isAdded?-1:1:Oe.isAdded?1:-1:Oe.index-Ve.index),{commonTape:Ae,iEnd:ke,jEnd:Ie};function Se(Oe,Ve,Me){let De=-1,Fe=Number.POSITIVE_INFINITY,Be=!0;for(let Ue=Ve;Ue<Me;Ue++)if(ve.isInline(Oe[Ue].item)||(Be=!1),Oe[Ue].item.startIndex<Ve&&(De=Ue),Oe[Ue].item.endIndex>=Me){Fe=Ue;break}Be&&(De=Me-1);for(let Ue=Ve;Ue<Me;Ue++)Oe[Ue].side=Ue<=De?-1:Ue<Fe?0:1,Oe[Ue].index=Ue;let $e=0;for(let Ue=Ve;Ue<=De;Ue++)Oe[Ue].distance==0?Oe[Ue].level=$e:($e++,Oe[Ue].level=$e,$e++);for(let Ue=Ve;Ue<Me;Ue++)Oe[Ue].side==0&&(Oe[Ue].level=$e);$e=0;for(let Ue=Me-1;Ue>=Fe;Ue--)Oe[Ue].distance==0?Oe[Ue].level=$e:($e--,Oe[Ue].level=$e,$e--)}}_fixObsoleteTags(t){const te=new Map,be=this.editor.model.schema;for(let xe=1;xe<t.length;xe++){let ve,ke,Ie;const Ae=t[xe],Se=t[xe-1];if(Ae.type=="text"||Ae.type!=Se.type||!be.isBlock(Se.item)||be.isLimit(Se.item)||!be.isBlock(Ae.item)||be.isLimit(Ae.item))continue;if((t[xe].isAdded||t[xe].isAddSuggestion)&&t[xe-1].isRemoved)ve=t[xe],ke=t[xe-1],Ie=xe-1;else{if(!t[xe].isRemoved||!t[xe-1].isAdded&&!t[xe-1].isAddSuggestion)continue;ve=t[xe-1],ke=t[xe],Ie=xe}const Oe=ve.level==ke.level,Ve=Math.abs(ve.level)<Math.abs(ke.level)&&ke.distance==0;(Oe||Ve)&&(te.set(ke.id,ve.id),t.splice(Ie,1),xe--,ve.isAdded=!1)}for(let xe=0;xe<t.length;xe++)te.has(t[xe].pairId)&&(t[xe].pairId=te.get(t[xe].pairId))}_removeMissingPairs(t){const te=new Set(t.map(be=>be.id));for(let be=0;be<t.length;be++)te.has(t[be].pairId)||t[be].distance==0||(t[be].isIncorrect=!0);return t.filter(be=>!be.isIncorrect)}_markMismatchedRemovedTags(t){const te=new Set;for(let be=0;be<t.length;be++){if(te.has(t[be].id)&&t[be].isRemoved&&(t[be].isIncorrect=!0),t[be].isIncorrect||t[be].distance==0||t[be].type!="elementStart"||t[be].pairId==null)continue;let xe=be+1,ve=0;for(;t[xe].id!=t[be].pairId;)t[xe].type=="elementStart"?ve++:t[xe].type=="elementEnd"&&ve--,xe++;if(ve!=0)if(t[be].isRemoved)t[be].isIncorrect=!0;else for(;xe!=be;)t[xe].isRemoved&&t[xe].distance!=0&&(t[xe].isIncorrect=!0,te.add(t[xe].pairId)),xe--}return t.filter(be=>!be.isIncorrect)}_removeUnsupportedChanges(t){const te=this.editor.model.schema;for(let be=0;be<t.length;be++){if(!(t[be].isAdded||t[be].isAddSuggestion||t[be].isRemoved||t[be].isRemoveSuggestion)||t[be].distance==0)continue;const xe=t[be].item;te.isBlock(xe)||te.isLimit(xe)||(t[be].isAdded&&delete t[be].isAdded,t[be].isAddSuggestion&&delete t[be].isAddSuggestion,t[be].isRemoveSuggestion&&delete t[be].isRemoveSuggestion,t[be].isRemoved&&(t[be].isIncorrect=!0))}return t.filter(be=>!be.isIncorrect)}_makeModelFromTape(t,te,be){const xe=new DocumentFragment,ve=[],ke=new Map,Ie=this.editor.model,Ae=Ie.schema,Se=[xe],Oe={},Ve={isAdded:[],isRemoved:[],isAddSuggestion:[],isRemoveSuggestion:[]};let Me=null;const De=[0];for(let Ue=0;Ue<t.length;Ue++){let He,ze;if(t[Ue].type==="elementStart"){He=Ie.createPositionFromPath(xe,De);const qe=new Element(t[Ue].item.name,t[Ue].item.getAttributes());Se[0]._appendChild(qe),De.push(0),Se.unshift(qe),ze=Ie.createPositionFromPath(xe,De),Me=null}else if(t[Ue].type==="elementEnd")Se.shift(),He=Ie.createPositionFromPath(xe,De),De.pop(),De[De.length-1]++,ze=Ie.createPositionFromPath(xe,De),Me=null;else{if(He=Ie.createPositionFromPath(xe,De),Me&&$e(Me,t[Ue].item))Me._data+=t[Ue].item.data;else{const qe=new Text(t[Ue].item.data,t[Ue].item.getAttributes());Se[0]._appendChild(qe),Me=qe}De[De.length-1]+=t[Ue].item.offsetSize,ze=Ie.createPositionFromPath(xe,De)}for(const qe of t[Ue].markersStart)ke.set(qe,{start:He,end:null});Fe("isRemoveSuggestion",Ue,He,ze),Fe("isAddSuggestion",Ue,He,ze),Fe("isRemoved",Ue,He,ze),Fe("isAdded",Ue,He,ze);for(const qe of t[Ue].markersEnd)ke.get(qe).end=ze}for(const[Ue,He]of ke){const ze=this.editor.model.createRange(He.start,He.end);xe.markers.set(Ue,ze)}return ve.sort((Ue,He)=>{const ze=xe.markers.get("revision:"+Ue.id),qe=xe.markers.get("revision:"+He.id);return ze.start.isBefore(qe.start)?-1:ze.start.isAfter(qe.start)?1:ze.end.isBefore(qe.end)?-1:ze.end.isAfter(qe.end)?1:Ue.type==="add"?-1:1}),{root:xe,changes:ve};function Fe(Ue,He,ze,qe){const Ke=!!t[He][Ue],Qe=Ke?t[He][Ue].userId:null,je=He===t.length-1,Ye=Ve[Ue][0],ht=Ae.isObject(t[He].item);!Oe[Ue]&&Ke?Oe[Ue]={start:ze,tapeItem:t[He],userId:Qe,type:Ue}:Oe[Ue]&&!Ke?(Oe[Ue].end=ze,Be(Oe[Ue]),Oe[Ue]=null):Oe[Ue]&&Ke&&Oe[Ue].userId!==Qe&&(Oe[Ue].end=ze,Ye&&Ye.userId===Oe[Ue].userId||Be(Oe[Ue]),Oe[Ue]={start:ze,tapeItem:t[He],userId:Qe,type:Ue}),Oe[Ue]&&ht&&(t[He].type!=="elementStart"||Ye&&Ye.userId===Qe||Ve[Ue].unshift({userId:Qe,object:t[He].item,change:Oe[Ue]}),t[He].type==="elementEnd"&&Ye&&Ye.object===t[He].item&&(Ve[Ue].shift(),Oe[Ue]=Ye.change)),Oe[Ue]&&je&&(Oe[Ue].end=qe,Be(Oe[Ue]),Oe[Ue]=null)}function Be({start:Ue,end:He,tapeItem:ze,userId:qe,type:Ke}){const Qe=ze.item,je=Ie.schema.isBlock(Qe)&&!Ie.schema.isLimit(Qe),Ye=Ue.nodeAfter==He.parent&&He.isAtStart;if(je&&Ye)return;const ht=Ie.createRange(Ue,He),Ze=te.get(qe),Bt=new r$1({author:Ze,type:Ke=="isAdded"||Ke=="isAddSuggestion"?"add":"remove",data:{isSuggestion:Ke=="isAddSuggestion"||Ke=="isRemoveSuggestion"},createdAt:new Date,rootName:be});ve.push(Bt),xe.markers.set("revision:"+Bt.id,ht)}function $e(Ue,He){const ze=Ue.getAttributes(),qe=He.getAttributes();for(const Ke of ze){if(Ke[1]!==He.getAttribute(Ke[0]))return!1;qe.next()}return qe.next().done}}_setConversion(){this.editor.conversion.for("upcast").dataToMarker({view:"revision"}),this.editor.conversion.for("editingDowncast").markerToHighlight({model:"revision",view:t=>{const te=t.markerName.split(":")[1],be=this._getChangeFromId(te);if(!be)return null;const xe=be.type=="add"?"insertion":"deletion",ve=["ck-suggestion-marker","ck-suggestion-marker-"+xe];return be.data.isSuggestion&&ve.push("ck-suggestion-marker-"+xe+"-new"),this.activeChange==be&&ve.push("ck-suggestion-marker--active"),{classes:ve,attributes:{"data-change-id":te}}}}),this.editor.conversion.for("upcast").add(t=>{t.on("element:pre",(te,be,xe)=>{const ve=be.viewItem.getChild(0);if(!ve||!ve.is("element","code")||!xe.consumable.consume(ve,{attributes:["vid_start","vid_end"]}))return;const ke=be.modelRange.start.nodeAfter;xe.writer.setAttribute("vid_start",ve.getAttribute("vid_start"),ke),xe.writer.setAttribute("vid_end",ve.getAttribute("vid_end"),ke)},{priority:"low"})}),this.editor.conversion.for("upcast").add(t=>{t.on("element",(te,be,xe)=>{if(!xe.consumable.consume(be.viewItem,{attributes:["vid_start","vid_end"]})||be.modelRange.isCollapsed)return;const ve=be.modelRange.start.nodeAfter;ve.hasAttribute("vid_start")||ve.hasAttribute("vid")||(xe.writer.setAttribute("vid_start",be.viewItem.getAttribute("vid_start"),ve),xe.writer.setAttribute("vid_end",be.viewItem.getAttribute("vid_end"),ve))},{priority:"low"})}),this.editor.conversion.for("upcast").elementToAttribute({view:{name:"span",attributes:{vid:!0}},model:{key:"vid",value:t=>t.getAttribute("vid")}}),this.editor.model.schema.on("checkAttribute",(t,[,te])=>{["vid_start","vid_end","vid"].includes(te)&&(t.return=!0,t.stop())},{priority:"highest"}),this.editor.conversion.for("dataDowncast").add(t=>{t.on("attribute:vid",(te,be,xe)=>{if(be.item.data!=" "||be.item.parent.maxOffset>1||!xe.consumable.consume(be.item,te.name))return;const ve=xe.writer,ke=xe.mapper.toViewRange(be.range);ve.wrap(ke,ve.createAttributeElement("span"))})}),this.editor.conversion.for("dataDowncast").markerToData({model:"revision"}),this.editor.editing.downcastDispatcher.on("addMarker:revision",function(t){const te=t.plugins.get("RevisionViewer");return(be,xe,ve)=>{const ke=xe.markerName.split(":")[1],Ie=te._getChangeFromId(ke);if(!Ie)return null;const Ae=Ie.type=="add"?"split":"merge";if(!ve.consumable.test(xe.markerRange,be.name))return;const Se=xe.markerRange.getWalker(),Oe=xe.markerRange.start,Ve=t.model.schema;let Me=null,De=null,Fe=!1,Be=!1;for(const Ue of Se){const He=Ue.item;Fe=Fe||Ve.isContent(He);const ze=ve.mapper.toViewElement(He);if(ze&&ze.getCustomProperty("addHighlight"))return;Ue.type=="elementEnd"&&Ve.isBlock(He)&&!Ve.isLimit(He)&&(He.nextSibling||Oe.isAtEnd?Me&&Me.parent==He||(Me=He,$e(Ue.previousPosition),Be=!0):De=De||Ue.previousPosition)}function $e(Ue){const He=ve.writer.createUIElement("span",{class:"ck-suggestion-marker-"+Ae}),ze=ve.mapper.toViewPosition(Ue);Ie.data.isSuggestion&&ve.writer.addClass("ck-suggestion-marker-"+Ae+"-new",He),te.activeChange==Ie&&ve.writer.addClass("ck-suggestion-marker--active",He),ve.writer.insert(ze,He),ve.mapper.bindElementToMarker(He,xe.markerName)}Fe||Be||!De||$e(De)}}(this.editor),{priority:"high"}),this.editor.editing.downcastDispatcher.on("removeMarker:revision",(t,te,be)=>{const xe=be.mapper.markerNameToElements(te.markerName);if(xe)for(const ve of xe)(ve.hasClass("ck-suggestion-marker-split")||ve.hasClass("ck-suggestion-marker-merge"))&&(be.mapper.unbindElementFromMarkerName(ve,te.markerName),be.writer.remove(ve))},{priority:"high"}),this.editor.editing.downcastDispatcher.on("addMarker:revision",(t,te,be)=>{const xe=te.markerName.split(":")[1],ve=this._getChangeFromId(xe);if(!ve)return null;const ke=ve.type=="add"?"split":"merge";if(be.consumable.test(te.markerRange,t.name))for(const Ie of te.markerRange.getItems()){if(!Ie.is("element","softBreak"))continue;const Ae=be.writer.createUIElement("span",{class:"ck-suggestion-marker-"+ke}),Se=be.mapper.toViewPosition(this.editor.model.createPositionBefore(Ie));ve.data.isSuggestion&&be.writer.addClass("ck-suggestion-marker-"+ke+"-new",Ae),this.activeChange==ve&&be.writer.addClass("ck-suggestion-marker--active",Ae),be.writer.insert(Se,Ae),be.mapper.bindElementToMarker(Ae,te.markerName)}},{priority:"high"}),this.editor.model.document.on("change",()=>{this.editor.editing.view.change(t=>{for(const te of this.editor.model.document.getRootNames()){const be=this.editor.model.document.getRoot(te),xe=this.editor.editing.view.document.getRoot(te);if(xe){const ve=be.getAttribute("revisionHistoryAttachChange");if(t.removeAttribute("data-change-id",xe),t.removeClass("ck-revision-history-root-add",xe),t.removeClass("ck-revision-history-root-remove",xe),t.removeClass("ck-revision-history-root--active",xe),ve){const ke=this._getChangeFromId(ve);if(!ke)return null;t.setAttribute("data-change-id",ve,xe),t.addClass("ck-revision-history-root-"+ke.type,xe),this.activeChange==ke&&t.addClass("ck-revision-history-root--active",xe)}}}})}),this.editor.conversion.for("upcast").dataToMarker({view:"comment",model:t=>"revision-comment:"+t,converterPriority:"highest"}),this.editor.conversion.for("upcast").dataToMarker({view:"suggestion",model:t=>"revision-suggestion:"+t,converterPriority:"highest"}),this.editor.conversion.for("dataDowncast").markerToData({model:"revision-suggestion",view:t=>({name:"suggestion:"+t,group:"revision-suggestion"}),converterPriority:"highest"}),this.editor.conversion.for("editingDowncast").markerToHighlight({model:"revision-suggestion",view:t=>{const te=t.markerName.split(":")[1];return te!="insertion"&&te!="deletion"?null:{classes:["ck-suggestion-preview-marker","ck-suggestion-preview-marker-"+te]}}}),this.editor.editing.downcastDispatcher.on("addMarker:revision-suggestion:deletion",et$1(this.editor,"merge"),{priority:"high"}),this.editor.editing.downcastDispatcher.on("addMarker:revision-suggestion:insertion",et$1(this.editor,"split"),{priority:"high"}),this.editor.editing.downcastDispatcher.on("removeMarker:revision-suggestion",(t,te,be)=>{const xe=be.mapper.markerNameToElements(te.markerName);if(xe)for(const ve of xe)ve.is("uiElement")&&(be.mapper.unbindElementFromMarkerName(ve,te.markerName),be.writer.remove(ve))},{priority:"high"})}_getChangeFromId(t){return this._changeIdToChange.get(t)}_getViewForChange(t){return this._changeView&&this._changeView.destroy(),this._changeView=new Z$1(this.editor.locale,t),this._changeView}_initInteractions(){this.editor.model.document.selection.observeMarkers("revision"),this.on("change:activeView",(t,te,be,xe)=>{xe&&this._balloon.remove(xe),be&&(this._balloon.add({view:be,stackId:"revisionHistoryLabel",position:{target:()=>{const ve=this.editor.editing,ke=this._getChangeFromId(be.changeId);let Ie;if(ke.data.isOnRoot){const Ae=ve.view.getDomRoot(ke.rootName);Ie=Array.from(Ae.getClientRects())}else{const Ae=this.editor.model.markers.get("revision:"+be.changeId);Ie=Array.from(ve.mapper.markerNameToElements(Ae.name)).map(Se=>ve.view.domConverter.mapViewToDom(Se)).map(Se=>Array.from(Se.getClientRects())).flat()}return this._activeViewTarget&&Ie.find(Ae=>Ae.top-3<=this._activeViewTarget.y&&Ae.bottom+3>=this._activeViewTarget.y&&Ae.left-3<=this._activeViewTarget.x&&Ae.right+3>=this._activeViewTarget.x)||Ie[0]}}}),this._balloon.showStack("revisionHistoryLabel"))}),this.on("change:activeChange",(t,te,be,xe)=>{this.activeView=be?this._getViewForChange(be):null,this.editor.model.change(()=>{const ve=this.editor.editing;xe&&(xe.data.isOnRoot?ve.view.change(ke=>{ke.removeClass("ck-revision-history-root--active",ve.view.document.getRoot(xe.rootName))}):ve.reconvertMarker("revision:"+xe.id)),be&&(be.data.isOnRoot?ve.view.change(ke=>{ke.addClass("ck-revision-history-root--active",ve.view.document.getRoot(be.rootName))}):ve.reconvertMarker("revision:"+be.id))})}),this.listenTo(this.editor.editing.view.document,"mouseover",(t,te)=>{if(this.activeChange)return;const be=this._findChangeIdFromDomTarget(te.target),xe=this._changeIdToChange.get(be);xe?(this._activeViewTarget={x:te.domEvent.x,y:te.domEvent.y},this.activeView=this._getViewForChange(xe)):(this._activeViewTarget=null,this.activeView=null)}),this.listenTo(this.editor.editing.view.document,"mousedown",(t,te)=>{const be=this._findChangeIdFromDomTarget(te.target),xe=this._changeIdToChange.get(be);xe?(this._activeViewTarget={x:te.domEvent.x,y:te.domEvent.y},xe===this.activeChange?this._balloon.updatePosition():this.activeChange=xe):(this._activeViewTarget=null,this.activeChange=null)})}_findChangeIdFromDomTarget(t){do{const te=t.getAttribute("data-change-id");if(te)return te;t=t.parent}while(t);return null}_cleanMarkers(){this.editor.model.change(t=>{for(const te of this.editor.model.markers)t.removeMarker(te)})}};function et$1(Te,we){return(t,te,be)=>{if(!be.consumable.test(te.markerRange,t.name))return;const xe=te.markerRange.getWalker(),ve=te.markerRange.start,ke=Te.model.schema;let Ie=null,Ae=null,Se=!1,Oe=!1;for(const Me of xe){const De=Me.item;Se=Se||ke.isContent(De);const Fe=be.mapper.toViewElement(De);if(Fe&&Fe.getCustomProperty("addHighlight"))return;Me.type=="elementEnd"&&ke.isBlock(De)&&!ke.isLimit(De)&&(De.nextSibling||ve.isAtEnd?Ie&&Ie.parent==De||(Ie=De,Ve(Me.previousPosition),Oe=!0):Ae=Ae||Me.previousPosition)}function Ve(Me){const De=be.mapper.toViewPosition(Me),Fe=be.writer.createUIElement("span",{class:"ck-suggestion-preview-marker-"+we});be.writer.insert(De,Fe),be.mapper.bindElementToMarker(Fe,te.markerName)}Se||Oe||!Ae||Ve(Ae)}}let bt$1=class extends Command{constructor(we){super(we);const t=we.plugins.get(d$3);this.affectsData=!1,this.listenTo(t,"change:isReady",()=>this.refresh()),this.listenTo(t,"change:isEnabled",()=>this.refresh())}execute(){const we=this.editor,t=we.plugins.get(d$3),te=t.isReady?t.diff.newRevisionId:null;we.config.get("revisionHistory").restoreRevisionCallback(te)}refresh(){const{isReady:we,isEnabled:t}=this.editor.plugins.get(d$3);this.isEnabled=we&&t}},yt$1=class extends Command{constructor(t,{direction:te}){super(t);Re(this,"_step");const be=t.plugins.get(d$3);this.affectsData=!1,this._step=te==="forward"?1:-1,this.listenTo(be,"change:isReady",()=>this.refresh()),this.listenTo(be,"change:isEnabled",()=>this.refresh()),this.listenTo(be,"change:activeChange",()=>this.refresh())}execute(){const t=this.editor,te=t.plugins.get(d$3),{isNavigationMode:be,currentChangeNumber:xe}=te;let ve;if(te.activeChange=be?te.diff.changes.get(xe+this._step):te.diff.changes.first,te.activeChange.data.isOnRoot)ve=t.editing.view.getDomRoot(te.activeChange.rootName);else{const ke=t.model.markers.get("revision:"+te.activeChange.id);ve=k$6(t.editing,ke)}scrollViewportToShowTarget({target:ve,viewportOffset:40})}refresh(){const{isNavigationMode:t,currentChangeNumber:te,numberOfChanges:be,isReady:xe,isEnabled:ve}=this.editor.plugins.get(d$3);this.isEnabled=!!(ve&&xe&&be)&&(!t||(this._step===1?te<be-1:te>0))}};class _i extends View{constructor(we){super(we);const t=this.bindTemplate,te=new ButtonView(we),be=new ButtonView(we);this.set("isNavigationMode",!1),this.set("isReady",!1),this.set("currentChangeNumber",0),this.set("numberOfChanges",0),this.set("isForwardNavigationEnabled",!1),this.set("isBackwardNavigationEnabled",!1),this.bind("_isStatusLabelVisible").to(this,"isReady",this,"numberOfChanges",(xe,ve)=>xe&&ve>0),this.bind("_statusText").to(this,"isReady",this,"currentChangeNumber",this,"numberOfChanges",this,"isNavigationMode",(xe,ve,ke,Ie)=>{if(!xe)return y(we,"Loading...");if(!ke)return y(we,"No changes");const Ae=y(we,"NUMBER_OF_CHANGES",ke);return Ie?y(we,"X_OF_Y_CHANGES",[ve+1,ke]):Ae}),te.set({label:y(we,"Show previous change"),tooltip:!0,icon:`<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M16.435 14.494a.75.75 0 0 0 1.197-.899l-.067-.089-6.992-8a.75.75 0 0 0-1.05-.078l-.079.078-7.008 8a.75.75 0 0 0 1.049 1.066l.08-.078 6.442-7.354 6.428 7.354z"/></svg>
`}),be.set({label:y(we,"Show next change"),tooltip:!0,icon:`<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M16.435 5.506a.75.75 0 0 1 1.197.899l-.067.089-6.992 8a.75.75 0 0 1-1.05.078l-.079-.078-7.008-8a.75.75 0 0 1 1.049-1.066l.08.078 6.442 7.354 6.428-7.354z"/></svg>
`}),te.bind("isEnabled").to(this,"isBackwardNavigationEnabled"),be.bind("isEnabled").to(this,"isForwardNavigationEnabled"),te.on("execute",()=>this.fire("execute","backward")),be.on("execute",()=>this.fire("execute","forward")),this.setTemplate({tag:"div",attributes:{class:["ck","ck-revision-history-ui","ck-revision-history-ui__changes-navigation"]},children:[{tag:"span",attributes:{class:["ck-revision-history-ui__changes-navigation__wrapper"]},children:[{tag:"span",attributes:{class:["ck-revision-history-ui__changes-navigation__label",t.if("_isStatusLabelVisible","ck-hidden",xe=>!xe)]},children:[{text:t.to("isNavigationMode",xe=>xe?y(we,"EDIT_X_OF_Y_REVISIONS")+": ":y(we,"Total")+": ")}]},{text:t.to("_statusText")}]},new ToolbarSeparatorView,{tag:"div",attributes:{class:["ck-revision-history-ui__changes-navigation__navigation"]},children:[te,be]}]})}}const ce="ck-editor__editable__loading-overlay";let de$1=class extends Plugin{static get pluginName(){return"RevisionViewerLoadingOverlay"}show(){const we=this.editor.editing.view;we.change(t=>{for(const te of we.document.roots)t.addClass(ce,te)})}hide(){const we=this.editor.editing.view;we.change(t=>{for(const te of we.document.roots)t.removeClass(ce,te)})}},R$1=class extends Plugin{static get pluginName(){return"RevisionViewerUI"}static get requires(){return[d$3,de$1]}init(){const we=this.editor,t=we.plugins.get(d$3),te=we.plugins.get(de$1);we.ui.componentFactory.add("exitToEditing",be=>{const xe=new ButtonView(be);return xe.set({label:y(be,"Back to editing"),icon:icons.undo,withText:!0,tooltip:!0,class:"ck-revision-history-ui__back-to-editing"}),this.listenTo(xe,"execute",()=>{we.config.get("revisionHistory").closeRevisionViewerCallback()}),xe}),we.ui.componentFactory.add("restoreRevision",be=>{const xe=new ButtonView(be);return xe.set({label:y(be,"Restore this revision"),withText:!0,tooltip:!0}),xe.bind("isEnabled").to(we.commands.get("restoreRevision")),this.listenTo(xe,"execute",()=>we.execute("restoreRevision")),xe}),we.ui.componentFactory.add("changesNavigation",be=>{const xe=new _i(be),ve=we.commands.get("showPreviousChange"),ke=we.commands.get("showNextChange");return xe.bind("isBackwardNavigationEnabled").to(ve,"isEnabled"),xe.bind("isForwardNavigationEnabled").to(ke,"isEnabled"),xe.bind("isReady","currentChangeNumber","numberOfChanges","isNavigationMode").to(t),this.listenTo(xe,"execute",(Ie,Ae)=>{we.execute(Ae==="forward"?"showNextChange":"showPreviousChange")}),xe}),te.show(),t.on("change:isReady",(be,xe,ve)=>{ve?te.hide():te.show()})}},kt$1=class extends LabeledFieldView{constructor(t,te){super(t,te);Re(this,"_resizeObserver",null);const be=this.bindTemplate;this.set({label:y(t,"Revision name"),_tooltipString:""}),this.fieldView.placeholder=y(t,"Enter the revision name"),this.extendTemplate({tag:"span",attributes:{class:["ck-revision-history-sidebar__revision-name"],"data-cke-tooltip-text":be.to("_tooltipString"),"data-cke-tooltip-position":"s","data-cke-tooltip-class":"ck-tooltip_multi-line"}})}render(){super.render(),this._resizeObserver=new ResizeObserver(this.fieldView.element,()=>this._updateTooltipText()),this.listenTo(this.fieldView,"input",()=>this._updateTooltipText())}destroy(){super.destroy(),this._resizeObserver&&this._resizeObserver.destroy()}_updateTooltipText(){const t=this.fieldView.element;this._tooltipString=t.scrollWidth>t.clientWidth&&t.value||""}},ti$1=class extends View{constructor(we,t,te){super(we);const be=new IconView;be.set({content:`<svg viewBox="0 0 11 10" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M5.5 5C8.538 5 11 7.015 11 9.5c0 .17-.011.336-.034.5H.034A3.732 3.732 0 0 1 0 9.5C0 7.015 2.462 5 5.5 5zm0-5a2.5 2.5 0 1 1 0 5 2.5 2.5 0 0 1 0-5z" /></svg>
`,viewBox:"0 0 11 10"});const xe=["ck","ck-revision-history-sidebar__revision-author"];te&&xe.push("ck-revision-history-sidebar__revision-author_creator");const ve=[{tag:"span",attributes:{class:["ck","ck-revision-history-sidebar__revision-author__name"],title:y(we,te?"Revision creator":"Revision author")},children:[be,t.name]}];this.setTemplate({tag:"li",attributes:{class:xe},children:ve})}};function ni(Te,we){const t=Te.bindTemplate,te=Te.locale,be=createDropdown(te);be.panelPosition="sw";const xe=function(ve,ke){const Ie=function(Se,Oe){const Ve=Se.locale,Me={"Compare against selected":y(Ve,"Compare against selected"),"Name this revision":y(Ve,"Name this revision"),"Restore this revision":y(Ve,"Restore this revision")};return Oe.map(De=>{const Fe=Me[De.name];return Fe&&Fe!==De.name&&(De.name=Fe),De})}(ve,ke),Ae=new Collection;for(const Se of Ie){const Oe={type:"button",model:new Model({label:Se.name,class:Se.class,withText:!0,role:"menuitem",_action:Se.action})};Oe.model.bind("isEnabled").to(ve,"isActionsDropdownOpen",Ve=>typeof Se.isEnabled!="function"||!Ve||Se.isEnabled(ve)),Ae.add(Oe)}return Ae}(Te,we);return Te.bind("isActionsDropdownOpen").to(be,"isOpen"),be.buttonView.set({label:y(te,"Show more items"),tooltip:!0,tooltipPosition:"sw",icon:icons.threeVerticalDots}),be.extendTemplate({attributes:{class:["ck-revision-history-sidebar__revision__actions",t.if("isActionsDropdownOpen","ck-on")]},on:{click:t.to(ve=>ve.stopPropagation())}}),be.on("execute",ve=>{Te.isReady&&typeof ve.source._action=="function"&&ve.source._action(Te)}),addListToDropdown(be,xe,{role:"menu"}),be.listenTo(Te,"change:isActionsDropdownOpen",(ve,ke,Ie)=>{if(Ie)for(const Ae of be.listView.items){const Se=Ae.children.first,Oe=we.find(Ve=>Ve.action===Se._action).isVisible;Ae.isVisible=Oe===void 0||Oe(Te)}}),be}class ai extends m$a(View){constructor(t,te,be,xe){super(t);Re(this,"id");Re(this,"revisionNameView");Re(this,"revisionActionsView");Re(this,"_revision");Re(this,"_requireRevisionName");const ve=this.bindTemplate,ke=function(Ie,Ae){const Se=Array.from(Ae.authors).filter(Oe=>Oe!=Ae.creator);return Ae.creator&&Se.unshift(Ae.creator),Se.map(Oe=>new ti$1(Ie,Oe,Oe==Ae.creator))}(t,te);this.id=te.id,this._revision=te,this._requireRevisionName=xe,this.bind("name","createdAt").to(te),this.bind("_createdAtFormatted").to(this,"createdAt",Ie=>{return Ae=t.uiLanguage,(Se=Ie).toLocaleDateString(Ae,{month:"long",day:"numeric"})+", "+Se.toLocaleTimeString(Ae,{hour:"numeric",minute:"numeric"});var Ae,Se}),this.set("isSelected",!1),this.set("isHighlighted",!1),this.set("isActionsDropdownOpen",!1),this.set("isReady",!1),this.set("isEnabled",!1),this.revisionNameView=new kt$1(t,createLabeledInputText),this.revisionNameView.fieldView.extendTemplate({attributes:{maxlength:"220"}}),this.revisionNameView.fieldView.bind("value").to(this,"name",Ie=>Ie||this._createdAtFormatted),this.revisionNameView.bind("isEnabled").to(this,"isSelected",this,"isEnabled",(Ie,Ae)=>Ie&&Ae),this.revisionActionsView=be&&be.length?ni(this,be):"",this.revisionActionsView&&this.revisionActionsView.bind("isEnabled").to(this),this.setTemplate({tag:"div",attributes:{class:["ck","ck-reset","ck-revision-history-sidebar__revision-wrapper",ve.if("isConfirm","ck-revision-history-sidebar__revision-wrapper_confirmation_visible")]},children:[{tag:"div",attributes:{class:["ck","ck-reset","ck-revision-history-sidebar__revision",ve.if("isEnabled","ck-disabled",Ie=>!Ie),ve.if("isSelected","ck-revision-history-sidebar__revision_selected"),ve.if("isHighlighted","ck-revision-history-sidebar__revision_highlighted"),ve.if("isActionsDropdownOpen","ck-revision-history-sidebar__actions_dropdown_open")]},children:[this.revisionNameView,{tag:"span",attributes:{class:["ck","ck-revision-history-sidebar__revision__date"]},children:[{text:ve.to("_createdAtFormatted")}]},{tag:"div",attributes:{class:["ck","ck-revision-history-sidebar__revision__controls-wrapper"]},children:[{tag:"ul",attributes:{class:["ck","ck-revision-history-sidebar__revision-authors"]},children:ke}]},this.revisionActionsView],on:{click:ve.to(Ie=>{Ie.srcElement.closest(".ck-thread__remove-confirm")||this.isReady&&this.isEnabled&&this.fire("select",{id:this.id})})}}]})}render(){super.render();const t=this.revisionNameView.fieldView.element;this.listenTo(t,"change",()=>{this._requireRevisionName&&!t.value||this.fire("setName",{id:this.id,name:t.value}),t.value||(t.value=this.name?this.name:this._createdAtFormatted)})}select(){this.isSelected=!0}deselect(){this.isSelected=!1}highlight(){this.isHighlighted=!0}unhighlight(){this.isHighlighted=!1}}function di(Te,we){const t=DateTime.fromJSDate(Te).setLocale(we),te=DateTime.local(),be=te.minus({days:1}).startOf("day");let xe,ve;return t.hasSame(te,"day")?(xe=t.startOf("day").toJSDate(),ve=t.toRelativeCalendar()):t.hasSame(be,"day")?(xe=be.toJSDate(),ve=t.toRelativeCalendar()):t.hasSame(te,"week")?(xe=t.startOf("week").toJSDate(),ve=t.weekdayLong||""):t.hasSame(te,"year")?(xe=t.startOf("month").toJSDate(),ve=t.monthLong||""):(xe=t.startOf("year").toJSDate(),ve=String(t.year)),{startDate:xe,localizedPeriodName:ve}}class mi extends View{constructor(t,te,be,xe){super(t);Re(this,"startDate");Re(this,"revisionViews");Re(this,"_revisionActions");Re(this,"_requireRevisionName");const ve=di(te,this.locale.uiLanguage).localizedPeriodName;this.startDate=te,this.revisionViews=this.createCollection(),this._revisionActions=be,this._requireRevisionName=xe,this.revisionViews.delegate("select").to(this),this.revisionViews.delegate("setName").to(this),this.setTemplate({tag:"div",attributes:{class:["ck","ck-revision-history-sidebar__time-period"]},children:[{tag:"span",attributes:{class:["ck","ck-revision-history-sidebar__time-period__label"]},children:[{text:ve}]},{tag:"div",attributes:{class:["ck","ck-revision-history-sidebar__time-period__revisions"]},children:this.revisionViews}]})}addRevision(t){const te=new ai(this.locale,t,this._revisionActions,this._requireRevisionName);this.revisionViews.add(te)}removeRevision(t){const te=this.revisionViews.find(be=>be.id===t.id);this.revisionViews.remove(te)}}class as extends View{constructor(we){super(we);const t=new IconView;t.content=icons.history,this.setTemplate({tag:"div",attributes:{class:["ck","ck-reset_all","ck-revision-history-sidebar__header"]},children:[t,{tag:"span",attributes:{class:["ck","ck-revision-history-sidebar__header__label"]},children:[y(we,"Revision history")]}]})}}class ci extends View{constructor(t,te,be,xe){super(t);Re(this,"timePeriodViews");Re(this,"_revisions");Re(this,"_revisionActions");Re(this,"_requireRevisionName");const ve=this.bindTemplate;this.timePeriodViews=this.createCollection(),this.timePeriodViews.delegate("select").to(this),this.timePeriodViews.delegate("setName").to(this),this._revisions=te,this._revisionActions=be,this._requireRevisionName=xe,this.on("select",(ke,Ie)=>{this.fire("revisionSelected",Ie)}),this.on("setName",(ke,Ie)=>{this.fire("revisionSetName",Ie)}),this.set("isEnabled",!1),this.setTemplate({tag:"div",attributes:{class:["ck","ck-reset","ck-rounded-corners","ck-revision-history-sidebar"]},children:[new as(t),{tag:"div",attributes:{class:["ck","ck-revision-history-sidebar__timeline",ve.if("isEnabled","ck-disabled",ke=>!ke)]},children:this.timePeriodViews}]})}render(){super.render();for(const t of this._revisions)this._addRevision(t);this._revisions.on("add",(t,te)=>{this._addRevision(te)}),this._revisions.on("remove",(t,te)=>{this._removeRevision(te)})}get revisionViews(){return this.timePeriodViews.map(t=>t.revisionViews.map(te=>te)).flat()}selectRevision(t){for(const te of this.revisionViews)t&&t.id===te.id?te.select():te.deselect()}highlightRevisions(t){for(const te of this.revisionViews)t.some(({id:be})=>be===te.id)?te.highlight():te.unhighlight()}_addRevision(t){const te=di(t.createdAt,this.locale.uiLanguage).startDate;let be=this.timePeriodViews.get(0);be&&be.startDate.getTime()===te.getTime()||(be=new mi(this.locale,te,this._revisionActions,this._requireRevisionName),this.timePeriodViews.add(be)),be.addRevision(t)}_removeRevision(t){const te=di(t.createdAt,this.locale.uiLanguage).startDate;this._getTimePeriodViewByStartDate(te).removeRevision(t)}_getTimePeriodViewByStartDate(t){return this.timePeriodViews.find(te=>te.startDate.getTime()===t.getTime())}}const Li=class Li extends Plugin{constructor(t){super(t);Re(this,"_revisionViewer");Re(this,"_revisionsRepository");Re(this,"_sidebarView");this._revisionViewer=t.plugins.get(d$3),this._revisionsRepository=this._revisionViewer.repository,this._sidebarView=null}static get pluginName(){return"RevisionsSidebar"}static get requires(){return[d$3]}init(){const t=this._revisionsRepository._revisions,te=this._createRevisionActions(),be=this.editor.config.get("revisionHistory.viewerSidebarContainer");this._sidebarView=new ci(this.editor.locale,t,te,this.editor.config.get("revisionHistory.requireRevisionName")),this._sidebarView.on("revisionSelected",this._handleRevisionSelected.bind(this)),this._sidebarView.on("revisionSetName",this._handleRevisionSetName.bind(this)),this._sidebarView.bind("isEnabled").to(this._revisionViewer),this._sidebarView.timePeriodViews.on("add",(xe,ve)=>{ve.revisionViews.on("add",(ke,Ie)=>{Ie.bind("isEnabled","isReady").to(this._revisionViewer)})}),this._sidebarView.render(),this.listenTo(this.editor.data,"ready",this._handleEditorDataReady.bind(this)),this.listenTo(this._revisionViewer,"change:diff",this._handleDiffChange.bind(this)),be.appendChild(this._sidebarView.element)}destroy(){this._sidebarView.element.remove(),this._sidebarView.destroy()}_handleEditorDataReady(){const t=this._revisionsRepository.getRevision(0);if(t){const te=this._revisionsRepository.getEarlierVisibleRevision(t.id);this._revisionViewer.compare(t,te)}}_handleRevisionSelected(t,te){const be=this._revisionsRepository.getRevision(te.id),xe=this._revisionsRepository.getEarlierVisibleRevision(be.id);this._revisionViewer.compare(be,xe)}_handleRevisionSetName(t,te){this._revisionsRepository.getRevision(te.id).setName(te.name)}_handleDiffChange(t,te,be){const xe=this._revisionsRepository.getRevisionsInDiff(be);xe.length>2?(this._sidebarView.highlightRevisions(xe),this._sidebarView.selectRevision(null)):(this._sidebarView.highlightRevisions([]),this._sidebarView.selectRevision(xe[0]))}_createRevisionActions(){const t=this.editor,te=Li.availableRevisionActions,be=t.config.get("revisionHistory.revisionActions")||Li.defaultRevisionActions;if(be.length)return be.map(xe=>{const ve=typeof xe=="string"?Object.assign({},te[xe]):xe;return ve.action=ve.action.bind(this,t),ve.isVisible&&(ve.isVisible=ve.isVisible.bind(this,t)),ve})}};Re(Li,"defaultRevisionActions",["compareAgainstSelected","restoreRevision","nameRevision"]),Re(Li,"availableRevisionActions",Rt$1());let w=Li;function Rt$1(){return{compareAgainstSelected:{name:"Compare against selected",action:({plugins:Te},we)=>{const t=Te.get(d$3),te=t.repository;let be=t.diff.newRevisionId,xe=we.id;te.getIndex(be)>te.getIndex(xe)&&([be,xe]=[xe,be]),t.compare(be,xe)},isVisible:({plugins:Te},we)=>{const t=Te.get(d$3);return!(t.repository.getRevisionsInDiff(t.diff).length>2)&&!we.isSelected}},restoreRevision:{name:"Restore this revision",action:(Te,{id:we})=>{Te.config.get("revisionHistory").restoreRevisionCallback(we)},isVisible:({plugins:Te},we)=>!!Te.get(d$3).repository.getLaterVisibleRevision(we.id)},nameRevision:{name:"Name this revision",action:({plugins:Te},{id:we,revisionNameView:t})=>{const te=Te.get(d$3),be=te.repository.getEarlierVisibleRevision(we);te.compare(we,be),t.focus(),t.fieldView.select()}}}}let st$1=class extends EditorUI{constructor(t,te){super(t);Re(this,"_view");Re(this,"_toolbarConfig");Re(this,"_elementReplacer");this._view=te,this._toolbarConfig=normalizeToolbarConfig(t.config.get("toolbar")),this._elementReplacer=new ElementReplacer}get view(){return this._view}get element(){return this.view.element}init(t){const te=this.editor,be=this.view,xe=te.editing.view,ve=be.editable,ke=xe.document.getRoot();ve.name=ke.rootName,be.render();const Ie=ve.element;this.setEditableElement(ve.name,Ie),be.editable.bind("isFocused").to(this.focusTracker),xe.attachDomRoot(Ie),this._elementReplacer.replace(t,this.element),this._initToolbar(),this.fire("ready")}destroy(){super.destroy();const t=this.view,te=this.editor.editing.view;this._elementReplacer.restore(),te.detachDomRoot(t.editable.name),t.destroy()}_initToolbar(){const t=this.view;t.stickyPanel.bind("isActive").to(this.focusTracker,"isFocused"),t.stickyPanel.limiterElement=t.element,t.stickyPanel.bind("viewportTopOffset").to(this,"viewportOffset",({top:te})=>te),t.toolbar.fillFromConfig(this._toolbarConfig,this.componentFactory),this.addToolbar(t.toolbar)}},ot$1=class extends BoxedEditorUIView{constructor(t,te,be={}){super(t);Re(this,"_editable");Re(this,"stickyPanel");Re(this,"toolbar");this.stickyPanel=new StickyPanelView(t),this.toolbar=new ToolbarView(t,{shouldGroupWhenFull:be.shouldToolbarGroupWhenFull}),this._editable=new InlineEditableUIView(t,te)}get editable(){return this._editable}render(){super.render(),this.stickyPanel.content.add(this.toolbar),this.top.add(this.stickyPanel),this.main.add(this.editable)}},m$3=class extends ElementApiMixin(Editor){constructor(t,te){super(te);Re(this,"_ui");this.sourceElement=t,this.model.document.createRoot();const be=new ot$1(this.locale,this.editing.view,{shouldToolbarGroupWhenFull:!0});this._ui=new st$1(this,be)}get ui(){return this._ui}destroy(){return this.updateSourceElement(),this.ui.destroy(),super.destroy()}static async create(t,te){const be=new this(t,te);return await be.initPlugins(),await be.ui.init(t),await be.data.init(be.config.get("initialData")||""),be.fire("ready"),be}};const p$1=["RevisionHistoryUI","RestrictedEditingMode"];let k$1=class extends Plugin{constructor(t){super(t);Re(this,"result");this.result="end"}static get pluginName(){return"RevisionViewerIntegration"}},H$1=class extends Plugin{constructor(t){super(t);Re(this,"_viewerEditor");if(!this.editor.config.get("revisionHistory"))throw new CKEditorError("revision-history-missing-configuration",this);this._viewerEditor=null,this.editor.config.define("revisionHistory.showRevisionViewerCallback",te=>this._showRevisionViewer({...te,translations:this.editor.locale.translations})),this.editor.config.define("revisionHistory.closeRevisionViewerCallback",te=>this._closeRevisionViewer(te)),this.editor.config.define("revisionHistory.restoreRevisionCallback",te=>this._restoreRevision(te)),this.editor.config.define("revisionHistory.requireRevisionName",!1),this._enhanceShowRevisionViewerCallback(),this._enhanceCloseRevisionViewerCallback()}static get pluginName(){return"RevisionHistory"}static get requires(){return[l,u$1]}set adapter(t){this.editor.plugins.get("RevisionTracker").adapter=t}get adapter(){return this.editor.plugins.get("RevisionTracker").adapter}addRevisionData(t){return this.editor.plugins.get("RevisionTracker").addRevisionData(t)}getRevision(t){return this.editor.plugins.get("RevisionsRepository").getRevision(t)}getRevisions(t){return this.editor.plugins.get("RevisionsRepository").getRevisions(t||{toJSON:!1})}_getRevisionViewerEditorConfig(){const t=this.editor,te=D$2(t,p$1),be=t.plugins.get("RevisionTracker"),xe=t.plugins.get("Users").users;return te.toolbar=["exitToEditing","restoreRevision","changesNavigation"],delete te.lazyRoots,te.plugins.push(k$1,d$3,R$1,class extends Plugin{static get requires(){return[d$3,"Users"]}init(){const ve=this.editor.plugins.get("Users");for(const Se of xe)Se.isAnonymous||ve.getUser(Se.id)||ve.addUser(Se);const ke=be.repository.getRevisions();let Ie=null;const Ae=this.editor.plugins.get("RevisionViewer");Ae.adapter=be.adapter,Ae.bind("isEnabled").to(be),this.editor.commands.get("restoreRevision").bind("isEnabled").to(t,"isReadOnly",Se=>!Se);for(const Se of ke){const Oe=Se.creator===null;if(Oe&&Se.toVersion===Se.fromVersion)continue;const Ve=Se.toJSON();Ae.addRevisionData(Ve,(Me,De,Fe)=>{if(Oe){if(Ie)Ie._update(Me,De);else if(!De){const Be=Fe.toJSON();Be.id=uid(),be.saveRevision(Be,Fe.toVersion).then($e=>{Ie=$e})}}else Se._update(Me,De)})}}},w),te}_enhanceShowRevisionViewerCallback(){const t=this.editor.config.get("revisionHistory").showRevisionViewerCallback;this.editor.config.set("revisionHistory.showRevisionViewerCallback",async()=>{this.editor.enableReadOnlyMode("revision-history-viewer-opened");const te=this.editor.plugins.get("RevisionTracker");if(this.editor.plugins.has("Autosave")?await this.editor.plugins.get("Autosave").save():await te.update(),this.editor.plugins.has("PaginationLookup")&&this.editor.plugins.get("PaginationLookup")._recalculatePageBreaks(),this.editor.plugins.has("Dialog")){const xe=this.editor.plugins.get("Dialog");xe.isOpen&&xe.hide()}const be=this._getRevisionViewerEditorConfig();return t(be).then(xe=>(this._viewerEditor=xe,this.editor.plugins.has("Annotations")&&this.editor.plugins.get("Annotations").refreshVisibility(),xe)).catch(xe=>(console.error(xe),this.editor.disableReadOnlyMode("revision-history-viewer-opened"),null))})}_enhanceCloseRevisionViewerCallback(){const t=this.editor.config.get("revisionHistory").closeRevisionViewerCallback;this.editor.config.set("revisionHistory.closeRevisionViewerCallback",()=>(this.editor.plugins.has("PaginationLookup")&&this.editor.plugins.get("PaginationLookup")._recalculatePageBreaks(),this._viewerEditor.plugins.get("RevisionViewer")._cleanUp(),t(this._viewerEditor).then(()=>{if(this.editor.disableReadOnlyMode("revision-history-viewer-opened"),this._viewerEditor=null,this.editor.plugins.has("Annotations")){const te=this.editor.plugins.get("Annotations");te.refreshVisibility(),te.refreshPositioning()}})))}_showRevisionViewer(t){const te=this.editor.config.get("revisionHistory.editorContainer"),be=this.editor.config.get("revisionHistory.viewerContainer"),xe=this.editor.config.get("revisionHistory.viewerEditorElement");return m$3.create(xe,t).then(ve=>(be.style.display="block",te.style.display="none",ve))}_closeRevisionViewer(t){const te=this.editor.config.get("revisionHistory.editorContainer");return this.editor.config.get("revisionHistory.viewerContainer").style.display="none",te.style.display="",t.destroy()}async _restoreRevision(t){const te=this.editor,be=this._viewerEditor.plugins.get("RevisionViewer"),xe=te.plugins.get("RevisionTracker"),ve=be.repository.getRevision(t);let ke,Ie,Ae;try{ke=await be.getRevisionData(ve),Ie=await be.getRevisionRootsAttributes(ve)}catch(Oe){return void console.error(Oe)}te.model.change(Oe=>{for(const Ve of Array.from(te.model.markers.getMarkersGroup("restrictedEditingException")))Oe.removeMarker(Ve)}),be.isReady=!1,te.model.enqueueChange(Oe=>{Oe.setSelection(null),Oe.removeSelectionAttribute(te.model.document.selection.getAttributeKeys());const Ve=Object.keys(ke);for(const Me of te.model.document.roots)Me.rootName!="$graveyard"&&Me.isAttached()&&!Ve.includes(Me.rootName)&&Oe.detachRoot(Me);for(const Me of Ve){let De=te.model.document.getRoot(Me);De&&De.isAttached()||(De=Oe.addRoot(Me));const Fe=Ie[Me],Be=Object.keys(Fe),$e=ke[Me];for(const Ue of De.getAttributeKeys())Be.includes(Ue)||Oe.removeAttribute(Ue,De);for(const Ue of Be)Oe.setAttribute(Ue,Ie[Me][Ue],De);Oe.remove(Oe.createRangeIn(De)),Oe.insert(te.data.parse($e,De),De,0)}});const Se=y(te.locale,"Restored");return ve.name?Ae=ve.name.indexOf(Se)==-1?Se+": "+ve.name:ve.name:Ae=Se+": "+(ve.createdAt.toLocaleDateString(te.locale.uiLanguage,{month:"long",day:"numeric"})+", "+ve.createdAt.toLocaleTimeString(te.locale.uiLanguage,{hour:"numeric",minute:"numeric"})),await xe.saveRevision({name:Ae}),be.isReady=!0,te.config.get("revisionHistory").closeRevisionViewerCallback()}},o$1=class extends Plugin{static get pluginName(){return"SlashCommandConfig"}constructor(we){super(we),this._allowedCommands=null}afterInit(){const we=this.editor.config.get("slashCommand.removeCommands")||[],t=function(Ae){let Se=["heading4","heading5","heading6"];if(Ae){const Oe=Ae.map(Ve=>Ve.model);Se=["heading1","heading2","heading3","heading4","heading5","heading6"].filter(Ve=>!Oe.includes(Ve))}return Se}(this.editor.config.get("heading.options"));let te=this.getDefaultCommands().filter(Ae=>!t.includes(Ae.id)).filter(Ae=>!we.includes(Ae.commandName));const be=this.editor.config.get("slashCommand.extraCommands");be&&be.length&&(te=te.concat(be));const xe=this.editor.config.get("template.definitions");xe&&xe.length&&(te=te.concat(function(Ae){return Ae.map(Se=>{const{title:Oe,icon:Ve,description:Me,data:De}=Se,Fe={id:c$1(Oe,"template"),commandName:"insertTemplate",execute:Be=>{Be.execute("insertTemplate",De)},description:Me,icon:Ve,title:Oe};return Ve&&(Fe.isIconColorInherited=!1),Fe})}(xe)));const ve=this.editor.config.get("style.definitions");ve&&ve.length&&(te=te.concat(function(Ae){return Ae.map(Se=>({id:c$1(Se.name,"style"),commandName:"style",execute:Oe=>{Oe.execute("style",{styleName:Se.name})},isEnabled:Oe=>{const Ve=Oe.commands.get("style");return Ve.isEnabled&&Ve.enabledStyles.includes(Se.name)},title:Se.name}))}(ve)));const ke=te.filter(Ae=>!Ae.commandName||this.editor.commands.get(Ae.commandName)!==void 0),Ie=[];for(const Ae of ke)Ie.push({id:Ae.id,commandName:Ae.commandName,title:typeof Ae.title=="function"?Ae.title(this.editor):Ae.title,description:Ae.description,icon:Ae.icon,isIconColorInherited:Ae.isIconColorInherited,aliases:Ae.aliases,isEnabled:()=>this._proxyIsEnabled(Ae),execute:()=>this._proxyExecute(Ae)});this._allowedCommands=Ie.sort(d$2)}getAllowedCommands(){return this._allowedCommands}getDefaultCommands(){const we=this.editor.t,t=this.editor.locale.t;return[{id:"aiAssistant",commandName:"showAIAssistant",icon:a$9.robotPencil,title:t("AI Assistant"),description:we("Open the AI Assistant to generate content"),execute:te=>{setTimeout(()=>te.execute("showAIAssistant"))}},{id:"blockQuote",commandName:"blockQuote",icon:icons.quote,title:t("Block quote"),description:we("Create a block quote")},{id:"bulletedList",commandName:"bulletedList",icon:icons.bulletedList,title:t("Bulleted list"),description:we("Create a bulleted list")},{id:"codeBlock",commandName:"codeBlock",icon:icons.codeBlock,title:t("Insert code block"),description:we("Create a code block")},{id:"ckbox",commandName:"ckbox",icon:icons.browseFiles,title:t("Open file manager"),description:we("Open file manager to insert an image or a file"),aliases:["ckfinder","filemanager","upload"]},{id:"ckfinder",commandName:"ckfinder",icon:icons.browseFiles,title:t("Insert image"),description:we("Open file browser to insert an image or a file"),aliases:["ckbox","filemanager","upload"]},{id:"heading1",commandName:"heading",icon:icons.heading1,title:t("Heading 1"),description:we("Create a heading level 1"),execute:te=>{te.execute("heading",{value:"heading1"})}},{id:"heading2",commandName:"heading",icon:icons.heading2,title:t("Heading 2"),description:we("Create a heading level 2"),execute:te=>{te.execute("heading",{value:"heading2"})}},{id:"heading3",commandName:"heading",icon:icons.heading3,title:t("Heading 3"),description:we("Create a heading level 3"),execute:te=>{te.execute("heading",{value:"heading3"})}},{id:"heading4",commandName:"heading",icon:icons.heading4,title:t("Heading 4"),description:we("Create a heading level 4"),execute:te=>{te.execute("heading",{value:"heading4"})}},{id:"heading5",commandName:"heading",icon:icons.heading5,title:t("Heading 5"),description:we("Create a heading level 5"),execute:te=>{te.execute("heading",{value:"heading5"})}},{id:"heading6",commandName:"heading",icon:icons.heading6,title:t("Heading 6"),description:we("Create a heading level 6"),execute:te=>{te.execute("heading",{value:"heading6"})}},{id:"horizontalLine",commandName:"horizontalLine",icon:icons.horizontalLine,title:t("Horizontal line"),description:we("Insert a horizontal line")},{id:"htmlEmbed",commandName:"htmlEmbed",icon:icons.html,title:t("Insert HTML"),description:we("Insert an HTML snippet")},{id:"indent",commandName:"indent",icon:icons.indent,title:t("Increase indent"),description:we("Increase the indentation")},{id:"insertMermaidCommand",commandName:"insertMermaidCommand",title:we("Insert Mermaid diagram"),description:we("Insert the Mermaid diagram")},{id:"insertTable",commandName:"insertTable",icon:icons.table,title:t("Insert table"),description:we("Create a table")},{id:"insertTableOfContents",commandName:"insertTableOfContents",icon:a$9.tableOfContents,title:t("Table of contents"),description:we("Insert table of contents"),aliases:["toc"]},{id:"numberedList",commandName:"numberedList",icon:icons.numberedList,title:t("Numbered list"),description:we("Create a numbered list")},{id:"outdent",commandName:"outdent",icon:icons.outdent,title:t("Decrease indent"),description:we("Decrease the indentation")},{id:"paragraph",commandName:"paragraph",icon:icons.paragraph,title:t("Paragraph"),description:we("Insert a paragraph")},{id:"todoList",commandName:"todoList",icon:icons.todoList,title:t("To-do list"),description:we("Create a to-do list")}]}_proxyIsEnabled(we){return we.isEnabled?we.isEnabled(this.editor):!we.commandName||this.editor.commands.get(we.commandName).isEnabled}_proxyExecute(we){if(we.execute)we.execute(this.editor);else{if(!we.commandName)throw new CKEditorError("slash-command-execute-missing",this.editor,{commandDefinition:we});this.editor.execute(we.commandName)}}};function d$2(Te,we){return Te.title<we.title?-1:Te.title>we.title?1:0}function c$1(Te,we){return we+"-"+Te.toLowerCase().split(" ").join("-")}class e extends Plugin{constructor(t){super(t);Re(this,"_licenseKeyCheckInterval");this._licenseKeyCheckInterval=null}static get pluginName(){return"SlashCommandEditing"}static get requires(){return[o$1]}init(){const t=this.editor;this.licenseKey=t.config.get("licenseKey");const te=this.editor;this._licenseKeyCheckInterval=setInterval(()=>{let be;for(const xe in te){const ve=xe,ke=te[ve];if(ke==="slashCommandLicenseKeyTrial"||ke==="slashCommandLicenseKeyInvalid"||ke==="slashCommandLicenseKeyValid"||ke==="slashCommandLicenseKeyTrialLimit:operations"){delete te[ve],be=ke;break}}if(be==="slashCommandLicenseKeyInvalid")throw clearInterval(this._licenseKeyCheckInterval),new CKEditorError("slash-command-invalid-license-key",null);if(be==="slashCommandLicenseKeyTrial"&&console.info("You are using the trial version of CKEditor 5 slash command plugin with limited usage. Make sure you will not use it in the production environment."),be==="slashCommandLicenseKeyTrialLimit:operations")throw clearInterval(this._licenseKeyCheckInterval),new CKEditorError("slash-command-trial-license-key-reached-limit-changes",null);be==="slashCommandLicenseKeyValid"&&clearInterval(this._licenseKeyCheckInterval)},1e3)}destroy(){this._licenseKeyCheckInterval&&clearInterval(this._licenseKeyCheckInterval)}getMatchingCommands(t){const te=t&&t.toLowerCase();let be=this.editor.plugins.get("SlashCommandConfig").getAllowedCommands();if(be=be.filter(xe=>xe.isEnabled()),te){const xe=[],ve=[],ke=[],Ie=[];for(const Ae of be)Ae.id.toLowerCase().includes(te)?xe.push(Ae):Ae.title.toLowerCase().includes(te)?ve.push(Ae):Ae.aliases&&Ae.aliases.some(Se=>Se.toLowerCase().includes(te))?ke.push(Ae):Ae.description&&Ae.description.toLowerCase().includes(te)&&Ie.push(Ae);be=xe.concat(ve,ke,Ie)}return be}}let f$1=class extends ButtonView{constructor(we,t){super(we),this.textPartView=this._createTextPartView(we,t),t.isIconColorInherited!==void 0&&(this.iconView.isColorInherited=t.isIconColorInherited),this.set({icon:t.icon||'<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path clip-rule="evenodd" d="M10 19a9 9 0 1 0 0-18 9 9 0 0 0 0 18Zm3.45-9.872a1 1 0 0 1 0 1.744l-4.96 2.79A1 1 0 0 1 7 12.79V7.21a1 1 0 0 1 1.49-.872l4.96 2.79Z"/></svg>',withText:!0,label:t.title,class:"ck-slash-command-button"})}render(){super.render(),this.children.add(this.textPartView)}_createTextPartView(we,t){const te=new View(we);return te.setTemplate({tag:"div",attributes:{class:["ck","ck-slash-command-button__text-part"]},children:t.description?[this.labelView,{tag:"span",attributes:{class:["ck","ck-slash-command-button__description"]},children:[{text:t.description}]}]:[this.labelView]}),te}};class s extends Plugin{static get pluginName(){return"SlashCommandUI"}constructor(we){super(we),this._setupMentionConfiguration()}init(){this.editor.once("ready",this._overrideMentionExecuteListener.bind(this))}afterInit(){(function(we){function t(be,xe,ve){const ke={};ke[te([110,117,109,98,101,114,79,102,82,111,117,110,100,115])]={16:10,24:12,32:14},ke[te([114,99,111,110])]=[1,2,4,8,16,32,64,128,27,54,108,216,171,77,154,47,94,188,99,198,151,53,106,212,179,125,250,239,197,145],ke[te([83])]=[99,124,119,123,242,107,111,197,48,1,103,43,254,215,171,118,202,130,201,125,250,89,71,240,173,212,162,175,156,164,114,192,183,253,147,38,54,63,247,204,52,165,229,241,113,216,49,21,4,199,35,195,24,150,5,154,7,18,128,226,235,39,178,117,9,131,44,26,27,110,90,160,82,59,214,179,41,227,47,132,83,209,0,237,32,252,177,91,106,203,190,57,74,76,88,207,208,239,170,251,67,77,51,133,69,249,2,127,80,60,159,168,81,163,64,143,146,157,56,245,188,182,218,33,16,255,243,210,205,12,19,236,95,151,68,23,196,167,126,61,100,93,25,115,96,129,79,220,34,42,144,136,70,238,184,20,222,94,11,219,224,50,58,10,73,6,36,92,194,211,172,98,145,149,228,121,231,200,55,109,141,213,78,169,108,86,244,234,101,122,174,8,186,120,37,46,28,166,180,198,232,221,116,31,75,189,139,138,112,62,181,102,72,3,246,14,97,53,87,185,134,193,29,158,225,248,152,17,105,217,142,148,155,30,135,233,206,85,40,223,140,161,137,13,191,230,66,104,65,153,45,15,176,84,187,22],ke[te([84,49])]=[3328402341,4168907908,4000806809,4135287693,4294111757,3597364157,3731845041,2445657428,1613770832,33620227,3462883241,1445669757,3892248089,3050821474,1303096294,3967186586,2412431941,528646813,2311702848,4202528135,4026202645,2992200171,2387036105,4226871307,1101901292,3017069671,1604494077,1169141738,597466303,1403299063,3832705686,2613100635,1974974402,3791519004,1033081774,1277568618,1815492186,2118074177,4126668546,2211236943,1748251740,1369810420,3521504564,4193382664,3799085459,2883115123,1647391059,706024767,134480908,2512897874,1176707941,2646852446,806885416,932615841,168101135,798661301,235341577,605164086,461406363,3756188221,3454790438,1311188841,2142417613,3933566367,302582043,495158174,1479289972,874125870,907746093,3698224818,3025820398,1537253627,2756858614,1983593293,3084310113,2108928974,1378429307,3722699582,1580150641,327451799,2790478837,3117535592,0,3253595436,1075847264,3825007647,2041688520,3059440621,3563743934,2378943302,1740553945,1916352843,2487896798,2555137236,2958579944,2244988746,3151024235,3320835882,1336584933,3992714006,2252555205,2588757463,1714631509,293963156,2319795663,3925473552,67240454,4269768577,2689618160,2017213508,631218106,1269344483,2723238387,1571005438,2151694528,93294474,1066570413,563977660,1882732616,4059428100,1673313503,2008463041,2950355573,1109467491,537923632,3858759450,4260623118,3218264685,2177748300,403442708,638784309,3287084079,3193921505,899127202,2286175436,773265209,2479146071,1437050866,4236148354,2050833735,3362022572,3126681063,840505643,3866325909,3227541664,427917720,2655997905,2749160575,1143087718,1412049534,999329963,193497219,2353415882,3354324521,1807268051,672404540,2816401017,3160301282,369822493,2916866934,3688947771,1681011286,1949973070,336202270,2454276571,201721354,1210328172,3093060836,2680341085,3184776046,1135389935,3294782118,965841320,831886756,3554993207,4068047243,3588745010,2345191491,1849112409,3664604599,26054028,2983581028,2622377682,1235855840,3630984372,2891339514,4092916743,3488279077,3395642799,4101667470,1202630377,268961816,1874508501,4034427016,1243948399,1546530418,941366308,1470539505,1941222599,2546386513,3421038627,2715671932,3899946140,1042226977,2521517021,1639824860,227249030,260737669,3765465232,2084453954,1907733956,3429263018,2420656344,100860677,4160157185,470683154,3261161891,1781871967,2924959737,1773779408,394692241,2579611992,974986535,664706745,3655459128,3958962195,731420851,571543859,3530123707,2849626480,126783113,865375399,765172662,1008606754,361203602,3387549984,2278477385,2857719295,1344809080,2782912378,59542671,1503764984,160008576,437062935,1707065306,3622233649,2218934982,3496503480,2185314755,697932208,1512910199,504303377,2075177163,2824099068,1841019862,739644986],ke[te([84,50])]=[2781242211,2230877308,2582542199,2381740923,234877682,3184946027,2984144751,1418839493,1348481072,50462977,2848876391,2102799147,434634494,1656084439,3863849899,2599188086,1167051466,2636087938,1082771913,2281340285,368048890,3954334041,3381544775,201060592,3963727277,1739838676,4250903202,3930435503,3206782108,4149453988,2531553906,1536934080,3262494647,484572669,2923271059,1783375398,1517041206,1098792767,49674231,1334037708,1550332980,4098991525,886171109,150598129,2481090929,1940642008,1398944049,1059722517,201851908,1385547719,1699095331,1587397571,674240536,2704774806,252314885,3039795866,151914247,908333586,2602270848,1038082786,651029483,1766729511,3447698098,2682942837,454166793,2652734339,1951935532,775166490,758520603,3000790638,4004797018,4217086112,4137964114,1299594043,1639438038,3464344499,2068982057,1054729187,1901997871,2534638724,4121318227,1757008337,0,750906861,1614815264,535035132,3363418545,3988151131,3201591914,1183697867,3647454910,1265776953,3734260298,3566750796,3903871064,1250283471,1807470800,717615087,3847203498,384695291,3313910595,3617213773,1432761139,2484176261,3481945413,283769337,100925954,2180939647,4037038160,1148730428,3123027871,3813386408,4087501137,4267549603,3229630528,2315620239,2906624658,3156319645,1215313976,82966005,3747855548,3245848246,1974459098,1665278241,807407632,451280895,251524083,1841287890,1283575245,337120268,891687699,801369324,3787349855,2721421207,3431482436,959321879,1469301956,4065699751,2197585534,1199193405,2898814052,3887750493,724703513,2514908019,2696962144,2551808385,3516813135,2141445340,1715741218,2119445034,2872807568,2198571144,3398190662,700968686,3547052216,1009259540,2041044702,3803995742,487983883,1991105499,1004265696,1449407026,1316239930,504629770,3683797321,168560134,1816667172,3837287516,1570751170,1857934291,4014189740,2797888098,2822345105,2754712981,936633572,2347923833,852879335,1133234376,1500395319,3084545389,2348912013,1689376213,3533459022,3762923945,3034082412,4205598294,133428468,634383082,2949277029,2398386810,3913789102,403703816,3580869306,2297460856,1867130149,1918643758,607656988,4049053350,3346248884,1368901318,600565992,2090982877,2632479860,557719327,3717614411,3697393085,2249034635,2232388234,2430627952,1115438654,3295786421,2865522278,3633334344,84280067,33027830,303828494,2747425121,1600795957,4188952407,3496589753,2434238086,1486471617,658119965,3106381470,953803233,334231800,3005978776,857870609,3151128937,1890179545,2298973838,2805175444,3056442267,574365214,2450884487,550103529,1233637070,4289353045,2018519080,2057691103,2399374476,4166623649,2148108681,387583245,3664101311,836232934,3330556482,3100665960,3280093505,2955516313,2002398509,287182607,3413881008,4238890068,3597515707,975967766],ke[te([84,51])]=[1671808611,2089089148,2006576759,2072901243,4061003762,1807603307,1873927791,3310653893,810573872,16974337,1739181671,729634347,4263110654,3613570519,2883997099,1989864566,3393556426,2191335298,3376449993,2106063485,4195741690,1508618841,1204391495,4027317232,2917941677,3563566036,2734514082,2951366063,2629772188,2767672228,1922491506,3227229120,3082974647,4246528509,2477669779,644500518,911895606,1061256767,4144166391,3427763148,878471220,2784252325,3845444069,4043897329,1905517169,3631459288,827548209,356461077,67897348,3344078279,593839651,3277757891,405286936,2527147926,84871685,2595565466,118033927,305538066,2157648768,3795705826,3945188843,661212711,2999812018,1973414517,152769033,2208177539,745822252,439235610,455947803,1857215598,1525593178,2700827552,1391895634,994932283,3596728278,3016654259,695947817,3812548067,795958831,2224493444,1408607827,3513301457,0,3979133421,543178784,4229948412,2982705585,1542305371,1790891114,3410398667,3201918910,961245753,1256100938,1289001036,1491644504,3477767631,3496721360,4012557807,2867154858,4212583931,1137018435,1305975373,861234739,2241073541,1171229253,4178635257,33948674,2139225727,1357946960,1011120188,2679776671,2833468328,1374921297,2751356323,1086357568,2408187279,2460827538,2646352285,944271416,4110742005,3168756668,3066132406,3665145818,560153121,271589392,4279952895,4077846003,3530407890,3444343245,202643468,322250259,3962553324,1608629855,2543990167,1154254916,389623319,3294073796,2817676711,2122513534,1028094525,1689045092,1575467613,422261273,1939203699,1621147744,2174228865,1339137615,3699352540,577127458,712922154,2427141008,2290289544,1187679302,3995715566,3100863416,339486740,3732514782,1591917662,186455563,3681988059,3762019296,844522546,978220090,169743370,1239126601,101321734,611076132,1558493276,3260915650,3547250131,2901361580,1655096418,2443721105,2510565781,3828863972,2039214713,3878868455,3359869896,928607799,1840765549,2374762893,3580146133,1322425422,2850048425,1823791212,1459268694,4094161908,3928346602,1706019429,2056189050,2934523822,135794696,3134549946,2022240376,628050469,779246638,472135708,2800834470,3032970164,3327236038,3894660072,3715932637,1956440180,522272287,1272813131,3185336765,2340818315,2323976074,1888542832,1044544574,3049550261,1722469478,1222152264,50660867,4127324150,236067854,1638122081,895445557,1475980887,3117443513,2257655686,3243809217,489110045,2662934430,3778599393,4162055160,2561878936,288563729,1773916777,3648039385,2391345038,2493985684,2612407707,505560094,2274497927,3911240169,3460925390,1442818645,678973480,3749357023,2358182796,2717407649,2306869641,219617805,3218761151,3862026214,1120306242,1756942440,1103331905,2578459033,762796589,252780047,2966125488,1425844308,3151392187,372911126],ke[te([84,52])]=[1667474886,2088535288,2004326894,2071694838,4075949567,1802223062,1869591006,3318043793,808472672,16843522,1734846926,724270422,4278065639,3621216949,2880169549,1987484396,3402253711,2189597983,3385409673,2105378810,4210693615,1499065266,1195886990,4042263547,2913856577,3570689971,2728590687,2947541573,2627518243,2762274643,1920112356,3233831835,3082273397,4261223649,2475929149,640051788,909531756,1061110142,4160160501,3435941763,875846760,2779116625,3857003729,4059105529,1903268834,3638064043,825316194,353713962,67374088,3351728789,589522246,3284360861,404236336,2526454071,84217610,2593830191,117901582,303183396,2155911963,3806477791,3958056653,656894286,2998062463,1970642922,151591698,2206440989,741110872,437923380,454765878,1852748508,1515908788,2694904667,1381168804,993742198,3604373943,3014905469,690584402,3823320797,791638366,2223281939,1398011302,3520161977,0,3991743681,538992704,4244381667,2981218425,1532751286,1785380564,3419096717,3200178535,960056178,1246420628,1280103576,1482221744,3486468741,3503319995,4025428677,2863326543,4227536621,1128514950,1296947098,859002214,2240123921,1162203018,4193849577,33687044,2139062782,1347481760,1010582648,2678045221,2829640523,1364325282,2745433693,1077985408,2408548869,2459086143,2644360225,943212656,4126475505,3166494563,3065430391,3671750063,555836226,269496352,4294908645,4092792573,3537006015,3452783745,202118168,320025894,3974901699,1600119230,2543297077,1145359496,387397934,3301201811,2812801621,2122220284,1027426170,1684319432,1566435258,421079858,1936954854,1616945344,2172753945,1330631070,3705438115,572679748,707427924,2425400123,2290647819,1179044492,4008585671,3099120491,336870440,3739122087,1583276732,185277718,3688593069,3772791771,842159716,976899700,168435220,1229577106,101059084,606366792,1549591736,3267517855,3553849021,2897014595,1650632388,2442242105,2509612081,3840161747,2038008818,3890688725,3368567691,926374254,1835907034,2374863873,3587531953,1313788572,2846482505,1819063512,1448540844,4109633523,3941213647,1701162954,2054852340,2930698567,134748176,3132806511,2021165296,623210314,774795868,471606328,2795958615,3031746419,3334885783,3907527627,3722280097,1953799400,522133822,1263263126,3183336545,2341176845,2324333839,1886425312,1044267644,3048588401,1718004428,1212733584,50529542,4143317495,235803164,1633788866,892690282,1465383342,3115962473,2256965911,3250673817,488449850,2661202215,3789633753,4177007595,2560144171,286339874,1768537042,3654906025,2391705863,2492770099,2610673197,505291324,2273808917,3924369609,3469625735,1431699370,673740880,3755965093,2358021891,2711746649,2307489801,218961690,3217021541,3873845719,1111672452,1751693520,1094828930,2576986153,757954394,252645662,2964376443,1414855848,3149649517,370555436],ke[te([85,49])]=[0,235474187,470948374,303765277,941896748,908933415,607530554,708780849,1883793496,2118214995,1817866830,1649639237,1215061108,1181045119,1417561698,1517767529,3767586992,4003061179,4236429990,4069246893,3635733660,3602770327,3299278474,3400528769,2430122216,2664543715,2362090238,2193862645,2835123396,2801107407,3035535058,3135740889,3678124923,3576870512,3341394285,3374361702,3810496343,3977675356,4279080257,4043610186,2876494627,2776292904,3076639029,3110650942,2472011535,2640243204,2403728665,2169303058,1001089995,899835584,666464733,699432150,59727847,226906860,530400753,294930682,1273168787,1172967064,1475418501,1509430414,1942435775,2110667444,1876241833,1641816226,2910219766,2743034109,2976151520,3211623147,2505202138,2606453969,2302690252,2269728455,3711829422,3543599269,3240894392,3475313331,3843699074,3943906441,4178062228,4144047775,1306967366,1139781709,1374988112,1610459739,1975683434,2076935265,1775276924,1742315127,1034867998,866637845,566021896,800440835,92987698,193195065,429456164,395441711,1984812685,2017778566,1784663195,1683407248,1315562145,1080094634,1383856311,1551037884,101039829,135050206,437757123,337553864,1042385657,807962610,573804783,742039012,2531067453,2564033334,2328828971,2227573024,2935566865,2700099354,3001755655,3168937228,3868552805,3902563182,4203181171,4102977912,3736164937,3501741890,3265478751,3433712980,1106041591,1340463100,1576976609,1408749034,2043211483,2009195472,1708848333,1809054150,832877231,1068351396,766945465,599762354,159417987,126454664,361929877,463180190,2709260871,2943682380,3178106961,3009879386,2572697195,2538681184,2236228733,2336434550,3509871135,3745345300,3441850377,3274667266,3910161971,3877198648,4110568485,4211818798,2597806476,2497604743,2261089178,2295101073,2733856160,2902087851,3202437046,2968011453,3936291284,3835036895,4136440770,4169408201,3535486456,3702665459,3467192302,3231722213,2051518780,1951317047,1716890410,1750902305,1113818384,1282050075,1584504582,1350078989,168810852,67556463,371049330,404016761,841739592,1008918595,775550814,540080725,3969562369,3801332234,4035489047,4269907996,3569255213,3669462566,3366754619,3332740144,2631065433,2463879762,2160117071,2395588676,2767645557,2868897406,3102011747,3069049960,202008497,33778362,270040487,504459436,875451293,975658646,675039627,641025152,2084704233,1917518562,1615861247,1851332852,1147550661,1248802510,1484005843,1451044056,933301370,967311729,733156972,632953703,260388950,25965917,328671808,496906059,1206477858,1239443753,1543208500,1441952575,2144161806,1908694277,1675577880,1842759443,3610369226,3644379585,3408119516,3307916247,4011190502,3776767469,4077384432,4245618683,2809771154,2842737049,3144396420,3043140495,2673705150,2438237621,2203032232,2370213795],ke[te([85,50])]=[0,185469197,370938394,487725847,741876788,657861945,975451694,824852259,1483753576,1400783205,1315723890,1164071807,1950903388,2135319889,1649704518,1767536459,2967507152,3152976349,2801566410,2918353863,2631447780,2547432937,2328143614,2177544179,3901806776,3818836405,4270639778,4118987695,3299409036,3483825537,3535072918,3652904859,2077965243,1893020342,1841768865,1724457132,1474502543,1559041666,1107234197,1257309336,598438867,681933534,901210569,1052338372,261314535,77422314,428819965,310463728,3409685355,3224740454,3710368113,3593056380,3875770207,3960309330,4045380933,4195456072,2471224067,2554718734,2237133081,2388260884,3212035895,3028143674,2842678573,2724322336,4138563181,4255350624,3769721975,3955191162,3667219033,3516619604,3431546947,3347532110,2933734917,2782082824,3099667487,3016697106,2196052529,2313884476,2499348523,2683765030,1179510461,1296297904,1347548327,1533017514,1786102409,1635502980,2087309459,2003294622,507358933,355706840,136428751,53458370,839224033,957055980,605657339,790073846,2373340630,2256028891,2607439820,2422494913,2706270690,2856345839,3075636216,3160175349,3573941694,3725069491,3273267108,3356761769,4181598602,4063242375,4011996048,3828103837,1033297158,915985419,730517276,545572369,296679730,446754879,129166120,213705253,1709610350,1860738147,1945798516,2029293177,1239331162,1120974935,1606591296,1422699085,4148292826,4233094615,3781033664,3931371469,3682191598,3497509347,3446004468,3328955385,2939266226,2755636671,3106780840,2988687269,2198438022,2282195339,2501218972,2652609425,1201765386,1286567175,1371368976,1521706781,1805211710,1620529459,2105887268,1988838185,533804130,350174575,164439672,46346101,870912086,954669403,636813900,788204353,2358957921,2274680428,2592523643,2441661558,2695033685,2880240216,3065962831,3182487618,3572145929,3756299780,3270937875,3388507166,4174560061,4091327024,4006521127,3854606378,1014646705,930369212,711349675,560487590,272786309,457992840,106852767,223377554,1678381017,1862534868,1914052035,2031621326,1211247597,1128014560,1580087799,1428173050,32283319,182621114,401639597,486441376,768917123,651868046,1003007129,818324884,1503449823,1385356242,1333838021,1150208456,1973745387,2125135846,1673061617,1756818940,2970356327,3120694122,2802849917,2887651696,2637442643,2520393566,2334669897,2149987652,3917234703,3799141122,4284502037,4100872472,3309594171,3460984630,3545789473,3629546796,2050466060,1899603969,1814803222,1730525723,1443857720,1560382517,1075025698,1260232239,575138148,692707433,878443390,1062597235,243256656,91341917,409198410,325965383,3403100636,3252238545,3704300486,3620022987,3874428392,3990953189,4042459122,4227665663,2460449204,2578018489,2226875310,2411029155,3198115200,3046200461,2827177882,2743944855],ke[te([85,51])]=[0,218828297,437656594,387781147,875313188,958871085,775562294,590424639,1750626376,1699970625,1917742170,2135253587,1551124588,1367295589,1180849278,1265195639,3501252752,3720081049,3399941250,3350065803,3835484340,3919042237,4270507174,4085369519,3102249176,3051593425,2734591178,2952102595,2361698556,2177869557,2530391278,2614737639,3145456443,3060847922,2708326185,2892417312,2404901663,2187128086,2504130317,2555048196,3542330227,3727205754,3375740769,3292445032,3876557655,3926170974,4246310725,4027744588,1808481195,1723872674,1910319033,2094410160,1608975247,1391201670,1173430173,1224348052,59984867,244860394,428169201,344873464,935293895,984907214,766078933,547512796,1844882806,1627235199,2011214180,2062270317,1507497298,1423022939,1137477952,1321699145,95345982,145085239,532201772,313773861,830661914,1015671571,731183368,648017665,3175501286,2957853679,2807058932,2858115069,2305455554,2220981195,2474404304,2658625497,3575528878,3625268135,3473416636,3254988725,3778151818,3963161475,4213447064,4130281361,3599595085,3683022916,3432737375,3247465558,3802222185,4020912224,4172763771,4122762354,3201631749,3017672716,2764249623,2848461854,2331590177,2280796200,2431590963,2648976442,104699613,188127444,472615631,287343814,840019705,1058709744,671593195,621591778,1852171925,1668212892,1953757831,2037970062,1514790577,1463996600,1080017571,1297403050,3673637356,3623636965,3235995134,3454686199,4007360968,3822090177,4107101658,4190530515,2997825956,3215212461,2830708150,2779915199,2256734592,2340947849,2627016082,2443058075,172466556,122466165,273792366,492483431,1047239e3,861968209,612205898,695634755,1646252340,1863638845,2013908262,1963115311,1446242576,1530455833,1277555970,1093597963,1636604631,1820824798,2073724613,1989249228,1436590835,1487645946,1337376481,1119727848,164948639,81781910,331544205,516552836,1039717051,821288114,669961897,719700128,2973530695,3157750862,2871682645,2787207260,2232435299,2283490410,2667994737,2450346104,3647212047,3564045318,3279033885,3464042516,3980931627,3762502690,4150144569,4199882800,3070356634,3121275539,2904027272,2686254721,2200818878,2384911031,2570832044,2486224549,3747192018,3528626907,3310321856,3359936201,3950355702,3867060991,4049844452,4234721005,1739656202,1790575107,2108100632,1890328081,1402811438,1586903591,1233856572,1149249077,266959938,48394827,369057872,418672217,1002783846,919489135,567498868,752375421,209336225,24197544,376187827,459744698,945164165,895287692,574624663,793451934,1679968233,1764313568,2117360635,1933530610,1343127501,1560637892,1243112415,1192455638,3704280881,3519142200,3336358691,3419915562,3907448597,3857572124,4075877127,4294704398,3029510009,3113855344,2927934315,2744104290,2159976285,2377486676,2594734927,2544078150],ke[te([85,52])]=[0,151849742,303699484,454499602,607398968,758720310,908999204,1059270954,1214797936,1097159550,1517440620,1400849762,1817998408,1699839814,2118541908,2001430874,2429595872,2581445614,2194319100,2345119218,3034881240,3186202582,2801699524,2951971274,3635996816,3518358430,3399679628,3283088770,4237083816,4118925222,4002861748,3885750714,1002142683,850817237,698445255,548169417,529487843,377642221,227885567,77089521,1943217067,2061379749,1640576439,1757691577,1474760595,1592394909,1174215055,1290801793,2875968315,2724642869,3111247143,2960971305,2405426947,2253581325,2638606623,2487810577,3808662347,3926825029,4044981591,4162096729,3342319475,3459953789,3576539503,3693126241,1986918061,2137062819,1685577905,1836772287,1381620373,1532285339,1078185097,1229899655,1040559837,923313619,740276417,621982671,439452389,322734571,137073913,19308535,3871163981,4021308739,4104605777,4255800159,3263785589,3414450555,3499326569,3651041127,2933202493,2815956275,3167684641,3049390895,2330014213,2213296395,2566595609,2448830231,1305906550,1155237496,1607244650,1455525988,1776460110,1626319424,2079897426,1928707164,96392454,213114376,396673818,514443284,562755902,679998e3,865136418,983426092,3708173718,3557504664,3474729866,3323011204,4180808110,4030667424,3945269170,3794078908,2507040230,2623762152,2272556026,2390325492,2975484382,3092726480,2738905026,2857194700,3973773121,3856137295,4274053469,4157467219,3371096953,3252932727,3673476453,3556361835,2763173681,2915017791,3064510765,3215307299,2156299017,2307622919,2459735317,2610011675,2081048481,1963412655,1846563261,1729977011,1480485785,1362321559,1243905413,1126790795,878845905,1030690015,645401037,796197571,274084841,425408743,38544885,188821243,3613494426,3731654548,3313212038,3430322568,4082475170,4200115116,3780097726,3896688048,2668221674,2516901860,2366882550,2216610296,3141400786,2989552604,2837966542,2687165888,1202797690,1320957812,1437280870,1554391400,1669664834,1787304780,1906247262,2022837584,265905162,114585348,499347990,349075736,736970802,585122620,972512814,821712160,2595684844,2478443234,2293045232,2174754046,3196267988,3079546586,2895723464,2777952454,3537852828,3687994002,3234156416,3385345166,4142626212,4293295786,3841024952,3992742070,174567692,57326082,410887952,292596766,777231668,660510266,1011452712,893681702,1108339068,1258480242,1343618912,1494807662,1715193156,1865862730,1948373848,2100090966,2701949495,2818666809,3004591147,3122358053,2235061775,2352307457,2535604243,2653899549,3915653703,3764988233,4219352155,4067639125,3444575871,3294430577,3746175075,3594982253,836553431,953270745,600235211,718002117,367585007,484830689,133361907,251657213,2041877159,1891211689,1806599355,1654886325,1568718495,1418573201,1335535747,1184342925];const Ie=new Uint8Array(16);for(let Ue=15;Ue>=0;--Ue)Ie[Ue]=ve%256,ve=parseInt(ve/256);let Ae=null,Se=16;const Oe=new Uint8Array(xe),Ve=[],Me=[];$e();for(let Ue=0;Ue<be[te([108,101,110,103,116,104])];Ue++)Se===16&&(Ae=Be(Ie),Se=0,Fe(Ie)),be[Ue]^=Ae[Se++];return be;function De(Ue){const He=[];for(let ze=0;ze<Ue[te([108,101,110,103,116,104])];ze+=4)He[te([112,117,115,104])](Ue[ze]<<24|Ue[ze+1]<<16|Ue[ze+2]<<8|Ue[ze+3]);return He}function Fe(Ue){for(let He=15;He>=0;He--){if(Ue[He]!==255){Ue[He]++;break}Ue[He]=0}}function Be(Ue){const He=Ve[te([108,101,110,103,116,104])]-1,ze=[0,0,0,0];let qe=De(Ue);for(let je=0;je<4;je++)qe[je]^=Ve[0][je];for(let je=1;je<He;je++){for(let Ye=0;Ye<4;Ye++)ze[Ye]=ke[te([84,49])][qe[Ye]>>24&255]^ke[te([84,50])][qe[(Ye+1)%4]>>16&255]^ke[te([84,51])][qe[(Ye+2)%4]>>8&255]^ke[te([84,52])][255&qe[(Ye+3)%4]]^Ve[je][Ye];qe=ze[te([115,108,105,99,101])]()}const Ke=new Uint8Array(16);let Qe;for(let je=0;je<4;je++)Qe=Ve[He][je],Ke[4*je]=255&(ke[te([83])][qe[je]>>24&255]^Qe>>24),Ke[4*je+1]=255&(ke[te([83])][qe[(je+1)%4]>>16&255]^Qe>>16),Ke[4*je+2]=255&(ke[te([83])][qe[(je+2)%4]>>8&255]^Qe>>8),Ke[4*je+3]=255&(ke[te([83])][255&qe[(je+3)%4]]^Qe);return Ke}function $e(){const Ue=ke[te([110,117,109,98,101,114,79,102,82,111,117,110,100,115])][Oe[te([108,101,110,103,116,104])]];for(let ht=0;ht<=Ue;ht++)Ve[te([112,117,115,104])]([0,0,0,0]),Me[te([112,117,115,104])]([0,0,0,0]);const He=4*(Ue+1),ze=Oe[te([108,101,110,103,116,104])]/4,qe=De(Oe);let Ke;for(let ht=0;ht<ze;ht++)Ke=ht>>2,Ve[Ke][ht%4]=qe[ht],Me[Ue-Ke][ht%4]=qe[ht];let Qe,je=0,Ye=ze;for(;Ye<He;){Qe=qe[ze-1],qe[0]^=ke[te([83])][Qe>>16&255]<<24^ke[te([83])][Qe>>8&255]<<16^ke[te([83])][255&Qe]<<8^ke[te([83])][Qe>>24&255]^ke[te([114,99,111,110])][je]<<24,je+=1;for(let Jt=1;Jt<ze/2;Jt++)qe[Jt]^=qe[Jt-1];Qe=qe[ze/2-1],qe[ze/2]^=ke[te([83])][255&Qe]^ke[te([83])][Qe>>8&255]<<8^ke[te([83])][Qe>>16&255]<<16^ke[te([83])][Qe>>24&255]<<24;for(let Jt=ze/2+1;Jt<ze;Jt++)qe[Jt]^=qe[Jt-1];let ht,Ze,Bt=0;for(;Bt<ze&&Ye<He;)ht=Ye>>2,Ze=Ye%4,Ve[ht][Ze]=qe[Bt],Me[Ue-ht][Ze]=qe[Bt++],Ye++}for(let ht=1;ht<Ue;ht++)for(let Ze=0;Ze<4;Ze++)Qe=Me[ht][Ze],Me[ht][Ze]=ke[te([85,49])][Qe>>24&255]^ke[te([85,50])][Qe>>16&255]^ke[te([85,51])][Qe>>8&255]^ke[te([85,52])][255&Qe]}}function te(be){return be.map(xe=>String.fromCharCode(xe)).join("")}(be=>{function xe(){const Ge=[{[te([105,100])]:1,[te([102,101,97,116,117,114,101,78,97,109,101])]:te([67,111,109,109,101,110,116,115]),[te([112,108,117,103,105,110,78,97,109,101])]:te([67,111,109,109,101,110,116,115,82,101,112,111,115,105,116,111,114,121]),[te([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:te([108,105,99,101,110,115,101,75,101,121]),[te([104,97,110,100,108,101,114])]:te([99,104,101,99,107,76,105,99,101,110,115,101]),[te([99,104,101,99,107,65,108,115,111])]:[{[te([105,100])]:2,[te([102,101,97,116,117,114,101,78,97,109,101])]:te([84,114,97,99,107,32,67,104,97,110,103,101,115]),[te([112,108,117,103,105,110,78,97,109,101])]:te([84,114,97,99,107,67,104,97,110,103,101,115,69,100,105,116,105,110,103]),[te([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:te([108,105,99,101,110,115,101,75,101,121]),[te([104,97,110,100,108,101,114])]:te([99,104,101,99,107,76,105,99,101,110,115,101,70,111,114,84,114,97,99,107,67,104,97,110,103,101,115]),[te([111,112,116,105,111,110,115])]:{[te([97,105,119,115,103,105,99])]:!0,[te([97,105,116,99,100,103,105,108])]:!0,[te([97,105,114,118,105,105,108])]:!0}}],[te([111,112,116,105,111,110,115])]:{[te([97,105,119,115,103,105,99])]:!0,[te([97,105,116,99,100,103,105,108])]:!0,[te([97,105,114,118,105,105,108])]:!0}},{[te([105,100])]:3,[te([102,101,97,116,117,114,101,78,97,109,101])]:te([80,97,103,105,110,97,116,105,111,110]),[te([112,108,117,103,105,110,78,97,109,101])]:te([80,97,103,105,110,97,116,105,111,110,76,111,111,107,117,112]),[te([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:te([112,97,103,105,110,97,116,105,111,110,76,105,99,101,110,115,101,75,101,121]),[te([104,97,110,100,108,101,114])]:te([99,104,101,99,107,76,105,99,101,110,115,101])},{[te([105,100])]:4,[te([102,101,97,116,117,114,101,78,97,109,101])]:te([82,101,118,105,115,105,111,110,32,72,105,115,116,111,114,121]),[te([112,108,117,103,105,110,78,97,109,101])]:te([82,101,118,105,115,105,111,110,115,82,101,112,111,115,105,116,111,114,121]),[te([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:te([108,105,99,101,110,115,101,75,101,121]),[te([104,97,110,100,108,101,114])]:te([99,104,101,99,107,76,105,99,101,110,115,101,70,111,114,82,101,118,105,115,105,111,110,72,105,115,116,111,114,121]),[te([111,112,116,105,111,110,115])]:{[te([97,105,119,115,103,105,99])]:!0,[te([97,105,116,99,100,103,105,108])]:!0,[te([97,105,114,118,105,105,108])]:!0}},{[te([105,100])]:5,[te([102,101,97,116,117,114,101,78,97,109,101])]:te([68,111,99,117,109,101,110,116,32,79,117,116,108,105,110,101]),[te([112,108,117,103,105,110,78,97,109,101])]:te([68,111,99,117,109,101,110,116,79,117,116,108,105,110,101,85,73]),[te([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:te([100,111,99,117,109,101,110,116,79,117,116,108,105,110,101,76,105,99,101,110,115,101,75,101,121]),[te([104,97,110,100,108,101,114])]:te([99,104,101,99,107,76,105,99,101,110,115,101]),[te([111,112,116,105,111,110,115])]:{[te([102,103,105])]:[12]}},{[te([105,100])]:6,[te([102,101,97,116,117,114,101,78,97,109,101])]:te([70,111,114,109,97,116,32,80,97,105,110,116,101,114]),[te([112,108,117,103,105,110,78,97,109,101])]:te([70,111,114,109,97,116,80,97,105,110,116,101,114,85,73]),[te([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:te([102,111,114,109,97,116,80,97,105,110,116,101,114,76,105,99,101,110,115,101,75,101,121]),[te([104,97,110,100,108,101,114])]:te([99,104,101,99,107,76,105,99,101,110,115,101]),[te([111,112,116,105,111,110,115])]:{[te([102,103,105])]:[12]}},{[te([105,100])]:7,[te([102,101,97,116,117,114,101,78,97,109,101])]:te([83,108,97,115,104,32,67,111,109,109,97,110,100]),[te([112,108,117,103,105,110,78,97,109,101])]:te([83,108,97,115,104,67,111,109,109,97,110,100,85,73]),[te([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:te([115,108,97,115,104,67,111,109,109,97,110,100,76,105,99,101,110,115,101,75,101,121]),[te([104,97,110,100,108,101,114])]:te([99,104,101,99,107,76,105,99,101,110,115,101]),[te([111,112,116,105,111,110,115])]:{[te([102,103,105])]:[12]}},{[te([105,100])]:8,[te([102,101,97,116,117,114,101,78,97,109,101])]:te([84,97,98,108,101,32,111,102,32,67,111,110,116,101,110,116,115]),[te([112,108,117,103,105,110,78,97,109,101])]:te([84,97,98,108,101,79,102,67,111,110,116,101,110,116,115,69,100,105,116,105,110,103]),[te([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:te([116,97,98,108,101,79,102,67,111,110,116,101,110,116,115,76,105,99,101,110,115,101,75,101,121]),[te([104,97,110,100,108,101,114])]:te([99,104,101,99,107,76,105,99,101,110,115,101]),[te([111,112,116,105,111,110,115])]:{[te([102,103,105])]:[12]}},{[te([105,100])]:9,[te([102,101,97,116,117,114,101,78,97,109,101])]:te([84,101,109,112,108,97,116,101]),[te([112,108,117,103,105,110,78,97,109,101])]:te([84,101,109,112,108,97,116,101,85,73]),[te([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:te([116,101,109,112,108,97,116,101,76,105,99,101,110,115,101,75,101,121]),[te([104,97,110,100,108,101,114])]:te([99,104,101,99,107,76,105,99,101,110,115,101]),[te([111,112,116,105,111,110,115])]:{[te([102,103,105])]:[12,14]}},{[te([105,100])]:10,[te([102,101,97,116,117,114,101,78,97,109,101])]:te([80,97,115,116,101,32,102,114,111,109,32,79,102,102,105,99,101,32,69,110,104,97,110,99,101,100]),[te([112,108,117,103,105,110,78,97,109,101])]:te([80,97,115,116,101,70,114,111,109,79,102,102,105,99,101,69,110,104,97,110,99,101,100,73,110,108,105,110,101,114]),[te([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:te([112,97,115,116,101,70,114,111,109,79,102,102,105,99,101,69,110,104,97,110,99,101,100,76,105,99,101,110,115,101,75,101,121]),[te([104,97,110,100,108,101,114])]:te([99,104,101,99,107,76,105,99,101,110,115,101]),[te([111,112,116,105,111,110,115])]:{[te([102,103,105])]:[12]}},{[te([105,100])]:11,[te([102,101,97,116,117,114,101,78,97,109,101])]:te([65,73,32,65,115,115,105,115,116,97,110,116]),[te([112,108,117,103,105,110,78,97,109,101])]:te([65,73,65,115,115,105,115,116,97,110,116,85,73]),[te([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:te([97,105,76,105,99,101,110,115,101,75,101,121]),[te([104,97,110,100,108,101,114])]:te([99,104,101,99,107,76,105,99,101,110,115,101])},{[te([105,100])]:12,[te([102,101,97,116,117,114,101,78,97,109,101])]:te([80,114,111,100,117,99,116,105,118,105,116,121,32,112,97,99,107])},{[te([105,100])]:13,[te([102,101,97,116,117,114,101,78,97,109,101])]:te([67,97,115,101,32,67,104,97,110,103,101]),[te([112,108,117,103,105,110,78,97,109,101])]:te([67,97,115,101,67,104,97,110,103,101,85,73]),[te([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:te([99,97,115,101,67,104,97,110,103,101,76,105,99,101,110,115,101,75,101,121]),[te([104,97,110,100,108,101,114])]:te([99,104,101,99,107,76,105,99,101,110,115,101]),[te([111,112,116,105,111,110,115])]:{[te([102,103,105])]:[12]}},{[te([105,100])]:14,[te([102,101,97,116,117,114,101,78,97,109,101])]:te([68,114,117,112,97,108,32,112,97,99,107]),[te([102,111,114,98,105,100,100,101,110,72,97,110,100,108,101,114])]:te([102,111,114,98,105,100,100,101,110,72,97,110,100,108,101,114,70,111,114,68,114,117,112,97,108])},{[te([105,100])]:15,[te([102,101,97,116,117,114,101,78,97,109,101])]:te([77,117,108,116,105,32,76,101,118,101,108,32,76,105,115,116]),[te([112,108,117,103,105,110,78,97,109,101])]:te([77,117,108,116,105,76,101,118,101,108,76,105,115,116,69,100,105,116,105,110,103]),[te([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:te([109,117,108,116,105,76,101,118,101,108,76,105,115,116,76,105,99,101,110,115,101,75,101,121]),[te([104,97,110,100,108,101,114])]:te([99,104,101,99,107,76,105,99,101,110,115,101])},{[te([105,100])]:16,[te([102,101,97,116,117,114,101,78,97,109,101])]:te([77,101,114,103,101,32,70,105,101,108,100,115]),[te([112,108,117,103,105,110,78,97,109,101])]:te([77,101,114,103,101,70,105,101,108,100,115,85,73]),[te([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:te([109,101,114,103,101,70,105,101,108,100,115,76,105,99,101,110,115,101,75,101,121]),[te([104,97,110,100,108,101,114])]:te([99,104,101,99,107,76,105,99,101,110,115,101]),[te([111,112,116,105,111,110,115])]:{[te([102,103,105])]:[12]}}];return Le(Ge),Ge;function Ne(We){return 1<<We-1}function Le(We){We[te([102,111,114,69,97,99,104])](Je=>{Je[te([112,101,114,109,105,115,115,105,111,110,77,97,115,107])]=Ne(Je[te([105,100])]),ve(Je)&&Je[te([99,104,101,99,107,65,108,115,111])]&&Le(Je[te([99,104,101,99,107,65,108,115,111])])})}}function ve(Ge){return te([112,108,117,103,105,110,78,97,109,101])in Ge}const ke=[1,85,78,115,198,255,50,112,83,87,161],Ie=[127,34,6,211,167,86,146,199,132,160,18];function Ae(Ge){const Ne=[29,221,175,90,231,133,239,240,75,180];return Se(Ge,new Uint8Array([...ke,...Ne,...Ie]))}function Se(Ge,Ne){const Le=Oe(Ge),We=Array[te([102,114,111,109])](pn(Le)),Je=We[te([112,111,112])](),Wt=We[te([112,111,112])]();return Xt(t(We,Ne,Wt+256*Je))}function Oe(Ge){const Ne=atob(Ge),[Le,We]=Ne[te([115,112,108,105,116])](te([45]));try{if(atob(We))return atob(Le)}catch{}return Ne}function Ve(Ge){try{const Ne=Ae(Ge),Le=JSON[te([112,97,114,115,101])](Ne),We=parseInt(Le[te([49])]),Je=Le[te([50])]||"",Wt=parseInt(Le[te([51])]),nn=parseInt(Le[te([52])])||0,cn=parseInt(Le[te([53])])||0;return{[te([112,114,111,100,117,99,116,78,97,109,101])]:Je,[te([97,108,108,111,119,101,100,80,108,117,103,105,110,115])]:nn,[te([101,120,112,105,114,97,116,105,111,110,68,97,116,101])]:We,[te([105,115,84,114,105,97,108])]:Wt,[te([105,115,73,110,116,101,114,110,97,108])]:cn}}catch{return null}}const Me=xe(),De={[te([99,104,101,99,107,76,105,99,101,110,115,101])]:Ke,[te([99,104,101,99,107,76,105,99,101,110,115,101,70,111,114,84,114,97,99,107,67,104,97,110,103,101,115])]:Qe,[te([99,104,101,99,107,76,105,99,101,110,115,101,70,111,114,82,101,118,105,115,105,111,110,72,105,115,116,111,114,121])]:je},Fe=be[te([99,111,110,115,116,114,117,99,116,111,114])][te([112,108,117,103,105,110,78,97,109,101])],Be=te([99,111,110,116,101,120,116])in be?be.context:be.editor,$e=te([52,48,52,56,49,52,50,50]),Ue=te([65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,48,49,50,51,52,53,54,55,56,57]),He=Be.config.get(te([108,105,99,101,110,115,101,75,101,121])),ze=Me[te([102,105,108,116,101,114])](ve)[te([102,105,110,100])](Ge=>Ge[te([112,108,117,103,105,110,78,97,109,101])]===Fe);function qe(Ge,Ne){De[Ne[te([104,97,110,100,108,101,114])]](Ge,Ne),Ne[te([99,104,101,99,107,65,108,115,111])]&&Ne[te([99,104,101,99,107,65,108,115,111])][te([102,105,108,116,101,114])](Le=>tn(Be,Le[te([112,108,117,103,105,110,78,97,109,101])]))[te([102,111,114,69,97,99,104])](Le=>qe(Ge,Le))}function Ke(Ge,Ne){ht(Ye(Ge,Ne),Ne)}function Qe(Ge,Ne){function Le(We,Je){try{if(tn(Be,te([84,114,97,99,107,67,104,97,110,103,101,115,69,100,105,116,105,110,103]))&&We){const Wt=Kt(Be,te([84,114,97,99,107,67,104,97,110,103,101,115,69,100,105,116,105,110,103]))[te([95,101,120,101,99,117,116,101,83,117,103,103,101,115,116,105,111,110])];if(parseInt(Wt)/2>We[te([101,120,112,105,114,97,116,105,111,110,68,97,116,101])])return Ze(Je[te([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+te([73,110,118,97,108,105,100]))}return Ye(We,Je)}catch{return Ze(Je[te([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+te([73,110,118,97,108,105,100]))}}ht(Le(Ge,Ne),Ne)}function je(Ge,Ne){const Le=Ie[0]*ke[1],We=Ie[0]*ke[2],Je=Ie[2]*ke[2];tn(Be,te([87,101,98,83,111,99,107,101,116,71,97,116,101,119,97,121]))&&Kt(Be,te([87,101,98,83,111,99,107,101,116,71,97,116,101,119,97,121]))[te([115,116,97,116,101])]==te([99,111,110,110,101,99,116,101,100])&&(window[Bt()]=Je);function Wt(zt,Xe){try{return fn()?Ze(Xe[te([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+te([86,97,108,105,100])):Ye(zt,Xe)}catch{return Ze(Xe[te([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+te([73,110,118,97,108,105,100]))}}function nn(zt,Xe){if(zt==Xe[te([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+te([73,110,118,97,108,105,100]))dn();else if(zt==Xe[te([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+te([84,114,105,97,108])){const an=cn();an&&un(an,Xe[te([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]);const rn=ln();window[te([115,101,116,84,105,109,101,111,117,116])](()=>{un(te([116,105,109,101]),Xe[te([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])])},rn);const xn=Kt(Be,te([82,101,118,105,115,105,111,110,115,82,101,112,111,115,105,116,111,114,121]))[te([95,114,101,118,105,115,105,111,110,115])];xn[te([108,101,110,103,116,104])]>=7?un(te([114,101,118,105,115,105,111,110,115]),Xe[te([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]):xn.on(te([97,100,100]),()=>{xn[te([108,101,110,103,116,104])]>=7&&un(te([114,101,118,105,115,105,111,110,115]),Xe[te([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])])})}}function cn(){if(!tn(Be,te([82,101,118,105,115,105,111,110,86,105,101,119,101,114])))return!1;for(const zt in window)if(Number.isNaN(Number(zt))){if(window[zt]===Le)return te([116,105,109,101]);if(window[zt]===We)return te([114,101,118,105,115,105,111,110,115])}return!1}function fn(){if(!tn(Be,te([82,101,118,105,115,105,111,110,86,105,101,119,101,114])))return!1;for(const zt in window)if(Number.isNaN(Number(zt))&&window[zt]===Je)return!0;return!1}function un(zt,Xe){dn(),Ze(Xe+te([84,114,105,97,108,76,105,109,105,116,58])+zt),window[Bt()]=zt===te([116,105,109,101])?Le:We}function ln(){let zt=Ie[6]*ke[8]*ke[6];return tn(Be,te([82,101,118,105,115,105,111,110,86,105,101,119,101,114]))&&(zt/=10),zt}function dn(){const zt=Be;function Xe(){tn(zt,te([82,101,118,105,115,105,111,110,84,114,97,99,107,101,114]))&&(Kt(zt,te([82,101,118,105,115,105,111,110,84,114,97,99,107,101,114]))[te([117,110,98,105,110,100])](te([105,115,69,110,97,98,108,101,100])),Kt(zt,te([82,101,118,105,115,105,111,110,84,114,97,99,107,101,114]))[te([105,115,69,110,97,98,108,101,100])]=!1,Kt(zt,te([82,101,118,105,115,105,111,110,84,114,97,99,107,101,114]))[te([117,112,100,97,116,101])]=en,Kt(zt,te([82,101,118,105,115,105,111,110,84,114,97,99,107,101,114]))[te([115,97,118,101,82,101,118,105,115,105,111,110])]=en,zt[te([109,111,100,101,108])][te([99,104,97,110,103,101])]=en,zt[te([109,111,100,101,108])][te([101,110,113,117,101,117,101,67,104,97,110,103,101])]=en,zt[te([101,110,97,98,108,101,82,101,97,100,79,110,108,121,77,111,100,101])](te([109,111,100,101,108]))),tn(zt,te([82,101,118,105,115,105,111,110,86,105,101,119,101,114]))&&(Kt(zt,te([82,101,118,105,115,105,111,110,86,105,101,119,101,114]))[te([117,110,98,105,110,100])](te([105,115,69,110,97,98,108,101,100])),Kt(zt,te([82,101,118,105,115,105,111,110,86,105,101,119,101,114]))[te([105,115,69,110,97,98,108,101,100])]=!1,Kt(zt,te([82,101,118,105,115,105,111,110,86,105,101,119,101,114]))[te([99,111,109,112,97,114,101])]=en,Kt(zt,te([82,101,118,105,115,105,111,110,86,105,101,119,101,114]))[te([95,103,101,116,68,105,102,102])]=en)}zt[te([115,116,97,116,101])]==te([114,101,97,100,121])?Xe():zt[te([111,110,99,101])](te([114,101,97,100,121]),()=>{if(tn(zt,te([82,101,118,105,115,105,111,110,84,114,97,99,107,101,114]))&&Xe(),tn(zt,te([82,101,118,105,115,105,111,110,86,105,101,119,101,114]))){const Qt=Kt(zt,te([82,101,118,105,115,105,111,110,115,82,101,112,111,115,105,116,111,114,121])),an=Qt.getRevision(0),rn=Qt.getEarlierVisibleRevision(an[te([105,100])]);Kt(zt,te([82,101,118,105,115,105,111,110,86,105,101,119,101,114]))[te([99,111,109,112,97,114,101])](an[te([105,100])],rn?rn[te([105,100])]:null,1).then(()=>Xe())}})}nn(Wt(Ge,Ne),Ne)}function Ye(Ge,Ne){try{return gn(Ne)?Ze(Ne[te([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+te([86,97,108,105,100])):Ge&&sn(Ge[te([97,108,108,111,119,101,100,80,108,117,103,105,110,115])],Ne)?Ge[te([105,115,73,110,116,101,114,110,97,108])]&&!window[te([111,112,101,110])][te([99,108,111,115,101,100])]||parseInt($e)/2>Ge[te([101,120,112,105,114,97,116,105,111,110,68,97,116,101])]?Ze(Ne[te([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+te([73,110,118,97,108,105,100])):Ge[te([105,115,84,114,105,97,108])]?Ze(Ne[te([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+te([84,114,105,97,108])):Ze(Ne[te([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+te([86,97,108,105,100])):Ze(Ne[te([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+te([73,110,118,97,108,105,100]))}catch{return Ze(Ne[te([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+te([73,110,118,97,108,105,100]))}}function ht(Ge,Ne){if(Be instanceof Context){const Le=Be;Ge==Ne[te([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+te([73,110,118,97,108,105,100])?Jt(Le):Ge==Ne[te([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+te([84,114,105,97,108])&&window[te([115,101,116,84,105,109,101,111,117,116])](()=>{Jt(Le),Ze(Ne[te([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+te([84,114,105,97,108,76,105,109,105,116,58,116,105,109,101]))},Ie[6]*ke[8]*ke[6]),Le[te([101,100,105,116,111,114,115])][te([111,110])](te([97,100,100]),(We,Je)=>{Ge!=Ne[te([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+te([73,110,118,97,108,105,100])&&Ge!=Ne[te([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+te([84,114,105,97,108,76,105,109,105,116,58,116,105,109,101])&&Ge!=Ne[te([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+te([84,114,105,97,108,76,105,109,105,116,58,111,112,101,114,97,116,105,111,110,115])||Yt(Je)})}else{const Le=Be;Ge==Ne[te([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+te([73,110,118,97,108,105,100])?Yt(Le):Ge==Ne[te([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+te([84,114,105,97,108])&&Le[te([111,110])](te([114,101,97,100,121]),()=>{let We=0;Le[te([109,111,100,101,108])][te([111,110])](te([97,112,112,108,121,79,112,101,114,97,116,105,111,110]),(Je,Wt)=>{Wt[0][te([105,115,68,111,99,117,109,101,110,116,79,112,101,114,97,116,105,111,110])]&&We++,We===504&&(Yt(Le),Ze(Ne[te([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+te([84,114,105,97,108,76,105,109,105,116,58,111,112,101,114,97,116,105,111,110,115])),Je[te([111,102,102])]())},{priority:te([104,105,103,104,101,115,116])})})}}function Ze(Ge){const Ne=Bt();return Be[Ne]=Ge,Ge}function Bt(){const Ge=String(window[te([112,101,114,102,111,114,109,97,110,99,101])][te([110,111,119])]())[te([114,101,112,108,97,99,101])](te([46]),"");let Ne="";for(let Le=0;Le<Ge[te([108,101,110,103,116,104])];Le+=2){let We=parseInt(Ge[te([115,117,98,115,116,114,105,110,103])](Le,Le+2));We>=Ue[te([108,101,110,103,116,104])]&&(We-=Ue[te([108,101,110,103,116,104])]),Ne+=Ue[We]}return Ne}function Jt(Ge){for(const Ne of Ge[te([101,100,105,116,111,114,115])])Yt(Ne);Kt(Ge,te([67,111,109,109,101,110,116,115,82,101,112,111,115,105,116,111,114,121]))[te([115,119,105,116,99,104,82,101,97,100,79,110,108,121])](!0),Kt(Ge,te([67,111,109,109,101,110,116,115,82,101,112,111,115,105,116,111,114,121]))[te([115,119,105,116,99,104,82,101,97,100,79,110,108,121])]=en}function Yt(Ge){function Ne(){Ge[te([109,111,100,101,108])][te([99,104,97,110,103,101])]=en,Ge[te([109,111,100,101,108])][te([101,110,113,117,101,117,101,67,104,97,110,103,101])]=en,Ge[te([101,110,97,98,108,101,82,101,97,100,79,110,108,121,77,111,100,101])](te([109,111,100,101,108]))}Ge[te([115,116,97,116,101])]==te([114,101,97,100,121])?Ne():Ge[te([111,110,99,101])](te([114,101,97,100,121]),()=>Ne())}function en(){return null}function sn(Ge,Ne){const Le=!!(Ge&Ne[te([112,101,114,109,105,115,115,105,111,110,77,97,115,107])]),We=hn(Ge,Ne);return Le||We}function hn(Ge,Ne){const Le=(Ne[te([111,112,116,105,111,110,115])]||{})[te([102,103,105])]||null;return!!Le&&Me[te([102,105,108,116,101,114])](We=>Le[te([105,110,99,108,117,100,101,115])](We[te([105,100])]))[te([102,105,108,116,101,114])](We=>!mn(We))[te([115,111,109,101])](We=>!!(Ge&We[te([112,101,114,109,105,115,115,105,111,110,77,97,115,107])]))}function mn(Ge){const Ne={[te([102,111,114,98,105,100,100,101,110,72,97,110,100,108,101,114,70,111,114,68,114,117,112,97,108])]:bn};return!!Ge.forbiddenHandler&&Ne[Ge.forbiddenHandler]()}function bn(){return!window[te([68,114,117,112,97,108])]||!tn(Be,te([100,114,117,112,97,108,80,111,119,101,114,101,100,66,121]))}function gn(Ge){if(!tn(Be,Ge[te([112,108,117,103,105,110,78,97,109,101])]))return!0;const Ne=Ge[te([111,112,116,105,111,110,115])]||{},Le=Ne[te([97,105,119,115,103,105,99])]||!1,We=Ne[te([97,105,116,99,100,103,105,108])]||!1,Je=Ne[te([97,105,114,118,105,105,108])]||!1;return tn(Be,te([87,101,98,83,111,99,107,101,116,71,97,116,101,119,97,121]))&&Kt(Be,te([87,101,98,83,111,99,107,101,116,71,97,116,101,119,97,121]))[te([115,116,97,116,101])]==te([99,111,110,110,101,99,116,101,100])&&Le||tn(Be,te([84,114,97,99,107,67,104,97,110,103,101,115,68,97,116,97,71,101,116,116,101,114]))&&Kt(Be,te([84,114,97,99,107,67,104,97,110,103,101,115,68,97,116,97,71,101,116,116,101,114]))[te([114,101,115,117,108,116])]==te([101,110,100])&&We?!0:!(!tn(Be,te([82,101,118,105,115,105,111,110,86,105,101,119,101,114,73,110,116,101,103,114,97,116,105,111,110]))||Kt(Be,te([82,101,118,105,115,105,111,110,86,105,101,119,101,114,73,110,116,101,103,114,97,116,105,111,110]))[te([114,101,115,117,108,116])]!=te([101,110,100])||!Je)}function tn(Ge,Ne){return Ge[te([112,108,117,103,105,110,115])][te([104,97,115])](Ne)}function Kt(Ge,Ne){return Ge[te([112,108,117,103,105,110,115])][te([103,101,116])](Ne)}function Xt(Ge){let Ne="";for(const Le of Ge)Ne+=String[te([102,114,111,109,67,104,97,114,67,111,100,101])](Le);return Ne}function pn(Ge){const Ne=new Uint8Array(Ge[te([108,101,110,103,116,104])]);for(let Le=0;Le<Ge[te([108,101,110,103,116,104])];Le++)Ne[Le]=Ge[te([99,104,97,114,67,111,100,101,65,116])](Le);return Ne}ze&&qe(Ve(He),ze)})(we)})(this)}_setupMentionConfiguration(){const we=this.editor,t=this.editor.plugins.get("SlashCommandEditing"),te=we.config.get("mention.feeds");te.push({marker:"/",feed:be=>t.getMatchingCommands(be),itemRenderer:this._customItemRenderer.bind(this),dropdownLimit:we.config.get("slashCommand.dropdownLimit")||1/0}),we.config.set("mention.feeds",te)}_overrideMentionExecuteListener(){const we=this.editor;we.commands.get("mention").on("execute",(t,te)=>{const be=te[0],xe=we.model;be.marker==="/"&&xe.change(ve=>{ve.remove(be.range),be.mention.execute(),t.stop()})},{priority:"high"})}_customItemRenderer(we){const t=this.editor.locale,te=new f$1(t,we);return te.render(),te.element}}let m$2=class extends Plugin{static get requires(){return["Mention",e,s]}static get pluginName(){return"SlashCommand"}};class c extends Command{execute(we){const{model:t}=this.editor;let te;switch(typeof we){case"string":te=we;break;case"function":te=we()}typeof te=="string"&&t.change(()=>{const be=this.editor.data.htmlProcessor.toView(te),xe=this.editor.data.toModel(be);t.insertContent(xe)})}}class r extends Plugin{constructor(t){super(t);Re(this,"_licenseKeyCheckInterval");this._licenseKeyCheckInterval=null}static get pluginName(){return"TemplateEditing"}init(){const{editor:t}=this;t.commands.add("insertTemplate",new c(t)),this.licenseKey=t.config.get("licenseKey");const te=this.editor;this._licenseKeyCheckInterval=setInterval(()=>{let be;for(const xe in te){const ve=xe,ke=te[ve];if(ke==="templateLicenseKeyTrial"||ke==="templateLicenseKeyInvalid"||ke==="templateLicenseKeyValid"||ke==="templateLicenseKeyTrialLimit:operations"){delete te[ve],be=ke;break}}if(be==="templateLicenseKeyInvalid")throw clearInterval(this._licenseKeyCheckInterval),new CKEditorError("template-invalid-license-key",null);if(be==="templateLicenseKeyTrial"&&console.info("You are using the trial version of CKEditor 5 template plugin with limited usage. Make sure you will not use it in the production environment."),be==="templateLicenseKeyTrialLimit:operations")throw clearInterval(this._licenseKeyCheckInterval),new CKEditorError("template-trial-license-key-reached-limit-changes",null);be==="templateLicenseKeyValid"&&clearInterval(this._licenseKeyCheckInterval)},1e3)}destroy(){this._licenseKeyCheckInterval&&clearInterval(this._licenseKeyCheckInterval)}}let d$1=class extends ListView{filter(we){if(!we)return this._resetFiltering();const t=new Map,te=this.items.map(be=>{const xe=be.buttonView.isMatching(we);return be.isVisible=!!xe,be.buttonView.highlightText(xe?we:null),xe&&t.set(be,xe),be}).sort(F$1).sort(function(be){return function(xe,ve){const ke=be.get(xe),Ie=be.get(ve);return ke&&!Ie?-1:Ie&&!ke?1:ke||Ie?ke.title&&!Ie.title?-1:!ke.title&&Ie.title?1:0:0}}(t));return this.items.clear(),this.items.addMany(te),{resultsCount:t.size,totalItemsCount:this.items.length}}_resetFiltering(){const we=this.items.map(t=>t).sort(F$1);return we.forEach(t=>{t.isVisible=!0,t.buttonView.highlightText(null)}),this.items.clear(),this.items.addMany(we),{resultsCount:we.length,totalItemsCount:we.length}}};function F$1(Te,we){return Te.originalIndex-we.originalIndex}class b extends ListItemView{constructor(t,te){super(t);Re(this,"originalIndex");Re(this,"buttonView");this.originalIndex=te,this.buttonView=null}}var I=`<svg fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 45 45">
  <path fill="#F0F0F0" d="M2 0h41s2 0 2 2v41s0 2 -2 2h-41s-2 0 -2 -2v-41s0 -2 2 -2" />
  <path fill="#D5D5D5" d="M11 10h10s1 0 1 1v24s0 1 -1 1h-10s-1 0 -1 -1v-24s0 -1 1 -1" />
  <path fill="#D5D5D5" d="M25 10h10s1 0 1 1v10s0 1 -1 1h-10s-1 0 -1 -1v-10s0 -1 1 -1" />
  <path fill="#D5D5D5" d="M25 24h10s1 0 1 1v10s0 1 -1 1h-10s-1 0 -1 -1v-10s0 -1 1 -1" />
</svg>
`;class h extends ButtonView{constructor(t,te){super(t);Re(this,"templateDefinition");Re(this,"textPartView");this.templateDefinition=te,this.textPartView=null;const{icon:be=I}=te;this.set({withText:!0,class:"ck-template-button",role:"option",icon:be}),this.iconView.isColorInherited=!1}render(){super.render(),this.textPartView=new v$1(this.locale,this.templateDefinition,this.labelView.element.id),this.children.remove(this.labelView),this.children.add(this.textPartView)}destroy(){super.destroy(),this.labelView.destroy()}isMatching(t){const{title:te,description:be}=this.templateDefinition,xe=!!te.match(t),ve=!(!be||!be.match(t));return xe||ve?{title:xe,description:ve}:null}highlightText(t){this.textPartView.highlightText(t)}}let v$1=class extends View{constructor(we,t,te){super(we),this.title=t.title,this.description=t.description,this.titleView=new HighlightedTextView,this.titleView.text=this.title,this.titleView.extendTemplate({tag:"span",attributes:{class:["ck-button__label"],id:te}});const be=[this.titleView];this.description&&(this.descriptionView=new HighlightedTextView,this.descriptionView.text=this.description,this.descriptionView.extendTemplate({tag:"p",attributes:{class:["ck-template-form__description"]}}),be.push(this.descriptionView)),this.setTemplate({tag:"div",attributes:{class:["ck","ck-template-form__text-part"]},children:be})}highlightText(we){this.titleView.highlightText(we),this.description&&this.descriptionView.highlightText(we)}};class i extends Plugin{static get pluginName(){return"TemplateUI"}init(){const{editor:we}=this,{t}=we,te=we.config.get("template.definitions")||[];we.ui.componentFactory.add("insertTemplate",be=>{const xe=createDropdown(be),ve=this._createTemplateListView(be,te),ke=new SearchTextView(be,{filteredView:ve,queryView:{label:t("Search template")},class:"ck-template-form",infoView:{text:{notFound:{primary:Ae=>t('No templates were found matching "%0".',Ae),secondary:t("Please try a different phrase or check the spelling.")},noSearchableItems:{primary:t("No templates available.")}}}}),Ie=we.commands.get("insertTemplate");return ke.on("search",(Ae,Se)=>{Se.query&&Se.query.length&&we.ui.ariaLiveAnnouncer.announce(t("%0 templates found",Se.resultsCount))}),xe.bind("isEnabled").to(Ie),xe.panelView.children.add(ke),xe.buttonView.set({label:t("Insert template"),icon:a$9.template,tooltip:!0}),xe.on("change:isOpen",(Ae,Se,Oe)=>{Oe||ke.reset()}),xe}),we.ui.componentFactory.add("menuBar:insertTemplate",be=>{const xe=we.commands.get("insertTemplate"),ve=new MenuBarMenuView(be);ve.buttonView.set({label:t("Template"),icon:a$9.template});const ke=new MenuBarMenuListView(be);if(!te||!te.length){const Ie=new MenuBarMenuListItemView(be,ve),Ae=new MenuBarMenuListItemButtonView(be);Ae.set({label:t("No templates available.")}),Ae.delegate("execute").to(ve),Ae.on("execute",()=>{we.editing.view.focus()}),Ie.children.add(Ae),ke.items.add(Ie)}for(const Ie of te){const Ae=new MenuBarMenuListItemView(be,ve),Se=new MenuBarMenuListItemButtonView(be);Se.set({class:"ck-template-button",label:Ie.title,icon:Ie.icon||I}),Se.delegate("execute").to(ve),Se.on("execute",()=>{we.execute("insertTemplate",Ie.data),we.editing.view.focus()}),Ae.children.add(Se),ke.items.add(Ae)}return ve.panelView.children.add(ke),ve.bind("isEnabled").to(xe,"isEnabled"),ve})}afterInit(){(function(we){function t(be,xe,ve){const ke={};ke[te([110,117,109,98,101,114,79,102,82,111,117,110,100,115])]={16:10,24:12,32:14},ke[te([114,99,111,110])]=[1,2,4,8,16,32,64,128,27,54,108,216,171,77,154,47,94,188,99,198,151,53,106,212,179,125,250,239,197,145],ke[te([83])]=[99,124,119,123,242,107,111,197,48,1,103,43,254,215,171,118,202,130,201,125,250,89,71,240,173,212,162,175,156,164,114,192,183,253,147,38,54,63,247,204,52,165,229,241,113,216,49,21,4,199,35,195,24,150,5,154,7,18,128,226,235,39,178,117,9,131,44,26,27,110,90,160,82,59,214,179,41,227,47,132,83,209,0,237,32,252,177,91,106,203,190,57,74,76,88,207,208,239,170,251,67,77,51,133,69,249,2,127,80,60,159,168,81,163,64,143,146,157,56,245,188,182,218,33,16,255,243,210,205,12,19,236,95,151,68,23,196,167,126,61,100,93,25,115,96,129,79,220,34,42,144,136,70,238,184,20,222,94,11,219,224,50,58,10,73,6,36,92,194,211,172,98,145,149,228,121,231,200,55,109,141,213,78,169,108,86,244,234,101,122,174,8,186,120,37,46,28,166,180,198,232,221,116,31,75,189,139,138,112,62,181,102,72,3,246,14,97,53,87,185,134,193,29,158,225,248,152,17,105,217,142,148,155,30,135,233,206,85,40,223,140,161,137,13,191,230,66,104,65,153,45,15,176,84,187,22],ke[te([84,49])]=[3328402341,4168907908,4000806809,4135287693,4294111757,3597364157,3731845041,2445657428,1613770832,33620227,3462883241,1445669757,3892248089,3050821474,1303096294,3967186586,2412431941,528646813,2311702848,4202528135,4026202645,2992200171,2387036105,4226871307,1101901292,3017069671,1604494077,1169141738,597466303,1403299063,3832705686,2613100635,1974974402,3791519004,1033081774,1277568618,1815492186,2118074177,4126668546,2211236943,1748251740,1369810420,3521504564,4193382664,3799085459,2883115123,1647391059,706024767,134480908,2512897874,1176707941,2646852446,806885416,932615841,168101135,798661301,235341577,605164086,461406363,3756188221,3454790438,1311188841,2142417613,3933566367,302582043,495158174,1479289972,874125870,907746093,3698224818,3025820398,1537253627,2756858614,1983593293,3084310113,2108928974,1378429307,3722699582,1580150641,327451799,2790478837,3117535592,0,3253595436,1075847264,3825007647,2041688520,3059440621,3563743934,2378943302,1740553945,1916352843,2487896798,2555137236,2958579944,2244988746,3151024235,3320835882,1336584933,3992714006,2252555205,2588757463,1714631509,293963156,2319795663,3925473552,67240454,4269768577,2689618160,2017213508,631218106,1269344483,2723238387,1571005438,2151694528,93294474,1066570413,563977660,1882732616,4059428100,1673313503,2008463041,2950355573,1109467491,537923632,3858759450,4260623118,3218264685,2177748300,403442708,638784309,3287084079,3193921505,899127202,2286175436,773265209,2479146071,1437050866,4236148354,2050833735,3362022572,3126681063,840505643,3866325909,3227541664,427917720,2655997905,2749160575,1143087718,1412049534,999329963,193497219,2353415882,3354324521,1807268051,672404540,2816401017,3160301282,369822493,2916866934,3688947771,1681011286,1949973070,336202270,2454276571,201721354,1210328172,3093060836,2680341085,3184776046,1135389935,3294782118,965841320,831886756,3554993207,4068047243,3588745010,2345191491,1849112409,3664604599,26054028,2983581028,2622377682,1235855840,3630984372,2891339514,4092916743,3488279077,3395642799,4101667470,1202630377,268961816,1874508501,4034427016,1243948399,1546530418,941366308,1470539505,1941222599,2546386513,3421038627,2715671932,3899946140,1042226977,2521517021,1639824860,227249030,260737669,3765465232,2084453954,1907733956,3429263018,2420656344,100860677,4160157185,470683154,3261161891,1781871967,2924959737,1773779408,394692241,2579611992,974986535,664706745,3655459128,3958962195,731420851,571543859,3530123707,2849626480,126783113,865375399,765172662,1008606754,361203602,3387549984,2278477385,2857719295,1344809080,2782912378,59542671,1503764984,160008576,437062935,1707065306,3622233649,2218934982,3496503480,2185314755,697932208,1512910199,504303377,2075177163,2824099068,1841019862,739644986],ke[te([84,50])]=[2781242211,2230877308,2582542199,2381740923,234877682,3184946027,2984144751,1418839493,1348481072,50462977,2848876391,2102799147,434634494,1656084439,3863849899,2599188086,1167051466,2636087938,1082771913,2281340285,368048890,3954334041,3381544775,201060592,3963727277,1739838676,4250903202,3930435503,3206782108,4149453988,2531553906,1536934080,3262494647,484572669,2923271059,1783375398,1517041206,1098792767,49674231,1334037708,1550332980,4098991525,886171109,150598129,2481090929,1940642008,1398944049,1059722517,201851908,1385547719,1699095331,1587397571,674240536,2704774806,252314885,3039795866,151914247,908333586,2602270848,1038082786,651029483,1766729511,3447698098,2682942837,454166793,2652734339,1951935532,775166490,758520603,3000790638,4004797018,4217086112,4137964114,1299594043,1639438038,3464344499,2068982057,1054729187,1901997871,2534638724,4121318227,1757008337,0,750906861,1614815264,535035132,3363418545,3988151131,3201591914,1183697867,3647454910,1265776953,3734260298,3566750796,3903871064,1250283471,1807470800,717615087,3847203498,384695291,3313910595,3617213773,1432761139,2484176261,3481945413,283769337,100925954,2180939647,4037038160,1148730428,3123027871,3813386408,4087501137,4267549603,3229630528,2315620239,2906624658,3156319645,1215313976,82966005,3747855548,3245848246,1974459098,1665278241,807407632,451280895,251524083,1841287890,1283575245,337120268,891687699,801369324,3787349855,2721421207,3431482436,959321879,1469301956,4065699751,2197585534,1199193405,2898814052,3887750493,724703513,2514908019,2696962144,2551808385,3516813135,2141445340,1715741218,2119445034,2872807568,2198571144,3398190662,700968686,3547052216,1009259540,2041044702,3803995742,487983883,1991105499,1004265696,1449407026,1316239930,504629770,3683797321,168560134,1816667172,3837287516,1570751170,1857934291,4014189740,2797888098,2822345105,2754712981,936633572,2347923833,852879335,1133234376,1500395319,3084545389,2348912013,1689376213,3533459022,3762923945,3034082412,4205598294,133428468,634383082,2949277029,2398386810,3913789102,403703816,3580869306,2297460856,1867130149,1918643758,607656988,4049053350,3346248884,1368901318,600565992,2090982877,2632479860,557719327,3717614411,3697393085,2249034635,2232388234,2430627952,1115438654,3295786421,2865522278,3633334344,84280067,33027830,303828494,2747425121,1600795957,4188952407,3496589753,2434238086,1486471617,658119965,3106381470,953803233,334231800,3005978776,857870609,3151128937,1890179545,2298973838,2805175444,3056442267,574365214,2450884487,550103529,1233637070,4289353045,2018519080,2057691103,2399374476,4166623649,2148108681,387583245,3664101311,836232934,3330556482,3100665960,3280093505,2955516313,2002398509,287182607,3413881008,4238890068,3597515707,975967766],ke[te([84,51])]=[1671808611,2089089148,2006576759,2072901243,4061003762,1807603307,1873927791,3310653893,810573872,16974337,1739181671,729634347,4263110654,3613570519,2883997099,1989864566,3393556426,2191335298,3376449993,2106063485,4195741690,1508618841,1204391495,4027317232,2917941677,3563566036,2734514082,2951366063,2629772188,2767672228,1922491506,3227229120,3082974647,4246528509,2477669779,644500518,911895606,1061256767,4144166391,3427763148,878471220,2784252325,3845444069,4043897329,1905517169,3631459288,827548209,356461077,67897348,3344078279,593839651,3277757891,405286936,2527147926,84871685,2595565466,118033927,305538066,2157648768,3795705826,3945188843,661212711,2999812018,1973414517,152769033,2208177539,745822252,439235610,455947803,1857215598,1525593178,2700827552,1391895634,994932283,3596728278,3016654259,695947817,3812548067,795958831,2224493444,1408607827,3513301457,0,3979133421,543178784,4229948412,2982705585,1542305371,1790891114,3410398667,3201918910,961245753,1256100938,1289001036,1491644504,3477767631,3496721360,4012557807,2867154858,4212583931,1137018435,1305975373,861234739,2241073541,1171229253,4178635257,33948674,2139225727,1357946960,1011120188,2679776671,2833468328,1374921297,2751356323,1086357568,2408187279,2460827538,2646352285,944271416,4110742005,3168756668,3066132406,3665145818,560153121,271589392,4279952895,4077846003,3530407890,3444343245,202643468,322250259,3962553324,1608629855,2543990167,1154254916,389623319,3294073796,2817676711,2122513534,1028094525,1689045092,1575467613,422261273,1939203699,1621147744,2174228865,1339137615,3699352540,577127458,712922154,2427141008,2290289544,1187679302,3995715566,3100863416,339486740,3732514782,1591917662,186455563,3681988059,3762019296,844522546,978220090,169743370,1239126601,101321734,611076132,1558493276,3260915650,3547250131,2901361580,1655096418,2443721105,2510565781,3828863972,2039214713,3878868455,3359869896,928607799,1840765549,2374762893,3580146133,1322425422,2850048425,1823791212,1459268694,4094161908,3928346602,1706019429,2056189050,2934523822,135794696,3134549946,2022240376,628050469,779246638,472135708,2800834470,3032970164,3327236038,3894660072,3715932637,1956440180,522272287,1272813131,3185336765,2340818315,2323976074,1888542832,1044544574,3049550261,1722469478,1222152264,50660867,4127324150,236067854,1638122081,895445557,1475980887,3117443513,2257655686,3243809217,489110045,2662934430,3778599393,4162055160,2561878936,288563729,1773916777,3648039385,2391345038,2493985684,2612407707,505560094,2274497927,3911240169,3460925390,1442818645,678973480,3749357023,2358182796,2717407649,2306869641,219617805,3218761151,3862026214,1120306242,1756942440,1103331905,2578459033,762796589,252780047,2966125488,1425844308,3151392187,372911126],ke[te([84,52])]=[1667474886,2088535288,2004326894,2071694838,4075949567,1802223062,1869591006,3318043793,808472672,16843522,1734846926,724270422,4278065639,3621216949,2880169549,1987484396,3402253711,2189597983,3385409673,2105378810,4210693615,1499065266,1195886990,4042263547,2913856577,3570689971,2728590687,2947541573,2627518243,2762274643,1920112356,3233831835,3082273397,4261223649,2475929149,640051788,909531756,1061110142,4160160501,3435941763,875846760,2779116625,3857003729,4059105529,1903268834,3638064043,825316194,353713962,67374088,3351728789,589522246,3284360861,404236336,2526454071,84217610,2593830191,117901582,303183396,2155911963,3806477791,3958056653,656894286,2998062463,1970642922,151591698,2206440989,741110872,437923380,454765878,1852748508,1515908788,2694904667,1381168804,993742198,3604373943,3014905469,690584402,3823320797,791638366,2223281939,1398011302,3520161977,0,3991743681,538992704,4244381667,2981218425,1532751286,1785380564,3419096717,3200178535,960056178,1246420628,1280103576,1482221744,3486468741,3503319995,4025428677,2863326543,4227536621,1128514950,1296947098,859002214,2240123921,1162203018,4193849577,33687044,2139062782,1347481760,1010582648,2678045221,2829640523,1364325282,2745433693,1077985408,2408548869,2459086143,2644360225,943212656,4126475505,3166494563,3065430391,3671750063,555836226,269496352,4294908645,4092792573,3537006015,3452783745,202118168,320025894,3974901699,1600119230,2543297077,1145359496,387397934,3301201811,2812801621,2122220284,1027426170,1684319432,1566435258,421079858,1936954854,1616945344,2172753945,1330631070,3705438115,572679748,707427924,2425400123,2290647819,1179044492,4008585671,3099120491,336870440,3739122087,1583276732,185277718,3688593069,3772791771,842159716,976899700,168435220,1229577106,101059084,606366792,1549591736,3267517855,3553849021,2897014595,1650632388,2442242105,2509612081,3840161747,2038008818,3890688725,3368567691,926374254,1835907034,2374863873,3587531953,1313788572,2846482505,1819063512,1448540844,4109633523,3941213647,1701162954,2054852340,2930698567,134748176,3132806511,2021165296,623210314,774795868,471606328,2795958615,3031746419,3334885783,3907527627,3722280097,1953799400,522133822,1263263126,3183336545,2341176845,2324333839,1886425312,1044267644,3048588401,1718004428,1212733584,50529542,4143317495,235803164,1633788866,892690282,1465383342,3115962473,2256965911,3250673817,488449850,2661202215,3789633753,4177007595,2560144171,286339874,1768537042,3654906025,2391705863,2492770099,2610673197,505291324,2273808917,3924369609,3469625735,1431699370,673740880,3755965093,2358021891,2711746649,2307489801,218961690,3217021541,3873845719,1111672452,1751693520,1094828930,2576986153,757954394,252645662,2964376443,1414855848,3149649517,370555436],ke[te([85,49])]=[0,235474187,470948374,303765277,941896748,908933415,607530554,708780849,1883793496,2118214995,1817866830,1649639237,1215061108,1181045119,1417561698,1517767529,3767586992,4003061179,4236429990,4069246893,3635733660,3602770327,3299278474,3400528769,2430122216,2664543715,2362090238,2193862645,2835123396,2801107407,3035535058,3135740889,3678124923,3576870512,3341394285,3374361702,3810496343,3977675356,4279080257,4043610186,2876494627,2776292904,3076639029,3110650942,2472011535,2640243204,2403728665,2169303058,1001089995,899835584,666464733,699432150,59727847,226906860,530400753,294930682,1273168787,1172967064,1475418501,1509430414,1942435775,2110667444,1876241833,1641816226,2910219766,2743034109,2976151520,3211623147,2505202138,2606453969,2302690252,2269728455,3711829422,3543599269,3240894392,3475313331,3843699074,3943906441,4178062228,4144047775,1306967366,1139781709,1374988112,1610459739,1975683434,2076935265,1775276924,1742315127,1034867998,866637845,566021896,800440835,92987698,193195065,429456164,395441711,1984812685,2017778566,1784663195,1683407248,1315562145,1080094634,1383856311,1551037884,101039829,135050206,437757123,337553864,1042385657,807962610,573804783,742039012,2531067453,2564033334,2328828971,2227573024,2935566865,2700099354,3001755655,3168937228,3868552805,3902563182,4203181171,4102977912,3736164937,3501741890,3265478751,3433712980,1106041591,1340463100,1576976609,1408749034,2043211483,2009195472,1708848333,1809054150,832877231,1068351396,766945465,599762354,159417987,126454664,361929877,463180190,2709260871,2943682380,3178106961,3009879386,2572697195,2538681184,2236228733,2336434550,3509871135,3745345300,3441850377,3274667266,3910161971,3877198648,4110568485,4211818798,2597806476,2497604743,2261089178,2295101073,2733856160,2902087851,3202437046,2968011453,3936291284,3835036895,4136440770,4169408201,3535486456,3702665459,3467192302,3231722213,2051518780,1951317047,1716890410,1750902305,1113818384,1282050075,1584504582,1350078989,168810852,67556463,371049330,404016761,841739592,1008918595,775550814,540080725,3969562369,3801332234,4035489047,4269907996,3569255213,3669462566,3366754619,3332740144,2631065433,2463879762,2160117071,2395588676,2767645557,2868897406,3102011747,3069049960,202008497,33778362,270040487,504459436,875451293,975658646,675039627,641025152,2084704233,1917518562,1615861247,1851332852,1147550661,1248802510,1484005843,1451044056,933301370,967311729,733156972,632953703,260388950,25965917,328671808,496906059,1206477858,1239443753,1543208500,1441952575,2144161806,1908694277,1675577880,1842759443,3610369226,3644379585,3408119516,3307916247,4011190502,3776767469,4077384432,4245618683,2809771154,2842737049,3144396420,3043140495,2673705150,2438237621,2203032232,2370213795],ke[te([85,50])]=[0,185469197,370938394,487725847,741876788,657861945,975451694,824852259,1483753576,1400783205,1315723890,1164071807,1950903388,2135319889,1649704518,1767536459,2967507152,3152976349,2801566410,2918353863,2631447780,2547432937,2328143614,2177544179,3901806776,3818836405,4270639778,4118987695,3299409036,3483825537,3535072918,3652904859,2077965243,1893020342,1841768865,1724457132,1474502543,1559041666,1107234197,1257309336,598438867,681933534,901210569,1052338372,261314535,77422314,428819965,310463728,3409685355,3224740454,3710368113,3593056380,3875770207,3960309330,4045380933,4195456072,2471224067,2554718734,2237133081,2388260884,3212035895,3028143674,2842678573,2724322336,4138563181,4255350624,3769721975,3955191162,3667219033,3516619604,3431546947,3347532110,2933734917,2782082824,3099667487,3016697106,2196052529,2313884476,2499348523,2683765030,1179510461,1296297904,1347548327,1533017514,1786102409,1635502980,2087309459,2003294622,507358933,355706840,136428751,53458370,839224033,957055980,605657339,790073846,2373340630,2256028891,2607439820,2422494913,2706270690,2856345839,3075636216,3160175349,3573941694,3725069491,3273267108,3356761769,4181598602,4063242375,4011996048,3828103837,1033297158,915985419,730517276,545572369,296679730,446754879,129166120,213705253,1709610350,1860738147,1945798516,2029293177,1239331162,1120974935,1606591296,1422699085,4148292826,4233094615,3781033664,3931371469,3682191598,3497509347,3446004468,3328955385,2939266226,2755636671,3106780840,2988687269,2198438022,2282195339,2501218972,2652609425,1201765386,1286567175,1371368976,1521706781,1805211710,1620529459,2105887268,1988838185,533804130,350174575,164439672,46346101,870912086,954669403,636813900,788204353,2358957921,2274680428,2592523643,2441661558,2695033685,2880240216,3065962831,3182487618,3572145929,3756299780,3270937875,3388507166,4174560061,4091327024,4006521127,3854606378,1014646705,930369212,711349675,560487590,272786309,457992840,106852767,223377554,1678381017,1862534868,1914052035,2031621326,1211247597,1128014560,1580087799,1428173050,32283319,182621114,401639597,486441376,768917123,651868046,1003007129,818324884,1503449823,1385356242,1333838021,1150208456,1973745387,2125135846,1673061617,1756818940,2970356327,3120694122,2802849917,2887651696,2637442643,2520393566,2334669897,2149987652,3917234703,3799141122,4284502037,4100872472,3309594171,3460984630,3545789473,3629546796,2050466060,1899603969,1814803222,1730525723,1443857720,1560382517,1075025698,1260232239,575138148,692707433,878443390,1062597235,243256656,91341917,409198410,325965383,3403100636,3252238545,3704300486,3620022987,3874428392,3990953189,4042459122,4227665663,2460449204,2578018489,2226875310,2411029155,3198115200,3046200461,2827177882,2743944855],ke[te([85,51])]=[0,218828297,437656594,387781147,875313188,958871085,775562294,590424639,1750626376,1699970625,1917742170,2135253587,1551124588,1367295589,1180849278,1265195639,3501252752,3720081049,3399941250,3350065803,3835484340,3919042237,4270507174,4085369519,3102249176,3051593425,2734591178,2952102595,2361698556,2177869557,2530391278,2614737639,3145456443,3060847922,2708326185,2892417312,2404901663,2187128086,2504130317,2555048196,3542330227,3727205754,3375740769,3292445032,3876557655,3926170974,4246310725,4027744588,1808481195,1723872674,1910319033,2094410160,1608975247,1391201670,1173430173,1224348052,59984867,244860394,428169201,344873464,935293895,984907214,766078933,547512796,1844882806,1627235199,2011214180,2062270317,1507497298,1423022939,1137477952,1321699145,95345982,145085239,532201772,313773861,830661914,1015671571,731183368,648017665,3175501286,2957853679,2807058932,2858115069,2305455554,2220981195,2474404304,2658625497,3575528878,3625268135,3473416636,3254988725,3778151818,3963161475,4213447064,4130281361,3599595085,3683022916,3432737375,3247465558,3802222185,4020912224,4172763771,4122762354,3201631749,3017672716,2764249623,2848461854,2331590177,2280796200,2431590963,2648976442,104699613,188127444,472615631,287343814,840019705,1058709744,671593195,621591778,1852171925,1668212892,1953757831,2037970062,1514790577,1463996600,1080017571,1297403050,3673637356,3623636965,3235995134,3454686199,4007360968,3822090177,4107101658,4190530515,2997825956,3215212461,2830708150,2779915199,2256734592,2340947849,2627016082,2443058075,172466556,122466165,273792366,492483431,1047239e3,861968209,612205898,695634755,1646252340,1863638845,2013908262,1963115311,1446242576,1530455833,1277555970,1093597963,1636604631,1820824798,2073724613,1989249228,1436590835,1487645946,1337376481,1119727848,164948639,81781910,331544205,516552836,1039717051,821288114,669961897,719700128,2973530695,3157750862,2871682645,2787207260,2232435299,2283490410,2667994737,2450346104,3647212047,3564045318,3279033885,3464042516,3980931627,3762502690,4150144569,4199882800,3070356634,3121275539,2904027272,2686254721,2200818878,2384911031,2570832044,2486224549,3747192018,3528626907,3310321856,3359936201,3950355702,3867060991,4049844452,4234721005,1739656202,1790575107,2108100632,1890328081,1402811438,1586903591,1233856572,1149249077,266959938,48394827,369057872,418672217,1002783846,919489135,567498868,752375421,209336225,24197544,376187827,459744698,945164165,895287692,574624663,793451934,1679968233,1764313568,2117360635,1933530610,1343127501,1560637892,1243112415,1192455638,3704280881,3519142200,3336358691,3419915562,3907448597,3857572124,4075877127,4294704398,3029510009,3113855344,2927934315,2744104290,2159976285,2377486676,2594734927,2544078150],ke[te([85,52])]=[0,151849742,303699484,454499602,607398968,758720310,908999204,1059270954,1214797936,1097159550,1517440620,1400849762,1817998408,1699839814,2118541908,2001430874,2429595872,2581445614,2194319100,2345119218,3034881240,3186202582,2801699524,2951971274,3635996816,3518358430,3399679628,3283088770,4237083816,4118925222,4002861748,3885750714,1002142683,850817237,698445255,548169417,529487843,377642221,227885567,77089521,1943217067,2061379749,1640576439,1757691577,1474760595,1592394909,1174215055,1290801793,2875968315,2724642869,3111247143,2960971305,2405426947,2253581325,2638606623,2487810577,3808662347,3926825029,4044981591,4162096729,3342319475,3459953789,3576539503,3693126241,1986918061,2137062819,1685577905,1836772287,1381620373,1532285339,1078185097,1229899655,1040559837,923313619,740276417,621982671,439452389,322734571,137073913,19308535,3871163981,4021308739,4104605777,4255800159,3263785589,3414450555,3499326569,3651041127,2933202493,2815956275,3167684641,3049390895,2330014213,2213296395,2566595609,2448830231,1305906550,1155237496,1607244650,1455525988,1776460110,1626319424,2079897426,1928707164,96392454,213114376,396673818,514443284,562755902,679998e3,865136418,983426092,3708173718,3557504664,3474729866,3323011204,4180808110,4030667424,3945269170,3794078908,2507040230,2623762152,2272556026,2390325492,2975484382,3092726480,2738905026,2857194700,3973773121,3856137295,4274053469,4157467219,3371096953,3252932727,3673476453,3556361835,2763173681,2915017791,3064510765,3215307299,2156299017,2307622919,2459735317,2610011675,2081048481,1963412655,1846563261,1729977011,1480485785,1362321559,1243905413,1126790795,878845905,1030690015,645401037,796197571,274084841,425408743,38544885,188821243,3613494426,3731654548,3313212038,3430322568,4082475170,4200115116,3780097726,3896688048,2668221674,2516901860,2366882550,2216610296,3141400786,2989552604,2837966542,2687165888,1202797690,1320957812,1437280870,1554391400,1669664834,1787304780,1906247262,2022837584,265905162,114585348,499347990,349075736,736970802,585122620,972512814,821712160,2595684844,2478443234,2293045232,2174754046,3196267988,3079546586,2895723464,2777952454,3537852828,3687994002,3234156416,3385345166,4142626212,4293295786,3841024952,3992742070,174567692,57326082,410887952,292596766,777231668,660510266,1011452712,893681702,1108339068,1258480242,1343618912,1494807662,1715193156,1865862730,1948373848,2100090966,2701949495,2818666809,3004591147,3122358053,2235061775,2352307457,2535604243,2653899549,3915653703,3764988233,4219352155,4067639125,3444575871,3294430577,3746175075,3594982253,836553431,953270745,600235211,718002117,367585007,484830689,133361907,251657213,2041877159,1891211689,1806599355,1654886325,1568718495,1418573201,1335535747,1184342925];const Ie=new Uint8Array(16);for(let Ue=15;Ue>=0;--Ue)Ie[Ue]=ve%256,ve=parseInt(ve/256);let Ae=null,Se=16;const Oe=new Uint8Array(xe),Ve=[],Me=[];$e();for(let Ue=0;Ue<be[te([108,101,110,103,116,104])];Ue++)Se===16&&(Ae=Be(Ie),Se=0,Fe(Ie)),be[Ue]^=Ae[Se++];return be;function De(Ue){const He=[];for(let ze=0;ze<Ue[te([108,101,110,103,116,104])];ze+=4)He[te([112,117,115,104])](Ue[ze]<<24|Ue[ze+1]<<16|Ue[ze+2]<<8|Ue[ze+3]);return He}function Fe(Ue){for(let He=15;He>=0;He--){if(Ue[He]!==255){Ue[He]++;break}Ue[He]=0}}function Be(Ue){const He=Ve[te([108,101,110,103,116,104])]-1,ze=[0,0,0,0];let qe=De(Ue);for(let je=0;je<4;je++)qe[je]^=Ve[0][je];for(let je=1;je<He;je++){for(let Ye=0;Ye<4;Ye++)ze[Ye]=ke[te([84,49])][qe[Ye]>>24&255]^ke[te([84,50])][qe[(Ye+1)%4]>>16&255]^ke[te([84,51])][qe[(Ye+2)%4]>>8&255]^ke[te([84,52])][255&qe[(Ye+3)%4]]^Ve[je][Ye];qe=ze[te([115,108,105,99,101])]()}const Ke=new Uint8Array(16);let Qe;for(let je=0;je<4;je++)Qe=Ve[He][je],Ke[4*je]=255&(ke[te([83])][qe[je]>>24&255]^Qe>>24),Ke[4*je+1]=255&(ke[te([83])][qe[(je+1)%4]>>16&255]^Qe>>16),Ke[4*je+2]=255&(ke[te([83])][qe[(je+2)%4]>>8&255]^Qe>>8),Ke[4*je+3]=255&(ke[te([83])][255&qe[(je+3)%4]]^Qe);return Ke}function $e(){const Ue=ke[te([110,117,109,98,101,114,79,102,82,111,117,110,100,115])][Oe[te([108,101,110,103,116,104])]];for(let ht=0;ht<=Ue;ht++)Ve[te([112,117,115,104])]([0,0,0,0]),Me[te([112,117,115,104])]([0,0,0,0]);const He=4*(Ue+1),ze=Oe[te([108,101,110,103,116,104])]/4,qe=De(Oe);let Ke;for(let ht=0;ht<ze;ht++)Ke=ht>>2,Ve[Ke][ht%4]=qe[ht],Me[Ue-Ke][ht%4]=qe[ht];let Qe,je=0,Ye=ze;for(;Ye<He;){Qe=qe[ze-1],qe[0]^=ke[te([83])][Qe>>16&255]<<24^ke[te([83])][Qe>>8&255]<<16^ke[te([83])][255&Qe]<<8^ke[te([83])][Qe>>24&255]^ke[te([114,99,111,110])][je]<<24,je+=1;for(let Jt=1;Jt<ze/2;Jt++)qe[Jt]^=qe[Jt-1];Qe=qe[ze/2-1],qe[ze/2]^=ke[te([83])][255&Qe]^ke[te([83])][Qe>>8&255]<<8^ke[te([83])][Qe>>16&255]<<16^ke[te([83])][Qe>>24&255]<<24;for(let Jt=ze/2+1;Jt<ze;Jt++)qe[Jt]^=qe[Jt-1];let ht,Ze,Bt=0;for(;Bt<ze&&Ye<He;)ht=Ye>>2,Ze=Ye%4,Ve[ht][Ze]=qe[Bt],Me[Ue-ht][Ze]=qe[Bt++],Ye++}for(let ht=1;ht<Ue;ht++)for(let Ze=0;Ze<4;Ze++)Qe=Me[ht][Ze],Me[ht][Ze]=ke[te([85,49])][Qe>>24&255]^ke[te([85,50])][Qe>>16&255]^ke[te([85,51])][Qe>>8&255]^ke[te([85,52])][255&Qe]}}function te(be){return be.map(xe=>String.fromCharCode(xe)).join("")}(be=>{function xe(){const Ge=[{[te([105,100])]:1,[te([102,101,97,116,117,114,101,78,97,109,101])]:te([67,111,109,109,101,110,116,115]),[te([112,108,117,103,105,110,78,97,109,101])]:te([67,111,109,109,101,110,116,115,82,101,112,111,115,105,116,111,114,121]),[te([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:te([108,105,99,101,110,115,101,75,101,121]),[te([104,97,110,100,108,101,114])]:te([99,104,101,99,107,76,105,99,101,110,115,101]),[te([99,104,101,99,107,65,108,115,111])]:[{[te([105,100])]:2,[te([102,101,97,116,117,114,101,78,97,109,101])]:te([84,114,97,99,107,32,67,104,97,110,103,101,115]),[te([112,108,117,103,105,110,78,97,109,101])]:te([84,114,97,99,107,67,104,97,110,103,101,115,69,100,105,116,105,110,103]),[te([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:te([108,105,99,101,110,115,101,75,101,121]),[te([104,97,110,100,108,101,114])]:te([99,104,101,99,107,76,105,99,101,110,115,101,70,111,114,84,114,97,99,107,67,104,97,110,103,101,115]),[te([111,112,116,105,111,110,115])]:{[te([97,105,119,115,103,105,99])]:!0,[te([97,105,116,99,100,103,105,108])]:!0,[te([97,105,114,118,105,105,108])]:!0}}],[te([111,112,116,105,111,110,115])]:{[te([97,105,119,115,103,105,99])]:!0,[te([97,105,116,99,100,103,105,108])]:!0,[te([97,105,114,118,105,105,108])]:!0}},{[te([105,100])]:3,[te([102,101,97,116,117,114,101,78,97,109,101])]:te([80,97,103,105,110,97,116,105,111,110]),[te([112,108,117,103,105,110,78,97,109,101])]:te([80,97,103,105,110,97,116,105,111,110,76,111,111,107,117,112]),[te([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:te([112,97,103,105,110,97,116,105,111,110,76,105,99,101,110,115,101,75,101,121]),[te([104,97,110,100,108,101,114])]:te([99,104,101,99,107,76,105,99,101,110,115,101])},{[te([105,100])]:4,[te([102,101,97,116,117,114,101,78,97,109,101])]:te([82,101,118,105,115,105,111,110,32,72,105,115,116,111,114,121]),[te([112,108,117,103,105,110,78,97,109,101])]:te([82,101,118,105,115,105,111,110,115,82,101,112,111,115,105,116,111,114,121]),[te([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:te([108,105,99,101,110,115,101,75,101,121]),[te([104,97,110,100,108,101,114])]:te([99,104,101,99,107,76,105,99,101,110,115,101,70,111,114,82,101,118,105,115,105,111,110,72,105,115,116,111,114,121]),[te([111,112,116,105,111,110,115])]:{[te([97,105,119,115,103,105,99])]:!0,[te([97,105,116,99,100,103,105,108])]:!0,[te([97,105,114,118,105,105,108])]:!0}},{[te([105,100])]:5,[te([102,101,97,116,117,114,101,78,97,109,101])]:te([68,111,99,117,109,101,110,116,32,79,117,116,108,105,110,101]),[te([112,108,117,103,105,110,78,97,109,101])]:te([68,111,99,117,109,101,110,116,79,117,116,108,105,110,101,85,73]),[te([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:te([100,111,99,117,109,101,110,116,79,117,116,108,105,110,101,76,105,99,101,110,115,101,75,101,121]),[te([104,97,110,100,108,101,114])]:te([99,104,101,99,107,76,105,99,101,110,115,101]),[te([111,112,116,105,111,110,115])]:{[te([102,103,105])]:[12]}},{[te([105,100])]:6,[te([102,101,97,116,117,114,101,78,97,109,101])]:te([70,111,114,109,97,116,32,80,97,105,110,116,101,114]),[te([112,108,117,103,105,110,78,97,109,101])]:te([70,111,114,109,97,116,80,97,105,110,116,101,114,85,73]),[te([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:te([102,111,114,109,97,116,80,97,105,110,116,101,114,76,105,99,101,110,115,101,75,101,121]),[te([104,97,110,100,108,101,114])]:te([99,104,101,99,107,76,105,99,101,110,115,101]),[te([111,112,116,105,111,110,115])]:{[te([102,103,105])]:[12]}},{[te([105,100])]:7,[te([102,101,97,116,117,114,101,78,97,109,101])]:te([83,108,97,115,104,32,67,111,109,109,97,110,100]),[te([112,108,117,103,105,110,78,97,109,101])]:te([83,108,97,115,104,67,111,109,109,97,110,100,85,73]),[te([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:te([115,108,97,115,104,67,111,109,109,97,110,100,76,105,99,101,110,115,101,75,101,121]),[te([104,97,110,100,108,101,114])]:te([99,104,101,99,107,76,105,99,101,110,115,101]),[te([111,112,116,105,111,110,115])]:{[te([102,103,105])]:[12]}},{[te([105,100])]:8,[te([102,101,97,116,117,114,101,78,97,109,101])]:te([84,97,98,108,101,32,111,102,32,67,111,110,116,101,110,116,115]),[te([112,108,117,103,105,110,78,97,109,101])]:te([84,97,98,108,101,79,102,67,111,110,116,101,110,116,115,69,100,105,116,105,110,103]),[te([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:te([116,97,98,108,101,79,102,67,111,110,116,101,110,116,115,76,105,99,101,110,115,101,75,101,121]),[te([104,97,110,100,108,101,114])]:te([99,104,101,99,107,76,105,99,101,110,115,101]),[te([111,112,116,105,111,110,115])]:{[te([102,103,105])]:[12]}},{[te([105,100])]:9,[te([102,101,97,116,117,114,101,78,97,109,101])]:te([84,101,109,112,108,97,116,101]),[te([112,108,117,103,105,110,78,97,109,101])]:te([84,101,109,112,108,97,116,101,85,73]),[te([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:te([116,101,109,112,108,97,116,101,76,105,99,101,110,115,101,75,101,121]),[te([104,97,110,100,108,101,114])]:te([99,104,101,99,107,76,105,99,101,110,115,101]),[te([111,112,116,105,111,110,115])]:{[te([102,103,105])]:[12,14]}},{[te([105,100])]:10,[te([102,101,97,116,117,114,101,78,97,109,101])]:te([80,97,115,116,101,32,102,114,111,109,32,79,102,102,105,99,101,32,69,110,104,97,110,99,101,100]),[te([112,108,117,103,105,110,78,97,109,101])]:te([80,97,115,116,101,70,114,111,109,79,102,102,105,99,101,69,110,104,97,110,99,101,100,73,110,108,105,110,101,114]),[te([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:te([112,97,115,116,101,70,114,111,109,79,102,102,105,99,101,69,110,104,97,110,99,101,100,76,105,99,101,110,115,101,75,101,121]),[te([104,97,110,100,108,101,114])]:te([99,104,101,99,107,76,105,99,101,110,115,101]),[te([111,112,116,105,111,110,115])]:{[te([102,103,105])]:[12]}},{[te([105,100])]:11,[te([102,101,97,116,117,114,101,78,97,109,101])]:te([65,73,32,65,115,115,105,115,116,97,110,116]),[te([112,108,117,103,105,110,78,97,109,101])]:te([65,73,65,115,115,105,115,116,97,110,116,85,73]),[te([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:te([97,105,76,105,99,101,110,115,101,75,101,121]),[te([104,97,110,100,108,101,114])]:te([99,104,101,99,107,76,105,99,101,110,115,101])},{[te([105,100])]:12,[te([102,101,97,116,117,114,101,78,97,109,101])]:te([80,114,111,100,117,99,116,105,118,105,116,121,32,112,97,99,107])},{[te([105,100])]:13,[te([102,101,97,116,117,114,101,78,97,109,101])]:te([67,97,115,101,32,67,104,97,110,103,101]),[te([112,108,117,103,105,110,78,97,109,101])]:te([67,97,115,101,67,104,97,110,103,101,85,73]),[te([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:te([99,97,115,101,67,104,97,110,103,101,76,105,99,101,110,115,101,75,101,121]),[te([104,97,110,100,108,101,114])]:te([99,104,101,99,107,76,105,99,101,110,115,101]),[te([111,112,116,105,111,110,115])]:{[te([102,103,105])]:[12]}},{[te([105,100])]:14,[te([102,101,97,116,117,114,101,78,97,109,101])]:te([68,114,117,112,97,108,32,112,97,99,107]),[te([102,111,114,98,105,100,100,101,110,72,97,110,100,108,101,114])]:te([102,111,114,98,105,100,100,101,110,72,97,110,100,108,101,114,70,111,114,68,114,117,112,97,108])},{[te([105,100])]:15,[te([102,101,97,116,117,114,101,78,97,109,101])]:te([77,117,108,116,105,32,76,101,118,101,108,32,76,105,115,116]),[te([112,108,117,103,105,110,78,97,109,101])]:te([77,117,108,116,105,76,101,118,101,108,76,105,115,116,69,100,105,116,105,110,103]),[te([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:te([109,117,108,116,105,76,101,118,101,108,76,105,115,116,76,105,99,101,110,115,101,75,101,121]),[te([104,97,110,100,108,101,114])]:te([99,104,101,99,107,76,105,99,101,110,115,101])},{[te([105,100])]:16,[te([102,101,97,116,117,114,101,78,97,109,101])]:te([77,101,114,103,101,32,70,105,101,108,100,115]),[te([112,108,117,103,105,110,78,97,109,101])]:te([77,101,114,103,101,70,105,101,108,100,115,85,73]),[te([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:te([109,101,114,103,101,70,105,101,108,100,115,76,105,99,101,110,115,101,75,101,121]),[te([104,97,110,100,108,101,114])]:te([99,104,101,99,107,76,105,99,101,110,115,101]),[te([111,112,116,105,111,110,115])]:{[te([102,103,105])]:[12]}}];return Le(Ge),Ge;function Ne(We){return 1<<We-1}function Le(We){We[te([102,111,114,69,97,99,104])](Je=>{Je[te([112,101,114,109,105,115,115,105,111,110,77,97,115,107])]=Ne(Je[te([105,100])]),ve(Je)&&Je[te([99,104,101,99,107,65,108,115,111])]&&Le(Je[te([99,104,101,99,107,65,108,115,111])])})}}function ve(Ge){return te([112,108,117,103,105,110,78,97,109,101])in Ge}const ke=[1,85,78,115,198,255,50,112,83,87,161],Ie=[127,34,6,211,167,86,146,199,132,160,18];function Ae(Ge){const Ne=[29,221,175,90,231,133,239,240,75,180];return Se(Ge,new Uint8Array([...ke,...Ne,...Ie]))}function Se(Ge,Ne){const Le=Oe(Ge),We=Array[te([102,114,111,109])](pn(Le)),Je=We[te([112,111,112])](),Wt=We[te([112,111,112])]();return Xt(t(We,Ne,Wt+256*Je))}function Oe(Ge){const Ne=atob(Ge),[Le,We]=Ne[te([115,112,108,105,116])](te([45]));try{if(atob(We))return atob(Le)}catch{}return Ne}function Ve(Ge){try{const Ne=Ae(Ge),Le=JSON[te([112,97,114,115,101])](Ne),We=parseInt(Le[te([49])]),Je=Le[te([50])]||"",Wt=parseInt(Le[te([51])]),nn=parseInt(Le[te([52])])||0,cn=parseInt(Le[te([53])])||0;return{[te([112,114,111,100,117,99,116,78,97,109,101])]:Je,[te([97,108,108,111,119,101,100,80,108,117,103,105,110,115])]:nn,[te([101,120,112,105,114,97,116,105,111,110,68,97,116,101])]:We,[te([105,115,84,114,105,97,108])]:Wt,[te([105,115,73,110,116,101,114,110,97,108])]:cn}}catch{return null}}const Me=xe(),De={[te([99,104,101,99,107,76,105,99,101,110,115,101])]:Ke,[te([99,104,101,99,107,76,105,99,101,110,115,101,70,111,114,84,114,97,99,107,67,104,97,110,103,101,115])]:Qe,[te([99,104,101,99,107,76,105,99,101,110,115,101,70,111,114,82,101,118,105,115,105,111,110,72,105,115,116,111,114,121])]:je},Fe=be[te([99,111,110,115,116,114,117,99,116,111,114])][te([112,108,117,103,105,110,78,97,109,101])],Be=te([99,111,110,116,101,120,116])in be?be.context:be.editor,$e=te([52,48,52,56,49,52,50,50]),Ue=te([65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,48,49,50,51,52,53,54,55,56,57]),He=Be.config.get(te([108,105,99,101,110,115,101,75,101,121])),ze=Me[te([102,105,108,116,101,114])](ve)[te([102,105,110,100])](Ge=>Ge[te([112,108,117,103,105,110,78,97,109,101])]===Fe);function qe(Ge,Ne){De[Ne[te([104,97,110,100,108,101,114])]](Ge,Ne),Ne[te([99,104,101,99,107,65,108,115,111])]&&Ne[te([99,104,101,99,107,65,108,115,111])][te([102,105,108,116,101,114])](Le=>tn(Be,Le[te([112,108,117,103,105,110,78,97,109,101])]))[te([102,111,114,69,97,99,104])](Le=>qe(Ge,Le))}function Ke(Ge,Ne){ht(Ye(Ge,Ne),Ne)}function Qe(Ge,Ne){function Le(We,Je){try{if(tn(Be,te([84,114,97,99,107,67,104,97,110,103,101,115,69,100,105,116,105,110,103]))&&We){const Wt=Kt(Be,te([84,114,97,99,107,67,104,97,110,103,101,115,69,100,105,116,105,110,103]))[te([95,101,120,101,99,117,116,101,83,117,103,103,101,115,116,105,111,110])];if(parseInt(Wt)/2>We[te([101,120,112,105,114,97,116,105,111,110,68,97,116,101])])return Ze(Je[te([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+te([73,110,118,97,108,105,100]))}return Ye(We,Je)}catch{return Ze(Je[te([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+te([73,110,118,97,108,105,100]))}}ht(Le(Ge,Ne),Ne)}function je(Ge,Ne){const Le=Ie[0]*ke[1],We=Ie[0]*ke[2],Je=Ie[2]*ke[2];tn(Be,te([87,101,98,83,111,99,107,101,116,71,97,116,101,119,97,121]))&&Kt(Be,te([87,101,98,83,111,99,107,101,116,71,97,116,101,119,97,121]))[te([115,116,97,116,101])]==te([99,111,110,110,101,99,116,101,100])&&(window[Bt()]=Je);function Wt(zt,Xe){try{return fn()?Ze(Xe[te([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+te([86,97,108,105,100])):Ye(zt,Xe)}catch{return Ze(Xe[te([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+te([73,110,118,97,108,105,100]))}}function nn(zt,Xe){if(zt==Xe[te([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+te([73,110,118,97,108,105,100]))dn();else if(zt==Xe[te([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+te([84,114,105,97,108])){const an=cn();an&&un(an,Xe[te([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]);const rn=ln();window[te([115,101,116,84,105,109,101,111,117,116])](()=>{un(te([116,105,109,101]),Xe[te([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])])},rn);const xn=Kt(Be,te([82,101,118,105,115,105,111,110,115,82,101,112,111,115,105,116,111,114,121]))[te([95,114,101,118,105,115,105,111,110,115])];xn[te([108,101,110,103,116,104])]>=7?un(te([114,101,118,105,115,105,111,110,115]),Xe[te([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]):xn.on(te([97,100,100]),()=>{xn[te([108,101,110,103,116,104])]>=7&&un(te([114,101,118,105,115,105,111,110,115]),Xe[te([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])])})}}function cn(){if(!tn(Be,te([82,101,118,105,115,105,111,110,86,105,101,119,101,114])))return!1;for(const zt in window)if(Number.isNaN(Number(zt))){if(window[zt]===Le)return te([116,105,109,101]);if(window[zt]===We)return te([114,101,118,105,115,105,111,110,115])}return!1}function fn(){if(!tn(Be,te([82,101,118,105,115,105,111,110,86,105,101,119,101,114])))return!1;for(const zt in window)if(Number.isNaN(Number(zt))&&window[zt]===Je)return!0;return!1}function un(zt,Xe){dn(),Ze(Xe+te([84,114,105,97,108,76,105,109,105,116,58])+zt),window[Bt()]=zt===te([116,105,109,101])?Le:We}function ln(){let zt=Ie[6]*ke[8]*ke[6];return tn(Be,te([82,101,118,105,115,105,111,110,86,105,101,119,101,114]))&&(zt/=10),zt}function dn(){const zt=Be;function Xe(){tn(zt,te([82,101,118,105,115,105,111,110,84,114,97,99,107,101,114]))&&(Kt(zt,te([82,101,118,105,115,105,111,110,84,114,97,99,107,101,114]))[te([117,110,98,105,110,100])](te([105,115,69,110,97,98,108,101,100])),Kt(zt,te([82,101,118,105,115,105,111,110,84,114,97,99,107,101,114]))[te([105,115,69,110,97,98,108,101,100])]=!1,Kt(zt,te([82,101,118,105,115,105,111,110,84,114,97,99,107,101,114]))[te([117,112,100,97,116,101])]=en,Kt(zt,te([82,101,118,105,115,105,111,110,84,114,97,99,107,101,114]))[te([115,97,118,101,82,101,118,105,115,105,111,110])]=en,zt[te([109,111,100,101,108])][te([99,104,97,110,103,101])]=en,zt[te([109,111,100,101,108])][te([101,110,113,117,101,117,101,67,104,97,110,103,101])]=en,zt[te([101,110,97,98,108,101,82,101,97,100,79,110,108,121,77,111,100,101])](te([109,111,100,101,108]))),tn(zt,te([82,101,118,105,115,105,111,110,86,105,101,119,101,114]))&&(Kt(zt,te([82,101,118,105,115,105,111,110,86,105,101,119,101,114]))[te([117,110,98,105,110,100])](te([105,115,69,110,97,98,108,101,100])),Kt(zt,te([82,101,118,105,115,105,111,110,86,105,101,119,101,114]))[te([105,115,69,110,97,98,108,101,100])]=!1,Kt(zt,te([82,101,118,105,115,105,111,110,86,105,101,119,101,114]))[te([99,111,109,112,97,114,101])]=en,Kt(zt,te([82,101,118,105,115,105,111,110,86,105,101,119,101,114]))[te([95,103,101,116,68,105,102,102])]=en)}zt[te([115,116,97,116,101])]==te([114,101,97,100,121])?Xe():zt[te([111,110,99,101])](te([114,101,97,100,121]),()=>{if(tn(zt,te([82,101,118,105,115,105,111,110,84,114,97,99,107,101,114]))&&Xe(),tn(zt,te([82,101,118,105,115,105,111,110,86,105,101,119,101,114]))){const Qt=Kt(zt,te([82,101,118,105,115,105,111,110,115,82,101,112,111,115,105,116,111,114,121])),an=Qt.getRevision(0),rn=Qt.getEarlierVisibleRevision(an[te([105,100])]);Kt(zt,te([82,101,118,105,115,105,111,110,86,105,101,119,101,114]))[te([99,111,109,112,97,114,101])](an[te([105,100])],rn?rn[te([105,100])]:null,1).then(()=>Xe())}})}nn(Wt(Ge,Ne),Ne)}function Ye(Ge,Ne){try{return gn(Ne)?Ze(Ne[te([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+te([86,97,108,105,100])):Ge&&sn(Ge[te([97,108,108,111,119,101,100,80,108,117,103,105,110,115])],Ne)?Ge[te([105,115,73,110,116,101,114,110,97,108])]&&!window[te([111,112,101,110])][te([99,108,111,115,101,100])]||parseInt($e)/2>Ge[te([101,120,112,105,114,97,116,105,111,110,68,97,116,101])]?Ze(Ne[te([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+te([73,110,118,97,108,105,100])):Ge[te([105,115,84,114,105,97,108])]?Ze(Ne[te([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+te([84,114,105,97,108])):Ze(Ne[te([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+te([86,97,108,105,100])):Ze(Ne[te([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+te([73,110,118,97,108,105,100]))}catch{return Ze(Ne[te([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+te([73,110,118,97,108,105,100]))}}function ht(Ge,Ne){if(Be instanceof Context){const Le=Be;Ge==Ne[te([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+te([73,110,118,97,108,105,100])?Jt(Le):Ge==Ne[te([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+te([84,114,105,97,108])&&window[te([115,101,116,84,105,109,101,111,117,116])](()=>{Jt(Le),Ze(Ne[te([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+te([84,114,105,97,108,76,105,109,105,116,58,116,105,109,101]))},Ie[6]*ke[8]*ke[6]),Le[te([101,100,105,116,111,114,115])][te([111,110])](te([97,100,100]),(We,Je)=>{Ge!=Ne[te([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+te([73,110,118,97,108,105,100])&&Ge!=Ne[te([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+te([84,114,105,97,108,76,105,109,105,116,58,116,105,109,101])&&Ge!=Ne[te([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+te([84,114,105,97,108,76,105,109,105,116,58,111,112,101,114,97,116,105,111,110,115])||Yt(Je)})}else{const Le=Be;Ge==Ne[te([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+te([73,110,118,97,108,105,100])?Yt(Le):Ge==Ne[te([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+te([84,114,105,97,108])&&Le[te([111,110])](te([114,101,97,100,121]),()=>{let We=0;Le[te([109,111,100,101,108])][te([111,110])](te([97,112,112,108,121,79,112,101,114,97,116,105,111,110]),(Je,Wt)=>{Wt[0][te([105,115,68,111,99,117,109,101,110,116,79,112,101,114,97,116,105,111,110])]&&We++,We===504&&(Yt(Le),Ze(Ne[te([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+te([84,114,105,97,108,76,105,109,105,116,58,111,112,101,114,97,116,105,111,110,115])),Je[te([111,102,102])]())},{priority:te([104,105,103,104,101,115,116])})})}}function Ze(Ge){const Ne=Bt();return Be[Ne]=Ge,Ge}function Bt(){const Ge=String(window[te([112,101,114,102,111,114,109,97,110,99,101])][te([110,111,119])]())[te([114,101,112,108,97,99,101])](te([46]),"");let Ne="";for(let Le=0;Le<Ge[te([108,101,110,103,116,104])];Le+=2){let We=parseInt(Ge[te([115,117,98,115,116,114,105,110,103])](Le,Le+2));We>=Ue[te([108,101,110,103,116,104])]&&(We-=Ue[te([108,101,110,103,116,104])]),Ne+=Ue[We]}return Ne}function Jt(Ge){for(const Ne of Ge[te([101,100,105,116,111,114,115])])Yt(Ne);Kt(Ge,te([67,111,109,109,101,110,116,115,82,101,112,111,115,105,116,111,114,121]))[te([115,119,105,116,99,104,82,101,97,100,79,110,108,121])](!0),Kt(Ge,te([67,111,109,109,101,110,116,115,82,101,112,111,115,105,116,111,114,121]))[te([115,119,105,116,99,104,82,101,97,100,79,110,108,121])]=en}function Yt(Ge){function Ne(){Ge[te([109,111,100,101,108])][te([99,104,97,110,103,101])]=en,Ge[te([109,111,100,101,108])][te([101,110,113,117,101,117,101,67,104,97,110,103,101])]=en,Ge[te([101,110,97,98,108,101,82,101,97,100,79,110,108,121,77,111,100,101])](te([109,111,100,101,108]))}Ge[te([115,116,97,116,101])]==te([114,101,97,100,121])?Ne():Ge[te([111,110,99,101])](te([114,101,97,100,121]),()=>Ne())}function en(){return null}function sn(Ge,Ne){const Le=!!(Ge&Ne[te([112,101,114,109,105,115,115,105,111,110,77,97,115,107])]),We=hn(Ge,Ne);return Le||We}function hn(Ge,Ne){const Le=(Ne[te([111,112,116,105,111,110,115])]||{})[te([102,103,105])]||null;return!!Le&&Me[te([102,105,108,116,101,114])](We=>Le[te([105,110,99,108,117,100,101,115])](We[te([105,100])]))[te([102,105,108,116,101,114])](We=>!mn(We))[te([115,111,109,101])](We=>!!(Ge&We[te([112,101,114,109,105,115,115,105,111,110,77,97,115,107])]))}function mn(Ge){const Ne={[te([102,111,114,98,105,100,100,101,110,72,97,110,100,108,101,114,70,111,114,68,114,117,112,97,108])]:bn};return!!Ge.forbiddenHandler&&Ne[Ge.forbiddenHandler]()}function bn(){return!window[te([68,114,117,112,97,108])]||!tn(Be,te([100,114,117,112,97,108,80,111,119,101,114,101,100,66,121]))}function gn(Ge){if(!tn(Be,Ge[te([112,108,117,103,105,110,78,97,109,101])]))return!0;const Ne=Ge[te([111,112,116,105,111,110,115])]||{},Le=Ne[te([97,105,119,115,103,105,99])]||!1,We=Ne[te([97,105,116,99,100,103,105,108])]||!1,Je=Ne[te([97,105,114,118,105,105,108])]||!1;return tn(Be,te([87,101,98,83,111,99,107,101,116,71,97,116,101,119,97,121]))&&Kt(Be,te([87,101,98,83,111,99,107,101,116,71,97,116,101,119,97,121]))[te([115,116,97,116,101])]==te([99,111,110,110,101,99,116,101,100])&&Le||tn(Be,te([84,114,97,99,107,67,104,97,110,103,101,115,68,97,116,97,71,101,116,116,101,114]))&&Kt(Be,te([84,114,97,99,107,67,104,97,110,103,101,115,68,97,116,97,71,101,116,116,101,114]))[te([114,101,115,117,108,116])]==te([101,110,100])&&We?!0:!(!tn(Be,te([82,101,118,105,115,105,111,110,86,105,101,119,101,114,73,110,116,101,103,114,97,116,105,111,110]))||Kt(Be,te([82,101,118,105,115,105,111,110,86,105,101,119,101,114,73,110,116,101,103,114,97,116,105,111,110]))[te([114,101,115,117,108,116])]!=te([101,110,100])||!Je)}function tn(Ge,Ne){return Ge[te([112,108,117,103,105,110,115])][te([104,97,115])](Ne)}function Kt(Ge,Ne){return Ge[te([112,108,117,103,105,110,115])][te([103,101,116])](Ne)}function Xt(Ge){let Ne="";for(const Le of Ge)Ne+=String[te([102,114,111,109,67,104,97,114,67,111,100,101])](Le);return Ne}function pn(Ge){const Ne=new Uint8Array(Ge[te([108,101,110,103,116,104])]);for(let Le=0;Le<Ge[te([108,101,110,103,116,104])];Le++)Ne[Le]=Ge[te([99,104,97,114,67,111,100,101,65,116])](Le);return Ne}ze&&qe(Ve(He),ze)})(we)})(this)}_createTemplateListView(we,t){const{editor:te}=this,be=new d$1(we);return be.extendTemplate({attributes:{role:"listbox",class:["ck-template-list"]}}),be.items.addMany(t.map((xe,ve)=>{const ke=new b(we,ve),Ie=new h(we,xe);return ke.buttonView=Ie,ke.children.add(Ie),ke.buttonView.on("execute",Ae=>{te.execute("insertTemplate",Ae.source.templateDefinition.data),te.editing.view.focus()}),ke})),be}}let m$1=class extends Plugin{static get requires(){return[r,i]}static get pluginName(){return"Template"}};class M extends Command{constructor(t,te){super(t);Re(this,"_enabledCommands");this._enabledCommands=te,this.value=!1,this.refresh(),this._isEnabledBasedOnSelection=!1}refresh(){this.isEnabled=!0}execute(){this.value=!this.value,this.value?this._disableUnsupportedCommands():this._enableCommands()}_disableUnsupportedCommands(){for(const t of this.editor.commands.commands())t.affectsData&&!this._enabledCommands.has(t)&&t.forceDisabled("TrackChangesCommand")}_enableCommands(){for(const t of this.editor.commands.commands())t.affectsData&&!this._enabledCommands.has(t)&&t.clearForceDisabled("TrackChangesCommand")}}class $ extends Command{constructor(t,te){super(t);Re(this,"_suggestions");this._suggestions=te,this.refresh(),this._isEnabledBasedOnSelection=!1}refresh(){this.isEnabled=!0}execute(t){const te=this._suggestions.get(t);if(!te)throw new CKEditorError("track-changes-accept-suggestion-not-found",this);const be=te.getRanges();this.editor.model.canEditAt(be)&&this.editor.plugins.get("TrackChangesEditing").acceptSuggestion(te)}}class B extends Command{constructor(t,te){super(t);Re(this,"_suggestions");this._suggestions=te,this.refresh(),this._isEnabledBasedOnSelection=!1}refresh(){this.isEnabled=!0}execute(t){const te=this._suggestions.get(t);if(!te)throw new CKEditorError("track-changes-discard-suggestion-not-found",this);const be=te.getRanges();this.editor.model.canEditAt(be)&&this.editor.plugins.get("TrackChangesEditing").discardSuggestion(te)}}function ss(Te){return Te.sort((we,t)=>we.type=="deletion"&&t.type!="deletion"?-1:we.type!="deletion"&&t.type=="deletion"?1:0)}function to(Te,we){let t,te=0;const be=[],xe=we.schema;for(;te<Te.length;){const ve=Te[te],ke=Te[te+1];t||(t=we.createPositionBefore(ve)),co(we,ve,ke)||(be.push(we.createRange(t,xe.isObject(ve)?we.createPositionAfter(ve):we.createPositionAt(ve,"end"))),t=null),te++}return be}function co(Te,we,t){if(!t)return!1;const te=Te.createPositionAfter(we),be=Te.createPositionBefore(t);return te.isTouching(be)}function rs(Te,we,t){for(;t.length;){const te=t.splice(0,100);Te.change(()=>{for(const be of te)be.isInContent&&we.execute(be.id)})}}class x extends Command{constructor(t,te,be){super(t);Re(this,"_command");Re(this,"_suggestions");this._command=te,this._suggestions=be,this.refresh(),this._isEnabledBasedOnSelection=!1}refresh(){const t=Array.from(this._suggestions.values()).some(te=>te.isInContent);this.isEnabled=this._command.isEnabled&&t}execute(){const t=ss(Array.from(this._suggestions.values()));for(const te of t){const be=te.getRanges();if(!this.editor.model.canEditAt(be))return}rs(this.editor.model,this._command,t)}}class R extends Command{constructor(t,te,be){super(t);Re(this,"_command");Re(this,"_suggestions");Re(this,"_selectedSuggestions");this._command=te,this._suggestions=be,this._selectedSuggestions=new Set,this.refresh(),this._isEnabledBasedOnSelection=!1}refresh(){const t=this.editor.model.document.selection,te=Array.from(this._suggestions.values());this._selectedSuggestions=function(be,xe){const ve=Array.from(be.getRanges()),ke=new Set;for(const Ie of xe)if(Ie.isInContent)for(const Ae of ve)for(const Se of Ie.getRanges())(Ae.isIntersecting(Se)||be.isCollapsed&&!Ie.isMultiRange&&Ie.next&&Se.end.isTouching(Ae.start))&&ke.add(Ie);return ke}(t,te),this.isEnabled=this._command.isEnabled&&!!this._selectedSuggestions.size}execute(){const t=ss(Array.from(this._selectedSuggestions));for(const te of t){const be=te.getRanges();if(!this.editor.model.canEditAt(be))return}rs(this.editor.model,this._command,t)}}class u extends ObservableMixin(){constructor(t,te){super();Re(this,"id");Re(this,"type");Re(this,"subType");Re(this,"author");Re(this,"creator");Re(this,"isExternal");Re(this,"data");Re(this,"createdAt");Re(this,"_isDataLoaded",!1);Re(this,"_model");Re(this,"_onAccept");Re(this,"_onDiscard");Re(this,"_onAttributesChange");Re(this,"_markerNames");this.id=te.id,this.type=te.type,this.subType=te.subType||null,this.author=te.author,this.creator=te.creator||te.author,this.isExternal=!!(te.attributes&&te.attributes["@external"]),this.data=null,this._model=t,this._onAccept=te.onAccept,this._onDiscard=te.onDiscard,this._onAttributesChange=te.onAttributesChange,this._markerNames=new Set,this.createdAt=null,this.set("authoredAt",null),this.set("attributes",te.attributes||{}),this.set("previous",null),this.set("next",null),this.set("commentThread",null),this.set("_saved",!1),this.decorate("accept"),this.decorate("discard")}get head(){let t=this;for(;t.previous;)t=t.previous;return t}get hasComments(){return!!this.commentThread&&this.commentThread.length>0}get isMultiRange(){return this._markerNames.size==0?!1:Array.from(this._markerNames)[0].split(":").length==6}get isInContent(){return this.getFirstMarker()!==null}addMarkerName(t){this._markerNames.add(t)}getMarkerNames(){return Array.from(this._markerNames)}getMarkers(){return this.getMarkerNames().map(t=>this._model.markers.get(t)).filter(t=>t)}getFirstMarker(){return this.getMarkers()[0]||null}removeMarkers(){this._model.change(t=>{for(const te of this.getMarkers())t.removeMarker(te)}),this._markerNames.clear()}removeMarker(t){this._model.change(te=>{te.removeMarker(t)}),this._markerNames.delete(t)}addRange(t){const te="suggestion:"+this.type+":"+this.subType+":"+this.id+":"+this.creator.id+":"+u.getMultiRangeId();this.addMarkerName(te),this._model.change(be=>{be.addMarker(te,{range:t,usingOperation:!0,affectsData:!0})})}isIntersectingWithRange(t){for(const te of this.getRanges())if(te.isIntersecting(t))return!0;return!1}getRanges(){return this.getMarkers().map(t=>t.getRange())}getItems(){return this.getRanges().reduce((t,te)=>[...t,...te.getItems()],[])}getFirstRange(){var t;return((t=this.getFirstMarker())==null?void 0:t.getRange())||null}getContainedElement(){const t=this.getRanges();if(t.length!=1)return null;const te=t[0],be=te.start.nodeAfter,xe=te.end.nodeBefore;return be instanceof Element?be!=xe?null:be:null}accept(){this._onAccept(this.getRanges(),this.data,this.attributes),this.removeMarkers()}discard(){this._onDiscard(this.getRanges(),this.data,this.attributes),this.removeMarkers()}getAllAdjacentSuggestions(){const t=[];let te=this.head;for(;te;)t.push(te),te=te.next;return t}setAttribute(t,te){const be=cloneDeep(this.attributes);set$1(be,t,te),isEqual(be,this.attributes)||(this.attributes=be,this._onAttributesChange(be))}removeAttribute(t){const te=cloneDeep(this.attributes);unset(te,t),isEqual(te,this.attributes)||(this.attributes=te,this._onAttributesChange(this.attributes))}toJSON(){return{id:this.id,type:this.subType?this.type+":"+this.subType:this.type,authorId:this.creator.id,createdAt:this.createdAt,hasComments:this.hasComments,data:this.data,attributes:this.attributes}}static getMultiRangeId(){return uid().substr(1,5)}}function o(Te,we,t){const te=Te.t;switch(we){case"Track changes":return te("Track changes");case"Accept suggestion":return te("Accept suggestion");case"Discard suggestion":return te("Discard suggestion");case"Accept all suggestions":return te("Accept all suggestions");case"Accept all selected suggestions":return te("Accept all selected suggestions");case"Discard all suggestions":return te("Discard all suggestions");case"Discard all selected suggestions":return te("Discard all selected suggestions");case"*Reset font size*":return te("*Reset font size*");case"*Reset font family*":return te("*Reset font family*");case"*Reset font color*":return te("*Reset font color*");case"*Reset font background color*":return te("*Reset font background color*");case"*Remove image text alternative*":return te("*Remove image text alternative*");case"*Reset image width*":return te("*Reset image width*");case"*Remove link*":return te("*Remove link*");case"*Check item*":return te("*Check item*");case"*Uncheck item*":return te("*Uncheck item*");case"*Remove all formatting*":return te("*Remove all formatting*");case"*Replace table cells*":return te("*Replace table cells*");case"*Merge cells*":return te("*Merge cells*");case"*Split cell:* vertically":return te("*Split cell:* vertically");case"*Split cell:* horizontally":return te("*Split cell:* horizontally");case"*Indent:* %0":return te("*Indent:* %0",t);case"*Outdent:* %0":return te("*Outdent:* %0",t);case"*Change to:* %0":return te("*Change to:* %0",t);case"*Insert:* %0":return te("*Insert:* %0",t);case"*Format:* %0":return te("*Format:* %0",t);case"*Format:* change table properties":return te("*Format:* change table properties");case"*Format:* change table cell properties":return te("*Format:* change table cell properties");case"*Format:* insert into %0":return te("*Format:* insert into %0",t);case"*Format:* remove from %0":return te("*Format:* remove from %0",t);case"*Replace image URL*":return te("*Replace image URL*");case"*Format:* resize table":return te("*Format:* resize table");case"*Format:* set order to reversed":return te("*Format:* set order to reversed");case"*Format:* set order to regular":return te("*Format:* set order to regular");case"*Format:* set start index to %0":return te("*Format:* set start index to %0",t);case"*Change %0 content*":return te("*Change %0 content*",t);case"*Remove:* %0":return te("*Remove:* %0",t);case"*Merge:* %0":return te("*Merge:* %0",t);case"*Split:* %0":return te("*Split:* %0",t);case"*Remove format:* %0":return te("*Remove format:* %0",t);case"*Set font size:* %0":return te("*Set font size:* %0",t);case"*Set font family:* %0":return te("*Set font family:* %0",t);case"*Set format to:* %0":return te("*Set format to:* %0",t);case"*Set font color:* %0":return te("*Set font color:* %0",t);case"*Set font background color:* %0":return te("*Set font background color:* %0",t);case"*Set format:* %0":return te("*Set format:* %0",t);case"*Set image text alternative:* %0":return te("*Set image text alternative:* %0",t);case"*Set image width:* %0":return te("*Set image width:* %0",t);case"*Set link:* %0":return te("*Set link:* %0",t);case"*Set highlight:* %0":return te("*Set highlight:* %0",t);case"*Remove highlight*":return te("*Remove highlight*");case"FORMAT_HIGHLIGHT":return te({string:"highlight",id:"FORMAT_HIGHLIGHT"});case"FORMAT_RESTRICTED_ENABLED":return te({string:"*Enable in restricted editing mode*",id:"FORMAT_RESTRICTED_ENABLED"});case"FORMAT_RESTRICTED_DISABLED":return te({string:"*Disable in restricted editing mode*",id:"FORMAT_RESTRICTED_DISABLED"});case"ELEMENT_TABLE":return te({string:"table",plural:"%0 tables",id:"ELEMENT_TABLE"},t);case"ELEMENT_PARAGRAPH":return te({string:"paragraph",plural:"%0 paragraphs",id:"ELEMENT_PARAGRAPH"},t);case"ELEMENT_PAGE_BREAK":return te({string:"page break",plural:"%0 page breaks",id:"ELEMENT_PAGE_BREAK"},t);case"ELEMENT_MEDIA":return te({string:"media item",plural:"%0 media items",id:"ELEMENT_MEDIA"},t);case"ELEMENT_IMAGE":return te({string:"image",plural:"%0 images",id:"ELEMENT_IMAGE"},t);case"ELEMENT_INLINE_IMAGE":return te({string:"image",plural:"%0 images",id:"ELEMENT_INLINE_IMAGE"},t);case"FORMAT_SIDE_IMAGE":return te({string:"side image",id:"FORMAT_SIDE_IMAGE"});case"ELEMENT_CAPTION":return te({string:"caption",id:"ELEMENT_CAPTION"});case"ELEMENT_HORIZONTAL_LINE":return te({string:"horizontal line",plural:"%0 horizontal lines",id:"ELEMENT_HORIZONTAL_LINE"},t);case"ELEMENT_HTML_EMBED":return te({string:"HTML embed",plural:"%0 HTML embeds",id:"ELEMENT_HTML_EMBED"},t);case"ELEMENT_HEADING":return te({string:"heading (level %1)",plural:"%0 headings (level %1)",id:"ELEMENT_HEADING"},t);case"ELEMENT_HEADING_CUSTOM":return te({string:"heading (%1)",plural:"%0 headings (%1)",id:"ELEMENT_HEADING_CUSTOM"},t);case"ELEMENT_LIST_ITEM":return te({string:"list item",plural:"%0 list items",id:"ELEMENT_LIST_ITEM"},t);case"ELEMENT_DEFAULT_LIST_DEFAULT":return te({string:"default list style",id:"ELEMENT_DEFAULT_LIST_DEFAULT"});case"ELEMENT_BULLETED_LIST":return te({string:"bulleted list",id:"ELEMENT_BULLETED_LIST"});case"ELEMENT_BULLETED_LIST_DEFAULT":return te({string:"bulleted list (default)",id:"ELEMENT_BULLETED_LIST_DEFAULT"});case"ELEMENT_BULLETED_LIST_CIRCLE":return te({string:"bulleted list (circle)",id:"ELEMENT_BULLETED_LIST_CIRCLE"});case"ELEMENT_BULLETED_LIST_DISC":return te({string:"bulleted list (disc)",id:"ELEMENT_BULLETED_LIST_DISC"});case"ELEMENT_BULLETED_LIST_SQUARE":return te({string:"bulleted list (square)",id:"ELEMENT_BULLETED_LIST_SQUARE"});case"ELEMENT_NUMBERED_LIST_DEFAULT":return te({string:"numbered list (default)",id:"ELEMENT_NUMBERED_LIST_DEFAULT"});case"ELEMENT_NUMBERED_LIST":return te({string:"numbered list",id:"ELEMENT_NUMBERED_LIST"});case"ELEMENT_NUMBERED_LIST_DECIMAL":return te({string:"numbered list (decimal)",id:"ELEMENT_NUMBERED_LIST_DECIMAL"});case"ELEMENT_NUMBERED_LIST_DECIMAL_LEADING_ZERO":return te({string:"numbered list (decimal with leading zero)",id:"ELEMENT_NUMBERED_LIST_DECIMAL_LEADING_ZERO"});case"ELEMENT_NUMBERED_LIST_LOWER_LATIN":return te({string:"numbered list (lower-latin)",id:"ELEMENT_NUMBERED_LIST_LOWER_LATIN"});case"ELEMENT_NUMBERED_LIST_LOWER_ROMAN":return te({string:"numbered list (lower-roman)",id:"ELEMENT_NUMBERED_LIST_LOWER_ROMAN"});case"ELEMENT_NUMBERED_LIST_UPPER_LATIN":return te({string:"numbered list (upper-latin)",id:"ELEMENT_NUMBERED_LIST_UPPER_LATIN"});case"ELEMENT_NUMBERED_LIST_UPPER_ROMAN":return te({string:"numbered list (upper-roman)",id:"ELEMENT_NUMBERED_LIST_UPPER_ROMAN"});case"ELEMENT_TODO_LIST":return te({string:"to-do list",id:"ELEMENT_TODO_LIST"});case"ELEMENT_MULTI_LEVEL_LIST":return te({string:"multi-level list",id:"ELEMENT_MULTI_LEVEL_LIST"});case"REPLACE_TEXT":return te({string:"*Replace:* %0 *with* %1",id:"REPLACE_TEXT"},t);case"ELEMENT_SPACE":return te({string:"space",plural:"%0 spaces",id:"ELEMENT_SPACE"},t);case"FORMAT_ALIGNMENT":return te({string:"alignment",id:"FORMAT_ALIGNMENT"});case"FORMAT_ALIGN_TO_LEFT":return te({string:"align to left",id:"FORMAT_ALIGN_TO_LEFT"});case"FORMAT_ALIGN_TO_RIGHT":return te({string:"align to right",id:"FORMAT_ALIGN_TO_RIGHT"});case"FORMAT_ALIGN_TO_CENTER":return te({string:"align to center",id:"FORMAT_ALIGN_TO_CENTER"});case"FORMAT_JUSTIFY_TEXT":return te({string:"justify",id:"FORMAT_JUSTIFY_TEXT"});case"FORMAT_BOLD":return te({string:"bold",id:"FORMAT_BOLD"});case"FORMAT_ITALIC":return te({string:"italic",id:"FORMAT_ITALIC"});case"FORMAT_UNDERLINE":return te({string:"underline",id:"FORMAT_UNDERLINE"});case"FORMAT_CODE":return te({string:"code",id:"FORMAT_CODE"});case"FORMAT_STRIKETHROUGH":return te({string:"strikethrough",id:"FORMAT_STRIKETHROUGH"});case"FORMAT_SUBSCRIPT":return te({string:"subscript",id:"FORMAT_SUBSCRIPT"});case"FORMAT_SUPERSCRIPT":return te({string:"superscript",id:"FORMAT_SUPERSCRIPT"});case"ELEMENT_BLOCK_QUOTE":return te({string:"block quote",id:"ELEMENT_BLOCK_QUOTE"});case"ELEMENT_CODE_BLOCK":return te({string:"code block",plural:"%0 code blocks",id:"ELEMENT_CODE_BLOCK"},t);case"FORMAT_HEADER_COLUMN":return te({string:"header column",id:"FORMAT_HEADER_COLUMN"});case"FORMAT_REGULAR_COLUMN":return te({string:"regular column",id:"FORMAT_REGULAR_COLUMN"});case"FORMAT_HEADER_ROW":return te({string:"header row",id:"FORMAT_HEADER_ROW"});case"FORMAT_REGULAR_ROW":return te({string:"regular row",id:"FORMAT_REGULAR_ROW"});case"FORMAT_INDENT":return te({string:"indent",id:"FORMAT_INDENT"});case"FORMAT_LIST_REVERSED":return te({string:"list reversed",id:"FORMAT_LIST_REVERSED"});case"FORMAT_LIST_START":return te({string:"list start",id:"FORMAT_LIST_START"});case"FORMAT_FONT_SIZE":return te({string:"font size",id:"FORMAT_FONT_SIZE"});case"FORMAT_FONT_FAMILY":return te({string:"font family",id:"FORMAT_FONT_FAMILY"});case"FORMAT_FONT_COLOR":return te({string:"font color",id:"FORMAT_FONT_COLOR"});case"FORMAT_FONT_BACKGROUND":return te({string:"font background color",id:"FORMAT_FONT_BACKGROUND"});case"FORMAT_IMAGE_SIZE":return te({string:"image size",id:"FORMAT_IMAGE_SIZE"});case"FORMAT_STYLE":return te({string:"style",id:"FORMAT_STYLE"});case"PENDING_ACTION_SUGGESTION":return te({string:"Unsaved change in suggestion.",id:"PENDING_ACTION_SUGGESTION"});case"ELEMENT_TABLE_WITH_TEXT":return te({string:"table *with text* %0",id:"ELEMENT_TABLE_WITH_TEXT"},t);case"ELEMENT_TABLE_ROW":return te({string:"table row",plural:"%0 table rows",id:"ELEMENT_TABLE_ROW"},t);case"ELEMENT_TABLE_ROW_WITH_TEXT":return te({string:"table row *with text* %1",plural:"%0 table rows *with text* %1",id:"ELEMENT_TABLE_ROW_WITH_TEXT"},t);case"ELEMENT_TABLE_COLUMN":return te({string:"table column",plural:"%0 table columns",id:"ELEMENT_TABLE_COLUMN"},t);case"ELEMENT_TABLE_COLUMN_WITH_TEXT":return te({string:"table column *with text* %1",plural:"%0 table columns *with text* %1",id:"ELEMENT_TABLE_COLUMN_WITH_TEXT"},t);case"ELEMENT_TABLE_OF_CONTENTS":return te({string:"table of contents",plural:"%0 tables of contents",id:"ELEMENT_TABLE_OF_CONTENTS"},t);case"ELEMENT_LINE_BREAK":return te({id:"ELEMENT_LINE_BREAK",string:"line break",plural:"%0 line breaks"},t);case"ELEMENT_TITLE":return te({id:"ELEMENT_TITLE",string:"title"});case"EXTERNAL_SUGGESTION":return te({id:"EXTERNAL_SUGGESTION",string:"This suggestion comes from an external source."});case"EXTERNAL_IMPORT_WORD_SUGGESTION":return te({string:"This suggestion comes from an imported Word file.",id:"EXTERNAL_IMPORT_WORD_SUGGESTION"});case"EXTERNAL_AVATAR":return te({string:"Displayed author name comes from external source (added by %0)",id:"EXTERNAL_AVATAR"},t);case"EXTERNAL_IMPORT_WORD_AVATAR":return te({string:"Displayed author name comes from a Word document imported by %0",id:"EXTERNAL_IMPORT_WORD_AVATAR"},t);case"ENTER_INSERTION_SUGGESTION_ANNOUNCEMENT":return te({string:"Entering insertion suggestion.",id:"ENTER_INSERTION_SUGGESTION_ANNOUNCEMENT"});case"LEAVE_INSERTION_SUGGESTION_ANNOUNCEMENT":return te({string:"Leaving insertion suggestion.",id:"LEAVE_INSERTION_SUGGESTION_ANNOUNCEMENT"});case"ENTER_DELETION_SUGGESTION_ANNOUNCEMENT":return te({string:"Entering deletion suggestion.",id:"ENTER_DELETION_SUGGESTION_ANNOUNCEMENT"});case"LEAVE_DELETION_SUGGESTION_ANNOUNCEMENT":return te({string:"Leaving deletion suggestion.",id:"LEAVE_DELETION_SUGGESTION_ANNOUNCEMENT"});case"ENTER_FORMATTING_SUGGESTION_ANNOUNCEMENT":return te({string:"Entering formatting suggestion.",id:"ENTER_FORMATTING_SUGGESTION_ANNOUNCEMENT"});case"LEAVE_FORMATTING_SUGGESTION_ANNOUNCEMENT":return te({string:"Leaving formatting suggestion.",id:"LEAVE_FORMATTING_SUGGESTION_ANNOUNCEMENT"});default:return we}}class f{constructor(we,t){Re(this,"_customCallbacks");Re(this,"_itemLabels");Re(this,"_itemLabelsCallbacks");Re(this,"_attributeLabels");Re(this,"_schema");Re(this,"_locale");this._customCallbacks=[],this._itemLabels=new Map,this._itemLabelsCallbacks=[],this._attributeLabels=new Map,this._schema=we,this._locale=t}getDescriptions(we){const t=[],te=new Set,be=new Set;for(let xe=0;xe<we.length;xe++){const ve=we[xe];if(!ve.isInContent)continue;const ke=this._handleCustomCallbackDescription(ve);if(ke){if(ve.subType!=null){if(te.has(ve.subType))continue;te.add(ve.subType)}t.push(ke)}else if(ve.type!="attribute")ve.type!="insertion"&&ve.type!="deletion"||this._handleInsertRemoveSuggestionDescription(t,ve,we[xe+1]);else{const Ie=ve.data.key;if(be.has(Ie))continue;be.add(ve.data.key),Ie==m?this._handleRenameSuggestionDescription(t,ve):this._handleAttributeSuggestionDescription(t,ve)}}return this._resolveDescriptionItems(t)}registerDescriptionCallback(we){this._customCallbacks.push(we)}registerElementLabel(we,t,te=priorities.normal){typeof we=="function"?insertToPriorityArray(this._itemLabelsCallbacks,{matchingCallback:we,label:t,priority:te}):this._itemLabels.set(we,t)}registerAttributeLabel(we,t){this._attributeLabels.set(we,t)}getItemLabel(we,t=1){let te;for(const be of this._itemLabelsCallbacks)if(be.matchingCallback(we)){te=be.label;break}return te||(te=this._itemLabels.get(we.name)),te?te(t):t!==1?t+" "+we.name+"s":""+we.name}_addDescriptionItems(we,t){const te=t.getFirstRange().getWalker(),be=t.type=="insertion"?"add":"remove";for(const xe of te){const ve=xe.item,ke=we[we.length-1];if(ve.is("$textProxy"))ke&&ke.type.indexOf("Container")>-1&&we.pop(),ke&&ke.type=="text"?ke[be]+=ve.data:we.push({type:"text",add:be=="add"?ve.data:"",remove:be=="remove"?ve.data:""});else if(this._schema.isObject(ve)){const Ie=ve;if(ke&&ke.type.indexOf("Container")>-1&&we.pop(),xe.type=="elementEnd")continue;ke&&ke.type==be+"Object"&&ke.element.name==Ie.name?ke.quantity++:we.push({type:be+"Object",element:Ie,quantity:1}),te.skip(Ae=>!(Ae.type=="elementEnd"&&Ae.item==ve))}else if(this._schema.checkChild(ve,"$text")||ve.is("element","softBreak")){const Ie=ve;if(be=="add"&&xe.type=="elementStart"||be=="remove"&&xe.type=="elementEnd")continue;if(ke&&ke.type.indexOf("Container")==-1){ke.type=="text"&&(ke[be]+=`
`);continue}let Ae;if(Ae=be=="add"?Ie.nextSibling&&!this._schema.isObject(Ie.nextSibling)?Ie.nextSibling:null:Ie.previousSibling&&!this._schema.isObject(Ie.previousSibling)?Ie.previousSibling:null,Ie.isEmpty||Ae&&Ae.isEmpty){const Se=Ae&&Ae.isEmpty?Ae:Ie;ke&&ke.type==be+"EmptyContainer"&&ke.element.name==Se.name?ke.quantity++:we.push({type:be+"EmptyContainer",element:Se,quantity:1})}else we.push({type:be+"Container",element:Ie})}}}_resolveDescriptionItems(we){const t=this._locale,te=[],be=[],xe=[];for(const ve of we)switch(ve.type){case"text":if(ve.add=ve.add.replace(/(\S)\u000A+(\S)/g,"$1 $2").replace(/\u000A/g,""),ve.remove=ve.remove.replace(/(\S)\u000A+(\S)/g,"$1 $2").replace(/\u000A/g,""),ve.add!=""&&ve.remove!=""){te.push({type:"replace",content:o(t,"REPLACE_TEXT",['"'+ve.remove+'"','"'+ve.add+'"'])});continue}if(ve.add.match(/^ +$/)!=null){te.push({type:"insertion",content:o(t,"*Insert:* %0",o(t,"ELEMENT_SPACE",ve.add.length))});continue}if(ve.remove.match(/^ +$/)!=null){te.push({type:"deletion",content:o(t,"*Remove:* %0",o(t,"ELEMENT_SPACE",ve.remove.length))});continue}if(ve.add!=""){te.push({type:"insertion",content:o(t,"*Insert:* %0",'"'+ve.add+'"')});continue}te.push({type:"deletion",content:o(t,"*Remove:* %0",'"'+ve.remove+'"')});continue;case"addEmptyContainer":case"addObject":te.push({type:"insertion",content:o(t,"*Insert:* %0",this.getItemLabel(ve.element,ve.quantity))});continue;case"removeEmptyContainer":case"removeObject":te.push({type:"deletion",content:o(t,"*Remove:* %0",this.getItemLabel(ve.element,ve.quantity))});continue;case"addContainer":te.push({type:"insertion",content:o(t,"*Split:* %0",this.getItemLabel(ve.element,ve.quantity))});continue;case"removeContainer":te.push({type:"deletion",content:o(t,"*Merge:* %0",this.getItemLabel(ve.element,ve.quantity))});continue;case"addFormat":be.push(ve.key);continue;case"removeFormat":xe.push(ve.key);continue;default:te.push(ve)}if(be.length){const ve=be.map(ke=>this._attributeLabels.has(ke)?this._attributeLabels.get(ke):ke).join(", ");te.push({type:"format",content:o(this._locale,"*Set format:* %0",ve)})}if(xe.length){const ve=xe.map(ke=>this._attributeLabels.has(ke)?this._attributeLabels.get(ke):ke).join(", ");te.push({type:"format",content:o(this._locale,"*Remove format:* %0",ve)})}return te}_handleCustomCallbackDescription(we){for(const t of this._customCallbacks){const te=t(we);if(te&&"type"in te)return te}}_handleAttributeSuggestionDescription(we,t){const te=t.data,be=te.newValue===void 0?"removeFormat":"addFormat";we.push({type:be,key:te.key})}_handleRenameSuggestionDescription(we,t){we.push({type:"format",content:o(this._locale,"*Change to:* %0",this.getItemLabel(t.getFirstRange().start.nodeAfter,1))})}_handleInsertRemoveSuggestionDescription(we,t,te){if(this._addDescriptionItems(we,t),te&&te.getFirstRange()&&!t.getFirstRange().end.isEqual(te.getFirstRange().start)){const be=we[we.length-1],xe=t.type=="insertion"?"add":"remove";be&&be.type=="text"&&(be[xe]+=`
`)}}}class E extends Plugin{afterInit(){const we=this.editor,t=we.plugins.get("TrackChangesEditing");we.commands.get("showAIAssistant")&&t.enableCommand("showAIAssistant")}}class V extends Plugin{afterInit(){const we=this.editor,t=we.locale;if(!we.plugins.has("AlignmentEditing"))return;const te=we.plugins.get("TrackChangesEditing");te.enableDefaultAttributesIntegration("alignment"),te.registerBlockAttribute("alignment"),te.descriptionFactory.registerAttributeLabel("alignment",o(t,"FORMAT_ALIGNMENT")),this._registerLegacyDescription()}_registerLegacyDescription(){const we=this.editor,t=we.locale;we.plugins.get("TrackChangesEditing").descriptionFactory.registerDescriptionCallback(te=>{if(te.type!="formatBlock")return;const{data:be}=te;if(be&&be.commandName=="alignment"){const xe=be.commandParams[0].value;return{type:"format",content:o(t,"*Format:* %0",function(ve){switch(ve){case"left":return o(t,"FORMAT_ALIGN_TO_LEFT");case"right":return o(t,"FORMAT_ALIGN_TO_RIGHT");case"center":return o(t,"FORMAT_ALIGN_TO_CENTER");case"justify":return o(t,"FORMAT_JUSTIFY_TEXT")}}(xe))}}})}}const ti=["BoldEditing","ItalicEditing","UnderlineEditing","CodeEditing","StrikethroughEditing","SubscriptEditing","SuperscriptEditing"];class U extends Plugin{afterInit(){const we=this.editor,t=we.plugins.get("TrackChangesEditing"),te=we.locale;for(const be of ti){if(!we.plugins.has(be))continue;const xe=be.slice(0,-7).toLowerCase(),ve="FORMAT_"+xe.toUpperCase();t.enableDefaultAttributesIntegration(xe),t.registerInlineAttribute(xe),t.descriptionFactory.registerAttributeLabel(xe,o(te,ve))}this._registerLegacyDescription()}_registerLegacyDescription(){const we=this.editor,t=we.locale,te=we.plugins.get("TrackChangesEditing");function be(xe,ve){te.descriptionFactory.registerDescriptionCallback(ke=>{if(ke.type!="formatInline")return;const{data:Ie}=ke;return Ie&&Ie.commandName===xe?Ie.commandParams[0].forceValue?{type:"format",content:o(t,"*Format:* %0",ve)}:{type:"format",content:o(t,"*Remove format:* %0",ve)}:void 0})}be("bold",o(t,"FORMAT_BOLD")),be("italic",o(t,"FORMAT_ITALIC")),be("underline",o(t,"FORMAT_UNDERLINE")),be("code",o(t,"FORMAT_CODE")),be("strikethrough",o(t,"FORMAT_STRIKETHROUGH")),be("subscript",o(t,"FORMAT_SUBSCRIPT")),be("superscript",o(t,"FORMAT_SUPERSCRIPT"))}}class O extends Plugin{afterInit(){const we=this.editor,t=we.locale;if(!we.plugins.has("BlockQuoteEditing"))return;const te=we.plugins.get("TrackChangesEditing"),be=this.editor.commands.get("blockQuote");te.enableCommand("blockQuote",(xe,ve={})=>{const ke=this.editor.model.document.selection,Ie=ve&&ve.forceValue!==void 0?ve.forceValue:!be.value;let Ae=[];if(Ie){const Se=Array.from(ke.getSelectedBlocks()).filter(Oe=>oo(Oe)||function(Ve,Me){const De=Me.checkChild(Ve.parent,"blockQuote"),Fe=Me.checkChild(["$root","blockQuote"],Ve);return De&&Fe}(Oe,this.editor.model.schema));Ae=to(Se,we.model)}else{const Se=Array.from(ke.getSelectedBlocks()).filter(Oe=>oo(Oe));Ae=to(Se,we.model)}we.model.change(()=>{for(const Se of Ae)te.markBlockFormat(Se,{commandName:"blockQuote",commandParams:[{forceValue:Ie}]})})}),te.descriptionFactory.registerDescriptionCallback(xe=>{const{data:ve}=xe;if(ve&&ve.commandName=="blockQuote"){const ke=o(t,"ELEMENT_BLOCK_QUOTE");return ve.commandParams[0].forceValue?{type:"format",content:o(t,"*Set format:* %0",ke)}:{type:"format",content:o(t,"*Remove format:* %0",ke)}}})}}function oo(Te){return Te.parent.name=="blockQuote"}class G extends Plugin{afterInit(){const we=this.editor;we.plugins.has("CaseChange")&&(we.plugins.get("TrackChangesEditing").enableCommand("changeCaseUpper"),we.plugins.get("TrackChangesEditing").enableCommand("changeCaseLower"),we.plugins.get("TrackChangesEditing").enableCommand("changeCaseTitle"))}}class F extends Plugin{afterInit(){const we=this.editor;we.commands.get("ckbox")&&we.plugins.get("TrackChangesEditing").enableCommand("ckbox")}}class L extends Plugin{afterInit(){const we=this.editor;if(!we.plugins.has("CodeBlock"))return;const t=we.plugins.get("TrackChangesEditing"),te=we.locale,be=we.config.get("codeBlock").languages,xe=we.commands.get("codeBlock");t.enableCommand("indentCodeBlock"),t.enableCommand("outdentCodeBlock"),t.enableCommand("codeBlock",(ve,ke={})=>{const Ie=we.model,Ae=we.model.document.selection,Se=ke&&ke.forceValue!==void 0?ke.forceValue:!xe.value;let Oe;ke.language||(ke.language=be[0].language),Oe=Se?Array.from(Ae.getSelectedBlocks()).filter(Me=>eo(Me)||function(De,Fe){return De.is("rootElement")||Fe.isLimit(De)?!1:Fe.checkChild(De.parent,"codeBlock")}(Me,Ie.schema)):Array.from(Ae.getSelectedBlocks()).filter(Me=>eo(Me));const Ve=to(Oe,Ie);Ie.change(()=>{for(const Me of Ve)t.markBlockFormat(Me,{commandName:"codeBlock",commandParams:[{...ke,forceValue:Se}],formatGroupId:"blockName"})})}),t.descriptionFactory.registerElementLabel("codeBlock",ve=>o(te,"ELEMENT_CODE_BLOCK",ve)),t.descriptionFactory.registerDescriptionCallback(ve=>{if(ve.type!="formatBlock")return;const ke=te.t,{data:Ie}=ve;if(!Ie||Ie.commandName!="codeBlock")return;const Ae=Ie.commandParams[0].language,Se=ke(be.find(Oe=>Oe.language===Ae).label).toLowerCase();return Ie.commandParams[0].forceValue?{type:"format",content:o(te,"*Set format:* %0",o(te,"ELEMENT_CODE_BLOCK",1)+" ("+Se+")")}:{type:"format",content:o(te,"*Remove format:* %0",o(te,"ELEMENT_CODE_BLOCK",1))}})}}function eo(Te){return Te.name=="codeBlock"}class H extends Plugin{afterInit(){const we=this.editor;we.plugins.has("CommentsEditing")&&we.plugins.get("TrackChangesEditing").enableCommand("addCommentThread")}}function io(Te,we,t){const te=[];for(const be of we.getItems())be.hasAttribute(Te)&&te.push(t.createRangeOn(be));return te}function _e(Te,we,{showActiveMarker:t=!0}={}){const te=Te.plugins.get("TrackChangesEditing");return(be,xe,ve)=>{if(!ve.consumable.test(xe.markerRange,be.name))return;const ke=xe.markerRange.getWalker(),Ie=xe.markerRange.start,Ae=Te.model.schema;let Se=null,Oe=null,Ve=!1,Me=!1;for(const Fe of ke){const Be=Fe.item;Ve=Ve||Ae.isContent(Be);const $e=ve.mapper.toViewElement(Be);if($e&&$e.getCustomProperty("addHighlight"))return;Fe.type=="elementEnd"&&Ae.isBlock(Be)&&!Ae.isLimit(Be)&&(Be.nextSibling||Ie.isAtEnd?Se&&Se.parent==Be||(Se=Be,De(Fe.previousPosition),Me=!0):Oe=Oe||Fe.previousPosition)}function De(Fe){const Be=ve.writer.createUIElement("span",{class:"ck-suggestion-marker-"+we}),$e=ve.mapper.toViewPosition(Fe);t&&te.activeMarkers.includes(xe.markerName)&&ve.writer.addClass("ck-suggestion-marker--active",Be),ve.writer.insert($e,Be),ve.mapper.bindElementToMarker(Be,xe.markerName)}Ve||Me||!Oe||De(Oe)}}class q extends Plugin{static get requires(){return[Delete]}init(){const we=this.editor,t=we.plugins.get("TrackChangesEditing");t.enableCommand("delete");const te=we.commands.get("deleteForward");t.enableCommand("deleteForward",(be,xe={})=>{const ve=we.model.createSelection(we.model.document.selection);ve.isCollapsed&&we.model.modifySelection(ve,{direction:"forward",unit:xe.unit});const ke=ve.getFirstRange(),Ie=LiveRange.fromRange(ke);let Ae;be(xe),Ae=Ie.root.rootName=="$graveyard"?we.model.createRange(ke.start):we.model.createRange(Ie.start,Ie.end),Ie.detach(),we.model.enqueueChange(te.buffer.batch,Se=>{te.buffer.lock(),Se.setSelection(Se.createRange(Ae.end)),te.buffer.unlock()})}),we.editing.downcastDispatcher.on("addMarker:suggestion:deletion",_e(we,"merge"),{priority:"high"}),we.data.downcastDispatcher.on("addMarker:suggestion:deletion",(be,xe,ve)=>{ve.options.showSuggestionHighlights&&_e(we,"merge",{showActiveMarker:!1}).bind(this)(be,xe,ve)},{priority:"high"}),we.editing.downcastDispatcher.on("removeMarker:suggestion:deletion",(be,xe,ve)=>{const ke=ve.mapper.markerNameToElements(xe.markerName);if(ke)for(const Ie of ke)Ie.is("uiElement")&&(ve.mapper.unbindElementFromMarkerName(Ie,xe.markerName),ve.writer.remove(Ie))},{priority:"high"})}}class z extends Plugin{afterInit(){const we=this.editor;if(!we.plugins.has("ListEditing"))return;const t=we.locale,te=we.plugins.get("TrackChangesEditing"),be=we.plugins.has("TodoListEditing"),xe=!!we.config.get("list.multiBlock");function ve(Ae){return{type:"format",content:""+o(t,"*Set format:* %0",Ae)}}function ke(Ae){return{type:"format",content:""+o(t,"*Remove format:* %0",Ae)}}te.enableDefaultAttributesIntegration("numberedList"),te.enableDefaultAttributesIntegration("bulletedList"),te.enableDefaultAttributesIntegration("customNumberedList"),te.enableDefaultAttributesIntegration("customBulletedList"),te.enableDefaultAttributesIntegration("indentList"),te.enableDefaultAttributesIntegration("outdentList"),te.enableDefaultAttributesIntegration("splitListItemAfter"),te.enableDefaultAttributesIntegration("splitListItemBefore"),te.registerBlockAttribute("listItemId"),te.registerBlockAttribute("listType"),te.registerBlockAttribute("listIndent"),xe&&(te.enableDefaultAttributesIntegration("mergeListItemBackward"),te.enableDefaultAttributesIntegration("mergeListItemForward")),be&&(te.enableDefaultAttributesIntegration("todoList"),te.enableDefaultAttributesIntegration("checkTodoList"),te.registerBlockAttribute("todoListChecked"),te.descriptionFactory.registerDescriptionCallback(Ae=>{const{data:Se}=Ae;if(Se&&Se.key=="todoListChecked")return{type:"format",content:Se.newValue?o(t,"*Check item*"):o(t,"*Uncheck item*")}}),this.editor.model.document.registerPostFixer(Ae=>{if(Ae.batch.isUndo)return!1;let Se=!1;const Oe=te.getSuggestions({skipNotAttached:!0}).filter(Ve=>te._getAttributeKey(Ve)==="todoListChecked");for(const Ve of Oe)Ve.getFirstRange().start.nodeAfter.getAttribute("listType")!="todo"&&(te._findSuggestions(Ve.getFirstRange(),"attribute").find(Me=>te._getAttributeKey(Me.suggestion)==="listType")||(Ae.removeMarker(Ve.getFirstMarker()),Se=!0));return Se})),te.descriptionFactory.registerAttributeLabel("listIndent",o(t,"FORMAT_INDENT"));const Ie={type:"format",content:""};te.descriptionFactory.registerDescriptionCallback(Ae=>{const{data:Se}=Ae;if(!Se||Se.key!="listType")return;let Oe=Ae.head;for(;Oe;){if(Oe.data&&((Oe.data.key=="listStyle"||Oe.data.key=="listMarkerStyle")&&(Oe.data.newValue&&Oe.data.newValue!="default"||Oe.data.oldValue!="default"&&!Se.newValue)||!xe&&Oe.data.key==m))return Ie;Oe=Oe.next}if(Se.newValue==null)switch(Se.oldValue){case"bulleted":return ke(o(t,"ELEMENT_BULLETED_LIST"));case"numbered":return ke(o(t,"ELEMENT_NUMBERED_LIST"));case"todo":return ke(o(t,"ELEMENT_TODO_LIST"))}switch(Se.newValue){case"bulleted":return ve(o(t,"ELEMENT_BULLETED_LIST"));case"numbered":return ve(o(t,"ELEMENT_NUMBERED_LIST"));case"todo":return ve(o(t,"ELEMENT_TODO_LIST"))}}),te.descriptionFactory.registerDescriptionCallback(Ae=>{const{data:Se}=Ae;if(Se&&Se.key=="listIndent")return Se.newValue==null||Se.oldValue==null&&Se.newValue==0?Ie:void 0}),te.descriptionFactory.registerDescriptionCallback(Ae=>{if(Ae.type!="attribute")return;const{data:Se}=Ae;if(!Se||Se.key!="listItemId")return;const Oe=le(Ae);return Oe=="newValue"?{type:"format",content:o(t,"*Merge:* list item")}:Oe=="oldValue"?{type:"format",content:o(t,"*Split:* list item")}:Ie}),we.model.document.registerPostFixer(Ae=>this.listItemIdFixer(Ae)),we.model.document.registerPostFixer(Ae=>this.noTrackChangesFixer(Ae)),we.model.document.registerPostFixer(Ae=>this.assureChains(Ae)),this._supportLegacySuggestions()}listItemIdFixer(we){if(we.batch.isUndo||!we.batch.isLocal)return!1;let t=!1;const te=this.editor.plugins.get("TrackChangesEditing").getSuggestions({skipNotAttached:!0}).filter(be=>be.data&&be.data.key=="listItemId").filter(be=>be.data.newValue&&be.data.oldValue);for(const be of te)le(be)||(we.removeMarker(be.getFirstMarker()),t=!0);return t}noTrackChangesFixer(we){if(we.batch.isUndo||!we.batch.isLocal)return!1;const t=this.editor.plugins.get("TrackChangesEditing");if(t.trackChangesCommand.value)return!1;let te=!1;const be=["listType","listItemId","listIndent","listStyle","listStart","listReversed","todoListCheck","listMarker","listMarkerStyle"],xe=this.editor.model.document.differ.getChanges().filter(ve=>ve.type=="attribute").filter(ve=>be.includes(ve.attributeKey));if(xe.length==0)return te;for(const ve of xe){const ke=t._findSuggestions(ve.range,"attribute").filter(Ie=>!Ie.meta.isNextTo).map(Ie=>Ie.suggestion).filter(Ie=>{const Ae=t._getAttributeKey(Ie);return be.includes(Ae)});if(ke.length){for(const Ie of ke)we.removeMarker(Ie.getFirstMarker());te=!0}}return te}assureChains(we){if(we.batch.isUndo||!we.batch.isLocal)return!1;const t=this.editor.plugins.get("TrackChangesEditing");let te=!1;const be=["listType","listItemId","listIndent","listStyle","listStart","listReversed","todoListCheck","listMarker","listMarkerStyle"];for(const ke of t.getSuggestions({skipNotAttached:!0})){const Ie=t._findSuggestions(ke.getFirstRange(),"attribute").map(Se=>Se.suggestion).filter(Se=>Se.data&&be.includes(Se.data.key));if(!Ie.length)continue;const Ae=Ie[0].head.attributes.groupId;if(!Ie.every(Se=>Se.attributes.groupId===Ae))for(const Se of Ie)ve(Se,Ae)&&(te=!0)}return te;function xe(ke,Ie){for(const Ae of t.getSuggestions({skipNotAttached:!0}).filter(Se=>Se.type=="attribute"&&Se.attributes.groupId==ke))Ae.setAttribute("groupId",Ie)}function ve(ke,Ie){let Ae=ke.head,Se=!1;for(;Ae;)Ae.attributes.groupId!=Ie&&(xe(Ae.attributes.groupId,Ie),Ae.setAttribute("groupId",Ie),Se=!0),Ae=Ae.next;return Se}}_supportLegacySuggestions(){const we=this.editor,t=we.locale,te=we.plugins.get("TrackChangesEditing");this._registerLegacyDescription(),te._suggestionFactory.registerCustomCallback("formatBlock","documentList","accept",function(be,xe){const ve=[];for(let ke of be)ke.start.nodeAfter===ke.end.parent&&(ke=we.model.createRange(we.model.createPositionAt(ke.start.nodeAfter,0))),ve.push(ke);we.model.change(ke=>{const Ie=we.model.document.selection,Ae=Array.from(Ie.getRanges()).map(Se=>LiveRange.fromRange(Se));ke.setSelection(ve),we.commands.get(xe.commandName).refresh(),xe.commandParams.push({forceDefaultExecution:!0}),we.execute(xe.commandName,...xe.commandParams),ke.setSelection(Ae);for(const Se of Ae)Se.detach()})}),te.descriptionFactory.registerElementLabel(function(be){const xe=!we.model.schema.isObject(be),ve=be.previousSibling,ke=be.nextSibling,Ie=be.getAttribute("listItemId"),Ae=!ve||ve.getAttribute("listItemId")!==Ie,Se=!ke||ke.getAttribute("listItemId")!==Ie;return xe&&!!Ie&&Ae&&Se},be=>o(t,"ELEMENT_LIST_ITEM",be))}_registerLegacyDescription(){const we=this.editor,t=we.locale;function te(be){const xe=we.commands.get("bulletedList").value,ve=we.commands.get("numberedList").value;return be==="numberedList"?xe:ve}we.plugins.get("TrackChangesEditing").descriptionFactory.registerDescriptionCallback(function(be){if(be.type!="formatBlock")return;const{data:xe}=be;if(!xe)return;let ve,ke,Ie,Ae;switch(xe.commandName){case"bulletedList":Ie=xe.commandParams[0].forceValue,Ae=te(xe.commandName),ve=Ie?"*Format:* insert into %0":"*Format:* remove from %0",!Ae&&we.config.get("list.multiBlock")||(ve="*Change to:* %0"),ke={type:"format",content:o(t,ve,o(t,"ELEMENT_BULLETED_LIST"))};break;case"numberedList":Ie=xe.commandParams[0].forceValue,Ae=te(xe.commandName),ve=Ie?"*Format:* insert into %0":"*Format:* remove from %0",!Ae&&we.config.get("list.multiBlock")||(ve="*Change to:* %0"),ke={type:"format",content:o(t,ve,o(t,"ELEMENT_NUMBERED_LIST"))};break;case"indentList":ve="*Indent:* %0",ke={type:"format",content:o(t,ve,o(t,"ELEMENT_LIST_ITEM"))};break;case"outdentList":ve=function(Se){const Oe=Se.getFirstRange();let Ve=Oe.start.nodeAfter;for(;Ve&&Oe.containsItem(Ve);){if(Ve.getAttribute("listIndent")>0)return!1;Ve=Ve.nextSibling}return!0}(be)?o(t,"*Format:* remove from %0",o(t,function(Se){return"ELEMENT_"+Se.getFirstRange().start.nodeAfter.getAttribute("listType").toUpperCase()+"_LIST"}(be))):o(t,"*Outdent:* %0",o(t,"ELEMENT_LIST_ITEM")),ke={type:"format",content:ve};break;case"mergeListItemBackward":case"mergeListItemForward":xe.multipleBlocks===!1&&(ve="*Merge:* %0",ke={type:"deletion",content:o(t,ve,o(t,"ELEMENT_LIST_ITEM"))})}return ke})}}function le(Te){let we=Te.getFirstRange().start.nodeAfter.previousSibling;for(;we;){const t=we.getAttribute("listItemId");if(!t)return!1;if(t==Te.data.newValue)return"newValue";if(t==Te.data.oldValue)return"oldValue";we=we.previousSibling}return!1}class ue extends Plugin{afterInit(){if(!this.editor.plugins.has("ListPropertiesEditing"))return;const we=this.editor.config.get("list.properties"),t=this.editor.plugins.get("TrackChangesEditing");we.styles&&(t.enableDefaultAttributesIntegration("listStyle"),t.registerBlockAttribute("listStyle")),we.reversed&&(t.enableDefaultAttributesIntegration("listReversed"),t.registerBlockAttribute("listReversed")),we.startIndex&&(t.enableDefaultAttributesIntegration("listStart"),t.registerBlockAttribute("listStart"));const te={type:"format",content:""};t.descriptionFactory.registerDescriptionCallback(this.handleDescriptions.bind(this));const be=this.editor.locale;t.descriptionFactory.registerAttributeLabel("listReversed",o(be,"FORMAT_LIST_REVERSED")),t.descriptionFactory.registerDescriptionCallback(xe=>{const{data:ve}=xe;if(ve&&ve.key=="listReversed")return ve.newValue==null||ve.newValue==0&&ve.oldValue==null?te:void 0}),t.descriptionFactory.registerAttributeLabel("listStart",o(be,"FORMAT_LIST_START")),t.descriptionFactory.registerDescriptionCallback(xe=>{const{data:ve}=xe;if(ve&&ve.key=="listStart")return ve.newValue==null||ve.newValue==1&&ve.oldValue==null?te:void 0}),this.editor.model.document.registerPostFixer(xe=>{if(xe.batch.isUndo)return!1;let ve=!1;const ke=t.getSuggestions({skipNotAttached:!0}).filter(Ie=>{const Ae=t._getAttributeKey(Ie);return Ae=="listStart"||Ae=="listReversed"});for(const Ie of ke){const Ae=Ie.getFirstRange().start.nodeAfter.getAttribute("listType");Ae=="numbered"||Ae=="customNumbered"||t._findSuggestions(Ie.getFirstRange(),"attribute").find(Se=>t._getAttributeKey(Se.suggestion)=="listType")||(xe.removeMarker(Ie.getFirstMarker()),ve=!0)}return ve}),this._registerLegacyDescription()}handleDescriptions(we){const t=this.editor.locale,{data:te}=we,be={type:"format",content:""};if(!te||te.key!="listStyle")return;if(!te.oldValue)return te.newValue=="default"?be:{type:"format",content:""+o(t,"*Set format:* %0",o(t,this._getTranslationKeyForListStyle(te.newValue)))};if(!te.newValue){if(te.oldValue=="default")return be;let ve=we.head;for(;ve;){if(ve.data&&ve.data.key=="listType"&&ve.data.newValue)return be;ve=ve.next}return{type:"format",content:""+o(t,"*Remove format:* %0",o(t,this._getTranslationKeyForListStyle(te.oldValue)))}}if(te.newValue!="default")return{type:"format",content:""+o(t,"*Set format:* %0",o(t,this._getTranslationKeyForListStyle(te.newValue)))};let xe=we.head;for(;xe;){if(xe.data&&xe.data.key=="listType"&&xe.data.newValue&&xe.data.oldValue)return be;xe=xe.next}return{type:"format",content:o(t,"*Set format:* %0",o(t,"ELEMENT_"+we.getFirstRange().start.nodeAfter.getAttribute("listType").toUpperCase()+"_LIST_DEFAULT"))}}_registerLegacyDescription(){const we=this.editor,t=we.locale;we.plugins.get("TrackChangesEditing").descriptionFactory.registerDescriptionCallback(te=>{if(te.type!="formatBlock")return;const{data:be}=te;if(!be)return;let xe,ve;switch(be.commandName){case"listStyle":xe="*Change to:* %0",ve={type:"format",content:o(t,xe,o(t,this._getTranslationKeyForListStyle(be.commandParams[0].type)))};break;case"listReversed":xe=be.commandParams[0].reversed?"*Format:* set order to reversed":"*Format:* set order to regular",ve={type:"format",content:o(t,xe)};break;case"listStart":xe="*Format:* set start index to %0",ve={type:"format",content:o(t,xe,be.commandParams[0].startIndex)}}return ve})}_getTranslationKeyForListStyle(we){return"ELEMENT_"+function(t){return pe.includes(t)?"bulleted":ye.includes(t)?"numbered":null}(we).toUpperCase()+"_LIST_"+we.toUpperCase().replace(/-/g,"_")}}const pe=["disc","circle","square"],ye=["decimal","decimal-leading-zero","lower-roman","upper-roman","lower-latin","upper-latin"];class W extends Plugin{static get requires(){return[Enter]}init(){const we=this.editor,t=we.plugins.get("TrackChangesEditing"),te=we.commands.get("enter");t.enableCommand("enter",()=>{we.model.change(be=>{const xe=we.model.document.selection,ve=xe.getFirstPosition(),ke=LiveRange.fromRange(xe.getFirstRange());if(te.enterBlock(be)){const Ie=we.model.createPositionAt(ve.parent.nextSibling,0),Ae=be.createRange(ve,Ie);t.markInsertion(Ae)}else be.setSelection(be.createRange(ke.end));ke.detach(),te.fire("afterExecute",{writer:be})})}),we.editing.downcastDispatcher.on("addMarker:suggestion:insertion",_e(we,"split"),{priority:"high"}),we.editing.downcastDispatcher.on("removeMarker:suggestion:insertion",(be,xe,ve)=>{const ke=ve.mapper.markerNameToElements(xe.markerName);if(ke)for(const Ie of ke)Ie.hasClass("ck-suggestion-marker-split")&&(ve.mapper.unbindElementFromMarkerName(Ie,xe.markerName),ve.writer.remove(Ie))},{priority:"high"}),we.data.downcastDispatcher.on("addMarker:suggestion:insertion",(be,xe,ve)=>{ve.options.showSuggestionHighlights&&_e(we,"split",{showActiveMarker:!1}).bind(this)(be,xe,ve)},{priority:"high"})}}class J extends Plugin{afterInit(){if(!this.editor.plugins.has("FindAndReplaceEditing"))return;const we=this.editor.plugins.get("TrackChangesEditing");we.enableCommand("find",this.handleFindCommand.bind(this)),we.enableCommand("findNext"),we.enableCommand("findPrevious"),we.enableCommand("replace"),we.enableCommand("replaceAll")}handleFindCommand(we,t,te={}){const be=this.editor.plugins.get("FindAndReplaceUtils");return we(xe=>(typeof t=="string"?be.findByTextCallback(t,te):t)(xe).filter(ve=>this._isInDeletionRange(ve,xe.item)===!1),te)}_isInDeletionRange(we,t){const te=this.editor.model.createRange(this.editor.model.createPositionAt(t,we.start),this.editor.model.createPositionAt(t,we.end));for(const be of this.editor.model.markers.getMarkersGroup("suggestion:deletion"))if(te.getIntersection(be.getRange())!==null)return!0;return!1}}const ro=[{pluginName:"FontSizeEditing",commandName:"fontSize"},{pluginName:"FontFamilyEditing",commandName:"fontFamily"},{pluginName:"FontColorEditing",commandName:"fontColor"},{pluginName:"FontBackgroundColorEditing",commandName:"fontBackgroundColor"}];class Q extends Plugin{afterInit(){const we=this.editor.locale,t=this.editor.plugins.get("TrackChangesEditing");for(const{pluginName:te,commandName:be}of ro)this.editor.plugins.has(te)&&(t.enableDefaultAttributesIntegration(be),t.registerInlineAttribute(be));we.t,t.descriptionFactory.registerAttributeLabel("fontSize",o(we,"FORMAT_FONT_SIZE")),t.descriptionFactory.registerAttributeLabel("fontFamily",o(we,"FORMAT_FONT_FAMILY")),t.descriptionFactory.registerAttributeLabel("fontColor",o(we,"FORMAT_FONT_COLOR")),t.descriptionFactory.registerAttributeLabel("fontBackgroundColor",o(we,"FORMAT_FONT_BACKGROUND")),this._registerLegacyDescription()}_registerLegacyDescription(){const we=this.editor,t=we.locale;we.plugins.get("TrackChangesEditing").descriptionFactory.registerDescriptionCallback(te=>{const be=t.t;if(te.type!="formatInline")return;const{data:xe}=te;if(xe!=null){if(xe.commandName=="fontSize"){const ve=xe.commandParams[0].value;if(ve){const ke=be(this.editor.plugins.get("FontSize").normalizeSizeOptions(this.editor.config.get("fontSize.options")).find(Ie=>Ie.model==ve).title).toLowerCase();return{type:"format",content:o(t,"*Set font size:* %0",ke)}}return{type:"format",content:o(t,"*Reset font size*")}}if(xe.commandName=="fontFamily"){const ve=xe.commandParams[0].value;return ve?{type:"format",content:o(t,"*Set font family:* %0",ve)}:{type:"format",content:o(t,"*Reset font family*")}}if(xe.commandName=="fontColor"){const ve=xe.commandParams[0].value;if(ve){const ke=normalizeColorOptions(this.editor.config.get("fontColor.colors")).find(Se=>Se.model==ve);let Ie=ve,Ae="";return ke&&(Ie=ke.label,Ae=be(Ie).toLowerCase()),{type:"format",content:o(t,"*Set font color:* %0",Ae).trim(),color:{value:ve,title:Ae||Ie}}}return{type:"format",content:o(t,"*Reset font color*")}}if(xe.commandName=="fontBackgroundColor"){const ve=xe.commandParams[0].value;if(ve){const ke=normalizeColorOptions(this.editor.config.get("fontBackgroundColor.colors")).find(Se=>Se.model==ve);let Ie=ve,Ae="";return ke&&(Ie=ke.label,Ae=be(Ie).toLowerCase()),{type:"format",content:o(t,"*Set font background color:* %0",Ae).trim(),color:{value:ve,title:Ae||Ie}}}return{type:"format",content:o(t,"*Reset font background color*")}}}})}}class X extends Plugin{afterInit(){const we=this.editor,t=we.plugins.get("TrackChangesEditing"),te=we.commands.get("copyFormat"),be=we.commands.get("pasteFormat");te&&be&&(t.enableDefaultAttributesIntegration("pasteFormat"),t.enableCommand("copyFormat"),this._registerLegacyDescription())}_registerLegacyDescription(){const we=this.editor,t=we.locale;we.plugins.get("TrackChangesEditing").descriptionFactory.registerDescriptionCallback(te=>{if(te.type!="formatBlock"&&te.type!="formatInline")return;const{data:be}=te;if(be&&be.commandName==="pasteFormat"){const xe=[],ve=be.commandParams[0];for(const[ke,Ie]of Object.entries(ve))xe.push(so(we,ke,Ie));return xe.length?{type:"format",content:o(t,"*Set format to:* %0",xe.join(", "))}:{type:"format",content:o(t,"*Remove all formatting*")}}})}}function so(Te,we,t){const te=Te.locale.t,be=we.split(/(?=[A-Z])/).join(" "),xe=te(be.charAt(0).toUpperCase()+be.slice(1)).toLowerCase();if(typeof t=="boolean")return xe;if(we==="fontColor"||we==="fontBackgroundColor"){const ve=normalizeColorOptions(Te.config.get("fontColor.colors")).find(ke=>ke.model==t);return xe+" ("+(ve?te(ve.label).toLowerCase():t)+")"}if(we==="fontSize"&&isNaN(parseFloat(t))){const ve=Te.plugins.get("FontSize").normalizeSizeOptions(Te.config.get("fontSize.options")).find(ke=>ke.model==t);return xe+" ("+(ve?te(ve.title).toLowerCase():t)+")"}return xe+" ("+t+")"}class Y extends Plugin{constructor(){super(...arguments);Re(this,"_headingOptions")}afterInit(){const t=this.editor;if(!t.plugins.has("HeadingEditing"))return;this._headingOptions=t.config.get("heading.options");const te=t.locale,be=t.plugins.get("TrackChangesEditing");be.enableDefaultAttributesIntegration("heading");for(const ke of this._headingOptions)ke.model!="paragraph"&&be.descriptionFactory.registerElementLabel(ke.model,Ie=>{const Ae=this._getHeadingLevel(ke.model);return Ae!==null?xe(Ie,Ae):ve(Ie,ke.title)});function xe(ke,Ie){return o(te,"ELEMENT_HEADING",[ke,Ie])}function ve(ke,Ie){return o(te,"ELEMENT_HEADING_CUSTOM",[ke,Ie])}this._registerLegacyDescription()}_registerLegacyDescription(){const t=this.editor,te=t.locale;function be(xe,ve){return o(te,"ELEMENT_HEADING_CUSTOM",[xe,ve])}t.plugins.get("TrackChangesEditing").descriptionFactory.registerDescriptionCallback(xe=>{if(xe.type!="formatBlock")return;const{data:ve}=xe;if(ve&&ve.commandName=="heading"){const Ae=ve.commandParams[0].value,Se=this._getHeadingLevel(Ae);if(Se!==null)return{type:"format",content:o(te,"*Change to:* %0",(ke=1,Ie=Se,o(te,"ELEMENT_HEADING",[ke,Ie])))};const Oe=this._headingOptions.find(Ve=>Ve.model===Ae).title;return{type:"format",content:o(te,"*Change to:* %0",be(1,Oe))}}var ke,Ie})}_getHeadingLevel(t){var xe;const te=t.match(/^heading(\d+)/);if(te)return te[1];const be=(xe=this._headingOptions)==null?void 0:xe.find(ve=>ve.model==t);if(be&&be.view){const ve=be.view,ke=(ve.name??ve).match(/^h(\d+)/);if(ke)return ke[1]}return null}}class Z extends Plugin{afterInit(){const we=this.editor;if(!we.plugins.has("HighlightEditing"))return;const t=we.plugins.get("TrackChangesEditing"),te=we.locale;t.enableDefaultAttributesIntegration("highlight"),t.registerInlineAttribute("highlight"),t.descriptionFactory.registerAttributeLabel("highlight",o(te,"FORMAT_HIGHLIGHT")),this._registerLegacyDescription()}_registerLegacyDescription(){const we=this.editor,t=we.locale;we.plugins.get("TrackChangesEditing").descriptionFactory.registerDescriptionCallback(te=>{if(te.type!="formatInline")return;const{data:be}=te;if(be&&be.commandName=="highlight"){const xe=t.t,ve=be.commandParams[0].value;if(ve){const ke=we.config.get("highlight.options").find(Ae=>Ae.model==ve),Ie=xe(ke.title).toLowerCase();return{type:"format",content:o(t,"*Set highlight:* %0",Ie),color:{value:ke.color,title:ke.title}}}return{type:"format",content:o(t,"*Remove highlight*",o(t,"FORMAT_HIGHLIGHT"))}}})}}class tt extends Plugin{afterInit(){const we=this.editor;if(!we.plugins.has("HorizontalLineEditing"))return;we.plugins.get("TrackChangesEditing").enableCommand("horizontalLine");const t=we.plugins.get("TrackChangesEditing"),te=we.locale;t.descriptionFactory.registerElementLabel("horizontalLine",be=>o(te,"ELEMENT_HORIZONTAL_LINE",be)),we.conversion.for("dataDowncast").elementToStructure({model:"horizontalLine",view:(be,{writer:xe,options:ve})=>{if(!ve.showSuggestionHighlights)return null;const ke=xe.createContainerElement("div"),Ie=xe.createEmptyElement("hr");return xe.addClass("ck-horizontal-line",ke),xe.insert(xe.createPositionAt(ke,0),Ie),ke},converterPriority:"high"})}}class et extends Plugin{afterInit(){const we=this.editor;if(!we.plugins.has("HtmlEmbed"))return;const t=we.plugins.get("TrackChangesEditing"),te=we.locale;t.descriptionFactory.registerElementLabel("rawHtml",be=>o(te,"ELEMENT_HTML_EMBED",be)),t.enableDefaultAttributesIntegration("htmlEmbed"),t.registerBlockAttribute("value"),t.descriptionFactory.registerDescriptionCallback(be=>{if(be.type!="attribute")return;const{data:xe}=be;if(xe&&xe.key=="value"&&be.getFirstRange().start.nodeAfter.is("element","rawHtml")){const ve=o(te,"ELEMENT_HTML_EMBED");return{type:"format",content:o(te,"*Change %0 content*",ve)}}}),this._registerLegacyDescription()}_registerLegacyDescription(){const we=this.editor,t=we.locale;we.plugins.get("TrackChangesEditing").descriptionFactory.registerDescriptionCallback(te=>{if(te.type!="formatBlock")return;const{data:be}=te;if(be&&be.commandName=="htmlEmbed"){const xe=o(t,"ELEMENT_HTML_EMBED");return{type:"format",content:o(t,"*Change %0 content*",xe)}}})}}class it extends Plugin{afterInit(){const we=this.editor;if(!we.plugins.has("ImageEditing"))return;const t=we.plugins.get("TrackChangesEditing"),te=we.plugins.get("ImageUtils"),be=we.locale;t.enableCommand("insertImage"),t.descriptionFactory.registerElementLabel("imageBlock",Ie=>o(be,"ELEMENT_IMAGE",Ie)),t.descriptionFactory.registerElementLabel("imageInline",Ie=>o(be,"ELEMENT_INLINE_IMAGE",Ie)),t.descriptionFactory.registerElementLabel("caption",()=>o(be,"ELEMENT_CAPTION")),we.plugins.has("ImageUploadEditing")&&t.enableCommand("uploadImage"),we.plugins.has("ImageBlockEditing")&&we.plugins.has("ImageInlineEditing")&&(t.enableCommand("imageTypeInline",(Ie,Ae)=>{const Se=te.getClosestSelectedImageElement(we.model.document.selection);we.model.change(()=>{t.markBlockFormat(Se,{commandName:"imageTypeInline",commandParams:[Ae]},[],"convertBlockImageToInline")})}),t.enableCommand("imageTypeBlock",(Ie,Ae)=>{we.model.change(Se=>{let Oe=te.getClosestSelectedImageElement(we.model.document.selection),Ve=Se.createRangeOn(Oe);const Me=LivePosition.fromPosition(Ve.start,"toPrevious"),De=LivePosition.fromPosition(Ve.end,"toNext");t.forceDefaultExecution(()=>Ie(Ae)),Oe=te.getClosestSelectedImageElement(we.model.document.selection),Ve=Se.createRangeOn(Oe);const Fe=Se.createRange(Me,De);Me.detach(),De.detach(),t.markBlockFormat(Oe,{commandName:"imageTypeInline",commandParams:[Ae]},[],"convertInlineImageToBlock"),Fe.start.isBefore(Ve.start)&&t.markInsertion(Se.createRange(Fe.start,Ve.start),"convertInlineImageToBlock"),Ve.end.isBefore(Fe.end)&&t.markInsertion(Se.createRange(Ve.end,Fe.end),"convertInlineImageToBlock")})}),t._suggestionFactory.registerCustomCallback("formatBlock","convertInlineImageToBlock","join",()=>!1),t._suggestionFactory.registerCustomCallback("formatBlock","convertInlineImageToBlock","accept",()=>!1),t._suggestionFactory.registerCustomCallback("formatBlock","convertInlineImageToBlock","discard",t._suggestionFactory.getSuggestionCallback("formatBlock","","accept")),t._suggestionFactory.registerCustomCallback("insertion","convertInlineImageToBlock","join",()=>!1),t._suggestionFactory.registerCustomCallback("insertion","convertInlineImageToBlock","discard",([Ie])=>{const Ae=t._suggestionFactory.getSuggestionCallback("insertion","","discard");let Se=Ie.start,Oe=Ie.end;const Ve=we.model.schema.getNearestSelectionRange(Se,"backward"),Me=we.model.schema.getNearestSelectionRange(Oe,"forward");Ve.isCollapsed&&(Se=Ve.start),Me.isCollapsed&&(Oe=Me.end),Ae([we.model.createRange(Se,Oe)])}),t._suggestionFactory.registerCustomCallback("formatBlock","convertInlineImageToBlock","chain",ke),t._suggestionFactory.registerCustomCallback("insertion","convertInlineImageToBlock","chain",ke)),we.plugins.has("ImageCaptionEditing")&&(t.enableCommand("toggleImageCaption",(Ie,Ae)=>{const Se=we.plugins.get("ImageCaptionUtils");let Oe=te.getClosestSelectedImageElement(we.model.document.selection),Ve=Se.getCaptionFromImageModelElement(Oe);we.model.change(()=>{if(Ve)return void t.markDeletion(we.model.createRangeOn(Ve));const Me=te.isBlockImage(Oe);Ie(Ae),Oe=te.getClosestSelectedImageElement(we.model.document.selection),Ve=Se.getCaptionFromImageModelElement(Oe),t.markInsertion(we.model.createRangeOn(Ve),Me?null:"imageCaption")})}),t._suggestionFactory.registerCustomCallback("insertion","imageCaption","chain",ke));const xe=[{type:"formatBlock",subType:"imageStylePreApply"},{type:"insertion",subType:"imageCaption"},{type:"formatBlock",subType:"convertInlineImageToBlock"},{type:"insertion",subType:"convertInlineImageToBlock"}];function ve(Ie,Ae){const Se=xe.findIndex(({type:De,subType:Fe})=>Ie.type==De&&Ie.subType==Fe),Oe=xe.findIndex(({type:De,subType:Fe})=>Ae.type==De&&Ae.subType==Fe);if(Se<0||Oe<0)return!1;const Ve=Ie.getFirstRange(),Me=Ae.getFirstRange();if((Se==0||Se==1)&&Oe==2&&Ve.isIntersecting(Me))return!0;if(Se==2&&Oe==3){const De=t._findSuggestions(Ve,"insertion").filter(({suggestion:Fe,meta:Be})=>Be.isOwn&&Fe.subType=="convertInlineImageToBlock");if(De.length>1&&Me.end.isEqual(Ve.start)||De.length==1&&(Ve.start.isEqual(Me.end)||Ve.end.isEqual(Me.start)))return!0}if(Se==3&&Oe==3&&Ve.start.isBefore(Me.start)){const De=Ve.end.nodeAfter,Fe=Me.start.nodeBefore;return te.isBlockImage(De)&&De===Fe}return!1}function ke(Ie,Ae){return ve(Ie,Ae)?[Ie,Ae]:ve(Ae,Ie)?[Ae,Ie]:null}we.plugins.has("ImageResize")&&(t.enableDefaultAttributesIntegration("resizeImage"),t.registerBlockAttribute("resizedWidth"),t.descriptionFactory.registerAttributeLabel("resizedWidth",o(be,"FORMAT_IMAGE_SIZE"))),we.plugins.has("ImageTextAlternativeEditing")&&(t.enableDefaultAttributesIntegration("imageTextAlternative"),t.registerBlockAttribute("alt")),t.descriptionFactory.registerDescriptionCallback(Ie=>{if(xe.find(({type:Ae,subType:Se})=>Ie.type==Ae&&Ie.subType==Se))return Ie.previous?{}:void 0}),t.descriptionFactory.registerDescriptionCallback(Ie=>{if(Ie.type=="insertion"||Ie.type=="deletion"){const Ae=Ie.getContainedElement();if(Ae&&Ae.is("element","caption"))return{type:Ie.type=="insertion"?"addObject":"removeObject",element:Ae,quantity:1}}}),t.descriptionFactory.registerDescriptionCallback(Ie=>Ie.type=="formatBlock"&&Ie.subType=="convertInlineImageToBlock"?{type:"format",content:"Inline image to block image"}:Ie.type=="formatBlock"&&Ie.subType=="convertBlockImageToInline"?{type:"format",content:"Block image to inline image"}:void 0),t.descriptionFactory.registerDescriptionCallback(Ie=>{if(Ie.type!="attribute")return;const{data:Ae}=Ie;if(!Ae||Ae.key!="alt")return;const Se=Ae.newValue;return Se?{type:"format",content:o(be,"*Set image text alternative:* %0",'"'+Se+'"')}:{type:"format",content:o(be,"*Remove image text alternative*")}}),this._registerLegacyDescription()}_registerLegacyDescription(){const we=this.editor,t=we.locale;we.plugins.get("TrackChangesEditing").descriptionFactory.registerDescriptionCallback(te=>{if(te.type!="formatBlock"&&te.type!="formatInline")return;const{data:be}=te;if(be){if(be.commandName=="imageTextAlternative"){const xe=be.commandParams[0].newValue;return xe?{type:"format",content:o(t,"*Set image text alternative:* %0",'"'+xe+'"')}:{type:"format",content:o(t,"*Remove image text alternative*")}}if(be.commandName=="resizeImage"){const xe=be.commandParams[0].width;return xe?{type:"format",content:o(t,"*Set image width:* %0",xe)}:{type:"format",content:o(t,"*Reset image width*")}}}})}}class st extends Plugin{afterInit(){if(!this.editor.plugins.has("ImageEditing"))return;const we=this.editor.locale,t=this.editor.plugins.get("TrackChangesEditing");t.enableDefaultAttributesIntegration("replaceImageSource"),t.registerBlockAttribute("src"),t.descriptionFactory.registerDescriptionCallback(te=>{if(te.type!="attribute")return;const{data:be}=te;return be&&be.key=="src"?be.newValue&&be.oldValue?{type:"format",content:o(we,"*Replace image URL*")}:{type:"format",content:""}:void 0}),this._handleLegacySuggestions()}_handleLegacySuggestions(){const we=this.editor.plugins.get("TrackChangesEditing");we._suggestionFactory.registerCustomCallback("formatBlock","replaceImageSource","accept",we._suggestionFactory.getSuggestionCallback("formatBlock",null,"discard")),we._suggestionFactory.registerCustomCallback("formatBlock","replaceImageSource","discard",we._suggestionFactory.getSuggestionCallback("formatBlock",null,"accept")),this._registerLegacyDescription()}_registerLegacyDescription(){const we=this.editor,t=we.locale;we.plugins.get("TrackChangesEditing").descriptionFactory.registerDescriptionCallback(te=>{if(te.type!="formatBlock"&&te.type!="formatInline")return;const{data:be}=te;if(!(!be||be.commandName!="replaceImageSource"))return{type:"format",content:o(t,"*Format:* replace image URL")}})}}class nt extends Plugin{afterInit(){const we=this.editor;if(!we.plugins.has("ImageStyleEditing"))return;const t=we.plugins.get("TrackChangesEditing"),te=we.plugins.get("ImageUtils"),be={};t.enableCommand("imageStyle",(ke,Ie)=>{const Ae=we.plugins.get("Users").me,Se=we.commands.get("imageStyle");let Oe=te.getClosestSelectedImageElement(we.model.document.selection),Ve=we.model.createRangeOn(Oe),Me=Se.value;if(Me==Ie.value)return;const De={commandName:"imageStyle",commandParams:[Ie],formatGroupId:uid()};we.model.change(()=>{if(t.getSuggestions().filter(Fe=>Fe.isInContent&&Ae==Fe.author&&(Fe.type=="formatBlock"||Fe.type=="formatInline")&&(Fe.subType=="imageStylePreApply"||Fe.subType=="imageStylePostApply")&&Fe.getFirstRange().isEqual(Ve)).forEach(Fe=>t.discardSuggestion(Fe.head)),Oe=te.getClosestSelectedImageElement(we.model.document.selection),Ve=we.model.createRangeOn(Oe),Se.refresh(),we.commands.get("imageTypeInline").refresh(),we.commands.get("imageTypeBlock").refresh(),Me=Se.value,Me!=Ie.value)return te.isInlineImage(Oe)&&Se.shouldConvertImageType(Ie.value,Oe)?(ke({...Ie,setImageSizes:!1}),Oe=te.getClosestSelectedImageElement(we.model.document.selection),void t.markBlockFormat(Oe,{...De,commandReversedParams:[{value:Me||null,setImageSizes:!1}]},[],"imageStylePreApply")):void(te.isBlockImage(Oe)?t.markBlockFormat(Oe,De,[],"imageStylePostApply"):t.markInlineFormat(Ve,De,"imageStylePostApply"))})});for(const ke of we.plugins.get("ImageStyleEditing").normalizedStyles)be[ke.name]=ke.title.toLowerCase();t._suggestionFactory.registerCustomCallback("formatBlock","imageStylePreApply","join",()=>!1),t._suggestionFactory.registerCustomCallback("formatBlock","imageStylePostApply","join",()=>!1),t._suggestionFactory.registerCustomCallback("formatInline","imageStylePostApply","join",()=>!1),t._suggestionFactory.registerCustomCallback("formatBlock","imageStylePreApply","accept",([ke])=>{te.setImageNaturalSizeAttributes(ke.getContainedElement())}),t._suggestionFactory.registerCustomCallback("formatBlock","imageStylePreApply","discard",(ke,Ie)=>{t._suggestionFactory.getSuggestionCallback("formatBlock","","accept")(ke,{commandName:Ie.commandName,commandParams:Ie.commandReversedParams})}),t._suggestionFactory.registerCustomCallback("formatBlock","imageStylePreApply","chain",function(ke,Ie){return ve(ke,Ie)?[ke,Ie]:ve(Ie,ke)?[Ie,ke]:null});const xe=[{type:"formatBlock",subType:"imageStylePreApply"},{type:"insertion",subType:"imageCaption"},{type:"formatBlock",subType:"convertInlineImageToBlock"},{type:"insertion",subType:"convertInlineImageToBlock"}];function ve(ke,Ie){const Ae=xe.findIndex(({type:Me,subType:De})=>ke.type==Me&&ke.subType==De),Se=xe.findIndex(({type:Me,subType:De})=>Ie.type==Me&&Ie.subType==De);if(Ae<0||Se<0)return!1;const Oe=ke.getFirstRange(),Ve=Ie.getFirstRange();if((Ae==0||Ae==1)&&Se==2&&Oe.isIntersecting(Ve))return!0;if(Ae==2&&Se==3){const Me=t._findSuggestions(Oe,"insertion").filter(({suggestion:De,meta:Fe})=>Fe.isOwn&&De.subType=="convertInlineImageToBlock");if(Me.length>1&&Ve.end.isEqual(Oe.start)||Me.length==1&&(Oe.start.isEqual(Ve.end)||Oe.end.isEqual(Ve.start)))return!0}if(Ae==3&&Se==3&&Oe.start.isBefore(Ve.start)){const Me=Oe.end.nodeAfter,De=Ve.start.nodeBefore;return te.isBlockImage(Me)&&Me===De}return!1}we.model.document.registerPostFixer(()=>{let ke=!1;const Ie=Array.from(we.model.document.differ.getChangedMarkers());for(const{name:Ae,data:Se}of Ie){const{group:Oe,type:Ve,subType:Me,id:De}=t._splitMarkerName(Ae);if(Oe=="suggestion"&&t.hasSuggestion(De)){if(Ve=="formatBlock"&&(Me=="imageStylePreApply"||Me=="imageStylePostApply")){const Fe=t.getSuggestion(De);if(Se.newRange){const Be=Fe.getFirstRange().getContainedElement();if(te.isBlockImage(Be))continue;t.discardSuggestion(Fe),ke=!0}}if(Ve=="insertion"&&Me=="imageCaption"&&!Se.newRange){const Fe=t.getSuggestion(De);Fe.next&&Fe.next.isInContent&&(t.discardSuggestion(Fe.next),ke=!0)}}}return ke}),this._registerLegacyDescription(be)}_registerLegacyDescription(we){const t=this.editor,te=t.locale;t.plugins.get("TrackChangesEditing").descriptionFactory.registerDescriptionCallback(be=>{if(be.type!="formatBlock"&&be.type!="formatInline")return;const{data:xe}=be;if(!xe||xe.commandName!="imageStyle")return;const ve=xe.commandParams[0].value;return ke(ve==="side"?o(te,"FORMAT_SIDE_IMAGE"):we[ve]||ve);function ke(Ie){return{type:"format",content:o(te,"*Format:* %0",Ie)}}})}}class ot extends Plugin{constructor(t){super(t);Re(this,"_trackChangesValueDuringImport");Re(this,"_trackChangesExecuted");this._trackChangesValueDuringImport=!1,this._trackChangesExecuted=!1}afterInit(){const t=this.editor,te=t.commands.get("importWord"),be=t.commands.get("trackChanges");te&&(te.on("execute",(xe,[,ve])=>{this._trackChangesValueDuringImport=be.value,ve.collaboration_features.track_changes=!this._trackChangesValueDuringImport},{priority:"high"}),this.listenTo(te,"dataInsert",this._handleImportedData.bind(this)),this.listenTo(te,"dataInsert",()=>{this._trackChangesExecuted&&(be.execute(),this._trackChangesExecuted=!1)},{priority:"lowest"}),t.plugins.get("TrackChangesEditing").enableCommand("importWord"))}_handleImportedData(t,te){const{suggestions:be}=te,xe=this.editor.commands.get("trackChanges"),ve=xe.value;this._trackChangesValueDuringImport!==ve&&(xe.execute(),this._trackChangesExecuted=!0),be&&be.forEach(({id:ke,type:Ie,author:Ae,created_at:Se})=>{const Oe={id:ke,type:Ie,authorId:this.editor.plugins.get("Users").me.id,createdAt:new Date,data:null,hasComments:!1,attributes:{"@external":{authorName:Ae,createdAt:Se?new Date(Se):new Date,source:"importWord"}}};this.editor.plugins.get("TrackChangesEditing")._setSuggestionData(Oe)})}}class rt extends Plugin{afterInit(){const we=this.editor,t=we.plugins.get("TrackChangesEditing");if(we.plugins.has("IndentEditing")&&(t.enableCommand("indent"),t.enableCommand("outdent")),we.plugins.has("IndentBlock"))for(const be of["indentBlock","outdentBlock"])t.enableDefaultAttributesIntegration(be);const te=we.locale;t.registerBlockAttribute("blockIndent"),t.descriptionFactory.registerAttributeLabel("blockIndent",o(te,"FORMAT_INDENT")),this._registerLegacyDescription()}_registerLegacyDescription(){const we=this.editor,t=we.locale,te=we.plugins.get("TrackChangesEditing");te.descriptionFactory.registerDescriptionCallback(be=>{if(be.type!="formatBlock")return;const{data:xe}=be;if(!xe||xe.commandName!="indentBlock"&&xe.commandName!="outdentBlock")return;const ve=be.getItems()[0],ke=te.descriptionFactory.getItemLabel(ve);return xe.commandName=="indentBlock"?{type:"format",content:o(t,"*Indent:* %0",ke)}:xe.commandName=="outdentBlock"?{type:"format",content:o(t,"*Outdent:* %0",ke)}:void 0})}}class at extends Plugin{static get requires(){return[Input]}init(){this.editor.plugins.get("TrackChangesEditing").enableCommand("input")}}class ct extends Plugin{afterInit(){const we=this.editor;if(!we.plugins.has("LinkEditing"))return;const t=we.plugins.get("TrackChangesEditing"),te=we.commands.get("link");t.enableDefaultAttributesIntegration("link"),t.enableDefaultAttributesIntegration("unlink"),t.registerInlineAttribute("linkHref");for(const be of te.manualDecorators)t.registerInlineAttribute(be.id),t.descriptionFactory.registerAttributeLabel(be.id,"link ("+be.label.toLowerCase()+")");t.descriptionFactory.registerDescriptionCallback(be=>{if(be.type!="attribute")return;const{data:xe}=be;if(!xe||xe.key!="linkHref")return;const ve=xe.newValue,ke=we.locale;return{type:"format",content:ve==null?o(ke,"*Remove link*"):o(ke,"*Set link:* %0",'"'+ve+'"')}}),this._registerLegacyDescription()}_registerLegacyDescription(){const we=this.editor,t=we.locale;we.plugins.get("TrackChangesEditing").descriptionFactory.registerDescriptionCallback(te=>{if(te.type!="formatInline")return;const{data:be}=te;if(be){if(be.commandName=="link"){const xe=be.commandParams[0];return{type:"format",content:o(t,"*Set link:* %0",'"'+xe+'"')}}return be.commandName=="unlink"?{type:"format",content:o(t,"*Remove link*")}:void 0}})}}class ut extends Plugin{afterInit(){const we=this.editor,t=we.locale;if(!we.plugins.has("LegacyListEditing"))return;const te=we.plugins.get("TrackChangesEditing"),be=we.plugins.has("LegacyTodoListEditing");function xe(ke){return()=>{const Ie=we.model.document.selection,Ae=we.commands.get(ke);if(Ae.value)return void we.execute("paragraph",{});const Se=ke.slice(0,-4),Oe=function(Ve,Me,De){let Fe=Array.from(Ve).filter($e=>function(Ue,He){return He.checkChild(Ue.parent,"listItem")&&!He.isObject(Ue)}($e,De));Fe=Fe.filter($e=>!$e.is("element","listItem")||$e.getAttribute("listType")!=Me);const Be=new Set;for(const $e of Fe)$e.is("element","listItem")?Be.add(me($e)):Be.add($e);return Array.from(Be)}(Ie.getSelectedBlocks(),Se,we.model.schema);we.model.change(()=>{for(const Ve of Oe)te.markBlockFormat(Ve,{commandName:ke,commandParams:[{forceValue:!Ae.value}],formatGroupId:"blockName"},fe(Ve))})}}function ve(ke){return()=>{const Ie=function(Se){let Oe=Array.from(Se);const Ve=Oe.findIndex(Me=>Me.name!="listItem");return Ve>-1&&(Oe=Oe.slice(0,Ve)),Oe}(we.model.document.selection.getSelectedBlocks()),Ae=we.model.createRange(we.model.createPositionAt(Ie[0],"before"),we.model.createPositionAt(Ie[Ie.length-1],"end"));we.model.change(()=>{te.markBlockFormat(Ae,{commandName:ke,commandParams:[],formatGroupId:"listIndent"},function(Se){const Oe=new Set;for(const Ve of Se){let Me=Ve.nextSibling;for(;Me&&Me.getAttribute("listIndent")>Ve.getAttribute("listIndent");)Oe.add(Me),Me=Me.nextSibling}return Array.from(Oe)}(Ie))})}}te.enableCommand("numberedList",xe("numberedList")),te.enableCommand("bulletedList",xe("bulletedList")),be&&te.enableCommand("todoList",xe("todoList")),te.enableCommand("indentList",ve("indentList")),te.enableCommand("outdentList",ve("outdentList")),be&&te.enableCommand("checkTodoList",()=>{const ke=we.commands.get("checkTodoList"),Ie=Array.from(ke._selectedElements);Ie.filter(Ae=>Ae.getAttribute("todoListChecked")!=ke.value),we.model.change(()=>{for(const Ae of Ie)te.markBlockFormat(Ae,{commandName:"checkTodoList",commandParams:[{forceValue:!ke.value}]})})}),te.descriptionFactory.registerElementLabel("listItem",ke=>o(t,"ELEMENT_LIST_ITEM",ke)),te.descriptionFactory.registerDescriptionCallback(ke=>{if(ke.type!="formatBlock"&&ke.type!="formatInline")return;const{data:Ie}=ke;if(Ie){if(Ie.commandName=="numberedList"||Ie.commandName=="bulletedList"||Ie.commandName=="todoList")switch(Ie.commandName.replace("List","")){case"bulleted":return Ae(o(t,"ELEMENT_BULLETED_LIST"));case"numbered":return Ae(o(t,"ELEMENT_NUMBERED_LIST"));case"todo":return Ae(o(t,"ELEMENT_TODO_LIST"))}if(Ie.commandName=="indentList")return{type:"format",content:o(t,"*Indent:* %0",o(t,"ELEMENT_LIST_ITEM"))};if(Ie.commandName=="outdentList")return{type:"format",content:o(t,"*Outdent:* %0",o(t,"ELEMENT_LIST_ITEM"))};if(Ie.commandName=="checkTodoList")return Ie.commandParams[0].forceValue?{type:"format",content:o(t,"*Check item*")}:{type:"format",content:o(t,"*Uncheck item*")}}function Ae(Se){return{type:"format",content:o(t,"*Change to:* %0",Se)}}})}}function me(Te){const we=Te.getAttribute("listIndent");if(we==0)return Te;let t=Te;for(;Te.previousSibling&&Te.previousSibling.is("element","listItem");){const te=Te.previousSibling.getAttribute("listIndent");if(te==we)t=Te.previousSibling;else if(te<we)break;Te=Te.previousSibling}return t}function fe(Te){const we=[];if(Te.is("element","listItem")&&Te.getAttribute("listIndent")>0){let t=Te.nextSibling;for(;t&&t.name=="listItem"&&t.getAttribute("listIndent")==Te.getAttribute("listIndent");)we.push(t),t=t.nextSibling}return we}class K extends Plugin{afterInit(){if(!this.editor.plugins.has("LegacyListPropertiesEditing"))return;const we=this.editor.config.get("list.properties"),t=this.editor.plugins.get("TrackChangesEditing");we.styles&&t.enableCommand("listStyle",this.handleListStyleCommand.bind(this)),we.reversed&&t.enableCommand("listReversed",this.handleListReversedCommand.bind(this)),we.startIndex&&t.enableCommand("listStart",this.handleListStartCommand.bind(this)),t.descriptionFactory.registerDescriptionCallback(this.handleDescriptions.bind(this))}handleListStyleCommand(we,t={}){const te=this.editor.plugins.get("TrackChangesEditing"),be=this._getSuggestionBlocksForListStyle();this.editor.model.change(()=>{te.markMultiRangeBlockFormat(be,{commandName:"listStyle",commandParams:[{type:t.type}],formatGroupId:"listStyle"})})}handleListReversedCommand(we,t={}){const te=this.editor.plugins.get("TrackChangesEditing"),be=this._getSuggestionBlocks(ve=>ve.is("element","listItem")&&ve.getAttribute("listType")==="numbered");if(be.length<1)return;const xe=be.map(ve=>this.editor.model.createRange(this.editor.model.createPositionAt(ve,"before"),this.editor.model.createPositionAt(ve,0)));this.editor.model.change(()=>{te.markMultiRangeBlockFormat(xe,{commandName:"listReversed",commandParams:[{reversed:t.reversed}],formatGroupId:"listReversed"})})}handleListStartCommand(we,t={}){const te=this.editor.plugins.get("TrackChangesEditing"),be=this._getSuggestionBlocks(ve=>ve.is("element","listItem")&&ve.getAttribute("listType")==="numbered");if(be.length<1)return;const xe=be.map(ve=>this.editor.model.createRange(this.editor.model.createPositionAt(ve,"before"),this.editor.model.createPositionAt(ve,0)));this.editor.model.change(()=>{te.markMultiRangeBlockFormat(xe,{commandName:"listStart",commandParams:[{startIndex:t.startIndex}],formatGroupId:"listStart"})})}handleDescriptions(we){if(we.type!="formatBlock"&&we.type!="formatInline")return;const t=this.editor.locale,{data:te}=we;if(!te)return;let be,xe;switch(te.commandName){case"listStyle":be="*Change to:* %0",xe={type:"format",content:o(t,be,o(t,this._getTranslationKeyForListStyle(te.commandParams[0].type)))};break;case"listReversed":be=te.commandParams[0].reversed?"*Format:* set order to reversed":"*Format:* set order to regular",xe={type:"format",content:o(t,be)};break;case"listStart":be="*Format:* set start index to %0",xe={type:"format",content:o(t,be,te.commandParams[0].startIndex)}}return xe}_getSuggestionBlocksForListStyle(){var te,be,xe,ve;const we=this.editor.plugins.get("LegacyListUtils");let t=Array.from(this.editor.model.document.selection.getSelectedBlocks());return(te=t[0])!=null&&te.is("element","listItem")&&t.unshift(...we.getSiblingNodes(this.editor.model.document.selection.getFirstPosition(),"backward")),(be=t[t.length-1])!=null&&be.is("element","listItem")&&t.push(...we.getSiblingNodes(this.editor.model.document.selection.getLastPosition(),"forward")),t=[...new Set(t)],(ve=(xe=this.editor.model.document.selection.getFirstPosition())==null?void 0:xe.parent)!=null&&ve.is("element","listItem")&&(t=t.filter(ke=>ke.is("element","listItem"))),t}_getSuggestionBlocks(we){const t=this.editor.plugins.get("LegacyListUtils");let te=Array.from(this.editor.model.document.selection.getSelectedBlocks()).filter(we).map(be=>{const xe=this.editor.model.createPositionAt(be,0);return[...t.getSiblingNodes(xe,"backward"),...t.getSiblingNodes(xe,"forward")]}).flat();return te=[...new Set(te)],te}_getTranslationKeyForListStyle(we){return"ELEMENT_"+(this.editor.plugins.get("LegacyListUtils").getListTypeFromListStyleType(we)||"default").toUpperCase()+"_LIST_"+we.toUpperCase().replace(/-/g,"_")}}class ft extends Plugin{afterInit(){const we=this.editor;if(!we.plugins.has("MediaEmbedEditing"))return;const t=we.plugins.get("TrackChangesEditing"),te=we.locale;t.enableCommand("mediaEmbed"),t.descriptionFactory.registerElementLabel("media",be=>o(te,"ELEMENT_MEDIA",be)),we.conversion.for("dataDowncast").elementToElement({model:"media",view:(be,{writer:xe,options:ve})=>{if(ve.showSuggestionHighlights)return xe.createEmptyElement("div")},converterPriority:"high"}),we.data.downcastDispatcher.on("attribute:url:media",(be,xe,ve)=>{ve.options.showSuggestionHighlights&&be.stop()},{priority:"high"})}}class gt extends Plugin{afterInit(){const we=this.editor;we.plugins.has("MentionEditing")&&we.plugins.get("TrackChangesEditing").enableCommand("mention")}}class lt extends Plugin{afterInit(){const we=this.editor,t=we.plugins.get("TrackChangesEditing");we.plugins.has("MultiLevelList")&&(t.enableDefaultAttributesIntegration("multiLevelList"),t.registerBlockAttribute("listMarkerStyle"),t.descriptionFactory.registerDescriptionCallback(te=>this.handleDescriptions(te)))}handleDescriptions(we){const t=this.editor.locale,{data:te}=we,be={type:"format",content:""};if(te&&te.key=="listMarkerStyle"){if(!te.oldValue)return{type:"format",content:o(t,"*Set format:* %0",o(t,"ELEMENT_MULTI_LEVEL_LIST"))+" ("+te.newValue+")"};if(!te.newValue){let xe=we.head;for(;xe;){if(xe.data&&xe.data.key=="listType"&&xe.data.newValue)return be;xe=xe.next}return{type:"format",content:o(t,"*Remove format:* %0",o(t,"ELEMENT_MULTI_LEVEL_LIST"))+" ("+te.oldValue+")"}}}}}class mt extends Plugin{afterInit(){const we=this.editor;if(!we.plugins.has("PageBreakEditing"))return;we.plugins.get("TrackChangesEditing").enableCommand("pageBreak");const t=we.plugins.get("TrackChangesEditing"),te=we.locale;t.descriptionFactory.registerElementLabel("pageBreak",be=>o(te,"ELEMENT_PAGE_BREAK",be))}}class dt extends Plugin{afterInit(){const we=this.editor;if(!we.plugins.has("Paragraph"))return;const t=we.locale,te=we.plugins.get("TrackChangesEditing");te.descriptionFactory.registerElementLabel("paragraph",xe=>o(t,"ELEMENT_PARAGRAPH",xe)),te.enableDefaultAttributesIntegration("paragraph"),te.enableCommand("insertParagraph"),we.editing.downcastDispatcher.on("addMarker:suggestion:insertion",nr(we),{priority:"highest"}),we.data.downcastDispatcher.on("addMarker:suggestion:insertion",(xe,ve,ke)=>{ke.options.showSuggestionHighlights&&nr(we,{showActiveMarker:!1})(xe,ve,ke)},{priority:"highest"});const be=te.descriptionFactory;be.registerDescriptionCallback(xe=>{if(xe.type!=="insertion")return;const{start:ve,end:ke}=xe.getFirstRange();if(!ve.isTouching(ke)||!ve.nodeAfter)return;const Ie=we.model.schema,Ae=ve.nodeAfter;return Ie.isBlock(Ae)&&!Ie.isLimit(Ae)&&Ie.checkChild(Ae,"$text")?{type:"insertion",content:o(t,"*Insert:* %0",be.getItemLabel(Ae,1))}:void 0}),this._registerLegacyDescription()}_registerLegacyDescription(){const we=this.editor,t=we.locale;we.plugins.get("TrackChangesEditing").descriptionFactory.registerDescriptionCallback(te=>{if(te.type!="formatBlock")return;const{data:be}=te;return be&&be.commandName=="paragraph"?{type:"format",content:o(t,"*Change to:* %0",o(t,"ELEMENT_PARAGRAPH"))}:void 0})}}function nr(Te,{showActiveMarker:we=!0}={}){return(t,te,be)=>{const xe=Te.plugins.get("TrackChangesEditing"),ve=te.markerRange.start,ke=te.markerRange.end,Ie=Te.model.schema;if(!ve.isTouching(ke)||!ve.nodeAfter)return;const Ae=ve.nodeAfter;if(Ie.isBlock(Ae)&&!Ie.isLimit(Ae)&&Ie.checkChild(Ae,"$text")){if(!be.consumable.consume(te.markerRange,t.name))return;const Se=be.writer.createUIElement("span",{class:"ck-suggestion-marker-split"}),Oe=be.mapper.toViewPosition(ke);we&&xe.activeMarkers.includes(te.markerName)&&be.writer.addClass("ck-suggestion-marker--active",Se),be.writer.insert(Oe,Se),be.mapper.bindElementToMarker(Se,te.markerName)}}}class pt extends Plugin{afterInit(){const we=this.editor;we.plugins.has("RemoveFormatEditing")&&(we.plugins.get("TrackChangesEditing").enableDefaultAttributesIntegration("removeFormat"),this._registerLegacyDescription())}_registerLegacyDescription(){const we=this.editor;we.plugins.get("TrackChangesEditing").descriptionFactory.registerDescriptionCallback(t=>{if(t.type!="formatBlock"&&t.type!="formatInline")return;const{data:te}=t;return te&&te.commandName=="removeFormat"?{type:"format",content:o(we.locale,"*Remove all formatting*")}:void 0})}}class kt extends Plugin{afterInit(){const we=this.editor;if(!we.plugins.has("RestrictedEditingModeEditing"))return;const t=we.plugins.get("TrackChangesEditing");t.enableCommand("goToPreviousRestrictedEditingException"),t.enableCommand("goToNextRestrictedEditingException");const te=we.plugins.get("RestrictedEditingModeEditing");te.enableCommand("trackChanges"),te.enableCommand("acceptSuggestion"),te.enableCommand("discardSuggestion"),te.enableCommand("acceptAllSuggestions"),te.enableCommand("discardAllSuggestions"),te.enableCommand("acceptSelectedSuggestions"),te.enableCommand("discardSelectedSuggestions")}}class bt extends Plugin{static get requires(){return[ShiftEnter]}init(){const we=this.editor,t=we.plugins.get("TrackChangesEditing");t.enableCommand("shiftEnter"),we.editing.downcastDispatcher.on("addMarker:suggestion:insertion",de(we),{priority:"high"}),we.editing.downcastDispatcher.on("addMarker:suggestion:deletion",de(we),{priority:"high"}),we.data.downcastDispatcher.on("addMarker:suggestion",(te,be,xe)=>{xe.options.showSuggestionHighlights&&de(we,{showActiveMarker:!1})(te,be,xe)}),t.descriptionFactory.registerElementLabel("softBreak",te=>o(we.locale,"ELEMENT_LINE_BREAK",te))}}function de(Te,{showActiveMarker:we=!0}={}){return(t,te,be)=>{const xe=Te.plugins.get("TrackChangesEditing");if(!be.consumable.test(te.markerRange,t.name))return;const ve=Te.model;for(const ke of te.markerRange.getItems()){if(!ke.is("element","softBreak"))continue;const Ie=te.markerName.split(":")[1]=="deletion"?"merge":"split",Ae=be.writer.createUIElement("span",{class:"ck-suggestion-marker-"+Ie}),Se=be.mapper.toViewPosition(ve.createPositionBefore(ke));we&&xe.activeMarkers.includes(te.markerName)&&be.writer.addClass("ck-suggestion-marker--active",Ae),be.writer.insert(Se,Ae),be.mapper.bindElementToMarker(Ae,te.markerName)}}}class wt extends Plugin{afterInit(){const we=this.editor,t=we.model,te=we.locale;if(!we.plugins.has("StandardEditingModeEditing"))return;const be=we.plugins.get("TrackChangesEditing"),xe="restrictedEditingException",ve=we.commands.get(xe);be.enableCommand(xe,(ke,Ie={})=>{const Ae=t.document.selection;if(Ae.isCollapsed)return void ke(Ie);const Se=Ie.forceValue!==void 0?Ie.forceValue:!ve.value;t.change(()=>{const Oe=Array.from(Ae.getRanges());for(const Ve of Oe){const Me=Se?[Ve]:io(xe,Ve,t);for(const De of Me)be.markInlineFormat(De,{commandName:xe,commandParams:[{forceValue:Se}]})}})}),be.descriptionFactory.registerDescriptionCallback(ke=>{if(ke.type!="formatBlock"&&ke.type!="formatInline")return;const{data:Ie}=ke;return Ie&&Ie.commandName==xe?Ie.commandParams[0].forceValue?{type:"format",content:o(te,"FORMAT_RESTRICTED_ENABLED")}:{type:"format",content:o(te,"FORMAT_RESTRICTED_DISABLED")}:void 0})}}class yt extends Plugin{afterInit(){const we=this.editor;if(!we.plugins.has("Style")||!we.plugins.has("DataSchema"))return;const t=we.plugins.get("TrackChangesEditing"),te=we.locale,be=we.config.get("style")||{},xe=we.plugins.get("GeneralHtmlSupport"),ve=we.plugins.get("StyleUtils").normalizeConfig(we.plugins.get("DataSchema"),be.definitions);t.enableDefaultAttributesIntegration("style");const ke=new Set;for(const Ae of ve.block){const Se=xe.getGhsAttributeNameForElement(Ae.element);ke.add(Se)}const Ie=new Set;for(const Ae of ve.inline){const Se=xe.getGhsAttributeNameForElement(Ae.element);Ie.add(Se);for(const Oe of Ae.ghsAttributes)Ie.add(Oe)}for(const Ae of ke)t.registerBlockAttribute(Ae),t.descriptionFactory.registerAttributeLabel(Ae,o(te,"FORMAT_STYLE"));for(const Ae of Ie)t.registerInlineAttribute(Ae),t.descriptionFactory.registerAttributeLabel(Ae,o(te,"FORMAT_STYLE"));this._registerLegacyDescription()}_registerLegacyDescription(){const we=this.editor,t=we.locale;we.plugins.get("TrackChangesEditing").descriptionFactory.registerDescriptionCallback(te=>{if(te.type!="formatBlock"&&te.type!="formatInline")return;const{data:be}=te;return be&&be.commandName==="style"?be.commandParams[0].forceValue?{type:"format",content:o(t,"*Set format:* %0",be.commandParams[0].styleName.toLowerCase())}:{type:"format",content:o(t,"*Remove format:* %0",be.commandParams[0].styleName.toLowerCase())}:void 0})}}class jt extends Plugin{constructor(t){super(t);Re(this,"_tablePostFixingSubtypes");Re(this,"_tableSuggestions");this._tablePostFixingSubtypes=["tableRow","tableColumn"],this._tableSuggestions=new Set}afterInit(){const t=this.editor,te=t.model.document.selection;if(!t.plugins.has("TableEditing"))return;const be=t.locale,xe=t.plugins.get("TrackChangesEditing"),ve=t.plugins.get("TableUtils");xe.descriptionFactory.registerElementLabel("table",Oe=>o(be,"ELEMENT_TABLE",Oe)),this._setupColumnsRowsFixing(),xe.enableCommand("insertTable"),xe.enableCommand("selectTableRow"),xe.enableCommand("selectTableColumn");for(const Oe of["insertTableRowAbove","insertTableRowBelow"]){const Ve=t.commands.get(Oe);xe.enableCommand(Oe,Me=>{t.model.change(De=>{Me();const Fe=Ve.order==="above",Be=ve.getSelectionAffectedTableCells(te),$e=ve.getRowIndexes(Be),Ue=Fe?$e.first-1:$e.last+1,He=Be[0].findAncestor("table"),ze=ve.createTableWalker(He,{startRow:Ue,endRow:Ue}),qe=Array.from(ze).map(Ke=>De.createRangeOn(Ke.cell));xe.markMultiRangeInsertion(qe,"tableRow")})})}for(const Oe of["insertTableColumnLeft","insertTableColumnRight"]){const Ve=t.commands.get(Oe);xe.enableCommand(Oe,Me=>{t.model.change(De=>{Me();const Fe=Ve.order==="left",Be=ve.getSelectionAffectedTableCells(te),$e=ve.getColumnIndexes(Be),Ue=Fe?$e.first-1:$e.last+1,He=Be[0].findAncestor("table"),ze=ve.createTableWalker(He,{startRow:0,column:Ue,includeAllSlots:!1}),qe=Array.from(ze).map(Ke=>De.createRangeOn(Ke.cell));xe.markMultiRangeInsertion(qe,"tableColumn")})})}for(const Oe of["removeTableRow","removeTableColumn"]){const Ve=Oe.substr(11),Me=Ve.toLowerCase(),De=Me.substr(0,3)+"span",Fe="table"+Ve,Be="min"+Ve,$e="max"+Ve;xe.enableCommand(Oe,()=>{t.model.change(Ue=>{const He=ve.getSelectionAffectedTableCells(te),ze=He[0].findAncestor("table");let qe;if(Oe=="removeTableRow"){const Ze=ve.getRowIndexes(He);qe={startRow:Ze.first,endRow:Ze.last,includeAllSlots:!0}}else{const Ze=ve.getColumnIndexes(He);qe={startColumn:Ze.first,endColumn:Ze.last,includeAllSlots:!0}}const Ke=ve.createTableWalker(ze,qe),Qe=Array.from(Ke).map(({cell:Ze})=>Ze),je=Ee(Qe.filter(Ze=>Ze.hasAttribute(De))),Ye=Ee(Qe.filter(Ze=>!Ze.hasAttribute(De))).map(Ze=>Ue.createRangeOn(Ze)),ht=xe.markMultiRangeDeletion(Ye,Fe);if(ht&&(ht.subType=="tableRow"||ht.subType=="tableColumn")){const Ze=this._getSuggestionCoords(ht);for(const Bt of je){const Jt=Ue.createRangeOn(Bt),Yt=ve.getCellLocation(Bt),en=Bt.getAttribute(De)-1,sn=Ze[Be],hn=Ze[$e];sn<=Yt[Me]&&Yt[Me]+en<=hn&&ht.addRange(Jt)}}})})}function ke(Oe){const Ve=Array.from(te.getRanges()).map(Me=>LiveRange.fromRange(Me));t.model.change(Me=>{const De=Me.batch;Oe=Oe.filter(Fe=>Fe.root.rootName!="$graveyard"),Me.setSelection(Oe),t.commands.get("removeTableRow").refresh(),t.execute("removeTableRow",{forceDefaultExecution:!0}),t.model.enqueueChange(()=>{t.model.enqueueChange(De,Fe=>{const Be=Ve.filter($e=>$e.root.rootName!="$graveyard");Be.length>0&&Fe.setSelection(Be);for(const $e of Ve)$e.detach()})})})}function Ie(Oe){t.model.change(Ve=>{const Me=Array.from(te.getRanges()).map(Be=>LiveRange.fromRange(Be)),De=[];for(const Be of Oe)for(const $e of Be.getItems({shallow:!0}))De.push($e);for(const Be of De)Be.root.rootName!="$graveyard"&&(Ve.setSelection(Ve.createPositionAt(Be,0)),t.commands.get("removeTableColumn").refresh(),t.execute("removeTableColumn",{forceDefaultExecution:!0}));const Fe=Me.filter(Be=>Be.root.rootName!="$graveyard");Fe.length>0&&Ve.setSelection(Fe);for(const Be of Me)Be.detach()})}function Ae(Oe,Ve){return Ve.every(Me=>Oe.some(De=>De.end.isEqual(Me.start)||Me.end.isEqual(De.start)))}function Se(Oe,Ve){return!Oe.some(Me=>Ve.some(De=>Me.isIntersecting(De)))&&Oe.some(Me=>Ve.some(De=>Me.end.isTouching(De.start)))}t.data.downcastDispatcher.on("addMarker:suggestion",(Oe,Ve,Me)=>{if(!Me.options.showSuggestionHighlights)return;const De=Ve.item;if(!De)return;const Fe=Me.mapper.toViewElement(De);function Be($e){return Array.isArray($e)?$e:[$e]}Fe&&De.name==="tableCell"&&setHighlightHandling(Fe,Me.writer,($e,Ue,He)=>He.addClass(Be(Ue.classes),$e),($e,Ue,He)=>He.removeClass(Be(Ue.classes),$e))},{priority:"highest"}),xe.descriptionFactory.registerDescriptionCallback(Oe=>{if(Oe.type!="insertion"&&Oe.type!="deletion")return;const Ve=Oe.getContainedElement();if(Ve!=null&&Ve.is("element","table")){if(Oe.type=="insertion"){const Me=Oe.getItems().filter(De=>De.is("$textProxy")).map(De=>De.data);if(Me.length)return{type:"insertion",content:o(be,"*Insert:* %0",o(be,"ELEMENT_TABLE_WITH_TEXT",'"'+Me.join(" ")+'"'))}}if(Oe.type=="deletion"){const Me=Oe.getItems().filter(De=>De.is("$textProxy")).map(De=>De.data);if(Me.length)return{type:"deletion",content:o(be,"*Remove:* %0",o(be,"ELEMENT_TABLE_WITH_TEXT",'"'+Me.join(" ")+'"'))}}}}),xe.descriptionFactory.registerDescriptionCallback(Oe=>{if(Oe.subType=="tableRow"){const Ve=Oe.getItems().filter(Fe=>Fe.is("$textProxy")).map(Fe=>Fe.data),Me=this._getSuggestionCoords(Oe),De=Me.maxRow-Me.minRow+1;if(Oe.type=="insertion")return Ve.length?{type:"insertion",content:o(be,"*Insert:* %0",o(be,"ELEMENT_TABLE_ROW_WITH_TEXT",[De,'"'+Ve.join(" ")+'"']))}:{type:"insertion",content:o(be,"*Insert:* %0",o(be,"ELEMENT_TABLE_ROW",De))};if(Oe.type=="deletion")return Ve.length?{type:"deletion",content:o(be,"*Remove:* %0",o(be,"ELEMENT_TABLE_ROW_WITH_TEXT",[De,'"'+Ve.join(" ")+'"']))}:{type:"deletion",content:o(be,"*Remove:* %0",o(be,"ELEMENT_TABLE_ROW",De))}}if(Oe.subType=="tableColumn"){const Ve=Oe.getItems().filter(Fe=>Fe.is("$textProxy")).map(Fe=>Fe.data),Me=this._getSuggestionCoords(Oe),De=Me.maxColumn-Me.minColumn+1;if(Oe.type=="insertion")return Ve.length?{type:"insertion",content:o(be,"*Insert:* %0",o(be,"ELEMENT_TABLE_COLUMN_WITH_TEXT",[De,'"'+Ve.join(" ")+'"']))}:{type:"insertion",content:o(be,"*Insert:* %0",o(be,"ELEMENT_TABLE_COLUMN",De))};if(Oe.type=="deletion")return Ve.length?{type:"deletion",content:o(be,"*Remove:* %0",o(be,"ELEMENT_TABLE_COLUMN_WITH_TEXT",[De,'"'+Ve.join(" ")+'"']))}:{type:"deletion",content:o(be,"*Remove:* %0",o(be,"ELEMENT_TABLE_COLUMN",De))}}}),xe._suggestionFactory.registerCustomCallback("insertion","tableRow","discard",ke),xe._suggestionFactory.registerCustomCallback("deletion","tableRow","accept",ke),xe._suggestionFactory.registerCustomCallback("insertion","tableColumn","discard",Ie),xe._suggestionFactory.registerCustomCallback("deletion","tableColumn","accept",Ie),xe._suggestionFactory.registerCustomCallback("insertion","tableColumn","join",Ae),xe._suggestionFactory.registerCustomCallback("deletion","tableColumn","join",Ae),xe._suggestionFactory.registerCustomCallback("insertion","tableRow","join",Se),xe._suggestionFactory.registerCustomCallback("deletion","tableRow","join",Se)}_acceptFormatSuggestionCallbackFactory(){const t=this.editor,te=t.model.document.selection;return(be,xe)=>{t.model.change(ve=>{const{commandName:ke,commandParams:Ie}=xe;let Ae=be[0].end.nodeBefore;Ie&&Ie[0]&&Ie[0].forceValue===!1&&(Ae=be[0].start.nodeAfter);const Se=ve.createRangeIn(Ae);if(Se.root.rootName=="$graveyard")return;const Oe=Array.from(te.getRanges()).map(Me=>LiveRange.fromRange(Me));ve.setSelection(Se),t.commands.get(ke).refresh(),Ie.push({forceDefaultExecution:!0}),t.execute(ke,...Ie);const Ve=Oe.filter(Me=>Me.root.rootName!="$graveyard");Ve.length>0&&ve.setSelection(Ve);for(const Me of Oe)Me.detach()})}}_getCoordsForCells(t){const te=this.editor.plugins.get("TableUtils");let be=Number.MAX_SAFE_INTEGER,xe=Number.MIN_SAFE_INTEGER,ve=Number.MAX_SAFE_INTEGER,ke=Number.MIN_SAFE_INTEGER;for(const Ie of t){if(Ie.root.rootName=="$graveyard")continue;const{row:Ae,column:Se}=te.getCellLocation(Ie),Oe=Ie.hasAttribute("rowspan")?Ie.getAttribute("rowspan")-1:0,Ve=Ie.hasAttribute("colspan")?Ie.getAttribute("colspan")-1:0;be=Ae<be?Ae:be,xe=Ae+Oe>xe?Ae+Oe:xe,ve=Se<ve?Se:ve,ke=Se+Ve>ke?Se+Ve:ke}return{minRow:be,maxRow:xe,minColumn:ve,maxColumn:ke}}_setupColumnsRowsFixing(){const t=this.editor,te=t.plugins.get("TrackChangesEditing"),be=t.plugins.get("TableUtils");t.model.document.on("change:data",()=>{const ve=Array.from(t.model.document.differ.getChangedMarkers());for(const{name:ke,data:Ie}of ve){const{group:Ae,id:Se,subType:Oe}=te._splitMarkerName(ke);if(Ae!="suggestion"||Ie.oldRange!=null)continue;const Ve=te.getSuggestion(Se);this._tablePostFixingSubtypes.includes(Oe)&&this._tableSuggestions.add(Ve)}},{priority:"low"});const xe=(ve,ke)=>{let Ie=!1;const Ae=ke.createRangeOn(ve),Se=ve.findAncestor("table"),Oe=be.getCellLocation(ve);for(const Ve of this._tableSuggestions){const Me=Ve.subType,De=Me.startsWith("tablePaste"),Fe=Me.substr(De?10:5),Be=Fe.toLowerCase(),$e=Be.substr(0,3)+"span",Ue="min"+Fe,He="max"+Fe;if(!Ve.isInContent||Se!=Ve.getFirstRange().start.findAncestor("table")||Ve.isIntersectingWithRange(Ae))continue;const ze=ve.hasAttribute($e)?ve.getAttribute($e)-1:0,qe=this._getSuggestionCoords(Ve),Ke=qe[Ue],Qe=qe[He];Ke<=Oe[Be]&&Oe[Be]+ze<=Qe&&(Ve.addRange(Ae),Ie=!0)}return Ie};t.model.document.registerPostFixer(ve=>{let ke=!1;for(const Ie of t.model.document.differ.getChanges())if(Ie.type=="insert")if(Ie.name=="tableRow")for(const Ae of Ie.position.nodeAfter.getChildren())ke=ke||xe(Ae,ve);else Ie.name=="tableCell"&&(ke=ke||xe(Ie.position.nodeAfter,ve));return ke})}_getSuggestionCoords(t){return this._getCoordsForCells(t.getRanges().map(te=>te.start.nodeAfter))}}function Ee(Te){return Array.from(new Set(Te).values())}class St extends Plugin{static get requires(){return[jt]}afterInit(){const we=this.editor,t=we.model.document.selection,te=we.locale;if(!we.plugins.has("TableEditing"))return;const be=we.plugins.get("TrackChangesEditing"),xe=we.plugins.get("TableUtils"),ve=we.plugins.get(jt);ve._tablePostFixingSubtypes.push("mergeTableCells"),be.enableCommand("mergeTableCells",()=>{const Ie=xe.getSelectionAffectedTableCells(we.model.document.selection);we.model.change(()=>{be.markMultiRangeBlockFormat(Ie,{commandName:"mergeTableCells",commandParams:[]},[],"mergeTableCells")})}),we.commands.get("mergeTableCells").on("execute",(Ie,Ae)=>{we.commands.get("trackChanges").value&&(Ae.length>0&&Ae[Ae.length-1]&&Ae[Ae.length-1].forceDefaultExecution||be._isForcedDefaultExecutionBlock||this._areSelectedCellsMergable()||Ie.stop())},{priority:"highest"});for(const Ie of["mergeTableCellUp","mergeTableCellRight","mergeTableCellDown","mergeTableCellLeft"]){const Ae=we.commands.get(Ie);be.enableCommand(Ie,()=>{const Se=we.model.document.selection.getFirstPosition().getAncestors().find(Ve=>Ve.is("element","tableCell")),Oe=Ae.value;we.model.change(()=>{be.markMultiRangeBlockFormat([Se,Oe],{commandName:"mergeTableCells",commandParams:[]},[],"mergeTableCells")})})}for(const Ie of["splitTableCellVertically","splitTableCellHorizontally"]){const Ae=we.commands.get(Ie);be.enableCommand(Ie,()=>{const Se=xe.getSelectionAffectedTableCells(we.model.document.selection)[0],Oe=Se.findAncestor("table"),{column:Ve,row:Me}=xe.getCellLocation(Se);let De=[];if(Ae.direction=="horizontally"){const Fe=xe.createTableWalker(Oe,{startRow:Me,endRow:Me,includeAllSlots:!0});De=Array.from(Fe).map(Be=>Be.cell)}else{const Fe=xe.createTableWalker(Oe,{column:Ve,includeAllSlots:!0});De=Array.from(Fe).map(Be=>Be.cell)}we.model.change(Fe=>{be.markBlockFormat(Fe.createRangeOn(Se),{commandName:Ie,commandParams:[]},De,Ie)})})}be.descriptionFactory.registerDescriptionCallback(Ie=>{if(Ie.type!="formatBlock"&&Ie.type!="formatInline")return;const{data:Ae}=Ie;return Ae&&Ae.commandName=="mergeTableCells"?{type:"format",content:o(te,"*Merge cells*")}:void 0}),be.descriptionFactory.registerDescriptionCallback(Ie=>{if(Ie.type!="formatBlock"&&Ie.type!="formatInline")return;const{data:Ae}=Ie;return Ae?Ae.commandName=="splitTableCellVertically"?{type:"format",content:o(te,"*Split cell:* vertically")}:Ae.commandName=="splitTableCellHorizontally"?{type:"format",content:o(te,"*Split cell:* horizontally")}:void 0:void 0});const ke=ve._acceptFormatSuggestionCallbackFactory();for(const Ie of["mergeTableCellUp","mergeTableCellRight","mergeTableCellDown","mergeTableCellLeft"])be._suggestionFactory.registerCustomCallback("formatBlock",Ie,"accept",ke);for(const Ie of["splitTableCellVertically","splitTableCellHorizontally"])be._suggestionFactory.registerCustomCallback("formatBlock",Ie,"accept",ke);be._suggestionFactory.registerCustomCallback("formatBlock","mergeTableCells","accept",Ie=>{we.model.change(Ae=>{const Se=Array.from(t.getRanges()).map(Ve=>LiveRange.fromRange(Ve));Ae.setSelection(Ie),we.commands.get("mergeTableCells").refresh(),we.execute("mergeTableCells",{forceDefaultExecution:!0});const Oe=Se.filter(Ve=>Ve.root.rootName!="$graveyard");Oe.length>0&&Ae.setSelection(Oe);for(const Ve of Se)Ve.detach()})});for(const Ie of["mergeTableCellUp","mergeTableCellDown","mergeTableCellLeft","mergeTableCellRight"]){const Ae=we.commands.get(Ie);Ae.on("set:isEnabled",(Se,Oe,Ve)=>{if(Ve){const Me=we.model.document.selection.getFirstPosition().getAncestors().find(De=>De.is("element","tableCell"));this._areMergableCells(Ae.value,Me)||(Se.return=!1,Se.stop())}},{priority:"low"})}}_areSelectedCellsMergable(){const we=this.editor.commands.get("mergeTableCells"),t=this.editor.plugins.get("TableUtils");if(!we.isEnabled)return!1;const te=t.getSelectionAffectedTableCells(this.editor.model.document.selection);for(const be of te)for(const xe of te)if(be!=xe&&!this._areMergableCells(be,xe))return!1;return!0}_areMergableCells(we,t){const te=this.editor.plugins.get("TrackChangesEditing"),be=this.editor.model.createRangeOn(we),xe=this.editor.model.createRangeOn(t),ve=new Set,ke=new Set;for(const Ie of te.getSuggestions())if((Ie.type=="insertion"||Ie.type=="deletion"||Ie.subType=="mergeTableCells")&&Ie.isInContent)for(const Ae of Ie.getRanges())Ae.containsRange(be,!0)&&ve.add(Ie.type+":"+Ie.author.id),Ae.containsRange(xe,!0)&&ke.add(Ie.type+":"+Ie.author.id);if(ve.size!=ke.size)return!1;for(const Ie of ve)if(!ke.has(Ie))return!1;return!0}}class At extends Plugin{static get requires(){return[jt]}afterInit(){const we=this.editor;if(!we.plugins.has("TableEditing"))return;const t=we.locale,te=we.plugins.get("TrackChangesEditing");te.enableDefaultAttributesIntegration("setTableRowHeader"),te.enableDefaultAttributesIntegration("setTableColumnHeader"),te.registerBlockAttribute("headingRows"),te.registerBlockAttribute("headingColumns"),te.descriptionFactory.registerAttributeLabel("headingRows",o(t,"FORMAT_HEADER_ROW")),te.descriptionFactory.registerAttributeLabel("headingColumns",o(t,"FORMAT_HEADER_COLUMN")),this._handleLegacySuggestions()}_handleLegacySuggestions(){const we=this.editor.plugins.get("TrackChangesEditing"),t=this.editor.plugins.get("TableUtils"),te=this.editor.plugins.get(jt)._acceptFormatSuggestionCallbackFactory();function be({showActiveMarker:xe=!0,setDataAttribute:ve=!0}={}){return(ke,Ie,Ae)=>{const{type:Se,id:Oe}=we._splitMarkerName(Ie.markerName),Ve=we.getSuggestion(Oe),Me=Ve.data;if(Ve.type!="formatBlock"||!Me||Me.commandName!="setTableColumnHeader")return;if(Ie.item)return void ke.stop();if(!Ae.consumable.consume(Ie.markerRange,ke.name))return;const De=Ie.markerRange.start.nodeAfter,Fe=Ie.markerRange.end.nodeBefore,Be=De.parent.parent,{column:$e}=t.getCellLocation(De),{column:Ue}=t.getCellLocation(Fe);for(let He=$e;He<=Ue;He++){const ze=t.createTableWalker(Be,{column:He,includeAllSlots:!1});for(const qe of ze){const Ke=qe.cell,Qe=Ae.mapper.toViewElement(Ke);Ae.writer.addClass("ck-suggestion-marker-"+Se,Qe),ve&&Ae.writer.setAttribute("data-suggestion",Oe,Qe),Ae.mapper.bindElementToMarker(Qe,Ie.markerName),xe&&(we.activeMarkers.includes(Ie.markerName)?Ae.writer.addClass("ck-suggestion-marker--active",Qe):Ae.writer.removeClass("ck-suggestion-marker--active",Qe))}}}}we._suggestionFactory.registerCustomCallback("formatBlock","setTableRowHeader","accept",te),we._suggestionFactory.registerCustomCallback("formatBlock","setTableColumnHeader","accept",te),this.editor.editing.downcastDispatcher.on("addMarker:suggestion",be(),{priority:"highest"}),this.editor.data.downcastDispatcher.on("addMarker:suggestion",(xe,ve,ke)=>{ke.options.showSuggestionHighlights&&be({showActiveMarker:!1,setDataAttribute:!1})(xe,ve,ke)},{priority:"highest"}),this.editor.editing.downcastDispatcher.on("removeMarker:suggestion",(xe,ve,ke)=>{const{type:Ie,id:Ae}=we._splitMarkerName(ve.markerName),Se=we.getSuggestion(Ae),Oe=Se.data;if(Se.type!="formatBlock"||!Oe||Oe.commandName!="setTableColumnHeader")return;const Ve=ke.mapper.markerNameToElements(ve.markerName);if(Ve)for(const Me of Ve)ke.writer.removeClass("ck-suggestion-marker-"+Ie,Me),ke.writer.removeClass("ck-suggestion-marker--active",Me),ke.writer.removeAttribute("data-suggestion",Me),ke.mapper.unbindElementFromMarkerName(Me,ve.markerName)},{priority:"highest"}),this._registerLegacyDescription()}_registerLegacyDescription(){const we=this.editor,t=we.locale;function te(be){return{type:"format",content:o(t,"*Format:* %0",be)}}we.plugins.get("TrackChangesEditing").descriptionFactory.registerDescriptionCallback(be=>{if(be.type!="formatBlock")return;const{data:xe}=be;if(xe){if(xe.commandName=="setTableRowHeader"){const ve=xe.commandParams[0].forceValue;return te(o(t,ve?"FORMAT_HEADER_ROW":"FORMAT_REGULAR_ROW"))}if(xe.commandName=="setTableColumnHeader"){const ve=xe.commandParams[0].forceValue;return te(o(t,ve?"FORMAT_HEADER_COLUMN":"FORMAT_REGULAR_COLUMN"))}}})}}const ge=["tableCellBorderWidth","tableCellBorderColor","tableCellBorderStyle","tableCellHorizontalAlignment","tableCellVerticalAlignment","tableCellBackgroundColor","tableCellPadding"],Ce=Object.fromEntries(ge.map(Te=>[Te,null]));class It extends Plugin{static get requires(){return[jt]}afterInit(){const we=this.editor;if(!we.plugins.has("TableClipboard"))return;const t=we.plugins.get("TrackChangesEditing"),te=we.plugins.get("TableUtils"),be=we.plugins.get(jt),xe=we.plugins.get("TableClipboard");be._tablePostFixingSubtypes.push("tablePasteRow","tablePasteColumn"),we.model.schema.register("tableCellSuggestion",{allowIn:"tableCell",allowContentOf:"tableCell",isLimit:!0}),we.conversion.elementToElement({model:"tableCellSuggestion",view:"suggestion-td"});let ve=null;we.model.on("insertContent",(Ve,Me)=>{const[De,Fe]=Me,Be=Me[Me.length-1];Be&&Be.forceDefaultExecution||t._isForcedDefaultExecutionBlock||this.editor.commands.get("trackChanges").value&&function($e,Ue,He,ze,qe){if(Ue&&!Ue.is("documentSelection"))return!1;const Ke=qe.getTableIfOnlyTableInContent($e,He);if(!Ke||!he(Ke,void 0,ze))return!1;const Qe=ze.getSelectionAffectedTableCells(He.document.selection);if(!Qe.length)return!1;const je=Qe[0].findAncestor("table"),Ye=ze.getRowIndexes(Qe),ht=ze.getColumnIndexes(Qe),Ze={startRow:Ye.first,endRow:Ye.last,startColumn:ht.first,endColumn:ht.last};return Qe.length==1&&(Ze.endRow+=ze.getRows(Ke)-1,Ze.endColumn+=ze.getColumns(Ke)-1),he(je,Ze,ze)}(De,Fe,we.model,te,xe)&&(Ve.stop(),ve={cells:[],insertionRanges:[],deletionRanges:[],rowInsertionRanges:[],rowInsertionIndexes:[],columnInsertionRanges:[],columnInsertionIndexes:[]},we.model.change(()=>{we.model.insertContent(Me[0],Me[1],Me[2],{forceDefaultExecution:!0});const $e=uid(),{rowInsertionRanges:Ue,columnInsertionRanges:He,insertionRanges:ze,deletionRanges:qe,cells:Ke}=ve;Ue.length&&t.markMultiRangeInsertion(Ue,"tablePasteRow",{tablePasteChainId:$e}),He.length&&t.markMultiRangeInsertion(He,"tablePasteColumn",{tablePasteChainId:$e}),ze.length&&(t.markMultiRangeInsertion(ze,"tablePaste",{tablePasteChainId:$e,skipNestingCheck:!0}),ze.forEach(je=>{var Ye;return(Ye=je.detach)==null?void 0:Ye.call(je)})),qe.length&&(t.markMultiRangeDeletion(qe,"tablePaste",{tablePasteChainId:$e,skipNestingCheck:!0}),qe.forEach(je=>{var Ye;return(Ye=je.detach)==null?void 0:Ye.call(je)}));const Qe=t.markMultiRangeBlockFormat(Ke.map(({element:je})=>je),{formatGroupId:uid()},[],"tablePasteCell",{tablePasteChainId:$e});if(Qe){const je=Qe.getMarkers(),Ye=[];for(const{element:ht,attributes:Ze}of Ke){if(!Ze)continue;const Bt=we.model.createRangeOn(ht),Jt=je.find(Yt=>Yt.getRange().isEqual(Bt));Jt&&Ye.push([Jt.name,Ze])}Ye.length&&Qe.setAttribute("markerAttributes",Object.fromEntries(Ye))}ve=null}))},{priority:priorities.high+10}),we.plugins.get("TableClipboard").on("_replaceTableSlotCell",(Ve,Me)=>{const[De,Fe,,Be]=Me;if(!ve)return;Ve.stop();const $e=De.cell,Ue=Fe,He=Pe($e),ze=Pe(Ue);Ve.return=$e;let qe=null,Ke=null;if(ze||He)if(He&&!ze){Be.remove($e.getChild(0));for(const ht of Array.from(Ue.getChildren()))Be.insert(ht,$e,"end");const je=ve.rowInsertionIndexes.includes(De.row),Ye=ve.columnInsertionIndexes.includes(De.column);je||Ye||(qe=LiveRange.fromRange(Be.createRangeIn($e)))}else ze&&!He&&(Ke=Be.createRangeIn($e));else{const je=Be.createElement("tableCellSuggestion"),Ye=Be.createElement("tableCellSuggestion");Be.wrap(Be.createRangeIn($e),Ye),Be.insert(je,$e,0);for(const ht of Array.from(Ue.getChildren()))Be.insert(ht,je,"end");qe=LiveRange.fromRange(Be.createRangeOn(je)),Ke=LiveRange.fromRange(Be.createRangeOn(Ye))}const Qe=Array.from(Ue.getAttributes()).filter(([je])=>ge.includes(je));ve.cells.push({element:$e,attributes:Qe.length?Object.fromEntries(Qe):null}),qe&&ve.insertionRanges.push(qe),Ke&&ve.deletionRanges.push(Ke)},{priority:"high"}),te.on("insertColumns",(Ve,Me)=>{const[De,Fe={}]=Me;if(!ve)return;const Be=Fe.at||0,$e=Fe.columns||1;ve.columnInsertionIndexes=new Array($e).fill(Be).map((Ue,He)=>Ue+He);for(const{cell:Ue}of te.createTableWalker(De,{startColumn:Be,endColumn:Be+$e-1}))ve.columnInsertionRanges.push(we.model.createRangeOn(Ue))},{priority:"low"}),te.on("insertRows",(Ve,Me)=>{const[De,Fe={}]=Me;if(!ve)return;const Be=Fe.at||0,$e=Fe.rows||1;ve.rowInsertionIndexes=new Array($e).fill(Be).map((Ue,He)=>Ue+He);for(const{cell:Ue}of te.createTableWalker(De,{startRow:Be,endRow:Be+$e-1}))ve.rowInsertionRanges.push(we.model.createRangeOn(Ue))},{priority:"low"}),t.descriptionFactory.registerDescriptionCallback(Ve=>{if(Ve.subType&&Ve.subType.startsWith("tablePaste"))return Ve.previous?{}:{type:"insertion",content:o(we.locale,"*Replace table cells*")}});const ke=()=>!1;for(const Ve of["tablePaste","tablePasteColumn","tablePasteRow","tablePasteCell"])t._suggestionFactory.registerCustomCallback("insertion",Ve,"join",ke),t._suggestionFactory.registerCustomCallback("deletion",Ve,"join",ke),t._suggestionFactory.registerCustomCallback("formatBlock",Ve,"join",ke);t._suggestionFactory.registerCustomCallback("formatBlock","tablePasteCell","discard",ke),t._suggestionFactory.registerCustomCallback("formatBlock","tablePasteCell","accept",(Ve,Me,De)=>{const Fe=Ve.map($e=>$e.getContainedElement()).filter($e=>$e),Be=new Map(Fe.map($e=>[$e,null]));if(ve)for(const{element:$e,attributes:Ue}of ve.cells)Ue&&Be.set($e,Ue);else if(De&&De.markerAttributes)for(const[$e,Ue]of Object.entries(De.markerAttributes)){const He=we.model.markers.get($e),ze=He?He.getRange().getContainedElement():null;ze&&Be.set(ze,Ue)}we.model.change($e=>{for(const[Ue,He]of Be)$e.setAttributes({...Ce,...He},Ue)})});const Ie=(Ve,Me)=>{t._suggestionFactory.registerCustomCallback(Ve,"tablePaste",Me,(De,Fe,Be)=>{we.model.change($e=>{const Ue=[];for(const He of De){const ze=He.start.nodeAfter;ze.is("element","tableCellSuggestion")&&Ue.push(ze)}t._suggestionFactory.getSuggestionCallback(Ve,null,Me)(De,Fe,Be);for(const He of Ue)He.root.rootName!="$graveyard"&&$e.unwrap(He)})})};Ie("insertion","accept"),Ie("insertion","discard"),Ie("deletion","accept"),Ie("deletion","discard"),t._suggestionFactory.registerCustomCallback("insertion","tablePasteRow","discard",Ve=>{const Me=Ve.map($e=>$e.getContainedElement()),De=Me[0].findAncestor("table"),{minRow:Fe,maxRow:Be}=be._getCoordsForCells(Me);te.removeRows(De,{at:Fe,rows:Be-Fe+1})}),t._suggestionFactory.registerCustomCallback("insertion","tablePasteColumn","discard",Ve=>{const Me=Ve.map($e=>$e.getContainedElement()),De=Me[0].findAncestor("table"),{minColumn:Fe,maxColumn:Be}=be._getCoordsForCells(Me);te.removeColumns(De,{at:Fe,columns:Be-Fe+1})});const Ae=(Ve,Me)=>{if(!Me.subType||!Me.subType.startsWith("tablePaste"))return;const De=Me.attributes.tablePasteChainId,Fe=t.getSuggestions().filter(Be=>Be.isInContent&&Be.attributes&&Be.attributes.tablePasteChainId==De);Fe.length&&Me.getAllAdjacentSuggestions().length!=Fe.length&&Fe.reduce((Be,$e)=>(Be.next=$e,$e.previous=Be,$e))};function Se(Ve,Me=!0){const{id:De}=t._splitMarkerName(Ve.markerName),Fe=["ck-suggestion-marker","ck-suggestion-marker-insertion"],Be=t.activeMarkers.includes(Ve.markerName);return Be&&Fe.push("ck-suggestion-marker--active"),{classes:Fe,attributes:{"data-suggestion":De},priority:Be&&Me?3010:3e3}}t.on("suggestionLoaded",Ae,{priority:"high"}),t.on("suggestionUnloaded",Ae,{priority:"high"}),we.model.document.registerPostFixer(()=>{let Ve=!1;const Me=Array.from(we.model.document.differ.getChangedMarkers());for(const{name:De,data:Fe}of Me){const{group:Be,type:$e,id:Ue}=t._splitMarkerName(De);if(Be!="suggestion"||$e!="deletion"||Fe.oldRange||!t.hasSuggestion(Ue))continue;const He=t.getSuggestion(Ue).getRanges(),ze=we.plugins.get("Users").me;for(const qe of t.getSuggestions())if(!(!qe.isInContent||qe.author!=ze)&&!(qe.type!="formatBlock"||qe.subType!="tablePasteCell")&&qe.getRanges().every(Ke=>He.some(Qe=>Qe.containsRange(Ke,!0))))for(const Ke of qe.getAllAdjacentSuggestions())Ke.isInContent&&(Ke.discard(),Ve=!0)}return Ve}),we.model.document.registerPostFixer(Ve=>{const Me=we.commands.get("redo");if(!Me||!Me._createdBatches.has(Ve.batch))return!1;let De=!1;const Fe=we.plugins.get("Users").me,Be=we.model.document.differ.getChanges(),$e=Array.from(we.model.document.differ.getChangedMarkers()).filter(({name:Ue,data:He})=>{const{group:ze,subType:qe,authorId:Ke}=t._splitMarkerName(Ue);return ze=="suggestion"&&qe=="tablePaste"&&Ke==Fe.id&&!He.oldRange});for(const Ue of Be){if(Ue.type!="insert"||Ue.name!="tableCellSuggestion"||Ue.length!=1)continue;const He=Ve.createRange(Ue.position,Ue.position.getShiftedBy(1));if(!$e.find(({data:ze})=>ze.newRange.isEqual(He))){for(const{name:ze,data:qe}of $e)if(He.containsRange(qe.newRange)){Ve.updateMarker(ze,{range:He}),De=!0;break}}}return De}),we.model.document.registerPostFixer(Ve=>{let Me=!1;const De=we.plugins.get("Users").me,Fe=t.getSuggestions().filter(Ue=>Ue.isInContent&&Ue.author==De),Be=new Set,$e=new Set;for(const Ue of Fe)if(Ue.subType=="tablePaste")for(const He of Ue.getMarkers()){const ze=He.getRange().getContainedElement();if(ze)if(ze.is("element","tableCellSuggestion")&&Pe(ze)){Ue.removeMarker(He.name),Be.add(ze),Me=!0;const qe=ze.nextSibling,Ke=ze.previousSibling,Qe=qe&&qe.is("element","tableCellSuggestion"),je=Ke&&Ke.is("element","tableCellSuggestion");Qe&&!Be.has(qe)&&$e.add(qe),je&&!Be.has(Ke)&&$e.add(Ke)}else ze.is("element","paragraph")&&ze.isEmpty&&(Ue.removeMarker(He.name),Me=!0)}else if(Ue.subType=="tablePasteCell"){if(!Ue.attributes||!Ue.attributes.tablePasteChainId)continue;const He=Ue.attributes.markerAttributes;if(He&&Object.keys(He).length)continue;const ze=Ue.attributes.tablePasteChainId;let qe=!0,Ke=!0;for(const Qe of Fe)if(Qe.subType&&Qe.subType.startsWith("tablePaste")){if(!Qe.attributes.tablePasteChainId){Ke=!1;break}if(Qe.id!=Ue.id&&Qe.attributes.tablePasteChainId==ze){qe=!1;break}}Ke&&qe&&(Ue.removeMarkers(),Me=!0)}for(const Ue of Be)Ve.remove(Ue);for(const Ue of $e)Ve.unwrap(Ue);return Me}),we.conversion.for("editingDowncast").markerToHighlight({model:"suggestion:formatBlock:tablePasteCell",view:(Ve,Me)=>Se(Ve),converterPriority:"high"}),we.conversion.for("dataDowncast").markerToHighlight({model:"suggestion:formatBlock:tablePasteCell",view:(Ve,Me)=>Me.options.showSuggestionHighlights?Se(Ve,!1):null,converterPriority:"high"});const Oe=we.editing.view;this.listenTo(Oe.document,"clipboardOutput",(Ve,Me)=>{const De=[];for(const Fe of Oe.createRangeIn(Me.content).getItems())Fe.is("element","suggestion-td")&&De.push(Fe);Oe.change(Fe=>{for(const Be of De)Fe.move(Fe.createRangeIn(Be),Fe.createPositionBefore(Be)),Fe.remove(Be)})})}}function Pe(Te){if(Te.isEmpty)return!0;const we=Te.getChild(0);return we.is("element","paragraph")&&we.isEmpty}function he(Te,we={},t){for(const{isAnchor:te,cellHeight:be,cellWidth:xe}of t.createTableWalker(Te,{includeAllSlots:!0,...we}))if(!te||be!=1||xe!=1)return!1;return!0}class vt extends Plugin{afterInit(){if(!this.editor.plugins.has("TableColumnResizeEditing"))return;const we=this.editor.plugins.get("TrackChangesEditing");we.enableCommand("resizeTableWidth",this.handleResizeTableWidthCommand.bind(this)),we._suggestionFactory.registerCustomCallback("formatBlock","resizeTable","accept",we._suggestionFactory.getSuggestionCallback("formatBlock",null,"discard")),we._suggestionFactory.registerCustomCallback("formatBlock","resizeTable","discard",we._suggestionFactory.getSuggestionCallback("formatBlock",null,"accept")),we.descriptionFactory.registerDescriptionCallback(this.handleSuggestionDescription.bind(this))}handleResizeTableWidthCommand(we,t){const te=this.editor.plugins.get("TrackChangesEditing"),be=this.editor.plugins.get("TableColumnResizeEditing"),xe=t.table||this.editor.model.document.selection.getSelectedElement();this.editor.model.change(()=>{const ve=be.getColumnGroupElement(xe);let ke=ve?be.getTableColumnsWidths(ve):null,Ie=xe.getAttribute("tableWidth")||null;const Ae=t.tableWidth||Ie,Se=t.columnWidths||ke,Oe=this.editor.plugins.get("Users").me;for(const Ve of te.getSuggestions()){const Me=Ve.getContainedElement();if(Ve.subType==="resizeTable"&&Me===xe){Ve.author!==Oe&&Ve.discard();const De=Ve.data.commandParams;Ie=De[0].tableWidth,ke=De[0].columnWidths;break}}we({table:xe,tableWidth:Ae,columnWidths:Se}),te.markBlockFormat(xe,{commandName:"resizeTableWidth",commandParams:[{tableWidth:Ie,columnWidths:ke}],formatGroupId:"resizeTable"},[],"resizeTable")})}handleSuggestionDescription(we){if(we.type!="formatBlock"&&we.type!="formatInline")return;const{data:t}=we;if(t&&t.formatGroupId==="resizeTable")return{type:"format",content:o(this.editor.locale,"*Format:* resize table")}}}class Ct extends Plugin{afterInit(){const we=this.editor;we.plugins.has("Template")&&we.plugins.get("TrackChangesEditing").enableCommand("insertTemplate")}}class _t extends Plugin{afterInit(){const we=this.editor;if(!we.commands.get("insertTableOfContents"))return;we.plugins.get("TrackChangesEditing").enableCommand("insertTableOfContents");const t=we.plugins.get("TrackChangesEditing"),te=we.locale;t.descriptionFactory.registerElementLabel("tableOfContents",be=>o(te,"ELEMENT_TABLE_OF_CONTENTS",be))}}class Dt extends Plugin{afterInit(){const we=this.editor;if(!we.plugins.has("Title"))return;const t=we.plugins.get("TrackChangesEditing");t.descriptionFactory.registerElementLabel("title-content",()=>o(we.locale,"ELEMENT_TITLE")),we.model.document.registerPostFixer(te=>{let be=!1;const xe=Array.from(we.model.document.differ.getChangedMarkers());for(const{name:ve,data:ke}of xe){const{group:Ie}=t._splitMarkerName(ve);if(Ie!=="suggestion"||!ke.newRange)continue;const Ae=ke.newRange,Se=Ae.end.nodeBefore;if(!Se||!Se.is("element","title-content")||!Ae.start.isTouching(Ae.end))continue;const Oe=we.model.schema.getNearestSelectionRange(Ae.end,"forward");if(Oe&&Oe.isCollapsed){const Ve=te.createRange(Ae.start,Oe.start);Ve.isEqual(Ae)||(te.updateMarker(ve,{range:Ve}),be=!0)}be||(te.removeMarker(ve),be=!0)}return be})}}class Nt extends Plugin{afterInit(){const we=this.editor,t=we.plugins.get("TrackChangesEditing");we.plugins.has("UndoEditing")&&(t.enableCommand("undo"),t.enableCommand("redo"))}}class Mt extends Plugin{static get requires(){return[jt]}afterInit(){const we=this.editor;we.plugins.has("TableCaptionEditing")&&we.plugins.get("TrackChangesEditing").enableCommand("toggleTableCaption")}}class $t extends Plugin{constructor(t){super(t);Re(this,"tableProperties");Re(this,"tableCellProperties");this.tableProperties=["tableBorderColor","tableBorderStyle","tableBorderWidth","tableAlignment","tableWidth","tableHeight","tableBackgroundColor"],this.tableCellProperties=["tableCellBorderColor","tableCellBorderStyle","tableCellBorderWidth","tableCellPadding","tableCellWidth","tableCellHeight","tableCellBackgroundColor","tableCellHorizontalAlignment","tableCellVerticalAlignment"]}static get pluginName(){return"TrackChangesTableProperties"}afterInit(){const t=this.editor.plugins.get("TrackChangesEditing");if(this.editor.plugins.has("TablePropertiesEditing")){for(const te of this.tableProperties)t.enableCommand(te,(be,xe)=>{const ve=this.editor.model.document.selection.getFirstPosition().findAncestor("table");this._handlePropertyChange(te,[ve],this.tableProperties,"tableProperties",be,xe)});t._suggestionFactory.registerCustomCallback("formatBlock","tableProperties","accept",t._suggestionFactory.getSuggestionCallback("formatBlock",null,"discard")),t._suggestionFactory.registerCustomCallback("formatBlock","tableProperties","discard",(te,be)=>this.handleDiscardAction(this.tableProperties,te,be)),t._suggestionFactory.registerCustomCallback("formatBlock","tableProperties","join",()=>!1)}if(this.editor.plugins.has("TableCellPropertiesEditing")){for(const te of this.tableCellProperties)t.enableCommand(te,(be,xe)=>{const ve=this.editor.plugins.get("TableUtils").getSelectionAffectedTableCells(this.editor.model.document.selection);this._handlePropertyChange(te,ve,this.tableCellProperties,"tableCellProperties",be,xe)});t._suggestionFactory.registerCustomCallback("formatBlock","tableCellProperties","accept",t._suggestionFactory.getSuggestionCallback("formatBlock",null,"discard")),t._suggestionFactory.registerCustomCallback("formatBlock","tableCellProperties","discard",(te,be)=>this.handleDiscardAction(this.tableCellProperties,te,be)),t._suggestionFactory.registerCustomCallback("formatBlock","tableCellProperties","join",()=>!1)}t.descriptionFactory.registerDescriptionCallback(te=>this.handleSuggestionDescription(te))}_handlePropertyChange(t,te,be,xe,ve,ke){const Ie=this.editor.plugins.get("TrackChangesEditing");this.editor.model.enqueueChange(ke.batch,()=>{for(const Ae of te)if(this._getSuggestion(Ae,xe))ve(ke);else{const Se={};for(const Oe of be){const Ve=Ae.getAttribute(Oe);Ve!==void 0&&(Se[Oe]=Ve)}ve(ke),Ie.markBlockFormat(Ae,{commandParams:[Se]},[],xe)}})}handleDiscardAction(t,te,be){const xe=te[0].start.nodeAfter,ve=be.commandParams[0];this.editor.model.change(ke=>{for(const Ie of t)ve[Ie]!==void 0?ke.setAttribute(Ie,ve[Ie],xe):ke.removeAttribute(Ie,xe)})}handleSuggestionDescription(t){if(t.data)switch(t.subType){case"tableProperties":return{type:"format",content:o(this.editor.locale,"*Format:* change table properties")};case"tableCellProperties":return{type:"format",content:o(this.editor.locale,"*Format:* change table cell properties")}}}_getSuggestion(t,te){const be=this.editor.plugins.get("TrackChangesEditing");for(const xe of be.getSuggestions({skipNotAttached:!0})){const ve=xe.getContainedElement();if(xe.subType===te&&ve===t)return xe}return null}}const m="$elementName";class p extends Plugin{constructor(t){function te(be){return be.map(xe=>String.fromCharCode(xe)).join("")}super(t);Re(this,"descriptionFactory");Re(this,"trackChangesCommand");Re(this,"_adapter");Re(this,"_suggestionFactory");Re(this,"_suggestions");Re(this,"_commentsRepository");Re(this,"_enabledCommands");Re(this,"_model");Re(this,"_suggestionState");Re(this,"_isForcedDefaultExecutionBlock");Re(this,"_trackFormatChanges");Re(this,"_mergeNestedSuggestions");Re(this,"_blockAttributeKeys");Re(this,"_inlineAttributeKeys");Re(this,"_recordAttributeSuggestions",!1);this.set("activeMarkers",[]),this.on("change:activeMarkers",(be,xe,ve,ke)=>{this._model.change(()=>{for(const Ie of[...ke,...ve])this._model.markers.has(Ie)&&t.editing.reconvertMarker(Ie)})}),this.descriptionFactory=new f(this.editor.model.schema,this.editor.locale),this._adapter=null,this._suggestionFactory=new xt(this.editor),this._suggestions=new Map,this._commentsRepository=t.plugins.get("CommentsRepository"),this._enabledCommands=new Set,this._model=this.editor.model,this._suggestionState=new WeakMap,this._isForcedDefaultExecutionBlock=!1,this._blockAttributeKeys=new Set([m]),this._inlineAttributeKeys=new Set,t.config.define("trackChanges.trackFormatChanges","default"),this._trackFormatChanges=t.config.get("trackChanges.trackFormatChanges"),t.config.define("trackChanges.mergeNestedSuggestions",!0),this._mergeNestedSuggestions=t.config.get("trackChanges.mergeNestedSuggestions"),this.trackChangesCommand=new M(t,this._enabledCommands),this._initAriaMarkerChangeAnnouncements(),this[te([95,101,120,101,99,117,116,101,83,117,103,103,101,115,116,105,111,110])]=te([52,48,52,56,49,52,50,50])}static get requires(){return["CommentsRepository",l$8,PendingActions,E,V,U,O,F,G,L,H,q,W,J,Q,X,Y,Z,tt,et,it,nt,st,ot,rt,at,ut,K,lt,ct,z,ue,ft,gt,mt,dt,pt,kt,bt,wt,yt,jt,St,At,Mt,It,vt,_t,$t,Ct,Dt,Nt]}static get pluginName(){return"TrackChangesEditing"}init(){const t=this.editor,te=(Ie,Ae)=>{if(Ie!="attribute")return"ck-suggestion-marker-"+Ie;const Se=Ae.split("|")[0];return this._isBlockAttribute(Se)?"ck-suggestion-marker-formatBlock":"ck-suggestion-marker-formatInline"};t.conversion.for("editingDowncast").markerToHighlight({model:"suggestion",view:Ie=>{const{id:Ae,type:Se,subType:Oe}=this._splitMarkerName(Ie.markerName),Ve=["ck-suggestion-marker",te(Se,Oe)];let Me=3e3;return this.activeMarkers.includes(Ie.markerName)&&(Ve.push("ck-suggestion-marker--active"),Me=3010),Se=="deletion"&&(Me+=5),{classes:Ve,attributes:{"data-suggestion":Ae},priority:Me}}}),t.conversion.for("dataDowncast").add(Ie=>{Ie.on("addMarker:suggestion",(Ae,Se,Oe)=>{if(!Oe.options.showSuggestionHighlights)return;const Ve=Se.item;if(!Ve)return;const Me=Oe.mapper.toViewElement(Ve);t.model.schema.isObject(Ve)&&Me&&!Me.getCustomProperty("widget")&&Me.is("containerElement")&&toWidget(Me,Oe.writer)},{priority:"high"})}),t.conversion.for("dataDowncast").markerToHighlight({model:"suggestion",view:(Ie,Ae)=>{if(!Ae.options.showSuggestionHighlights)return null;const{type:Se,subType:Oe}=this._splitMarkerName(Ie.markerName);return{classes:["ck-suggestion-marker",te(Se,Oe)],priority:3e3}}});const be=({showActiveMarkers:Ie=!0,isAttributeSuggestion:Ae=!1}={})=>(Se,Oe,Ve)=>{if(!Oe.item)return;const{id:Me}=this._splitMarkerName(Oe.markerName);if(Ae){const Fe=this._suggestions.get(Me),Be=this._getAttributeKey(Fe);if(!this._isBlockAttribute(Be))return}if(Oe.item.is("selection"))return void Ve.consumable.consume(Oe.item,Se.name);const De=Ve.mapper.toViewElement(Oe.item);if(Oe.item.is("element")&&t.model.schema.isBlock(Oe.item)&&!De.getCustomProperty("addHighlight")){Ve.writer.addClass(["ck-suggestion-marker","ck-suggestion-marker-formatBlock"],De),Ve.writer.setAttribute("data-suggestion",Me,De),Ve.mapper.bindElementToMarker(De,Oe.markerName),Ie&&(this.activeMarkers.includes(Oe.markerName)?Ve.writer.addClass("ck-suggestion-marker--active",De):Ve.writer.removeClass("ck-suggestion-marker--active",De));for(const Fe of t.model.createRangeIn(Oe.item).getItems())Ve.consumable.consume(Fe,Se.name);Ve.consumable.consume(Oe.item,Se.name)}};t.conversion.for("dataDowncast").add(Ie=>{Ie.on("addMarker:suggestion:formatBlock",(Ae,Se,Oe)=>{Oe.options.showSuggestionHighlights&&be({showActiveMarkers:!1})(Ae,Se,Oe)},{priority:"highest"})}),t.conversion.for("dataDowncast").add(Ie=>{Ie.on("addMarker:suggestion:attribute",(Ae,Se,Oe)=>{Oe.options.showSuggestionHighlights&&be({showActiveMarkers:!1,isAttributeSuggestion:!0})(Ae,Se,Oe)},{priority:"highest"})}),t.conversion.for("dataDowncast").markerToData({model:"suggestion",view:(Ie,Ae)=>Ae.options.showSuggestionHighlights?null:{group:"suggestion",name:Ie.substr(11)}}),t.conversion.for("upcast").elementToElement({view:{name:"suggestion",attributes:{id:/^\w/,"suggestion-type":/^\w/}},model:(Ie,{writer:Ae})=>{let Se="suggestion:"+Ie.getAttribute("suggestion-type")+":"+Ie.getAttribute("id");return Ie.getAttribute("marker-count")&&(Se+=":"+Ie.getAttribute("marker-count")),Ae.createElement("$marker",{"data-name":Se})}}),t.conversion.for("upcast").dataToMarker({view:"suggestion"}),t.conversion.for("editingDowncast").add(Ie=>{Ie.on("addMarker:suggestion:formatBlock",be(),{priority:"high"})}),t.conversion.for("editingDowncast").add(Ie=>{Ie.on("addMarker:suggestion:attribute",be({isAttributeSuggestion:!0}),{priority:"high"})}),t.conversion.for("editingDowncast").add(Ie=>{Ie.on("removeMarker:suggestion:formatBlock",(Ae,Se,Oe)=>{const Ve=Oe.mapper.markerNameToElements(Se.markerName);if(Ve)for(const Me of Ve)Me.getCustomProperty("addHighlight")||(Oe.writer.removeClass(["ck-suggestion-marker","ck-suggestion-marker-formatBlock","ck-suggestion-marker--active"],Me),Oe.writer.removeAttribute("data-suggestion",Me),Oe.mapper.unbindElementFromMarkerName(Me,Se.markerName))},{priority:"high"})}),t.conversion.for("editingDowncast").add(Ie=>{Ie.on("removeMarker:suggestion:attribute",(Ae,Se,Oe)=>{const Ve=Oe.mapper.markerNameToElements(Se.markerName);if(!Ve)return;const{id:Me}=this._splitMarkerName(Se.markerName),De=this._suggestions.get(Me),Fe=this._getAttributeKey(De);if(this._isBlockAttribute(Fe))for(const Be of Ve)Be.getCustomProperty("addHighlight")||(Oe.writer.removeClass(["ck-suggestion-marker","ck-suggestion-marker-formatBlock","ck-suggestion-marker--active"],Be),Oe.writer.removeAttribute("data-suggestion",Be),Oe.mapper.unbindElementFromMarkerName(Be,Se.markerName))},{priority:"high"})}),t.model.document.registerPostFixer(Ie=>{let Ae=!1;const Se=Array.from(t.model.document.differ.getChangedMarkers()),Oe=new Set;for(const{name:Me,data:De}of Se){const{group:Fe,type:Be,subType:$e,id:Ue}=this._splitMarkerName(Me);if(Fe!=="suggestion")continue;const He=this._suggestions.get(Ue);if(De.newRange!=null){Be=="formatInline"&&(Ae=Ae||Et(De.newRange,Me,Ie,t.model.schema));const ze=Be=="attribute"&&this._isBlockAttribute($e.split("|")[0]);if(De.newRange.isCollapsed||De.newRange.root.rootName=="$graveyard"||Be=="formatBlock"&&!Ut(De.newRange)||ze&&!Ut(De.newRange)||Be=="deletion"&&!(!Tt(Ve=De.newRange)&&!function(qe){return qe.start.parent==qe.end.nodeBefore&&qe.start.isAtEnd}(Ve)))Ie.removeMarker(Me),Ae=!0;else{if(!He||!He.isInContent)continue;Oe.add(He)}}}var Ve;return Oe.size>0&&(Ae=!!this._joinWithAdjacentSuggestions(Oe)||Ae),Ae}),t.model.document.registerPostFixer(Ie=>{let Ae=!1;for(const Se of t.model.document.differ.getChanges())if(Se.type=="insert")for(const Oe of this._suggestions.values()){if(Oe.isMultiRange||!Oe.isInContent)continue;const Ve=Oe.type=="formatBlock",Me=this._getAttributeKey(Oe),De=Me&&this._isBlockAttribute(Me);if(!Ve&&!De)continue;const Fe=Oe.getFirstRange();if(Fe.start.parent!=Fe.end.parent&&!Fe.end.isAtEnd){const Be=t.model.createPositionAt(Fe.start.nodeAfter,"end"),$e=t.model.createRange(Fe.start,Be);Ie.updateMarker(Oe.getFirstMarker(),{range:$e}),Ae=!0}}return Ae}),t.model.document.registerPostFixer(Ie=>this._processAttributeChanges(Ie)),t.model.document.registerPostFixer(Ie=>!Ie.batch.isLocal&&this._processAttributeSuggestions(Ie)),t.model.on("_afterChanges",()=>{this._recordAttributeSuggestions=!1}),t.model.document.on("change:data",(Ie,Ae)=>{if(!Ae.isLocal||Ae.isUndo||!this._recordAttributeSuggestions)return;const Se=t.model.document.differ.getChanges();if(Se.length==0)return;const Oe=[],Ve=Se.filter(De=>De.type=="attribute"),Me=Se.filter(De=>De.type=="insert"&&De.name!="$text");for(const De of Ve)this._isRegisteredAttribute(De.attributeKey)&&Oe.push({key:De.attributeKey,newValue:De.attributeNewValue,oldValue:De.attributeOldValue,range:Ot(De.range,t.model)});for(const De of Me){if(De.action!="rename"&&De.action!="refresh")continue;const Fe=Gt(De.position.nodeAfter,t.model),Be=De.before;De.action=="rename"&&Oe.push({key:m,newValue:De.name,oldValue:Be.name,range:Fe});for(const[$e,Ue]of Be.attributes){if(!this._isRegisteredAttribute($e))continue;const He=De.attributes.get($e);Ue!==He&&Oe.push({key:$e,newValue:He,oldValue:Ue,range:Fe})}for(const[$e,Ue]of De.attributes)this._isRegisteredAttribute($e)&&(Be.attributes.has($e)||Oe.push({key:$e,newValue:Ue,oldValue:null,range:Fe}))}Oe.length!=0&&t.model.enqueueChange(Ae,De=>{const Fe=uid();for(const{range:Be,key:$e,oldValue:Ue,newValue:He}of Oe)this.markAttributeChange(Be,$e,Ue,He,{groupId:Fe});this._reduceExistingSuggestions(De,Oe)})},{priority:"lowest"}),t.model.markers.on("update:suggestion",(Ie,Ae,Se)=>{if(Se==null){const{id:Oe}=this._splitMarkerName(Ae.name),Ve=this._suggestions.get(Oe);Ve&&Ve.addMarkerName(Ae.name)}}),t.model.document.on("change:data",()=>{const Ie=Array.from(t.model.document.differ.getChangedMarkers()).filter(Oe=>this._splitMarkerName(Oe.name).group==="suggestion");if(Ie.length===0)return;Ie.sort((Oe,Ve)=>{const Me=Oe.data.oldRange,De=Ve.data.oldRange;return Me===null&&De===null?0:Me===null&&De!==null?-1:Me!==null&&De===null?1:Me.start.isBefore(De.start)?-1:1});const Ae=new Set,Se=new Set;for(const{name:Oe,data:Ve}of Ie){const{id:Me}=this._splitMarkerName(Oe);if(Ve.oldRange===null){const De=this._handleNewSuggestionMarker(Oe);Se.add(De)}else{const De=this._suggestions.get(Me);Ve.newRange!==null||De.isInContent?(Ae.add(De.head),Se.add(De)):this._removeSuggestion(De)}}Se.size>0&&this._refreshSuggestionsChain(Se);for(const Oe of Ae)this.fire("suggestionChanged",Oe)}),t.model.on("applyOperation",(Ie,Ae)=>{const Se=Ae[0];if(!this._suggestions.size||!Se.isDocumentOperation||Se.batch.isUndo||!Se.batch.isLocal)return;let Oe,Ve;switch(Se.type){case"insert":Oe=t.model.createPositionAt(Se.position),Ve=Oe.getShiftedBy(Se.howMany);break;case"split":Oe=t.model.createPositionAt(Se.splitPosition),Ve=t.model.createPositionAt(Se.moveTargetPosition);break;case"move":Oe=t.model.createPositionAt(Se.targetPosition),Ve=Oe.getShiftedBy(Se.howMany);break;default:return}const Me=t.model.createRange(Oe,Ve);t.model.change(()=>{for(const{suggestion:De,meta:Fe}of this._findSuggestions(Me)){if(De.isMultiRange||De.type=="formatInline")continue;const Be=this._getAttributeKey(De);if(Be&&this._isBlockAttribute(Be)&&Se.type!="split")continue;const $e=De.data&&De.data.multipleBlocks;(De.type!="formatBlock"||Se.type=="split"&&!$e)&&(Fe.containsRangeInObject||De.type=="insertion"&&Fe.isOwn||De.getFirstRange().containsRange(Me)&&this._breakSuggestionMarker(De,Oe,Ve))}})},{priority:"lowest"}),t.model.on("deleteContent",(Ie,Ae)=>{const Se=Ae[0],Oe=Ae[1];if(Oe&&Oe.forceDefaultExecution||this._isForcedDefaultExecutionBlock||!this.trackChangesCommand.value||Se.isCollapsed)return;const Ve=t.model.schema,{start:Me,end:De}=Se.getFirstRange(),Fe=Me.nodeAfter&&Ve.isLimit(Me.nodeAfter)?null:Ve.getNearestSelectionRange(Me,"forward"),Be=De.nodeBefore&&Ve.isLimit(De.nodeBefore)?null:Ve.getNearestSelectionRange(De,"backward"),$e=t.model.createRange(Fe?Fe.start:Me,Be?Be.end:De);t.model.change(Ue=>{this.markDeletion($e);const He=t.model.schema.getNearestSelectionRange($e.start);Se.is("documentSelection")?Ue.setSelection(He):Se.setTo(He)}),Ie.stop()},{priority:priorities.normal+10}),t.model.on("insertContent",(Ie,Ae)=>{const Se=Ae[Ae.length-1];Se&&Se.forceDefaultExecution||this._isForcedDefaultExecutionBlock||this.trackChangesCommand.value&&(t.model.change(()=>{let Oe=t.model.insertContent(Ae[0],Ae[1],Ae[2],{forceDefaultExecution:!0});if(!Oe)return;Ie.return=Oe.clone();const Ve=Oe.end.nodeBefore,Me=t.model.schema;Ve&&Me.isBlock(Ve)&&!Me.isObject(Ve)&&(Oe=t.model.createRange(Oe.start,t.model.createPositionAt(Ve,"end"))),this.markInsertion(Oe)}),Ie.stop())},{priority:"high"}),this.editor.commands.add("trackChanges",this.trackChangesCommand),this.enableCommand("trackChanges");const xe=new $(t,this._suggestions);t.commands.add("acceptSuggestion",xe),this.enableCommand("acceptSuggestion");const ve=new B(t,this._suggestions);t.commands.add("discardSuggestion",ve),this.enableCommand("discardSuggestion"),t.commands.add("acceptAllSuggestions",new x(t,xe,this._suggestions)),this.enableCommand("acceptAllSuggestions"),t.commands.add("discardAllSuggestions",new x(t,ve,this._suggestions)),this.enableCommand("discardAllSuggestions"),t.commands.add("acceptSelectedSuggestions",new R(t,xe,this._suggestions)),this.enableCommand("acceptSelectedSuggestions"),t.commands.add("discardSelectedSuggestions",new R(t,ve,this._suggestions)),this.enableCommand("discardSelectedSuggestions");const ke=t.plugins.get("CommentsRepository");this.listenTo(ke,"addComment",(Ie,{threadId:Ae})=>{const Se=this._suggestions.get(Ae);Se&&Se.commentThread&&Se.commentThread.length===1&&this._updateSuggestionData(Ae,{hasComments:!0})},{priority:"low"}),this.listenTo(ke,"removeComment",(Ie,{threadId:Ae})=>{const Se=this._suggestions.get(Ae);Se&&Se.commentThread&&!Se.commentThread.length&&this._updateSuggestionData(Ae,{hasComments:!1})},{priority:"low"})}set adapter(t){if(this._adapter)throw new CKEditorError("track-changes-adapter-already-set",this);this._adapter=t}get adapter(){return this._adapter}getSuggestions({skipNotAttached:t=!1,toJSON:te=!1}={}){const be=[];for(const xe of this._suggestions.values())t&&!xe.isInContent||be.push(xe);return te?be.map(xe=>xe.toJSON()):be}getSuggestion(t){const te=this._suggestions.get(t);if(!te)throw new CKEditorError("track-changes-suggestion-not-found",this);return te}hasSuggestion(t){return this._suggestions.has(t)}addSuggestionData(t){const{authorId:te,id:be,attributes:xe}=t,[ve,ke]=t.type.split(":"),Ie=this._suggestions.get(be)||this._createSuggestion(ve,ke,be,te,xe);if(this._addThreadToSuggestion(Ie),this._checkSuggestionCorrectness(Ie,ve,ke||null,te),Ie.createdAt=t.createdAt,Ie._isDataLoaded=!0,xe&&xe["@external"]){const Ae=xe["@external"],Se=this._getExternalAuthor(Ae.authorName);Ie.authoredAt=Ae.createdAt,Ie.author=Se,Ie.isExternal=!0}else Ie.authoredAt=t.createdAt;switch(t.data&&(Ie.data=t.data),t.attributes&&(Ie.attributes=t.attributes),this._adapter&&this._adapter.addSuggestion||(Ie._saved=!0),this._suggestionState.get(Ie)){case"notReady":this._suggestionState.set(Ie,"dataReady");break;case"markerReady":Ie.isInContent?(this._joinWithAdjacentSuggestions(new Set([Ie])),this._refreshSuggestionsChain(new Set([Ie])),this._suggestionState.set(Ie,"ready"),this.fire("suggestionLoaded",Ie)):this._suggestionState.set(Ie,"removed")}return Ie}acceptSuggestion(t){this.forceDefaultExecution(()=>{this.editor.model.change(()=>{for(const te of t.getAllAdjacentSuggestions())te.accept()})})}discardSuggestion(t){this.forceDefaultExecution(()=>{this.editor.model.change(()=>{for(const te of t.getAllAdjacentSuggestions())te.discard()})})}enableCommand(t,te){const be=this.editor.commands.get(t);if(!be)throw new CKEditorError("track-changes-command-not-found",this,{commandName:t});if(this._enabledCommands.has(be))throw new CKEditorError("track-changes-enable-command-twice",this,{commandName:t});this._enabledCommands.add(be),te&&be.on("execute",(xe,ve)=>{this.trackChangesCommand.value&&(this._isForcedDefaultExecutionBlock||(ve.length>0&&ve[ve.length-1]&&ve[ve.length-1].forceDefaultExecution?ve.pop():(xe.return=te((...ke)=>be.execute(...ke,{forceDefaultExecution:!0}),...ve),xe.stop())))},{priority:"high"})}forceDefaultExecution(t){let te,be;const xe=this._isForcedDefaultExecutionBlock;this._isForcedDefaultExecutionBlock=!0;try{te=t()}catch(ve){be=ve}return xe||(this._isForcedDefaultExecutionBlock=!1),be&&CKEditorError.rethrowUnexpectedError(be,this),te}markInsertion(t,te=null,be={}){if(t.isCollapsed)return null;const xe=this.editor.plugins.get("Users").me;for(const{suggestion:Se,meta:Oe}of this._findSuggestions(t,"insertion"))if(Oe.isOwn){if(!Oe.isNextTo){if(Oe.containsRangeInObject){if(!this._mergeNestedSuggestions||!Lt(Se,be))continue;return Se}if(Lt(Se,be))return Se;this._breakSuggestionMarker(Se,t.start,t.end);break}if(te==Se.subType&&Lt(Se,be)){const Ve=Se.getFirstRange();return Ve.start.isEqual(t.end)?this._setSuggestionRange(Se,this._model.createRange(t.start,Ve.end)):this._setSuggestionRange(Se,this._model.createRange(Ve.start,t.end)),Se}}const ve=uid(),ke=xe.id,Ie=te?"insertion:"+te:"insertion",Ae=this._setSuggestionData({id:ve,type:Ie,createdAt:new Date,authorId:ke,attributes:be});return this._addSuggestionMarker(Ie,ve,ke,t),Ae}markMultiRangeInsertion(t,te="multi",be={}){const xe=this.editor.plugins.get("Users").me,ve=this._suggestionFactory.getSuggestionCallback("insertion",te,"join");for(const Oe of this.getSuggestions())if(Oe.author.id==xe.id&&Oe.type=="insertion"&&Oe.subType==te&&Lt(Oe,be)&&(ve(Oe.getRanges(),t)||ve(t,Oe.getRanges()))){for(const Ve of t)Oe.addRange(Ve);return Oe}for(const{suggestion:Oe,meta:Ve}of this._findSuggestions(t,"insertion")){if(!Ve.isOwn||!this._mergeNestedSuggestions&&Ve.containsRangeInObject||!Lt(Oe,be))continue;let Me=!0;for(const De of Oe.getRanges())for(const Fe of t)if(!De.containsRange(Fe)){Me=!1;break}if(Me)return Oe}const ke=uid(),Ie=xe.id,Ae="insertion:"+te,Se=this._setSuggestionData({id:ke,type:Ae,createdAt:new Date,authorId:Ie,attributes:be});for(const Oe of t)this._addSuggestionMarker(Ae,ke,Ie,Oe,u.getMultiRangeId());return Se}markInlineFormat(t,te,be=null,xe={}){if(be=be||Vt(te),t.isCollapsed)return null;if(this._trackFormatChanges==="never"){const Se=this._suggestionFactory.getSuggestionCallback("formatInline",be,"accept");return this.forceDefaultExecution(()=>Se([t],te,xe)),null}const ve=this.editor.plugins.get("Users").me,ke=[];if(this._trackFormatChanges!=="always")for(const{suggestion:Se,meta:Oe}of this._findSuggestions(t,"insertion"))Oe.isOwn&&!Oe.isInsideObject&&ke.push(...Se.getRanges());const Ie=function(Se,Oe){const Ve=[];for(const Me of Oe){const De=Se.getIntersection(Me);De&&Ve.push(De)}return Ve}(t,ke),Ae=function(Se,Oe){const Ve=[Se];for(const Me of Oe){let De=0;for(;De<Ve.length;){const Fe=Ve[De].getDifference(Me);Ve.splice(De,1,...Fe),De+=Fe.length}}return Ve}(t,ke);Ie.length&&this._model.change(()=>{for(const Se of Ie){const Oe=this._suggestionFactory.getSuggestionCallback("formatInline",be,"accept");this.forceDefaultExecution(()=>Oe([Se],te,xe))}});for(const Se of Ae){let Oe=null,Ve=Se.start,Me=Se.end;for(const{suggestion:Fe,meta:Be}of this._findSuggestions(Se,"formatInline")){if(!Be.isOwn||Fe.subType!=be||!Lt(Fe,xe))continue;const $e=Fe.getFirstRange();if($e.containsRange(Se,!0))return null;Ve=Ve.isBefore($e.start)?Ve:$e.start,Me=Me.isAfter($e.end)?Me:$e.end,Oe?$e.start.isBefore(Oe.getFirstRange().start)?(Oe.removeMarkers(),Oe=Fe):Fe.removeMarkers():Oe=Fe}const De=this._model.createRange(Ve,Me);if(Oe)this._setSuggestionRange(Oe,De);else{const Fe=uid(),Be=ve.id;this._setSuggestionData({id:Fe,type:"formatInline:"+be,data:te,createdAt:new Date,authorId:Be,attributes:xe}),this._addSuggestionMarker("formatInline:"+be,Fe,Be,De)}}return null}markBlockFormat(t,te,be=[],xe=null,ve={}){te.formatGroupId||(te.formatGroupId=te.commandName),te.multipleBlocks=t.is("range"),xe=xe||Vt(te);const ke=be.map(Be=>Gt(Be,this._model)),Ie=t.is("range")?t:Gt(t,this._model);if(this._trackFormatChanges==="never"){const Be=this._suggestionFactory.getSuggestionCallback("formatBlock",xe,"accept");return this.forceDefaultExecution(()=>Be([Ie],te,ve)),null}ke.push(Ie);let Ae=!0;for(const Be of ke)if(!this._rangeIsInLocalUserInsertion(Be)){Ae=!1;break}if(Ae&&this._trackFormatChanges!=="always"){const Be=this._suggestionFactory.getSuggestionCallback("formatBlock",xe,"accept");return this.forceDefaultExecution(()=>Be([Ie],te,ve)),null}let Se=null,Oe=Ie.start,Ve=Ie.end;for(const{suggestion:Be,meta:$e}of this._findSuggestions(Ie,"formatBlock")){if(!$e.isOwn||$e.isNextTo||$e.containsRangeInObject||$e.isInsideObject||Be.data.formatGroupId!=te.formatGroupId||!Lt(Be,ve))continue;const Ue=Be.getFirstRange();if(Be.subType==xe){if(Ue.containsRange(Ie,!0))return null;Oe=Oe.isBefore(Ue.start)?Oe:Ue.start,Ve=Ve.isAfter(Ue.end)?Ve:Ue.end,Se?Ue.start.isBefore(Se.getFirstRange().start)?(Se.removeMarkers(),Se=Be):Be.removeMarkers():Se=Be}else{const He=Ie.getIntersection(Ue);this._cutOutSuggestionMarker(Be,He)}}const Me=this.editor.plugins.get("Users").me,De=uid(),Fe=Me.id;if(Se)return this._setSuggestionRange(Se,this._model.createRange(Oe,Ve)),Se;{const Be=this._setSuggestionData({id:De,type:"formatBlock:"+xe,data:te,createdAt:new Date,authorId:Fe,attributes:ve});return this._addSuggestionMarker("formatBlock:"+xe,De,Fe,this._model.createRange(Oe,Ve)),Be}}markMultiRangeBlockFormat(t,te,be=[],xe=null,ve={}){te.formatGroupId||(te.formatGroupId=te.commandName);const ke=t[0];te.multipleBlocks=ke.is("range"),xe=xe||Vt(te);const Ie=be.map($e=>Gt($e,this._model)),Ae=ke.is("range")?t:t.map($e=>Gt($e,this._model));if(this._trackFormatChanges==="never"){const $e=this._suggestionFactory.getSuggestionCallback("formatBlock",xe,"accept");return this.forceDefaultExecution(()=>$e(Ae,te,ve)),null}Ie.push(...Ae);let Se=!0;for(const $e of Ie)if(!this._rangeIsInLocalUserInsertion($e)){Se=!1;break}if(Se&&this._trackFormatChanges!=="always"){const $e=this._suggestionFactory.getSuggestionCallback("formatBlock",xe,"accept");return this.forceDefaultExecution(()=>$e(Ae,te,ve)),null}const Oe=this.editor.plugins.get("Users").me;for(const $e of this.getSuggestions()){if($e.author.id!=Oe.id||$e.type!="formatBlock"||$e.data.formatGroupId!=te.formatGroupId||!Lt($e,ve))continue;const Ue=$e.subType==xe;for(let He=0;He<Ae.length;He++){const ze=Ae[He];for(const qe of $e.getMarkers()){const Ke=qe.getRange();if(ze.isEqual(Ke)){Ue?(Ae.splice(He,1),He--):$e.removeMarker(qe.name);break}}}}if(Ae.length==0)return null;const Ve=this._suggestionFactory.getSuggestionCallback("formatBlock",xe,"join");for(const $e of this.getSuggestions())if($e.author.id==Oe.id&&$e.type=="formatBlock"&&$e.data.formatGroupId==te.formatGroupId&&$e.subType==xe&&Lt($e,ve)&&(Ve($e.getRanges(),Ae)||Ve(Ae,$e.getRanges()))){for(const Ue of Ae)$e.addRange(Ue);return $e}const Me=uid(),De=Oe.id,Fe="formatBlock:"+xe,Be=this._setSuggestionData({id:Me,type:Fe,data:te,createdAt:new Date,authorId:De,attributes:ve});for(const $e of Ae)this._addSuggestionMarker(Fe,Me,De,$e,u.getMultiRangeId());return Be}markDeletion(t,te=null,be={}){if(t.isCollapsed)return null;const xe=this.editor.plugins.get("Users").me,ve=new LiveRange(t.start,t.end);for(const{suggestion:Oe,meta:Ve}of this._findSuggestions(ve,"insertion"))if(Ve.isOwn&&!Ve.isNextTo)if(Oe.isMultiRange){const Me=Oe.getRanges().filter(De=>De.root.rootName!="$graveyard");if(Me.every(De=>ve.containsRange(De,!0))&&Oe.discard(),Me.some(De=>De.containsRange(ve,!0))){const De=this._suggestionFactory.getSuggestionCallback("deletion",te,"accept");return this.forceDefaultExecution(()=>De([ve],null,be)),null}}else{const Me=ve.getIntersection(Oe.getFirstRange());Me!==null&&Oe._onDiscard([Me],null,be)}if(ve.detach(),ve.isCollapsed||ve.root.rootName=="$graveyard")return null;let ke=null,Ie=ve.start,Ae=ve.end;const Se=this._findSuggestions(ve,"deletion");for(const{suggestion:Oe,meta:Ve}of Se){const Me=this._model.createRange(Ie,Ae);if(Ve.isOwn&&(this._mergeNestedSuggestions||!Ve.containsRangeInObject&&!Ve.isInsideObject))if(Oe.isMultiRange){if(!Lt(Oe,be))continue;let De=!0;for(const Fe of Oe.getRanges()){if(Fe.containsRange(Me,!0))return Oe;Me.containsRange(Fe)||(De=!1)}De&&Oe.discard()}else{const De=Oe.getFirstRange();if(De.containsRange(Me,!0))return Oe;if(!Lt(Oe,be)){Me.containsRange(De)?Oe.removeMarkers():De.containsPosition(Ie)?Ie=De.end:De.containsPosition(Ae)&&(Ae=De.start);continue}Ie=Ie.isBefore(De.start)?Ie:De.start,Ae=Ae.isAfter(De.end)?Ae:De.end,be=Object.assign({},Oe.attributes),ke?De.start.isBefore(ke.getFirstRange().start)?(ke.removeMarkers(),ke=Oe):Oe.removeMarkers():ke=Oe}}if(ke)return this._setSuggestionRange(ke,this._model.createRange(Ie,Ae)),ke;{const Oe=uid(),Ve=this._model.createRange(Ie,Ae),Me=xe.id,De=te?"deletion:"+te:"deletion",Fe=this._setSuggestionData({id:Oe,type:De,createdAt:new Date,authorId:Me,attributes:be});return this._addSuggestionMarker(De,Oe,Me,Ve),Fe}}markMultiRangeDeletion(t,te="multi",be={}){const xe=this.editor.plugins.get("Users").me,ve=t.map(De=>new LiveRange(De.start,De.end)),ke=new Set;for(const{suggestion:De,meta:Fe}of this._findSuggestions(ve,"insertion"))Fe.isOwn&&!Fe.isNextTo&&ke.add(De);for(const De of ke)if(De.isMultiRange){const Fe=De.getRanges();if((!De.attributes||!De.attributes.skipNestingCheck)&&Fe.every(Be=>ve.some($e=>$e.containsRange(Be,!0)))&&De.discard(),ve.every(Be=>Fe.some($e=>$e.containsRange(Be,!0)))){const Be=this._suggestionFactory.getSuggestionCallback("deletion",te,"accept");return this.forceDefaultExecution(()=>Be(t,null,be)),null}}else{const Fe=De.getFirstRange();if(ve.some(Be=>Be.containsRange(Fe,!0))&&De.discard(),ve.every(Be=>Fe.containsRange(Be,!0))){const Be=this._suggestionFactory.getSuggestionCallback("deletion",te,"accept");return this.forceDefaultExecution(()=>Be(ve,null,be)),null}}const Ie=this._suggestionFactory.getSuggestionCallback("deletion",te,"join");let Ae=null;for(const De of this.getSuggestions())if(De.author.id==xe.id&&De.isInContent&&De.type=="deletion"&&De.subType==te&&Lt(De,be)&&(Ie(De.getRanges(),ve)||Ie(ve,De.getRanges())))if(Ae){if(De.commentThread&&De.commentThread.length)continue;for(const Fe of De.getRanges())Ae.isIntersectingWithRange(Fe)||Ae.addRange(Fe);De.removeMarkers()}else{Ae=De;for(const Fe of ve)De.isIntersectingWithRange(Fe)||De.addRange(Fe)}if(Ae)return Ae;ke.clear();for(const{suggestion:De,meta:Fe}of this._findSuggestions(ve,"deletion"))Fe.isOwn&&(this._mergeNestedSuggestions||!Fe.containsRangeInObject&&!Fe.isInsideObject)&&Lt(De,be)&&ke.add(De);for(const De of ke){const Fe=De.getRanges();if((!be||!be.skipNestingCheck)&&ve.every(Be=>Fe.some($e=>$e.containsRange(Be,!0))))return De;(!De.attributes||!De.attributes.skipNestingCheck)&&Fe.every(Be=>ve.some($e=>$e.containsRange(Be,!0)))&&De.discard()}const Se=uid(),Oe=xe.id,Ve="deletion:"+te,Me=this._setSuggestionData({id:Se,type:Ve,createdAt:new Date,authorId:Oe,attributes:be});for(const De of ve)De.detach(),De.isCollapsed||De.root.rootName=="$graveyard"||this._addSuggestionMarker(Ve,Se,Oe,De,u.getMultiRangeId());return Me}markAttributeChange(t,te,be,xe,ve){if(t.isCollapsed)return[];if(this._trackFormatChanges==="never")return[];const ke=this.editor.plugins.get("Users").me.id,Ie=Array.from(this._suggestions.values()).filter(Oe=>Oe.type=="attribute"&&Oe.data.key==te&&Oe.isIntersectingWithRange(t));if(this._trackFormatChanges==="default"){const Oe=this._findSuggestions(t,"insertion").filter(({meta:Ve})=>Ve.isOwn&&!Ve.isInsideObject&&!Ve.isNextTo).map(({suggestion:Ve})=>Ve);Ie.unshift(...Oe)}const Ae=new Map([[t,be]]);for(const Oe of Ie){const Ve=Oe.type=="attribute"?Oe.data.oldValue:void 0,Me=Oe.getFirstRange(),De=Array.from(Ae.keys()).find(Be=>Be.isIntersecting(Me));if(!De)continue;const Fe=De.getDifference(Me);this._isBlockAttribute(te)&&Oe.type=="insertion"&&Fe.length!=0||(Ae.delete(De),Fe.forEach(Be=>{Ae.set(Be,be)}),Oe.type!="insertion"&&Ve!=xe&&Ae.set(De.getIntersection(Me),Ve))}const Se=[];for(const[Oe,Ve]of Ae){const Me=uid(),De={key:te,oldValue:Ve,newValue:xe};te.length>37&&console.warn("Creating a suggestion for attribute with too long attribute key. This may lead to errors. Change the attribute key to a value shorter than 37 characters.",{key:te});const Fe=("attribute:"+(te+"|"+Vt({newValue:xe}))).substring(0,60),Be=this._setSuggestionData({id:Me,type:Fe,data:De,createdAt:new Date,authorId:ke,attributes:ve});Se.push(Be),this._addSuggestionMarker(Fe,Me,ke,Oe)}return Se}enableDefaultAttributesIntegration(t){this.enableCommand(t,(te,...be)=>{this._recordAttributeChanges(()=>{te(...be)})})}registerBlockAttribute(t){this._blockAttributeKeys.add(t)}registerInlineAttribute(t){this._inlineAttributeKeys.add(t)}_getAttributeKey(t){return t.type=="attribute"?t.subType.split("|")[0]:null}_setSuggestionRange(t,te){const be=t.getFirstMarker();this._model.change(xe=>{xe.updateMarker(be,{range:te})})}_addThreadToSuggestion(t){const te=t.id,be=this.editor.config.get("collaboration.channelId");this._commentsRepository.hasCommentThread(te)||this._commentsRepository.addCommentThread({channelId:be,threadId:te,isResolvable:!1,isSubmitted:!0});const xe=this._commentsRepository.getCommentThread(te);xe.unbind("isRemovable"),xe.isRemovable=!1,t.commentThread=xe}_checkSuggestionCorrectness(t,te,be,xe){if(t.type!=te||t.subType!=be||t.creator.id!=xe)throw this.editor.enableReadOnlyMode("track-changes-suggestion-data-mismatch"),new CKEditorError("track-changes-suggestion-data-mismatch",this)}_cutOutSuggestionMarker(t,te){const be=t.getFirstRange();if(te.isEqual(be))t.removeMarkers();else if(be.containsRange(te)){const xe=this._model.createPositionAt(te.start.nodeBefore,"end");this._setSuggestionRange(t,this._model.createRange(be.start,xe));const ve=uid(),ke=t.creator.id,Ie=t.type+":"+t.subType;this._setSuggestionData({id:ve,type:Ie,createdAt:new Date,authorId:ke,data:t.data,attributes:t.attributes});const Ae=this._model.createPositionAt(te.end.parent,"after"),Se=this._model.createRange(Ae,be.end);this._addSuggestionMarker(Ie,ve,ke,Se)}else if(be.containsPosition(te.start)){const xe=this._model.createPositionAt(te.start.nodeBefore,"end");this._setSuggestionRange(t,this._model.createRange(be.start,xe))}else{const xe=this._model.createPositionAt(te.end.parent,"after");this._setSuggestionRange(t,this._model.createRange(xe,be.end))}}_rangeIsInLocalUserInsertion(t){for(const{suggestion:te,meta:be}of this._findSuggestions(t,"insertion")){if(!be.isOwn)continue;const xe=te.getRanges();for(const ve of xe)if(!t.getDifference(ve).length)return!0}return!1}_getAuthorFromId(t){const te=this.editor.plugins.get("Users").getUser(t);if(!te)throw new CKEditorError("track-changes-user-not-found",this);return te}_getExternalAuthor(t){const te=this.editor.plugins.get("Users"),be=b$4("external:"+t);return te.getUser(be)||te.addUser({id:be,name:t})}_createSuggestion(t,te,be,xe,ve){const ke=this._getAuthorFromId(xe),Ie=this._suggestionFactory.buildSuggestion(t,te,be,ke,ve,Ae=>{this._updateSuggestionData(be,{attributes:Ae});const Se=this.getSuggestion(be);this._joinWithAdjacentSuggestions(new Set([Se])),this._refreshSuggestionsChain(new Set([Se]))});return this.listenTo(Ie,"accept",()=>{this._updateSuggestionData(be,{state:"accepted"})},{priority:"high"}),this.listenTo(Ie,"discard",()=>{this._updateSuggestionData(be,{state:"rejected"})},{priority:"high"}),this._suggestions.set(be,Ie),this._suggestionState.set(Ie,"notReady"),Ie}_splitMarkerName(t){const te=t.split(":");return{group:te[0],type:te[1],subType:te.length>=5?te[2]:null,id:te.length<5?te[2]:te[3],authorId:te.length<5?te[3]:te[4],markerCount:te.length==6?te[5]:null}}_breakSuggestionMarker(t,te,be){const xe=t.getFirstRange(),ve=xe.start,ke=xe.end;this._setSuggestionRange(t,this._model.createRange(ve,te));const Ie=uid(),Ae=t.creator.id,Se=t.type+(t.subType?":"+t.subType:"");this._setSuggestionData({id:Ie,type:Se,createdAt:new Date,authorId:Ae,originalSuggestionId:t.id,attributes:t.attributes,data:t.data});const Oe=this._getAttributeKey(t);(t.type=="formatBlock"||Oe&&this._isBlockAttribute(Oe))&&(be=this._model.createPositionBefore(be.parent)),this._addSuggestionMarker(Se,Ie,Ae,this._model.createRange(be,ke))}_findSuggestions(t,te=null){const be=[],xe=this.editor.plugins.get("Users").me;Array.isArray(t)||(t=[t]);for(const ve of this.getSuggestions()){if(!ve.isInContent||te&&ve.type!=te)continue;let ke=!1;for(const Ie of ve.getRanges()){for(const Ae of t){const Se=Ae.start.isEqual(Ie.end)||Ae.end.isEqual(Ie.start);if(Se||Ae.getIntersection(Ie)){const Oe=Ae.containsRange(Ie)&&Rt(this._model.schema,Ie.start,Ae),Ve=Ie.containsRange(Ae)&&Rt(this._model.schema,Ae.start,Ie);be.push({suggestion:ve,meta:{isOwn:xe==ve.author,isNextTo:Se,isInsideObject:Oe,containsRangeInObject:Ve}}),ke=!0;break}}if(ke)break}}return be}_addSuggestionMarker(t,te,be,xe,ve){this._model.change(ke=>{let Ie="suggestion:"+t+":"+te+":"+be;ve&&(Ie=Ie+":"+ve),ke.addMarker(Ie,{range:xe,usingOperation:!0,affectsData:!0})})}_removeSuggestion(t){const te=t.previous,be=t.next;t.previous=null,t.next=null,te!=null&&te.next==t&&(te.next=be),be!=null&&be.previous==t&&(be.previous=te),this._suggestionState.get(t)=="ready"&&(this._suggestionState.set(t,"removed"),this.fire("suggestionUnloaded",t,te,be))}_setSuggestionData(t){const te=t.id,be=this.addSuggestionData(t);if(this._adapter&&this._adapter.addSuggestion){const xe=this.editor.plugins.get("PendingActions"),ve=be.hasComments,ke=be.subType?be.type+":"+be.subType:be.type,Ie=this.editor.locale,Ae=xe.add(o(Ie,"PENDING_ACTION_SUGGESTION")),Se={id:te,type:ke,hasComments:ve,data:t.data||null,originalSuggestionId:t.originalSuggestionId||null,attributes:be.attributes};this._adapter.addSuggestion(Se).then(Oe=>{be._saved=!0,xe.remove(Ae),Oe&&Oe.createdAt&&(this._suggestions.get(te).createdAt=Oe.createdAt)}).catch(Oe=>{throw logWarning("error-saving-suggestion-data-suggestion-discarded"),this.editor.model.enqueueChange({isUndoable:!1},()=>{be.discard()}),be.stopListening(),this._suggestions.delete(be.id),this._suggestionState.delete(be),Oe})}return be}_isBlockAttribute(t){return this._blockAttributeKeys.has(t)}_updateSuggestionData(t,te){const be=this.editor.plugins.get("PendingActions"),xe=this.getSuggestion(t);if(this._adapter&&this._adapter.updateSuggestion)if(xe._saved){const ve=be.add(o(this.editor.locale,"PENDING_ACTION_SUGGESTION"));this._adapter.updateSuggestion(t,te).then(()=>{be.remove(ve)})}else xe.on("change:_saved",()=>{this._updateSuggestionData(t,te)})}_getSuggestionData(t){if(!this._adapter||!this._adapter.getSuggestion)throw new CKEditorError("track-changes-adapter-missing-getsuggestion",this);return this._adapter.getSuggestion(t)}_handleNewSuggestionMarker(t){const{id:te,type:be,subType:xe,authorId:ve}=this._splitMarkerName(t),ke=this._suggestions.get(te)||this._createSuggestion(be,xe,te,ve,{});switch(this._checkSuggestionCorrectness(ke,be,xe,ve),this._suggestionState.get(ke)){case"notReady":this._getSuggestionData(te).then(Ie=>{let Ae=Promise.resolve();Ie.hasComments&&(Ae=this._commentsRepository.fetchCommentThread({channelId:this.editor.config.get("collaboration.channelId"),threadId:te})),Ae.then(()=>{this.addSuggestionData(Ie)._saved=!0})}),this._suggestionState.set(ke,"markerReady");break;case"removed":this._updateSuggestionData(te,{state:"open"});case"dataReady":this._suggestionState.set(ke,"ready"),this.fire("suggestionLoaded",ke);break;case"ready":this.fire("suggestionChanged",ke)}return ke.addMarkerName(t),ke}_refreshSuggestionsChain(t){const te=Array.from(t),be=te.filter(Fe=>Fe.type=="attribute");this._refreshAttributeSuggestionsChain(be);const xe=te.filter(Fe=>!Fe.isMultiRange&&Fe.type!="attribute"),ve=this.getSuggestions({skipNotAttached:!0}).filter(Fe=>!Fe.isMultiRange&&Fe.type!="attribute"),ke=ve.filter(Fe=>!t.has(Fe)),Ie=new Map(ve.map(Fe=>[Fe,this._suggestionFactory.getSuggestionCallback(Fe.type,Fe.subType,"chain")])),Ae=new Map(ve.map(Fe=>[Fe,Fe.getFirstRange()])),Se=new Set,Oe=new Set;for(let Fe=0;Fe<xe.length;Fe++)Me(xe[Fe],xe,Fe+1);for(let Fe=0;Fe<xe.length;Fe++)Me(xe[Fe],ke,0);const Ve=new Set;for(let Fe=0;Fe<xe.length;Fe++){const Be=xe[Fe];!Oe.has(Be)&&Be.previous&&(Ve.add(Be.previous),Be.previous.next===Be&&(Be.previous.next=null),Be.previous=null),!Se.has(Be)&&Be.next&&(Ve.add(Be.next),Be.next.previous===Be&&(Be.next.previous=null),Be.next=null)}function Me(Fe,Be,$e){for(let Ue=$e;Ue<Be.length;Ue++){const He=De(Fe,Be[Ue]);He&&(He[0].next=He[1],He[1].previous=He[0],Se.add(He[0]),Oe.add(He[1]))}}function De(Fe,Be){if(Fe.author.id!==Be.author.id)return null;const $e=Ie.get(Fe)(Fe,Be,Ae.get(Fe),Ae.get(Be));return $e&&Ie.get(Be)(Fe,Be,Ae.get(Fe),Ae.get(Be))?$e[1].commentThread&&$e[1].commentThread.length?null:$e:null}Ve.size&&this._refreshSuggestionsChain(Ve)}_refreshAttributeSuggestionsChain(t){if(t.length==0)return;const te=this.getSuggestions({skipNotAttached:!0}).filter(ke=>ke.type=="attribute"&&ke._isDataLoaded),be=[],xe=new Map;for(const ke of te){const Ie=b$4(ke.attributes);xe.has(Ie)||(xe.set(Ie,be.length),be.push([]));const Ae=xe.get(Ie);be[Ae].push(ke)}(function(){be.sort((ke,Ie)=>{const Ae=ke[0].createdAt,Se=Ie[0].createdAt;return Ae==Se?ke[0].attributes.groupId<Ie[0].attributes.groupId?-1:1:Ae<Se?-1:1});for(const ke of be)ke.sort((Ie,Ae)=>Ie.id<Ae.id?-1:1)})();for(let ke=0;ke<be.length;ke++){if(be[ke].length==0)continue;const Ie=[];for(let Ae=ke+1;Ae<be.length;Ae++)be[Ae].length!=0&&ve(be[ke],be[Ae])&&Ie.push(Ae);for(const Ae of Ie)be[ke]=be[ke].concat(be[Ae]),be[Ae]=[]}for(const ke of be)for(let Ie=0;Ie<ke.length;Ie++)ke[Ie].next=ke[Ie+1]||null;for(const ke of be)for(let Ie=0;Ie<ke.length;Ie++)ke[Ie].previous=ke[Ie-1]||null;function ve(ke,Ie){if(ke[0].attributes.groupId!==Ie[0].attributes.groupId&&ke[0].author!==Ie[0].author||!function(Oe,Ve){return!Oe.hasComments&&!Ve.hasComments?!0:Oe.hasComments&&Ve.hasComments?!1:!!(Oe.hasComments&&Ve.createdAt<Oe.commentThread.comments.get(0).createdAt||Ve.hasComments&&Oe.createdAt<Ve.commentThread.comments.get(0).createdAt)}(ke[0],Ie[0]))return!1;const Ae=omit(ke[0].attributes,"groupId"),Se=omit(Ie[0].attributes,"groupId");return isEqual(Ae,Se)?!!ke.every(Oe=>Ie.some(Ve=>Oe.getFirstRange().isEqual(Ve.getFirstRange())))&&Ie.every(Oe=>ke.some(Ve=>Oe.getFirstRange().isEqual(Ve.getFirstRange()))):!1}}_joinWithAdjacentSuggestions(t){const te=Array.from(t),be=this.getSuggestions({skipNotAttached:!0}),xe=be.filter(Ae=>!t.has(Ae)),ve=new Map(te.map(Ae=>[Ae,this._suggestionFactory.getSuggestionCallback(Ae.type,Ae.subType,"join")])),ke=new Map(be.map(Ae=>[Ae,Ae.getRanges()]));for(let Ae=0;Ae<te.length;Ae++)if(Ie(this,te[Ae],te,Ae+1))return!0;for(let Ae=0;Ae<te.length;Ae++)if(Ie(this,te[Ae],xe,0))return!0;return!1;function Ie(Ae,Se,Oe,Ve){for(let Me=Ve;Me<Oe.length;Me++){const De=Oe[Me];if(De.type!==Se.type||De.author.id!==Se.author.id||De.subType!==Se.subType||!Pt(Se,De,["groupId"])||Se.type=="attribute"&&Se.data.oldValue!=De.data.oldValue||Se.type=="attribute"&&Ae._isBlockAttribute(Se.data.key))continue;if(Se.type=="formatBlock"){const ze=Ae.editor.model,qe=Se.getContainedElement();if(qe&&(ze.schema.isObject(qe)||ze.schema.isLimit(qe)))continue}const Fe=ve.get(Se),Be=ke.get(Se),$e=ke.get(De),Ue=Se.commentThread&&Se.commentThread.length,He=De.commentThread&&De.commentThread.length;if(!Ue&&Fe($e,Be))return Ae._joinSuggestions(De,Se),ke.delete(Se),!0;if(!He&&Fe(Be,$e))return Ae._joinSuggestions(Se,De),ke.delete(De),!0}return!1}}_joinSuggestions(t,te){if(t.isMultiRange)for(const be of te.getRanges())t.addRange(be);else{const be=te.getFirstRange().end;this._setSuggestionRange(t,this._model.createRange(t.getFirstRange().start,be))}te.removeMarkers()}_getMarkerAnnouncementText(t,te){const be=t.startsWith("format")||t.startsWith("attribute")?"FORMATTING":t.toUpperCase();return o(this.editor.locale,te+"_"+be+"_SUGGESTION_ANNOUNCEMENT")}_initAriaMarkerChangeAnnouncements(){const t=this.editor;if(!t.ui)return;const{ariaLiveAnnouncer:te}=t.ui;z$3(this._model,({left:be,entered:xe})=>{for(const ve of be){const{group:ke,type:Ie}=this._splitMarkerName(ve.name);if(ke==="suggestion"){te.announce(this._getMarkerAnnouncementText(Ie,"LEAVE"));break}}for(const ve of xe){const{group:ke,type:Ie}=this._splitMarkerName(ve.name);if(ke==="suggestion"){te.announce(this._getMarkerAnnouncementText(Ie,"ENTER"));break}}})}_processAttributeChanges(t){if(this._recordAttributeSuggestions)return!1;const te=this.editor,be=te.model.document.differ.getChanges();if(be.length==0)return!1;const xe=[],ve=be.filter(Ae=>Ae.type=="attribute"),ke=be.filter(Ae=>Ae.type=="insert"&&Ae.name!="$text"),Ie=be.filter(Ae=>Ae.type=="remove"&&Ae.name!="$text");for(const Ae of ve)xe.push({key:Ae.attributeKey,newValue:Ae.attributeNewValue,oldValue:Ae.attributeOldValue,range:Ot(Ae.range,te.model)});for(const Ae of ke){const Se=Ie.find(Oe=>Oe.position.isEqual(Ae.position));Se&&xe.push({key:m,newValue:Ae.name,oldValue:Se.name,range:te.model.createRangeOn(Ae.position.nodeAfter)})}return xe.length!=0&&this._reduceExistingSuggestions(t,xe)}_processAttributeSuggestions(t){let te=!1;const be=this.editor.model.document.differ.getChangedMarkers().filter(xe=>xe.data.newRange&&xe.name.startsWith("suggestion:attribute:"));for(const xe of be){const{subType:ve,id:ke}=this._splitMarkerName(xe.name),Ie=ve.split("|")[0];for(const Ae of this.getSuggestions({skipNotAttached:!0}))Ae.id!=ke&&Ae.type=="attribute"&&Ae.data&&Ae.data.key==Ie&&Ae.getFirstRange().isIntersecting(xe.data.newRange)&&(this._reduceSuggestionAttributeRange(Ae,xe.data.newRange,t),te=!0)}return te}_recordAttributeChanges(t){this.editor,this._recordAttributeSuggestions=!0,t()}_isRegisteredAttribute(t){const te=this._isBlockAttribute(t),be=this._inlineAttributeKeys.has(t);return te||be}_reduceExistingSuggestions(t,te){if(te.length==0)return!1;let be=!1;for(const xe of te){const ve=this._findSuggestions(xe.range,"attribute").filter(Ie=>!Ie.meta.isNextTo).map(Ie=>Ie.suggestion),ke=b$4({newValue:xe.newValue});ve.filter(Ie=>{const[Ae,Se]=Ie.subType.split("|");return Ae==xe.key&&Se!=ke}).forEach(Ie=>{this._reduceSuggestionAttributeRange(Ie,xe.range,t),be=!0})}return be}_reduceSuggestionAttributeRange(t,te,be){const xe=t.getFirstRange().getDifference(te);xe.length!==0?xe.length!==1?this._breakSuggestionMarker(t,te.start,te.end):this._setSuggestionRange(t,xe[0]):be.removeMarker(t.getFirstMarker())}}class xt{constructor(we){Re(this,"_editor");Re(this,"_model");Re(this,"_customCallbacks");Re(this,"_defaultCallbacks");this._editor=we,this._model=we.model,this._customCallbacks=new Map,this._defaultCallbacks=new Map,this._registerDefaultCallbacks()}buildSuggestion(we,t,te,be,xe,ve){return new u(this._model,{type:we,subType:t,id:te,author:be,creator:be,attributes:xe,onAttributesChange:ve,onAccept:(...ke)=>this.getSuggestionCallback(we,t,"accept")(...ke),onDiscard:(...ke)=>this.getSuggestionCallback(we,t,"discard")(...ke)})}registerCustomCallback(we,t,te,be){const xe=we+":"+t+":"+te;this._customCallbacks.set(xe,be)}getSuggestionCallback(we,t,te){const be=we+":"+t+":"+te;return this._customCallbacks.get(be)||this._defaultCallbacks.get(we+":"+te)}_registerDefaultCallbacks(){const we=()=>!1,t=ve=>{ve.sort((ke,Ie)=>ke.start.isBefore(Ie.start)?1:-1),this._model.change(ke=>{for(const Ie of ve){let Ae;Ae=Ie.end.isAtEnd&&Ie.end.parent==Ie.start.nodeAfter?ke.createSelection(Ie.start.nodeAfter,"on"):ke.createSelection(Ie),this._model.deleteContent(Ae,{forceDefaultExecution:!0,doNotAutoparagraph:!0})}})},te=(ve,ke)=>{ke&&this._model.change(Ie=>{const{commandName:Ae,commandParams:Se=[]}=ke,Oe=ve.map(De=>(Tt(De)&&(De=this._model.createRange(De.end)),De)).filter(De=>De.root.rootName!=="$graveyard");if(Oe.length<1)return;const Ve=Array.from(this._model.document.selection.getRanges()).map(De=>LiveRange.fromRange(De));Ie.setSelection(Oe);for(const De of this._editor.commands.commands())De.refresh();Se.push({forceDefaultExecution:!0}),this._editor.execute(Ae,...Se);const Me=Ve.filter(De=>De.root.rootName!="$graveyard");Me.length>0&&Ie.setSelection(Me);for(const De of Ve)De.detach()})},be=(ve,ke)=>ve.length==1&&ke.length==1&&ve[0].end.isEqual(ke[0].start),xe=(ve,ke,Ie,Ae)=>Ft(ve,ke,Ie,Ae,this._model)?[ve,ke]:Ft(ke,ve,Ae,Ie,this._model)?[ke,ve]:null;this._defaultCallbacks.set("insertion:accept",we),this._defaultCallbacks.set("insertion:discard",t),this._defaultCallbacks.set("insertion:join",be),this._defaultCallbacks.set("insertion:chain",xe),this._defaultCallbacks.set("deletion:accept",t),this._defaultCallbacks.set("deletion:discard",we),this._defaultCallbacks.set("deletion:join",be),this._defaultCallbacks.set("deletion:chain",xe),this._defaultCallbacks.set("formatInline:accept",te),this._defaultCallbacks.set("formatInline:discard",we),this._defaultCallbacks.set("formatInline:join",be),this._defaultCallbacks.set("formatInline:chain",we),this._defaultCallbacks.set("formatBlock:accept",te),this._defaultCallbacks.set("formatBlock:discard",we),this._defaultCallbacks.set("formatBlock:join",be),this._defaultCallbacks.set("formatBlock:chain",we),this._defaultCallbacks.set("attribute:accept",we),this._defaultCallbacks.set("attribute:discard",(ve,ke)=>{if(!ke)return;const Ie=this._editor.plugins.get(p);this._model.change(Ae=>{if(ke.key==m)for(const Se of ve){const Oe=Se.start.nodeAfter,Ve=ke.oldValue;Ae.rename(Oe,Ve)}else if(Ie._isBlockAttribute(ke.key))for(const Se of ve)ke.oldValue!==void 0?Ae.setAttribute(ke.key,ke.oldValue,Se.start.nodeAfter):Ae.removeAttribute(ke.key,Se.start.nodeAfter);else for(const Se of ve)ke.oldValue?Ae.setAttribute(ke.key,ke.oldValue,Se):Ae.removeAttribute(ke.key,Se)})}),this._defaultCallbacks.set("attribute:join",be)}}function Rt(Te,we,t){for(const te of we.parent.getAncestors({includeSelf:!0,parentFirst:!0})){if(te.root==te||!t.containsItem(te))return!1;if(Te.isObject(te)||Te.isLimit(te))return!0}return!1}function Tt(Te){return Te.end.parent==Te.start.nodeAfter&&Te.end.isAtStart}function Et(Te,we,t,te){const be=ke=>!ke.item.is("$textProxy")&&!te.isObject(ke.item),xe=Te.start.getLastMatchingPosition(be),ve=Te.end.getLastMatchingPosition(be,{direction:"backward"});return(!Te.start.isEqual(xe)||!Te.end.isEqual(ve))&&(xe.isBefore(ve)?t.updateMarker(we,{range:t.createRange(xe,ve)}):t.removeMarker(we),!0)}function Vt(Te){return b$4(Te)}function Ut(Te){const we=Te.start.nodeAfter;return we&&we.is("element")}function Ot(Te,we){return Te.end.nodeBefore==null&&Te.end.parent==Te.start.nodeAfter?Gt(Te.start.nodeAfter,we):Te}function Gt(Te,we){const t=we.schema.isObject(Te)||we.schema.isSelectable(Te);return we.createRange(we.createPositionAt(Te,"before"),t?we.createPositionAfter(Te):we.createPositionAt(Te,"end"))}function Ft(Te,we,t,te,be){if(!Pt(Te,we))return!1;if(t.end.isEqual(te.start))return!0;if(Te.type!=we.type||!t.end.isTouching(te.start))return!1;const xe=be.createRange(t.end,te.start).getWalker();for(const ve of xe)if(["elementStart","elementEnd"].includes(ve.type)&&be.schema.isLimit(ve.item))return!1;return!0}function Pt(Te,we,t=[]){return!(!Te._isDataLoaded||!we._isDataLoaded)&&isEqual(omit(Te.attributes,t),omit(we.attributes,t))}function Lt(Te,we){const t=Ht(Te.attributes),te=Ht(we);if(!Te._isDataLoaded)return!1;for(const be of Object.keys(te))if(!isEqual(t[be],te[be]))return!1;return!0}function Ht(Te){const we=Object.assign({},Te);return delete we.skipNestingCheck,delete we.tablePasteChainId,we}class oe extends ObservableMixin(){constructor(t,te,be,xe){super();Re(this,"model");Re(this,"view");Re(this,"commentThreadController");Re(this,"_editor");Re(this,"_acceptCommand");Re(this,"_discardCommand");Re(this,"_pendingAction");this.model=te,this.view=be,this.commentThreadController=xe,this._editor=t,this._acceptCommand=t.commands.get("acceptSuggestion"),this._discardCommand=t.commands.get("discardSuggestion"),this.view.bind("isEnabled").to(this._acceptCommand,this._discardCommand,(ve,ke)=>ve||ke),this.view.bind("canAccept").to(this._acceptCommand,"isEnabled",ve=>ve&&this._editor.model.canEditAt(te.getRanges())),this.view.bind("canDiscard").to(this._discardCommand,"isEnabled",ve=>ve&&this._editor.model.canEditAt(te.getRanges())),this._pendingAction=null,be.isDirty&&this._setPendingAction(),this.listenTo(be,"acceptSuggestion",()=>this.acceptSuggestion()),this.listenTo(be,"discardSuggestion",()=>this.discardSuggestion()),this.listenTo(be,"change:isDirty",()=>{be.isDirty?this._setPendingAction():this._removePendingAction()})}acceptSuggestion(){this._acceptCommand.execute(this.model.id)}discardSuggestion(){this._discardCommand.execute(this.model.id)}destroy(){this.view.unbind("isEnabled"),this.view.unbind("canAccept"),this.view.unbind("canDiscard"),this.stopListening(),this.commentThreadController.destroy(),this._pendingAction&&this._removePendingAction()}_setPendingAction(){const t=o(this._editor.locale,"PENDING_ACTION_SUGGESTION");this._pendingAction=this._editor.plugins.get("PendingActions").add(t)}_removePendingAction(){this._pendingAction!==null&&this._editor.plugins.get("PendingActions").remove(this._pendingAction),this._pendingAction=null}}class es extends View{constructor(t,te,be,xe){super(t);Re(this,"commentsListView");Re(this,"commentThreadInputView");Re(this,"_model");Re(this,"_localUser");Re(this,"_config");this.commentsListView=null,this.commentThreadInputView=null,this.set("isActive",!1),this.set("authoredAt",te.authoredAt),this.bind("authoredAt").to(te),this.set("descriptionParts",[]),this.set("isDirty",!1),this.set("isEnabled",!1),this.set("canAccept",!1),this.set("canDiscard",!1),this._model=te,this._localUser=be,this._config=xe,xe.disableComments?this.set("length",1):this._createCommentViews()}focus(){this.element.focus()}destroy(){this.commentsListView&&this.commentsListView.destroy(),this.commentThreadInputView&&this.commentThreadInputView.destroy(),super.destroy()}_createCommentViews(){const{CommentsListView:t}=this._config;this.commentsListView=new t(this.locale,this._model.commentThread,Object.assign({CommentView:this._config.CommentView},this._config)),this.commentsListView.delegate("removeComment").to(this),this.commentsListView.delegate("updateComment").to(this),this.commentsListView.bind("isActive").to(this),this.set("length",this.commentsListView.length+1),this.bind("length").to(this.commentsListView,"length",te=>te+1),this.commentThreadInputView=this._createCommentThreadInputView(),this.on("removeComment",()=>this.focus()),this.bind("isDirty").to(this.commentsListView,"hasDirtyComment",this.commentThreadInputView.commentInputView,"value",(te,be)=>te||!!be)}_createCommentThreadInputView(){const{CommentThreadInputView:t}=this._config,te=new t(this.locale,this._localUser,this._config.editorConfig),be=te.commentInputView;return te.bind("showInput").to(this,"isActive",this._model.commentThread,"isReadOnly",be,"value",(xe,ve,ke)=>!!ke||xe&&!ve),be.on("submit",(xe,ve)=>{this.fire("addComment",ve),be.editor.setData("")}),be.on("cancel",()=>this.focus()),be.bind("disabledSubmit").to(this._model.commentThread,"isReadOnly"),te}}class ne extends es{constructor(t,te,be,xe){super(t,te,be,xe);Re(this,"userView");Re(this,"acceptButton");Re(this,"discardButton");Re(this,"_descriptionElement");this.set("type",""),this.bind("type").to(this,"descriptionParts",ve=>ve&&ve[0]?ve[0].type:""),this.bind("description").to(this,"descriptionParts",this,"isActive",(ve,ke)=>{let Ie="";for(const Ae of ve)Ie+="<p>"+ds(Ae.content,Ae.color)+"</p>";return ke?Ie:Z$2(Ie,{limit:140})}),this._descriptionElement=null,this.acceptButton=this._createButton(o(t,"Accept suggestion"),icons.check,"ck-suggestion--accept","acceptSuggestion","sw"),this.acceptButton.bind("isEnabled").to(this,"canAccept"),this.discardButton=this._createButton(o(t,"Discard suggestion"),icons.cancel,"ck-suggestion--discard","discardSuggestion","sw"),this.discardButton.bind("isEnabled").to(this,"canDiscard"),this.userView=new E$4(t,this._model.author,this.getUserViewNotificationText()),this.userView.extendTemplate({attributes:{class:["ck-suggestion__user","ck-annotation__user"]}}),this.setTemplate(this.getTemplate())}getTemplate(){const t=this.bindTemplate,te=[{tag:"div",attributes:{class:["ck-suggestion__info","ck-annotation__info"]},children:[{tag:"span",children:[{text:this.userView.name}],attributes:{class:["ck-suggestion__info-name","ck-annotation__info-name"]}},{tag:"time",attributes:{datetime:t.to("authoredAt"),class:["ck-comment__info-time","ck-annotation__info-time"]},children:[{text:t.to("authoredAt",xe=>this._config.formatDateTime(xe))}]}]},{tag:"div",attributes:{class:["ck-suggestion__actions","ck-annotation__actions"]},children:[this.acceptButton,this.discardButton]},{tag:"div",attributes:{class:["ck-annotation__content-wrapper"]}}];this._model.isExternal&&te.push({tag:"div",attributes:{class:["ck-comment__external"]},children:[{text:this.getExternalSuggestionNote()}]});const be={tag:"div",attributes:{class:["ck-suggestion-wrapper",t.if("isActive","ck-suggestion-wrapper--active"),t.to("type",xe=>"ck-suggestion-"+xe),this._config.disableComments&&"ck-suggestion--disabled-comments"],"data-suggestion-id":this._model.id,"data-thread-id":this._model.commentThread.id,"data-author-id":this._model.author.id,tabindex:-1},children:[{tag:"div",attributes:{class:["ck-suggestion","ck-annotation"]},children:[this.userView,{tag:"div",attributes:{class:["ck-suggestion__main","ck-annotation__main"]},children:te}]}]};return this.commentsListView&&this.commentThreadInputView&&(be.children.push(this.commentsListView,this.commentThreadInputView),this.commentsListView.delegate("editorReady").to(this),this.commentsListView.delegate("editorDestroyed").to(this),this.commentThreadInputView.delegate("editorReady").to(this),this.commentThreadInputView.delegate("editorDestroyed").to(this)),be}render(){super.render(),this._descriptionElement=this.element.querySelector(".ck-annotation__content-wrapper"),this._descriptionElement.innerHTML=this.description,this.on("change:description",(t,te,be)=>{this._descriptionElement.innerHTML=be})}_createButton(t,te,be,xe,ve){const ke=new ButtonView(this.locale);return ke.set({label:t,icon:te,tooltip:!0,tooltipPosition:ve}),ke.extendTemplate({attributes:{class:be}}),ke.on("execute",()=>{this.fire(xe,this._model.id)}),ke}getExternalSuggestionNote(){return this._model.attributes["@external"].source==="importWord"?o(this.locale,"EXTERNAL_IMPORT_WORD_SUGGESTION"):o(this.locale,"EXTERNAL_SUGGESTION")}getUserViewNotificationText(){return this._model.isExternal?this._model.attributes["@external"].source==="importWord"?o(this.locale,"EXTERNAL_IMPORT_WORD_AVATAR",this._model.creator.name):o(this.locale,"EXTERNAL_AVATAR",this._model.creator.name):null}}function ds(Te,we){let t="";return t+=Te.split("*").map((te,be)=>be%2!=0?'<span class="ck-suggestion-type">'+us(te)+"</span>":us(te)).join(""),we&&(t+='<span class="ck-suggestion-color" style="background-color: '+we.value+'" title="'+we.title+'"></span>'),t}function us(Te){const we=document.createElement("span");return we.innerText=Te,we.innerHTML}var ie=`<!--

 What you're currently looking at is the source code of a legally protected, proprietary software.
 CKEditor 5 Collaboration is licensed under a commercial license and protected by copyright law. Where not otherwise indicated,
 all CKEditor 5 Collaboration content is authored by CKSource engineers and consists of CKSource-owned intellectual property.

 Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.

!-->

<svg viewBox="0 0 20 20" width="20" height="20" xmlns="http://www.w3.org/2000/svg"><g fill="#000" fill-rule="nonzero"><path d="M1 3.28C1 2.574 1.574 2 2.272 2h10.23c.703 0 1.272.573 1.272 1.28v12.768c0 .708-.574 1.281-1.271 1.281H2.272A1.276 1.276 0 0 1 1 16.049V3.28zm11.503 12.954c-.008 0-.006-12.77-.006-12.77 0-.003-10.225-.004-10.225-.004.007 0 .005 12.77.005 12.77 0 .003 10.226.004 10.226.004zm-8.31-9.58c0-.353.292-.64.636-.64h5.116c.351 0 .636.284.636.64a.641.641 0 0 1-.636.638H4.829a.636.636 0 0 1-.635-.639zm0 2.554c0-.352.292-.638.636-.638h5.116c.351 0 .636.283.636.638a.641.641 0 0 1-.636.639H4.829a.636.636 0 0 1-.635-.639zm0 2.555c0-.353.289-.639.633-.639h2.567c.35 0 .633.284.633.64a.639.639 0 0 1-.633.638H4.826a.634.634 0 0 1-.632-.639z"/><path d="M10.515 17.958l.154-.23c-.195-.099-.304-.193-.328-.28-.024-.09.001-.275.076-.552.062-.165.099-.296.111-.393.013-.159.013-.319 0-.478-.138-.41-.2-.686-.187-.83.013-.145.117-.335.313-.57l4.465-6.208c.356-.6 1.059-.56 2.11.119 1.051.68 1.443 1.271 1.177 1.771L14.53 17.14c-.105.271-.22.444-.347.516-.128.07-.399.118-.813.138a2.954 2.954 0 0 0-.487.21 2.044 2.044 0 0 0-.347.31c-.193.174-.332.262-.416.262-.064 0-.178-.05-.346-.15l-.204.27-1.056-.738h.001zm-.184.274l1.039.727-.259.34H9.614l.717-1.067z"/></g></svg>
`;class d extends Plugin{constructor(t){super(t);Re(this,"_suggestionToController");Re(this,"_viewToController");Re(this,"_annotationViews");Re(this,"_handleControllerBuffer");Re(this,"_disableComments");this._suggestionToController=new Map,this._viewToController=new Map,this._annotationViews=new Map,this._handleControllerBuffer=new Map;const te=this.editor.config;te.define("trackChanges.SuggestionThreadView",ne),te.define("trackChanges.disableComments",!1),this._disableComments=te.get("trackChanges.disableComments")}static get requires(){return[p,l$8,"CommentsRepository","Annotations","EditorAnnotations"]}static get pluginName(){return"TrackChangesUI"}_handleSuggestionControllerDelayed(t,te){this._handleControllerBuffer.size===0&&setTimeout(()=>{for(const[be,xe]of this._handleControllerBuffer){const ve=this._suggestionToController.has(be);ve||xe?ve&&xe&&this._destroyController(be):this._initializeController(be)}this._handleControllerBuffer.clear(),this.editor.plugins.get("EditorAnnotations").refreshSelectedViews(),this._refreshActiveMarkers()},10),this._handleControllerBuffer.set(t,te)}init(){const t=this.editor,te=t.plugins.get("TrackChangesEditing"),be=t.plugins.get("Annotations"),xe=t.plugins.get("EditorAnnotations"),ve=t.plugins.get("CommentsRepository");this._addUIComponentsToFactory(),xe.addSourceCollector(()=>{const ke=[];for(const[Ie,Ae]of Array.from(this._suggestionToController)){const Se=Ie.getAllAdjacentSuggestions(),Oe=[];for(const Ve of Se){if(!Ve.isInContent)continue;if(Ve.isMultiRange){Oe.push(...Ve.getRanges());continue}const Me=Ve.getFirstRange();if(Oe.length>0){const De=Oe[0].getJoined(Me);if(De){Oe[0]=De;continue}}Oe.push(Me)}ke.push([Ae.view,Oe])}return ke}),this.listenTo(te,"suggestionLoaded",(ke,Ie)=>{this.listenTo(Ie,"change:previous",(Ae,Se,Oe,Ve)=>{Ie.isInContent&&(Oe==null?(this._updateController(Ve.head),this._handleSuggestionControllerDelayed(Ie,!1)):(this._updateController(Oe.head),Ve==null&&this._handleSuggestionControllerDelayed(Ie,!0)))}),Ie.previous!==null?this._updateController(Ie.head):this._handleSuggestionControllerDelayed(Ie,!1)}),this.listenTo(te,"suggestionUnloaded",(ke,Ie,Ae)=>{this.stopListening(Ie,"change:previous"),this._handleControllerBuffer.delete(Ie),this._suggestionToController.has(Ie)&&this._destroyController(Ie),Ae&&this._updateController(Ae.head)}),this.listenTo(te,"suggestionChanged",(ke,Ie)=>{this._updateController(Ie)}),this.listenTo(be,"change:activeAnnotations",()=>{this._refreshActiveMarkers()}),this.listenTo(ve,"addComment",(ke,{threadId:Ie,isFromAdapter:Ae})=>{if(Ae||!te.hasSuggestion(Ie))return;const Se=te.getSuggestion(Ie);this._suggestionToController.get(Se).view.focus()},{priority:"lowest"})}_refreshActiveMarkers(){const t=this.editor.plugins.get("Annotations"),te=this.editor.plugins.get("TrackChangesEditing"),be=Array.from(t.activeAnnotations,ve=>ve.innerView).filter(ve=>this._viewToController.has(ve)),xe=[];for(const ve of be){const ke=this._viewToController.get(ve).model.getAllAdjacentSuggestions();xe.push(...ke.reduce((Ie,Ae)=>[...Ie,...Ae.getMarkerNames()],[]))}te.activeMarkers=xe}_addUIComponentsToFactory(){const t=this.editor,te=t.locale,be=o(te,"Track changes"),xe=new Collection([{type:"switchbutton",model:new Model({withText:!0,label:be,commandName:"trackChanges",role:"menuitemcheckbox"})},{type:"separator"},{type:"button",model:new Model({withText:!0,label:o(te,"Accept all suggestions"),commandName:"acceptAllSuggestions",role:"menuitem"})},{type:"button",model:new Model({withText:!0,label:o(te,"Accept all selected suggestions"),commandName:"acceptSelectedSuggestions",role:"menuitem"})},{type:"button",model:new Model({withText:!0,label:o(te,"Discard all suggestions"),commandName:"discardAllSuggestions",role:"menuitem"})},{type:"button",model:new Model({withText:!0,label:o(te,"Discard all selected suggestions"),commandName:"discardSelectedSuggestions",role:"menuitem"})}]);for(const ve of xe)if(ae(ve)){const ke=t.commands.get(ve.model.commandName);ve.model.bind("isOn","isEnabled").to(ke,"value","isEnabled")}t.ui.componentFactory.add("trackChanges",ve=>this._createToolbarButton(ve,xe,be)),t.ui.componentFactory.add("menuBar:trackChanges",ve=>this._createMenuBarMenu(ve,xe,be))}_createToolbarButton(t,te,be){const xe=createDropdown(t,SplitButtonView),ve=this.editor.commands.get("trackChanges");xe.buttonView.set({tooltip:be,label:be,icon:ie}),xe.buttonView.bind("isOn").to(ve,"value"),xe.buttonView.on("execute",()=>{ve.execute(),this.editor.editing.view.focus()}),addListToDropdown(xe,te,{role:"menu"});const ke=[];for(const Ae of te)ae(Ae)&&ke.push(this.editor.commands.get(Ae.model.commandName));const Ie=xe.buttonView;return Ie.actionView.unbind("isEnabled"),Ie.arrowView.unbind("isEnabled"),Ie.actionView.bind("isEnabled").to(ve,"isEnabled"),Ie.arrowView.bind("isEnabled").toMany(ke,"isEnabled",(...Ae)=>Ae.some(Se=>Se)),xe.on("execute",Ae=>{this.editor.execute(Ae.source.commandName),this.editor.editing.view.focus()}),xe}_createMenuBarMenu(t,te,be){const xe=new MenuBarMenuView(t),ve=this.editor.commands.get("trackChanges");xe.buttonView.set({label:be,icon:ie});const ke=new MenuBarMenuListView(t);for(const Ie of te){if(Ie.type=="separator"){ke.items.add(new ListSeparatorView(t));continue}const Ae=new MenuBarMenuListItemView(t,xe),Se=new MenuBarMenuListItemButtonView(t),Oe=Ie.model;Se.bind(...Object.keys(Oe)).to(Oe),Se.delegate("execute").to(xe),Se.on("execute",()=>{this.editor.execute(Oe.commandName),this.editor.editing.view.focus()}),Ae.children.add(Se),ke.items.add(Ae)}return xe.bind("isEnabled").to(ve,"isEnabled"),xe.panelView.children.add(ke),xe}_initializeController(t){const te=this.editor,be=te.config,xe=te.plugins.get("Annotations"),ve=te.plugins.get("CommentsRepository"),ke=te.plugins.get("EditorAnnotations"),Ie=te.plugins.get(l$8).me,Ae=be.get("trackChanges").SuggestionThreadView,{CommentsListView:Se,CommentThreadInputView:Oe}=te.plugins.get("CommentsUI");let Ve,Me;this._annotationViews.has(t.id)?(Me=this._annotationViews.get(t.id),Ve=Me.mainView):(Ve=new Ae(te.locale,t,Ie,{disableComments:this._disableComments,editorConfig:be.get("comments.editorConfig"),maxCommentsWhenCollapsed:be.get("comments.maxCommentsWhenCollapsed"),maxThreadTotalWeight:be.get("comments.maxThreadTotalWeight"),maxCommentCharsWhenCollapsed:be.get("comments.maxCommentCharsWhenCollapsed"),formatDateTime:j$4(be.get("locale")),CommentView:be.get("comments").CommentView,CommentsListView:Se,CommentThreadInputView:Oe}),Ve.acceptButton.on("execute",()=>{te.editing.view.focus()}),Ve.discardButton.on("execute",()=>{te.editing.view.focus()}),Me=xe.createAnnotationView(this.editor.locale,Ve),Me.bind("isDirty").to(Ve,"isDirty"),Me.bind("length").to(Ve),Me.bind("type").to(Ve,"type",Ue=>"suggestion-"+Ue),this._annotationViews.set(t.id,Me));const De=ve.createCommentThreadController(t.commentThread,Ve),Fe=new oe(te,t,Ve,De),Be=t.getAllAdjacentSuggestions().filter(Ue=>Ue.isInContent);Ve.descriptionParts=te.plugins.get("TrackChangesEditing").descriptionFactory.getDescriptions(Be),this._suggestionToController.set(t,Fe),this._viewToController.set(Ve,Fe);const $e=xe.createAnnotation({view:Me,target:()=>{const Ue=[],He=t.getAllAdjacentSuggestions().filter(ze=>ze.isInContent);for(const ze of He)Ue.push(...ze.getMarkers());return K$4(te.editing,Ue)},type:()=>"suggestion-"+Fe.view.type});ve._bindAnnotationToEditors(Ve,$e),xe.add($e),ke.registerAnnotation($e)}_destroyController(t){const te=this.editor.plugins.get("CommentsRepository"),be=this.editor.plugins.get("Annotations"),xe=this._suggestionToController.get(t),ve=xe.view,ke=be.getByInnerView(ve);te._unbindEditors(ve),ke&&be.remove(ke),this._suggestionToController.delete(t),this._viewToController.delete(ve),xe.destroy()}_updateController(t){if(!t.isInContent||!this._suggestionToController.has(t))return;const te=this.editor.plugins.get("TrackChangesEditing"),be=this._suggestionToController.get(t),xe=t.getAllAdjacentSuggestions();be.view.descriptionParts=te.descriptionFactory.getDescriptions(xe)}destroy(){for(const t of this._suggestionToController.keys())this._destroyController(t);for(const t of this._annotationViews.values())t.mainView.destroy();super.destroy()}}function ae(Te){return"model"in Te}class k extends Plugin{static get requires(){return[p,d,"Comments"]}static get pluginName(){return"TrackChanges"}set adapter(we){this.editor.plugins.get(p).adapter=we}get adapter(){return this.editor.plugins.get(p).adapter}addSuggestion(we){return this.editor.plugins.get(p).addSuggestionData(we)}getSuggestions({skipNotAttached:we=!1,toJSON:t=!1}={}){return this.editor.plugins.get(p).getSuggestions({skipNotAttached:we,toJSON:t})}getSuggestion(we){return this.editor.plugins.get(p).getSuggestion(we)}}const T=["Pagination"];class P extends Plugin{static get requires(){return[p]}static get pluginName(){return"TrackChangesData"}init(){const we=this.editor;if(we.config.define("trackChangesData.editorCreator",t=>{const te=we.model.document.getRootNames().reduce((be,xe)=>(be[xe]="",be),{});return we.constructor.create(te,t)}),typeof we.config.get("trackChangesData").editorCreator!="function")throw new CKEditorError("track-changes-data-invalid-editor-creator")}getDataWithAcceptedSuggestions(we){return N(this.editor,!0,we)}getDataWithDiscardedSuggestions(we){return N(this.editor,!1,we)}}class D extends Plugin{constructor(t){super(t);Re(this,"result");this.result="end"}static get pluginName(){return"TrackChangesDataGetter"}init(){this.editor.plugins.get("CommentsRepository")._adapter={addCommentThread:()=>new Promise(()=>{}),getCommentThread:()=>new Promise(()=>{}),updateCommentThread:()=>new Promise(()=>{}),resolveCommentThread:()=>new Promise(()=>{}),reopenCommentThread:()=>new Promise(()=>{}),removeCommentThread:()=>new Promise(()=>{}),addComment:()=>new Promise(()=>{}),updateComment:()=>new Promise(()=>{}),removeComment:()=>new Promise(()=>{})},this.editor.plugins.get("TrackChangesEditing")._adapter=null}}function v(Te){return Te.getRootsAttributes!==void 0}async function N(Te,we,t){const te=D$2(Te,T);te.plugins.push(p,D),te.rootsAttributes=v(Te)?Te.getRootsAttributes():void 0;const be=document.createDocumentFragment(),xe=Te.config.get("trackChangesData").editorCreator,ve=await xe(te,()=>function(Ie){const Ae=document.createElement("div");return Ie.appendChild(Ae),Ae}(be));(function(Ie,Ae){const Se=Ie.model.document.getRootNames().reduce(($e,Ue)=>($e[Ue]=Ie.data.get({rootName:Ue}),$e),{}),Oe=Ie.plugins.get("Users").users.map($e=>({id:$e.id,name:$e.name})),Ve=Ie.plugins.get("TrackChangesEditing").getSuggestions({skipNotAttached:!0,toJSON:!0}),Me=Ie.plugins.get("CommentsRepository").getCommentThreads({skipNotAttached:!0,toJSON:!0}),De=Ae.plugins.get("Users"),Fe=Ae.plugins.get("TrackChangesEditing"),Be=Ae.plugins.get("CommentsRepository");for(const $e of Oe)De.getUser($e.id)||De.addUser($e);De.me||De.useAnonymousUser();for(const $e of Me)Be.addCommentThread($e);for(const $e of Ve)Fe.addSuggestionData($e);Ae.data.set(Se)})(Te,ve),ve.execute(we?"acceptAllSuggestions":"discardAllSuggestions");const ke=v(ve)?ve.getFullData(t):ve.data.get(t);return await ve.destroy(),ke}const LICENSE_KEY="<YOUR_LICENSE_KEY>",AI_AUTH_TOKEN="<YOUR_AI_AUTH_TOKEN>",AI_API_URL="<YOUR_AI_API_URL>",CKBOX_TOKEN_URL="<YOUR_CKBOX_TOKEN_URL>",UNIQUE_CHANNEL_PER_DOCUMENT="<YOUR_UNIQUE_CHANNEL_PER_DOCUMENT>",CLOUD_SERVICES_TOKEN_URL="<YOUR_CLOUD_SERVICES_TOKEN_URL>",CLOUD_SERVICES_WEBSOCKET_URL="<YOUR_CLOUD_SERVICES_WEBSOCKET_URL>";class AnnotationsSidebarToggler extends Plugin{static get requires(){return["AnnotationsUIs"]}static get pluginName(){return"AnnotationsSidebarToggler"}init(){this.toggleButton=new ButtonView(this.editor.locale);const we='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" transform="matrix(-1,0,0,1,0,0)"><path d="M11.463 5.187a.888.888 0 1 1 1.254 1.255L9.16 10l3.557 3.557a.888.888 0 1 1-1.254 1.255L7.26 10.61a.888.888 0 0 1 .16-1.382l4.043-4.042z"></path></svg>',t='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg" transform="matrix(1,0,0,1,0,0)"><path d="M11.463 5.187a.888.888 0 1 1 1.254 1.255L9.16 10l3.557 3.557a.888.888 0 1 1-1.254 1.255L7.26 10.61a.888.888 0 0 1 .16-1.382l4.043-4.042z"/></svg>',te=this.editor.plugins.get("AnnotationsUIs"),be=this.editor.config.get("sidebar.container"),xe=be.parentElement;this.toggleButton.set({label:"Toggle annotations sidebar",tooltip:"Hide annotations sidebar",tooltipPosition:"se",icon:t}),this.toggleButton.on("execute",()=>{be.classList.toggle("ck-hidden"),be.classList.contains("ck-hidden")?(this.toggleButton.icon=we,this.toggleButton.tooltip="Show annotations sidebar",te.switchTo("inline")):(this.toggleButton.icon=t,this.toggleButton.tooltip="Hide annotations sidebar",te.switchTo("wideSidebar")),this.editor.editing.view.focus()}),this.toggleButton.render(),xe.insertBefore(this.toggleButton.element,be)}destroy(){return this.toggleButton.element.remove(),super.destroy()}}class DocumentOutlineToggler extends Plugin{static get pluginName(){return"DocumentOutlineToggler"}init(){this.toggleButton=new ButtonView(this.editor.locale);const we='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M5 9.5a.5.5 0 0 0 .5-.5v-.5A.5.5 0 0 0 5 8H3.5a.5.5 0 0 0-.5.5V9a.5.5 0 0 0 .5.5H5Z"/><path d="M5.5 12a.5.5 0 0 1-.5.5H3.5A.5.5 0 0 1 3 12v-.5a.5.5 0 0 1 .5-.5H5a.5.5 0 0 1 .5.5v.5Z"/><path d="M5 6.5a.5.5 0 0 0 .5-.5v-.5A.5.5 0 0 0 5 5H3.5a.5.5 0 0 0-.5.5V6a.5.5 0 0 0 .5.5H5Z"/><path clip-rule="evenodd" d="M2 19a2 2 0 0 1-2-2V3a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H2Zm6-1.5h10a.5.5 0 0 0 .5-.5V3a.5.5 0 0 0-.5-.5H8v15Zm-1.5-15H2a.5.5 0 0 0-.5.5v14a.5.5 0 0 0 .5.5h4.5v-15Z"/></svg>',t='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M11.463 5.187a.888.888 0 1 1 1.254 1.255L9.16 10l3.557 3.557a.888.888 0 1 1-1.254 1.255L7.26 10.61a.888.888 0 0 1 .16-1.382l4.043-4.042z"/></svg>',te=this.editor.config.get("documentOutline.container"),be=te.parentElement;this.toggleButton.set({label:"Toggle document outline",tooltip:"Hide document outline",tooltipPosition:"se",icon:t}),this.toggleButton.on("execute",()=>{te.classList.toggle("ck-hidden"),te.classList.contains("ck-hidden")?(this.toggleButton.icon=we,this.toggleButton.tooltip="Show document outline"):(this.toggleButton.icon=t,this.toggleButton.tooltip="Hide document outline"),this.editor.editing.view.focus()}),this.toggleButton.render(),be.insertBefore(this.toggleButton.element,te)}destroy(){return this.toggleButton.element.remove(),super.destroy()}}const _sfc_main={name:"app",data(){return{isLayoutReady:!1,config:null,editor:DecoupledEditor}},mounted(){this.config={toolbar:{items:["undo","redo","|","previousPage","nextPage","|","revisionHistory","trackChanges","comment","|","aiCommands","aiAssistant","|","formatPainter","|","heading","|","fontSize","fontFamily","fontColor","fontBackgroundColor","|","bold","italic","underline","|","link","insertImage","insertTable","highlight","blockQuote","|","alignment","|","bulletedList","numberedList","multiLevelList","todoList","outdent","indent"],shouldNotGroupWhenFull:!1},plugins:[AccessibilityHelp,r$b,Alignment,Autoformat,AutoImage,AutoLink,Autosave,BalloonToolbar,BlockQuote,Bold,a$8,CKBox,CKBoxImageEdit,CloudServices,Code,f$6,l$7,Essentials,s$6,s$5,FindAndReplace,FontBackgroundColor,FontColor,FontFamily,FontSize,m$8,Heading,Highlight,HorizontalLine,ImageBlock,ImageCaption,ImageInline,ImageInsert,ImageInsertViaUrl,ImageResize,ImageStyle,ImageTextAlternative,ImageToolbar,ImageUpload,i$5,Indent,IndentBlock,Italic,Link,LinkImage,List,ListProperties,Mention,r$6,F$5,PageBreak,o$3,Paragraph,PasteFromOffice,a$3,PictureEditing,i$1,m$4,n$1,d$4,p$2,RemoveFormat,H$1,SelectAll,m$2,SpecialCharacters,SpecialCharactersArrows,SpecialCharactersCurrency,SpecialCharactersEssentials,SpecialCharactersLatin,SpecialCharactersMathematical,SpecialCharactersText,Strikethrough,Subscript,Superscript,Table,TableCaption,TableCellProperties,TableColumnResize,a$6,TableProperties,TableToolbar,m$1,TextTransformation,TodoList,k,P,Underline,Undo],extraPlugins:[DocumentOutlineToggler,AnnotationsSidebarToggler],ai:{openAI:{apiUrl:AI_API_URL,requestHeaders:{Authorization:AI_AUTH_TOKEN},requestParameters:{model:"gpt-3.5-turbo-1106",max_tokens:4e3}},aiAssistant:{contentAreaCssClass:"formatted"}},balloonToolbar:["comment","|","aiAssistant","|","bold","italic","|","link","insertImage","|","bulletedList","numberedList"],ckbox:{tokenUrl:CKBOX_TOKEN_URL},cloudServices:{tokenUrl:CLOUD_SERVICES_TOKEN_URL,webSocketUrl:CLOUD_SERVICES_WEBSOCKET_URL},collaboration:{channelId:UNIQUE_CHANNEL_PER_DOCUMENT},comments:{editorConfig:{extraPlugins:[Autoformat,Bold,Italic,List,Mention],mention:{feeds:[{marker:"@",feed:[]}]}}},documentOutline:{container:this.$refs.editorOutlineElement},exportPdf:{stylesheets:["./style.css","https://cdn.ckeditor.com/ckeditor5/42.0.1/ckeditor5.css","https://cdn.ckeditor.com/ckeditor5-premium-features/42.0.1/ckeditor5-premium-features.css"],fileName:"export-pdf-demo.pdf",converterOptions:{format:"A4",margin_top:"20mm",margin_bottom:"20mm",margin_right:"12mm",margin_left:"12mm",page_orientation:"portrait"}},exportWord:{stylesheets:["./style.css","https://cdn.ckeditor.com/ckeditor5/42.0.1/ckeditor5.css","https://cdn.ckeditor.com/ckeditor5-premium-features/42.0.1/ckeditor5-premium-features.css"],fileName:"export-word-demo.docx",converterOptions:{format:"A4",margin_top:"20mm",margin_bottom:"20mm",margin_right:"12mm",margin_left:"12mm",orientation:"portrait"}},fontFamily:{supportAllValues:!0},fontSize:{options:[10,12,14,"default",18,20,22],supportAllValues:!0},heading:{options:[{model:"paragraph",title:"Paragraph",class:"ck-heading_paragraph"},{model:"heading1",view:"h1",title:"Heading 1",class:"ck-heading_heading1"},{model:"heading2",view:"h2",title:"Heading 2",class:"ck-heading_heading2"},{model:"heading3",view:"h3",title:"Heading 3",class:"ck-heading_heading3"},{model:"heading4",view:"h4",title:"Heading 4",class:"ck-heading_heading4"},{model:"heading5",view:"h5",title:"Heading 5",class:"ck-heading_heading5"},{model:"heading6",view:"h6",title:"Heading 6",class:"ck-heading_heading6"}]},image:{toolbar:["toggleImageCaption","imageTextAlternative","|","imageStyle:inline","imageStyle:wrapText","imageStyle:breakText","|","resizeImage","|","ckboxImageEdit"]},initialData:`<h2>Congratulations on setting up CKEditor 5! 🎉</h2>
<p>
    You've successfully created a CKEditor 5 project. This powerful text editor will enhance your application, enabling rich text editing
    capabilities that are customizable and easy to use.
</p>
<h3>What's next?</h3>
<ol>
    <li>
        <strong>Integrate into your app</strong>: time to bring the editing into your application. Take the code you created and add to your
        application.
    </li>
    <li>
        <strong>Explore features:</strong> Experiment with different plugins and toolbar options to discover what works best for your needs.
    </li>
    <li>
        <strong>Customize your editor:</strong> Tailor the editor's configuration to match your application's style and requirements. Or even
        write your plugin!
    </li>
</ol>
<p>
    Keep experimenting, and don't hesitate to push the boundaries of what you can achieve with CKEditor 5. Your feedback is invaluable to us
    as we strive to improve and evolve. Happy editing!
</p>
<h3>Helpful resources</h3>
<ul>
    <li>📝 <a href="https://orders.ckeditor.com/trial/premium-features">Trial sign up</a>,</li>
    <li>📕 <a href="https://ckeditor.com/docs/ckeditor5/latest/installation/index.html">Documentation</a>,</li>
    <li>⭐️ <a href="https://github.com/ckeditor/ckeditor5">GitHub</a> (star us if you can!),</li>
    <li>🏠 <a href="https://ckeditor.com">CKEditor Homepage</a>,</li>
    <li>🧑‍💻 <a href="https://ckeditor.com/ckeditor-5/demo/">CKEditor 5 Demos</a>,</li>
</ul>
<h3>Need help?</h3>
<p>
    See this text, but the editor is not starting up? Check the browser's console for clues and guidance. It may be related to an incorrect
    license key if you use premium features or another feature-related requirement. If you cannot make it work, file a GitHub issue, and we
    will help as soon as possible!
</p>
`,licenseKey:LICENSE_KEY,link:{addTargetToExternalLinks:!0,defaultProtocol:"https://",decorators:{toggleDownloadable:{mode:"manual",label:"Downloadable",attributes:{download:"file"}}}},list:{properties:{styles:!0,startIndex:!0,reversed:!0}},mention:{feeds:[{marker:"@",feed:[]}]},menuBar:{isVisible:!0},pagination:{pageWidth:"21cm",pageHeight:"29.7cm",pageMargins:{top:"20mm",bottom:"20mm",right:"12mm",left:"12mm"}},placeholder:"Type or paste your content here!",presenceList:{container:this.$refs.editorPresenceElement},revisionHistory:{editorContainer:this.$refs.editorContainerElement,viewerContainer:this.$refs.editorRevisionHistoryElement,viewerEditorElement:this.$refs.editorRevisionHistoryEditorElement,viewerSidebarContainer:this.$refs.editorRevisionHistorySidebarElement,resumeUnsavedRevision:!0},sidebar:{container:this.$refs.editorAnnotationsElement},table:{contentToolbar:["tableColumn","tableRow","mergeTableCells","tableProperties","tableCellProperties"]},template:{definitions:[{title:"Introduction",description:"Simple introduction to an article",icon:`<svg width="45" height="45" viewBox="0 0 45 45" fill="none" xmlns="http://www.w3.org/2000/svg">
    <g id="icons/article-image-right">
        <rect id="icon-bg" width="45" height="45" rx="2" fill="#A5E7EB"/>
        <g id="page" filter="url(#filter0_d_1_507)">
            <path d="M9 41H36V12L28 5H9V41Z" fill="white"/>
            <path d="M35.25 12.3403V40.25H9.75V5.75H27.7182L35.25 12.3403Z" stroke="#333333" stroke-width="1.5"/>
        </g>
        <g id="image">
            <path id="Rectangle 22" d="M21.5 23C21.5 22.1716 22.1716 21.5 23 21.5H31C31.8284 21.5 32.5 22.1716 32.5 23V29C32.5 29.8284 31.8284 30.5 31 30.5H23C22.1716 30.5 21.5 29.8284 21.5 29V23Z" fill="#B6E3FC" stroke="#333333"/>
            <path id="Vector 1" d="M24.1184 27.8255C23.9404 27.7499 23.7347 27.7838 23.5904 27.9125L21.6673 29.6268C21.5124 29.7648 21.4589 29.9842 21.5328 30.178C21.6066 30.3719 21.7925 30.5 22 30.5H32C32.2761 30.5 32.5 30.2761 32.5 30V27.7143C32.5 27.5717 32.4391 27.4359 32.3327 27.3411L30.4096 25.6268C30.2125 25.451 29.9127 25.4589 29.7251 25.6448L26.5019 28.8372L24.1184 27.8255Z" fill="#44D500" stroke="#333333" stroke-linejoin="round"/>
            <circle id="Ellipse 1" cx="26" cy="25" r="1.5" fill="#FFD12D" stroke="#333333"/>
        </g>
        <rect id="Rectangle 23" x="13" y="13" width="12" height="2" rx="1" fill="#B4B4B4"/>
        <rect id="Rectangle 24" x="13" y="17" width="19" height="2" rx="1" fill="#B4B4B4"/>
        <rect id="Rectangle 25" x="13" y="21" width="6" height="2" rx="1" fill="#B4B4B4"/>
        <rect id="Rectangle 26" x="13" y="25" width="6" height="2" rx="1" fill="#B4B4B4"/>
        <rect id="Rectangle 27" x="13" y="29" width="6" height="2" rx="1" fill="#B4B4B4"/>
        <rect id="Rectangle 28" x="13" y="33" width="16" height="2" rx="1" fill="#B4B4B4"/>
    </g>
    <defs>
        <filter id="filter0_d_1_507" x="9" y="5" width="28" height="37" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB">
            <feFlood flood-opacity="0" result="BackgroundImageFix"/>
            <feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" result="hardAlpha"/>
            <feOffset dx="1" dy="1"/>
            <feComposite in2="hardAlpha" operator="out"/>
            <feColorMatrix type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.29 0"/>
            <feBlend mode="normal" in2="BackgroundImageFix" result="effect1_dropShadow_1_507"/>
            <feBlend mode="normal" in="SourceGraphic" in2="effect1_dropShadow_1_507" result="shape"/>
        </filter>
    </defs>
</svg>
`,data:"<h2>Introduction</h2><p>In today's fast-paced world, keeping up with the latest trends and insights is essential for both personal growth and professional development. This article aims to shed light on a topic that resonates with many, providing valuable information and actionable advice. Whether you're seeking to enhance your knowledge, improve your skills, or simply stay informed, our comprehensive analysis offers a deep dive into the subject matter, designed to empower and inspire our readers.</p>"}]}},configUpdateAlert(this.config),this.isLayoutReady=!0},methods:{onReady(Te){Array.from(this.$refs.editorToolbarElement.children).forEach(we=>we.remove()),Array.from(this.$refs.editorMenuBarElement.children).forEach(we=>we.remove()),this.$refs.editorToolbarElement.appendChild(Te.ui.view.toolbar.element),this.$refs.editorMenuBarElement.appendChild(Te.ui.view.menuBarView.element)}}};function configUpdateAlert(Te){var te,be,xe,ve,ke,Ie,Ae,Se,Oe;if(configUpdateAlert.configUpdateAlertShown)return;const we=(Ve,Me)=>!(Ve===Me||Ve===void 0),t=[];configUpdateAlert.configUpdateAlertShown=!0,we(Te.licenseKey,"<YOUR_LICENSE_KEY>")||t.push("LICENSE_KEY"),we((te=Te.ckbox)==null?void 0:te.tokenUrl,"<YOUR_CKBOX_TOKEN_URL>")||t.push("CKBOX_TOKEN_URL"),we((ve=(xe=(be=Te.ai)==null?void 0:be.openAI)==null?void 0:xe.requestHeaders)==null?void 0:ve.Authorization,"<YOUR_AI_AUTH_TOKEN>")||t.push("AI_AUTH_TOKEN"),we((Ie=(ke=Te.ai)==null?void 0:ke.openAI)==null?void 0:Ie.apiUrl,"<YOUR_AI_API_URL>")||t.push("AI_API_URL"),we((Ae=Te.collaboration)==null?void 0:Ae.channelId,"<YOUR_UNIQUE_CHANNEL_PER_DOCUMENT>")||t.push("UNIQUE_CHANNEL_PER_DOCUMENT"),we((Se=Te.cloudServices)==null?void 0:Se.tokenUrl,"<YOUR_CLOUD_SERVICES_TOKEN_URL>")||t.push("CLOUD_SERVICES_TOKEN_URL"),we((Oe=Te.cloudServices)==null?void 0:Oe.webSocketUrl,"<YOUR_CLOUD_SERVICES_WEBSOCKET_URL>")||t.push("CLOUD_SERVICES_WEBSOCKET_URL"),t.length&&window.alert(["Please update the following values in your editor config","in order to receive full access to the Premium Features:","",...t.map(Ve=>` - ${Ve}`)].join(`
`))}const _hoisted_1={class:"main-container"},_hoisted_2={class:"presence",ref:"editorPresenceElement"},_hoisted_3={class:"editor-container editor-container_document-editor editor-container_include-outline editor-container_include-annotations editor-container_include-pagination",ref:"editorContainerElement"},_hoisted_4={class:"editor-container__menu-bar",ref:"editorMenuBarElement"},_hoisted_5={class:"editor-container__toolbar",ref:"editorToolbarElement"},_hoisted_6={class:"editor-container__editor-wrapper"},_hoisted_7={class:"editor-container__sidebar"},_hoisted_8={ref:"editorOutlineElement"},_hoisted_9={class:"editor-container__editor"},_hoisted_10={ref:"editorElement"},_hoisted_11={class:"editor-container__sidebar"},_hoisted_12={ref:"editorAnnotationsElement"},_hoisted_13={class:"revision-history",ref:"editorRevisionHistoryElement"},_hoisted_14={class:"revision-history__wrapper"},_hoisted_15={class:"revision-history__editor",ref:"editorRevisionHistoryEditorElement"},_hoisted_16={class:"revision-history__sidebar",ref:"editorRevisionHistorySidebarElement"};function _sfc_render(Te,we,t,te,be,xe){const ve=resolveComponent("ckeditor");return openBlock(),createElementBlock("div",null,[createBaseVNode("div",_hoisted_1,[createBaseVNode("div",_hoisted_2,null,512),createBaseVNode("div",_hoisted_3,[createBaseVNode("div",_hoisted_4,null,512),createBaseVNode("div",_hoisted_5,null,512),createBaseVNode("div",_hoisted_6,[createBaseVNode("div",_hoisted_7,[createBaseVNode("div",_hoisted_8,null,512)]),createBaseVNode("div",_hoisted_9,[createBaseVNode("div",_hoisted_10,[be.isLayoutReady?(openBlock(),createBlock(ve,{key:0,modelValue:be.config.initialData,"onUpdate:modelValue":we[0]||(we[0]=ke=>be.config.initialData=ke),editor:be.editor,config:be.config,onReady:xe.onReady},null,8,["modelValue","editor","config","onReady"])):createCommentVNode("",!0)],512)]),createBaseVNode("div",_hoisted_11,[createBaseVNode("div",_hoisted_12,null,512)])])],512),createBaseVNode("div",_hoisted_13,[createBaseVNode("div",_hoisted_14,[createBaseVNode("div",_hoisted_15,null,512),createBaseVNode("div",_hoisted_16,null,512)])],512)])])}const index=_export_sfc(_sfc_main,[["render",_sfc_render]]);export{index as default};
